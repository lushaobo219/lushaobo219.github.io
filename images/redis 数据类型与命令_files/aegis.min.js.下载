/**
 * ===============================================
 * @tencent/aegis-web-sdk@1.21.19 (c) 2019 ivweb.
 * Author pumpkincai.
 * Released under the MIT License.
 * Thanks for supporting Aegis!
 * ===============================================
 **/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).Aegis=t()}(this,function(){"use strict";var o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function f(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var y=function(){return(y=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};var v,h,e,t,i=(n.prototype.indexOf=function(e,t){for(var n=0;n<e.length;n++)if(e[n].callback===t)return n;return-1},n.prototype.on=function(e,t,n){if(void 0===n&&(n=0),this){var o=this.__EventsList[e];if(o=o||(this.__EventsList[e]=[]),-1!==this.indexOf(o,t))return this;var r={name:e,type:n||0,callback:t};return o.push(r),this}},n.prototype.one=function(e,t){this.on(e,t,1)},n.prototype.remove=function(e,t){if(this){var n=this.__EventsList[e];if(!n)return null;if(!t){try{delete this.__EventsList[e]}catch(e){}return null}if(n.length){var o=this.indexOf(n,t);n.splice(o,1)}return this}},n);function n(){var s=this;this.emit=function(e,t){if(s){var n,o=s.__EventsList[e];if(o&&o.length){o=o.slice();for(var r=0;r<o.length;r++){n=o[r];try{var i=n.callback.apply(s,[t]);if(1===n.type&&s.remove(e,n.callback),!1===i)break}catch(e){throw e}}}return s}},this.__EventsList={}}function w(e){return(e=Array.isArray(e)?e:[e]).map(function(t,n){return Object.getOwnPropertyNames(t).map(function(e){return r(e)+"["+n+"]="+r(t[e])}).join("&")}).join("&")+(e.length?"&count="+e.length:"")}function r(e){try{return encodeURIComponent(decodeURIComponent(e))}catch(e){return""}}function s(e,t){return"number"==typeof e?e:"string"==typeof e?e:t?h.string:h.number}function m(e,t){return"string"==typeof e?e.split("?")[t?1:0]||"":e}function b(e){return/^https/.test(e)}function a(){return void 0!==window.performance&&"function"==typeof(e=window.Performance)&&/native code/.test(e.toString())&&"function"==typeof performance.clearResourceTimings&&"function"==typeof performance.getEntriesByType&&"function"==typeof performance.now;var e}(t=v=v||{}).INFO_ALL="-1",t.API_RESPONSE="1",t.INFO="2",t.ERROR="4",t.PROMISE_ERROR="8",t.AJAX_ERROR="16",t.SCRIPT_ERROR="32",t.IMAGE_ERROR="64",t.CSS_ERROR="128",t.CONSOLE_ERROR="256",t.MEDIA_ERROR="512",t.RET_ERROR="1024",t.REPORT="2048",(e=h=h||{})[e.number=-1]="number",e.string="";var u=["application/octet-stream","application/xhtml+xml","application/xml","application/pdf","application/pkcs12","application/javascript","application/ecmascript","application/vnd.mspowerpoint","application/ogg","text/html","text/css","text/javascript","image","audio","video"];function O(t){return u.some(function(e){return-1!==t.indexOf(e)})}function E(e,t){try{if("string"==typeof e&&(e=JSON.parse(e)),t&&t.layer&&"string"==typeof t.layer&&(e=t.layer.split(".").reduce(function(e,t){return(e||{})[t]},e)),t&&t.ret){var n=t.ret;c=[].concat(n)}var o=Object.getOwnPropertyNames(e).filter(function(e){return-1!==c.indexOf(e.toLowerCase())});return o.length?""+e[o[0]]:"unknown"}catch(e){return"unknown"}}function R(e){try{return(JSON.stringify(e,(o=[],r=[],function(e,t){if(t instanceof Error)return"Error.message【 "+t.message+" 】;  Error.stack【 "+t.stack+" 】";if("object"==typeof t&&null!==t){var n=o.indexOf(t);if(-1!==n)return"[Circular "+r[n]+"]";o.push(t),r.push(e||"root")}return t}),4)||"undefined").replace(/"/gim,"")}catch(e){return"error happen when aegis stringify: \n "+e.message+" \n "+e.stack}var o,r}var c=["ret","retcode","code"],p=(Object.defineProperty(g.prototype,"sourceURL",{get:function(){return this.data.responseURL},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"status",{get:function(){return Number(this.data.status)},enumerable:!0,configurable:!0}),Object.defineProperty(g.prototype,"headers",{get:function(){var e=this.data.getAllResponseHeaders().split("\n"),r={};return e.forEach(function(e){if(e){var t=e.split(": "),n=t[0],o=t[1].trim();r[n]=o}}),r},enumerable:!0,configurable:!0}),g),x=(Object.defineProperty(d.prototype,"sourceURL",{get:function(){return this.data.url},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"status",{get:function(){return Number(this.data.status)},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"headers",{get:function(){var n={};return this.data.headers.forEach(function(e,t){n[t]=e}),n},enumerable:!0,configurable:!0}),d),l=[];function d(e,t){this.type="fetch",this.data=e||{},this.data.response=t}function g(e){this.type="xhr",this.data=e}function _(t){l.forEach(function(e){e(t)})}var L=!1,C=!1,S=["img","css","script","link","audio","radio"],A=[];function I(t){A.forEach(function(e){e(t)})}var P=0;function T(){var e,t=performance.getEntriesByType("resource"),n=t.slice(P);P=t.length;for(var o=0,r=n.length;o<r;o++){var i=n[o];-1!==S.indexOf(i.initiatorType)&&I({url:m((e=i).name),method:"get",duration:Number(e.duration.toFixed(2)),status:200,type:"static",isHttps:b(e.name),urlQuery:m(e.name,!0),x5ContentType:s(e.x5ContentType,!0),x5HttpStatusCode:s(e.x5HttpStatusCode),x5ImgDecodeStatus:s(e.x5ImgDecodeStatus),x5ErrorCode:s(e.x5ErrorCode),x5LoadFromLocalCache:void 0===e.x5LoadFromLocalCache?h.number:0|e.x5LoadFromLocalCache,x5ContentLength:e.encodedBodySize||s(e.x5ContentLength),domainLookup:s(e.domainLookupEnd-e.domainLookupStart),connectTime:s(e.connectEnd-e.connectStart)})}}var j,N=[];function k(e,t){var n=[];for(var o in e)n.push(o+"="+e[o]);N.forEach(function(e){e({url:t.config.performanceUrl+"?"+n.join("&")})}),N.length=0}function D(e){if(!e||!e.getBoundingClientRect)return!1;var t=e.getBoundingClientRect(),n=window.innerHeight,o=window.innerWidth;return 0<=t.left&&t.left<o&&0<=t.top&&t.top<n}var q=!1,H=[];function M(t){H.forEach(function(e){e(t)})}var U=[];function F(t){U.forEach(function(e){e(t)})}var X=!1;function B(e){return window.btoa&&window.btoa(JSON.stringify({ids:{trace_id:{high:J(),low:J()},span_id:J(),parent_id:0,flag:2},baggages:{aegis_session_id:e._sessionID}}))}function J(){return parseInt(new Array(53).fill(1).map(function(){return.5<Math.random()?1:0}).join(""),2)}function G(e){var t=document.createElement("a");return t.href=e,location.origin===t.origin}var W,Q,K,Y,z,V,Z=navigator.userAgent;function $(n,o){var r;void 0===n&&(n=0);var i=[];return function(e,t){if(i.push(e),o&&i.length>=o)return t(i.splice(0,i.length)),void(r&&clearTimeout(r));r&&clearTimeout(r),r=setTimeout(function(){r=null,t(i.splice(0,i.length))},n)}}(V=W=W||{})[V.android=1]="android",V[V.ios=2]="ios",V[V.other=100]="other",(z=Q=Q||{})[z.oldX5=1]="oldX5",z[z.newX5=2]="newX5",z[z.other=3]="other",(Y=K=K||{})[Y.unknown=100]="unknown",Y[Y.wifi=1]="wifi",Y[Y.net2g=2]="net2g",Y[Y.net3g=3]="net3g",Y[Y.net4g=4]="net4g",Y[Y.net5g=5]="net5g",Y[Y.net6g=6]="net6g";function ee(e,t){return Array.isArray(e)?t(e.map(function(e){return{msg:"string"==typeof e.msg?e.msg:[].concat(e.msg).map(R).join(" "),level:e.level}})):t({msg:"string"==typeof e.msg?e.msg:R(e.msg),level:e.level})}function te(r){return function(t,n){var e,o;e=r.config.getNetworkType,o=function(e){r.extendBean("netType",e),n(t)},(e||function(e){var t;e((t=navigator.connection&&navigator.connection.type?navigator.connection.type:"unknown",0<=(t=String(t).toLowerCase()).indexOf("2g")?K.net2g:0<=t.indexOf("3g")?K.net3g:0<=t.indexOf("4g")?K.net4g:0<=t.indexOf("5g")?K.net5g:0<=t.indexOf("6g")?K.net6g:0<=t.indexOf("wifi")?K.wifi:K.unknown))})(function(e){K[e]||(e=K.unknown),o(e)})}}var ne=function(){};function oe(n){if(!n||!n.reduce||!n.length)throw new TypeError("createPipeline need at least one function param");return 1===n.length?function(e,t){n[0](e,t||ne)}:n.reduce(function(n,o){return function(e,t){return void 0===t&&(t=ne),n(e,function(e){return o&&o(e,t)})}})}var re=(ie.prototype.init=function(e,t){var n=this;this.setConfig(e),ie.installedPlugins.forEach(function(e){e.call(n,t)}),this.lifeCycle.emit("onInited")},ie.prototype.setConfig=function(e){return Object.assign(this.config,e),this.bean.id=this.config.id||"",this.bean.uin=this.config.uin||"",this.bean.version=this.config.version||"1.21.19",this.lifeCycle.emit("onConfigChange",e),this.config},ie.prototype.extendBean=function(e,t){this.bean[e]=t},ie.use=function(e){-1===ie.installedPlugins.indexOf(e)&&ie.installedPlugins.push(e)},ie.prototype.send=function(e,t,n){throw new Error('You need to override "send" method')},ie.prototype._sendSDKError=function(e){this.send({url:"https://aegis.qq.com/collect?id=1085&msg[0]="+encodeURIComponent(R(e))+"&level[0]=2&from="+this.config.id+"&count=1&version="+this.config.id+"(1.21.19)",addBean:!1,method:"get"})},ie.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._normalLogPipeline({msg:e,level:v.INFO})},ie.prototype.infoAll=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._normalLogPipeline({msg:e,level:v.INFO_ALL})},ie.prototype.report=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._normalLogPipeline({msg:e,level:v.REPORT})},ie.prototype.reportPv=function(e){e&&this.send({url:this.config.url+"/"+e,addBean:!1})},ie.prototype.reportTime=function(e,t){"string"==typeof e?"number"==typeof t?this._submitCustomTime(e,t):console.warn("reportTime: second param must be number"):console.warn("reportTime: first param must be a string")},ie.prototype.time=function(e){"string"==typeof e?this._timeMap[e]?console.warn("Timer "+e+" already exists"):this._timeMap[e]=Date.now():console.warn("time: first param must be a string")},ie.prototype.timeEnd=function(e){"string"==typeof e?this._timeMap[e]?(this._submitCustomTime(e,Date.now()-this._timeMap[e]),delete this._timeMap[e]):console.warn("Timer "+e+" does not exist"):console.warn("timeEnd: first param must be a string")},ie.prototype._submitCustomTime=function(e,t){this._customTimePipeline({name:e,duration:t})},ie.installedPlugins=[],ie.LOG_TYPE=v,ie);function ie(e){var n,r=this;this.config={version:0,delay:1500,repeat:5,random:1,url:"https://aegis.qq.com/collect",speedUrl:"https://aegis.qq.com/speed",customTimeUrl:"https://aegis.qq.com/speed/custom",whiteListUrl:"https://aegis.qq.com/aegis/whitelist",performanceUrl:"https://aegis.qq.com/speed/performance",listenOnerror:!0},this.lifeCycle=new i,this.bean={},this._normalLogPipeline=oe([$(this.config.delay,5),(n=this.lifeCycle.emit,function(e,t){return n("beforeWrite",e),t(e)}),function(e){var o=!1,r=!1;setTimeout(function(){e.send({url:e.config.whiteListUrl||""},function(e){try{0===(e=JSON.parse(e)||{}).retcode&&(o=e.result.is_in_white_list)}catch(e){}r=!0},function(){r=!0})},50);var i=[];return function(e,t){if(o)t(e.concat(i.splice(0)).map(function(e){return e.level===v.INFO_ALL&&(e.level=v.INFO),e}));else{var n=e.filter(function(e){if(e.level!==v.INFO&&e.level!==v.API_RESPONSE)return e.level===v.INFO_ALL&&(e.level=v.INFO),!0;r||(i.push(e),200<=i.length&&(i.length=200))});n.length&&t(n)}}}(this),ee,function(e,t){var n=JSON.parse(JSON.stringify(e));r.lifeCycle.emit("beforeReport",n);var o=r.config.beforeReport;if("function"==typeof o&&(e=e.filter(function(e){return!1!==o(e)})),e.length)return t(e)},function(e){r.send({url:r.config.url||"",data:w(e),method:"post",contentType:"application/x-www-form-urlencoded"},function(){var t=r.config.onReport;"function"==typeof t&&e.forEach(function(e){t(e)})})}]),this._timeMap={},this._customTimePipeline=oe([$(this.config.delay),function(e){r.send({url:r.config.customTimeUrl+"?payload="+encodeURIComponent(JSON.stringify({custom:e}))})}])}function se(t){if(t.payload){var n={};return Object.keys(t).forEach(function(e){"payload"!==e&&(n[e]=t[e])}),n}return t}function ae(e,a){var u=null,c=null,t=a.shadowLog.pluginUrl||e;function n(e){if(u&&c){var o=a.id,r=a.uin,i=ce.urls.aegisCollect;try{var t=(f(n,s=c),n.prototype.init=function(e){var t={dbConfig:{name:e.namespace},lookupUrl:i+"/shadowLogAuto?id="+o+"&uin="+r,uploadUrl:i+"/shadowLog",preservedDay:7,id:o,uin:r,sessionId:ce._sessionID},n=new u(t);return this.flog=n,s.prototype.init.call(this,e)},n.prototype.postMessage=function(e){var t=e.type,n=e.data;"write"===t&&this.flog.add(n)},n.prototype.report=function(){this.flog.uploadLogs()},new n(a.shadowLog));e.lifeCycle.emit("onShadowLogInit",t)}catch(e){console.log(e)}}function n(){return null!==s&&s.apply(this,arguments)||this}var s}ce.useAsyncPlugin(ce.urls.flog,{exportsConstructor:"Flog",onAegisInitAndPluginLoaded:function(e,t){u=t,n(e)}}),ce.useAsyncPlugin(t,{exportsConstructor:"ShadowLogAegisPlugin",onAegisInitAndPluginLoaded:function(e,t){c=t,n(e)}})}Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(null==e)throw new TypeError("Cannot convert first argument to object");for(var t=Object(e),n=1;n<arguments.length;n++){var o=arguments[n];if(null!=o){o=Object(o);for(var r=Object.keys(Object(o)),i=0,s=r.length;i<s;i++){var a=r[i],u=Object.getOwnPropertyDescriptor(o,a);void 0!==u&&u.enumerable&&(t[a]=o[a])}}}return t}});var ue,ce=(f(fe,ue=re),Object.defineProperty(fe.prototype,"_bean",{get:function(){var t=this;return Object.getOwnPropertyNames(this.bean).map(function(e){return e+"="+t.bean[e]}).join("&")+"&from="+encodeURIComponent(location.href)+"&referer="+document.referrer},enumerable:!0,configurable:!0}),fe.prototype._initOfflineLog=function(){!function(e,d){var p=[],g=null;function h(e){p=p.concat(e)}function m(e,t){void 0===e&&(e={}),void 0===t&&(t={}),g={conds:e,params:t}}ce.useAsyncPlugin(e,{exportsConstructor:"Flog",onAegisInit:function(e){e.lifeCycle.on("beforeWrite",h),e.lifeCycle.on("uploadLogs",m)},onAegisInitAndPluginLoaded:function(t,e){var n=d.dbConfig,o=void 0===n?{}:n,r=d.url,i=void 0===r?ce.urls.aegisCollect:r,s=d.offlineLogExp,a=void 0===s?3:s,u=d.id,c=d.uin;t.lifeCycle.remove("beforeWrite",h),t.lifeCycle.remove("uploadLogs",m);var f=Object.assign({lookupUrl:i+"/offlineAuto?id="+u+"&uin="+c,uploadUrl:i+"/offlineLog",preservedDay:a,id:u,uin:c},o,{sessionId:ce._sessionID});try{var l=new e(f);p.forEach(function(e){l.add(y(y({},e),{level:v.INFO_ALL?v.INFO:e.level}))}),t.lifeCycle.on("beforeWrite",function(e){void 0===e&&(e=[]),e.forEach(function(e){l.add(y(y({},e),{level:v.INFO_ALL?v.INFO:e.level}))})}),t.lifeCycle.on("uploadLogs",function(e,t){void 0===e&&(e={}),void 0===t&&(t={});var n=Object.assign({id:d.id,uin:d.uin},e);l.uploadLogs(n,t)}),t.lifeCycle.on("onConfigChange",function(e){l.setConfig(e)}),l.on("PERREVENT",function(e){t.send({data:w({msg:R(e),level:v.INFO}),contentType:"application/x-www-form-urlencoded",method:"post",addBean:!1,url:d.url+"?id=893&sessionId="+ce._sessionID+"&uin="+d.uin+"&from="+d.id+"&count=1&version=1.21.19"})}),g&&(t.lifeCycle.emit("uploadLogs",g.conds,g.params),g=null),t.flog=l}catch(t){console.log(t)}}})}(fe.urls.flog,this.config)},fe.prototype._initShadowLog=function(){ae(fe.urls.shadowLog,this.config)},fe.prototype.uploadLogs=function(e,t){void 0===e&&(e={}),void 0===t&&(t={}),this.lifeCycle.emit("uploadLogs",e,t)},fe.useAsyncPlugin=function(s,e){void 0===e&&(e={});var t=e.exportsConstructor,a=void 0===t?"aegis-plugin-"+this.asyncPluginIndex++:t,n=e.onAegisInit,u=void 0===n?function(){}:n,o=e.onAegisInitAndPluginLoaded,c=void 0===o?function(){}:o;if("string"!=typeof s)throw new TypeError("useAsyncPlugin first param must be string");if("function"!=typeof u||"function"!=typeof c)throw new TypeError("onAegisInit、onAegisInitAndPluginLoaded must be function");this.use(function(){var e,t,n,o,r,i=this;try{u(this),fe._asyncPlugin[s]?c(this,window[fe._asyncPlugin[s]]):(e=s,t=a,n=function(e){if(!e){fe._asyncPlugin[s]=a;var t=window[a];c(i,t)}},o=document.createElement("script"),r=document.head,"function"==typeof t&&(n=t,t=""),o.src=e,o.setAttribute("name",t),o.name=t,o.async=!0,o.onload=o.onreadystatechange=function(){o.readyState&&"loaded"!==o.readyState&&"complete"!==o.readyState||("function"==typeof n&&n(!1),setTimeout(function(){r.removeChild(o)}))},o.onerror=function(){"function"==typeof n&&n(!0),setTimeout(function(){r.removeChild(o)})},r.appendChild(o))}catch(i){console.log("error on below is caused by "+s+"："),console.error(i)}})},Object.defineProperty(fe,"urls",{get:function(){return{aegisCollect:"https://aegis.qq.com/collect",flog:"https://cdn-go.cn/vasdev/web_webpersistance_v2/latest/flog.core.min.js",shadowLog:""}},enumerable:!0,configurable:!0}),fe.__version__="1.21.19",fe._sessionID="session-"+Date.now(),fe.asyncPluginIndex=0,fe._asyncPlugin={},fe);function fe(e){var o,s=ue.call(this,e)||this;s.send=function(e,t,n){if(e&&"string"==typeof e.url&&""!==e.url&&s.bean.id){var o=e.url;!1!==e.addBean&&(o=o+(-1===o.indexOf("?")?"?":"&")+s._bean);var r=e.method||"get",i=new XMLHttpRequest;i.__sendByAegis=!0,i.addEventListener("readystatechange",function(){4===i.readyState&&(400<=i.status?n&&n(i.response):t&&t(i.response))}),"get"===r.toLocaleLowerCase()?(i.open("get",function(e,n){if("string"!=typeof e)return"";if("object"==typeof n&&n){var t=Object.getOwnPropertyNames(n).map(function(e){var t=n[e];return e+"="+("string"==typeof t?encodeURIComponent(t):encodeURIComponent(JSON.stringify(t)))}).join("&").replace(/eval/gi,"evaI");return e+(-1===e.indexOf("?")?"?":"&")+t}return e}(o,e.data)),i.send()):(i.open("post",o),e.contentType&&i.setRequestHeader("Content-Type",e.contentType),"string"==typeof e.data&&(e.data=e.data.replace(/eval/gi,"evaI")),i.send(e.data))}},s._speedLogPipeline=oe([(o={},function(e,t){if(Array.isArray(e)){var n=e.filter(function(e){var t=!o[e.url];return o[e.url]=!0,t});n.length&&t(n)}else o[e.url]||t(e),o[e.url]=!0}),$(s.config.delay),te(s),function(e,t){s.lifeCycle.emit("beforeReportSpeed",e);var n=s.config.beforeReportSpeed;if("function"==typeof n&&(e=e.filter(function(e){var t=!1!==n(e);return"fetch"===e.type&&void 0===e.ret&&e.payload&&(e.ret=E(e.payload.data.response,s.config.api)),t})),e.length)return t(e)},function(e){s.send({url:""+s.config.speedUrl,method:"post",data:function(e,t){var n={fetch:[],static:[]},o=new FormData;if(Array.isArray(e))e.forEach(function(e){var t=se(e);n[e.type].push(t)});else{var r=se(e);n[e.type].push(r)}return o.append("payload",JSON.stringify(y({duration:n},t))),o}(e,s.bean)})}]);try{e.uin=e.uin||parseInt((document.cookie.match(/\buin=\D+(\d*)/)||[])[1],10)||parseInt((document.cookie.match(/\bilive_uin=\D*(\d+)/)||[])[1],10)||"",e.offlineLog&&s._initOfflineLog(),e.shadowLog&&s._initShadowLog(),s.init(e,fe),s.extendBean("sessionId",fe._sessionID)}catch(e){console.warn(e),console.log("%c以上错误发生在初始化 Aegis 的过程中，将会影响您正常使用 Aegis，\n建议您联系 aegis-helper，进行反馈，感谢您的支持。","color: red"),s._sendSDKError(e)}return s}return ce.use(function(){this.config.listenOnerror&&l.push(this._normalLogPipeline),function(){if(!L){L=!0;var n=window.onerror;window.onerror=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];_({msg:(e[0]||"")+" @ ("+(e[1]||"")+":"+(e[2]||0)+":"+(e[3]||0)+")",level:v.ERROR}),n&&n.call.apply(n,function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var o=Array(e),r=0;for(t=0;t<n;t++)for(var i=arguments[t],s=0,a=i.length;s<a;s++,r++)o[r]=i[s];return o}([window],e))},window.addEventListener("unhandledrejection",function(e){_({msg:"PROMISE_ERROR: "+(e&&R(e.reason)),level:v.PROMISE_ERROR})});var i=0;window.document.addEventListener("error",function(e){if(e&&e.target&&e.srcElement){var t=e.target||e.srcElement,n=t.src||t.href,o=t.tagName;if(n&&o){var r={msg:o+" load fail: "+n,level:v.INFO};switch(o.toLowerCase()){case"script":r.level=v.SCRIPT_ERROR;break;case"link":r.level=v.CSS_ERROR;break;case"img":if(10<i)return;i++,r.level=v.IMAGE_ERROR;break;case"audio":case"video":r.level=v.MEDIA_ERROR;break;default:return}_(r)}}},!0);var e=window.XMLHttpRequest.prototype,t=e.open,o=e.send;e.open=function(){return this.aegisMethod&&this.aegisUrl||(this.aegisMethod=arguments[0],this.aegisUrl=arguments[1]),t.apply(this,arguments)},e.send=function(){return this.__sendByAegis||this.addEventListener("loadend",function(){this.aegisTimeout?_({msg:"AJAX_ERROR: request timeout. status: "+this.status+". \n url: "+this.aegisUrl,level:v.AJAX_ERROR}):0===this.status?_({msg:"AJAX_ERROR: request failed. status: "+this.status+". \n url: "+this.aegisUrl,level:v.AJAX_ERROR}):400<=this.status&&_({msg:"AJAX_ERROR: request error. status: "+this.status+". \n url: "+this.aegisUrl,level:v.AJAX_ERROR})}),this.__sendByAegis||this.addEventListener("timeout",function(){this.aegisTimeout=!0}),o.apply(this,arguments)}}}()}),ce.use(function(){var d,e,t,n;this.config.reportApiSpeed&&(H.push(this._speedLogPipeline),U.push(this._normalLogPipeline),q||(q=!0,function(g){if("function"==typeof window.fetch){var e=window.fetch;window.fetch=function(l,d){var p=Date.now();return e(l,d).then(function(f){try{var e=f.headers?f.headers.get("content-type"):"";f.ok&&"string"==typeof e&&O(e)?M({url:m(f.url),isHttps:b(f.url),method:d&&d.method||"get",duration:Date.now()-p,type:"static",status:f.status,urlQuery:m(f.url,!0),x5ContentType:h.string,x5HttpStatusCode:h.number,x5ImgDecodeStatus:h.number,x5ErrorCode:h.number,x5LoadFromLocalCache:h.number,x5ContentLength:h.number,domainLookup:h.number,connectTime:h.number}):f.clone().text().then(function(e){F({msg:l+" "+e,level:v.API_RESPONSE});var t=E(e,g.api),n={url:m(f.url),isHttps:b(f.url),method:d&&d.method||"get",duration:Date.now()-p,type:"fetch",ret:t||"unknown",status:f.status,payload:new x(f,e)},o=g.api&&g.api.errCode;o=o&&[].concat(o).map(function(e){return e+""});var r=g.api&&g.api.code;r=r&&[].concat(r).map(function(e){return e+""});var i=g.api&&"function"==typeof g.api.retCodeHandler&&g.api.retCodeHandler,s=!1;if(i){var a=i(e),u=a.code,c=a.isErr;n.ret=u,s=c}else s=o&&-1!==o.indexOf(t)||r&&-1===r.indexOf(t)||!o&&!r&&"0"!==t&&"unknown"!==t;M(n),s&&F({msg:"request url: "+l+" \n response: "+e,level:v.RET_ERROR})})}catch(e){}return f}).catch(function(e){throw M({url:m(l),isHttps:b(l),method:d&&d.method||"get",duration:Date.now()-p,type:"fetch",status:600}),e})}}}(this.config),d=this.config,e=window.XMLHttpRequest.prototype,t=e.open,n=e.send,e.open=function(){return this.aegisMethod&&this.aegisUrl||(this.aegisMethod=arguments[0],this.aegisUrl=arguments[1]),t.apply(this,arguments)},e.send=function(){var f=Date.now(),l=0;return this.__sendByAegis||this.addEventListener("loadend",function(){var e=this.aegisUrl;if(e){l=Date.now()-f;var t={url:m(e),isHttps:b(e),status:this.status,method:this.aegisMethod||"get",type:"fetch",duration:l,payload:new p(this)},n=this.getResponseHeader("content-type");if(400<=this.status||"string"!=typeof n||!O(n))try{F({msg:"req url: "+e+" \nres time: "+l+" \nres data: "+this.response,level:v.API_RESPONSE}),t.ret=E(this.response,d.api);var o=d.api&&d.api.errCode;o=o&&[].concat(o).map(function(e){return e+""});var r=d.api&&d.api.code;r=r&&[].concat(r).map(function(e){return e+""});var i=d.api&&"function"==typeof d.api.retCodeHandler&&d.api.retCodeHandler,s=!1;if(i){var a=i(this.response),u=a.code,c=a.isErr;t.ret=u,s=c}else s=o&&-1!==o.indexOf(t.ret)||r&&-1===r.indexOf(t.ret)||!o&&!r&&"0"!==t.ret&&"unknown"!==t.ret;s&&F({msg:"request url: "+e+" \n response: "+this.response,level:v.RET_ERROR})}catch(e){t.ret="unknown"}else t.type="static",delete t.ret,Object.assign(t,{urlQuery:m(e,!0),x5ContentType:h.string,x5HttpStatusCode:h.number,x5ImgDecodeStatus:h.number,x5ErrorCode:h.number,x5LoadFromLocalCache:h.number,x5ContentLength:h.number,domainLookup:h.number,connectTime:h.number});M(t)}}),n.apply(this,arguments)}))}),ce.use(function(){a()&&this.config.reportAssetSpeed&&(A.push(this._speedLogPipeline),C||(C=!0,setInterval(T,this.config.delay),performance.onresourcetimingbufferfull=function(){P=0,performance.clearResourceTimings()},window.document.addEventListener("error",function(e){if(e&&e.target&&e.srcElement){var t=e.target||e.srcElement,n=t.src||t.href;n&&I({url:m(n),status:400,method:"get",type:"static",isHttps:b(n),urlQuery:m(n,!0),x5ContentType:h.string,x5HttpStatusCode:h.number,x5ImgDecodeStatus:h.number,x5ErrorCode:h.number,x5LoadFromLocalCache:h.number,x5ContentLength:h.number,domainLookup:h.number,connectTime:h.number})}},!0)))}),ce.use(function(){var c,n,f,l,o=this;if(a())if(N.push(this.send),j)k(j,this);else try{c=function(e){var t=performance.timing,n=t.loadEventStart-t.domInteractive;n<0&&(n=1070),k(j={dnsLookup:t.domainLookupEnd-t.domainLookupStart,tcp:t.connectEnd-t.connectStart,ssl:0===t.secureConnectionStart?0:t.requestStart-t.secureConnectionStart,ttfb:t.responseStart-t.requestStart,contentDownload:t.responseEnd-t.responseStart,domParse:t.domInteractive-t.domLoading,resourceDownload:n,firstScreenTiming:Math.floor(e)},o)},n=["script","style","link","br"],f=[],(l=new MutationObserver(function(e){var t={roots:[],rootsDomNum:[],time:performance.now()};e.forEach(function(e){e&&e.addedNodes&&e.addedNodes.forEach&&e.addedNodes.forEach(function(e){1!==e.nodeType||-1!==n.indexOf(e.nodeName.toLocaleLowerCase())||function e(t,n){return!(!t||t===document.documentElement)&&(-1!==n.indexOf(t)||e(t.parentElement,n))}(e,t.roots)||(t.roots.push(e),t.rootsDomNum.push(function e(t){var n=0;if(t&&1===t.nodeType){n++;var o=t.children;if(o&&o.length)for(var r=0;r<o.length;r++)n+=e(o[r])}return n}(e)||0))})}),t.roots.length&&f.push(t)})).observe(document,{childList:!0,subtree:!0}),setTimeout(function(){l.disconnect();var n=0,o=0,r=!1;f.forEach(function(e){for(var t=0;t<e.roots.length;t++)e.rootsDomNum[t]>n&&D(e.roots[t])&&(n=e.rootsDomNum[t],o=e.time)});for(var e=document.querySelectorAll(".fp-check"),i=[],t=0;t<e.length;t++)if("img"===e[t].tagName.toLowerCase()&&""!==e[t].src)i.push(e[t].src);else{var s=window.getComputedStyle(e[t]),a=/url\([\'\"](.+)[\'\"]\)/gi.exec(s.backgroundImage);a&&2===a.length&&i.push(a[1])}var u=0;window.performance.getEntriesByType("resource").some(function(n){return i.some(function(e,t){if(e===n.name)return n.responseEnd>u&&(u=n.responseEnd),(n.fetchStart<o||n.startTime<o)&&n.responseEnd>o&&(r=!0,o=n.responseEnd),i.splice(t,1),!0}),0===i.length}),0===o&&(o=u),c(r?o:o+25)},3e3)}catch(c){}}),ce.use(function(){var t=this;!function(e){try{var t=window.localStorage.getItem("AEGIS_ID");t||(t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}),window.localStorage.setItem("AEGIS_ID",t)),e(t||"")}catch(t){e("")}}(function(e){t.bean.aid=e})}),ce.use(function(e){var t;this.config.tjg&&(t=e,X||(X=!0,function(n){if("function"==typeof window.fetch){var o=window.fetch;window.fetch=function(e,t){return G(e)&&("object"==typeof t&&t?t.headers?t.headers instanceof Headers&&t.headers.append("X-Tjg-Json-Span-Context",B(n)):t.headers=new Headers({"X-Tjg-Json-Span-Context":B(n)}):t={headers:new Headers({"X-Tjg-Json-Span-Context":B(n)})}),o(e,t)}}}(t),function(e){if(window.XMLHttpRequest){var t=window.XMLHttpRequest.prototype.send,n=window.XMLHttpRequest.prototype.open;window.XMLHttpRequest.prototype.open=function(){return!this.__sendByAegis&&G(arguments[1])&&(this.useTjg=!0),n.apply(this,arguments)},window.XMLHttpRequest.prototype.send=function(){return this.useTjg&&this.setRequestHeader("X-Tjg-Json-Span-Context",B(e)),t.apply(this,arguments)}}}(t)))}),ce.use(function(){var e;this.config.reportAssetSpeed&&(this.extendBean("platform",(e=W.other,/\bAndroid\s*([^;]+)/.test(Z)?e=W.android:/\b(iPad|iPhone|iPod)\b.*? OS ([\d_]+)/.test(Z)&&(e=W.ios),e)),this.extendBean("x5Type",function(){var e=Q.other;if(0<=Z.indexOf("tbs")){var t=Z.match(/tbs\/([\d\.]+)/);e=t&&t[1]&&36541<=parseInt(t[1],10)?Q.newX5:Q.oldX5}return e}()),this.extendBean("netType",K.unknown))}),ce});
//# sourceMappingURL=aegis.min.js.map
