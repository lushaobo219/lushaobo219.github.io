(window.webpackJsonp=window.webpackJsonp||[]).push([[12],[function(e,t){e.exports=melo},function(e,t){e.exports=React},function(e,t){e.exports=meloUtils},,function(e,t){e.exports=Easysync},,,function(e,t,o){"use strict";o.d(t,"b",(function(){return n})),o.d(t,"a",(function(){return r})),o.d(t,"c",(function(){return a}));var n,r,i=o(0);!function(e){e.Base="Base",e.Normal="Normal",e.Dark="Dark",e.Dracula="Dracula",e.VS="VS"}(n||(n={})),function(e){e.BaseCharacter="melo-codeblock-base-char",e.BaseParagraph="melo-codeblock-base-para",e.ThemeCharacter="theme-char",e.ThemeParagraph="theme-para",e.Atrule="atrule",e.AttrName="attr-name",e.AttrValue="attr-value",e.Bold="bold",e.Boolean="boolean",e.Builtin="builtin",e.Cdata="cdata",e.Char="char",e.ClassName="class-name",e.Constant="constant",e.Comment="comment",e.Deleted="deleted",e.Doctype="doctype",e.Entity="entity",e.Function="function",e.Inserted="inserted",e.Italic="italic",e.Important="important",e.Keyword="keyword",e.Number="number",e.Operator="operator",e.Parameter="parameter",e.Prolog="prolog",e.Property="property",e.Punctuation="punctuation",e.Regex="regex",e.Selector="selector",e.String="string",e.Symbol="symbol",e.Tag="tag",e.Url="url",e.Variable="variable"}(r||(r={}));var a=[{styleType:i.StyleType.Character,styleName:r.ThemeCharacter},{styleType:i.StyleType.Paragraph,styleName:r.ThemeParagraph},{styleType:i.StyleType.Character,styleName:r.Atrule},{styleType:i.StyleType.Character,styleName:r.AttrName},{styleType:i.StyleType.Character,styleName:r.AttrValue},{styleType:i.StyleType.Character,styleName:r.Bold},{styleType:i.StyleType.Character,styleName:r.Boolean},{styleType:i.StyleType.Character,styleName:r.Builtin},{styleType:i.StyleType.Character,styleName:r.Cdata},{styleType:i.StyleType.Character,styleName:r.BaseCharacter},{styleType:i.StyleType.Character,styleName:r.ClassName},{styleType:i.StyleType.Character,styleName:r.Constant},{styleType:i.StyleType.Character,styleName:r.Comment},{styleType:i.StyleType.Character,styleName:r.Deleted},{styleType:i.StyleType.Character,styleName:r.Doctype},{styleType:i.StyleType.Character,styleName:r.Entity},{styleType:i.StyleType.Character,styleName:r.Function},{styleType:i.StyleType.Character,styleName:r.Inserted},{styleType:i.StyleType.Character,styleName:r.Italic},{styleType:i.StyleType.Character,styleName:r.Important},{styleType:i.StyleType.Character,styleName:r.Keyword},{styleType:i.StyleType.Character,styleName:r.Number},{styleType:i.StyleType.Character,styleName:r.Operator},{styleType:i.StyleType.Character,styleName:r.Prolog},{styleType:i.StyleType.Character,styleName:r.Property},{styleType:i.StyleType.Character,styleName:r.Punctuation},{styleType:i.StyleType.Character,styleName:r.Regex},{styleType:i.StyleType.Character,styleName:r.Selector},{styleType:i.StyleType.Character,styleName:r.String},{styleType:i.StyleType.Character,styleName:r.Symbol},{styleType:i.StyleType.Character,styleName:r.Tag},{styleType:i.StyleType.Character,styleName:r.Url},{styleType:i.StyleType.Character,styleName:r.Variable}]},,,function(e,t){e.exports=jQuery},function(e,t){e.exports=ReactDOM},,,,,,function(e,t,o){"use strict";o.d(t,"a",(function(){return r})),o.d(t,"b",(function(){return i})),o.d(t,"d",(function(){return c})),o.d(t,"c",(function(){return l})),o.d(t,"f",(function(){return u})),o.d(t,"e",(function(){return h}));var n,r,i,a=o(2),s=(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)});!function(e){e.REFRESHANDFIX="refreshandfix",e.REFRESH="refresh",e.CONTACT="contact",e.HOW2DEAL="how2deal",e.LEARNMORE="learnmore"}(r||(r={})),function(e){e.ON_CHANGESET_COMMIT_REJECTED="onChangesetCommitRejected",e.ON_CHANGESET_CHECK_INVALID="onChangesetCheckInvalid",e.ON_DISMISS_BLOCK_USER_EDIT="onDismissBlockUserEdit",e.ON_DISMISS_BLOCK_OFFLINE_EDIT="onDismissBlockOfflineEdit"}(i||(i={}));var c=function(e){function t(t){var o=e.call(this,i.ON_CHANGESET_COMMIT_REJECTED)||this;return o.blockInfo=t,o}return s(t,e),t}(a.Notification),l=function(e){function t(t){var o=e.call(this,i.ON_CHANGESET_CHECK_INVALID)||this;return o.blockInfo=t,o}return s(t,e),t}(a.Notification),u=function(e){function t(t){var o=e.call(this,i.ON_DISMISS_BLOCK_USER_EDIT)||this;return o.target=t,o}return s(t,e),t}(a.Notification),h=function(e){function t(t){var o=e.call(this,i.ON_DISMISS_BLOCK_OFFLINE_EDIT)||this;return o.target=t,o}return s(t,e),t}(a.Notification)},,,,,,,,,,,,,,,,function(e,t,o){"use strict";o.d(t,"a",(function(){return n}));var n=new(function(){function e(){}return e.prototype.getUrlParameter=function(e){var t,o,n,r=window.location.search.substring(1);if(r)for(t=r.split("&"),o=0;o<t.length;o++)if((n=t[o].split("="))[0]===e)return n[1];return null},e.prototype.getUidParam=function(e){var t=this.getUrlParameter("uid"),o=this.getUrlParameter("uid_key"),n=t?"uid="+t+"&uid_key="+o:"";return n?e.indexOf("?")>=0?e+"&"+n:e+"?"+n:e},e.prototype.getEnvironmentId=function(){if(void 0!==this._environmentId)return this._environmentId;var e="";if(document.cookie){var t=document.cookie.match(/\bdev_route_id\b=(\d+)\b/i);t&&(e=t[1])}return this._environmentId=e,e},e.prototype.getFd=function(){if(void 0!==this._fd)return this._fd;var e="";if(document.cookie){var t=document.cookie.match(/\bfd\b=([A-z]+)\b/i);t&&(e=t[1])}return this._fd=e,e},e.prototype.getRoomRouteIp=function(){if(void 0!==this._roomRouteIp)return this._roomRouteIp;var e="";if(document.cookie){var t=document.cookie.match(/\broomrouteip\b=([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}:\d+:[0-9A-z]+)\b/i);t&&(e=t[1])}return this._roomRouteIp=e,e},e.prototype.isDevEvn=function(){if(void 0!==this._isDevEvn)return this._isDevEvn;var e=!1;return(this.getRoomRouteIp()||this.getEnvironmentId()||this.getFd())&&(e=!0),this._isDevEvn=e,e},e.prototype.isGrayEvn=function(){return window.__globalReleaseVersion&&window.__globalReleaseVersion.startsWith("gray")},e.prototype.getCookie=function(e){var t,o=new RegExp("(?:^|;+|\\s+)"+e+"=([^;]*)");return window.document&&(t=window.document.cookie.match(o)),(t?t[1]:"")||null},e}())},,,,function(e,t,o){e.exports={"list-marker":"list-marker--17GhZ","list-marker-text":"list-marker-text--1P-ge","list-overlay":"list-overlay--D11Go","list-overlay-selectable":"list-overlay-selectable--vFxxU","list-overlay-layer":"list-overlay-layer--RIBko","list-overlay-selected":"list-overlay-selected--2TXd7","list-overlay-list-selected":"list-overlay-list-selected--3IZhU"}},,,,,,,,,,function(e,t,o){"use strict";o.d(t,"a",(function(){return s}));var n=o(5),r=o(98),i=function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a},a=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=function(){function e(){this.mode=r.a.NORMAL,this.configs=new Map,this.NAMESPACE_SPLITTER="."}return e.prototype.setFlag=function(e,t){},e.prototype.getFlag=function(e){return this.get("custom.feature."+e)},e.prototype.get=function(e,t){var o,n,r=this;return void 0===t&&(t=!0),!!e.split(this.NAMESPACE_SPLITTER).reduce((function(e,t,o,n){var i,a,s=n.slice(0,o).join(r.NAMESPACE_SPLITTER);return!(!e||null!==(a=null===(i=r.configs.get(s))||void 0===i?void 0:i[r.mode])&&void 0!==a&&!a)}),!0)&&(null!==(n=null===(o=this.configs.get(e))||void 0===o?void 0:o[this.mode])&&void 0!==n?n:t)},e.prototype.setConfig=function(e,t,o){var n=this;void 0===o&&(o=""),Object.keys(t).forEach((function(r){var i,a=null!==(i=n.configs.get(""+o+r))&&void 0!==i?i:{};a[e]=t[r],n.configs.set(""+o+r,a),"object"==typeof t[r]&&n.setConfig(e,t[r],""+o+r+n.NAMESPACE_SPLITTER)}))},e.prototype.setMode=function(e,t){t&&(this.mode=e),this.contextService.inject(e,t)},e.prototype.isMode=function(e){return this.mode===e},i([Object(n.l)(),a("design:type",n.f)],e.prototype,"contextService",void 0),e=i([Object(n.w)(),Object(n.u)(n.j)],e)}()},,,,,function(e,t,o){"use strict";o.d(t,"b",(function(){return r})),o.d(t,"a",(function(){return b}));var n,r,i=o(0),a=o(12),s=o(229),c=o(30),l=o.n(c),u=(o(51),o(5)),h=o(2),d=(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),p=function(){return(p=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},f=function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a},m=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};!function(e){e.ON_PERMISSION_CHANGE="onPermissionChange"}(r||(r={}));var g=function(e){function t(t){var o=e.call(this,r.ON_PERMISSION_CHANGE)||this;return o.permissionCtrl=t,o}return d(t,e),t}(h.Notification),b=function(){function e(t){var o=this,n=t.privilegeAttribute,r=void 0===n?{}:n,a=t.isCreator,c=void 0!==a&&a;this.docInfo={ownerName:"...",docType:0,createTime:0},this.disableEditSet=new Set,this.privilege=Object.assign({},e.DEFAULT_PERMISSION),this.isCreator=c,this.setPrivilege(r||{}),i.GlobalContext.on(s.c.PrivilegeChanged,(function(e){var t=e.privilege,n=e.diff;o.setPrivilege(t);var r={action:"点击刷新",onClickAction:function(){window.location.reload(!0)}},i=o.getDiffText(n),a=!o.canRead;if(a){i="不可查看";var s=o.contextService.context.collabClient;s&&s.shutDownRoomChannel("PERMISSION_CHANGED")}o.snackbar&&o.snackbar.close(),o.snackbar=l.a.show(p({message:"你在此文档的权限已发生变化"+i,autoClose:!1,closable:!a},a?r:{}))}))}return e.createInstance=function(t){return this.instance?this.instance.onReset(t):this.instance=new e(t||{}),this.instance},e.prototype.onReset=function(t){return this.isCreator=t.isCreator||!1,this.setPrivilege(Object.assign({},e.DEFAULT_PERMISSION,t.privilegeAttribute)),!0},e.getInstance=function(){return this.instance||this.createInstance({})},e.prototype.getDiffText=function(e){var t=this,o=e.map((function(e){switch(e){case"can_edit":return t.isEditable?"可编辑":"可查看";case"can_read":return"不可查看";case"can_comment":return t.canComment?"可添加批注":"不可添加批注";case"can_copy":return t.canCopy?"可复制":"不可复制";default:return""}})).filter((function(e){return!!e})).join("，");return o?"，当前"+o:o},e.prototype.setPrivilege=function(e){var t=this,o=this.isEditable,n=this.canCopy,r=!1;Object.keys(this.privilege).forEach((function(o){var n=h.StringUtil.camelToSnake(o),i=void 0!==e[n]?e[n]:e[o];void 0!==i&&(r=!0,t.privilege[o]=!!i)})),o!==this.isEditable&&(r=!0,this.workbench.emit("$editableChanged",this.isEditable)),n!==this.canCopy&&this.workbench.emit("$copyableChanged",this.canCopy),r&&(i.GlobalContext.fire(new g(this)),u.m.emit("$afterPermissionChanged",this),this.toolbarService.setEditable(this.isEditable),this.toolbarService.$forceUpdate())},e.prototype.setDocInfo=function(e){this.docInfo=e},e.prototype.enableEditForKey=function(e){this.disableEditSet.delete(e),0===this.disableEditSet.size&&(this.workbench.emit("$editableChanged",this.isEditable),this.toolbarService.setEditable(this.isEditable),this.toolbarService.$forceUpdate(),i.GlobalContext.fire(new g(this)))},e.prototype.disableEditForKey=function(e){var t=this.disableEditSet.size;this.disableEditSet.add(e),0===t&&(this.workbench.emit("$editableChanged",this.isEditable),this.toolbarService.setEditable(this.isEditable),this.toolbarService.$forceUpdate(),i.GlobalContext.fire(new g(this)))},Object.defineProperty(e.prototype,"ownerName",{get:function(){return this.docInfo.ownerName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"docType",{get:function(){return this.docInfo.docType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"createTime",{get:function(){return this.docInfo.createTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isAddedMy",{get:function(){return this.docInfo.isAddedMy},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canAbout",{get:function(){return this.privilege.canAbout},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canAddUser",{get:function(){return this.privilege.canAddUser},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canComment",{get:function(){return this.privilege.canComment},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canCopy",{get:function(){return this.privilege.canCopy||this.isPublish},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canCopyDoc",{get:function(){return this.privilege.canCopyDoc},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canEdit",{get:function(){return!this.isPublish&&!this.isOcrPreview&&this.privilege.canEdit},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canEditTitle",{get:function(){return!this.isPublish&&!this.isOcrPreview&&this.privilege.canEditTitle},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canHistory",{get:function(){return this.privilege.canHistory},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canLinkExp",{get:function(){return this.privilege.canLinkExp},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canPrint",{get:function(){return this.privilege.canPrint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canRead",{get:function(){return this.privilege.canRead||this.isPublish},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canSearch",{get:function(){return this.privilege.canSearch||this.isPublish},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canShare",{get:function(){return this.privilege.canShare},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canSpitSlot",{get:function(){return this.privilege.canSpitSlot},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canTranslate",{get:function(){return this.privilege.canTranslate},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canViewImage",{get:function(){return this.privilege.canViewImage||this.isPublish},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canWatermark",{get:function(){return this.privilege.canWatermark},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isAuth",{get:function(){return this.privilege.isAuth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isBlocked",{get:function(){return this.privilege.isBlocked},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isPreview",{get:function(){return!!Object(h.getUrlParameter)("inToastPreview")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isOcrPreview",{get:function(){return!!Object(h.getUrlParameter)("ocr")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isReadingMode",{get:function(){return"reading"===Object(h.getUrlParameter)("mode")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isEditable",{get:function(){var e=Object(a.c)().isOverConNum||!1;return this.canEdit&&(this.isCreator||!e)&&!this.isPreview&&!this.isReadingMode&&!this.isBlocked&&0===this.disableEditSet.size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isCopyable",{get:function(){var e=Object(a.c)().advPolicy;return!!this.isEditable||!(e&&1===e.view_forbid_copy_print)},enumerable:!0,configurable:!0}),e.DEFAULT_PERMISSION={canAbout:!1,canAddUser:!1,canComment:!1,canCopy:!1,canCopyDoc:!1,canEdit:!1,canEditTitle:!1,canHistory:!1,canLinkExp:!1,canPrint:!1,canRead:!1,canSearch:!1,canShare:!1,canSpitSlot:!1,canTranslate:!1,canViewImage:!1,canWatermark:!1,isAuth:!1,isBlocked:!1},f([Object(u.l)(),m("design:type",u.z)],e.prototype,"toolbarService",void 0),f([Object(u.l)(),m("design:type",u.B)],e.prototype,"workbench",void 0),f([Object(u.l)(),m("design:type",u.f)],e.prototype,"contextService",void 0),e}()},,function(e,t,o){"use strict";o.d(t,"a",(function(){return n}));var n=function(){function e(){}return e.createMessageSeq=function(){return Math.ceil(0x4189374bc6a7f0*Math.random())},e}()},,,,,,,function(e,t,o){"use strict";var n;o.d(t,"a",(function(){return n})),function(e){e.Delete="delete",e.ChangeLanguage="change_language",e.ChangeTheme="change_theme"}(n||(n={}))},function(e,t,o){"use strict";o.d(t,"a",(function(){return r}));var n=o(2),r=function(){function e(){}return e.getInstance=function(){return this.instance||(this.instance=new e),this.instance},e.prototype.clearReplaceUrlPerformanceMetrics=function(){this.templateId=void 0,this.createTS=void 0},e.prototype.setReplaceUrlPerformanceMetrics=function(e,t){e&&(this.createTS=e),t&&(this.templateId=t)},e.prototype.getReplaceUrlPerformanceMetrics=function(){return{createTS:this.createTS,templateId:this.templateId}},e.prototype.setCSID=function(e){e&&(this.csid=e)},e.prototype.getCSID=function(){return this.csid},e.prototype.clearCSID=function(){this.csid=void 0},e.prototype.recordAndStripPerformanceValueFromUrl=function(e){try{var t=Object(n.getParameterFromUrl)(e,"templateId")||void 0,o=Object(n.getParameterFromUrl)(e,"createTS")||void 0,r=Object(n.getParameterFromUrl)(e,"csid")||void 0;this.setReplaceUrlPerformanceMetrics(o,t),this.setCSID(r);var i=Object(n.removeURLParameter)(e,"templateId");return i=Object(n.removeURLParameter)(i,"createTS"),i=Object(n.removeURLParameter)(i,"csid")}catch(t){return n.Logger.error("stripPerformanceValueFromUrl for "+e),e}},e}()},,,,,,function(e,t,o){"use strict";o.d(t,"a",(function(){return p}));var n=o(0),r=o(10),i=o.n(r),a=o(12),s=o(5),c=o(2),l=function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a},u=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},d=function(e,t){var o,n,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},p=function(){function e(){}return e.setTitle=function(e,t,o,r){return h(this,void 0,void 0,(function(){var a,s,l,u,h,p,f=this;return d(this,(function(d){return a=o.domainId,s=void 0===a?o.globalPadId.split("$")[0]:a,l=0,(u=this.workbench.context.collabClient)?l=u.getPadRev():c.Logger.log("there is no collabClient!"),h=this.getTitleReversionFromStore(),this.updateTitleReversion(l),p=c.StringUtil.generateRandomId(),this.storeTitleModifyReq(p,e),[2,new Promise((function(a,c){i.a.ajax({url:"/cgi-bin/online_docs/doc_changetitle",data:{domain_id:s,pad_id:o.padId,title:e,xsrf:Object(n.getXsrf)(),version:2,auto_change:t?1:0,client_cookie:JSON.stringify({isAuto:t,randomId:p,reversion:l})},success:function(n){n&&0===n.retcode?(t||(o.isUserChangeTitle=1),o.padTitle=e,a(n)):n&&10020===n.retcode?(o.isUserChangeTitle=1,f.updateTitleReversion(h),f.storeTitleModifyReq(p,""),c("changeTitle error: ERROR_AUTO_CHANGE_TITLE_DENIED")):n&&12e3===n.retcode?(f.updateTitleReversion(h),f.storeTitleModifyReq(p,""),c("changeTitle error: ERROR_TITLE_BEAT_BY_SEC")):(f.updateTitleReversion(h),f.storeTitleModifyReq(p,""),c("changeTitle error: "+n.retcode)),r&&r(n)},error:function(){c()}})}))]}))}))},e.storeTitleModifyReq=function(e,t){t?c.LocalStorageUtil.setItem("modify_title_"+e,t):c.LocalStorageUtil.removeItem("modify_title_"+e)},e.getTitleModifyReqFromStore=function(e){var t=c.LocalStorageUtil.getItem("modify_title_"+e);return t||null},e.updateTitleReversion=function(e){var t=Object(a.c)();c.LocalStorageUtil.setItem("offline_title_reversion"+t.padId,e.toString())},e.getTitleReversionFromStore=function(){var e=Object(a.c)(),t=c.LocalStorageUtil.getItem("offline_title_reversion"+e.padId);return t?parseInt(t,10):0},e.docHumtrans=function(e){return h(this,void 0,void 0,(function(){var t=this;return d(this,(function(o){return[2,new Promise((function(o,r){i.a.ajax({url:"/cgi-bin/online_docs/doc_humtrans",type:"POST",data:{domain_id:e.domainId,pad_id:e.padId,xsrf:Object(n.getXsrf)()},xhrFields:{withCredentials:!0},success:function(e){0===e.cgicode&&0===e.retcode&&(Object(a.c)().docStatus=0),t.workbench.emit("$humtransDone"),o(e)},error:function(e){r(e)}})}))]}))}))},e.MAX_TITLE_LENGTH=128,l([Object(s.l)(),u("design:type",s.B)],e,"workbench",void 0),e}()},,,,,,function(e,t,o){e.exports={"statusbar-simple-button":"statusbar-simple-button--uD1GK",active:"active--cPBed","small-button":"small-button--mmvUr","statusbar-simple-text":"statusbar-simple-text--3RiNh"}},,,,,,,function(e,t,o){"use strict";o.d(t,"a",(function(){return i}));var n=o(5),r=o(47);function i(e,t){return function(o,i,a){return void 0===a?{get:function(){return n.m.get(r.a).get("custom."+e,t)}}:a}}},,,,,function(e,t,o){"use strict";o.d(t,"f",(function(){return r})),o.d(t,"b",(function(){return s})),o.d(t,"d",(function(){return c})),o.d(t,"c",(function(){return l})),o.d(t,"a",(function(){return u})),o.d(t,"e",(function(){return h}));var n,r,i=o(2),a=(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)});!function(e){e.BEFORE_REPLACE_URL="BEFORE_REPLACE_URL",e.ON_GET_DATA_START="ON_GET_DATA_START",e.ON_DATA_READY="ON_DATA_READY",e.AFTER_REPLACE_URL="AFTER_REPLACE_URL",e.SWITCH_TO_BACKGROUND="SWITCH_TO_BACKGROUND",e.ON_READY="ON_READY"}(r||(r={}));var s=function(e){function t(t){var o=e.call(this,r.BEFORE_REPLACE_URL)||this;return o.secretId=t,o}return a(t,e),t}(i.Notification),c=function(e){function t(t){var o=e.call(this,r.ON_GET_DATA_START)||this;return o.secretId=t,o}return a(t,e),t}(i.Notification),l=function(e){function t(t,o){var n=e.call(this,r.ON_DATA_READY)||this;return n.secretId=t,n.clientVars=o,n}return a(t,e),t}(i.Notification),u=function(e){function t(t){var o=e.call(this,r.AFTER_REPLACE_URL)||this;return o.secretId=t,o}return a(t,e),t}(i.Notification),h=(function(e){function t(){return e.call(this,r.SWITCH_TO_BACKGROUND)||this}a(t,e)}(i.Notification),function(e){function t(){return e.call(this,r.ON_READY)||this}return a(t,e),t}(i.Notification))},,,,function(e,t,o){"use strict";o.d(t,"a",(function(){return a}));var n=o(10),r=o.n(n),i=o(0),a={validUrlRe:new RegExp("^(?:https?|sftp|ftps?|ssh|ircs?|file|gopher|telnet|nntp|worldwind|chrome|chrome-extension|svn|git|mms|smb|afp|nfs|(x-)?man|gopher|txmt)://|^mailto:|^xmpp:|^sips?:|^tel:|^sms:|^news:|^bitcoin:|^magnet:|^urn:|^geo:|^/","i"),escapeHtml:function(e){var t=/[&<>'"]/g;return t.MAP||(t.MAP={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"}),e.replace(t,(function(e){return t.MAP[e]}))},getLength:function(e){for(var t=0,o=0;o<e.length;o++){t+=e.charCodeAt(o)<=255?1:2}return t},splitString:function(e,t){var o="",n=0;if(a.getLength(e)<=t)o=e;else for(var r=0;r<e.length;r++){var i=e.charAt(r);if((n+=e.charCodeAt(r)<=255?1:2)>t){o+="...";break}o+=i}return o},getIsMobile:function(){return-1!==navigator.userAgent.toLowerCase().indexOf("iphone")||-1!==navigator.userAgent.toLowerCase().indexOf("ipad")||-1!==navigator.userAgent.toLowerCase().indexOf("android")||-1!==navigator.userAgent.toLowerCase().indexOf("ipod")},uaDisplay:function(e){var t;function o(e){var t=e.replace(/[^a-zA-Z0-9.]/g,"");return t.length>16&&(t=t.substr(0,16)),t}function n(t){var n=e.match(RegExp(t+"\\/([\\d\\.]+)"));return n&&n.length>1?o(t+n[1]):null}if(n("Firefox"))return n("Firefox");if((t=e.match(/compatible; ([^;]+);/))&&t.length>1)return o(t[1]);if(e.match(/\(iPhone;/))return"iPhone";if(n("Chrome"))return n("Chrome");if(t=e.match(/Safari\/[\d.]+/)){var r="?";return(t=e.match(/Version\/([\d.]+)/))&&t.length>1&&(r=t[1]),o("Safari"+r)}return o(e.split(" ")[0])},binarySearch:function(e,t){if(e<1)return 0;if(t(0))return 0;if(!t(e-1))return e;for(var o=0,n=e-1;n-o>1;){var r=Math.floor((o+n)/2);t(r)?n=r:o=r}return n},simpleDateTime:function(e){var t=new Date(+e);return["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][t.getDay()]+" "+["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()]+" "+t.getDate()+" "+t.getFullYear()+" "+(t.getHours()+":"+("0"+t.getMinutes()).slice(-2))},findURLs:function(e){var t=new RegExp("("+/[-:@a-zA-Z0-9_.,~%+/?=&#;()$]/.source+"|"+/[\u0030-\u0039\u0041-\u005A\u0061-\u007A\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u00FF\u0100-\u1FFF\u3040-\u9FFF\uF900-\uFDFF\uFE70-\uFEFE\uFF10-\uFF19\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFDC]/.source+")"),o=new RegExp(/(?:(?:https?|sftp|ftps?|ssh|ircs?|file|gopher|telnet|nntp|worldwind|chrome|chrome-extension|svn|git|mms|smb|afp|nfs|(x-)?man|gopher|txmt):\/\/|mailto:|xmpp:|sips?:|tel:|sms:|news:|bitcoin:|magnet:|urn:|geo:)/.source+t.source+"*(?![:.,;])"+t.source,"g");return function(e){o.lastIndex=0;for(var t,n=null;t=o.exec(e);){n=n||[];var r=t.index,i=t[0];n.push([r,i])}return n}(e)},isWhitelistUrlScheme:function(e){return a.validUrlRe.test(e)},escapeHtmlWithClickableLinks:function(e,t){var o=0,n=[],r=a.findURLs(e);function i(t){t>o&&(n.push(a.escapeHtml(e.substring(o,t))),o=t)}if(r)for(var s=0;s<r.length;s++){var c=r[s][0],l=r[s][1];i(c),n.push("<a ",t?'target="'+t+'" ':"",'href="',l.replace(/"/g,"&quot;"),'">'),i(c+l.length),n.push("</a>")}return i(e.length),n.join("")},timediff:function(e,t){function o(e,t){var o=Math.round(e);return o+" "+t+(1!==o?"s":"")+" ago"}var n;return(n=Math.max(0,(+new Date-+e-t)/1e3))<60?o(n,"second"):(n/=60)<60?o(n,"minute"):(n/=60)<24?o(n,"hour"):o(n/=24,"day")},makeAnimationScheduler:function(e,t,o){void 0===o&&(o=1);var n=null;return{scheduleAnimation:function r(){n||(n=window.setTimeout((function(){n=null;for(var t=o,i=!0;i&&t>0;)i=e(),t-=1;i&&r()}),t*o))}}},makeShowHideAnimator:function(e,t,o,n){var r,i=t?0:-2,s=1e3/o,c=s/n;return r=a.makeAnimationScheduler((function(){return!(i<-1||0===i)&&(i<0?(i+=c)>=0?(e(i=0),!1):(e(i),!0):i>0?(i+=c)>=1?(e(i=1),i=-2,!1):(e(i),!0):void 0)}),s).scheduleAnimation,{show:function(){e(i=-1),r()},hide:function(){i>=-1&&i<=0&&(i=1e-6,r())},quickShow:function(){i=i<-1?-1:i<=0?i:Math.max(-1,Math.min(0,-i)),e(i),r()}}},_nextActionId:1,uncanceledActions:{},getCancellableAction:function(e,t){var o=a.uncanceledActions[e];o||(o={},a.uncanceledActions[e]=o);var n=a._nextActionId;return a._nextActionId+=1,o[n]=!0,function(){var o=a.uncanceledActions[e];o&&o[n]&&t()}},cancelActions:function(e){a.uncanceledActions[e]&&delete a.uncanceledActions[e]},makeFieldLabeledWhenEmpty:function(e,t){var o=r()(e);function n(){o.addClass("editempty"),o.val(t)}return o.focus((function(){o.hasClass("editempty")&&o.val(""),o.removeClass("editempty")})),o.blur((function(){o.val()||n()})),{clear:n}},getCheckbox:function(e){return r()(e).is(":checked")},setCheckbox:function(e,t){t?r()(e).attr("checked","checked"):r()(e).removeAttr("checked")},bindCheckboxChange:function(e,t){r()(e).bind("click change",t)},encodeUserId:function(e){return e.replace(/[^a-y0-9]/g,(function(e){return"."===e?"-":"z"+e.charCodeAt(0)+"z"}))},decodeUserId:function(e){return e.replace(/[a-y0-9]+|-|z.+?z/g,(function(e){return"-"===e?".":"z"===e.charAt(0)?String.fromCharCode(Number(e.slice(1,-1))):e}))},getQuery:function(e){var t="",o=window.location.search;return o&&(t=o.match(new RegExp("(\\?|&)"+e+"=([^&]*)(#|&|$)"))),t?decodeURIComponent(t[2]):""},getEnvParam:function(e){return void 0===e&&(e=""),e+"route_ip="+a.getQuery("route_ip")+"&room_route_ip="+a.getQuery("room_route_ip")},addFromParam:function(e,t){var o=e;return o.indexOf("route_ip")>=0&&t.indexOf("route_ip")>=0||(o.indexOf("?")>=0?o+="&"+t:o+="?"+t),o},checkIsQQTim:function(){var e=navigator.userAgent;return!(!e.match(/QQ/i)&&!e.match(/TIM/i))},checkIsQQ:function(){return!!navigator.userAgent.match(/QQ/i)},checkIsTim:function(){return!!navigator.userAgent.match(/TIM/i)},applyAuthStatus:null,authApply:function(e){if(void 0!==window.PermitApply){var t=window.PermitApply,o=window.clientVars;t.permitApply(null==o?void 0:o.padType,null,e),i.ReportHelper.tdwReport({opername:"doc_author",module:"edit",action:"clk_apply"})}},checkIsApplyIn24H:function(e){var t=window.clientVars;r.a.ajax({url:"/cgi-bin/online_docs/auth_apply/check",xhrFields:{withCredentials:!0},data:{bkn:a.getBkn(),domainId:null==t?void 0:t.domainId,localPadId:null==t?void 0:t.localPadId,xsrf:Object(i.getXsrf)()},success:function(t){t&&e({apply:10003===t.retcode||10004===t.retcode,pass:"1"===String(t.pass),nopass:"0"===String(t.pass)})},error:function(){e({apply:!1})}})},getBkn:function(){var e=Object(i.getCookie)("skey"),t=5381;if(e){for(var o=0,n=e.length;n>o;++o)t+=(t<<5)+e.charAt(o).charCodeAt(0);return 2147483647&t}},checkIsIphoneX:function(){return!(!navigator.userAgent.match(/(iPhone)/)||!(812===screen.availHeight&&375===screen.availWidth||375===screen.availHeight&&812===screen.availWidth||375===screen.width&&812===screen.height||812===screen.width&&375===screen.height))},isPortrait:function(){if("number"==typeof window.orientation)return window.orientation/90%2==0;try{return window.screen.orientation.angle/90%2==0}catch(e){}return!0},getClientVersion:function(){var e=navigator.userAgent,t=a.getVersion(e,/\sTencentDocs\/\d+\.\d+\.\d+\.\d+/i),o=t?null:a.getVersion(e,/\sTIM.{0,5}\d+\.\d+\.\d+\.\d+/i),n=null;if(!t&&!o){var r=window.mqq;n=r&&r.clientVersion>"0"?r.clientVersion:null}return{app_version:t,tim_version:o,qq_version:n,h5:!t&&!o&&!n}},getScrollLeft:function(e,t){return(t||e&&isNaN(e.scrollLeftCache))&&(e.scrollLeftCache=a.calculateScrollLeft(e)),e?e.scrollLeftCache:0},getScrollTop:function(e,t){return(t||e&&isNaN(e.scrollTopCache))&&(e.scrollTopCache=a.calculateScrollTop(e)),e?e.scrollTopCache:0},calculateScrollLeft:function(e){if(e===window)return a.getWindowScrollLeft();var t=null;return e.mainScroll&&(t=-e.mainScroll.x),"number"==typeof t?t:e.scrollLeft-r()("#padeditor")[0].offsetLeft},calculateScrollTop:function(e){if(e===window)return a.getWindowScrollTop();var t=null;return e.mainScroll&&(t=-e.mainScroll.y),"number"==typeof t?t:e.scrollTop},getWindowScrollTop:function(){var e=window.scrollY;return void 0===e&&(e=document.documentElement.scrollTop),e},getWindowScrollLeft:function(){var e=window.scrollX;return void 0===e&&(e=document.documentElement.scrollLeft),e},scrollLeft:function(e,t){if(e===window)window.scrollTo(t,a.getWindowScrollTop());else if(e.mainScroll&&e.mainScroll.scrollVirtual){var o=t>=0?t:0;e.mainScroll.scrollVirtual(-o)}else e.scrollLeft=t,e.scrollLeftCache=t},scrollTop:function(e,t){if(e===window)window.scrollTo(a.getWindowScrollLeft(),t);else if(e.mainScroll&&e.mainScroll.scrollVirtual){var o=t>=0?t:0;e.mainScroll.scrollVirtual(null,-o)}else e.scrollTop=t},countNodes:function(e){var t=0;if(e){1===e.nodeType&&(t+=1);var o=0;if(e.childNodes){o=e.childNodes.length;for(var n=0;n<o;n++)t+=a.countNodes(e.childNodes[n])}}return t},getIOSVersion:function(){if(/iP(hone|od|ad)/.test(navigator.platform)){var e=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);return[parseInt(e[1],10),parseInt(e[2],10),parseInt(e[3]||"0",10)]}return[]},getVersion:function(e,t){try{return t.exec(e)[0].split("/")[1]}catch(e){return null}},updateQueryStringParameter:function(e,t){var o=e;return t&&Object.keys(t).forEach((function(e){var n=t[e],r=new RegExp("([?&])"+e+"=.*?(&|$)","i"),i=-1!==o.indexOf("?")?"&":"?";o=o.match(r)?o.replace(r,"$1"+e+"="+n+"$2"):o+i+e+"="+n})),o},checkIfAccountSwitched:function(e){var t=window.clientVars,o=t.userInfo,n=t.userType,r=Object(i.getCookie)("utype"),a=t&&t.uidKey,s=Object(i.getCookie)("uid_key");if(t.isLogin&&!o)return!1;if(!o||!o.uin&&!o.toid&&!o.uid)return!!Object(i.hasLoginCookie)();if(!Object(i.hasLoginCookie)())return!1;var c=null;o.tinyid&&(c=o.tinyid);var l=Object(i.getCookie)("uid");if(c&&l){if(c!==l)return!0;if(n&&r){if(n!==r)return!0;if("reLoginForPskeyError"===e&&a&&s&&a!==s)return!0}}else console.error("core-doc("+e+") check oUid = "+c+", nUid = "+l);return!1}}},,,,,,,,function(e,t,o){"use strict";var n;o.d(t,"a",(function(){return n})),function(e){e.NORMAL="isNormal",e.PUBLISH="isPublish",e.PREVIEW="isPreview",e.MINIMAL="isMinimal"}(n||(n={}))},function(e,t,o){"use strict";o.d(t,"a",(function(){return s}));var n=o(0),r=o(100),i=function(e,t){var o="function"==typeof Symbol&&e[Symbol.iterator];if(!o)return e;var n,r,i=o.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(e){r={error:e}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a},a=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e},s=function(){function e(){this.hasDownloadImgs=0,this.currentDocImages=0,this.printStatus=!1,this.loadErrorImages=0,this.loadSuccessImages=0,this.initalImages=0}return e.getInstance=function(t){return this.editor=t,this.instance||(this.instance=new e),this.instance},e.prototype.isLoadOn=function(){var t=e.getInstance(e.editor);return!!(this.currentDocImages<=this.hasDownloadImgs&&t.isPrinting()&&0!==this.hasDownloadImgs)&&(t.finishPrinting(),e.editor.fire(new r.a(r.b.FINISH_IMAGE_LOAD)),!0)},e.loadSuccess=function(t){var o=e.getInstance(t);!o.isPrinting()||(o.addLoadSuccessRecord(),o.isLoadOn())},e.loadError=function(t){var o=e.getInstance(t);!o.isPrinting()||(o.addLoadErrorRecord(),o.isLoadOn())},e.prototype.clear=function(){this.loadErrorImages=0,this.loadSuccessImages=0},Object.defineProperty(e.prototype,"loadErrorRecords",{get:function(){return this.loadErrorImages},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loadSuccessRecords",{get:function(){return this.loadSuccessImages},enumerable:!0,configurable:!0}),e.prototype.addLoadErrorRecord=function(){this.loadErrorImages+=1,this.hasDownloadImgs+=1},e.prototype.addLoadSuccessRecord=function(){this.hasDownloadImgs+=1,this.loadSuccessImages+=1},Object.defineProperty(e.prototype,"getHasDownloadImgs",{get:function(){return this.hasDownloadImgs},enumerable:!0,configurable:!0}),e.prototype.isPrinting=function(){return this.printStatus&&this.currentDocImages>0},e.prototype.startPrinting=function(t){this.hasDownloadImgs=0,this.printStatus=!0,this.initalImages=t,this.hasDownloadImgs+=t,this.currentDocImages=e.getAllImages(e.editor)},e.prototype.finishPrinting=function(){this.hasDownloadImgs=0,this.printStatus=!1},e.prototype.testMockCurrentImages=function(e){this.currentDocImages=e},e.getAllImageUrl=function(e){var t=[],o=e.service.getDocument().getInlineShapes(n.DrawingType.Image);return a(o).forEach((function(e){if(e){var o=e.getAnchorId(),n=e.getAnchorId()?e.getAnchorId():"";t.push([o,n])}})),t},e.getAllImages=function(e){return e.service.getDocument().getInlineShapes(n.DrawingType.Image).count()},e.getInitImageCount=function(){return document.getElementsByClassName("image-wrapper").length},e}()},,,function(e,t,o){"use strict";o.d(t,"b",(function(){return a})),o.d(t,"a",(function(){return s}));var n=o(4),r=o(0),i=o(2);function a(e,t,o,r,i){var a=t.changeset;return a?(t.changeset=n.Changeset.follow(e,a,o,r,i),n.Changeset.follow(a,e,!o,r,i)):e}function s(e,t,o,a,s){i.Logger.info("checkChangeset:"+e);var c=new Date,l=null,u=null,h=null,d=0;function p(){if(null===l&&null===u&&null===h)for(var e=n.Changeset.opIterator(o.attribs),t=n.Changeset.stringIterator(o.text),i=0,s=function(){var o=e.next(),s=t.take(o.chars);if(s===r.PlaceholderChar.StoryEnd||s===r.PlaceholderChar.StoryBegin||s===r.PlaceholderChar.StoryBegin+r.PlaceholderChar.StoryEnd){var c="";if(n.Changeset.eachAttribNumber(o.attribs,(function(e){var t=a.getAttrib(e);t&&"flowid"===t[0]&&(c=t[1])})),c===r.StoryID.MainDocId&&s===r.PlaceholderChar.StoryEnd)l=i;else if(c===r.StoryID.ListTemplateId)if(s===r.PlaceholderChar.StoryBegin)u=i;else{if(s===r.PlaceholderChar.StoryEnd)return h=i,"break";if(s===r.PlaceholderChar.StoryBegin+r.PlaceholderChar.StoryEnd)return u=i,h=i+1,"break"}}i+=o.chars};e.hasNext();){if("break"===s())break}}function f(t,i){var a=i+"\n                rev:"+s+"\n                atext:"+JSON.stringify(o.text.substr(-10))+"\n                alen:"+o.text.length+"\n                CS:"+JSON.stringify(e)+"\n                ErrorOP:"+n.Changeset.opString(t),c=new Error;c.name=r.MonitorName.CHANGESET_ERROR_VERIFY,c.message="reason: "+a,r.ReportHelper.captureChangesetException(r.MonitorName.CHANGESET_ERROR_VERIFY,{option:{}},c)}function m(e,t){if(e.indexOf(r.PlaceholderChar.StoryBegin)>=0||e.indexOf(r.PlaceholderChar.StoryEnd)>=0||e.indexOf(r.PlaceholderChar.SectionBreak)>=0){p();for(var o=e.indexOf(r.PlaceholderChar.StoryEnd);o>=0;){if(l&&l===d+o)return f(t,"正文结束符不可删除"),!1;o=e.indexOf(r.PlaceholderChar.StoryEnd,o+1)}for(o=e.indexOf(r.PlaceholderChar.SectionBreak);o>=0;){if(l&&l-1===d+o)return f(t,"正文最后的分节符不可删除"),!1;o=e.indexOf(r.PlaceholderChar.SectionBreak,o+1)}}return!0}function g(e,t){if(e.indexOf(r.PlaceholderChar.StoryBegin)>=0||e.indexOf(r.PlaceholderChar.StoryEnd)>=0){if(o.text.indexOf(r.PlaceholderChar.StoryEnd)>=0&&o.text.charAt(d-1)!==r.PlaceholderChar.StoryEnd)return f(t,"子流插入的位置错误, currentPos:"+d),!1}else p(),null!==u&&null!==h&&u<d&&d<=h&&""!==e.replace(/\n/g,"")&&f(t,"文本不能插入模版子流，currentPos:"+d);return!0}var b=n.Changeset.unpack(t);if(!b)return!0;if(b.oldLen!==o.text.length)return f(n.Changeset.newOp(),"oldLen error: "+b.oldLen+" !== "+o.text.length),!1;for(var y=n.Changeset.stringIterator(b.charBank),v=n.Changeset.stringIterator(o.text),C=n.Changeset.opIterator(b.opsStr);C.hasNext();){var _=C.next();switch(_.opcode){case"=":v.take(_.chars),d+=_.chars;break;case"-":if(!m(v.take(_.chars),_))return!1;d+=_.chars;break;case"+":if(!g(y.take(_.chars),_))return!1}}var w=new Date;return i.Logger.info("checkChangeset success:"+e+"\nTimCost:"+(w.getTime()-c.getTime())+"ms \nlastRev:"+s),!0}},,function(e,t,o){"use strict";o.d(t,"a",(function(){return n})),o.d(t,"b",(function(){return r}));var n="add_bridge",r="add_deferred_bridge"},function(e,t,o){"use strict";o.d(t,"b",(function(){return r})),o.d(t,"a",(function(){return s}));var n,r,i=o(2),a=(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)});!function(e){e.TextframeDelete="TextframeDelete"}(r||(r={}));var s=function(e){function t(t){var o=e.call(this,r.TextframeDelete)||this;return o.changeData={property:t},o}return a(t,e),t}(i.Notification)},,function(e,t,o){"use strict";o.d(t,"b",(function(){return oe})),o.d(t,"a",(function(){return ne}));var n,r=o(1),i=o.n(r),a=o(0),s=o(42),c=o.n(s),l=[{index:1,name:"Plain Text",isSelected:!1},{index:2,name:"C",isSelected:!1},{index:3,name:"C++",isSelected:!1},{index:4,name:"CSS",isSelected:!1},{index:5,name:"C#",isSelected:!1},{index:6,name:"Dart",isSelected:!1},{index:7,name:"Erlang",isSelected:!1},{index:8,name:"Go",isSelected:!1},{index:9,name:"HTML",isSelected:!1},{index:10,name:"Java",isSelected:!1},{index:11,name:"JavaScript",isSelected:!1},{index:12,name:"JSX",isSelected:!1},{index:13,name:"Lua",isSelected:!1},{index:14,name:"Markdown",isSelected:!1},{index:15,name:"Nginx",isSelected:!1},{index:16,name:"Objective-C",isSelected:!1},{index:17,name:"Perl",isSelected:!1},{index:18,name:"PHP",isSelected:!1},{index:19,name:"PowerShell",isSelected:!1},{index:20,name:"ProtoBuf",isSelected:!1},{index:21,name:"Python",isSelected:!1},{index:22,name:"Ruby",isSelected:!1},{index:23,name:"Shell",isSelected:!1},{index:24,name:"SQL",isSelected:!1},{index:25,name:"Swift",isSelected:!1},{index:26,name:"TypeScript",isSelected:!1},{index:27,name:"VB.NET",isSelected:!1},{index:28,name:"VUE",isSelected:!1},{index:29,name:"XML",isSelected:!1}];o(224);!function(e){e[e.Seperator=0]="Seperator",e[e.ImageButton=1]="ImageButton",e[e.DropdownButton=2]="DropdownButton"}(n||(n={}));var u,h,d=o(35),p=o.n(d),f=(u=function(e,t){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}u(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),m=function(e){function t(t){var o=e.call(this,t)||this;return o.onMouseUp=function(e){o.props.onClickCallback(e,o.props.id,o.props.type)},o}return f(t,e),t.prototype.render=function(){var e=this.props.title||"",t=c()("st-button",this.props.icon);return i.a.createElement(p.a,{placement:"top",title:this.props.tips||e},i.a.createElement("div",{className:t,onMouseUp:this.onMouseUp.bind(this)},e))},t}(i.a.Component),g=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),b=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return g(t,e),t.prototype.render=function(){return i.a.createElement("div",{className:"st-separator"})},t}(i.a.Component),y=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),v=function(e){function t(t){var o=e.call(this,t)||this;return o.onMouseUp=function(e){o.props.onSeletedItemCallback(e,o.props.item),e.preventDefault(),e.stopPropagation()},o}return y(t,e),t.prototype.render=function(){var e=c()({"st-dropdown-item":!0,"st-dropdown-item-selected":this.props.item.isSelected});return i.a.createElement("li",{className:e,onMouseUp:this.onMouseUp.bind(this)},this.props.item.name&&this.props.item.name.length>0?i.a.createElement("div",{className:"st-dropdown-item-content"},this.props.item.name):"")},t}(i.a.Component),C=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),_=function(e){function t(t){var o=e.call(this,t)||this;return o.listRef=i.a.createRef(),o.handleSeletedItem=function(e,t){t&&(o.updateSelectedItem(t.index),o.props.onSeletedItemCallback(e,t))},o.updateSelectedItem=function(e){o.props.items.forEach((function(t){t&&(t.isSelected=t.index===e)}))},o.componentDidMount=function(){if(o.props.autoScroll){for(var e=0,t=0;t<o.props.items.length;t++){if(o.props.items[t].isSelected){e=t;break}}o.listRef&&o.listRef.current&&(o.listRef.current.scrollTo?o.listRef.current.scrollTo(0,32*e):(o.listRef.current.scrollLeft=0,o.listRef.current.scrollTop=32*e))}},o}return C(t,e),t.prototype.render=function(){var e=this;return i.a.createElement("div",{className:"st-dropdown-menu"},i.a.createElement("div",{className:"st-dropdown-menu-listbox",ref:this.listRef},this.props.items.map((function(t){return t.index&&t.name?i.a.createElement(v,{key:t.index,item:t,onSeletedItemCallback:e.handleSeletedItem.bind(e)}):null}))))},t}(i.a.Component),w=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),S=function(e){function t(t){var o=e.call(this,t)||this;return o.onMouseUp=function(e){o.props.onClickCallback(e,o.props.id,o.props.type)},o.handleSelectItemCallback=function(e,t){t&&o.props.onSeletedItemCallback(e,o.props.id,o.props.type,t)},o}return w(t,e),t.prototype.render=function(){var e=this.props.title||"";return i.a.createElement("div",{className:"st-dropdown-button-container"},i.a.createElement("div",{className:"st-dropdown-button-wrapper",onMouseUp:this.onMouseUp.bind(this)},i.a.createElement("div",{className:"st-dropdown-button"},e),i.a.createElement("div",{className:"st-menu-button-dropdown"})),this.props.extend?i.a.createElement("div",{className:"st-dropdown-menu-wrapper"},i.a.createElement(_,{items:this.props.items,onSeletedItemCallback:this.handleSelectItemCallback.bind(this),autoScroll:this.props.autoScroll})):"")},t}(i.a.Component),E=o(2),T=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),R=function(e){function t(t){var o=e.call(this,t)||this;return o.state={extendId:"",buttons:o.props.buttons},o}return T(t,e),t.prototype.render=function(){var e=this,t={left:this.props.posX,top:this.props.posY};return this.props.visible&&this.props.buttons.length>0?i.a.createElement("span",{className:"suspend-toolbar",style:t,onMouseDown:this.onMouseDown.bind(this),onMouseMove:this.onMouseMove.bind(this),onMouseUp:this.onMouseUp.bind(this),onMouseEnter:this.props.onMouseEnter,onMouseLeave:this.props.onMouseLeave},this.state.buttons.map((function(t){if(!t.show||t.show()){if(t.type===n.ImageButton&&t.config)return i.a.createElement(m,{key:t.id,id:t.id,type:t.type,tips:t.config.tips,title:t.config.title,icon:t.config.icon,onClickCallback:e.onClickCallback.bind(e)});if(t.type===n.DropdownButton&&t.config)return i.a.createElement(S,{key:t.id,id:t.id,type:t.type,tips:t.config.tips,title:t.config.title,extend:e.state.extendId===t.id,items:t.config.items?t.config.items:[],autoScroll:t.config.autoScroll,onClickCallback:e.onClickCallback.bind(e),onSeletedItemCallback:e.onSeletedItemCallback.bind(e)});if(t.type===n.Seperator)return i.a.createElement(b,{key:t.id})}return""}))):""},t.prototype.showDropdown=function(e){this.state.extendId!==e&&this.setState({extendId:e})},t.prototype.hideDropdown=function(){this.setState({extendId:""})},t.prototype.onClickCallback=function(e,t,o){o===n.DropdownButton&&t!==this.state.extendId?this.setState({extendId:t}):this.setState({extendId:""}),this.props.onClickCallback(e,t,o)},t.prototype.onSeletedItemCallback=function(e,t,o,n){this.updateDropdownButton(t,o,n),this.props.onSeletedItemCallback(e,t,o,n)},t.prototype.handlerMouseEvent=function(e){e.stopPropagation(),e.preventDefault()},t.prototype.onMouseDown=function(e){this.handlerMouseEvent(e)},t.prototype.onMouseUp=function(e){this.handlerMouseEvent(e)},t.prototype.onMouseMove=function(e){this.handlerMouseEvent(e)},t.prototype.updateDropdownButton=function(e,t,o,n){void 0===n&&(n="");for(var r=Object(E.deepClone)(this.state.buttons),i=0;i<r.length;i++){var a=r[i];if(a.id===e&&a.type===t&&a.config){a.config.title=o.name,!0;break}}this.setState({buttons:r,extendId:n})},t}(i.a.Component);!function(e){e.Copy="copy",e.Delete="delete",e.Language="language",e.Theme="theme"}(h||(h={}));var I=o(7),O=o(88),P=o.n(O),k=function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},N=function(e,t){var o,n,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},M=function(){function e(){}return e.tokenize=function(e,t,o){return void 0===o&&(o="base_char"),k(this,void 0,void 0,(function(){var n,r,i,a;return N(this,(function(s){return n=+new Date,r=P.a.languages[t]||P.a.languages.javascript,i=P.a.tokenize(e,r),a=+new Date,E.Logger.info("[codeblock]tokenize cost: "+(a-n)+" ms"),[2,this.tokenToOperation(i,o)]}))}))},e.tokenToOperation=function(e,t){var o=0,n=[];return e.forEach((function(e){var r="",i="";"string"==typeof e?(r=t,i=e):(r=e.type,i=e.content),n.push({type:r,content:i,start:o,length:e.length}),o+=e.length})),n},e}(),D=function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},x=function(e,t){var o,n,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};function A(e,t,o,n){return D(this,void 0,void 0,(function(){var r;return x(this,(function(i){switch(i.label){case 0:return[4,M.tokenize(t,o.toLowerCase(),I.a.ThemeCharacter)];case 1:return(r=i.sent()).map((function(t){t.type!==I.a.BaseCharacter&&t.type!==I.a.BaseParagraph&&(t.type=e.getThemeStyleName(n,t.type))})),[2,r]}}))}))}function L(e,t,o,n,r,i,a){return D(this,void 0,void 0,(function(){var s,c;return x(this,(function(l){switch(l.label){case 0:return"plain text"!==r?[3,1]:(s=t.getThemeStyleName(i,I.a.ThemeParagraph),e.getTextFrame().setTextFrameParaStyle(o,s,!0),[3,3]);case 1:return[4,A(t,n,r,i)];case 2:c=l.sent(),e.getTextFrame().setTextFrameSpansStyle(o,c,a),l.label=3;case 3:return[2]}}))}))}var F=o(61),B=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),U=function(e){function t(t){var o=e.call(this,t)||this;return o.toolbar=i.a.createRef(),o.handleCopyCodeblock=function(){E.Logger.info("[codeblock]toolbar copy codeblock, id: "+o.state.property.anchorId);var e=o.props.editor.viewSelection.gcpRange,t=o.gcpRange();o.props.editor.service.getSelection().setRange(t.begin(),t.end()),o.props.editor.clipboardManager.copy(),o.props.editor.service.getSelection().setRange(e.begin(),e.end()),a.ReportHelper.tdwReport({opername:"doc_word_editor",module:"layer_copy",action:"code_block"})},o.handleDeleteCodeblock=function(){E.Logger.info("[codeblock]toolbar delete codeblock, id: "+o.state.property.anchorId),o.props.bridge&&o.props.bridge.instance.sendAction(o.props.bridge.key,{type:F.a.Delete,data:{anchorId:o.state.property.anchorId}}),a.ReportHelper.tdwReport({opername:"doc_word_editor",module:"layer_del",action:"code_block"})},o.handleLanguageChanged=function(e,t){var n=o.gcpRange(),r=o.state.property,i=r.anchorId,a=r.theme,s=o.state.property.language,c=t.name.toLowerCase();if(c!==s&&o.props.bridge){o.props.bridge.instance.sendAction(o.props.bridge.key,{type:F.a.ChangeLanguage,data:{anchorId:i,gcpRange:n,language:c}});var l=o.props.editor.service.getDocument().findContentFromId(i);L(o.props.editor.service,o.themeManager,i,l,c,a,0),E.Logger.info("[codeblock]toolbar change language, oLanguage: "+s+", nLanguage: "+c)}},o.handleThemeChanged=function(e,t){var n=o.gcpRange(),r=o.state.property,i=r.anchorId,a=r.language,s=o.state.property.theme,c=t.name.toLowerCase();if(c!==s&&o.props.bridge){o.props.bridge.instance.sendAction(o.props.bridge.key,{type:F.a.ChangeTheme,data:{anchorId:i,gcpRange:n,theme:c}});var l=o.props.editor.service.getDocument().findContentFromId(i);L(o.props.editor.service,o.themeManager,i,l,a,c,0),E.Logger.info("[codeblock]toolbar change theme, oTheme: "+s+", nTheme: "+c)}},o.state={posX:t.posX,posY:t.posY,visible:!0,property:o.props.property},o.themeManager=o.props.themeManager,o.buttons=o.initButtons(),o}return B(t,e),t.prototype.initButtons=function(){var e=Object(E.deepClone)(l),t=Object(E.deepClone)(this.themeManager.getThemeListData()),o=this.prepareDefaultItems(e,this.state.property.language),r=this.prepareDefaultItems(t,this.state.property.theme);return function(e,t,o,r){var i=0;return[{id:h.Language,type:n.DropdownButton,config:{title:t,items:e,autoScroll:!0}},{id:"seperator-"+i++,type:n.Seperator},{id:h.Copy,type:n.ImageButton,config:{tips:"复制",icon:"st-button-copy"}},{id:"seperator-"+i++,type:n.Seperator},{id:h.Delete,type:n.ImageButton,config:{tips:"删除",icon:"st-button-delete"}}]}(o.items,o.value,r.items,r.value)},t.prototype.prepareDefaultItems=function(e,t){for(var o=t,n=0;n<e.length;n++){var r=e[n];r.name.toLowerCase()===t.toLowerCase()?(r.isSelected=!0,o=r.name):r.isSelected=!1}return{items:e,value:o}},t.prototype.showToolbar=function(e,t,o){this.setState({visible:!0,posX:t,posY:o,property:e})},t.prototype.hideToolbar=function(){this.setState({visible:!1}),this.toolbar&&this.toolbar.current&&this.toolbar.current.hideDropdown()},t.prototype.showDropdown=function(e){this.toolbar&&this.toolbar.current&&this.toolbar.current.showDropdown(e)},t.prototype.hideDropdown=function(){this.toolbar&&this.toolbar.current&&this.toolbar.current.hideDropdown()},t.prototype.gcpRange=function(){return this.props.editor.getRangeFromIndex(this.props.layoutBox.firstIndex,this.props.layoutBox.lastIndex)},t.prototype.onClickCallback=function(e,t,o){switch(t){case h.Copy:this.handleCopyCodeblock();break;case h.Delete:this.handleDeleteCodeblock()}},t.prototype.onSeletedItemCallback=function(e,t,o,n){switch(t){case h.Language:this.handleLanguageChanged(e,n);break;case h.Theme:this.handleThemeChanged(e,n)}this.props.onMouseLeave(e)},t.prototype.render=function(){return i.a.createElement(R,{ref:this.toolbar,visible:this.state.visible,buttons:this.buttons,posX:this.state.posX,posY:this.state.posY,onClickCallback:this.onClickCallback.bind(this),onSeletedItemCallback:this.onSeletedItemCallback.bind(this),onMouseEnter:this.props.onMouseEnter,onMouseLeave:this.props.onMouseLeave})},t}(i.a.Component),j=(o(223),o(225),function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}()),G=function(e){function t(t){return e.call(this,t)||this}return j(t,e),t.prototype._stringForIndex=function(e){return String(e)},t.prototype._prepareNumberItem=function(e){for(var t=[],o=0;o<e;o++)t.push({index:o,number:this._stringForIndex(o+1)});return t},t.prototype.render=function(){var e=this,t=this._prepareNumberItem(this.props.lines);return i.a.createElement("div",{className:"melo-codeblock-linenumber",style:this.props.style},t.map((function(t,o){var n=e.props.heightForIndex?e.props.heightForIndex(o):{height:23.94,lineHeight:23.94},r=n.height,a=n.lineHeight;return i.a.createElement("div",{key:o,className:"melo-codeblock-linenumber-item",style:{height:r,fontSize:e.props.themeInfo.fontSize,fontFamily:e.props.themeInfo.fontFamily,color:e.props.themeInfo.fontColor,lineHeight:a+1+"px"}},t.number)})))},t}(i.a.Component),H=o(150),V=o(105),W=o(5),Q=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),q=function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a},Y=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},J=(Object(a.getScrollerWidth)(),Object(a.getScrollerHeight)()),z=function(e){function t(t){var o=e.call(this,t)||this;return o.scrolling=!1,o.scrollerRef=i.a.createRef(),o.toolbarRef=i.a.createRef(),o.toolbarContainer=null,o.isMouseInside=!1,o.codeblockState=H.a.getInstance(),o.highlightCodeblockThrottle=Object(E.throttle)((function(e,t,n,r,i){L(o.editor.service,o.themeManager,e,t,n,r,i)}),500),o.onScroll=function(){o.scrolling||(o.props.editor.fire(new a.FocusBlurNotification(a.FocusBlurNotificationType.REQUEST_BLUR,{from:a.From.TABLE_SCROLL})),o.scrolling=!0),o.scrollTimeoutId&&clearTimeout(o.scrollTimeoutId),o.scrollTimeoutId=setTimeout((function(){o.scrolling=!1;var e=o.editor.viewSelection.getViewRange();e&&(e.start.clearCache(),e.end.clearCache(),o.props.editor.fire(new a.FocusBlurNotification(a.FocusBlurNotificationType.REQUEST_FOCUS,{viewRange:e,from:a.From.TABLE_SCROLL})))}),500)},o.needShowToolbar=function(){var e=o.editor.service.getSelection().storyType();return e===a.TDStoryType.MainTextStory||e===a.TDStoryType.CodeblockStory},o.onMouseDown=function(){o.toolbarRef&&o.toolbarRef.current&&o.toolbarRef.current.hideDropdown()},o.renderToolbarDom=function(e,t){if(o.editor&&(o.editor.view.getDom()&&!document.getElementById("melo-codeblock-toolbar-container"))){var n=o.codeblockProp();o.widgetService.embed({name:"melo-codeblock-toolbar-container",component:i.a.createElement(U,{key:n.anchorId,ref:o.toolbarRef,property:n,editor:o.props.editor,bridge:o.props.bridge,themeManager:o.themeManager,layoutBox:o.props.layoutBox,onMouseEnter:o.onMouseEnterToolbar,onMouseLeave:o.onMouseLeaveToolbar,posX:e,posY:t})})}},o.onMouseEnter=function(){if(o.editor.isEditable()&&o.needShowToolbar()){var e=a.LayoutUtil.getOffsetPoint(o.props.layoutBox,a.BoxKind.Document),t=Object(E.twipsToPx)(e.x)+8,n=Object(E.twipsToPx)(e.y)-32;o.toolbarRef&&o.toolbarRef.current?o.toolbarRef.current.showToolbar(o.codeblockProp(),t,n):o.renderToolbarDom(t,n),o.isMouseInside=!0}},o.onMouseLeave=function(){o.isMouseInside=!1,window.setTimeout((function(){o.isMouseInside||o.hideToolbar()}),500)},o.onMouseEnterToolbar=function(){o.isMouseInside=!0},o.onMouseLeaveToolbar=function(){o.onMouseLeave()},o.hideToolbar=function(){o.toolbarRef&&o.toolbarRef.current&&o.toolbarRef.current.state.visible&&o.toolbarRef.current.hideToolbar()},o.editor=o.props.editor,o.themeManager=o.props.themeManager,o.state={enableLineNumber:!0,isSelected:!1},o}return Q(t,e),t.prototype.gcpRange=function(){return this.editor.getRangeFromIndex(this.props.layoutBox.firstIndex,this.props.layoutBox.lastIndex)},t.prototype.codeblockProp=function(){return this.props.layoutBox.property},t.prototype.stateKey=function(e){return this.editor.uuid+"-"+e},t.prototype.lineNumber=function(){var e=-1,t=this.codeblockProp().anchorId,o=this.stateKey(t);return this.codeblockState.getCachedLineNumById(o)>=0&&(e=this.codeblockState.getCachedLineNumById(o))>=0||(e=this.editor.service.getDocument().getLineNumber(t),this.codeblockState.updateLineNumCache(o,e)),e},t.prototype.heightForIndex=function(e){var t=0,o=0,n=this.props.layoutBox.content.children[e];return n&&(t=Object(E.twipsToPx)(n.rect.height),o=n.children&&n.children.length>0?Object(E.twipsToPx)(n.children[0].rect.height):t),{height:t,lineHeight:o}},t.prototype.componentDidMount=function(){this.attachBox(),this.registerNotification();var e=this.codeblockProp(),t=e.anchorId,o=e.language,n=e.theme,r=this.editor.service.getDocument().findContentFromId(t),i=this.stateKey(t);this.codeblockState.getCachedContentLengthById(i)!==r.length&&(this.highlightCodeblockThrottle(t,r,o,n,0),this.codeblockState.updateContentLengthCache(i,r.length))},t.prototype.detachBox=function(){this.scrollerRef&&(this.props.layoutBox.__node__=null)},t.prototype.componentWillUnmount=function(){this.detachBox(),this.unregisterNotification(),this.hideToolbar()},t.prototype.componentDidUpdate=function(){this.attachBox()},t.prototype.attachBox=function(){this.scrollerRef&&(this.props.layoutBox.__node__=this.scrollerRef.current)},t.prototype.registerNotification=function(){var e=this;this.editor.on(a.StateNotification.ModelChange,(function(t){var o=t.changeData;if(o.dirtyRangeMap){var n=o.dirtyRangeMap.get(e.codeblockProp().anchorId);if(n){var r=e.codeblockProp().anchorId,i=e.editor.service.getDocument().findContentFromId(r),a=e.stateKey(r);if("plain text"!==e.codeblockProp().language&&e.codeblockState.getCachedContentLengthById(a)!==i.length){e.codeblockState.updateContentLengthCache(a,i.length);var s=e.editor.service.getDocument().findStoryRangeFromId(r),c=e.editor.service.getDocument().getParamInfoFromGcpRange(n.unionValue),l=c.range.begin()-s.begin();e.highlightCodeblockThrottle(r,c.content,e.codeblockProp().language,e.codeblockProp().theme,l)}}}}),this),this.editor.on(V.b.TextframeDelete,(function(t){var o=t.changeData.property;o.anchorId===e.codeblockProp().anchorId?e.state.isSelected?(E.Logger.info("[codeblock]backspace key event, delete codeblock: "+o.anchorId),e.props.bridge&&e.props.bridge.instance.sendAction(e.props.bridge.key,{type:F.a.Delete,data:{anchorId:o.anchorId}}),e.setState({isSelected:!1})):(E.Logger.info("[codeblock]backspace key event, select codeblock: "+o.anchorId),e.setState({isSelected:!0})):e.state.isSelected&&e.setState({isSelected:!1})}),this),this.editor.on(a.RenderNotificationTypes.SELECTION_CHANGE,(function(){e.state.isSelected&&(E.Logger.info("[codeblock]backspace key event, cancle select codeblock: "+e.codeblockProp().anchorId),e.setState({isSelected:!1}))}),this)},t.prototype.unregisterNotification=function(){this.editor.removeListener(a.RenderNotificationTypes.SELECTION_CHANGE,this),this.editor.removeListener(a.StateNotification.ModelChange,this),this.editor.removeListener(V.b.TextframeDelete,this)},t.prototype.getRootWrapperStyleProps=function(e){var t=this.codeblockProp().theme,o=this.themeManager.getThemeInfo(t);return e?{height:Object(E.twipsToPx)(this.props.layoutBox.totalBoxSize.height),width:Object(E.twipsToPx)(this.props.layoutBox.totalBoxSize.width),backgroundColor:o.activeTheme.backgroudColor,borderWidth:o.activeTheme.borderWidth,borderStyle:o.activeTheme.borderStyle,borderRadius:o.activeTheme.borderRadius,borderColor:o.activeTheme.borderColor}:{height:Object(E.twipsToPx)(this.props.layoutBox.totalBoxSize.height),width:Object(E.twipsToPx)(this.props.layoutBox.totalBoxSize.width),backgroundColor:o.containerTheme.backgroudColor,borderWidth:o.containerTheme.borderWidth,borderStyle:o.containerTheme.borderStyle,borderRadius:o.containerTheme.borderRadius,borderColor:o.containerTheme.borderColor}},t.prototype.render=function(){var e=c()({"melo-codeblock-wrapper":!0}),t=this.getRootWrapperStyleProps(this.state.isSelected),o=c()({"melo-codeblock-scroller":!0,"melo-codeblock-firefox-readonly":!this.editor.isEditable()&&E.PlatformUtil.isFireFox()}),n=this.props.layoutBox.totalBoxSize,r={maxHeight:Object(E.twipsToPx)(n.height),maxWidth:Object(E.twipsToPx)(n.width),cursor:"auto"},a={height:Object(E.twipsToPx)(n.height-J),width:Object(E.twipsToPx)(this.props.layoutBox.content.rect.width),position:"relative",cursor:"text"},s=this.props.layoutBox.edge,l={height:Object(E.twipsToPx)(this.props.layoutBox.content.rect.height),width:Object(E.twipsToPx)(this.props.layoutBox.content.rect.width),marginTop:Object(E.twipsToPx)(s.padding.top),marginBottom:Object(E.twipsToPx)(s.padding.bottom-J),position:"relative"},u=this.themeManager.getThemeInfo(this.codeblockProp().theme).lineNumberTheme,h={paddingTop:Object(E.twipsToPx)(s.padding.top),paddingBottom:Object(E.twipsToPx)(s.padding.bottom),backgroundColor:u.backgroudColor},d=this.codeblockProp().anchorId,p=this.stateKey(d);return this.codeblockState.getCachedBoxUUIDById(p)!==this.props.layoutBox.uuid&&(this.codeblockState.updateLineNumCache(p,-1),this.codeblockState.updateBoxUUIDCache(p,this.props.layoutBox.uuid)),s.recycle(),i.a.createElement("div",{style:t,className:e,onMouseDown:this.onMouseDown.bind(this),onMouseEnter:this.onMouseEnter.bind(this),onMouseLeave:this.onMouseLeave.bind(this)},i.a.createElement("div",{ref:this.scrollerRef,className:o,style:r,onScroll:this.onScroll.bind(this)},this.state.enableLineNumber?i.a.createElement(G,{style:h,themeInfo:u,lines:this.lineNumber(),heightForIndex:this.heightForIndex.bind(this)}):"",i.a.createElement("div",{style:a},i.a.createElement("div",{style:l},this.props.childComponent))))},q([Object(W.l)(),Y("design:type",W.A)],t.prototype,"widgetService",void 0),t}(i.a.Component),K=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),X=function(){function e(){this.cacheStyleProperties=null}return e.prototype.getThemeStyleName=function(e){return"melo-codeblock-"+this.themeName+"-"+e},e.prototype.getStyleProperties=function(){var e=this;return this.cacheStyleProperties||(this.cacheStyleProperties=[],I.c.forEach((function(t){var o=e.getThemeStyleName(t.styleName),n=t.styleType===a.StyleType.Character?I.a.BaseCharacter:I.a.BaseParagraph;e.cacheStyleProperties.push({styleType:t.styleType,styleName:o,baseOnStyle:n,nextParaStyle:I.a.BaseParagraph,paraProperty:e.getParaProperty(t.styleName),spanProperty:e.getSpanProperty(t.styleName),builtinStyleType:a.BuiltinStyleType.None,styleShowName:"正文"})}))),this.cacheStyleProperties},e.prototype.getCodeblockThemeInfo=function(){return{containerTheme:this.getContainerThemeInfo(),lineNumberTheme:this.getLineNumberTheme(),activeTheme:this.getActiveTheme()}},e.prototype.getContainerThemeInfo=function(){return{backgroudColor:"#fafafa",borderWidth:1,borderColor:"rgba(0, 0, 0, 0.1)",borderStyle:"solid",borderRadius:2}},e.prototype.getLineNumberTheme=function(){return{fontFamily:'"PingFangSC-Regular", "Microsoft YaHei"',fontSize:"14px",fontColor:"rgba(0, 0, 0, 0.2)"}},e.prototype.getActiveTheme=function(){return{backgroudColor:"rgba(1, 136, 251, 0.1)",borderWidth:1,borderColor:"rgba(1, 136, 251, 0.5",borderStyle:"solid",borderRadius:2}},e}(),$=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return K(t,e),Object.defineProperty(t.prototype,"themeName",{get:function(){return I.b.Base},enumerable:!0,configurable:!0}),t.prototype.getSpanProperty=function(e){var t=new a.TextSpan;return E.PlatformUtil.isMac()&&(!E.PlatformUtil.isSafari()||E.PlatformUtil.isChrome())?t.fontFamily="monospace":t.fontFamily="Courier New",t},t.prototype.getParaProperty=function(e){var t=new a.ParaProperty;return t.lineSpacing=1.33,t},t.prototype.getStyleProperties=function(){return[{styleType:a.StyleType.Character,styleName:I.a.BaseCharacter,baseOnStyle:a.BuiltinStyleName.None,nextParaStyle:a.BuiltinStyleName.None,paraProperty:null,spanProperty:this.getSpanProperty(I.a.BaseParagraph),builtinStyleType:a.BuiltinStyleType.None,styleShowName:"正文"},{styleType:a.StyleType.Paragraph,styleName:I.a.BaseParagraph,baseOnStyle:a.BuiltinStyleName.None,nextParaStyle:a.BuiltinStyleName.None,paraProperty:this.getParaProperty(I.a.BaseParagraph),spanProperty:this.getSpanProperty(I.a.BaseParagraph),builtinStyleType:a.BuiltinStyleType.None,styleShowName:"正文"}]},t}(X),Z=function(){function e(){this.themeMap=new Map,this.defaultTheme=new $,this.initThemeConfig()}return e.prototype.initThemeConfig=function(){this.addTheme(this.defaultTheme)},e.prototype.addTheme=function(e){var t=e.themeName;this.themeMap.get(t)?E.Logger.warn("[codeblock]theme exit!!!"):this.themeMap.set(t.toLowerCase(),e)},e.prototype.getAllThemeStyleProperties=function(){var e=[];return this.themeMap.forEach((function(t){e=e.concat(t.getStyleProperties())})),e},e.prototype.getThemeStyleProperties=function(e){var t=[],o=this.themeMap.get(e);return o&&(t=t.concat(o.getStyleProperties())),t},e.prototype.getThemeStyleName=function(e,t){var o=this.themeMap.get(e);return o?o.getThemeStyleName(t):t},e.prototype.getThemeInfo=function(e){var t=this.themeMap.get(e);return t?t.getCodeblockThemeInfo():this.defaultTheme.getCodeblockThemeInfo()},e.prototype.getThemeListData=function(){var e=1,t=[],o=I.b.Base.toLowerCase();return this.themeMap.forEach((function(n,r){r!==o&&(t.push({index:e,name:n.themeName,isSelected:!1}),e+=1)})),t},e}(),ee=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),te=function(e){function t(){var t,o,n,r,i=null!==e&&e.apply(this,arguments)||this;return i.TextColorMap=((t={})[I.a.ThemeCharacter]="#000000",t[I.a.ThemeParagraph]="#000000",t[I.a.Comment]="#708090",t[I.a.Prolog]="#708090",t[I.a.Doctype]="#708090",t[I.a.Cdata]="#708090",t[I.a.Punctuation]="#999999",t[I.a.Property]="#990055",t[I.a.Tag]="#990055",t[I.a.Boolean]="#990055",t[I.a.Number]="#990055",t[I.a.Constant]="#990055",t[I.a.Symbol]="#990055",t[I.a.Deleted]="#990055",t[I.a.Selector]="#669900",t[I.a.AttrName]="#669900",t[I.a.String]="#669900",t[I.a.BaseCharacter]="#669900",t[I.a.Builtin]="#669900",t[I.a.Inserted]="#669900",t[I.a.Operator]="#9A6E3A",t[I.a.Entity]="#9A6E3A",t[I.a.Url]="#9A6E3A",t[I.a.Atrule]="#0077AA",t[I.a.AttrValue]="#0077AA",t[I.a.Keyword]="#0077AA",t[I.a.Function]="#DD4A68",t[I.a.ClassName]="#DD4A68",t[I.a.Regex]="#EE9900",t[I.a.Variable]="#EE9900",t[I.a.Important]="#EE9900",t.default="#000000",t),i.ItalicMap=((o={})[I.a.Italic]=!0,o),i.FontWeightMap=((n={})[I.a.Important]=a.FontWeightType.bold,n[I.a.Bold]=a.FontWeightType.bold,n),i.TextBackgroundMap=((r={})[I.a.Operator]="#ffffff80",r[I.a.Entity]="#ffffff80",r[I.a.Url]="#ffffff80",r),i}return ee(t,e),Object.defineProperty(t.prototype,"themeName",{get:function(){return I.b.Normal},enumerable:!0,configurable:!0}),t.prototype.getSpanProperty=function(e){var t=new a.TextSpan;return this.TextColorMap[e]?t.textColor=this.TextColorMap[e]:t.textColor=this.TextColorMap.default,this.ItalicMap[e]&&(t.italic=this.ItalicMap[e]),this.FontWeightMap[e]&&(t.fontWeight=this.FontWeightMap[e]),this.TextBackgroundMap[e]&&(t.textBackground=this.TextBackgroundMap[e]),t},t.prototype.getParaProperty=function(e){return null},t}(X);function oe(){var e=new Z;return e.addTheme(new te),e}function ne(e,t,o){return function(n,r){return r.property instanceof a.CodeblockProperty?i.a.createElement(z,{layoutBox:r,childComponent:n,editor:e,themeManager:t,bridge:o}):n}}},,function(e,t,o){"use strict";o.d(t,"a",(function(){return u}));var n=o(5),r=o(21).network,i=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]};!function(){if("function"==typeof window.CustomEvent)return!1;function e(e,t){var o=t||{bubbles:!1,cancelable:!1,detail:void 0},n=document.createEvent("CustomEvent");return n.initCustomEvent(e,o.bubbles,o.cancelable,o.detail),n}e.prototype=window.Event.prototype,window.CustomEvent=e}();var a=function(){function e(){if(this.metadata=null,this.firstLoaded={},this.asset={},this.assetLoaded=!1,this.cache={},this.evtArr=[],this.listenerMap=new Map,e.instance)return e.instance;e.instance=this,window.SLR=this}return e.getInstance=function(){return new e},e.prototype.clearCache=function(){Object.values(this.cache).forEach((function(e){e&&"function"==typeof e.destroy&&e.destroy()})),this.firstLoaded={},this.cache={},this.asset={},this.assetLoaded=!1,this.listenerMap.forEach((function(e,t){e.forEach((function(e){window.removeEventListener(t,e)}))}))},e.prototype.init=function(e,t,o,n){var a=this;if(void 0===t&&(t=i),void 0===o&&(o=i),void 0===n&&(n=0),r.isOnline)if(this.offlineInterval&&clearTimeout(this.offlineInterval),n<=2){var s=e+"?_t="+Date.now();this.ajax({method:"GET",url:s,success:function(e){a.metadata=e.data.metadata,delete e.data.metadata,delete e.data.ScriptLoader,Object.keys(e.data).forEach((function(t){if(a.asset[t]={url:e.data[t].js||null,state:-1},e.data[t].dependency){var o=e.data[t].dependency;a.asset[t].dep=o,Object.keys(o).forEach((function(e){a.asset[e]={url:o[e],state:-1}}))}})),a.assetLoaded=!0,a.dispatch("SL-INIT"),t&&t(),a.evtArr.forEach((function(e){a.dispatch(e.eventName,e.detail)})),a.monitor(3078347)},fail:function(r){console.log(r),n+=1,a.init(e,t,o,n),a.monitor(3078348)}})}else o&&o({code:1,msg:"load error"});else this.offlineInterval=setTimeout((function(){a.init(e,t,o,n)}),1e3)},e.prototype.monitor=function(e){window.QReport&&window.QReport.monitor(e)},e.prototype.load=function(e,t,o,n){var r=this;if(void 0===t&&(t=i),void 0===o&&(o=i),void 0===n&&(n=0),void 0!==this.asset[e]||this.assetLoaded){var a=this.asset,s=this.cache;try{void 0!==a[e]?void 0===s[e]&&n<=2?(a[e].dep&&Object.keys(a[e].dep).forEach((function(i){window[i]?(s[i]=window[i],a[i].state=0):void 0===s[i]&&-1===a[i].state&&r.loadScriptProcess({asset:a,cache:s,mod:i,parentModule:e},t,o,n)})),-1===a[e].state&&this.loadScriptProcess({asset:a,cache:s,mod:e,parentModule:e},t,o,n)):s[e]&&this.firstLoaded[e]&&this.checkAllLoaded(a,e)&&(t(s[e],s,!1),this.firstLoaded[e]=!0):(console.log(e+" is not found."),o&&o({code:1,msg:e+" is not found."}))}catch(e){console.log(e),this.monitor(3078382),o&&o({code:2,msg:e})}}else this.listen("SL-INIT",(function(){r.load(e,t,o,n)}))},e.prototype.loadScriptProcess=function(e,t,o,n){var r=this,i=e.asset,a=e.cache,s=e.mod,c=e.parentModule,l=this.createScript(i[s].url);i[s].state=1,l.addEventListener("load",(function(){window[s]&&(a[s]=window[s],i[s].state=0,!r.firstLoaded[c]&&r.checkAllLoaded(i,c)&&t(a[c],a,!0),r.monitor(3078345))})),l.addEventListener("error",(function(){i[s].state=n>=2?2:-1,n+=1,r.load(s,t,o,n),l&&r.removeScript(l),o&&o({code:3,msg:"load error"}),r.monitor(3078346)}))},e.prototype.checkAllLoaded=function(e,t){var o=e[t];if(0!==e[t].state)return!1;if(void 0!==o.dep)for(var n=Object.keys(o.dep),r=0,i=n.length;r<i;r++)if(!window[n[r]])return!1;return this.firstLoaded[t]=!0,!0},e.prototype.createScript=function(e){var t=document.createElement("script");return t.src=e+(e.indexOf("?")<0?"?":"&")+"version="+this.metadata,t.async=!1,t.type="text/javascript",e.indexOf(location.host)<0&&(t.crossOrigin="anonymous"),document.body.appendChild(t),t},e.prototype.removeScript=function(e){e&&e.parentNode&&e.parentNode.removeChild(e)},e.prototype.ajax=function(e){var t,o,n=this,r=function(e){return{url:e.url,paramObj:e.paramObj||{},success:e.success||i,fail:e.fail||i,method:e.method||"GET"}}(e),a=(t=r.paramObj,o=[],Object.keys(t).forEach((function(e){o.push(e+"="+encodeURIComponent(t[e]))})),o.join("&")),s=function(e,t){return e+(e.indexOf("?")>=0?"&":"?"+t)}(r.url,a),c=function(){for(var e=null,t=[function(){return new XMLHttpRequest},function(){return new XDomainRequest},function(){return new window.ActiveXObject("Msxml2.XMLHTTP")},function(){return new window.ActiveXObject("Msxml3.xmlhttp")},function(){return new window.ActiveXObject("Microsoft.XMLHTTP")}],o=0,n=t.length;o<n;o++){try{e=t[o]()}catch(e){continue}break}return e}();if(!c)throw new Error("XMLHttp is not defined");c.open("GET",s,!0),c.send(),c.onreadystatechange=function(){if(4===c.readyState)if(200===c.status){var e=JSON.parse(c.responseText);r.success({data:e,code:0}),n.monitor(3078349)}else r.fail({code:c.status}),c.status>=400&&c.status<500?n.monitor(3078350):c.status>=500&&c.status<600&&n.monitor(3078351)},c.onerror=function(){r.fail({code:-1})}},e.prototype.dispatch=function(e,t){if(this.assetLoaded){var o=new window.CustomEvent(e,{detail:t});window.dispatchEvent(o)}else this.evtArr.push({eventName:e,detail:t})},e.prototype.listen=function(e,t){void 0===t&&(t=i),"SL-INIT"===e&&this.assetLoaded?t({}):(window.addEventListener(e,t),this.listenerMap.get(e)?this.listenerMap.get(e).push(t):this.listenerMap.set(e,[t]))},e}(),s=o(0),c=function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a},l=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(){function e(e){this.contextService=e,this.slr=a.getInstance(),this.init()}return e.prototype.init=function(){var e=this.contextService.context,t=e.appid?"melo":"v4",o=e.appid?"docs.idqqimg.com":"docs.qq.com";Object(s.getCookie)("dev_route_id")?this.slr.init("//"+o+"/tim/docs/components/assets."+t+".json"):this.slr.init("//docs.idqqimg.com/tim/docs/components/assets."+t+".json")},e.prototype.getScriptLoader=function(){return this.slr},e.prototype.$onReset=function(){this.slr.clearCache(),this.init()},e=c([Object(n.w)({singleton:!0}),l("design:paramtypes",[n.f])],e)}()},function(e,t,o){"use strict";o.d(t,"a",(function(){return r}));o(2);var n=function(e){var t="function"==typeof Symbol&&Symbol.iterator,o=t&&e[t],n=0;if(o)return o.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},r=function(){function e(){}return e.randomString=function(e){var t=e||4,o="";for(var n=0;n<t;n++)o+=Math.floor(65536*(1+Math.random())).toString(16).substring(1);return o},e.getAttachmentId=function(){return+new Date+"-"+this.randomString()},e.translate=function(e,t){if(!e)return"";var o=e;return t&&Object.keys(t).forEach((function(e){o=o.replace(e,t[e])})),o},e.getWindowWidth=function(){return window?window.innerWidth:0},e.getWindowHeight=function(){return window?window.innerHeight:0},e.imgPropertyToStyle=function(e){if(!e)return null;var t=e.originWidth,o=e.originHeight,n=t*(1-e.cropLeft/1e5-e.cropRight/1e5),r=o*(1-e.cropTop/1e5-e.cropBottom/1e5),i=e.cropLeft/1e5*t,a=e.cropTop/1e5*o;return{imageWidth:Math.round(t),imageHeight:Math.round(o),croppedWidth:Math.round(n),croppedHeight:Math.round(r),marginLeft:Math.round(i),marginTop:Math.round(a)}},e.isIntersectionObserverAvailable=function(){return"undefined"!=typeof window&&"IntersectionObserver"in window&&"isIntersecting"in window.IntersectionObserverEntry.prototype},e.isSupportImgLoadingAttribute=function(){return!1},e.isOCRAvalible=function(){return!1},e.sortImageAttributes=function(e){var t,o,r=[],i=[],a=[],s=[];try{for(var c=n(e),l=c.next();!l.done;l=c.next()){var u=l.value,h=u.drawingProp,d=Math.pow(10,5),p=u.getImageSrc(),f=0,m=0;if("string"==typeof p){if(-1===p.indexOf("?w=")||-1===p.indexOf("&h=")){r.push(void 0),s.push(void 0),i.push(p),a.push(u.getAnchorId());continue}var g=p.match(/(?!(?:(\?|&)))(\w+)=(\w+)/g);if(!g)return;for(var b=0;b<g.length;b++)g[b].indexOf("w=")&&(f=Number(g[b].split("w=")[0])),g[b].indexOf("h=")&&(m=Number(g[b].split("h=")[0]));var y={cropLeft:h.cropLeft/d,cropRight:h.cropRight/d,cropBottom:h.cropBottom/d,cropTop:h.cropTop/d};r.push({imageWidth:f,imageHeight:m}),s.push(y),i.push(p.split("?")[0]),a.push(u.getAnchorId())}}}catch(e){t={error:e}}finally{try{l&&!l.done&&(o=c.return)&&o.call(c)}finally{if(t)throw t.error}}return{imageSizeList:r,imageList:i,imageIdList:a,cropValueList:s}},e}()},,,function(e,t,o){"use strict";o.d(t,"a",(function(){return l}));var n=o(5),r=o(10),i=o.n(r),a=(o(2),o(109)),s=function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a},c=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=function(){function e(e){this.scriptLoaderService=e,this.slr=this.scriptLoaderService.getScriptLoader()}return e.prototype.$onReset=function(){this.hideVipToast()},e.prototype.initToast=function(){var e=this;this.slr.listen("SL-INIT",(function(){e.slr.load("VipToast",(function(t){t.init(),e.toast=t.PcVipToast,window.App.vipToast=e.toast}))}))},e.prototype.uninitToast=function(){this.toast=null},e.prototype.showVipToast=function(e){return!!this.toast&&this.toast.showToast(e)},e.prototype.hideVipToast=function(){return!!this.toast&&this.toast.hideToast()},e.prototype.checkVipStatus=function(){var e=new FormData;return e.append("keys",JSON.stringify(["canvip","ioscanpay"])),new Promise((function(t,o){i.a.ajax({url:"//docs.qq.com/cgi-bin/online_docs/common_config",type:"POST",xhrFields:{withCredentials:!0},data:e,processData:!1,contentType:!1,success:function(e){0===e.cgicode&&0===e.retcode&&e.configs?t(e):o({})}})}))},e=s([Object(n.w)({singleton:!0}),c("design:paramtypes",[a.a])],e)}()},,,function(e,t,o){"use strict";o.d(t,"a",(function(){return i}));var n=o(2),r=function(e,t){var o="function"==typeof Symbol&&e[Symbol.iterator];if(!o)return e;var n,r,i=o.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(e){r={error:e}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a},i=function(){function e(){}return e.getImageThumb20000=function(e){if(!this.isValidQqadaptDomain(e))return e;if(e.indexOf("?type=image/gif")>0){var t=e.indexOf("?type=image/gif");return e.substring(0,t)}var o=r(e.split("?"),1)[0];return o.substring(0,o.length-1)+"20000"},e.isImageThumb1123=function(e){return!!this.isValidQqadaptDomain(e)&&r(e.split("?"),1)[0].indexOf("1123")>0},e.getImageThumb1123=function(e){if(!this.isValidQqadaptDomain(e))return e;if(e.indexOf("?type=image/gif")>0){var t=e.indexOf("?type=image/gif");return e.substring(0,t)}var o=r(e.split("?"),1)[0];return o.substring(0,o.length-1)+"1123"},e.getImageThumb1600=function(e){if(!this.isValidQqadaptDomain(e))return e;if(e.indexOf("?type=image/gif")>0){var t=e.indexOf("?type=image/gif");return e.substring(0,t)}var o=r(e.split("?"),1)[0];return o.substring(0,o.length-1)+"1600"},e.isValidQqadaptDomain=function(e){return!(!e||e.length<1)&&e.indexOf("qqadapt.qpic.cn")>0},e.isErrorQqadaptDomain=function(e){return!(!e||e.length<1)&&(e.indexOf("https://pub.idqqimg.com/pc/misc/files/20180727/b6ffe3bcf0d74c5f90f591e69a26291d.png")>0||e.indexOf("https://pub.idqqimg.com/pc/misc/files/20180727/c7de8a354e6f4ef99a1a8672e9b24593.png")>0)},e.getErrorQqadaptDomain=function(){return window.devicePixelRatio&&window.devicePixelRatio>=2?"https://pub.idqqimg.com/pc/misc/files/20180727/c7de8a354e6f4ef99a1a8672e9b24593.png":"https://pub.idqqimg.com/pc/misc/files/20180727/b6ffe3bcf0d74c5f90f591e69a26291d.png"},e.copyErrorTips=function(){return n.PlatformUtil.isMac()?"图片粘贴不成功。试试单独复制原图并用Cmd+V粘贴，或导入文档。":"图片粘贴不成功。试试单独复制原图并用Ctrl+V粘贴，或导入文档。"},e.randomString=function(e){var t=e||4,o="";for(var n=0;n<t;n++)o+=Math.floor(65536*(1+Math.random())).toString(16).substring(1);return o},e.getAttachmentId=function(){return+new Date+"-"+this.randomString()},e.getAttrArray=function(e){return[["cropped-width",e.imageWidth],["cropped-height",e.imageHeight],["image-blipFill-srcRect-l",e.left],["image-blipFill-srcRect-t",e.top],["image-blipFill-srcRect-b",e.bottom],["image-blipFill-srcRect-r",e.right]]},e.getImgAttr=function(e){var t=function(e,t){var o=new RegExp("\\b"+e+":(-?[0-9]+)\\b").exec(t);return(o&&o[1])>>0},o=e,n={width:0,height:0};if("string"!=typeof e){o=e.getAttribute("data-cls");var r=getComputedStyle(e);n.width=Number(r.width.replace("px","")),n.height=Number(r.height.replace("px",""))}var i=n.width||t("image-width",o)||0,a=n.height||t("image-height",o)||0,s=t("image-blipFill-srcRect-l",o),c=t("image-blipFill-srcRect-t",o),l=s/1e5*i,u=c/1e5*a,h=i*(1-s/1e5-t("image-blipFill-srcRect-r",o)/1e5),d=a*(1-c/1e5-t("image-blipFill-srcRect-b",o)/1e5);return{imageWidth:Math.round(i),imageHeight:Math.round(a),croppedWidth:Math.round(h),croppedHeight:Math.round(d),croppedX:Math.round(l),croppedY:Math.round(u)}},e.getLineElementWidth=function(e){for(var t=e;t;){if(t.className&&t.className.indexOf("melo-paragraph")>=0){var o=getComputedStyle(t).width;return Math.round(Number(o.replace("px","")))}t=t.parentNode}return 0},e}()},,,,,,,,,,,,,,,,,,,,function(e,t,o){},function(e,t,o){},,,,,,,function(e,t,o){"use strict";o.d(t,"a",(function(){return a}));var n=o(0),r=o(2),i=o(90),a=function(){function e(){}return e.wechatAutoLogin=function(){if(!Object(n.hasLoginCookie)()&&r.PlatformUtil.isWXh5()){var e="https://docs.qq.com/v2/util/login/jump?target="+encodeURIComponent(window.location.href),t="https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx46dfe750eef96da7&redirect_uri="+encodeURIComponent(e)+"&response_type=code&scope=snsapi_userinfo&state=onweixinlogin";return window.location.href=t,!0}return!1},e.navigateToLogin=function(){var t=window.mqq;if(r.PlatformUtil.isWXMiniProgram()||r.PlatformUtil.isQQMiniProgram()){var o="/pages/detail/detail?reason=pskey_error&url="+encodeURIComponent(location.href);i.a.getQuery("rtkey")&&(o+="&scene="+i.a.getQuery("rtkey")),window.wx&&window.wx.miniProgram&&window.wx.miniProgram.reLaunch&&window.wx.miniProgram.reLaunch({url:o})}else if(r.PlatformUtil.isWeWork()){var n="https://docs.qq.com/scenario/ww-login.html?from=detail&url="+encodeURIComponent(window.location.href);window.location.replace("https://open.weixin.qq.com/connect/oauth2/authorize?appid=ww20388f7040b655b7&redirect_uri=\n            "+encodeURIComponent(n)+"&response_type=code&scope=snsapi_userinfo&state=weworklogin#wechat_redirect")}else if(r.PlatformUtil.isWXh5())e.wechatAutoLogin();else if(r.PlatformUtil.isTimQQ()){r.PlatformUtil.isTim();t?t.invoke("data","updateLoginInfo",{key:"pskey"},(function(e){0===e.code?(0===e.result||1===e.result||e.result,window.location.reload()):window.location.reload()})):window.location.reload()}else location.href="https://docs.qq.com/login.html?jump_url="+encodeURIComponent(location.href)},e}()},,function(e,t,o){"use strict";o.d(t,"a",(function(){return f}));var n,r=o(1),i=o.n(r),a=o(230),s=o(5),c=o(2),l=o(147),u=o.n(l),h=(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),d=function(){return(d=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.touchStartClients=null,t.touchIsMoving=!1,t.parseColor=function(e){return e||"#000000"},t.touchStart=function(e){e.targetTouches.length>0&&(t.touchStartClients={x:e.targetTouches[0].clientX,y:e.targetTouches[0].clientY}),t.touchIsMoving=!1},t.touchMove=function(e){if(!t.touchIsMoving&&t.touchStartClients){var o=e.targetTouches.item(0),n=o.clientX-t.touchStartClients.x,r=o.clientY-t.touchStartClients.y;n*n+r*r>20&&(t.touchIsMoving=!0)}},t.touchEnd=function(e){e.cancelable&&e.preventDefault(),t.touchIsMoving||t.onClick(),t.touchIsMoving=!1,t.touchStartClients=null},t.onClick=function(){var e=t.props,o=e.layoutBox;e.containerFocus.onFocus(o,!1)},t}return h(t,e),t.prototype.componentDidMount=function(){e.prototype.componentDidMount.call(this),this.props.bridge&&this.props.bridge.instance.sendAction(this.props.bridge.key,{type:"dom_mount",data:{box:this.props.layoutBox,requestFocus:this.onClick}})},t.prototype.render=function(){var e=this.props.layoutBox.property,t=e.marginLeft,o=e.marginRight,n=e.type,r=e.fillColor,a=this.parseColor(r),s={marginLeft:t+"%",marginRight:o+"%"};return i.a.createElement("span",{className:"melo-inline-block "+u.a["hr-wrapper"],ref:this.setRootRef,onMouseUp:this.onClick,onTouchStart:this.touchStart,onTouchMove:this.touchMove,onTouchEnd:this.touchEnd},i.a.createElement("hr",{className:"horizontal-splitline "+n,style:d(d({},s),{color:a})}))},t.contextType=s.h,t}(a.b);function f(e){return function(t,o,n){return i.a.createElement(p,{layoutBox:t,containerFocus:o,context:n,bridge:e,key:c.StringUtil.generateRandomId()})}}},function(e,t,o){e.exports={"hr-wrapper":"hr-wrapper--a_O1T"}},function(e,t,o){"use strict";o.d(t,"a",(function(){return m}));var n,r=o(37),i=o.n(r),a=o(1),s=o.n(a),c=o(0),l=o(2),u=(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),h=function(){return(h=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._onMouseSelect=function(e){e.stopPropagation(),e.preventDefault(),0===e.button&&t.props.onSelect(t)},t._onTouchSelect=function(e){e.stopPropagation(),e.preventDefault(),t.props.onSelect(t)},t}return u(t,e),t.prototype.render=function(){return s.a.createElement("div",{className:i.a["list-overlay"]+" "+i.a["list-overlay-selectable"],style:{width:this.props.width},onMouseDown:this._onMouseSelect,onTouchStart:this._onTouchSelect})},t}(s.a.Component),p=function(e){function t(t){var o=e.call(this,t)||this;return o._onCancel=function(){o.props.bridge.instance.sendAction(o.props.bridge.key,{type:"select_cancel",data:null})},o.state={isListSelected:!1,isSelected:!1},o}return u(t,e),t.prototype.componentDidMount=function(){this.update(this.props.listId,this.props.listLevel,this.props.order)},t.prototype.shouldComponentUpdate=function(e,t){return this.update(e.listId,e.listLevel,e.order,this.props.listId,this.props.listLevel),this.state.isSelected!==t.isSelected||this.state.isListSelected!==t.isListSelected||this.props.markWidth!==e.markWidth},t.prototype.componentWillUnmount=function(){this.update("",-1,-1,this.props.listId,this.props.listLevel)},t.prototype.render=function(){return s.a.createElement("div",{className:i.a["list-overlay"],style:{width:2*this.props.width},onMouseDown:this._onCancel,onTouchStart:this._onCancel},s.a.createElement("div",{className:this.state.isListSelected?i.a["list-overlay-list-selected"]:i.a["list-overlay-layer"]},s.a.createElement("div",{className:this.state.isSelected?i.a["list-overlay-selected"]:i.a["list-overlay-layer"]+" "+i.a["list-overlay-selectable"],style:{width:this.props.markWidth},onMouseDown:this._onMouseSelect,onTouchStart:this._onTouchSelect})))},t.prototype.update=function(e,t,o,n,r){void 0===n&&(n=""),void 0===r&&(r=-1),e===n&&t===r||this.props.bridge.instance.sendAction(this.props.bridge.key,{type:"dom_update",data:{prevListId:n,prevListLevel:r,listId:e,listLevel:t,listOrder:o,ref:this}},!0,!0)},t}(d),f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return u(t,e),t.prototype.render=function(){var e=this,t=h({},c.CssUtil.computeStyles(this.props.layoutBox).cssProperties);this.props.layoutBox.textStyle.fontFamily||(t.fontFamily=void 0);var o=this.props.layoutBox.edge,n=Object(l.twipsToPx)(this.props.layoutBox.rect.width),r=Object(l.twipsToPx)(o.padding.right),a=n+r;o.recycle();var u=this.getRenderInfo(),f=u.lineBox,m=u.list;if(f&&m){var g=null;return this.props.bridge&&(g=m.isTask?s.a.createElement(d,{width:n+Math.max(0,r-4),onSelect:function(){return e.onSelect(m)}}):s.a.createElement(p,{width:a,listId:m.listId,listLevel:m.listLevel,order:m.order,markWidth:n,bridge:this.props.bridge,onSelect:function(t){return e.onSelect(m,t)}})),s.a.createElement("span",{className:i.a["list-marker"]},g,s.a.createElement("span",{className:i.a["list-marker-text"],style:h({width:a},t)},this.props.layoutBox.text))}return null},t.prototype.getRenderInfo=function(){var e=this.props.layoutBox.lineBox;if(e){var t=e.parentBox;if(t)return{list:t.paraProps,lineBox:e}}return{list:void 0,lineBox:void 0}},t.prototype.onSelect=function(e,t){this.props.bridge&&this.props.bridge.instance.sendAction(this.props.bridge.key,{type:"select",data:{list:e,overlay:t}})},t}(s.a.Component);function m(e){return function(t,o){return t instanceof c.ListTextLineBox&&t.listMark?s.a.createElement(f,{key:o,layoutBox:t.listMark,bridge:e}):null}}},function(e,t,o){"use strict";o.d(t,"a",(function(){return r}));var n=o(0),r=function(e){var t={};return e&&e.firstChild instanceof n.ListTextLineBox&&e.firstChild.listMark&&e.paraProps.listId&&e.paraProps.taskState===n.TaskState.Done&&(t={opacity:.3,textDecoration:"line-through",textDecorationColor:"black"}),t}},function(e,t,o){"use strict";o.d(t,"a",(function(){return n}));var n=function(){function e(){this.cachedContentLenthMap=new Map,this.cachedLineNumMap=new Map,this.cachedBoxIdMap=new Map,this.lastLanguage="plain text",this.lastTheme="normal"}return e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.updateContentLengthCache=function(e,t){this.cachedContentLenthMap.set(e,t)},e.prototype.getCachedContentLengthById=function(e){return this.cachedContentLenthMap.get(e)||0},e.prototype.updateLineNumCache=function(e,t){this.cachedLineNumMap.set(e,t)},e.prototype.getCachedLineNumById=function(e){return this.cachedLineNumMap.get(e)||-1},e.prototype.updateBoxUUIDCache=function(e,t){this.cachedBoxIdMap.set(e,t)},e.prototype.getCachedBoxUUIDById=function(e){return this.cachedBoxIdMap.get(e)||""},e.prototype.clear=function(e){this.cachedContentLenthMap.delete(e),this.cachedLineNumMap.delete(e),this.cachedBoxIdMap.delete(e)},e.instance=null,e}()},,function(e,t,o){"use strict";t.a="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' width='22' height='22' viewBox='0 0 22 22'%3e %3cdefs%3e %3cpath id='prefix__a' d='M10.01 1.036l7.945 7-.17.003H12.9l-1.61 8.97H7.152l1.608-8.97H5.514L2.59 4.919l6.73-.011.69-3.872z'/%3e %3c/defs%3e %3cg fill='none' fill-rule='evenodd' transform='translate(1.375 2.375)'%3e %3cpath fill='%232A65F5' d='M15.542.352H3.205c-.17 0-.316.12-.345.286L.005 16.603c-.037.211.128.406.346.406h6.8l.54-.165h3.157l.442.165h5.238c.17 0 .316-.12.346-.286L19.222 3.59 15.542.352z'/%3e %3cpath fill='%2300DCFF' fill-rule='nonzero' d='M15.542.352l3.68 3.24H15.38c-.218 0-.383-.195-.345-.406l.507-2.834z'/%3e %3cuse fill='white' xlink:href='%23prefix__a'/%3e %3c/g%3e %3c/svg%3e"},function(e,t,o){"use strict";t.a="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' width='22' height='22' viewBox='0 0 22 22'%3e %3cdefs%3e %3cfilter id='prefix__d' width='111.2%25' height='110.1%25' x='-5.6%25' y='-5.1%25' filterUnits='objectBoundingBox'%3e %3cfeGaussianBlur in='SourceAlpha' result='shadowBlurInner1' stdDeviation='.5'/%3e %3cfeOffset dx='1' in='shadowBlurInner1' result='shadowOffsetInner1'/%3e %3cfeComposite in='shadowOffsetInner1' in2='SourceAlpha' k2='-1' k3='1' operator='arithmetic' result='shadowInnerInner1'/%3e %3cfeColorMatrix in='shadowInnerInner1' values='0 0 0 0 1 0 0 0 0 1 0 0 0 0 1 0 0 0 0.24 0'/%3e %3c/filter%3e %3cfilter id='prefix__e' width='140.4%25' height='302.1%25' x='-10.1%25' y='-50.5%25' filterUnits='objectBoundingBox'%3e %3cfeOffset dx='1' dy='1' in='SourceAlpha' result='shadowOffsetOuter1'/%3e %3cfeGaussianBlur in='shadowOffsetOuter1' result='shadowBlurOuter1' stdDeviation='.5'/%3e %3cfeColorMatrix in='shadowBlurOuter1' values='0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.2 0'/%3e %3c/filter%3e %3cfilter id='prefix__g' width='140.4%25' height='302.1%25' x='-10.1%25' y='-50.5%25' filterUnits='objectBoundingBox'%3e %3cfeOffset dx='1' dy='1' in='SourceAlpha' result='shadowOffsetOuter1'/%3e %3cfeGaussianBlur in='shadowOffsetOuter1' result='shadowBlurOuter1' stdDeviation='.5'/%3e %3cfeColorMatrix in='shadowBlurOuter1' values='0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.2 0'/%3e %3c/filter%3e %3cpath id='prefix__c' d='M15.223 0c.703 0 1.274.57 1.274 1.274v17.203c0 .728.59 1.32 1.32 1.32H1.274C.57 19.796 0 19.225 0 18.521V1.274C0 .57.57 0 1.274 0h13.949z'/%3e %3cpath id='prefix__f' d='M3.629 13.857L13.527 13.857 13.527 15.837 3.629 15.837z'/%3e %3cpath id='prefix__h' d='M3.629 10.558L13.527 10.558 13.527 12.538 3.629 12.538z'/%3e %3cradialGradient id='prefix__b' cx='71.859%25' cy='0%25' r='149.098%25' fx='71.859%25' fy='0%25' gradientTransform='scale(-1 -.9) rotate(-81.582 0 .833)'%3e %3cstop offset='0%25' stop-color='%23359FFF'/%3e %3cstop offset='99.923%25' stop-color='%230D75FF'/%3e %3c/radialGradient%3e %3clinearGradient id='prefix__a' x1='100%25' x2='83.621%25' y1='29.782%25' y2='29.782%25'%3e %3cstop offset='0%25' stop-color='%234776FA'/%3e %3cstop offset='100%25' stop-color='%23194CE9'/%3e %3c/linearGradient%3e %3c/defs%3e %3cg fill='none' fill-rule='evenodd' transform='translate(1.375 1.375)'%3e %3cpath fill='url(%23prefix__a)' d='M4.574 4.62h13.288c.704 0 1.274.57 1.274 1.273v12.63c0 .703-.57 1.273-1.274 1.273H4.574c-.704 0-1.275-.57-1.275-1.274V5.893c0-.703.57-1.274 1.275-1.274z'/%3e %3cuse fill='url(%23prefix__b)' xlink:href='%23prefix__c'/%3e %3cuse fill='black' filter='url(%23prefix__d)' xlink:href='%23prefix__c'/%3e %3cuse fill='black' filter='url(%23prefix__e)' xlink:href='%23prefix__f'/%3e %3cuse fill='%2398D3FF' xlink:href='%23prefix__f'/%3e %3cg%3e %3cuse fill='black' filter='url(%23prefix__g)' xlink:href='%23prefix__h'/%3e %3cuse fill='%23D3F3FF' xlink:href='%23prefix__h'/%3e %3c/g%3e %3c/g%3e %3c/svg%3e"},function(e,t,o){"use strict";t.a="//docs.idqqimg.com/tim/docs/static/img/file-excel-c4b74914.svg"},function(e,t,o){"use strict";t.a="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' viewBox='0 0 22 22'%3e %3cdefs%3e %3clinearGradient id='prefix__a' x1='100%25' x2='-48.354%25' y1='6.373%25' y2='93.015%25'%3e %3cstop offset='0%25' stop-color='%231ECCF2'/%3e %3cstop offset='100%25' stop-color='%2340BEFC'/%3e %3c/linearGradient%3e %3c/defs%3e %3cg fill='none' fill-rule='evenodd'%3e %3cpath fill='%23008ED7' d='M1.751 1.375h7.77c.238 0 .465.092.636.256l2.594 2.494H.834V2.292c0-.507.41-.917.917-.917z'/%3e %3cpath fill='url(%23prefix__a)' d='M.834 4.02h19.55c.594 0 1.075.481 1.075 1.075v13.433c0 .594-.481 1.075-1.075 1.075H1.91c-.594 0-1.076-.481-1.076-1.075V4.02z'/%3e %3c/g%3e %3c/svg%3e"},function(e,t,o){"use strict";t.a="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' width='22' height='22' viewBox='0 0 22 22'%3e %3cdefs%3e %3clinearGradient id='prefix__a' x1='100%25' x2='83.108%25' y1='39.465%25' y2='39.465%25'%3e %3cstop offset='0%25' stop-color='%23F7501C'/%3e %3cstop offset='100%25' stop-color='%23D93213'/%3e %3c/linearGradient%3e %3clinearGradient id='prefix__b' x1='82.887%25' x2='9.5%25' y1='0%25' y2='100%25'%3e %3cstop offset='0%25' stop-color='%23FF8759'/%3e %3cstop offset='100%25' stop-color='%23FF5B0F'/%3e %3c/linearGradient%3e %3cfilter id='prefix__c' width='140.9%25' height='140.9%25' x='-10.2%25' y='-10.2%25' filterUnits='objectBoundingBox'%3e %3cfeOffset dx='1' dy='1' in='SourceAlpha' result='shadowOffsetOuter1'/%3e %3cfeGaussianBlur in='shadowOffsetOuter1' result='shadowBlurOuter1' stdDeviation='.5'/%3e %3cfeColorMatrix in='shadowBlurOuter1' values='0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.08 0'/%3e %3c/filter%3e %3cfilter id='prefix__e' width='198.1%25' height='194.4%25' x='-24.5%25' y='-23.6%25' filterUnits='objectBoundingBox'%3e %3cfeOffset dx='1' dy='1' in='SourceAlpha' result='shadowOffsetOuter1'/%3e %3cfeGaussianBlur in='shadowOffsetOuter1' result='shadowBlurOuter1' stdDeviation='.5'/%3e %3cfeColorMatrix in='shadowBlurOuter1' values='0 0 0 0 0.457455842 0 0 0 0 0 0 0 0 0 0 0 0 0 0.16 0'/%3e %3c/filter%3e %3cpath id='prefix__d' d='M4.57.007l-.001 5.211h5.209l-.006.108c-.22 2.5-2.32 4.462-4.877 4.462C2.192 9.788 0 7.596 0 4.892 0 2.298 2.018.175 4.57.007z'/%3e %3cpath id='prefix__f' d='M5.716 0C7.98.088 9.79 1.952 9.79 4.24l-.004-.148H5.715z'/%3e %3c/defs%3e %3cg fill='none' fill-rule='evenodd'%3e %3cpath fill='url(%23prefix__a)' d='M4.68 4.727h13.598c.72 0 1.303.583 1.303 1.303v12.923c0 .72-.583 1.304-1.303 1.304H4.68c-.72 0-1.304-.584-1.304-1.304V6.03c0-.72.584-1.303 1.304-1.303z' transform='translate(1.375 1.375)'/%3e %3cpath fill='url(%23prefix__b)' d='M15.577 0c.72 0 1.304.584 1.304 1.304v17.602c0 .746.604 1.35 1.35 1.35H1.304c-.72 0-1.304-.583-1.304-1.303V1.303C0 .584.584 0 1.304 0h14.273z' transform='translate(1.375 1.375)'/%3e %3cg transform='translate(1.375 1.375) translate(3.56 6.676)'%3e %3cuse fill='black' filter='url(%23prefix__c)' xlink:href='%23prefix__d'/%3e %3cuse fill='%23FFCFC0' xlink:href='%23prefix__d'/%3e %3cg%3e %3cuse fill='black' filter='url(%23prefix__e)' xlink:href='%23prefix__f'/%3e %3cuse fill='white' xlink:href='%23prefix__f'/%3e %3c/g%3e %3c/g%3e %3c/g%3e %3c/svg%3e"},function(e,t,o){"use strict";t.a="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' width='22' height='22' viewBox='0 0 22 22'%3e %3cdefs%3e %3clinearGradient id='prefix__a' x1='99.866%25' x2='80.655%25' y1='41.208%25' y2='41.208%25'%3e %3cstop offset='0%25' stop-color='%23F99B13'/%3e %3cstop offset='100%25' stop-color='%23E98E0A'/%3e %3c/linearGradient%3e %3clinearGradient id='prefix__b' x1='67.706%25' x2='9.819%25' y1='0%25' y2='99.452%25'%3e %3cstop offset='0%25' stop-color='%23F9C600'/%3e %3cstop offset='99.931%25' stop-color='%23FFAB00'/%3e %3c/linearGradient%3e %3cfilter id='prefix__d' width='111.2%25' height='110%25' x='-5.6%25' y='-5%25' filterUnits='objectBoundingBox'%3e %3cfeGaussianBlur in='SourceAlpha' result='shadowBlurInner1' stdDeviation='.5'/%3e %3cfeOffset dx='1' in='shadowBlurInner1' result='shadowOffsetInner1'/%3e %3cfeComposite in='shadowOffsetInner1' in2='SourceAlpha' k2='-1' k3='1' operator='arithmetic' result='shadowInnerInner1'/%3e %3cfeColorMatrix in='shadowInnerInner1' values='0 0 0 0 1 0 0 0 0 1 0 0 0 0 1 0 0 0 0.24 0'/%3e %3c/filter%3e %3cfilter id='prefix__e' width='141.6%25' height='153.3%25' x='-20.8%25' y='-13.3%25' filterUnits='objectBoundingBox'%3e %3cfeOffset dy='1' in='SourceAlpha' result='shadowOffsetOuter1'/%3e %3cfeGaussianBlur in='shadowOffsetOuter1' result='shadowBlurOuter1' stdDeviation='.5'/%3e %3cfeColorMatrix in='shadowBlurOuter1' values='0 0 0 0 0.510161911 0 0 0 0 0.26330308 0 0 0 0 0 0 0 0 0.207359047 0'/%3e %3c/filter%3e %3cpath id='prefix__c' d='M15.264 0c.733 0 1.327.594 1.327 1.327v17.255c0 .733.595 1.328 1.328 1.328H1.327C.594 19.91 0 19.315 0 18.582V1.327C0 .594.594 0 1.327 0h13.937z'/%3e %3cpath id='prefix__f' d='M12.207 7.632l1.408 1.408-4.69 4.69-1.407 1.408v-.001l-.003.003-1.408-1.407.002-.004L4 11.619l1.407-1.408 2.11 2.111 4.691-4.69z'/%3e %3c/defs%3e %3cg fill='none' fill-rule='evenodd' transform='translate(1.375 1.375)'%3e %3cpath fill='url(%23prefix__a)' d='M4.646 4.646h13.273c.733 0 1.327.594 1.327 1.327v12.61c0 .732-.594 1.327-1.327 1.327H4.646c-.733 0-1.328-.595-1.328-1.328V5.972c0-.732.595-1.326 1.328-1.326z'/%3e %3cuse fill='url(%23prefix__b)' xlink:href='%23prefix__c'/%3e %3cuse fill='black' filter='url(%23prefix__d)' xlink:href='%23prefix__c'/%3e %3cg%3e %3cuse fill='black' filter='url(%23prefix__e)' xlink:href='%23prefix__f'/%3e %3cuse fill='%23FFFAE9' xlink:href='%23prefix__f'/%3e %3c/g%3e %3c/g%3e %3c/svg%3e"},function(e,t,o){"use strict";t.a="//docs.idqqimg.com/tim/docs/static/img/file-doc-pdf-69a3abf2.svg"},,,function(e,t,o){"use strict";o.d(t,"a",(function(){return y}));var n,r=o(1),i=o.n(r),a=o(0),s=(o(136),o(230)),c=(o(137),o(145)),l=o(110),u=o(116),h=o(2),d=o(99),p=(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),f=function(e){function t(t){var o=e.call(this,t)||this;return o.initPosition={x:0,y:0},o.isTouchStartToEnd=!0,o.canShowImage=!0,o.onError=function(e){u.a.isImageThumb1123(e.target.src)&&(e.target.onerror=null,e.target.src=o.props.layoutBox.property.imgSrc),d.a.loadError(o.editor)},o.onContextMenu=function(e){h.PlatformUtil.isTencentDocsIPadApp()&&e.stopPropagation()},o.onMouseDown=function(e){h.PlatformUtil.isTencentDocsIPadApp()&&(e.stopPropagation(),e.preventDefault())},o.onMouseUp=function(e){e.stopPropagation(),e.preventDefault(),o.props.layoutBox.property.isPlaceHolder||0===e.button||o.props.containerFocus.onFocus(o.props.layoutBox,!1,!1)},o.onTouchStart=function(e){e.stopPropagation(),e&&e.changedTouches&&e.changedTouches.length>0&&(o.initPosition={x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY}),o.isTouchStartToEnd=!0},o.onTouchMove=function(e){o.initPosition&&o.initPosition.x&&o.initPosition.y&&e&&e.changedTouches&&(Math.abs(e.changedTouches[0].clientX-o.initPosition.x)>10||Math.abs(e.changedTouches[0].clientY-o.initPosition.y)>10)&&(o.isTouchStartToEnd=!1)},o.onTouchEnd=function(e){(e.preventDefault(),e.stopPropagation(),o.isTouchStartToEnd)&&(o.props.layoutBox.property.isPlaceHolder||o.props.containerFocus.onFocus(o.props.layoutBox,!1))},o.onClick=function(e){e.stopPropagation(),e.preventDefault(),o.props.layoutBox.property.isPlaceHolder||o.props.containerFocus.onFocus(o.props.layoutBox,!1)},o.onDoubleClick=function(){o.props.layoutBox.property.isPlaceHolder||o.props.containerFocus.onFocus(o.props.layoutBox,!0)},o.editor=o.props.context,o.onClick=o.onClick.bind(o),o.onDoubleClick=o.onDoubleClick.bind(o),o.onError=o.onError.bind(o),o.onLoad=o.onLoad.bind(o),o.onMouseUp=o.onMouseUp.bind(o),o.onTouchStart=o.onTouchStart.bind(o),o.onTouchEnd=o.onTouchEnd.bind(o),o.onTouchMove=o.onTouchMove.bind(o),o}return p(t,e),t.prototype.shouldComponentUpdate=function(e){var t=this.props.layoutBox.property,o=e.layoutBox.property;return!o||!t||(t.height!==o.height||t.width!==o.width||t.cropBottom!==o.cropBottom||t.cropLeft!==o.cropLeft||t.cropRight!==o.cropRight||t.cropTop!==o.cropTop||t.imgSrc!==o.imgSrc||t.anchorId!==o.anchorId||t.placeHolderSrc!==o.placeHolderSrc)},t.prototype.onLoad=function(e){var t=e.target,o=this.props.layoutBox;if(!o.property||0!==o.property.height&&0!==o.property.width){if(!this.props.layoutBox.property.anchorId){i=this.props.layoutBox.firstIndex,s=this.props.layoutBox.lastIndex;this.props.context&&this.props.context.fire(new a.ImageSizeInitNotification(0,0,i,s))}}else{var n=t.naturalHeight,r=t.naturalWidth,i=this.props.layoutBox.firstIndex,s=this.props.layoutBox.lastIndex;r>n?r>4096&&(n*=4096/r,r=4096):n>4096&&(r*=4096/n,n=4096),this.props.context&&this.props.context.fire(new a.ImageSizeInitNotification(n,r,i,s))}d.a.loadSuccess(this.editor)},t.prototype.render=function(){var e=this,t=this.props.layoutBox,o=l.a.imgPropertyToStyle(t.property),n=!1;0===t.property.cropBottom&&0===t.property.cropTop&&0===t.property.cropLeft&&0===t.property.cropRight||(n=!0);var r=t.property,a=r.imgSrc,s=r.isPlaceHolder;if(s)this.imgSrcShow=t.property.placeHolderSrc;else{var c=t.property.imgSrc;0,this.imgSrcShow=c}if(!t.property||0!==t.property.height&&0!==t.property.width||(this.imgSrcShow=a),s){this.canShowImage=!1;var u=t.property.placeHolderSrc;u&&u.indexOf("blob:https")>=0&&(this.canShowImage=!0)}else this.canShowImage=!0;var d=this.editor.isEditable();return i.a.createElement("img",{ref:function(t){return e.imgElement=t},id:t.property.anchorId,className:"melo-inline-image",src:this.canShowImage&&this.imgSrcShow?this.imgSrcShow:"",style:{visibility:this.canShowImage?"visible":"hidden",cursor:d?"move":"default",marginLeft:-1*Object(h.twipsToPx)(o.marginLeft),marginTop:-1*Object(h.twipsToPx)(o.marginTop),width:n?Object(h.twipsToPx)(o.imageWidth):Object(h.twipsToPx)(t.rect.width),height:n?Object(h.twipsToPx)(o.imageHeight):Object(h.twipsToPx)(t.rect.height)},"data-cls":"image-blipFill-srcRect-b:"+t.property.cropBottom+" image-blipFill-srcRect-t:"+t.property.cropTop+"\n                       image-blipFill-srcRect-l:"+t.property.cropLeft+" image-blipFill-srcRect-r:"+t.property.cropRight+"\n                        image-height:"+Object(h.twipsToPx)(o.imageHeight)+" image-width:"+Object(h.twipsToPx)(o.imageWidth),onClick:this.onClick,onTouchEnd:this.onTouchEnd,onTouchMove:this.onTouchMove,onTouchStart:this.onTouchStart,onContextMenu:this.onContextMenu,onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,onDoubleClick:this.onDoubleClick,onError:this.onError,onLoad:this.onLoad})},t}(i.a.Component),m=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),g=function(){return(g=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},b=function(e){function t(t){var o=e.call(this,t)||this;return o.canShowImage=!0,o.editor=o.props.context,o}return m(t,e),t.prototype.render=function(){var e=this.props.layoutBox,t=e.property.isPlaceHolder,o=e.property.progress;if(t||(o=100),t){this.canShowImage=!1;var n=e.property.placeHolderSrc;n&&n.indexOf("blob:https")>=0&&(this.canShowImage=!0)}else this.canShowImage=!0;var r=this.editor.isEditable();return i.a.createElement("span",{className:"melo-inline-block image-wrapper"+(this.canShowImage?"":" img-load-background")+(r?" image-cursor":""),style:g({display:"inline-block",overflow:"hidden"},a.CssUtil.boxSize(e)),ref:this.setRootRef},o<100&&o>0?i.a.createElement("div",{className:"progress_bar_container"},i.a.createElement(c.a,{width:"18px",height:"18px",spinType:"light"}),i.a.createElement("span",{className:"progress_bar_text"},o+"%")):"",i.a.createElement(f,{layoutBox:this.props.layoutBox,context:this.props.context,containerFocus:this.props.containerFocus}))},t}(s.b);function y(){return function(e,t,o){return i.a.createElement(b,{context:o,layoutBox:e,containerFocus:t})}}},function(e,t,o){"use strict";o.d(t,"c",(function(){return n})),o.d(t,"b",(function(){return r})),o.d(t,"a",(function(){return p}));var n,r,i=o(4),a=o(54),s=function(){function e(){this._changeSet=i.Changeset.identity(1),this._changeSetCount=0,this._commitId=a.a.createMessageSeq()}return Object.defineProperty(e.prototype,"changeSet",{get:function(){return this._changeSet},set:function(e){this._changeSet=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"changeSetCount",{get:function(){return this._changeSetCount},set:function(e){this._changeSetCount=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"commitId",{get:function(){return this._commitId},enumerable:!0,configurable:!0}),e.prototype.resetcommitId=function(){this._commitId=a.a.createMessageSeq()},e.prototype.reset=function(){this.resetcommitId(),this._changeSet=i.Changeset.identity(1),this._changeSetCount=0},e.prototype.makeIdentity=function(e){this._changeSet=i.Changeset.identity(e),this._changeSetCount=0},e.prototype.isIdentity=function(){return i.Changeset.isIdentity(this._changeSet)},e.prototype.debugString=function(){return""+this.changeSet},e}(),c=o(102),l=o(2),u=o(0),h=o(19),d=function(){return(d=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};!function(e){e.SubmittedChangeset="SubmittedChangeset",e.QueueChanges="QueueChanges",e.UserChangeset="UserChangeset"}(n||(n={})),function(e){e.SetData2Store="SetData2Store",e.SetData2StoreCallback="SetData2StoreCallback",e.ClearOfflineStore="ClearOfflineStore"}(r||(r={}));var p=function(){function e(e,t){this.subId=t,this._baseAText=i.Changeset.makeAText("\n"),this._submittedChangeset=null,this._toSummitChangeset=new s,this._queueChanges=[],this._hasReportEdit=!1,this._apool=e}return Object.defineProperty(e.prototype,"submittedChangeset",{get:function(){return this._submittedChangeset},set:function(e){this._submittedChangeset=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"toSummitChangeset",{get:function(){return this._toSummitChangeset},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"queueChanges",{get:function(){return this._queueChanges},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"apool",{get:function(){return this._apool},enumerable:!0,configurable:!0}),e.prototype.clearQueue=function(){this._queueChanges=[]},e.prototype.queueChange=function(e){e.changeset&&(this.queueChanges.push(e),this.toSummitChangeset.makeIdentity(i.Changeset.newLen(e.changeset)))},e.prototype.hasUncommittedChanges=function(){return!(!(this.submittedChangeset||this.queueChanges.length>0)&&this.toSummitChangeset.isIdentity())},e.prototype.initAText=function(e,t){if(this._baseAText=i.Changeset.cloneAText(e),t){var o=i.AttribPool.fromJsonable(t);this._baseAText.attribs=i.Changeset.moveOpsToNewPool(this._baseAText.attribs,o,this._apool)}return this.toSummitChangeset.reset(),this.toSummitChangeset.makeIdentity(this._baseAText.text.length),this.queueChanges.splice(0,this.queueChanges.length),this._submittedChangeset=null,this._baseAText},e.prototype.applyChangesToBase=function(e){this._baseAText=i.Changeset.applyToAText(e,this._baseAText,this._apool)},e.prototype.getChanges=function(){var e=[];this.submittedChangeset&&e.push(this.submittedChangeset),this.queueChanges.forEach((function(t){e.push(t)}));var t={changeset:this.toSummitChangeset.changeSet,commitId:this.toSummitChangeset.commitId,keydata:!1,subId:this.subId,head:!1,oSubId:!1};return e.push(t),e},e.prototype.applyPreparedChangesetToBase=function(e){if(!this.submittedChangeset)throw new Error("applySubmittedChangesToBase: no submitted changes to apply");u.GlobalContext.run(h.b.push,{acceptCs:this.submittedChangeset.changeset,rev:e}),this.submittedChangeset.changeset&&!this.submittedChangeset.applied&&(this._baseAText=i.Changeset.applyToAText(this.submittedChangeset.changeset,this._baseAText,this._apool)),this._submittedChangeset=null,this.setAllChanges2Store()},e.prototype.applyWireChange=function(e,t,o,n){var r=this,a=this.getChanges(),s=a[a.length-1],u="before follow, curRev: "+o+",newRev: "+n+" push:"+e+", current changes: "+JSON.stringify(a.map((function(e){return e.changeset})));if(l.Logger.info("ChangsetStore | "+u),t){var h=i.AttribPool.fromJsonable(t);e=i.Changeset.moveOpsToNewPool(e,h,this._apool)}this.applyChangesToBase(e);var d=e,p=e;return a.forEach((function(e){p=Object(c.b)(p,e,!(e===r.submittedChangeset),r._apool,!1),d=p})),this.toSummitChangeset.changeSet=s.changeset,this.setAllChanges2Store(),d},e.prototype.checkChangeset=function(e,t){return Object(c.a)(e,this.getComposedCS(e),this._baseAText,this._apool,t)},e.prototype.getComposedCS=function(e){var t=this,o=i.Changeset.identity(this._baseAText.text.length);return this.submittedChangeset&&this.submittedChangeset.changeset&&(o=i.Changeset.compose(o,this.submittedChangeset.changeset,this._apool)),this.queueChanges&&this.queueChanges.forEach((function(e){e.changeset&&(o=i.Changeset.compose(o,e.changeset,t._apool))})),this.toSummitChangeset.isIdentity()||(o=i.Changeset.compose(o,this.toSummitChangeset.changeSet,this._apool)),o=i.Changeset.compose(o,e,this._apool)},e.prototype.composeUserChangeset=function(e){this.toSummitChangeset.changeSet=i.Changeset.compose(this.toSummitChangeset.changeSet,e,this._apool),this.toSummitChangeset.changeSetCount+=1,this.setUserChangeset2Store()},e.prototype.checkBeyondMaxLength=function(){if(this.toSummitChangeset.changeSet&&this.toSummitChangeset.changeSet.length>1e3&&!this.toSummitChangeset.isIdentity())return this.queueChanges.push({changeset:this.toSummitChangeset.changeSet,commitId:this.toSummitChangeset.commitId,keydata:!1,subId:this.subId,head:!1,oSubId:!1,changeSetCount:this.toSummitChangeset.changeSetCount}),this.toSummitChangeset.makeIdentity(i.Changeset.newLen(this.toSummitChangeset.changeSet||"")),this.toSummitChangeset.resetcommitId(),this.setUserChangeset2Store(),this.setQueueChanges2Store(),!0},e.prototype.getAllAttributedText=function(){var e=this,t=i.Changeset.cloneAText(this._baseAText);return this.submittedChangeset&&this.submittedChangeset.changeset&&(t=i.Changeset.applyToAText(this.submittedChangeset.changeset,t,this._apool)),this.queueChanges&&this.queueChanges.forEach((function(o){o.changeset&&(t=i.Changeset.applyToAText(o.changeset,t,e._apool))})),this.toSummitChangeset.isIdentity()||(t=i.Changeset.applyToAText(this.toSummitChangeset.changeSet,t,this._apool)),t},e.prototype.getUncommitedInfo=function(){var e="",t=0;try{this.submittedChangeset&&this.submittedChangeset.changeset&&(e+=i.Changeset.charBank(this.submittedChangeset.changeset),t+=this.submittedChangeset.changeSetCount||1),this.queueChanges.forEach((function(o){o.changeset&&(e+=i.Changeset.charBank(o.changeset),t+=o.changeSetCount||1)})),this.toSummitChangeset.isIdentity()||(e+=i.Changeset.charBank(this.toSummitChangeset.changeSet),t+=this.toSummitChangeset.changeSetCount||1)}catch(e){l.Logger.error("getUncommitedCharBank error",e)}return{charBank:e,csCount:t}},e.prototype.prepareWireData=function(e){if(!e||!e.changeset)return null;var t=d({},e),o=i.Changeset.prepareForWire(e.changeset,this._apool);return t.apool=o.pool.toJsonable(),t.changeset=o.translated,t},e.prototype.applyNewPool=function(e){var t=e;if(t.apool&&t.changeset){var o=i.AttribPool.fromJsonable(t.apool);t.changeset=i.Changeset.moveOpsToNewPool(t.changeset,o,this._apool)}return t},e.prototype.prepareUserChangeset=function(){var e={};if(this.submittedChangeset?(l.Logger.info("[MOUDULE_CHANGESET]|prepareUserChangeset:from submit"),e=this.submittedChangeset):this.queueChanges.length>0?(e=this.queueChanges.shift(),this.setQueueChanges2Store()):this.toSummitChangeset.isIdentity()||(l.Logger.info("[MOUDULE_CHANGESET]|prepareUserChangeset:from user"),e={changeset:this.toSummitChangeset.changeSet,commitId:this.toSummitChangeset.commitId,keydata:!1,subId:this.subId,head:!1,oSubId:!1,changeSetCount:this.toSummitChangeset.changeSetCount},this.toSummitChangeset.makeIdentity(i.Changeset.newLen(e.changeset)),this.toSummitChangeset.resetcommitId(),this.setUserChangeset2Store()),e.changeset){this.submittedChangeset=d({},e);var t=i.Changeset.prepareForWire(e.changeset,this._apool);e.apool=t.pool.toJsonable(),e.changeset=t.translated,this.setSubmittedChangeset2Store(e)}return l.Logger.info("[MOUDULE_CHANGESET]|prepareUserChangeset:"+e.changeset),e},e.prototype.prepareOfflineData=function(e){var t=this.prepareWireData(e);return t&&!t.commitId&&(t.commitId=a.a.createMessageSeq()),t},e.prototype.setUserChangeset2Store=function(){var e=null;this.toSummitChangeset.isIdentity()||(e=this.prepareOfflineData({changeset:this.toSummitChangeset.changeSet,commitId:this.toSummitChangeset.commitId,keydata:!1,subId:this.subId,head:!1,oSubId:!1})),u.GlobalContext.run(r.SetData2Store,n.UserChangeset,e),this._hasReportEdit||(u.GlobalContext.run(h.b.reportEdit),this._hasReportEdit=!0)},e.prototype.setSubmittedChangeset2Store=function(e){var t=this.submittedChangeset;e&&"object"==typeof e?t=e:t&&"object"==typeof t&&(t=this.prepareOfflineData(t)),u.GlobalContext.run(r.SetData2Store,n.SubmittedChangeset,t)},e.prototype.setQueueChanges2Store=function(){var e=this,t=[];this.queueChanges.forEach((function(o){var n=e.prepareOfflineData(o);n&&t.push(n)})),u.GlobalContext.run(r.SetData2Store,n.QueueChanges,t)},e.prototype.setAllChanges2Store=function(){this.setUserChangeset2Store(),this.setSubmittedChangeset2Store(),this.setQueueChanges2Store()},e.prototype.setSummitedForCommitId=function(e,t){this.submittedChangeset&&(this.submittedChangeset.commitId=e,this.submittedChangeset.firstCommitRev=t,this.setSubmittedChangeset2Store())},e.prototype.resetSummited=function(){this.submittedChangeset&&(this._submittedChangeset=null,this.setSubmittedChangeset2Store())},e}()},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,o){},,,,,,,,function(e,t,o){},function(e,t,o){},function(e,t,o){},function(e,t,o){"use strict";o.r(t);var n=o(33),r=o(32),i=function(){function e(){}return e.prototype.tdwReport=function(e,t){Object(r.tdw)(e,t)},e.prototype.tdwReportSingle=function(e){Object(r.tdwSingle)(e)},e.prototype.setPadType=function(e){window.clientVars&&(window.clientVars.padType=e,Object(r.resetDefaultTdwData)())},e}();window.ClientVarsPromise&&window.ClientVarsPromise.then((function(){Object(r.resetDefaultTdwData)()}));var a=o(0),s=new Map([["playBackgroundMusic",a.MonitorName.IGNORE_JS_ERROR_PLAY_BACKGROUND_MUSIC],["setKeyboardHeight is not defined",a.MonitorName.IGNORE_JS_ERROR_SET_KEYBOARD_HEIGHT],["Cannot read property 'test' of undefined",a.MonitorName.IGNORE_JS_ERROR_TEST],["WeixinJSBridge",a.MonitorName.IGNORE_JS_ERROR_WEIXIN_JSBRIDGE],["__wx._ready is not a function",a.MonitorName.IGNORE_JS_ERROR_WEIXIN_JSBRIDGE],["captured exception, need break and refresh",a.MonitorName.IGNORE_JS_ERROR_CAPTURED_EXCEPTION],["reLocateForNative is not defined",a.MonitorName.IGNORE_JS_ERROR_RELOCATEFORNATIVE],["null is not an object (evaluating 'document.getElementById('common-banner-mo').style')",a.MonitorName.IGNORE_JS_ERROR_COMMON_BANNER],["vivoNewsDetailPage",a.MonitorName.IGNORE_JS_ERROR_VIVO],["x5onSkinSwitch is not defined",a.MonitorName.IGNORE_JS_ERROR_X5],["cefQuery is not defined",a.MonitorName.IGNORE_JS_ERROR_CEFQUERY],["ExecuteJsInterface",a.MonitorName.IGNORE_JS_ERROR_EXECUTE_JS_INTERFACE],["qtconfig is not defined",a.MonitorName.IGNORE_JS_ERROR_QTCONFIG],["null is not an object (evaluating 'document.getElementById('np_id').innerText')",a.MonitorName.IGNORE_JS_ERROR_QTCONFIG],["null is not an object (evaluating 'document.getElementById('p_is_not_community').innerText')",a.MonitorName.IGNORE_JS_ERROR_QTCONFIG],["$skyuc_src",a.MonitorName.IGNORE_JS_ERROR_LOWB_INJECTION],["MacPlayer",a.MonitorName.IGNORE_JS_ERROR_LOWB_INJECTION],["Player is not defined",a.MonitorName.IGNORE_JS_ERROR_LOWB_INJECTION],["Can't find variable: Player",a.MonitorName.IGNORE_JS_ERROR_LOWB_INJECTION],["theurl is not defined",a.MonitorName.IGNORE_JS_ERROR_LOWB_INJECTION],["Can't find variable: theurl",a.MonitorName.IGNORE_JS_ERROR_LOWB_INJECTION],["null is not an object (evaluating 'document.getElementById('Xfplay').innerHTML')",a.MonitorName.IGNORE_JS_ERROR_LOWB_INJECTION],["window.parent.param",a.MonitorName.IGNORE_JS_ERROR_LOWB_INJECTION],["window.mttLongPressVar.tagName",a.MonitorName.IGNORE_JS_ERROR_LOWB_INJECTION],["ToutiaoJSBridge",a.MonitorName.IGNORE_JS_ERROR_LOWB_INJECTION],["OnReceiveTransparentMsg",a.MonitorName.IGNORE_JS_ERROR_LOWB_INJECTION],["processRandomSelector",a.MonitorName.IGNORE_JS_ERROR_LOWB_INJECTION],["ucbrowser",a.MonitorName.IGNORE_JS_ERROR_LOWB_INJECTION],["updateBookMallStatus",a.MonitorName.IGNORE_JS_ERROR_LOWB_INJECTION],["Umeditor",a.MonitorName.IGNORE_JS_ERROR_LOWB_INJECTION],["ZhihuiOS",a.MonitorName.IGNORE_JS_ERROR_LOWB_INJECTION],["document.getElementsByTagName('video')[0].setAttribute",a.MonitorName.IGNORE_JS_ERROR_LOWB_INJECTION],["Cannot read property 'content' of undefined",a.MonitorName.IGNORE_JS_ERROR_LOWB_INJECTION],["extractNovelContent",a.MonitorName.IGNORE_JS_ERROR_LOWB_INJECTION],["zhShareHandler",a.MonitorName.IGNORE_JS_ERROR_LOWB_INJECTION]]),c=Array.from(s.keys()),l=new Map([[a.MonitorName.JQUERY_REWRITE_ERROR,33871763],[a.MonitorName.FRAME_DROP_NORMAL,33670974],[a.MonitorName.FRAME_DROP_SERIOUS,33711514]]),u=new Map([]),h=new Map([[a.MonitorName.JQUERY_REWRITE_ERROR,"72001"],[a.MonitorName.CHANGESET_ERROR_DELTA2CS,"72101"],[a.MonitorName.CHANGESET_ERROR_VERIFY,"72102"],[a.MonitorName.CHANGESET_ERROR_VERIFY_MODELEN,"72103"],[a.MonitorName.CHANGESET_ERROR_APPLY_ONLINE,"72104"]]);var d,p=o(10),f=o.n(p),m=o(2),g=o(5),b=function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a},y=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},v="BaseMonitorHandler",C=function(){function e(){this.lastJquery=f.a,this.hasJqueryErrorReport=!1,this.didLogError=!1,this.logErrorCount=0,this.isAutoTest=!1}return e.prototype.initMonitorErrorReport=function(){var e=this;try{window.addEventListener("error",(function(t){e.handleJsError(t)}))}catch(e){console.error(e)}var t=n.a.getUrlParameter("currentEnv");t&&"autotest"===t&&(this.isAutoTest=!0)},e.prototype.monitor=function(e){var t=this.getMonitorId(e);t&&t>0?this.doMonitor(t):m.Logger.error(v,"monitor("+e+") with monitorId:"+t+" is not allowed")},e.prototype.monitorWtihPlatform=function(e){var t=this.getMonitorInfo(e);if(t){var o=void 0;(o=m.PlatformUtil.isMac()?t.MAC:t.PC)>0?this.doMonitor(o):m.Logger.error(v,"monitorWtihPlatform("+e+") with monitorId:"+o+" is not allowed"),t.TOTAL>0?this.doMonitor(t.TOTAL):m.Logger.error(v,"monitorWtihPlatform("+e+") with monitorId:"+t.TOTAL+" is not allowed")}else m.Logger.error(v,"monitorWtihPlatform("+e+") with monitorInfo:"+t+" is not allowed")},e.prototype.doMonitor=function(e){r.AlloyReport.monitor(e)},e.prototype.getMonitorId=function(e){return l.get(e)},e.prototype.getMonitorInfo=function(e){return u.get(e)},e.prototype.handleJsError=function(e){if(!n.a.isDevEvn())if(this.isAutoTest)a.ReportHelper.captureException(a.MonitorName.AUTO_TEST_ERROR,{},e.error);else if(!this.checkNonEditError(e)&&!this.checkInjectError(e)&&(this.checkJqueryRewriteError(),!this.reportIgnoreError(e))){this.monitorWtihPlatform(a.MonitorName.JS_ERROR_RELEASE),n.a.isGrayEvn()&&this.monitorWtihPlatform(a.MonitorName.JS_ERROR_GRAY);var t=this.workbench.context.appid;t&&this.monitor(a.MonitorName.JS_ERROR_TOB),this.didLogError||(this.didLogError=!0,this.monitorWtihPlatform(a.MonitorName.JS_ERROR_RELEASE_ONCE),t&&this.monitorWtihPlatform(a.MonitorName.JS_ERROR_TOB_ONCE),a.ReportHelper.tdwReport({opername:"tech_melo_quality",module:"page_detail",action:"js_error"})),this.reportActive(e),this.logErrorCount+=1,10!==this.logErrorCount&&100!==this.logErrorCount||a.ReportHelper.captureException(10===this.logErrorCount?a.MonitorName.JS_ERROR_FREQUENT:a.MonitorName.JS_ERROR_FREQUENT_HUNDRED,{},e.error)}},e.prototype.checkNonEditError=function(e){var t=e&&e.error&&e.error.stack;if(t){var o=t.split("\n    at ");if(o&&o[1]){if(o[1].indexOf("tim/docs/components")>=0)return a.ReportHelper.captureException(a.MonitorName.NON_EDIT_ERROR,{logger:a.RavenLogger.NON_EDIT_ERROR},e.error),!0;if(o[1].indexOf("chrome-extension")>=0)return!0}}return!1},e.prototype.checkJqueryRewriteError=function(){this.hasJqueryErrorReport||this.lastJquery===f.a||(a.ReportHelper.captureException(a.MonitorName.JQUERY_REWRITE_ERROR,{option:{needBreakAndRefresh:!0}}),this.hasJqueryErrorReport=!0)},e.prototype.reportIgnoreError=function(e){var t=this,o=e&&e.message||"",n=!1;return s.forEach((function(e,r){o.match(r)&&(t.monitor(e),n=!0)})),n},e.prototype.reportActive=function(e){if(e){var t=new Error,o=e.error&&e.error.stack;t.stack=o,t.message+=e.message+"\n"+e.filename+"\n"+e.lineno+":"+e.colno+"\n"+o,a.ReportHelper.captureException(a.MonitorName.ACTIVE_REPORT_ERROR,{},t)}},e.prototype.checkInjectError=function(e){if(e&&!e.error&&"Script error."===e.message){if(["lofter","tieba","MiuiBrowser","zhihu","HuaweiBrowser","VivoBrowser","UCBrowser"].some((function(e){return navigator.userAgent.match(e)})))return!0}var t=e&&e.error&&e.error.stack;if(t&&!t.split("\n    at ").slice(1).some((function(e){return e.indexOf("<anonymous>:")<0})))return!0;return!1},b([Object(g.l)(),y("design:type",g.B)],e.prototype,"workbench",void 0),e}(),_="https://87c778432c1b4f27907096e2acedf142@report.url.cn/sentry/1232",w=[{test:function(e){return e&&e.logger&&e.logger===a.RavenLogger.CHANGESET_COMMIT},dsn:"https://b8eed512dd95419dbea0ad60fd680783@report.url.cn/sentry/1117",project:"1117"},{test:function(e){return e&&e.logger&&e.logger===a.RavenLogger.ACTIVE_REPORT},dsn:"https://34cbab6cdf414cdcbce72b7f25788326@report.url.cn/sentry/1136",project:"1136"},{test:function(e){return e&&e.logger&&e.logger===a.RavenLogger.NON_EDIT_ERROR},dsn:"https://9b058056110f4bae91752d43db073a79@report.url.cn/sentry/1794",project:"1794"},{test:function(e){return!0},dsn:_,project:"1232"}],S=new Map([[a.MonitorName.CHANGESET_ERROR_RELEASE,34602383],[a.MonitorName.CHANGESET_ERROR_GRAY,34602384],[a.MonitorName.CHANGESET_ERROR_TOB,35130144],[a.MonitorName.CHANGESET_ERROR_ONCE,34725847],[a.MonitorName.CHANGESET_ERROR_CONTINUE,34793477],[a.MonitorName.CHANGESET_ERROR_INIT,34643531],[a.MonitorName.CHANGESET_ERROR_APPLY_DELTA,34643532],[a.MonitorName.CHANGESET_ERROR_DELTA2CS,34643533],[a.MonitorName.CHANGESET_ERROR_APPLY_OFFLINE,34643534],[a.MonitorName.CHANGESET_ERROR_APPLY_ONLINE,34643535],[a.MonitorName.CHANGESET_ERROR_EASYSYNC,34643536],[a.MonitorName.CHANGESET_ERROR_VERIFY,34643537],[a.MonitorName.CHANGESET_ERROR_VERIFY_MODELEN,34866646],[a.MonitorName.CHANGESET_ERROR_MAIN_RANGE,34644993],[a.MonitorName.JS_ERROR_TOB,35130141],[a.MonitorName.HTML_PARSE_ERROR,34622047],[a.MonitorName.NON_EDIT_ERROR,34760843],[a.MonitorName.AUTO_TEST_ERROR,34884338],[a.MonitorName.DATA_PRODUCE,34784731],[a.MonitorName.DATA_PRODUCE_TABLE_HEADER,34784732],[a.MonitorName.DATA_PRODUCE_TABLE,34784733],[a.MonitorName.DATA_TRANSFORM,34784734],[a.MonitorName.DATA_TRANSFORM_TABLE,34784735],[a.MonitorName.DATA_VERIFY,34784736],[a.MonitorName.DATA_COMPOSE,34784737],[a.MonitorName.DATA_COMPOSE_TABLE_HEADER,34784738],[a.MonitorName.DATA_COMPOSE_TABLE,34784739],[a.MonitorName.DATA_ACCEPT,34784740],[a.MonitorName.DATA_ACCEPT_TABLE_HEADER,34784741],[a.MonitorName.DATA_ACCEPT_TABLE,34784742],[a.MonitorName.DATA_PRODUCE_ERROR_FRONT,34784743],[a.MonitorName.DATA_PRODUCE_ERROR_BACK,34784744],[a.MonitorName.DATA_PRODUCE_ERROR_TIMEOUT,34868728],[a.MonitorName.DATA_PRODUCE_ERROR_TIPS,34868729],[a.MonitorName.DATA_PRODUCE_LITTLE_UNCOMMIT,34868730],[a.MonitorName.HOT_UPGRADE,34793469],[a.MonitorName.HOT_UPGRADE_STOCK,34795331],[a.MonitorName.TABLE_MERGE,34972282],[a.MonitorName.HAS_TABLE,35097880],[a.MonitorName.PV_PUBLISH,35023644],[a.MonitorName.PV_TOB,35118503],[a.MonitorName.TABLE_DATA_CHECK_FAILED,35081471],[a.MonitorName.TABLE_DATA_FIX_FAILED,35089798],[a.MonitorName.COMMENT_INVALID_PLACEHOLDER,35118873],[a.MonitorName.COMMENT_REPEAT_FIX,35130600],[a.MonitorName.COMMENT_UPGRADE,35129282]]),E=new Map([[a.MonitorName.JS_ERROR_RELEASE,{ANDROID:34278275,IOS:34278276,MAC:34278277,PC:34278278,TOTAL:34278279}],[a.MonitorName.JS_ERROR_RELEASE_ONCE,{ANDROID:34278280,IOS:34278281,MAC:34278282,PC:34278283,TOTAL:34278284}],[a.MonitorName.JS_ERROR_GRAY,{ANDROID:34278285,IOS:34278286,MAC:34278287,PC:34278288,TOTAL:34278289}],[a.MonitorName.JS_ERROR_TOB_ONCE,{ANDROID:35148829,IOS:35148830,MAC:35148831,PC:35148832,TOTAL:35137422}],[a.MonitorName.PV,{ANDROID:34446817,IOS:34446818,MAC:34446819,PC:34446820,TOTAL:34446821}]]),T=(d=function(e,t){return(d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}d(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),R=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return T(t,e),t.prototype.getMonitorId=function(t){return S.has(t)?S.get(t):e.prototype.getMonitorId.call(this,t)},t.prototype.getMonitorInfo=function(t){return E.has(t)?E.get(t):e.prototype.getMonitorInfo.call(this,t)},t}(C),I=o(19),O=o(12),P=function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a},k=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},N=function(){function e(){this.didLogError=!1,this.isAutoTest=!1}return e.prototype.captureException=function(e,t,o){var r=t.option||{};delete t.option;var i=o||new Error;if(i.name=e+(n.a.isDevEvn()?"_DEV":""),t.logger===a.RavenLogger.CHANGESET_COMMIT&&(this.didLogError&&(i.name+="_CONTINUE"),i.message+="\n,changesetLog: "+JSON.stringify(a.GlobalContext.run(I.b.get)),i.message+="\n,offlineChangesetLog: "+a.GlobalContext.run(I.b.getFromStore)),this.buildAdditionalData(e,t),window.Raven&&window.Raven.captureException(i,t),n.a.isDevEvn()||(a.ReportHelper.monitor(e),t.logger===a.RavenLogger.CHANGESET_COMMIT&&(a.ReportHelper.monitor(a.MonitorName.CHANGESET_ERROR_RELEASE),n.a.isGrayEvn()&&a.ReportHelper.monitor(a.MonitorName.CHANGESET_ERROR_GRAY),this.workbench.context.appid&&a.ReportHelper.monitor(a.MonitorName.CHANGESET_ERROR_TOB),this.didLogError?a.ReportHelper.monitor(a.MonitorName.CHANGESET_ERROR_CONTINUE):(this.didLogError=!0,a.ReportHelper.monitor(a.MonitorName.CHANGESET_ERROR_ONCE)))),r.needBreakAndRefresh){var s=function(e){return h.get(e)||"72999"}(e);throw m.Logger.info("captureException","errorCode:"+s),this.workbench.context.collabClient.shutDownRoomChannel(e,Number(s)),new Error("captured exception, need break and refresh")}},e.prototype.buildAdditionalData=function(e,t){t.extra||(t.extra={}),t.tags||(t.tags={});var o=Object(O.c)();return o&&(t.extra.padId=o.padId,t.tags.padId=o.padId),t},e.prototype.initSentryErrorReport=function(){var e=this;this.setTagsContext(),window.Raven&&window.Raven.config(this.getDefaultDsn(),{release:window.__globalReleaseVersion,ignoreErrors:c,dataCallback:function(t){e.dataCallback(t)},autoBreadcrumbs:{console:!1}}).install(),window.aegis&&window.aegis.setConfig({beforeReport:function(e){return 4!=e.level||!e.msg||!c.some((function(t){return e.msg.match(t)}))}})},e.prototype.dataCallback=function(e){var t=this.getRavenConfigList();if(t&&t.length>0)for(var o=0;o<t.length;o++){var n=t[o];if(n.test&&n.test(e)){e.project!==n.project&&(window.Raven&&window.Raven.setDSN(n.dsn),e.project=n.project);break}}return m.Logger.raven(e)},e.prototype.setTagsContext=function(){try{var e=n.a.getCookie("uid"),t=n.a.isDevEvn()?"development":"production",o={plantform:"pc",uid:e,enviroment:t,codeVer:"melo"},r=n.a.getUrlParameter("currentEnv");r&&(o.currentEnv=r,"autotest"===r&&(this.isAutoTest=!0)),window.Raven&&window.Raven.setTagsContext(o)}catch(e){m.Logger.error(e)}},P([Object(g.l)(),k("design:type",g.B)],e.prototype,"workbench",void 0),e}(),M=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),D=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return M(t,e),t.prototype.getDefaultDsn=function(){return _},t.prototype.getRavenConfigList=function(){return w},t}(N),x=o(141),A=o.n(x);var L,F=o(1),B=o.n(F),U=o(11),j=o.n(U),G=o(86),H=o(159),V=["spell-item0","spell-item1","spell-item2","spell-item3","spell-item4","divider","spell-replace-one","spell-replace-all","divider","cut","copy","paste","paste-merge","paragraph-format","delete","image-cropper","image-reset","image-download",{key:"splitline-color",items:["splitline-color-component"]},{key:"splitline-style",items:["splitline-style-normal","splitline-style-normal-bold-2","splitline-style-normal-bold-3","splitline-style-normal-bold-8","splitline-style-normal-bold-12","splitline-style-dashed","splitline-style-dotted","splitline-style-space-dotted","splitline-style-wavy","splitline-style-wavy-bold-2","splitline-style-wavy-bold-4","splitline-style-wavy-double","splitline-style-shading-v","splitline-style-shading-x","splitline-style-shading-slash"]},"divider","insertRowAbove","insertRowBelow","removeRow","divider","insertColLeft","insertColRight","removeCol","divider","mergeCells","splitCells","deleteTable","divider","comment","divider","insert_link","divider","modify_link","open_link","divider","clear-format","restartNumbering","continueNumbering"],W=[{key:"file",items:[{key:"new",items:["new-doc","new-sheet","new-ppt","new-form","divider","new-folder"]},"import-file","divider",{key:"export-as",items:["export-as-docx","snap-screen","shortcut"]},"clone","save-as-template","publish","divider","edit-history","view-history","change-owner","divider","print","divider",{key:"help-center",items:["faq","feedback","report","about"]}]},{key:"insert",items:["insert-image",{key:"insert-table",items:["table-panel"]},"insert-link","insert-codeblock","divider",{key:"insert-splitline",items:["splitline-normal","splitline-normal-bold-2","splitline-normal-bold-3","splitline-normal-bold-8","splitline-normal-bold-12","splitline-dashed","splitline-dotted","splitline-space-dotted","splitline-wavy","splitline-wavy-bold-2","splitline-wavy-bold-4","splitline-wavy-double","splitline-shading-v","splitline-shading-x","splitline-shading-slash","divider",{key:"insert-splitline-color",items:["insert-splitline-color-component"]}]},{key:"insert-page-info",items:["insert-page-header","insert-page-footer",{key:"insert-page-number",items:["insert-page-number-at-cursor","insert-page-number-at-header","insert-page-number-at-footer"]}]},"insert-page-break","divider","insert-doc-link","insert-comment"]},{key:"more",items:[{key:"format-common",items:[{key:"heading",items:["normal","divider","title","subtitle","divider","heading1","heading2","heading3","heading4","heading5","heading6","heading7","heading8","heading9"]},{key:"font-emphasis",items:["bold","italic","underline","strike-through","sup","sub",{key:"letter-spacing",items:["letter-spacing-component"]},{key:"font-color",items:["font-color-component"]},{key:"font-background",items:["font-background-component"]}]},{key:"paragraph",items:[{key:"align",items:["align-left","align-center","align-right","align-justify"]},{key:"line-height",items:["line-height-1","line-height-1.15","line-height-1.3","line-height-1.5","line-height-2","line-height-3","divider","more-line-height-setting"]},{key:"indent",items:["increase-indent","decrease-indent"]},"more-paragraph-settings"]},"divider","clear-format"]},{key:"format-table",items:[{key:"table-border",items:["table-border-component",{key:"table-border-color",items:["table-border-color-component"]}]},{key:"table-fill-color",items:["table-fill-color-component"]},"merge-cell",{key:"table-horizental-align",items:["table-horizental-align-left","table-horizental-align-center","table-horizental-align-right","table-horizental-align-justify"]},{key:"table-vertical-align",items:["table-vertical-align-top","table-vertical-align-center","table-vertical-align-bottom"]}]},{key:"format-splitline",items:["format-splitline-normal","format-splitline-normal-bold-2","format-splitline-normal-bold-3","format-splitline-normal-bold-8","format-splitline-normal-bold-12","format-splitline-dashed","format-splitline-dotted","format-splitline-space-dotted","format-splitline-wavy","format-splitline-wavy-bold-2","format-splitline-wavy-bold-4","format-splitline-wavy-double","format-splitline-shading-v","format-splitline-shading-x","format-splitline-shading-slash","divider",{key:"format-splitline-color",items:["format-splitline-color-component"]}]},{key:"page-header-footer",items:["insert-page-header","insert-page-footer",{key:"insert-page-number",items:["insert-page-number-at-cursor","insert-page-number-at-header","insert-page-number-at-footer"]},{key:"format-page-number",items:["format-page-number-start-from-1","format-page-number-start-from-0"]}]},"divider","view-toc","view-comment","view-page","view-fullscreen","divider","page-settings",{key:"page-background",items:["watermark","shading"]},"divider","find-replace"]},{key:"smart-tools",items:["spellcheck","translate","markdown"]}],Q={left:["toc","page","word-count"],right:["play","full-screen","zoom"]},q={normal:[["undo","redo","format-paint","clear-format"],["toolbar-insert"],["heading","font","font-size"],["bold","italic","underline","strike-through","font-color","font-background-color"],["alignment","bullet-list","numbered-list","task-list","desc-indent","inc-indent"],["find-replace","smart-tools"]],pinned:["avatar","titlebar-toggle"]},Y={normal:[["undo","redo","format-paint","clear-format"],["toolbar-insert"],["font","font-size"],["bold","italic","underline","strike-through","font-color","font-background-color"],["alignment","align-vertical"],["bullet-list","numbered-list","task-list"],["cell-color","cell-border","cell-merge"]],pinned:["avatar","titlebar-toggle"]},J=o(47),z=o(98),K=o(97),X={app:"doc",version:"v_20200922195327_release",common:{titlebar:{account:!0,auth:!0,back:!0,collaborators:!0,collect:!0,fileMenu:!0,login:!0,logo:!0,moreMenu:!0,move:!0,presentation:!0,readonly:!0,saveState:!0,share:!0,title:!0},toolbar:{"titlebar-toggle":!0},statusbar:{},menu:{},blankpage:{applyEditPermission:!0,applyViewPermission:!0,back:!0,comment:!0,errImg:!0,feedbackQuestion:!0,footer:!0,login:!0,refresh:!0,switchAccount:!0,watchOfficeAccount:!0}},custom:{widget:{"help-center":!0},contextmenu:{},feature:{ad_mobile:!0,app_guide:!0,app_guide_pc:!0,audio:!0,codeblock:!0,collab_caret:!0,collab_status:!0,collab_status_mobile:!0,comment:!0,comment_mobile:!0,comment_pc:!0,contextmenu_mobile:!0,core_edit:!0,doc_preview:!0,doc_view_mobile:!0,docx_database_proxy:!0,docx_deferred_render:!0,docx_docx_render:!0,docx_pages:!0,docx_right_bar:!0,docx_tools:!0,fake_toolbar:!0,field_processor:!0,fieldcode:!0,fieldcode_date:!0,fieldcode_doc_link:!1,fieldcode_doclink_render:!0,fieldcode_mention:!0,fieldcode_mention_render:!0,fieldcode_page:!0,file_base:!0,file_export:!0,file_mobile:!0,file_pc:!0,font:!0,fullscreen:!0,help_center:!0,help_center_mobile:!0,home_mobile:!0,image:!0,image_mobile:!0,image_pc:!0,image_readonly:!0,link:!0,list:!0,list_readonly:!0,location:!0,login:!0,manual_offline:!0,markdown:!0,mobile_header:!0,mobile_tips:!0,mobile_view:!0,move_to:!0,move_to_mobile:!0,newpad_input_tips:!0,ocr:!0,ocr_preview:!0,offline_edit:!0,outline:!0,outline_mobile:!0,page:!0,page_shade:!0,paragraph:!0,performance_report:!0,presentation:!0,print:!0,publish:!0,read_record:!0,readonly_mobile_toolbar:!0,readonly_tips:!0,readonly_toolbar:!0,recover_doc:!0,revision_record:!0,scroll_position:!0,search:!0,section:!0,selective_paste:!0,share:!0,share_mobile:!0,snap_screen_mobile:!0,snap_screen_pc:!0,spellcheck:!0,splitline:!0,splitline_readonly:!0,star_mobile:!0,table:!0,tdocs_deferred_render:!0,tdocs_render:!0,template_info:!0,text_flow:!0,title:!0,title_default_add:!0,title_mobile:!0,titlebar:!0,titlebar_mobile:!0,translate:!0,unread_notify:!0,update_notice:!0,user_avatar:!0,vip:!0,voice_input:!0,watermark:!0,word_count:!0,zoom_base:!0,zoom_melo:!0,zoom_mobile:!0,zoom_pc:{wheel:!0}}}},Z={app:"doc",version:"v_20200922195306_release",common:{titlebar:{account:!1,auth:!1,back:!1,collaborators:!1,collect:!1,fileMenu:!1,login:!1,logo:!0,moreMenu:!1,move:!1,presentation:!1,readonly:!1,saveState:!1,share:!0,title:!0},toolbar:!1,statusbar:!1,menu:{},blankpage:{applyEditPermission:!0,applyViewPermission:!0,back:!0,comment:!0,errImg:!0,feedbackQuestion:!0,footer:!0,login:!0,refresh:!0,switchAccount:!0,watchOfficeAccount:!0}},custom:{widget:{"help-center":!0},contextmenu:{},feature:{ad_mobile:!0,app_guide:!0,app_guide_pc:!0,audio:!0,codeblock:!0,collab_caret:!0,collab_status:!0,collab_status_mobile:!0,comment:!0,comment_mobile:!0,comment_pc:!0,contextmenu_mobile:!0,core_edit:!0,doc_preview:!0,doc_view_mobile:!0,docx_database_proxy:!0,docx_deferred_render:!0,docx_docx_render:!0,docx_pages:!0,docx_right_bar:!0,docx_tools:!0,fake_toolbar:!0,field_processor:!0,fieldcode:!0,fieldcode_date:!0,fieldcode_doc_link:!1,fieldcode_doclink_render:!0,fieldcode_mention:!0,fieldcode_mention_render:!0,fieldcode_page:!0,file_base:!0,file_export:!0,file_mobile:!0,file_pc:!0,font:!0,fullscreen:!0,help_center:!0,help_center_mobile:!0,home_mobile:!0,image:!0,image_mobile:!0,image_pc:!0,image_readonly:!0,link:!0,list:!0,list_readonly:!0,location:!0,login:!0,manual_offline:!0,markdown:!0,mobile_header:!0,mobile_tips:!0,mobile_view:!0,move_to:!0,move_to_mobile:!0,newpad_input_tips:!0,ocr:!0,ocr_preview:!0,offline_edit:!0,outline:!0,outline_mobile:!0,page:!0,page_shade:!0,paragraph:!0,performance_report:!0,presentation:!0,print:!0,publish:!0,read_record:!0,readonly_mobile_toolbar:!0,readonly_tips:!0,readonly_toolbar:!0,recover_doc:!0,revision_record:!0,scroll_position:!0,search:!0,section:!0,selective_paste:!0,share:!0,share_mobile:!0,snap_screen_mobile:!0,snap_screen_pc:!0,spellcheck:!0,splitline:!0,splitline_readonly:!0,star_mobile:!0,table:!0,tdocs_deferred_render:!0,tdocs_render:!0,template_info:!0,text_flow:!0,title:!0,title_default_add:!0,title_mobile:!0,titlebar:!0,titlebar_mobile:!0,translate:!0,unread_notify:!0,update_notice:!0,user_avatar:!0,vip:!0,voice_input:!0,watermark:!0,word_count:!0,zoom_base:!0,zoom_melo:!0,zoom_mobile:!0,zoom_pc:{wheel:!0}}}},ee={app:"doc",version:"v_20200922195337_release",common:{titlebar:!1,toolbar:!1,statusbar:!1,menu:{},blankpage:{applyEditPermission:!0,applyViewPermission:!0,back:!0,comment:!0,errImg:!0,feedbackQuestion:!0,footer:!0,login:!0,refresh:!0,switchAccount:!0,watchOfficeAccount:!0}},custom:{widget:{"help-center":!1},contextmenu:!1,feature:{ad_mobile:!0,app_guide:!1,app_guide_pc:!1,audio:!0,codeblock:!0,collab_caret:!1,collab_status:!0,collab_status_mobile:!0,comment:!0,comment_mobile:!1,comment_pc:!1,contextmenu_mobile:!0,core_edit:!0,doc_preview:!0,doc_view_mobile:!0,docx_database_proxy:!0,docx_deferred_render:!0,docx_docx_render:!0,docx_pages:!0,docx_right_bar:!0,docx_tools:!0,fake_toolbar:!0,field_processor:!0,fieldcode:!0,fieldcode_date:!0,fieldcode_doc_link:!1,fieldcode_doclink_render:!0,fieldcode_mention:!0,fieldcode_mention_render:!0,fieldcode_page:!0,file_base:!0,file_export:!0,file_mobile:!0,file_pc:!0,font:!0,fullscreen:!0,help_center:!0,help_center_mobile:!0,home_mobile:!0,image:!0,image_mobile:!0,image_pc:!0,image_readonly:!0,link:!0,list:!0,list_readonly:!0,location:!0,login:!0,manual_offline:!0,markdown:!0,mobile_header:!0,mobile_tips:!0,mobile_view:!0,move_to:!0,move_to_mobile:!0,newpad_input_tips:!0,ocr:!0,ocr_preview:!0,offline_edit:!0,outline:!1,outline_mobile:!0,page:!0,page_shade:!0,paragraph:!0,performance_report:!0,presentation:!0,print:!0,publish:!0,read_record:!0,readonly_mobile_toolbar:!0,readonly_tips:!0,readonly_toolbar:!0,recover_doc:!0,revision_record:!0,scroll_position:!0,search:!0,section:!0,selective_paste:!0,share:!0,share_mobile:!0,snap_screen_mobile:!0,snap_screen_pc:!0,spellcheck:!1,splitline:!0,splitline_readonly:!0,star_mobile:!0,table:!0,tdocs_deferred_render:!0,tdocs_render:!0,template_info:!1,text_flow:!0,title:!0,title_default_add:!0,title_mobile:!0,titlebar:!0,titlebar_mobile:!0,translate:!0,unread_notify:!0,update_notice:!0,user_avatar:!0,vip:!1,voice_input:!0,watermark:!0,word_count:!0,zoom_base:!0,zoom_melo:!0,zoom_mobile:!0,zoom_pc:{wheel:!0}}}},te={app:"doc",version:"v_20200922195317_release",common:{titlebar:!1,toolbar:!1,statusbar:{},menu:{},blankpage:{applyEditPermission:!0,applyViewPermission:!0,back:!0,comment:!0,errImg:!0,feedbackQuestion:!0,footer:!0,login:!0,refresh:!0,switchAccount:!0,watchOfficeAccount:!0}},custom:{widget:{"help-center":!0},contextmenu:{},feature:{ad_mobile:!0,app_guide:!0,app_guide_pc:!0,audio:!0,codeblock:!0,collab_caret:!0,collab_status:!0,collab_status_mobile:!0,comment:!0,comment_mobile:!0,comment_pc:!0,contextmenu_mobile:!0,core_edit:!0,doc_preview:!0,doc_view_mobile:!0,docx_database_proxy:!0,docx_deferred_render:!0,docx_docx_render:!0,docx_pages:!0,docx_right_bar:!0,docx_tools:!0,fake_toolbar:!0,field_processor:!0,fieldcode:!0,fieldcode_date:!0,fieldcode_doc_link:!1,fieldcode_doclink_render:!0,fieldcode_mention:!0,fieldcode_mention_render:!0,fieldcode_page:!0,file_base:!0,file_export:!0,file_mobile:!0,file_pc:!0,font:!0,fullscreen:!0,help_center:!0,help_center_mobile:!0,home_mobile:!0,image:!0,image_mobile:!0,image_pc:!0,image_readonly:!0,link:!0,list:!0,list_readonly:!0,location:!0,login:!0,manual_offline:!0,markdown:!0,mobile_header:!0,mobile_tips:!0,mobile_view:!0,move_to:!0,move_to_mobile:!0,newpad_input_tips:!0,ocr:!0,ocr_preview:!0,offline_edit:!0,outline:!0,outline_mobile:!0,page:!0,page_shade:!0,paragraph:!0,performance_report:!0,presentation:!0,print:!0,publish:!0,read_record:!0,readonly_mobile_toolbar:!0,readonly_tips:!0,readonly_toolbar:!0,recover_doc:!0,revision_record:!0,scroll_position:!0,search:!0,section:!0,selective_paste:!0,share:!0,share_mobile:!0,snap_screen_mobile:!0,snap_screen_pc:!0,spellcheck:!0,splitline:!0,splitline_readonly:!0,star_mobile:!0,table:!0,tdocs_deferred_render:!0,tdocs_render:!0,template_info:!0,text_flow:!0,title:!0,title_default_add:!0,title_mobile:!0,titlebar:!0,titlebar_mobile:!0,translate:!0,unread_notify:!0,update_notice:!0,user_avatar:!0,vip:!0,voice_input:!0,watermark:!0,word_count:!0,zoom_base:!0,zoom_melo:!0,zoom_mobile:!0,zoom_pc:{wheel:!0}}}},oe=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),ne=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return oe(t,e),t.prototype.initConfig=function(){var e;this.configService=g.m.get(J.a);var t=g.m.get(g.A);this.configService.setMode(z.a.PUBLISH,!!Object(m.getUrlParameter)("pub")),this.configService.setMode(z.a.PREVIEW,!!Object(m.getUrlParameter)("inToastPreview")||!!Object(m.getUrlParameter)("ocr")),this.configService.setMode(z.a.MINIMAL,!!Object(m.getUrlParameter)("minimal")||"reading"===Object(m.getUrlParameter)("mode")),this.configService.setConfig(z.a.NORMAL,X),this.configService.setConfig(z.a.PUBLISH,Z),this.configService.setConfig(z.a.PREVIEW,te),this.configService.setConfig(z.a.MINIMAL,ee),this.syncConfig(),K.getInstance().bind(this.configService.get("common")),K.getInstance().saveToSessionStorage();var o=null!==(e=this.configService.get("custom.widget"))&&void 0!==e?e:{};t.exclude(Object.keys(o).filter((function(e){return!o[e]})),"float")},t.prototype.syncConfig=function(){var e=!this.configService.get("common.toolbar"),t=!this.configService.get("common.titlebar");this.workbench.configure({disableToolbar:e,disableStatusbar:!this.configService.get("common.statusbar"),disableContextMenu:!this.configService.get("custom.contextmenu")}),(e||t)&&this.hidePreloadHeader()},t}(F.Component),re=o(78),ie=o(4),ae=o(89),se=o(52),ce=function(e,t){var o="function"==typeof Symbol&&e[Symbol.iterator];if(!o)return e;var n,r,i=o.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(e){r={error:e}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a},le=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(ce(arguments[t]));return e},ue=function(){function e(e){this.maxLength=10,this.list=[],void 0!==e&&(this.maxLength=e)}return e.prototype.push=function(e){return null!==e&&(this.list.length===this.maxLength&&this.list.shift(),this.list.push(e),!0)},e.prototype.pop=function(){return this.list.pop()},Object.defineProperty(e.prototype,"length",{get:function(){return this.list.length},enumerable:!0,configurable:!0}),e.prototype.get=function(e){if(!(e>=this.list.length))return this.list[e]},e.prototype.getList=function(){return this.list},e.prototype.popList=function(){var e=[];return e.push.apply(e,le(this.list)),this.list=[],e},e}(),he=o(243),de=function(){function e(e){this.context=e,this.supportFrameDropDetect=!1,this.animationFrameId=0,this.hasReportFrameDrop=!1,this.lastRenderTime=0,this.frameDropTimes=new ue(3),this.supportFrameDropDetect=!!window.requestAnimationFrame&&!!window.cancelAnimationFrame}return e.prototype.init=function(){var e=this;se.a.getInstance().isEditable&&this.supportFrameDropDetect&&(this.startAnimationFrame(),document.addEventListener("visibilitychange",(function(){e.handleVisibilityChange()})))},e.prototype.handleVisibilityChange=function(){m.Logger.info("FrameDropDetector","handleVisibilityChange "+(document.hidden?"hidden":"show")+" at "+new Date),document.hidden?(this.lastRenderTime=0,this.frameDropTimes.popList(),this.cancelAnimationFrame()):this.startAnimationFrame()},e.prototype.now=function(){return window.performance&&window.performance.now?window.performance.now():Date.now()},e.prototype.detecteFrameDrop=function(){if(!this.hasReportFrameDrop){var e=this.now(),t=this.lastRenderTime>0?e-this.lastRenderTime:0;if(t>1e4&&this.reportFrameDrop(t),t>3e3&&(this.frameDropTimes.push(this.lastRenderTime),this.frameDropTimes.length>=3)){var o=this.frameDropTimes.get(0);if(void 0!==o)e-o<=6e4&&this.reportFrameDrop(t)}this.lastRenderTime=e,this.startAnimationFrame()}},e.prototype.reportFrameDrop=function(e){var t=e>1e4;if(!n.a.isDevEvn()){var o=this.getFrameDropReportData(t);window.__isOfflinePkg,he.a.getInstance(Object(re.a)()).replaceUrlTime,he.a.replaceCount;0,a.ReportHelper.tdwReport(o,{immediate:!0}),a.ReportHelper.monitor(t?a.MonitorName.FRAME_DROP_SERIOUS:a.MonitorName.FRAME_DROP_NORMAL),this.hasReportFrameDrop=!0,document.removeEventListener("visibilitychange",this.handleVisibilityChange)}m.Logger.warn("FrameDropDetector","reportFrameDrop isSlowerRender: "+t+" "+e+",nowTime: "+new Date)},e.prototype.getFrameDropReportData=function(e){return{opername:"tech_doc_performance_melo",module:"page_detail",action:"edit_slow",source2:e?2:1,ver5:window.location.href,ver6:JSON.stringify(this.context.perfInfo),ver7:JSON.stringify(this.context.statisticInfo)}},e.prototype.startAnimationFrame=function(){var e=this;this.hasReportFrameDrop||(this.animationFrameId=window.requestAnimationFrame((function(){e.detecteFrameDrop()})))},e.prototype.cancelAnimationFrame=function(){this.animationFrameId&&(window.cancelAnimationFrame(this.animationFrameId),this.animationFrameId=0)},e}(),pe=o(160),fe=function(){function e(e){var t=this;this.fps=new pe.a,this.isScrolling=!1,this.SAMPLE_RATE=1,this.PARTITION=[[0,30,"0-30"],[30,40,"30-40"],[40,50,"40-50"],[50,56,"50-55"],[56,57,"56"],[57,58,"57"],[58,59,"58"],[59,60,"59"],[60,Number.POSITIVE_INFINITY,"60+"]],this.onScroll=Object(m.throttle)((function(){clearTimeout(t.scrollTimer),t.scrollTimer=setTimeout((function(){t.isScrolling=!1,t.end()}),300),t.isScrolling||(t.isScrolling=!0,t.start((function(e){for(var o=0,n=e.length-1;n>=0&&!((o+=e[n])>=300);n--);var r=t.calFPS(e.slice(0,n));m.Logger.log("perf|fps_scroll:"+JSON.stringify(r)),void 0!==r&&a.ReportHelper.tdwReport({opername:"quality_doc",module:"detail",action:"fps_scroll",ver7:r.average,ver8:r.partition,ver10:r.variance})})))}),100),this.editor=e}return e.prototype.shouldMonitor=function(){return 100*Math.random()<this.SAMPLE_RATE},e.prototype.start=function(e){var t=this;this.shouldMonitor()&&(this.currentListener=e,this.fps.addListener(this.currentListener),this.fps.start(),this.timeoutTimer=setTimeout((function(){t.end()}),1e4))},e.prototype.end=function(){this.fps.end(),this.fps.removeListener(this.currentListener),clearTimeout(this.timeoutTimer)},e.prototype.visible=function(){this.fps.visiable()},e.prototype.invisible=function(){this.fps.invisible()},e.prototype.reset=function(){this.editor.scrollHandler.removeScrollListener(this.onScroll),this.fps.removeListener(this.currentListener),this.fps.end()},e.prototype.calFPS=function(e){var t=this;if(e.length>4){var o=e.slice(2,e.length-2),n=1e3/(o.reduce((function(e,t){return e+t}),0)/o.length),r=0,i={};return o.forEach((function(e){var o=1e3/e;t.PARTITION.some((function(e){return o>=e[0]&&o<e[1]&&(i[e[2]]=(i[e[2]]||0)+1,!0)})),r+=Math.pow(o-n,2)})),{average:n,variance:Math.sqrt(r/o.length),partition:JSON.stringify(i)}}},e.prototype.startInitMonitor=function(){var e=this;this.start((function(t){var o=e.calFPS(t);m.Logger.log("perf|fps_init:"+JSON.stringify(o)),void 0!==o&&a.ReportHelper.tdwReport({opername:"quality_doc",module:"detail",action:"fps_init",ver7:o.average,ver8:o.partition,ver10:o.variance})}))},e.prototype.startScrollMonitor=function(){this.editor.scrollHandler.addScrollListener(this.onScroll)},e}(),me=o(162),ge=o(54),be=function(){function e(e,t,o){void 0===o&&(o="BB08J2"),this._collab=e,this._subId=o,this._tracking=!1,this._changeCallbackTimeout=null,this.store=new me.a(t,this._subId)}return e.prototype.initPadRev=function(e){this.getPadRev=e},e.prototype.setChangeCallbackTimeout=function(){var e=this;this._changeCallback&&null===this._changeCallbackTimeout&&(this._changeCallbackTimeout=window.setTimeout((function(){try{e._changeCallback&&e._changeCallback()}catch(e){}finally{e._changeCallbackTimeout=null}}),0))},e.prototype.setTotalBaseAttributeText=function(t,o,n){this._tracking=!0;try{var r=m.PerfUtil.now(),i=this.store.initAText(t,o),s=this._collab.setBaseAttributedText(i);n&&this.pushUpgradeChangeset(s);var c=m.PerfUtil.now()-r;m.Logger.log("perf|setTotalBaseAttributeText total="+c+"ms")}catch(t){m.Logger.error(e.LOG_TAG+" | "+t),a.ReportHelper.captureChangesetException(a.MonitorName.CHANGESET_ERROR_INIT,{option:{changesetDataType:a.ChangesetDataType.INIT_DATA}},t)}},e.prototype.applyOfflineChangesToBase=function(t,o,n,r){var i=this;try{m.Logger.info(e.LOG_TAG+" | applyOfflineChangesToBase");var s=[];t&&s.push(t),o&&o.forEach((function(e){s.push(e)})),(null==n?void 0:n.changeset)&&!ie.Changeset.isIdentity(n.changeset)&&s.push(n),s.forEach((function(e){i.store.applyNewPool(e)})),s.forEach((function(e){e.subId&&!e.applied&&i._collab.applyChangesToBase(e.changeset)})),s.forEach((function(e){e.changeset&&(e.offlineMsg=!0),i.store.queueChange(e)})),this.store.setAllChanges2Store(),this.store.queueChanges.length>0&&this.setChangeCallbackTimeout()}catch(e){var c=new CustomEvent("Melo_ChangesetErrorAlert",{detail:{code:72010}});document.dispatchEvent(c);var l=new Error;l.name=a.MonitorName.CHANGESET_ERROR_APPLY_OFFLINE;var u=" browser info : "+m.PlatformUtil.getBrowser()+"\n\n                ,this._userChangeset: "+JSON.stringify(this.store.toSummitChangeset.changeSet)+"\n\n                ,currentLength: "+ie.Changeset.oldLen(this.store.toSummitChangeset.changeSet)+"\n\n                ,offlineData: "+r+"\n\n                ,ex: "+JSON.stringify(e);l.message="{\n"+u+"\n}",m.Logger.error("report error, applyOffline_error: "+u),a.ReportHelper.captureChangesetException(a.MonitorName.CHANGESET_ERROR_APPLY_OFFLINE,{option:{changesetDataType:a.ChangesetDataType.INIT_DATA}},l)}},e.prototype.applyChangesToBase=function(t,o,n,r,i,s,c,l){if(this._tracking){ie.ChangesetTool.autoReport=!1;try{var u=this.store.applyWireChange(t,n,c,l);this._collab.applyChangesToBase(u),m.Logger.info("after follow, this._userChangeset:"+this.store.toSummitChangeset.debugString()+", subId:"+this._subId)}catch(t){m.Logger.error(e.LOG_TAG+" | applyOnline_error error: "+t),a.ReportHelper.tdwReport({opername:"doc_word_melo",module:"data_lost",action:"exp_tip",ver5:"1",ver6:a.EditorDocumentType.DOCUMENT,ver7:a.ChangesetDataType.APPLY_SERVER_DATA}),a.ReportHelper.captureChangesetException(a.MonitorName.CHANGESET_ERROR_APPLY_ONLINE,{option:{changesetDataType:a.ChangesetDataType.APPLY_SERVER_DATA}},t)}finally{ie.ChangesetTool.autoReport=!0}}},e.prototype.isTracking=function(){return this._tracking},e.prototype.setSummitedForCommitId=function(e,t){this.store.setSummitedForCommitId(e,t)},e.prototype.resetSummited=function(){this.store.resetSummited(),this.store.queueChanges.length>0&&this.setChangeCallbackTimeout()},e.prototype.prepareUserChangeset=function(){return this.store.prepareUserChangeset()},e.prototype.applyPreparedChangesetToBase=function(){this.store.applyPreparedChangesetToBase(this.getPadRev()),m.Logger.log("[MOUDULE_CHANGESET]|applyPreparedChangesetToBase store.queueChanges: "+this.store.queueChanges+", this.store.toSummitChangeset: "+this.store.toSummitChangeset.changeSet),(this.store.queueChanges.length>0||!this.store.toSummitChangeset.isIdentity())&&this.setChangeCallbackTimeout()},e.prototype.setUserChangeNotificationCallback=function(e){this._changeCallback=e},e.prototype.hasUncommittedChanges=function(){return this.store.hasUncommittedChanges()},e.prototype.isAppliedToBasetext=function(){if(this.store.submittedChangeset)return!!this.store.submittedChangeset.applied;var e=!1;return this.store.queueChanges&&this.store.queueChanges.forEach((function(t){e=!!t.applied})),e},e.prototype.composeUserChangeset=function(e){this._tracking&&(ie.Changeset.isIdentity(e)||(this.isAppliedToBasetext()||this.store.checkChangeset(e,this.getPadRev()))&&(this.store.checkBeyondMaxLength(),a.GlobalContext.run(I.b.produceData,a.MonitorName.DATA_VERIFY,"cs_verify"),this.store.composeUserChangeset(e),m.Logger.info("[MOUDULE_CHANGESET]|composeUserChangeset: "+e+", store.toSummitChangeset:"+this.store.toSummitChangeset.changeSet+", count:"+this.store.toSummitChangeset.changeSetCount),a.GlobalContext.run(I.b.push,{composeCs:this.store.toSummitChangeset.changeSet,rev:this.getPadRev()}),this.setChangeCallbackTimeout()))},e.prototype.pushUpgradeChangeset=function(e){e&&!ie.Changeset.isIdentity(e)&&ie.Changeset.oldLen(e)===ie.Changeset.newLen(this.store.toSummitChangeset.changeSet)&&(this.store.toSummitChangeset.isIdentity()||this.store.queueChanges.push({changeset:this.store.toSummitChangeset.changeSet,commitId:this.store.toSummitChangeset.commitId,keydata:!1,subId:this._subId,head:!1,oSubId:!1,changeSetCount:this.store.toSummitChangeset.changeSetCount}),a.GlobalContext.run(I.b.produceData,a.MonitorName.DATA_PRODUCE,"cs_produce"),this.store.queueChanges.push({changeset:e,commitId:ge.a.createMessageSeq(),keydata:!1,subId:this._subId,head:!1,oSubId:!1,changeSetCount:1}),a.GlobalContext.run(I.b.produceData,a.MonitorName.DATA_COMPOSE,"cs_compose"),this.store.toSummitChangeset.makeIdentity(ie.Changeset.newLen(e)),this.store.toSummitChangeset.resetcommitId())},e.prototype.setOfflineRestored=function(e){this._collab.setOfflineRestored(e)},e.prototype.getUncommitedInfo=function(){return this.store.getUncommitedInfo()},e.LOG_TAG="ChangesetManager",e}(),ye=o(6),ve=o(3),Ce=o(20),_e=o(245);!function(e){e.Unknown="Unknown",e.Readonly="Readonydoc",e.HasNotOfflineData="HasNotOfflineData_open",e.RevEqualOfflineData="RevEqualOfflineData",e.ApplyOfflineData="ApplyOfflineData_open",e.NotSupportIndexDB="NotSupportIndexDB",e.FetchAttributedTextFail="FetchAttributedTextFail",e.CommitChangesSuccess="CommitChangesSuccess"}(L||(L={}));var we,Se=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),Ee=function(e){function t(t){var o=e.call(this,"Websocket_Setup")||this;return o.source=L.Unknown,o.source=t,o}return Se(t,e),t}(m.Notification),Te=o(9),Re=o(17);!function(e){e[e.CollabRoomJQUERYREWRITEERROR=72001]="CollabRoomJQUERYREWRITEERROR",e[e.CollabRoomDefaultErrCode=72005]="CollabRoomDefaultErrCode",e[e.CollabRoomCommittingTimeOut=72008]="CollabRoomCommittingTimeOut",e[e.CollabRoomGetMisschangFail=72009]="CollabRoomGetMisschangFail",e[e.CollabRoomCHANGESETERRORAPPLYOFFLINE=72010]="CollabRoomCHANGESETERRORAPPLYOFFLINE",e[e.CollabRoomGetMisschangAndFollowError=72011]="CollabRoomGetMisschangAndFollowError",e[e.CollabRoomSwitchAccout=72012]="CollabRoomSwitchAccout",e[e.CollabRoomDelta2CS=72101]="CollabRoomDelta2CS",e[e.CollabRoomVerify=72102]="CollabRoomVerify",e[e.CollabRoomVerifyModel=72103]="CollabRoomVerifyModel",e[e.CollabRoomApplyOnline=72104]="CollabRoomApplyOnline",e[e.CollabRoomDataBaseChange=72105]="CollabRoomDataBaseChange",e[e.CollabRoomCommitCSFailByCGI=72106]="CollabRoomCommitCSFailByCGI",e[e.CollabRoomCommitCSErrorByCGI=72107]="CollabRoomCommitCSErrorByCGI",e[e.CollabRoomChangsetErrorEasysync=72999]="CollabRoomChangsetErrorEasysync",e[e.CollabRoomShutDownNotOpen=79999]="CollabRoomShutDownNotOpen"}(we||(we={}));var Ie,Oe=function(){function e(e,t){this.sender=e,this.client=t}return e.prototype.init=function(){},e.prototype.destroy=function(){},Object.defineProperty(e.prototype,"channelManager",{get:function(){return this.sender.channelManager},enumerable:!0,configurable:!0}),e.prototype.isChangesetError=function(e){return[40002,40003,40007,40021,40022,40023,41001,41002,10001,1e4,4e4].includes(e)},e.prototype.handleCommitErr=function(e){if(e.reason){if(Ce.a.roomLogError("handleCommitErr error reason = "+e.reason),this.sender.commitFailCount=this.sender.commitFailCount+1,Ce.a.dmesg("commit_error reason: "+e.reason),this.sender.commitFailCount>this.sender.maxCommitCount)return Ce.a.roomLogWarn("handleCommitErr commitFailCount "+this.sender.commitFailCount+" reach to maxCount"),this.channelManager.shutDownRoomChannel({errCode:e.reason,reason:" Commit Reach Fail COUNT code "+e.reason,shutDown:!0}),void this.reportDataError(e.reason,!0);var t=!0;if(60019===e.reason||60018===e.reason||60020===e.reason)"COMMITTING"===this.sender.getState&&this.sender.setState("WAITING"),this.sender.retryCommit(1e4),Te.b.monitorCommitErr(e.reason),t=!1;else if(this.isChangesetError(e.reason)){var o="COMMIT_ERROR "+e.reason,n=this.sender.commitingQueue?" subId: "+this.sender.commitingQueue.subId+",rev: "+this.channelManager.getPadRev()+",baseRev: "+this.sender.commitingQueue.baseVersion+",offlineRev: \n,changeset: "+this.sender.commitingQueue.changeset:"null";n+="\n",Ce.a.roomLogError("Changeset error:"+e.reason+" "+n),this.channelManager.shutDownRoomChannel({reason:o,errCode:e.reason,shutDown:!0})}else if(40001===e.reason||40020===e.reason||1e4===e.reason){o="tssdError "+e.reason;this.channelManager.shutDownRoomChannel({reason:o,errCode:e.reason,shutDown:!0})}else if(40006===e.reason){"COMMITTING"===this.sender.getState&&this.sender.setState("WAITING");var r=e.retry_interval||5e3;this.sender.retryCommit(r),Te.b.monitorCommitErr(e.reason),t=!1}else{var i=this.sender.commitingQueue?" subId: "+this.sender.commitingQueue.subId+",rev: "+this.channelManager.getPadRev()+",baseRev: "+this.sender.commitingQueue.baseVersion+",offlineRev: "+this.sender.commitingQueue.changeset:"null";i+="\n",Ce.a.roomLogWarn("Changeset error:"+e.reason+" "+i),this.channelManager.shutDownRoomChannel({reason:"COMMIT_ERROR "+e.reason,errCode:e.reason,shutDown:!0})}t&&this.reportDataError(e.reason)}},e.prototype.reportDataError=function(e,t){void 0===t&&(t=!1);for(var o=this.sender.commitingQueue.changeSetCount||1,n=0;n<o;n++)a.ReportHelper.monitor(a.MonitorName.DATA_PRODUCE_ERROR_BACK),t&&a.ReportHelper.monitor(a.MonitorName.DATA_PRODUCE_ERROR_TIMEOUT);a.ReportHelper.tdwReport({opername:"doc_word_melo",module:"data_lost",action:"exp_tip",ver5:"1",ver6:"BB08J2"===this.sender.commitingQueue.subId?"1":"2",ver7:0,obj3:o}),a.ReportHelper.captureChangesetException(o<10?a.MonitorName.CHANGESET_ERROR_COMMIT:a.MonitorName.CHANGESET_ERROR_COMMIT_SPIKE,{option:{}},new Error("code:"+e+",count:"+o+",timeout:"+t))},e.prototype.reportCommitError=function(e,t,o){},e.prototype.handleRoomErrorCode=function(e,t,o){},e}(),Pe=new Map([[[ye.TDWebsocketErrorCode.Socket_Data_Save_Fail,ye.TDWebsocketErrorCode.Socket_CollabRoom_Timeout,ye.TDWebsocketErrorCode.Socket_CollabServer_Timeout,ye.TDWebsocketErrorCode.Socket_ServerStorage_Timeout,ye.TDWebsocketErrorCode.Socket_ServerCGI_Timeout,ye.TDWebsocketErrorCode.Socket_Hackpad_Timeout,ye.TDWebsocketErrorCode.Socket_ServerWaitting_TooMuch,ye.TDWebsocketErrorCode.Socket_ServerWaitting_Timeout,ye.TDWebsocketErrorCode.Socket_Auth_Timeout,ye.TDWebsocketErrorCode.Socket_GetPrivilege_Timeout],{PC:"服务器处理超时，请刷新重试。",Mobile:"服务器超时，请刷新重试。",Action1:Re.a.REFRESH,Action2:Re.a.CONTACT}],[[ye.TDWebsocketErrorCode.Socket_ClientNotReady_Error],{PC:"服务器连接超时，请刷新重试。",Mobile:"服务器超时，请刷新重试。",Action1:Re.a.REFRESH,Action2:Re.a.CONTACT}],[[we.CollabRoomGetMisschangFail,we.CollabRoomCommittingTimeOut,we.CollabRoomCommitCSFailByCGI],{PC:"网络异常，请刷新重试。",Action1:Re.a.REFRESH}],[[ye.TDWebsocketErrorCode.Socket_Frequency_Limit],{PC:"你的操作太频繁，请稍后再试。",Action1:Re.a.REFRESH,Duration:3e3}],[[ye.TDWebsocketErrorCode.Socket_Server_Error,ye.TDWebsocketErrorCode.Socket_Layer_Error],{PC:"服务器异常，请刷新重试。",Action1:Re.a.REFRESH,Action2:Re.a.CONTACT}],[[ye.TDWebsocketErrorCode.Socket_UserAuth_Failed],{PC:"登录过期，点击刷新。",Action1:Re.a.REFRESH}],[[ye.TDWebsocketErrorCode.Socket_CollabRoom_MemberFull,ye.TDWebsocketErrorCode.Socket_CollabRoom_Not_VIP_Full],{PC:"正在查看的人数已达上限。",Action1:Re.a.REFRESH}],[[40024,40029,we.CollabRoomDataBaseChange],{PC:"文档状态有更新。",Action1:Re.a.REFRESH}],[[40025],{PC:"此内容因违规无法编辑。",Action1:Re.a.LEARNMORE}],[[we.CollabRoomSwitchAccout],{PC:"帐号信息变化，点击刷新。",Action1:Re.a.REFRESH}]]),ke=new Map([[[we.CollabRoomDefaultErrCode,we.CollabRoomCHANGESETERRORAPPLYOFFLINE,we.CollabRoomChangsetErrorEasysync,we.CollabRoomJQUERYREWRITEERROR,we.CollabRoomGetMisschangAndFollowError,we.CollabRoomDelta2CS,we.CollabRoomVerify,we.CollabRoomVerifyModel,we.CollabRoomApplyOnline,ye.TDWebsocketErrorCode.Socket_ClientData_Error,ye.TDWebsocketErrorCode.Socket_UserChange_ParamError,ye.TDWebsocketErrorCode.Socket_Command_Unsupport,ye.TDWebsocketErrorCode.Socket_Data_Doc_NoExist,ye.TDWebsocketErrorCode.Socket_Data_Subid_Error,ye.TDWebsocketErrorCode.Socket_Data_Action_Length,40030],{LittleContent:{PC:"文档编辑状态发生变化，点击刷新。",Mobile:"文档编辑状态变化，点击刷新。",Action:[Re.a.REFRESHANDFIX,Re.a.CONTACT]},MuchContent:{PC:"编辑内容暂无法保存。",Action:[Re.a.HOW2DEAL]}}],[[ye.TDWebsocketErrorCode.Socket_Data_Server_Error],{LittleContent:{PC:"服务器异常，编辑内容暂无法保存。",Mobile:"编辑内容无法保存。",Action:[Re.a.REFRESHANDFIX,Re.a.CONTACT]},MuchContent:{PC:"服务器异常，编辑内容暂无法保存。",Mobile:"编辑内容无法保存。",Action:[Re.a.HOW2DEAL]}}],[[ye.TDWebsocketErrorCode.Socket_Data_Changeset_Easysync,ye.TDWebsocketErrorCode.Socket_Data_Read_Fail,ye.TDWebsocketErrorCode.Socket_Data_Baserev_Error,ye.TDWebsocketErrorCode.Socket_Data_NoSupportType,ye.TDWebsocketErrorCode.Socket_Data_NoSupportProto,ye.TDWebsocketErrorCode.Socket_Data_DocId_Error,ye.TDWebsocketErrorCode.Socket_Data_ProtocolType_Error,1e4,10001,we.CollabRoomCommitCSErrorByCGI],{LittleContent:{PC:"服务器异常，编辑内容暂无法保存。",Mobile:"服务器异常，编辑内容无法保存。",Action:[Re.a.REFRESHANDFIX,Re.a.CONTACT]},MuchContent:{PC:"服务器异常，编辑内容暂无法保存。",Mobile:"服务器异常，编辑内容无法保存。",Action:[Re.a.HOW2DEAL]}}],[[ye.TDWebsocketErrorCode.Socket_DocPrivilege_Failed,ye.TDWebsocketErrorCode.Socket_UserDoc_NoPrivilege],{LittleContent:{PC:"你的权限已发生变化，点击刷新。",Mobile:"你的权限发生变化，点击刷新。",Action:[Re.a.REFRESHANDFIX,Re.a.CONTACT]},MuchContent:{PC:"你的权限已发生变化，点击刷新。",Mobile:"你的权限发生变化，点击刷新。",Action:[Re.a.HOW2DEAL]}}],[[ye.TDWebsocketErrorCode.Socket_PackageSize_TooLarge,40026,40028],{LittleContent:{PC:"本次操作内容过多，暂无法保存。",Action:[Re.a.REFRESHANDFIX,Re.a.CONTACT]},MuchContent:{PC:"本次操作内容过多，暂无法保存。",Action:[Re.a.HOW2DEAL]}}]]),Ne=new(function(){function e(){this.MaxCharLength=5,this.MaxChangesetCount=2}return e.prototype.showWarnTipsNotClear=function(e,t,o){var n=!1;if(t||o){var r="",i=0,s=[];t&&Pe.forEach((function(e,o){if(o&&o instanceof Array&&o.indexOf(t)>-1){e&&e.Mobile;var a=e&&e.PC||"";r=a,e.Action1&&s.push(e.Action1),e.Action2&&s.push(e.Action2),e.Duration&&(i=e.Duration),n=!0}})),o&&o.indexOf("INACTIVE")>-1&&(r="正在查看的人数已达上限。",s.push(Re.a.REFRESH)),r&&e&&(i>0?e.notificationCenter.fire(new Re.d({errMsg:""+r,errCode:""+t,duration:i,action:s})):e.notificationCenter.fire(new Re.d({errMsg:""+r,errCode:""+t,action:s})))}var c=e.csManager.getUncommitedInfo();return Te.b.monitorReport(34878616),a.ReportHelper.tdwReport({opername:"doc_core",module:"data_lost",action:"show_tips",ver5:o&&o.indexOf("INACTIVE")>-1?72100:t||72005,ver6:c.charBank.length,ver7:c.csCount,ver8:"warntips"}),n},e.prototype.showErrorTips=function(e,t,o){var n=this,r=t||o&&o.indexOf("INACTIVE")<0&&we.CollabRoomDefaultErrCode,i="",s=[],c=e.csManager.getUncommitedInfo();t&&ke.forEach((function(e,o){if(o&&o instanceof Array&&o.indexOf(t)>-1){var r=void 0,a=!1;c.charBank.length<=n.MaxCharLength&&c.csCount<=n.MaxChangesetCount?r=e.LittleContent:(r=e.MuchContent,a=!0);r&&r.Mobile;var l=r&&r.PC||"";i=l,a&&(i=i.replace(/.$/,"("+t+")。")),r&&r.Action&&(s=s.concat(r.Action))}})),i&&e&&(e.notificationCenter.fire(new Re.d({errMsg:""+i,errCode:""+r,action:s})),c.charBank.length<=10&&a.ReportHelper.monitor(a.MonitorName.DATA_PRODUCE_LITTLE_UNCOMMIT),a.ReportHelper.monitor(a.MonitorName.DATA_PRODUCE_ERROR_TIPS),a.ReportHelper.tdwReport({opername:"doc_core",module:"data_lost",action:"show_tips",ver5:o&&o.indexOf("INACTIVE")>-1?72100:t||72005,ver6:c.charBank.length,ver7:c.csCount}))},e.prototype.showTips=function(e,t,o){this.showWarnTipsNotClear(e,t,o)||this.showErrorTips(e,t,o),Te.b.reportToWebLog(""+t,""+o)},e}()),Me=o(15),De=o(228),xe=o(48),Ae=o(21),Le=o(63),Fe=o(51),Be=o.n(Fe),Ue=o(163),je=function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},Ge=function(e,t){var o,n,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},He=function(){function e(){var e=this;this.saveDocPromise=new Promise((function(t,o){Object(De.a)("new")?e.saveNewDoc2DB(Object(O.c)()).then((function(e){e?t():o()})).catch((function(){o()})):t()}))}return Object.defineProperty(e.prototype,"SaveDocPromise",{get:function(){return this.saveDocPromise},enumerable:!0,configurable:!0}),e.prototype.saveFailTips=function(e){Ce.a.info("saveFailTips reason:"+e),Be.a.show({message:"新建失败，请稍后重试。",type:"info",autoClose:!1,action:"退出",onClickAction:function(){location.reload()}})},e.prototype.saveNewDoc2DB=function(e){var t;return je(this,void 0,void 0,(function(){var o,n,r,i,a,s,c;return Ge(this,(function(l){switch(l.label){case 0:return o=e.globalPadId,n=decodeURIComponent(Object(De.a)("folder"))||"/",r=Object(De.a)("isShareme")||!1,i=Object(re.a)(),[4,Me.c.DBStatusPromise];case 1:return l.sent()!==Me.b.InitFinish?[3,3]:[4,Me.c.getHelper().storeNewDocData(ve.FILE_TYPE.WORD,n,o,i,e,r)];case 2:return(a=l.sent()).error?(this.saveFailTips(null===(t=a.error)||void 0===t?void 0:t.message),[2,!1]):(window.App.GlobalConfig.IsSupportStore&&(s="true"===Object(De.a)("isOnlineBorrowed"),window.mqq&&window.mqq.invoke&&window.mqq.invoke("docx","docDBOperation",{isOnlineBorrowed:s,folder:n,globalId:e.globalPadId,listTypes:[ve.AppDocsListType.listTypeOffline,ve.AppDocsListType.listTypeCreated,ve.AppDocsListType.listTypeMyDoc,ve.AppDocsListType.listTypeRecent],operation:"addDocToList"})),c=(c=location.href).replace(location.search,""),Object(Ue.c)(c,!0),[2,!0]);case 3:return this.saveFailTips("init DB fail."),[2,!1]}}))}))},e}(),Ve=function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},We=function(e,t){var o,n,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},Qe=function(){function e(){this.saveDocPromise=(new He).SaveDocPromise}return e.prototype.destroy=function(){Ae.network.remove(this.onlineCreatDocCallBack),this.saveDocPromise=void 0},e.prototype.CreateDocWithoutData=function(e){return Ve(this,void 0,void 0,(function(){var t;return We(this,(function(o){switch(o.label){case 0:return[4,Me.c.getHelper().createFile(e,ve.FILE_TYPE.WORD,!1)];case 1:return t=o.sent(),[2,new Promise((function(e,o){t.error?o(t):e(t)}))]}}))}))},e.prototype.prePareCreateDocWithoutData=function(e){var t=this;return new Promise((function(o,n){var r=!1;t.onlineCreatDocCallBack=function(){if(Ae.network.isOnline){if(window.clientVars&&window.clientVars.padStatus===ve.PadStatus.NORMAL&&t.onlineCreatDocCallBack)return void Ae.network.remove(t.onlineCreatDocCallBack);r||(r=!0,t.CreateDocWithoutData(e).then((function(e){o(e)})).catch((function(e){r=!1,10033===e.error.errorCode&&n(e)})))}},Ae.network.changeEnd(t.onlineCreatDocCallBack),t.onlineCreatDocCallBack()}))},e.prototype.updateSocketPromise=function(e,t){var o=this,n=new Promise((function(n,r){var i;if(Object(De.a)("prerender"))r("prerender doc ,globalPadId:"+e);else if(t&&e&&e!==xe.a){if(Me.c.mutexTabLockReason)return void r("get lock fail ,globalPadId:"+e);null===(i=o.saveDocPromise)||void 0===i||i.then((function(){o.prePareCreateDocWithoutData(e).then((function(t){var o,i,a,s,c,l,u,h,d,p,f,m,g,b,y,v,C,_;if(t&&t.data&&0===t.data.retcode){if(Ce.a.info("updateSocketPromise:"+e),Object(O.c)()){var w=Object(O.c)().collab_client_vars.client.upid;Object(O.c)().padStatus=(null===(i=null===(o=null==t?void 0:t.data)||void 0===o?void 0:o.data)||void 0===i?void 0:i.padStatus)||ve.PadStatus.NORMAL,Object(O.c)().collab_client_vars.client=Object.assign(null===(s=null===(a=null==t?void 0:t.data)||void 0===a?void 0:a.data)||void 0===s?void 0:s.collab_client_vars.client,{upid:w}),Object(O.c)().collab_client_vars.pver=null===(l=null===(c=null==t?void 0:t.data)||void 0===c?void 0:c.data)||void 0===l?void 0:l.collab_client_vars.pver,Object(O.c)().collab_client_vars.apid=null===(h=null===(u=null==t?void 0:t.data)||void 0===u?void 0:u.data)||void 0===h?void 0:h.collab_client_vars.apid,Object(O.c)().collab_client_vars.wmode=null===(p=null===(d=null==t?void 0:t.data)||void 0===d?void 0:d.data)||void 0===p?void 0:p.collab_client_vars.wmode,Object(O.c)().collab_client_vars.websocketReopenCount=null===(m=null===(f=null==t?void 0:t.data)||void 0===f?void 0:f.data)||void 0===m?void 0:m.collab_client_vars.websocketReopenCount,Object(O.c)().collab_client_vars.pollingAttemptNumber=null===(b=null===(g=null==t?void 0:t.data)||void 0===g?void 0:g.data)||void 0===b?void 0:b.collab_client_vars.pollingAttemptNumber,Object(O.c)().collab_client_vars.rev=null===(v=null===(y=null==t?void 0:t.data)||void 0===y?void 0:y.data)||void 0===v?void 0:v.collab_client_vars.rev,Object(O.c)().userInfo=null===(_=null===(C=null==t?void 0:t.data)||void 0===C?void 0:C.data)||void 0===_?void 0:_.userInfo}document.dispatchEvent(new Event("CreateDocSuccess")),n(t.data)}else r("prePareCreateDocWithoutData ,reason:"+(t&&t.data&&t.data.retcode))})).catch((function(t){if(t.error){if(10033===t.error.errorCode){var o=t.data.url;Le.Modal.confirm({title:"系统消息",content:"与服务器同步完成，请刷新。",cancelText:null,okText:"重新加载",onOk:function(){location.href=o}})}r("prePareCreateDocWithoutData ,globalPadId:"+e+" 创建失败: "+t.error)}}))})).catch((function(){r("save doc fail")}))}else n(!0)}));return n.then((function(e){!0===e&&Object(xe.h)()})),n},e}(),qe=function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},Ye=function(e,t){var o,n,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},Je=function(){function e(e){this.destroyed=!1,this.moduleTag="",this.client=e.client,this.sender=e.sendMsgCb,this.rev=e.clientvars.collab_client_vars.rev,this.clientVars=e.clientvars,this.clientVars.collab_client_vars.gray=window._grayVersion||0;var t=this.clientVars.collab_client_vars;t.dver=window.App.GlobalConfig.globalCodeVersion,this.secretId=this.client.getWorkBookInfo,this.moduleTag=e.moduleTag,this.createDoc=new Qe,this.roomChannel=new ye.CollabRoomChannel({callback:this,serverVars:t,userid:this.clientVars.userId,moduleTag:this.moduleTag})}return e.prototype.init=function(){var e=this;a.GlobalContext.once("Websocket_Setup",(function(t){window.App.GlobalConfig.IsSupportStore&&e.sender.addUserChanges(),Ce.a.roomLogInfo("WebsocketNotificationName, source:"+t.source+" publish:"+e.client.isPublish),e.createDoc.updateSocketPromise(e.clientVars.globalPadId,e.clientVars.padStatus===ve.PadStatus.LOCAL).then((function(t){e.secretId&&e.secretId!==e.client.getWorkBookInfo||e.destroyed?Ce.a.roomLogWarn("updateSocketPromise secretId not equal, Current:"+e.client.getWorkBookInfo+" old:"+e.secretId+" oldPadid:"+e.clientVars.globalPadId+" "):e.openCollabroom(t)})).catch((function(e){Ce.a.roomLogError("roomChannel don't Open, by:"+e)}))}),this)},e.prototype.openCollabroom=function(e){return qe(this,void 0,void 0,(function(){return Ye(this,(function(t){switch(t.label){case 0:return!0!==e?[3,1]:(this.roomChannel.open(),[3,3]);case 1:return[4,this.sender.getServerChangesets()];case 2:t.sent().data&&(Ce.a.roomLogInfo("openCollabroom:"+this.secretId+" set rev:"+e.data.collab_client_vars.rev),this.setPadRev(e.data.collab_client_vars.rev),this.roomChannel=new ye.CollabRoomChannel({callback:this,serverVars:e.data.collab_client_vars,userid:this.client.userId,moduleTag:this.moduleTag}),this.roomChannel.open()),t.label=3;case 3:return[2]}}))}))},e.prototype.destroy=function(){this.destroyed=!0,this.createDoc.destroy(),this.client.notificationCenter.removeListener("Websocket_Setup",this),this.roomChannel.shutDown({errCode:""+we.CollabRoomShutDownNotOpen,reason:"Room is shutdown，do not open later.",description:"Switch Doc Container.",shutDown:!0})},e.prototype.getRoomChannel=function(){return this.roomChannel},e.prototype.isCollabRoomOpen=function(){return this.roomChannel.getRoomState()===ye.emRoomState.OPENED},e.prototype.shutDownRoomChannel=function(e){this.roomChannel.shutDown(e)},e.prototype.getPadRev=function(){return this.rev},e.prototype.setPadRev=function(e){Ce.a.roomLogDebug("set pad rev = "+e),this.rev=e},e.prototype.handleOnRoomOpen=function(){Ce.a.roomLogInfo("handleOnRoomOpen"),this.client.handleOffline2Online()},e.prototype.handleOnRoomStateChange=function(e,t){Ce.a.roomLogInfo("handleOnRoomStateChange:"+e);var o=e;e===ye.emRoomState.OPENED?o="CONNECTED":e===ye.emRoomState.SHUTDOWN?o="DISCONNECTED":e===ye.emRoomState.RECONNECTING_In_CLOSED?o="RECONNECTING":e===ye.emRoomState.CONNECTING&&(o="CONNECTING");var n=t;if("RECONNECTING"===o&&t)if(t.indexOf("COMMIT_UNAUTH")>=0||t.indexOf("UnAuth")>=0)n="commit_unauth";else if(t.indexOf("COMMIT_ERROR")>=0)n="commit_error";else if(t.indexOf("TX-LOGIN-PSKEY-EXPIRED")>=0)n="TX-LOGIN-PSKEY-EXPIRED";else if(t.indexOf("BigData")>=0)n="commit_error";else if(t.indexOf("MemberFull")>=0)n="MemberFull";else if(t.indexOf("CodeVerChange")>=0)return void(n="CodeVerChange");var r="Channel roomState state being set to "+e+" info:"+n;Ce.a.dmesg(r)},e.prototype.handleOnReceivMsgFromServer=function(e,t){if("CURSOR_MESSAGE"!==e&&Ce.a.roomLogInfo(" handleOnReceivMsgFromServer "+e),e&&t)if("NEW_CHANGES"===e)this.sender.handleNewChanges(t);else if("USER_NEWINFO"===e)this.client.handleUserNewInfo(t.body.notice);else if("USER_LEAVE"===e)this.client.handleUserLeave(t.body.notice);else if("RIGHT_MESSAGE"===e)this.client.handleRightChange();else if("REVERT_MESSAGE"===e)this.client.handleRevertMessage();else if("LAST_REVERSION"===e){var o=(s=t.body.notice).lastRev;Ce.a.roomLogInfo("handleOnReceivMsgFromServer  LAST_REVERSION latestVer = "+o),o!==this.getPadRev()&&this.sender.handleLastRversion(this.getPadRev()+1,o)}else if("CURSOR_MESSAGE"===e){var n=t.body.notice,r=n.userId,i=n.gcp,a=n.isFocus;this.client.notificationCenter.fire(new _e.d(r,i,a))}else if("CODEREV_NEW"===e)this.client.handleCodeNewVer(t);else if("TITLE_MESSAGE"===e)this.client.notificationCenter.fire(new _e.c(t.body.notice.title,t.body.notice.client_cookie));else if("HANDLE_DELETE"===e)this.client.handleDeleteDoc(t);else if("COMM_NOTICE"===e)this.sender.handleServerMsg(t.body.notice);else if("MARK_MESSAGE"===e){var s={type:e,watermark:t.body.notice.watermark};this.client.notificationCenter.fire(new _e.a(s))}else"LIVE_MESSAGE"===e&&this.client.notificationCenter.fire(new _e.h(t));else Ce.a.offlineLog("error  = handleOnReceivMsgFromServer = type or receiveData.data is null")},e.prototype.handleOnRoomShutDown=function(e){var t=e.reason;Ce.a.roomLogInfo(" handleOnRoomShutDown has shutdown reason: "+t+" des:"+e.description+" code:"+e.errCode),"COMMITTING"===this.sender.getState&&this.sender.setState("WAITING");var o=Number(e.errCode);if(o!==we.CollabRoomShutDownNotOpen){if((o!==ye.TDWebsocketErrorCode.Socket_CollabRoom_MemberFull&&o!==ye.TDWebsocketErrorCode.Socket_CollabRoom_Not_VIP_Full||this.client.canEdit())&&Ne.showTips(this.client,o,e.reason),ye.TDWebsocketErrorCode.Socket_DocPrivilege_Failed===o||ye.TDWebsocketErrorCode.Socket_UserDoc_NoPrivilege===o||ye.TDWebsocketErrorCode.Socket_Data_Doc_NoExist===o){var n=document.createEvent("CustomEvent");n.initCustomEvent("Melo_ClearOfflineData",!0,!0,{code:o}),document.dispatchEvent(n)}Te.b.monitorCommitErr(o)}},e.prototype.handleOnRoomClose=function(e){var t=e.reason,o=""+e.errCode;if(Ce.a.roomLogInfo(" handleOnRoomClose has closed reason, "+t),"COMMITTING"===this.sender.getState&&this.sender.setState("WAITING"),!o||-1===o.indexOf("60000")&&-1===o.indexOf("60001")&&-1===o.indexOf("60005")&&-1===o.indexOf("60007")&&-1===o.indexOf("60011")&&-1===o.indexOf("60013")&&-1===o.indexOf("60014")){var n=!0,r=null!==navigator.userAgent.match(/iPhone/i),i=null!==navigator.userAgent.match(/iPad/i);t.indexOf("socket io error")>=0&&(r||i)&&(n=!1),!0===n&&!1===this.client.offline._hasShowOfflineFlag&&this.client.offline.showEnterOfflineEditTips(t)}else Ne.showErrorTips(this.client,Number(o),e.reason)},e.prototype.getHeaderGeneralPacket=function(){var e={rel_rev:"",platform:1,right_tag:0},t=m.PlatformUtil.isMac(),o=m.PlatformUtil.isWindowStore();return window.__globalReleaseVersion&&(e.rel_rev=window.__globalReleaseVersion),e.platform=o?1:t?5:4,e.right_tag=this.client.canEdit()?1:0,e},e.prototype.onNetReconnectedFail=function(){Ce.a.roomLogInfo("collab_room: onNetReconnectedFail");var e=null!==navigator.userAgent.match(/iPhone/i),t=null!==navigator.userAgent.match(/iPad/i);(e||t)&&this.client.offline.showEnterOfflineEditTips("collab_room: onNetReconnectedFail")},e.prototype.report=function(e){this.client.tdwreport(e)},e}();!function(e){e[e.WATING=0]="WATING",e[e.COMMITING=1]="COMMITING",e[e.QUEUE=2]="QUEUE",e[e.ACCEPT=3]="ACCEPT"}(Ie||(Ie={}));var ze,Ke=function(){function e(e,t){this.head=!1,this.status=Ie.WATING,this.taskId=0,this.isOfflineMessage=!1,this.allowAutoMerge=!1,this.commitTimes=0,this.collabClient=e,this.baseVersion=t&&t.baseVersion||e.getPadRev(),this.subId=t&&t.subId,this.uuid=t&&t.uuId,this.changeset="",t&&t.data&&(this.changeset=t.data.changeset||void 0,this.apool=t.data.apool||t.data.apool||null,this.head=t.data.head||!1,this.keyData=t.data.keyData||void 0,this.originSheetId=t.data.oSubId||void 0,this.taskId=t.data.taskId||0,this.changeSetCount=t.data.changeSetCount),this.isOfflineMessage=t&&t.offlineMsg||!1,this.allowAutoMerge=t&&t.allowAutoMerge||!1,this.time=t&&t.time||(new Date).getTime(),this.workbook=t&&t.workbook||"",this.status=t&&t.status||Ie.WATING}return e.prototype.getKeyData=function(){return this.keyData||!1},e.prototype.setKeyData=function(e){this.keyData=e},e.prototype.isWithKeyData=function(){return!!this.keyData},e.compare=function(e,t){return e.time-t.time},Object.defineProperty(e.prototype,"requestCount",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"storeData",{get:function(){var e={};e.baseVersion=this.baseVersion,e.sheetId=this.subId;var t={taskId:this.taskId,baseRev:this.baseVersion,changeSetCount:this.changeSetCount,changeset:this.changeset,apool:this.apool||null,keyData:this.keyData,head:this.head,subId:this.subId,oSubId:this.originSheetId||!1,uuId:this.uuid,pver:2};return e.isOfflineMessage=!0,e.data=t,e.time=this.time,e.workbook=this.workbook,e.status=this.status,e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isEmpty",{get:function(){return!this.changeset},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"key",{get:function(){return this.collabClient.getWorkBookInfo+"_"+this.subId+"_"+this.time},enumerable:!0,configurable:!0}),e.prototype.prepareCommitMessage=function(){var e={type:"USER_CHANGES",baseRev:this.baseVersion,changeSetCount:this.requestCount,changeset:this.changeset,apool:this.apool,keydata:this.keyData||!1,head:this.head,subId:this.subId,oSubId:this.originSheetId||!1,uuId:this.uuid,offlineMsg:this.isOfflineMessage,pver:2};return JSON.stringify(e)},e.prototype.prepareMessageForReport=function(){var e={type:"USER_CHANGES",baseRev:this.baseVersion,changeset:this.changeset,keyData:this.keyData||!1,head:this.head,subId:this.subId,oSubId:this.originSheetId||!1,uuId:this.uuid,changeSetCount:this.requestCount,offlineMsg:this.isOfflineMessage,pver:2};return e.changesetLength=e.changeset.length,e.keydataLength=e.keyData?e.keyData.length:0,e.changeset=e.changeset.substr(0,100),e.keyData=!!e.keyData,e},e}();!function(e){e[e.INIT=0]="INIT",e[e.PREPARE=1]="PREPARE",e[e.START=2]="START",e[e.FINISH=3]="FINISH",e[e.DESTORY=4]="DESTORY"}(ze||(ze={}));var Xe,$e=function(){function e(e,t){this._isPaused=!1,this.currentStatus=ze.INIT,this.queue=e}return e.prototype.pause=function(){this._isPaused=!0},e.prototype.continue=function(){this._isPaused=!1,this.run(this.currentStatus)},e.prototype.isPaused=function(){return this._isPaused},e.prototype.run=function(e){var t=this;void 0===e&&(e=ze.INIT),e<=ze.INIT&&(this.init(),this.onInit()),e<ze.PREPARE?new Promise((function(e,o){t.prepare(),t.onPrepare(e,o)})).catch((function(e){console.error("error occur while run task! "+t,e)})).then((function(){!t.isPaused()&&e<ze.START&&(t.start(),t.onStart())})).finally((function(){!t.isPaused()&&e<ze.FINISH&&(t.finish(),t.onFinish()),t.destory()})):(e<ze.START&&(this.start(),this.onStart()),e<ze.FINISH&&(this.finish(),this.onFinish()),this.destory())},e.prototype.init=function(){this.currentStatus=ze.INIT},e.prototype.prepare=function(){this.currentStatus=ze.PREPARE},e.prototype.start=function(){this.currentStatus=ze.START},e.prototype.finish=function(){this.currentStatus=ze.FINISH},e.prototype.destory=function(){this.currentStatus=ze.DESTORY,this.queue.onTaskDestroy(this)},e.prototype.onInit=function(){},e.prototype.onPrepare=function(e,t){},e.prototype.onStart=function(){},e.prototype.onFinish=function(){},e}();!function(e){e[e.ACCEPT=0]="ACCEPT",e[e.PUSH=1]="PUSH",e[e.COMMIT_ERROR=2]="COMMIT_ERROR",e[e.MISS_CHANGE=3]="MISS_CHANGE"}(Xe||(Xe={}));var Ze,et=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();!function(e){e.REVERTMESSAGE="REVERT_MESSAGE",e.TASKDUPLICATE="TASK_DUPLICATE",e.LastRversion="LastRversion"}(Ze||(Ze={}));var tt,ot=function(e){function t(t,o){var n=e.call(this,t,o)||this;return n.type=Xe.MISS_CHANGE,n.onInit=function(){n.from<n.parent.getPadRev()&&(n.from=n.parent.getPadRev())},n.onPrepare=function(e,t){if(n.from>n.to)e();else{var o={to:n.to,source:n.src};n.parent.missChagedSet.handleMissChangeSet(o,n.src),e()}},n.onStart=function(){},n.onFinish=function(){},n.from=o.from,n.to=o.to,n.src=o&&o.src?o.src:"",n.parent=o.parent,n}return et(t,e),t.prototype.handleError=function(e,t){},t.type=Xe.ACCEPT,t}($e),nt=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),rt=function(e){function t(o,n){var r=e.call(this,o,n)||this;return r.isNeedKeyframe=!1,r.onInit=function(){r.from<r.parent.getPadRev()&&(r.from=r.parent.getPadRev())},r.onPrepare=function(e,t){e()},r.onStart=function(){if(r.to>r.from+1){var e=new t(r.queue,{sheetId:r.sheetId,from:r.to-1,to:r.to,parent:r.parent,data:r.data}),o=new ot(r.queue,{from:r.from,to:r.to-1,parent:r.parent});r.queue.pushTask([o,e],0)}else r.to===r.from+1&&r.parent.acceptCommit(r.sheetId,r.to,r.isNeedKeyframe,r.data)},r.onFinish=function(){},r.sheetId=n.sheetId,r.from=n.from,r.to=n.to,r.isNeedKeyframe=n.isNeedKeyframe||!1,r.data=n.data,r.parent=n.parent,r}return nt(t,e),t.type=Xe.ACCEPT,t}($e),it=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),at=function(e){function t(t,o){var n=e.call(this,t,o)||this;return n.type=Xe.PUSH,n.onInit=function(){},n.onPrepare=function(e,t){e()},n.onStart=function(){if(n.newChange.newVersion===n.parent.getPadRev()+1)n.parent.applyNewChanges(n.newChange,0,1,"collab");else if(n.newChange.newVersion>n.parent.getPadRev()+1){Ce.a.roomLogWarn("handleOnReceivMsgFromServer NEW_CHANGES the server rev is not continue, server rev = "+n.newChange.newVersion+" pad rev= "+n.parent.getPadRev());var e=new ot(n.queue,{from:n.parent.getPadRev()+1,to:n.newChange.newVersion-1,parent:n.parent});n.queue.pushTask([e],0)}else n.newChange.newVersion===n.parent.getPadRev()||Ce.a.roomLogWarn("handleOnReceivMsgFromServer NEW_CHANGES the server rev is less than the pad rev, server rev = "+n.newChange.newVersion+" pad rev= "+n.parent.getPadRev())},n.onFinish=function(){},n.newChange=o.newChange,n.parent=o.parent,n}return it(t,e),t}($e),st=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();!function(e){e.LocalChangeContent="localChangeContent",e.ServerChangeContent="serverChangeContent"}(tt||(tt={}));var ct,lt,ut=function(e){function t(t){var o=e.call(this,tt.LocalChangeContent)||this;return o.msg=t,o}return st(t,e),t}(m.Notification),ht=function(e){function t(){return e.call(this,tt.ServerChangeContent)||this}return st(t,e),t}(m.Notification),dt=o(229),pt=o(49),ft=function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},mt=function(e,t){var o,n,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},gt=function(){function e(e){this.serverchangesets=new Map,this.waitingUserChangeQueue=[],this.commitingQueueTimeoutStatus="INIT",this.retryTime=0,this.retryPostCount=0,this.retryPrepareUserChangeMaxCount=5,this.retryPrepareUserChangeCount=5,this.client=e.client,this.clientVars=e.clientVars,this.state="IDLE",this.bCommitErrAuth=!1,this.maxCommitCount=3,this.commitFailCount=0,this.lastCommitTime=0;var t={client:this.client,clientvars:e.clientVars,sendMsgCb:this,moduleTag:e.moduleTag};this.channelManager=new Je(t),this.sendException=new Oe(this,this.client)}return e.prototype.init=function(){this.channelManager.init(),this.sendException.init(),this.loop()},e.prototype.destroy=function(){this.channelManager.destroy(),this.sendException.destroy()},Object.defineProperty(e.prototype,"getState",{get:function(){return this.state},enumerable:!0,configurable:!0}),e.prototype.setState=function(e){this.state=e},e.prototype.setStateIdle=function(){this.state="IDLE"},Object.defineProperty(e.prototype,"taskQueue",{get:function(){return this.client.getTaskQueue},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"missChagedSet",{get:function(){return this.client.missChagedSet},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"roomChannel",{get:function(){return this.channelManager.getRoomChannel()},enumerable:!0,configurable:!0}),e.prototype.hasUncommittedChanges=function(){return this.commitingUserChange&&!this.commitingUserChange.isEmpty||this.waitingQueue.length>0},Object.defineProperty(e.prototype,"commitingQueue",{get:function(){return this.commitingUserChange||(this.commitingUserChange=new Ke(this.client)),this.commitingUserChange},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"commitingQueueTaskId",{get:function(){return this.commitingUserChange?this.commitingUserChange.taskId:-1},enumerable:!0,configurable:!0}),e.prototype.resetCommitingQueue=function(){this.commitingUserChange=null,this.commitingQueueTimeoutStatus="INIT",this.lastCommitTime=null},Object.defineProperty(e.prototype,"waitingQueue",{get:function(){return this.waitingUserChangeQueue},enumerable:!0,configurable:!0}),e.prototype.retryCommit=function(e){this.retryTime=(new Date).getTime()+e.valueOf()},e.prototype.isDuplicateMessage=function(e){return this.commitingQueue.taskId===e},e.prototype.prepareSendParams=function(){return{timeout:15e3,maxRetryCount:3,waitAcceptCmd:["ACCEPT_COMMIT","COMMIT_ERROR","TASK_DUPLICATE"]}},e.prototype.getServerChangesets=function(){return ft(this,void 0,void 0,(function(){var e;return mt(this,(function(t){switch(t.label){case 0:return[4,Object(xe.g)(this.client.getWorkBookInfo)];case 1:return(e=t.sent()).data&&(this.serverchangesets=e.data),[2,e]}}))}))},e.prototype.onSend=function(e,t,o,n){0===n.errCode&&n.response&&n.response.onpost&&0===n.response.onpost.result?this.retryPostCount=0:this.handleCommitOnPostErr(n);var r={baseRev:this.commitingQueue.baseVersion,changeset:this.commitingQueue.changeset||"",apool:this.commitingQueue.apool,keydata:this.commitingQueue.getKeyData(),head:this.commitingQueue.head,subId:this.commitingQueue.subId||"",oSubId:!1,uuId:this.commitingQueue.uuid||"",pver:2,changeSetCount:this.commitingQueue.changeSetCount||0,offlineMsg:0};this.client.notificationCenter.fire(new ut(r))},e.prototype.onSendAccept=function(e,t,o,n,r){this.handleCommitRsp(e,t,n,r)},e.prototype.addUserChanges=function(){var e=this.client.csManager.prepareUserChangeset();if(e&&e.changeset){var t=e.commitId,o=e.firstCommitRev;if(t||(t=this.roomChannel.createMessageSeq(),o=this.channelManager.getPadRev(),this.client.csManager.setSummitedForCommitId(t,o)),this.commitingQueue.taskId!==t){for(var n=0;n<this.waitingQueue.length;n++)if(this.waitingQueue[n].taskId===t)return;var r,i={type:"USER_CHANGES",baseVersion:this.channelManager.getPadRev(),uuId:this.client.uuId,firstCommitRev:o,pver:2,subId:e.subId,data:{changeset:e.changeset,changeSetCount:e.changeSetCount,apool:e.apool,keyData:e.keydata,head:e.head,oSubId:e.oSubId,taskId:t},offlineMsg:!!e.offlineMsg};r=new Ke(this.client,i),this.waitingQueue.push(r),Ce.a.roomLogInfo("addUserChanges taskid = "+r.taskId+" changset = "+r.changeset)}}},e.prototype.handleChangesetAfterIDs=function(e){for(var t=0;t<this.waitingQueue.length;t++)this.waitingQueue[t]&&(this.waitingQueue[t].baseVersion=e);this.resetCommitingQueue()},e.prototype.sendUserChanges=function(e){var t=e;if(window.App.GlobalConfig.IsSupportStore){var o={commitId:t.taskId,head:t.head,revert:!1,subId:t.subId,uuId:this.client.uuId};if(o.commitId&&o.commitId>0&&this.serverchangesets.size>0&&this.serverchangesets.has(o.commitId))return this.client.applyChangesetAfterIDs(o,this.serverchangesets.get(o.commitId)),void console.log("applyChangesetAfterIDs:"+o.commitId)}var n=t.prepareCommitMessage();this.lastCommitTime=(new Date).getTime();var r=this.roomChannel.sendMessageWaitAcceptCmd("USER_CHANGES",t.taskId,n,this.prepareSendParams(),this.onSend.bind(this),this.onSendAccept.bind(this));Ce.a.roomLogInfo("sendUserChanges taskid = "+t.taskId+" changset = "+t.changeset),t.commitTimes=t.commitTimes+1,this.commitingUserChange&&(this.commitingUserChange.taskId=r.seq),r&&0!==r.errCode&&this.sendException.handleRoomErrorCode(0,"",r),a.GlobalContext.run(I.b.push,{commitCs:t.changeset,rev:t.baseVersion})},e.prototype.isPullingMiss=function(){return this.client.missChagedSet.isPullingMissChangeset()?(this.retryPrepareUserChangeCount=0,!0):(0===this.retryPrepareUserChangeCount&&this.resetCommitingQueue(),!this.hasUncommittedChanges()&&this.retryPrepareUserChangeCount<this.retryPrepareUserChangeMaxCount&&(this.addUserChanges(),this.retryPrepareUserChangeCount+=1),!1)},e.prototype.loop=function(){var t=this,o=this;setTimeout((function(){if(o.roomChannel&&"OPENED"===o.roomChannel.getRoomState()&&!t.isPullingMiss()){var e=(new Date).getTime(),n=o.retryTime>0&&e>=o.retryTime;n&&(o.retryTime=0),n&&o.commitingQueue&&!o.commitingQueue.isEmpty?o.sendUserChanges(o.commitingQueue):o.commitingQueue&&o.commitingQueue.isEmpty&&o.waitingQueue.length>0&&(o.commitingUserChange=o.waitingQueue.shift()||null,o.commitingUserChange&&(o.retryTime=0,o.commitingUserChange.status=Ie.COMMITING,o.sendUserChanges(o.commitingUserChange))),n||o.detectAndHandleQueueBlock()}o.loop()}),e.MESSAGE_LOOP_INTERVAL)},e.prototype.detectAndHandleQueueBlock=function(){if("ERROR"!==this.commitingQueueTimeoutStatus){var e=(new Date).getTime();this.commitingQueue&&!this.commitingQueue.isEmpty&&this.lastCommitTime&&e-this.lastCommitTime>6e4&&("INIT"===this.commitingQueueTimeoutStatus?(this.retryCommit(100),this.commitingQueueTimeoutStatus="RETRY",Ce.a.roomLogError("detectAndHandleQueueBlock:"+this.commitingQueueTimeoutStatus+", "+this.commitingUserChange.changeset+", taskId:"+this.commitingUserChange.taskId)):"RETRY"===this.commitingQueueTimeoutStatus&&(this.channelManager.shutDownRoomChannel({errCode:""+we.CollabRoomCommittingTimeOut,reason:"commting error",shutDown:!0}),Ce.a.roomLogError("detectAndHandleQueueBlock:"+this.commitingQueueTimeoutStatus+", "+this.commitingUserChange.changeset+", taskId:"+this.commitingUserChange.taskId),this.resetCommitingQueue(),this.commitingQueueTimeoutStatus="ERROR"))}else Ce.a.roomLogError("detectAndHandleQueueBlock:"+this.commitingQueueTimeoutStatus)},e.prototype.updateCommtingWaitting=function(e){function t(t){t.taskId===e.taskId&&0!==t.taskId&&(t.changeset=e.changeset,t.apool=e.apool,t.baseVersion=e.baseVersion)}e&&(this.commitingQueue&&!this.commitingQueue.isEmpty&&t(this.commitingQueue),this.waitingQueue.map((function(e){t(e)})))},e.prototype.cancelMessageBySeq=function(e){this.roomChannel.cancelMessageBySeq(e)},e.prototype.sendMessage=function(e,t,o,n){try{var r=JSON.stringify(t),i=void 0;return o||(i=this.roomChannel.createMessageSeq()),this.roomChannel.sendMessage(e,o||i,r,{},n)}catch(e){return void Ce.a.roomLogError("sendMessage exception error = "+e)}},e.prototype.handleCommitTimeout=function(e){var t="SlowCommit_Doc";2===this.getSubmittedChangesetType()&&(t="SlowCommit_Sheet"),this.sendException.reportCommitError("clearOfflineStore when slow commit: closed by client and disconnecting in handleCommitTimeout, bCommitErrAuth === "+this.bCommitErrAuth+", timeout === "+e,null,t),this.roomChannel.closeAndDelayReopen({reason:"Closed by client. commit timeout slow commit: disconnecting ",shutDown:!1},0),!0===this.bCommitErrAuth&&(this.bCommitErrAuth=!1)},e.prototype.handleAuthChanged=function(e){this.bCommitErrAuth=!0,this.channelManager.shutDownRoomChannel({errCode:""+e,reason:"COMMIT_UNAUTH 40004",shutDown:!0}),window.App.GlobalConfig.IsSupportStore&&this.client.delLocalOfflineData()},e.prototype.handleServerMsg=function(e){if("push_message"===e.type)try{var t=JSON.parse(e.message);if(t)if("unbind"===t.type){var o=pt.a.get("utype");o||Ce.a.roomLogWarn("handleMessageFromServer unbind utype is null!");var n=t.unbind;if("wx"===n){if(Ce.a.roomLogWarn("handleMessageFromServer unbind wx"),"wx"===o)return void this.channelManager.shutDownRoomChannel({reason:"TX-LOGIN-PSKEY-EXPIRED",shutDown:!0});Ce.a.roomLogWarn("handleMessageFromServer unbind wx push not for wx")}else if("qq"===n){if(Ce.a.roomLogWarn("handleMessageFromServer unbind qq"),"qq"===o)return;Ce.a.roomLogWarn("handleMessageFromServer unbind qq push not for qq")}}}catch(t){Ce.a.roomLogError(" error:"+t+" message:"+e.message),Te.b.reportToWeblogWithKey("Word_Melo_COMM_NOTICE_Error",18e4)}this.client.notificationCenter.fire(new dt.b(e))},e.prototype.handleCommitRsp=function(e,t,o,n){if(Ce.a.roomLogInfo("handleCommitRsp seq = "+e+" cmd = "+t+" waitCmd = "+o),0!==n.errCode||!n.response)return Ce.a.roomLogError("handleCommitRsp error result.errCode = "+n.errCode),void(n.errCode===ye.emRoomErrCode.timeout?this.handleCommitTimeout(null):("COMMITTING"===this.state&&(this.state="WAITING"),this.retryCommit(3e3)));var r=n.response.body.data;"ACCEPT_COMMIT"===o?this.handleCommitAccept(e,t,n):"COMMIT_ERROR"===o?this.sendException.handleCommitErr(r):"TASK_DUPLICATE"===o&&this.handleTaskDuplicate(e,t,n)},e.prototype.handleCommitAccept=function(e,t,o){if(0===o.errCode&&o.response){var n=o.response.new_rev,r=o.response.body,i=r&&r.data,a=i&&i.need||!1,s=i&&i.subId,c=new rt(this.taskQueue,{sheetId:s,from:this.channelManager.getPadRev(),to:n,isNeedKeyframe:a,parent:this.client,data:i});this.taskQueue.pushTask(c)}else this.sendException.handleRoomErrorCode(e,t,o)},e.prototype.handleTaskDuplicate=function(e,t,o){if(0===o.errCode&&o.response){if(o.response.body&&o.response.body.data&&void 0!==o.response.body.data.lastRev){var n=o.response.body.data.lastRev;if(n<this.channelManager.getPadRev()+1&&e===this.commitingQueue.taskId)this.resetCommitingQueue(),this.client.csManager.resetSummited();else if(n===this.channelManager.getPadRev()+1&&e===this.commitingQueue.taskId){var r={type:"USER_CHANGES",baseRev:this.commitingQueue.baseVersion,changeset:this.commitingQueue.changeset,apool:this.commitingQueue.apool,keydata:this.commitingQueue.getKeyData,head:this.commitingQueue.head,subId:this.commitingQueue.subId,oSubId:!1,uuId:this.commitingQueue.uuid,messageSeq:this.commitingQueue.taskId,firstCommitRev:this.commitingQueue.baseVersion};this.client.applyCommittingChangeset(n,r),this.client.offline.offlineStore.updateBaseVersion(n),this.resetCommitingQueue()}else{var i=new ot(this.client.getTaskQueue,{from:this.client.getPadRev(),to:n,parent:this.client,src:Ze.TASKDUPLICATE});this.client.getTaskQueue.pushTask(i)}}}else Ce.a.roomLogWarn("handleTaskDuplicate result="+o),this.sendException.handleRoomErrorCode(e,t,o)},e.prototype.handleNewChanges=function(e){Ce.a.roomLogDebug("handleNewChanges  server rev = "+e.new_rev+" pad rev = "+this.channelManager.getPadRev()+" src = newchange");var t=e.body&&e.body.data,o=e.new_rev;if(t){var n=new at(this.taskQueue,{newChange:{commitId:t.commitId,sheetId:t.subId,newVersion:o,changeset:t.changeset||"[]",isNeedKeyframe:t.need,head:t.head,revert:t.revert,data:t},parent:this.client});this.taskQueue.pushTask(n)}},e.prototype.needTry=function(e){return[60002,60004,60005,60011,60013,60014,60021,60022].includes(e)},e.prototype.handleCommitOnPostErr=function(e){if(e.response&&e.response.onpost&&0!==e.response.onpost.result){this.commitFailCount=this.commitFailCount+1;var t=e.response.onpost.result;if(this.commitFailCount>this.maxCommitCount)return Ce.a.roomLogWarn("commit error commitFailCount "+this.commitFailCount+" reach to maxCount"),void this.channelManager.shutDownRoomChannel({errCode:t,reason:" Commit Reach Fail COUNT code "+t,shutDown:!0});if(this.needTry(t))if(this.retryPostCount<3){"COMMITTING"===this.state&&(this.state="WAITING"),this.retryPostCount+=1,this.channelManager.getRoomChannel().cancelMessageBySeq(this.commitingQueueTaskId);var o=8e3;e.response.onpost&&e.response.onpost.retry_interval&&(o=e.response.onpost.retry_interval),this.retryCommit(o),Te.b.monitorCommitErr(t)}else this.retryPostCount=0,this.channelManager.shutDownRoomChannel({errCode:""+t,reason:""+t,shutDown:!0});else if(60003===t||60016===t||60017===t){var n="COMMIT_ERROR code="+t;this.roomChannel.cancelMessageBySeq(this.commitingQueueTaskId),this.channelManager.shutDownRoomChannel({errCode:""+t,reason:n,shutDown:!0})}else if(60007===t||60015===t)this.handleAuthChanged(t),Te.b.monitorCommitErr(t);else if(60008===t){n="COMMIT_ERROR code="+t;this.roomChannel.cancelMessageBySeq(this.commitingQueueTaskId),this.channelManager.shutDownRoomChannel({errCode:""+t,reason:n,shutDown:!0})}else{o=1e4;e.response.onpost&&e.response.onpost.retry_interval&&(o=e.response.onpost.retry_interval),this.roomChannel.cancelMessageBySeq(this.commitingQueueTaskId),"COMMITTING"===this.state&&(this.state="WAITING"),this.retryCommit(o),Te.b.monitorCommitErr(t)}}else this.roomChannel.cancelMessageBySeq(this.commitingQueueTaskId),"COMMITTING"===this.state&&(this.state="WAITING"),this.retryCommit(1e4)},e.prototype.handleLastRversion=function(e,t){var o=new ot(this.client.getTaskQueue,{from:e,to:t,parent:this.client,src:Ze.LastRversion});this.client.getTaskQueue.pushTask(o)},e.prototype.handleOfflineAcceptCommit=function(e){for(var t=0;t<this.waitingQueue.length;t++)this.waitingQueue[t]&&(this.waitingQueue[t].baseVersion=e);if(window.App.GlobalConfig.IsSupportStore){this.commitingUserChange.baseVersion=e;var o=new ve.OfflineData({docType:ve.FILE_TYPE.WORD,uid:pt.a.get("uid"),globalPadId:this.clientVars.globalPadId,secretId:this.client.getWorkBookInfo,subSheetId:this.commitingUserChange.subId,type:ve.OFFLINE_ITEM_TYPE.ACCEPTED,taskId:this.commitingUserChange.taskId,version:e,data:this.commitingUserChange.storeData,createTime:this.commitingUserChange.time,dver:window.App.GlobalConfig.globalCodeVersion});Me.c.handleDataFromIndexDB({type:Me.a.update,tableName:ve.TableName.DOCUMENT_DATA,data:o})}this.resetCommitingQueue()},e.prototype.getSubmittedChangesetType=function(){var e=1;return"BB08J2"!==this.commitingQueue.subId&&(e=2),e},e.MESSAGE_LOOP_INTERVAL=500,e}(),bt=function(){function e(t){var o=this;this.setDataToStorePlugin=function(e,t,n,r){o.setData2Store(n,r),t()},this.setData2Store=function(t,n){var r=n,i=!0;if(!r||Array.isArray(r)&&0===r.length){try{o.deleUserChangeData(t)}catch(t){m.Logger.error(e.LOG_TAG+" | remove item error, "+t),i=!1}a.GlobalContext.run(me.b.SetData2StoreCallback,i?"success":"error",t)}else{var s=null,c={type:"USER_CHANGES",baseVersion:o.collabClient.getPadRev(),uuId:o.collabClient.uuId,firstCommitRev:-1,pver:2,subId:"BB08J2",data:{changeSetCount:0,changeset:""},offlineMsg:!1};if(o.collabClient.offline.checkOfflineEditTips(),"object"==typeof r){var l=1;if(r instanceof Array){l=r.length;for(var u=(new Date).getTime(),h=0;h<l;h++)"object"==typeof r[h]&&c&&c.data&&(c.data.changeset=r[h].changeset,c.data.apool=r[h].apool,c.data.keyData=r[h].keydata,c.data.head=r[h].head,c.data.oSubId=r[h].oSubId,c.data.taskId=r[h].commitId,c.subId=r[h].subId,c.time=u,u+=1,s=new Ke(o.collabClient,c),o.updateMemoryAndIndexDB(s,t))}else r.baseRev=o.collabClient.getPadRev(),c&&c.data&&(c.data.changeset=r.changeset,c.data.apool=r.apool,c.data.keyData=r.keydata,c.data.head=r.head,c.data.oSubId=r.oSubId,c.data.taskId=r.commitId,c.subId=r.subId,s=new Ke(o.collabClient,c),o.updateMemoryAndIndexDB(s,t))}}},this.setData2StoreCallback=function(e,t){t&&"success"===t.type&&t.userChangeType},this.collabClient=t.collabClient,this.secretId=t.secretId,this.globalPadId=t.globalPadId,this.userDomain=t.userDomain,this.userId=t.userId,this.uid=t.uid,this.baseVersion=t.baseVersion||0}return e.prototype.init=function(){var e;a.GlobalContext.registerPlugin(((e={})[me.b.SetData2Store]=this.setDataToStorePlugin,e))},e.prototype.destroy=function(){var e;a.GlobalContext.unRegisterPlugin(((e={})[me.b.SetData2Store]=this.setDataToStorePlugin,e))},e.prototype.updateBaseVersion=function(e){this.baseVersion<e&&(this.baseVersion=e)},e.prototype.deleteOfflineChangeset=function(e,t,o){var n=ve.QueryCondition.newInstance().addCondition("type",ve.QUERY_CONDITION_TYPE.ONLY,o).addCondition("secretId",ve.QUERY_CONDITION_TYPE.ONLY,t).addCondition("globalPadId",ve.QUERY_CONDITION_TYPE.ONLY,e);Me.c.handleDataFromIndexDB({type:Me.a.delete,tableName:ve.TableName.OFFLINE_DATA,where:n})},e.prototype.deleUserChangeData=function(e){if(this.collabClient.offline.isBrowserSupportIndexedDB){var t;switch(e){case me.c.UserChangeset:t=ve.OFFLINE_ITEM_TYPE.WATTING;break;case me.c.QueueChanges:t=ve.OFFLINE_ITEM_TYPE.QUEUE;break;case me.c.SubmittedChangeset:t=ve.OFFLINE_ITEM_TYPE.COMMITING;break;default:return}t!==ve.OFFLINE_ITEM_TYPE.WATTING&&t!==ve.OFFLINE_ITEM_TYPE.COMMITING&&t!==ve.OFFLINE_ITEM_TYPE.QUEUE||this.deleteOfflineChangeset(this.globalPadId,this.secretId,t)}},e.prototype.clearOfflineStore=function(t){m.Logger.warn(e.LOG_TAG+"clearOfflineStore: "+t);var o=pt.a.get("uid"),n=ve.QueryCondition.newInstance().addCondition("globalPadId",ve.QUERY_CONDITION_TYPE.ONLY,this.globalPadId).addCondition("secretId",ve.QUERY_CONDITION_TYPE.ONLY,this.secretId).addCondition("type",ve.QUERY_CONDITION_TYPE.IN,[ve.OFFLINE_ITEM_TYPE.COMMITING,ve.OFFLINE_ITEM_TYPE.WATTING,ve.OFFLINE_ITEM_TYPE.QUEUE]).addCondition("uid",ve.QUERY_CONDITION_TYPE.ONLY,o);Me.c.handleDataFromIndexDB({type:Me.a.delete,tableName:ve.TableName.OFFLINE_DATA,where:n})},e.prototype.updateMemoryAndIndexDB=function(e,t){var o=e;if(t===me.c.SubmittedChangeset&&this.collabClient.updateCommtingWaitting(o),o&&this.collabClient.offline.isBrowserSupportIndexedDB&&!this.collabClient.messageSender.serverchangesets.has(o.taskId))try{t===me.c.UserChangeset?(m.Logger.info("offline edit write,UserChangeset:"+(o?o.changeset+" id:"+o.taskId:"")),o.status=Ie.WATING,this.setData(o)):t===me.c.SubmittedChangeset?(m.Logger.info("offline edit write,SubmittedChangeset:"+(o?o.changeset+" id:"+o.taskId:"")),0!==o.taskId?(o.status=Ie.COMMITING,this.setData(o)):(m.Logger.warn("offline edit write, submit: taskid is null."),Te.b.reportToWeblogWithKey("Word_MeloUserChangeTaskidNull",3e5))):t===me.c.QueueChanges&&(m.Logger.info("offline edit write,QueueChanges:"+(o?o.changeset+" id:"+o.taskId:"")),o.status=Ie.QUEUE,this.setData(o))}catch(e){this.collabClient.offline.Available(5)}},e.prototype.setData=function(e){if(this.collabClient.offline.Available){var t=e;t.baseVersion=void 0===t.baseVersion?this.baseVersion:t.baseVersion,t.workbook=this.secretId;var o=ve.OFFLINE_ITEM_TYPE.WATTING;switch(t.status){case Ie.WATING:o=ve.OFFLINE_ITEM_TYPE.WATTING;break;case Ie.QUEUE:o=ve.OFFLINE_ITEM_TYPE.QUEUE;break;case Ie.COMMITING:o=ve.OFFLINE_ITEM_TYPE.COMMITING}var n=new ve.OfflineData({docType:ve.FILE_TYPE.WORD,uid:pt.a.get("uid"),globalPadId:this.globalPadId,secretId:this.secretId,subSheetId:t.subId,type:o,taskId:t.taskId,version:t.baseVersion,data:t.storeData,createTime:t.time,dver:window.App.GlobalConfig.globalCodeVersion});Me.c.handleDataFromIndexDB({type:Me.a.update,tableName:ve.TableName.OFFLINE_DATA,data:n})}},e.LOG_TAG="OfflineStore",e}(),yt=o(108),vt=o(102),Ct=function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},_t=function(e,t){var o,n,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},wt=function(){function e(e){this.getMissRetryCount=0,this.getMissRetryMaxCount=3,this.queue=[],this._apool=new ie.AttribPool,this.client=e}return e.prototype.init=function(){},e.prototype.destroy=function(){},e.prototype.getMisschangesetByCGI=function(e,t,o){this.client.missChagedSet.getMisschangesetByCGI(e,(function(e){if(e&&0===e.retcode&&e.result&&e.result.changes)t&&t(e);else{var n="getMissChangeset data.retcode = "+(e&&e.retcode)+" or no change";o&&o(n)}}),(function(e){var t="getMissChangeset fail! reason:"+(e&&e.error);o&&o(t)}))},e.prototype.getmisschangesetFromRev=function(t,o,n){var r=this;m.Logger.info(e.LOG_Module+" getMissChangeset from rev = "+t),this.getMissRetryCount=0;var i=(new Date).getTime(),a=function(n){var r=(new Date).getTime()-i;m.Logger.info(e.LOG_Module+" getMissChangeset success!  from:"+t+" to:"+(n&&n.result&&n.result.to)+" cost:"+r),n&&n.result&&n.result.changes&&o&&o(n)},s=function(o){m.Logger.info(e.LOG_Module+" OfflineChangesetFollow getMisschangeset fail,"+o),r.getMissRetryCount<r.getMissRetryMaxCount?(r.getMissRetryCount+=1,r.getMisschangesetByCGI(t,a,s)):n&&n(o)};this.getMisschangesetByCGI(t,a,s)},e.prototype.fixTableHeader=function(e,t){var o=this,n=e;t.forEach((function(e){"BB08J2"!==e.subId&&(n=Object(vt.b)(n,e,!0,o._apool,!1))}))},e.prototype.fixTableCsPrefix=function(e,t){if(e.changeset){var o=ie.Changeset.builder(t),n=ie.Changeset.unpack(e.changeset);n&&n.charBank&&(o.keep(t-1),o.insert(n.charBank)),e.changeset=o.toString()}},e.prototype.fixToFollow=function(e,t){var o=ie.Changeset.unpack(e);if(o&&t.changeset){var n=ie.Changeset.unpack(t.changeset);n&&n.oldLen!==o.oldLen&&this.fixTableCsPrefix(t,o.oldLen)}},e.prototype.fixToCompose=function(e,t){var o=ie.Changeset.unpack(e);if(o&&t.changeset){var n=ie.Changeset.unpack(t.changeset);n&&n.oldLen!==o.newLen&&this.fixTableCsPrefix(t,o.newLen)}},e.prototype.followTableAndApply=function(e,t,o,n){for(var r=null,i=t,a=0;a<o.length;a++){var s=o[a],c=s.changeset;if("BB08J2"===s.subId)return;if(s.commitId===n){this.queue=o.slice(a+1);break}var l=!s.head&&e===s.subId&&!ie.Changeset.isIdentity(c);this.fixToFollow(i,s),i=Object(vt.b)(i,s,!0,this._apool,l),r&&r.changeset&&this.fixToCompose(r.changeset,s),r=s}},e.prototype.follow=function(e,t,o,n,r,i,a){var s=[];if(this.queue.forEach((function(e){s.push(e)})),i||!r)if("BB08J2"!==n)this.followTableAndApply(n,e,s,a);else{var c=e;if(o){var l=ie.AttribPool.fromJsonable(o);c=ie.Changeset.moveOpsToNewPool(e,l,this._apool)}for(var u=0;u<s.length;u++){var h=s[u];if(h.commitId===a){this.queue=s.slice(u+1);break}"BB08J2"===h.subId&&(c=Object(vt.b)(c,h,!0,this._apool,!1))}}else this.fixTableHeader(e,s)},e.prototype.moveChangesetToQueue=function(e,t,o){var n=this,r=e,i=t,a=o,s=[];r&&s.push(r),i&&i.forEach((function(e){s.push(e)})),a&&a.changeset&&!ie.Changeset.isIdentity(a.changeset)&&s.push(a),s.forEach((function(e){e.changeset&&n.queue.push(e)}))},e.prototype.updateApool=function(e,t){if(t){var o=ie.AttribPool.fromJsonable(t);ie.Changeset.moveOpsToNewPool(ie.Changeset.cloneAText(e)&&ie.Changeset.cloneAText(e).attribs,o,this._apool)}},e.prototype.getMisschangesetAndFollow=function(t,o,n,r,i,a){return Ct(this,void 0,void 0,(function(){var s=this;return _t(this,(function(c){return[2,new Promise((function(c,l){var u=+new Date;s.getmisschangesetFromRev(t,(function(t){try{var h=+new Date;s.updateApool(o,n),s.moveChangesetToQueue(r,i,a);var d=0;if(t&&t.result&&t.result.changes&&t.result.changes.length>0){var p=t.result.changes,f=t.result.to,g=s.client.getPadRev(),b=[];if(s.queue&&s.queue.length>0){if(f>g)for(var y=p.length-1;y>=0;y--){var v=p[y].data;if(!(v&&v.newRev>g))break;b.unshift(v)}d=t.result.changes.length*s.queue.length;for(y=0;y<p.length;y++)if(p[y].data){var C=p[y].data,_=C.changeset,w=C.author||"",S=C.apool;s.follow(_,w,S,C.subId,C.head,C.revert,C.commitId)}if(b.length>0&&b[0])b[0].newRev===g+1&&b.forEach((function(e){var t=e.changeset,o=e.author||"",n=e.apool;s.client.applyChangesToBase(t,o,n,e.subId,e.head,e.revert,e.newRev),s.client.offline.offlineStore.baseVersion<e.newRev&&s.client.offline.offlineStore.updateBaseVersion(e.newRev)}))}}m.Logger.info(e.LOG_Module+" after  followCount:"+d+" cgicost:"+(+new Date-u)+" followcost:"+(+new Date-h));var E={result:s.queue||[]};c(E)}catch(e){l(E={result:void 0,reason:"FollwError",des:e})}}),(function(e){l({result:void 0,reason:"GetDataErrorByCGI",des:e})}))}))]}))}))},e.LOG_Module="OfflineFollow ",e}(),St=function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},Et=function(e,t){var o,n,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};!function(e){e.POST="POST",e.GET="GET"}(ct||(ct={})),function(e){e.None="None",e.Network="Network",e.ServerVerity="ServerVerity"}(lt||(lt={}));var Tt,Rt=function(){function e(e){this.rev=e}return e.prototype.composeOfflineData=function(e,t){if(!t||0===t.length)return{};var o=pt.a.get("uid"),n=t[0];return{common:{type:"USER_CHANGES",offlineMsg:!0,curRev:this.rev,docid:e,uid:o,dver:window.App.GlobalConfig.globalCodeVersion,base_rev:n.baseRev,code_ver:0,session_type:0,gray:window._grayVersion?window._grayVersion:0,generalpacket:{rel_rev:window.__globalReleaseVersion},pver:2,uuId:o},respective:t.map((function(e){return{task_id:e.commitId,subId:e.subId,oSubId:e.oSubId||!1,head:e.head,keydata:e.keydata||!1,changeSetCount:e.changeSetCount||1,changeset:e.changeset,apool:e.apool}}))}},e.prototype.commitOfflineData=function(e,t){return St(this,void 0,void 0,(function(){var o,n;return Et(this,(function(r){return o="/dop-api/commitchanges?padId="+e+"&xsrf="+Object(a.getXsrf)(),n=JSON.stringify(t),n=encodeURIComponent(n),[2,ve.CGI.sendCommonRequest(o,ct.POST,"data="+n)]}))}))},e.prototype.batchCommitOfflineData=function(e,t,o,n){return St(this,void 0,void 0,(function(){var r,i,a,s,c,l=this;return Et(this,(function(u){switch(u.label){case 0:return r=[],i={success:!1,type:lt.None,data:[]},t&&r.push(t),o&&o.forEach((function(e){r.push(e)})),n&&n.changeset&&!ie.Changeset.isIdentity(n.changeset)&&r.push(n),a=this.composeOfflineData(e,r),[4,this.commitOfflineData(e,a)];case 1:return(s=u.sent()).error?[4,this.commitOfflineData(e,a)]:[3,3];case 2:s=u.sent(),u.label=3;case 3:return s.error?(i.type=lt.Network,m.Logger.error(s.error),[2,i]):((c=s.data)&&0===c.retcode?(c.Data.respective.forEach((function(e){m.Logger.info("commitOfflineData:"+l.rev+", "+e.newRev+", "+e.changeset+", "+e.commitId),e.newRev>l.rev&&i.data.push(e)})),i.success=!0):(i.type=lt.ServerVerity,m.Logger.error("batchCommitOfflineData retcode:"+(c&&c.retcode))),[2,i])}}))}))},e}(),It=function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},Ot=function(e,t){var o,n,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},Pt=function(){function e(e,t){this.clearUndoRedoStack=t,this.userChangeQuene=[],this.collabClient=e.collabClient,this.secretId=e.secretId,this.globalPadId=e.globalPadId}return e.prototype.init=function(){this.collabClient.offline.isPadEditable()||a.GlobalContext.fire(new Ee(L.Readonly))},e.prototype.destroy=function(){this.collabClient.notificationCenter.removeListener(a.StateNotification.NewDocument,this)},e.prototype.backupOfflineChangesets=function(e){if(e.userChange){var t=e.userChange;t.commitId&&(t.applied=yt.a.isMergeToBase(t.commitId)),this.userChange=t}if(e.userChangeQuene){var o=e.userChangeQuene.map((function(e){var t=e;return t.commitId&&(t.applied=yt.a.isMergeToBase(t.commitId)),t}));this.userChangeQuene=o}if(e.userChangeSubmitted){var n=e.userChangeSubmitted;n.commitId&&(n.applied=yt.a.isMergeToBase(n.commitId)),this.userChangeSubmitted=n}(this.userChangeQuene&&this.userChangeQuene.length>0||this.userChange||this.userChangeSubmitted)&&(m.Logger.info("DB read SubmittedChangeset:"+(this.userChangeSubmitted?this.userChangeSubmitted.changeset+" id:"+this.userChangeSubmitted.commitId:"")),m.Logger.info("DB read QueueChangeset:"+(this.userChangeQuene&&this.userChangeQuene.length>0?JSON.stringify(this.userChangeQuene):"")),m.Logger.info("DB read UserChangeset:"+(this.userChange?this.userChange.changeset+" id:"+this.userChange.commitId:"")))},e.prototype.preParewebSocketLink=function(e,t){this.clearUndoRedoStack(),this.collabClient.offline.BrowserSupportIndexedDB(e),this.afterRestore(),a.GlobalContext.fire(new Ee(t)),e||Te.b.monitorOfflineModule("IndexDBNotSupport")},e.prototype.followException=function(e){var t=this,o=this.collabClient.csManager;this.collabClient.notificationCenter.once(a.StateNotification.NewDocument,(function(){o.applyOfflineChangesToBase(t.userChangeSubmitted,t.userChangeQuene,t.userChange),Ne.showErrorTips(t.collabClient,we.CollabRoomGetMisschangAndFollowError)}),this),o.setTotalBaseAttributeText({text:unescape(e.initialAttributedText.text),attribs:e.initialAttributedText.attribs},e.apool,!1)},e.prototype.fetchAttributedTextFromServer=function(e){var t=this;return new Promise((function(o,n){var r="/dop-api/get/pad?padId="+t.collabClient.globalPadId+"&rev="+e+"&timestamp="+(new Date).getTime();f.a.get(r,{},(function(e,t){if("success"===t&&0===e.retcode){var r=e.data;o({retcode:0,data:r})}else m.Logger.warn("fetchAttributedTextFromServer fail retcode:"+(e&&e.retcode)),n({retcode:e&&e.retcode||-1})})).fail((function(){m.Logger.warn("fetchAttributedTextFromServer get fail."),n({retcode:-2})}))}))},e.prototype.prepareUpdateOfflineData=function(e,t,o,n){return It(this,void 0,void 0,(function(){var r,i,a,s;return Ot(this,(function(c){switch(c.label){case 0:return[4,this.fetchAttributedTextFromServer(e)];case 1:return 0===(r=c.sent()).retcode&&r.data?(i=r.data,a=this.collabClient.getPadRev(),e<a?(ie.ChangesetTool.autoReport=!1,[4,new wt(this.collabClient).getMisschangesetAndFollow(e+1,{text:unescape(i.initialAttributedText.text),attribs:i.initialAttributedText.attribs},i.apool,t,o,n)]):[3,3]):[3,4];case 2:return s=c.sent(),ie.ChangesetTool.autoReport=!0,s.reason?(m.Logger.error("getMisschangesetAndFollow:"+(s&&s.reason)+" "+(s&&s.des)),"FollwError"===s.reason?[2,{reason:2,serverData:i}]:[2,{reason:1}]):[2,{reason:0,source:L.ApplyOfflineData,userChangeQuene:s.result}];case 3:return m.Logger.warn("fetchAttributedTextFromServer offline rev:"+e+" is bigger than server:"+a),[2,{reason:5}];case 4:return[2,{reason:4}]}}))}))},e.prototype.handleMaxRevDiffOfflineData=function(e,t,o,n){return It(this,void 0,void 0,(function(){var r,i;return Ot(this,(function(a){switch(a.label){case 0:return r=!0,window.loadingSnackBar&&window.loadingSnackBar.show(),[4,this.prepareUpdateOfflineData(e,t,o,n)];case 1:switch(i=a.sent(),window.loadingSnackBar&&window.loadingSnackBar.hide(),i.reason){case 0:r=!1,this.collabClient.csManager.applyOfflineChangesToBase(void 0,i.userChangeQuene,void 0);break;case 1:r=!1,Te.b.reportToWeblogWithKey(Te.a.WordMeloOfflineCSGetAndFollowFail,18e4),Ne.showTips(this.collabClient,we.CollabRoomGetMisschangFail),Te.b.monitorOfflineMissFollowErr("GetDataErrorByCGI");break;case 2:Te.b.reportToWeblogWithKey(Te.a.WordMeloOfflineCSGetAndFollowError,18e4),this.followException(i.serverData),Te.b.monitorOfflineMissFollowErr("FollwError");break;case 5:Te.b.reportToWeblogWithKey(Te.a.WordMeloLocalVersionBiggerthanServer,18e4)}return[2,r]}}))}))},e.prototype.clearAcceptOfflineData=function(e){m.Logger.warn("$clearAcceptOfflineData: "+e);var t=pt.a.get("uid"),o=ve.QueryCondition.newInstance().addCondition("globalPadId",ve.QUERY_CONDITION_TYPE.ONLY,this.globalPadId).addCondition("secretId",ve.QUERY_CONDITION_TYPE.ONLY,this.secretId).addCondition("type",ve.QUERY_CONDITION_TYPE.IN,[ve.OFFLINE_ITEM_TYPE.COMMITING,ve.OFFLINE_ITEM_TYPE.WATTING,ve.OFFLINE_ITEM_TYPE.QUEUE]).addCondition("uid",ve.QUERY_CONDITION_TYPE.ONLY,t);Me.c.handleDataFromIndexDB({type:Me.a.delete,tableName:ve.TableName.OFFLINE_DATA,where:o})},e.prototype.commitChangesByCGI=function(e,t){return It(this,void 0,void 0,(function(){var o,n,r,i,a=this;return Ot(this,(function(s){switch(s.label){case 0:return o=!0,n=0,[4,new Rt(e).batchCommitOfflineData(this.globalPadId,this.userChangeSubmitted,this.userChangeQuene,this.userChange)];case 1:return(r=s.sent()).success?(r.data.forEach((function(e){if(e.newRev===a.collabClient.getPadRev()+1){var t=e.changeset,o=e.author||"",n=e.apool;e&&e.commitId&&(m.Logger.info("commitChangesResult:"+a.collabClient.getPadRev()+", "+e.newRev+", "+e.changeset+", "+e.commitId),a.collabClient.setPadRev(e.newRev),a.collabClient.applyChangesToBase(t,o,n,e.subId,e.head,e.revert,e.newRev))}})),this.clearAcceptOfflineData(),[3,5]):[3,2];case 2:return lt.Network!==r.type?[3,3]:(o=!1,n=we.CollabRoomCommitCSFailByCGI,[3,5]);case 3:return lt.ServerVerity!==r.type?[3,5]:(o=!1,n=we.CollabRoomCommitCSErrorByCGI,[4,this.fetchAttributedTextFromServer(t)]);case 4:0===(i=s.sent()).retcode&&i.data&&this.followException(i.data),s.label=5;case 5:return o||(Te.b.reportToWebLog(""+n),Ne.showTips(this.collabClient,n),Te.b.monitorCommitErr(n)),[2,o]}}))}))},e.prototype.beginRestoreOfflineData=function(e,t){var o=this;if(e&&(this.beforeRestore=e),t&&(this.afterRestore=t),this.secretId||(this.collabClient.offline.Available(3),m.Logger.error("globalPadId or userId can not be null")),!this.collabClient.offline.isPadEditable())return m.Logger.error("beginRestoreOfflineData, _isPadEditable: false"),void this.afterRestore();yt.a.loadOfflineChangesetsPromise(this.secretId).then((function(e){return It(o,void 0,void 0,(function(){var t,o,n,r,i;return Ot(this,(function(a){switch(a.label){case 0:return e.DBisOK?(this.collabClient.offline.BrowserSupportIndexedDB(!0),t=!0,o=L.HasNotOfflineData,e.data?(n=e.data).error?(m.Logger.error("loadOfflineChangesFromIndexDB:"+JSON.stringify(n.error)),t=!1,o=L.NotSupportIndexDB,[3,6]):[3,1]:[3,6]):[3,7];case 1:return(n.userChangeQuene&&n.userChangeQuene.length>0||n.userChange||n.userChangeSubmitted)&&void 0!==n.version?(r=1e4,this.beforeRestore(),i=this.collabClient.getPadRev(),this.backupOfflineChangesets(n),i!==e.data.version?[3,2]:(o=L.RevEqualOfflineData,this.collabClient.csManager.applyOfflineChangesToBase(this.userChangeSubmitted,this.userChangeQuene,this.userChange),[3,6])):[3,6];case 2:return i-n.version<r?[4,this.commitChangesByCGI(i,n.version)]:[3,4];case 3:return a.sent()?(o=L.CommitChangesSuccess,[3,6]):[2];case 4:return[4,this.handleMaxRevDiffOfflineData(n.version,this.userChangeSubmitted,this.userChangeQuene,this.userChange)];case 5:if(!a.sent())return[2];t=!1,o=L.FetchAttributedTextFail,a.label=6;case 6:return this.preParewebSocketLink(t,o),[3,8];case 7:m.Logger.error("beginRestoreOfflineData, isBrowserSupportIndexedDB false"),this.preParewebSocketLink(!1,L.NotSupportIndexDB),a.label=8;case 8:return[2]}}))}))}))},e}(),kt=o(246),Nt=[40007,ye.TDWebsocketErrorCode.Socket_Data_ServerUnkownErr,ye.TDWebsocketErrorCode.Socket_Data_ProtocolFieldLack,ye.TDWebsocketErrorCode.Socket_ClientData_Error,ye.TDWebsocketErrorCode.Socket_UserChange_ParamError,ye.TDWebsocketErrorCode.Socket_Command_Unsupport,ye.TDWebsocketErrorCode.Socket_DocPrivilege_Failed,ye.TDWebsocketErrorCode.Socket_PackageSize_TooLarge,ye.TDWebsocketErrorCode.Socket_UserDoc_NoPrivilege,ye.TDWebsocketErrorCode.Socket_Data_Server_Error,ye.TDWebsocketErrorCode.Socket_Data_Doc_NoExist,ye.TDWebsocketErrorCode.Socket_Data_Subid_Error,ye.TDWebsocketErrorCode.Socket_Data_Action_Length,ye.TDWebsocketErrorCode.Socket_Data_Changeset_Easysync,ye.TDWebsocketErrorCode.Socket_Data_Read_Fail,ye.TDWebsocketErrorCode.Socket_Data_Baserev_Error,ye.TDWebsocketErrorCode.Socket_Data_NoSupportType,ye.TDWebsocketErrorCode.Socket_Data_NoSupportProto,ye.TDWebsocketErrorCode.Socket_Data_ContentLimit,ye.TDWebsocketErrorCode.Socket_Data_EasysyncTimeout,ye.TDWebsocketErrorCode.Socket_JS_TooOld,ye.TDWebsocketErrorCode.Socket_Data_DocId_Error,ye.TDWebsocketErrorCode.Socket_Data_ProtocolType_Error,we.CollabRoomDefaultErrCode,we.CollabRoomChangsetErrorEasysync,we.CollabRoomCHANGESETERRORAPPLYOFFLINE,we.CollabRoomGetMisschangAndFollowError,we.CollabRoomApplyOnline,we.CollabRoomCommitCSErrorByCGI],Mt=function(){function e(t,o,n,r){var i=this;this.canEdit=o,this.handleHow2Detla=n,this.clearUndoRedoStack=r,this._hasShowOfflineFlag=!1,this._hasShowOfflineTips=!1,this._isRestored=!1,this.isSupportIndexedDB=!1,this.status=0,this.restoreOfflineData=function(){i._isRestored||(i._isRestored=!0,i.offlineRestore&&i.offlineRestore.beginRestoreOfflineData(i.showRestoreOfflineDataTips,i.dismissRestoreOfflineDataTips))},this.showRestoreOfflineDataTips=function(){m.Logger.info(e.LOG_TAG+" | showRestoreOfflineDataTips"),window.pad,window.pad.permissionCtrl,window.pad.permissionCtrl.setPrivilege,window.pad.permissionCtrl.setPrivilege({isBlocked:!0}),Te.b.monitorOfflineModule("HasData")},this.dismissRestoreOfflineDataTips=function(){m.Logger.info(e.LOG_TAG+" | dismissRestoreOfflineDataTips"),window.pad,window.pad.permissionCtrl,window.pad.permissionCtrl.setPrivilege,window.pad.permissionCtrl.setPrivilege({isBlocked:!1}),i.collabClient.csManager.setOfflineRestored(!0)},this.handleChangesetErrorAlert=function(e){m.Logger.warn(e.detail.code);var t=e&&e.detail&&e.detail.code&&Number(e.detail.code)||72999;i.collabClient.notificationCenter.fire(new Re.c({errMsg:"编辑内容暂无法保存。",errCode:""+t,action:[Re.a.HOW2DEAL]}))},this.handleClearOfflineData=function(e){m.Logger.warn(e.detail.code);var t=e&&e.detail&&e.detail.code;t&&Nt.indexOf(Number(t))>-1&&i.offlineStore.clearOfflineStore(t)},this.collabClient=t,this.status=2;var a={collabClient:t,secretId:this.collabClient.getWorkBookInfo,globalPadId:this.collabClient.globalPadId,userId:this.collabClient.userId,uid:pt.a.get("uid"),userDomain:this.collabClient.clientVars.userDomain,baseVersion:this.collabClient.getPadRev()};this.offlineStore=new bt(a),this.offlineRestore=new Pt(a,r),window.onbeforeunload=function(){if(i.collabClient.hasUncommittedChanges()&&!i.isBrowserSupportIndexedDB)return"文档存在未保存修改，如果关闭，修改将不会被保存。您是否确定关闭？"},window.addEventListener("OnTencentDocsDBVersionChanged",(function(){m.Logger.warn("OnTencentDocsDBVersionChanged"),Me.c.getDataBase().disConnect(!1),window.pad,window.pad.permissionCtrl,window.pad.permissionCtrl.setPrivilege,window.pad.permissionCtrl.setPrivilege({isBlocked:!1}),i.collabClient.shutDownRoomChannel("Word database ",we.CollabRoomDataBaseChange)})),document.addEventListener("Melo_ClearOfflineData",this.handleClearOfflineData),document.addEventListener("Melo_ChangesetErrorAlert",this.handleChangesetErrorAlert),document.addEventListener("Melo_How2Deal_CopyAllData2Memory",this.handleHow2Detla),Te.b.monitorOfflineModule("Total")}return Object.defineProperty(e.prototype,"isBrowserSupportIndexedDB",{get:function(){return this.isSupportIndexedDB},enumerable:!0,configurable:!0}),e.prototype.BrowserSupportIndexedDB=function(e){this.isSupportIndexedDB=e},Object.defineProperty(e.prototype,"isAvailable",{get:function(){return 2===this.status},enumerable:!0,configurable:!0}),e.prototype.Available=function(e){this.status=e},e.prototype.isPadEditable=function(){return this.canEdit()},e.prototype.init=function(){this.offlineStore.init(),this.offlineRestore.init()},e.prototype.destroy=function(){this.offlineStore.destroy(),this.offlineRestore.destroy(),document.removeEventListener("Melo_ClearOfflineData",this.handleClearOfflineData),document.removeEventListener("Melo_ChangesetErrorAlert",this.handleChangesetErrorAlert),document.removeEventListener("Melo_How2Deal_CopyAllData2Memory",this.handleHow2Detla)},e.prototype.showEnterOfflineEditTips=function(e){-1===e.indexOf("UNAUTH")&&-1===e.indexOf("TX-LOGIN-PSKEY-EXPIRED")&&(this._hasShowOfflineFlag=!0,this.collabClient.notificationCenter.fire(new kt.b(this.collabClient.hasUncommittedChanges())),this.collabClient.hasUncommittedChanges()&&(this.showOfflineEditTips(this.canEdit()),this._hasShowOfflineTips=!0))},e.prototype.checkOfflineEditTips=function(){this._hasShowOfflineFlag&&!this._hasShowOfflineTips&&this.collabClient.hasUncommittedChanges()&&(this.collabClient.notificationCenter.fire(new kt.b(this.collabClient.hasUncommittedChanges())),this.collabClient.hasUncommittedChanges()&&(this.showOfflineEditTips(this.canEdit()),this._hasShowOfflineTips=!0))},e.prototype.showOfflineEditTips=function(t){m.Logger.info(e.LOG_TAG+" | showOfflineEditTips, editable: "+t),this.isBrowserSupportIndexedDB?this.collabClient.notificationCenter.fire(new kt.a(this.collabClient.hasUncommittedChanges())):this.collabClient.notificationCenter.fire(new Re.c({errMsg:"离线编辑不可用，请连接网络后刷新。"}))},e.prototype.handleOnline=function(){this._hasShowOfflineFlag&&(this._hasShowOfflineFlag=!1,this._hasShowOfflineTips=!1,m.Logger.info(e.LOG_TAG+" | offline websocket has reconnected..."),this.isBrowserSupportIndexedDB?this.collabClient.notificationCenter.fire(new kt.d(this.collabClient.hasUncommittedChanges())):this.collabClient.notificationCenter.fire(new Re.e("")))},e.LOG_TAG="OffLine",e}(),Dt=function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},xt=function(e,t){var o,n,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},At=function(){function e(e){this.getMissRetryCount=0,this.maxMissRetryCount=3,this.isPullingMiss=!1,this.lastGetMissTime=0,this.getMissInterval=0,this.missChangeSetQueue=[],this.lastReceiveMissTime=0,this.CollabClient=e}return e.prototype.init=function(){},e.prototype.destroy=function(){},Object.defineProperty(e.prototype,"messageSender",{get:function(){return this.CollabClient.messageSender},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"offlineStore",{get:function(){return this.CollabClient.offline.offlineStore},enumerable:!0,configurable:!0}),e.prototype.isPullingMissChangeset=function(){return!!(this.isPullingMiss||this.missChangeSetQueue.length>0)},e.prototype.handleMissChangeSet=function(e,t){if(Ce.a.roomLogInfo("handleMissChangeSet getMissChange ,the to = "+e.to),e.to)if(e.to<this.CollabClient.getPadRev())Ce.a.roomLogWarn("handleMissChangeSet to is less the pad rev");else{if(this.reportRecvMissChange(e.to,t),this.messageSender.commitingQueue&&e.commitId&&e.commitId===this.messageSender.commitingQueueTaskId&&e.to-this.messageSender.commitingQueue.baseVersion>0&&e.to-this.messageSender.commitingQueue.baseVersion<50&&void 0!==e.need&&void 0!==e.subId)return Ce.a.roomLogInfo("handleMissChangeSet the changesetData is duplicate commitId = "+e.commitId),this.messageSender.cancelMessageBySeq(this.messageSender.commitingQueueTaskId),this.messageSender.commitFailCount=0,this.acceptCommitMissTimer&&(clearTimeout(this.acceptCommitMissTimer),this.acceptCommitMissTimer=0),void this.CollabClient.applyCommittingChangeset(e.to,e);if(0===this.missChangeSetQueue.length)this.missChangeSetQueue.push(e);else{for(var o=!1,n=this.missChangeSetQueue.length-1;n>=0;n--){if(e.to===this.missChangeSetQueue[n].to){Ce.a.roomLogWarn("handleMissChangeSet the comming change has exist to = "+e.to),o=!0;break}if(e.to>this.missChangeSetQueue[n].to){this.missChangeSetQueue.splice(n,0,e),o=!0;break}}!1===o&&this.missChangeSetQueue.unshift(e)}this.tryGetMissChagedSet()}else Ce.a.roomLogError("handleMissChangeSet to error")},e.prototype.tryGetMissChagedSet=function(){if(this.missChangeSetQueue.length>0){var e=this;setTimeout((function(){if(!0!==e.isPullingMiss){var t=e.missChangeSetQueue.length;if(!(t<=0)){var o=e.CollabClient.getPadRev(),n=e.missChangeSetQueue[t-1];n&&n.to<=o?e.missChangeSetQueue=[]:e.getMissChangeset(o+1,n&&n.source||"")}}else Ce.a.roomLogWarn("tryGetMissChagedSet is pulling miss, skip")}),500)}},e.prototype.clearMissChangeSetQueueByRev=function(e){for(var t=!1,o=0;o<this.missChangeSetQueue.length;o++)if(this.missChangeSetQueue[o].to>e){t=!0,this.missChangeSetQueue.splice(0,o);break}!1===t&&(this.missChangeSetQueue=[]),Ce.a.roomLogInfo("clearMissChangeSetQueueByRev "+e+" queue:"+JSON.stringify(this.missChangeSetQueue)),this.tryGetMissChagedSet()},e.prototype.onGetMissChangeSetFail=function(e,t){Ce.a.roomLogWarn("onGetMissChangeSetFail fail. count:"+this.getMissRetryCount),this.reportGetMissChange(!1,t),!0===e&&this.clearMissChangeSetQueueByRev(this.CollabClient.getPadRev()),this.getMissRetryCount<this.maxMissRetryCount?this.tryGetMissChagedSet():(Ce.a.roomLogError("onGetMissChangeSetFail ready to shutdown"),this.CollabClient.shutDownRoomChannel("get miss changeset fail tryCount="+this.getMissRetryCount,we.CollabRoomGetMisschangFail))},e.prototype.getMisschangesetByCGI=function(e,t,o){var n=this,r=new Map,i=e,a="",s=function(e,t,o){var r="/dop-api/get/changes?padId="+n.CollabClient.globalPadId+"&from="+e;a&&(r=r+"&context="+a),$.ajax({url:r,success:function(e){e&&e.result&&e.result.context&&(a=e.result.context),t&&t(e)},error:function(e,t,n){o&&o({error:"getMisschangesetByCGI rsp error status = "+t+" errorThrown"+n+" xhr"+e,retcode:-1})}})},c=function(e){Ce.a.roomLogWarn("getMisschangesetByCGI:"+e.error),o&&o(e)},l=function(e){if(e&&0===e.retcode&&e.result&&e.result.changes){var n=e;if(r.has(i)&&n&&n.result){var a=r.get(i);n.result.to=e.result.to>n.result.to?e.result.to:n.result.to,n.result.changes=a.result.changes.concat(n.result.changes)}r.set(i,n),n&&n.result&&n.result.rev>n.result.to?s(n.result.to+1,l,c):t&&t(n)}else Ce.a.roomLogError("onCGISuccessRsp:"+(e&&e.retcode)),o&&o()};s(e,l,c)},e.prototype.getMissChangeset=function(e,t){var o=this;Ce.a.roomLogInfo("getMissChangeset from rev = "+e);var n=(new Date).getTime();this.isPullingMiss=!0,this.getMissRetryCount=this.getMissRetryCount+1;var r=(new Date).getTime();this.lastGetMissTime&&(this.getMissInterval=r-this.lastGetMissTime),this.lastGetMissTime=r,this.getMisschangesetByCGI(e,(function(r){var i=(new Date).getTime()-n;if(Ce.a.roomLogInfo("getMissChangeset success!  from:"+e+" to:"+(r&&r.result&&r.result.to)+"\n            retcode:"+(r&&r.retcode)+" changes:"+(r.result&&r.result.changes&&r.result.changes.length||"")+" cost:"+i),o.isPullingMiss=!1,o.getMissRetryCount=0,r&&0===r.retcode&&r.result&&r.result.changes){var a=o.CollabClient.getPadRev(),s=e,c=r.result.to;if(a+1<s)return Ce.a.roomLogError("getMissChangeset impossilbe error: the pad rev is less than minServerRev"),void o.onGetMissChangeSetFail(!1,"pad rev is less than minServerRev");if(a>c)return Ce.a.roomLogError("getMissChangeset impossilbe error: maxServerRev is less than the pad rev"),void o.onGetMissChangeSetFail(!0,"maxServerRev is less than the pad rev");o.applyMissChangeData(r,t)}else{Ce.a.roomLogError("getMissChangeset error retcode = "+(r&&r.retcode));var l="data.retcode = "+(r&&r.retcode)+" or no change";o.onGetMissChangeSetFail(!0,l)}}),(function(e){var t=(new Date).getTime()-n;Ce.a.roomLogInfo("getMissChangeset fail! reason:"+(e&&e.error)+" cost:"+t),o.isPullingMiss=!1;o.onGetMissChangeSetFail(!1,"net work error")}))},e.prototype.applyMissChangeData=function(e,t){return Dt(this,void 0,void 0,(function(){var o,n,r,i,a,s,c,l;return xt(this,(function(u){switch(u.label){case 0:return o=[],this.CollabClient.offline.isBrowserSupportIndexedDB?(n=e.result.changes.map((function(e){return e.data.commitId})),r=ve.QueryCondition.newInstance().addCondition("globalPadId",ve.QUERY_CONDITION_TYPE.IN,[this.CollabClient.clientVars.globalPadId]).addCondition("taskId",ve.QUERY_CONDITION_TYPE.IN,n),[4,Me.c.getDataBase().getAll(ve.TableName.OFFLINE_DATA,r)]):[3,2];case 1:i=u.sent(),o=i.data||[],u.label=2;case 2:for(Ce.a.roomLogInfo("et taskid from db: "+o),a=function(n){var r=e.result.changes[n].data;if(r.newRev>s.CollabClient.getPadRev()&&r.newRev!==s.CollabClient.getPadRev()+1)return Ce.a.roomLogError(" applyMissChangeData impossilbe  error: the rev from server is not continue error source:"+t),s.onGetMissChangeSetFail(!1,"the rev from server is not continue"),{value:void 0};if(r.newRev===s.CollabClient.getPadRev()+1)if(s.messageSender.commitingQueue&&r.commitId&&r.commitId===s.messageSender.commitingQueueTaskId&&r.newRev-s.messageSender.commitingQueue.baseVersion>0&&r.newRev-s.messageSender.commitingQueue.baseVersion<50)Ce.a.roomLogWarn(" applyMissChangeData cs is duplicate changeData.commitId = "+r.commitId),s.messageSender.cancelMessageBySeq(s.messageSender.commitingQueueTaskId),s.messageSender.commitFailCount=0,s.acceptCommitMissTimer&&(clearTimeout(s.acceptCommitMissTimer),s.acceptCommitMissTimer=0),s.CollabClient.applyCommittingChangeset(r.newRev,r),s.messageSender.resetCommitingQueue();else{var i=r.changeset,a=r.author||"",c=r.apool;if(r&&r.commitId)o.filter((function(e){return e&&e.data&&e.data.data&&e.data.data.taskId===r.commitId})).length>0?(Ce.a.info("get duplicate changeset "+r.commitId),s.CollabClient.setPadRev(r.newRev)):s.CollabClient.applyChangesToBase(i,a,c,r.subId,r.head,r.revert,r.newRev);if(s.offlineStore.baseVersion<r.newRev&&s.offlineStore.updateBaseVersion(r.newRev),window.App.GlobalConfig.IsSupportStore){var l={type:"USER_CHANGES",baseVersion:s.CollabClient.getPadRev(),uuId:s.CollabClient.uuId,firstCommitRev:-1,pver:2,subId:"BB08J2",data:{changeSetCount:1,changeset:r.changeset,apool:r.apool,head:r.head,oSubId:r.subId,taskId:r.commitId},status:Ie.ACCEPT,offlineMsg:!1},u=new Ke(s.CollabClient,l),h=new ve.OfflineData({docType:ve.FILE_TYPE.WORD,uid:pt.a.get("uid"),globalPadId:s.CollabClient.clientVars.globalPadId,secretId:s.CollabClient.getWorkBookInfo,subSheetId:r.subId,type:ve.OFFLINE_ITEM_TYPE.MISS_CHANGE,taskId:r.commitId,version:r.newRev,data:u.storeData,createTime:+new Date,dver:window.App.GlobalConfig.globalCodeVersion});Me.c.handleDataFromIndexDB({type:Me.a.update,tableName:ve.TableName.DOCUMENT_DATA,data:h})}}},s=this,c=0;c<e.result.changes.length;c++)if("object"==typeof(l=a(c)))return[2,l.value];return this.clearMissChangeSetQueueByRev(this.CollabClient.getPadRev()),this.reportGetMissChange(!0,""),[2]}}))}))},e.prototype.reportGetMissChange=function(e,t){var o=t;e&&(o="suc");var n=(new Date).getTime(),r={opername:"tech_doc_websocket",module:"websocket_collab",action:"GetMissChange",table:"dc03111",ver6:"word"+"TDSP"+"GetMissChange"+"TDSP"+(o||"unkown")+"TDSP"+this.getMissInterval+"TDSP"+(n-this.lastGetMissTime)+"TDSP"+this.getMissRetryCount+"TDSP"};this.CollabClient.tdwreport(r)},e.prototype.reportRecvMissChange=function(e,t){var o=(new Date).getTime(),n=0;this.lastReceiveMissTime&&(n=o-this.lastReceiveMissTime);var r=0;e&&e>this.CollabClient.getPadRev()&&(r=e-this.CollabClient.getPadRev());var i={opername:"tech_doc_websocket",module:"websocket_collab",action:"RecvMissChange",table:"dc03111",ver6:"word"+"TDSP"+"ReceiveMissChange"+"TDSP"+t+"TDSP"+r+"TDSP"+n+"TDSP"};this.CollabClient.tdwreport(i),this.lastReceiveMissTime=o},e}(),Lt=function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},Ft=function(e,t){var o,n,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},Bt=function(e,t){var o="function"==typeof Symbol&&e[Symbol.iterator];if(!o)return e;var n,r,i=o.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(e){r={error:e}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a},Ut=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(Bt(arguments[t]));return e};!function(e){e[e.WORKING=0]="WORKING",e[e.PAUSE=1]="PAUSE"}(Tt||(Tt={}));var jt,Gt=function(){function e(){this._taskList=[],this._status=Tt.PAUSE}return e.prototype.pause=function(){this.switchStatus(Tt.PAUSE),this._currentTask&&(this._currentTask.pause(),this.pushTask(this._currentTask,0))},e.prototype.resume=function(){this.switchStatus(Tt.WORKING)},e.prototype.work=function(){this.hasNext()?this.runNext():this.switchStatus(Tt.PAUSE)},e.prototype.runNext=function(){var e=this.popTask();e&&(e.isPaused()?e.continue():e.run())},e.prototype.onTaskDestroy=function(e){return Lt(this,void 0,void 0,(function(){return Ft(this,(function(e){return this.isQueuePaused()||this.work(),[2]}))}))},e.prototype.hasNext=function(){return!this.isEmpty()},e.prototype.pushTask=function(e,t){var o;void 0===t&&(t=this.length),Array.isArray(e)?(o=this._taskList).splice.apply(o,Ut([t,0],e)):this._taskList.splice(t,0,e),this._status===Tt.PAUSE&&this.switchStatus(Tt.WORKING)},e.prototype.popTask=function(){return 0===this.length?void 0:this._taskList.shift()},e.prototype.switchStatus=function(e){var t=!1;this._status===Tt.PAUSE&&e===Tt.WORKING&&(t=!0),this._status=e,t&&this.work()},e.prototype.isEmpty=function(){return 0===this._taskList.length},e.prototype.isQueuePaused=function(){return this._status===Tt.PAUSE},Object.defineProperty(e.prototype,"length",{get:function(){return this._taskList.length},enumerable:!0,configurable:!0}),e.prototype.shutDown=function(){this._taskList.splice(0,this._taskList.length),this.pause()},e}(),Ht=function(){return(Ht=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},Vt=function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},Wt=function(e,t){var o,n,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};!function(e){e[e.privilegeAttribute=1]="privilegeAttribute",e[e.title=2]="title"}(jt||(jt={}));var Qt,qt=function(){function e(e){var t=this;this.SYNC_CGI_URL="//docs.qq.com/cgi-go/padinfo/getpadinfo",this.secretId="",this.handleNetworkStatusChange=function(){Ae.network.isOnline&&t.syncDocumentInfo(t.secretId)},this.init(e)}return e.prototype.init=function(e){e!==xe.b&&(this.secretId=e||location.pathname.replace("/doc/",""),this.syncDocumentInfo(this.secretId),Ae.network.changeEnd(this.handleNetworkStatusChange.bind(this)))},e.prototype.destory=function(){Ae.network.remove(this.handleNetworkStatusChange)},e.prototype.syncDocumentInfo=function(e){var t=this,o=Object(O.c)();if(!o||!o.isOwner){var n="&infoKeys=["+[jt.privilegeAttribute,jt.title]+"]",r=this.SYNC_CGI_URL+"?encodePadId="+e+n+"&xsrf="+Object(a.getXsrf)();$.get(r).done((function(e){try{var o=JSON.parse(e);if(0===o.retcode){var n=o.data.privilegeAttribute;t.handlePrivilegeChange(n)}else o.retcode}catch(t){m.Logger.error("syncDocumentInfo parse err: "+e)}})).fail((function(e){m.Logger.error("syncDocumentInfo error: "+JSON.stringify(e)+" ")})).always((function(){}))}},e.prototype.handlePrivilegeChange=function(e){return Vt(this,void 0,void 0,(function(){var t,o,n,r;return Wt(this,(function(i){switch(i.label){case 0:if(t=Object(O.c)().privilegeAttribute,!(o=Object.keys(e).reduce((function(o,n){return t[n]!==e[n]&&o.push(n),o}),[])).length)return[3,5];if(!window.clientVars)return[3,4];window.clientVars.privilegeAttribute=Ht(Ht({},window.clientVars.privilegeAttribute),{newPrivilege:e}),i.label=1;case 1:return i.trys.push([1,3,,4]),n=ve.QueryCondition.newInstance().addCondition("globalPadId",ve.QUERY_CONDITION_TYPE.ONLY,window.clientVars.globalPadId).addCondition("type",ve.QUERY_CONDITION_TYPE.IN,[ve.OFFLINE_ITEM_TYPE.INIT,ve.OFFLINE_ITEM_TYPE.ACCEPTED,ve.OFFLINE_ITEM_TYPE.MISS_CHANGE,ve.OFFLINE_ITEM_TYPE.NEW_CHANGE]),[4,Me.c.handleDataFromIndexDB({type:Me.a.delete,tableName:ve.TableName.DOCUMENT_DATA,where:n})];case 2:if((r=i.sent()).error)throw r.error;return[3,4];case 3:return i.sent(),Ce.a.roomLogError("delLocalOfflineData error:"+window.clientVars.globalPadId),[3,4];case 4:a.GlobalContext.fire(new dt.a(e,o)),i.label=5;case 5:return[2]}}))}))},e}(),Yt=function(){function e(e){var t=this;this._mutexTabLockReasonShowTips=!1,this.mutexTabLockReasonShowTips=function(){if(!Ae.network.isOnline&&!t._mutexTabLockReasonShowTips)return t._mutexTabLockReasonShowTips=!0,t.showLockFailTips(t.getLockFailTips(Me.c.mutexTabLockReason)),window.pad,window.pad.permissionCtrl,window.pad.permissionCtrl.setPrivilege,void window.pad.permissionCtrl.setPrivilege({isBlocked:!0})},this.mutexTabLockReasonCloseTips=function(){Ae.network.isOnline&&t._mutexTabLockReasonShowTips&&(t._mutexTabLockReasonShowTips=!1,t.removeGetLockFailTips(),window.pad,window.pad.permissionCtrl,window.pad.permissionCtrl.setPrivilege,window.pad.permissionCtrl.setPrivilege({isBlocked:!1}))},this.editor=e,this.editor.once(a.RenderNotificationTypes.FIRST_RENDER,this.checkMutexLock.bind(this),this)}return e.prototype.destory=function(){this.editor.removeListener(a.RenderNotificationTypes.FIRST_RENDER,this),Ae.network.remove(this.mutexTabLockReasonShowTips),Ae.network.remove(this.mutexTabLockReasonCloseTips),this.removeGetLockFailTips()},e.prototype.getLockFailTips=function(e){var t="文档已在另一个标签页中打开，请关闭对应标签页后再重新加载。";return e&&e.optional&&"list"===e.optional.source&&(t="离线数据同步中，请稍候..."),t},e.prototype.showLockFailTips=function(e){this.toastTips=Be.a.show({message:e,type:"info",autoClose:!1,action:"重新加载",onClickAction:function(){location.reload()}})},e.prototype.removeGetLockFailTips=function(){this.toastTips&&(this.toastTips.close(),this.toastTips=void 0)},e.prototype.checkMutexLock=function(){Me.c.mutexTabLockReason&&(Object(O.c)().padStatus===ve.PadStatus.LOCAL||Object(O.c)().padStatus===ve.PadStatus.NEW?(this.showLockFailTips(this.getLockFailTips(Me.c.mutexTabLockReason)),window.pad,window.pad.permissionCtrl,window.pad.permissionCtrl.setPrivilege,window.pad.permissionCtrl.setPrivilege({isBlocked:!0})):(this.mutexTabLockReasonShowTips(),Ae.network.changeEnd(this.mutexTabLockReasonShowTips),Ae.network.changeEnd(this.mutexTabLockReasonCloseTips)))},e}(),Jt=o(90),zt=function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},Kt=function(e,t){var o,n,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},Xt=function(){function e(){}return e.getRemark=function(e,t){return zt(this,void 0,void 0,(function(){var o;return Kt(this,(function(n){return o="["+t.join(",")+"]",[2,new Promise((function(t,n){f.a.ajax({url:"/sdc/getusermarkname",xhrFields:{withCredentials:!0},data:{bkn:Jt.a.getBkn(),domainId:e.domainId,localPadId:e.localPadId,uids:o,xsrf:Object(a.getXsrf)()},success:function(e){e&&0===e.retcode?t(e.result):n()},error:function(){n()}})}))]}))}))},e}(),$t=function(){return($t=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},Zt=function(){function e(e,t,o){var n=this;this.handleHow2Detla=t,this.clearUndoRedoStack=o,this.lastRev=-1,this.intervalRefreshTime=15e3,this.destroySubmodule=function(){n.notificationCenter.removeListener(a.RenderNotificationTypes.FIRST_RENDER,n),n.missChagedSet.destroy(),n.offline.destroy(),n.messageSender.destroy(),n.documentInfoSync.destory(),n.getMutexLock.destory()},this.doIntervalRefresh=function(){var e="/dop-api/querydata?padid="+n.clientVars.globalPadId+"&type=doc";f.a.get(e).done((function(e){e&&0===e.retcode&&(Ce.a.roomLogInfo(e&&e.refreshtime),n.intervalRefreshTime=e.refreshtime||n.intervalRefreshTime,e.isOverConNum||0==(2&n.clientVars.rightFlag)?e.atext&&e.apool&&n.refreshDoc(e):(n.intervalRefreshTime=-1,n.messageSender.channelManager.getRoomChannel().reOpenAfterShutDown(),n.notificationCenter.fire(new Re.f("60010"))))})).fail((function(){})).always((function(){n.intervalRefreshTime>0&&setTimeout(n.doIntervalRefresh,n.intervalRefreshTime)}))};var r=e.notificationCenter,i=e.csManager,s=e.clientVars,c=e.serverVars,l=e.canEdit,u=e.initialUserInfo,h=e.options,d=e.keepStatic,p=e.moduleTag;this.collabRoomOptions=e,this.notificationCenter=r,this.csManager=i,this.init(s,c,l,u,h,d,p),window.App&&(window.App.CollabRoom=this),a.GlobalContext.on(G.f.BEFORE_REPLACE_URL,this.destroySubmodule)}return e.createInstance=function(t,o,n){return this._instance&&this._instance.destroySubmodule(),this._instance=new e(t,o,n),this._instance},e.prototype.init=function(e,t,o,n,r,i,s){void 0===s&&(s="word"),this.serverVars=e.collab_client_vars,this.canEdit=o,this.sid=e.collab_client_vars.client&&e.collab_client_vars.client.sid,this.padId=e.collab_client_vars.padId,this.globalPadId=e.collab_client_vars.globalPadId,this.uuId=Object(Ue.d)(e.userId,this.sid),this.userId=e.userId,this.userSet={},this.userSiteSet={},this.userSet[this.userId]=n,this.userSiteSet[this.userId]=n,this.isPublish=e.isPublish||!1,this.intervalRefreshTime=15e3,this.taskQueue=new Gt,this.messageSender=new gt({client:this,clientVars:e,moduleTag:s}),this.offline=new Mt(this,o,this.handleHow2Detla,this.clearUndoRedoStack),this.missChagedSet=new At(this),this.documentInfoSync=new qt(this.getWorkBookInfo),this.getMutexLock=new Yt(this.notificationCenter),this.isPublish||e.globalPadId===xe.a||(this.messageSender.init(),this.offline.init(),this.missChagedSet.init(),this.documentInfoSync.init(this.getWorkBookInfo),this.csManager.setUserChangeNotificationCallback(this.wrapRecordingErrors("handleUserChanges",this.messageSender.addUserChanges)),this.notificationCenter.once(a.RenderNotificationTypes.FIRST_RENDER,this.offline.restoreOfflineData,this),this.initOverConNumIntervalRefresh()),this.doCommitCheck()},e.prototype.doCommitCheck=function(){var e=this;setTimeout((function(){e.isCollabRoomOpen()&&e.hasUncommittedChanges()&&(e.getPadRev()===e.lastRev&&(a.ReportHelper.captureException(a.MonitorName.CHANGESET_ERROR_COMMIT,{},new Error("rev:"+e.getPadRev()+",last:"+e.lastRev+",msg:"+JSON.stringify(e.csManager.getUncommitedInfo()))),Te.b.reportToWeblogWithKey("Word_Melo_COMMIT_CHECK_TIMEOUT",3e5)),e.lastRev=e.getPadRev()),e.doCommitCheck()}),3e5)},e.prototype.onReset=function(e){this.destroySubmodule();var t=e.clientVars,o=e.canEdit;return this.init(t,t.collab_client_vars,o,"","",""),!0},e.prototype.initOverConNumIntervalRefresh=function(e){void 0===e&&(e=!1),(this.clientVars.isOverConNum&&!this.clientVars.isCreator&&!this.clientVars.isOverUpdateConNum||e)&&(this.canEdit()&&this.notificationCenter.fire(new Re.d({errMsg:"可编辑人数已达上限，当前仅可查看。",errCode:"60010"})),e&&(this.intervalRefreshTime=15e3),this.intervalRefreshTime>0&&setTimeout(this.doIntervalRefresh,this.intervalRefreshTime))},e.prototype.refreshDoc=function(e){this.serverVars.initialAttributedText={text:e.atext.text,attribs:e.atext.attribs},this.serverVars.apool=e.apool,this.csManager.setTotalBaseAttributeText({text:unescape(this.serverVars.initialAttributedText.text),attribs:this.serverVars.initialAttributedText.attribs},this.serverVars.apool,!1)},Object.defineProperty(e.prototype,"clientVars",{get:function(){return Object(O.c)()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"getTaskQueue",{get:function(){return this.taskQueue},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"getWorkBookInfo",{get:function(){var e=window.location.pathname.split("/").pop();return e||""},enumerable:!0,configurable:!0}),e.prototype.getUserInfo=function(e){return this.userSet[e]},e.prototype.getUserSet=function(){return this.userSet},e.prototype.getPadRev=function(){return this.messageSender.channelManager.getPadRev()},e.prototype.setPadRev=function(e){this.messageSender.channelManager.setPadRev(e)},e.prototype.isCollabRoomOpen=function(){return this.messageSender.channelManager.isCollabRoomOpen()},e.prototype.hasUncommittedChanges=function(){return this.csManager.hasUncommittedChanges()},e.prototype.shutDownRoomChannel=function(e,t){this.messageSender.channelManager.shutDownRoomChannel({errCode:""+t,reason:e,shutDown:!0})},e.prototype.sendCaretUpdateMesage=function(e){this.messageSender.sendMessage("CURSOR_MESSAGE",e,null,null)},e.prototype.cancelMessageBySeq=function(e){this.messageSender.roomChannel.cancelMessageBySeq(e)},e.prototype.updateCommtingWaitting=function(e){this.messageSender.updateCommtingWaitting(e)},e.prototype.applyCommittingChangeset=function(e,t){this.setPadRev(e),this.csManager.applyPreparedChangesetToBase(t),this.messageSender.setStateIdle()},e.prototype.applyChangesToBase=function(e,t,o,n,r,i,a){var s=this.getPadRev();this.setPadRev(a),"BB08J2"===n&&this.csManager.applyChangesToBase(e,t,o,n,r,i,s,a)},e.prototype.applyNewChanges=function(e,t,o,n){if(void 0===t&&(t=0),void 0===o&&(o=1),void 0===n&&(n="collab"),Ce.a.roomLogDebug("receiveMsg: "+JSON.stringify(e)),!(e.newVersion<=this.getPadRev()||this.messageSender.isDuplicateMessage(e.commitId))){if(this.setPadRev(e.newVersion),a.GlobalContext.run(I.b.push,{newCs:e.changeset,rev:e.newVersion}),this.csManager.applyChangesToBase(e.changeset,e.data.author||"",e.data.apool,e.data.subId,e.data.head,e.data.revert,this.getPadRev(),e.newVersion),this.onReceivMsgFromServerCallback&&this.onReceivMsgFromServerCallback(e.changeset,e.data.author||"",e.data.apool,e.data.subId,e.data.head,e.data.revert,this.getPadRev(),e.newVersion),""!==e.data.author&&this.callCatchingErrors("onUserEdited",(function(){})),this.notificationCenter.fire(new ht),window.App.GlobalConfig.IsSupportStore){e.data.taskId=e.commitId,e.data.subId=e.sheetId,e.data.baseRev=e.newVersion,e.data.uuId=this.uuId;var r=new ve.OfflineData({uid:pt.a.get("uid"),globalPadId:this.clientVars.globalPadId,secretId:this.getWorkBookInfo,subSheetId:e.sheetId,type:ve.OFFLINE_ITEM_TYPE.NEW_CHANGE,docType:ve.FILE_TYPE.WORD,taskId:e.commitId,version:e.newVersion,data:e,createTime:Date.now(),dver:window.App.GlobalConfig.globalCodeVersion});Me.c.handleDataFromIndexDB({type:Me.a.update,tableName:ve.TableName.DOCUMENT_DATA,data:r})}this.offline.offlineStore.updateBaseVersion(e.newVersion)}},e.prototype.acceptCommit=function(e,t,o,n){this.applyCommittingChangeset(t,n),this.offline.offlineStore.updateBaseVersion(t),this.messageSender.handleOfflineAcceptCommit(t)},e.prototype.applyChangesetAfterIDs=function(e,t){var o=t.baseRev;this.applyCommittingChangeset(o,e),this.offline.offlineStore.updateBaseVersion(o),this.messageSender.handleChangesetAfterIDs(o)},e.prototype.wrapRecordingErrors=function(e,t){var o=this.messageSender;return function(){try{return t.apply(o,Array.prototype.slice.call(arguments))}catch(e){throw Ce.a.roomLogError("error "+e),e}}},e.prototype.callCatchingErrors=function(e,t){try{this.wrapRecordingErrors(e,t)()}catch(e){}},e.prototype.handleUserNewInfo=function(e){var t={};t.userId=e.userId,t.colorId=e.colorId,t.uuId=e.uuId,t.status="connected",t.userLink="";var o=t.userId,n=t.userId.split(".")[1];if(t.uin=n,this.serverVars.websocket||o!==this.userId&&n)if(this.userSet[o]&&this.userSet[o].name&&t.userPic)t.name=this.userSet[o].name,this.userSet[o]=t,this.notificationCenter.fire(new _e.e(t));else{var r=!!this.userSet[o],i=this,a=[];a.push(n),Xt.getRemark(this.clientVars,a).then((function(e){if(i.userSet[o]=t,void 0===e||!1===e)i.userSet[o]=t,Ce.a.roomLogWarn("__________**** getRemarkCallback Fail****___________");else{var a=e.rsp;if(void 0!==a){for(var s=0;s<a.length;s++)if(a[s].uid===n&&void 0!==a[s].markName){t.name=a[s].markName,t.userPic=a[s].userPic,!0===r?(i.userSet[o]=t,i.notificationCenter.fire(new _e.e(t))):(i.userSet[o]=t,i.notificationCenter.fire(new _e.f(t)));break}}else t.name=null,t.userPic=null,!0===r?(i.userSet[o]=t,i.notificationCenter.fire(new _e.e(t))):(i.userSet[o]=t,i.notificationCenter.fire(new _e.f(t)))}}))}},e.prototype.handleUserLeave=function(e){var t=e.userId;this.serverVars.websocket&&t===this.userId||(this.userSet[t]&&delete this.userSet[e.userId],this.notificationCenter.fire(new _e.g(e)))},e.prototype.handleOffline2Online=function(){!0===this.offline._hasShowOfflineFlag&&(this.offline.handleOnline(),Ce.a.roomLogWarn(" socket.onSocketStatusChanged "))},e.prototype.delLocalOfflineData=function(){try{var e=ve.QueryCondition.newInstance().addCondition("globalPadId",ve.QUERY_CONDITION_TYPE.ONLY,this.clientVars.globalPadId).addCondition("type",ve.QUERY_CONDITION_TYPE.IN,[ve.OFFLINE_ITEM_TYPE.INIT,ve.OFFLINE_ITEM_TYPE.ACCEPTED,ve.OFFLINE_ITEM_TYPE.MISS_CHANGE,ve.OFFLINE_ITEM_TYPE.NEW_CHANGE]);Me.c.handleDataFromIndexDB({type:Me.a.delete,tableName:ve.TableName.DOCUMENT_DATA,where:e})}catch(e){Ce.a.roomLogError("delLocalOfflineData error:"+this.clientVars.globalPadId)}},e.prototype.handleRightChange=function(){4&this.clientVars.rightFlag||this.sendGetPrivilegeMsg(),window.App.GlobalConfig.IsSupportStore&&this.delLocalOfflineData()},e.prototype.sendGetPrivilegeMsg=function(){var e=this;this.messageSender.sendMessage("GET_PRIVILEGE",null,null,(function(t,o,n,r){if(0===r.errCode&&r.response&&r.response.onpost&&0===r.response.onpost.result){var i=e.clientVars.privilegeAttribute,s=r.response.onpost.privilege_attribute,c=Object.keys(s).reduce((function(e,t){return i[t]!==s[t]&&e.push(t),e}),[]);c.length&&(e.clientVars.privilegeAttribute=s,window.clientVars&&(window.clientVars.privilegeAttribute=$t($t({},window.clientVars.privilegeAttribute),{newPrivilege:s})),a.GlobalContext.fire(new dt.a(s,c)))}}))},e.prototype.handleRevertMessage=function(){var e=new ot(this.getTaskQueue,{from:this.getPadRev(),to:this.getPadRev()+1,parent:this,src:Ze.REVERTMESSAGE});this.getTaskQueue.pushTask(e)},e.prototype.notifyAppCodeVersion=function(e){var t;if(e){var o=this.getWorkBookInfo;window.App.GlobalConfig.IsSupportStore&&window.mqq&&window.mqq.invoke&&window.mqq.invoke("docx","notifyOfflineCodeVersion",{ver_map:(t={},t[o]=e,t)})}},e.prototype.codeVerChangeReFresh=function(){this.shutDownRoomChannel("CodeVerChange"),this.notificationCenter.fire(new Re.d({errMsg:"文档状态有更新，请刷新重试。",errCode:"",action:[Re.a.REFRESH,Re.a.CONTACT]}))},e.prototype.handleCodeNewVer=function(e){Ce.a.roomLogError("handleCodeNewVer refresh");var t=window.App.GlobalConfig.globalCodeVersion.split("-").pop()||"";e.body.notice.dver!==t&&void 0!==t?(this.notifyAppCodeVersion(t),this.codeVerChangeReFresh()):e.body.notice.gray===window._grayVersion&&e.body.notice.code_ver===this.clientVars.collab_client_vars.pver&&e.body.notice.gray===this.clientVars.collab_client_vars.gray||this.codeVerChangeReFresh()},e.prototype.handleDeleteDoc=function(e){Ce.a.roomLogWarn("handleDeleteDoc:"+JSON.stringify(e)),window.location&&window.location.reload()},e.prototype.tdwreport=function(e){e&&a.ReportHelper.tdwReport(e)},e}(),eo=o(231),to=o(43),oo=o.n(to),no=function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},ro=function(e,t){var o,n,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},io=function(){function e(e){this.styleSheetsHTML="",this.snapshotBodyHTML="",this._editor=e,this._snapshotRange=a.GCPRange.emptyRange(),this._resaveSnapshot=!1,this._timeOut=null,this._isPublish=!!Object(m.getUrlParameter)("pub"),this._monitorNotification()}return e.prototype._monitorNotification=function(){var e=this;this._editor.once(a.RenderNotificationTypes.RENDER_FINISH,(function(){e._firstSaveSnapshot()}),this),this._editor.on(a.StateNotification.ModelChange,(function(t){var o=t.changeData.dirtyRangeMap.get(a.StoryID.MainDocId);!e._editor.isCompositing()&&o&&o.intersect(e._snapshotRange)&&(e._timeOut&&clearTimeout(e._timeOut),e._resaveSnapshot=!0)}),this),this._editor.on(a.RenderNotificationTypes.RENDER_LAYOUT_CHANGE,(function(){e._resaveSnapshot&&(e._resaveSnapshot=!1,e._asyncSaveSnapshot())}),this)},e.prototype.destroy=function(){this._editor.removeListener(a.RenderNotificationTypes.RENDER_FINISH,this),this._editor.removeListener(a.StateNotification.ModelChange,this),this._editor.removeListener(a.RenderNotificationTypes.RENDER_LAYOUT_CHANGE,this)},e.prototype._firstSaveSnapshot=function(){this._saveSnapshot(!0)},e.prototype._asyncSaveSnapshot=function(){var e=this;this._timeOut=window.setTimeout((function(){e._saveSnapshot(),e._resaveSnapshot=!1,e._timeOut=null}),3e3)},e.prototype._containerStyle=function(){return this._isPublish?"top: 52px; bottom: 0px;":"top: 100px;"},e.prototype._surfaceStyle=function(){return"padding-top: 12px; padding-left: 8px; padding-right: 8px;"},e.prototype._zoomableStyle=function(){var e,t=document.getElementById("app");if(t){var o=t.querySelector("."+oo.a.zoomable);return(null===(e=null==o?void 0:o.style)||void 0===e?void 0:e.cssText)||""}return""},e.prototype._pageViewAnimationStyle=function(){return"opacity: 0; transition: opacity 0.3s cubic-bezier(0.22, 0.61, 0.35, 1);"},e.prototype._footerHtml=function(){if(this._isPublish)return"";var e=document.getElementById("footer");return e?e.outerHTML:""},e.prototype._saveSnapshot=function(e){return void 0===e&&(e=!1),no(this,void 0,void 0,(function(){var t,o,n,r,i,a,s,c,l,u,h;return ro(this,(function(d){switch(d.label){case 0:if(t=+new Date,!(o=document.getElementById("app"))||!document.styleSheets)return[2,!1];if(!((n=o.querySelector(".melo-logic-page"))&&n instanceof HTMLDivElement))return[2,!1];if(r='\n                <div id="container" class="container-snapshot">\n                    <div id="content-container" style="'+this._containerStyle()+'">\n                        <div id="doc-editor" class="scrollable">\n                            <div class="zoomable" style="'+this._zoomableStyle()+'">\n                                <div class="surface" style="'+this._surfaceStyle()+' transform: scale(1);">\n                                    <div id="snap-shot-page-view" class="melo-page-view" style="background: rgb(248, 248, 248); margin-bottom: 25px;'+this._pageViewAnimationStyle()+'">',i=this.genContentBodyHTML(n),"</div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>",this.snapshotBodyHTML=r+i+"</div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>",this.styleSheetsHTML.length<=0)for(a="",s=0;s<document.styleSheets.length;s++){a+='<style type="text/css">';try{if((c=document.styleSheets[s])instanceof CSSStyleSheet)for(l=0;l<c.cssRules.length;l++)u=c.cssRules[l],a+=u.cssText}catch(e){m.Logger.warn("saveSnapshot styleSheetsHTML error: "+e)}a+="</style>",this.styleSheetsHTML=a}return[4,eo.b.getInstance().save({body:this.snapshotBodyHTML,style:this.styleSheetsHTML,time:+new Date},e)];case 1:return d.sent(),h=+new Date,m.Logger.info("snapshot save cost time: "+(h-t)),[2,!0]}}))}))},e.prototype.genContentBodyHTML=function(e){var t="",o=window.screen.availHeight;if(e.offsetHeight>2*o){t+='<div class="'+e.className+'" style="'+e.style.cssText+'">';for(var n=null,r=e.childNodes,i=0;i<r.length;i++){var s=r[i];if(s instanceof Element){if("melo-container-page"===s.className&&s.clientHeight>o){n=s;break}t+=s.outerHTML}}if(n&&n instanceof HTMLDivElement){t+='<div class="'+n.className+'" style="'+n.style.cssText+'">';var c=n.firstChild;if(c&&c instanceof HTMLDivElement){t+='<div class="'+c.className+'" style="'+c.style.cssText+'">';var l=c.firstChild;if(l&&l instanceof HTMLDivElement){t+='<div class="'+l.className+'" style="'+l.style.cssText+'">';var u=0,h=l.childNodes;for(i=0;i<h.length;i++){var d=h[i];if(d instanceof Element){if(t+=d.outerHTML,(u+=d.clientHeight)>o)break;if(d.__vm__){var p=d.__vm__,f=this._editor.getRangeFromIndex(p.firstIndex,p.lastIndex);this._snapshotRange=new a.GCPRange(0,f.end())}}}t+="</div>"}t+="</div>"}t+="</div>"}t+="</div>"}else if(t+=e.outerHTML,e.__vm__){p=e.__vm__;this._snapshotRange=this._editor.getRangeFromIndex(p.firstIndex,p.lastIndex)}return t},e}(),ao=o(30),so=o.n(ao),co=o(62),lo=o(249),uo=o(8);!function(e){e[e.success=0]="success",e[e.versionNotCompatible=-1]="versionNotCompatible",e[e.throwException=-2]="throwException"}(Qt||(Qt={}));var ho=function(){function e(){this.isContainerReady=!1,a.GlobalContext.on(G.f.SWITCH_TO_BACKGROUND,(function(){}))}return e.getInstance=function(){return this.instance||(this.instance=new e,window.documentManager=this.instance),this.instance},e.prototype.onReady=function(e){m.Logger.info("DocumentManager","onReady dver:"+e),this.isContainerReady=!0,window.mqq&&window.mqq.invoke("docx","onContainerReady",{dver:e}),a.GlobalContext.fire(new G.e)},e.prototype.showhideEditorMask=function(e){m.Logger.info("DocumentManager","showhideEditorMask: "+(window.location.href!==e),(new Date).toString());var t=document.getElementById("editor-mask");if(t){t.style.visibility=window.location.href!==e?"visible":"hidden";t.offsetHeight}(window.requestAnimationFrame||window.webkitRequestAnimationFrame)((function(){window.jsApi&&window.jsApi.invokeNative&&window.jsApi.invokeNative("docx","firstLoadFinished",{},(function(){m.Logger.info("DocumentManager","firstLoadFinished",(new Date).toString())}))}))},e.prototype.onPrerenderFinish=function(e,t){m.Logger.info("DocumentManager","onPrerenderFinish return",e,t),window.mqq.invoke("docx","sendToParent",{func:"window&&window.preloadManager&&window.preloadManager.onPrerenderFinish",args:[e,"0.0.0",t]})},e.prototype.replaceUrl=function(e,t,o,n){var i=this;m.Logger.info("DocumentManager","replaceUrl targetUrl:"+e+" dataVersion:"+t);var s=co.a.getInstance().recordAndStripPerformanceValueFromUrl(e);try{this.showhideEditorMask(s),eo.b.getInstance().hide(!1);var c=Object(re.a)(),l=he.a.getInstance(c).getClientVars().collab_client_vars.dver;if(window.location.href===s)return this.isContainerReady&&this.onReady(l),eo.a.getUrlParameter("prerender")&&this.onPrerenderFinish(s,"equalUrl"),co.a.getInstance().clearReplaceUrlPerformanceMetrics(),Qt.success;if(this.isContainerReady=!1,t&&!Object(re.c)(l,t))return m.Logger.info("DocumentManager","isCompatibleDataVersion false, currentDataVersion:"+l+" dataVersion:"+t),eo.a.getUrlParameter("prerender")?this.onPrerenderFinish(s,"notCompatibleDataVersion"):window.location.replace(s),Qt.versionNotCompatible;if(!t&&eo.a.getUrlParameter("prerender"))return this.onPrerenderFinish(s,"notPrerender"),Qt.versionNotCompatible;he.a.replaceCount=he.a.replaceCount+1;var u=Object(re.b)(s);a.GlobalContext.fire(new G.b(u),!1),document.dispatchEvent(new CustomEvent("BeforeReplaceUrlNotification",{detail:{newSecretId:u}}));var h=m.PerfUtil.now();return he.a.getInstance(u).replaceUrlTime=h,window.history.replaceState(null,"",s),Object(De.c)(),window.WebLog&&window.WebLog.reset&&window.WebLog.reset(),Promise.resolve().then((function(){m.Logger.info("DocumentManager","promise resolved"),a.GlobalContext.fire(new G.d(u)),eo.b.getInstance().onReset(u,s,o,n),window.clientVarsOnline=void 0,window.ClientVarsPromise=new lo.a(u,uo.b.Doc).getClientVarsPromise(),window.ClientVarsPromise.then((function(e){var t=e.collab_client_vars.dver;Object(re.c)(l,t)?(a.GlobalContext.fire(new G.c(u,e)),u!==c&&he.a.getInstance(c).onDestroy(),a.GlobalContext.fire(new G.a(u)),Object(r.resetDefaultTdwData)()):(m.Logger.info("DocumentManager","afterGetData isCompatibleDataVersion false, currentDataVersion:"+l+" dataVersion:"+t),eo.a.getUrlParameter("prerender")?i.onPrerenderFinish(s,"afterGetData notCompatibleDataVersion"):window.location.replace(s))}))})),Qt.success}catch(e){return m.Logger.error("replaceUrl "+e),eo.a.getUrlParameter("prerender")?this.onPrerenderFinish(s,"replaceUrlError"):window.location.replace(s),Qt.throwException}},e}(),po=o(244),fo=function(){return(fo=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function mo(e){!function(e){if(a.Defaults.author=e.userId,a.Defaults.curDocDataVersion=e.collab_client_vars.ver,5===a.Defaults.curDocDataVersion?(a.Defaults.fontSize=210,a.Defaults.font.fontSize=210):(a.Defaults.fontSize=240,a.Defaults.font.fontSize=240),a.Defaults.curDocDataVersion<=6&&(a.Defaults.section.pageMargins.top=1200,a.Defaults.section.pageMargins.bottom=1200,a.Defaults.section.pageMargins.left=810,a.Defaults.section.pageMargins.right=900),a.Defaults.curDocDataVersion<=6&&(a.Defaults.paragraph.lineSpacing=1),window.mqq&&window.mqq.invoke&&window.mqq.invoke("docx","getNativeScreenSize",{},(function(e){e&&e.data&&(a.Defaults.nativeScreenSize={width:e.data.width,height:e.data.width})})),a.Defaults.curDocDataVersion>=a.Defaults.newDefaultStyleVersion){var t={borderWidth:15,borderStyle:a.BorderStyleType.solid,borderColor:"#999999"},o=fo(fo({},a.Defaults.tableCell),{borderTop:t,borderRight:t,borderBottom:t,borderLeft:t}),n=fo(fo({},a.Defaults.tableCellStyle),{borderTop:t,borderRight:t,borderBottom:t,borderLeft:t});a.Defaults.defaultBorder=t,a.Defaults.tableCell=o,a.Defaults.tableCellStyle=n,a.Defaults.fontSize=220,a.Defaults.font.fontSize=220,a.Defaults.font.textColor="#333333",a.Defaults.paragraph.spaceBefore=60,a.Defaults.paragraph.spaceAfter=60;var r=a.Defaults.section.pageMargins.top,i=a.Defaults.section.pageMargins.header,s=a.Defaults.section.pageMargins.footer,c=Object(m.ptToTwips)(2.4*m.PtPerCM),l=Object(m.ptToTwips)(2.5*m.PtPerCM),u={top:c,right:l,bottom:c,left:l,header:i-(r-c),footer:s-(r-c),gutter:0};a.Defaults.section.pageMargins=u}}(e),Object(po.a)()}var go,bo,yo,vo=function(){function e(e){this._hideFirstScreen=!1,this.markTime=[],this.secretId=e.secretId,this.container=e.container,this.workbench=e.workbench,this.init()}return e.createInstance=function(t){return this.instance?this.instance.onReset(t):this.instance=new e(t),this.instance},e.prototype.handleEditorFirstRender=function(){var e=document.createEvent("CustomEvent");if(e.initCustomEvent("first_render_clearwhitescreen",!0,!0,{}),document.dispatchEvent(e),this.hideFirstScreen(),this.showNoSupportBrowserTips(),ae.a.isMiniProgram()){var t=document.getElementById("header");t instanceof HTMLElement&&(t.style.display="block")}ho.getInstance().onReady(this.clientVars.collab_client_vars.dver),this.fpsMonitor.startInitMonitor()},e.prototype.handleEditorRenderFinished=function(){var e=this.clientVars.collab_client_vars;if(m.Logger.info("padeditor render finish"),new de(this.meloEditor).init(),this.workbench.context.isPublish)a.ReportHelper.monitor(a.MonitorName.PV_PUBLISH),a.ReportHelper.tdwReport({opername:"doc_word_file",module:"to_web",action:"web_visit"});else{a.ReportHelper.monitorWtihPlatform(a.MonitorName.PV);var t=m.LocalStorageUtil.getItem("tdsourcetag");a.ReportHelper.tdwReportSingle({opername:"doc_core",module:"visit",action:"detail_page",source3:t||"",obj3:m.PlatformUtil.getBrowser(),ver5:1===this.clientVars.collab_client_vars.dirty?"limited":"normal",ver7:"melo",ver10:this.permissionCtrl.isPreview?"qqpreview":""})}void 0!==e.meloUpCost&&(a.ReportHelper.monitor(a.MonitorName.HOT_UPGRADE),1===e.rev&&1===e.ignoreLineRev||a.ReportHelper.monitor(a.MonitorName.HOT_UPGRADE_STOCK)),"2.1.0"===e.dver&&a.ReportHelper.monitor(a.MonitorName.TABLE_MERGE),this.workbench.context.appid&&(a.ReportHelper.monitor(a.MonitorName.PV_TOB),a.ReportHelper.tdwReport({opername:"doc_core",module:"visit",action:"detail_page_tob",obj3:m.PlatformUtil.getBrowser(),ver5:1===this.clientVars.collab_client_vars.dirty?"limited":"normal",ver8:this.workbench.context.appid})),this.hideFirstScreen(),window.loadLazyScriptStartHandler&&window.loadLazyScriptStartHandler(),this.fpsMonitor.end(),this.fpsMonitor.startScrollMonitor()},e.prototype.init=function(){var e=this;this.clientVars=he.a.getInstance(this.secretId).getClientVars(),this.permissionCtrl=se.a.createInstance(this.clientVars),this.workbench.inject("permission",this.permissionCtrl),mo(this.clientVars);a.LayoutType.Scroll;var t={layoutType:"2"===this.clientVars.pagingFlag?a.LayoutType.Paged:a.LayoutType.Scroll,editable:this.permissionCtrl.isEditable,copyable:this.permissionCtrl.isCopyable,uniqueId:this.clientVars.globalPadId};a.ReportHelper.tdwReport({opername:"doc_word_editor",module:"page",action:t.layoutType===a.LayoutType.Paged?"pageview_page":"pageview_web"}),this.editor=new a.MeloEditor(t),this.workbench.emit("$beforeMeloAttach",this.editor);var o=this.clientVars.collab_client_vars;this.fpsMonitor=new fe(this.editor),this.editor.once(a.RenderNotificationTypes.FIRST_RENDER,this.handleEditorFirstRender.bind(this)),this.editor.once(a.RenderNotificationTypes.RENDER_FINISH,this.handleEditorRenderFinished.bind(this)),this.markTime.push(+new Date),new I.c((function(){return{globalPadId:e.clientVars.globalPadId,userDomain:e.clientVars.userDomain}}),(function(){return e.clientVars.collab_client_vars.dirty})).registerPlugin(a.GlobalContext),this.apool=new ie.AttribPool,this.collab=new I.d(this.editor,this.apool,o.ignoreLineRev);var n=new be(this.collab,this.apool,a.DOC_ID);this.collab.setChangesetManager(n);this.collabClient=Zt.createInstance({notificationCenter:this.editor,csManager:n,clientVars:this.clientVars,serverVars:o,canEdit:function(){return e.permissionCtrl.canEdit},initialUserInfo:"",options:"",keepStatic:"",moduleTag:"word"},(function(){m.Logger.warn("handleHow2Detal. "),e.editor.service.getSelection().wholeStory(),e.editor.clipboardManager.copy()}),(function(){e.editor.run("clearUndoRedoStack")})),this.workbench.inject("collabClient",this.collabClient);var r=function(){return e.collabClient.getPadRev()};n.initPadRev(r),this.collab.initPadRev(r),n.setTotalBaseAttributeText({text:unescape(o.initialAttributedText.text),attribs:o.initialAttributedText.attribs},o.apool,!0),this.editor.attachEditor(this.container),this.markTime.push(+new Date),this.clientVars.isPublish||(this._snapshot&&this._snapshot.destroy(),this._snapshot=new io(this.editor)),this.workbench.listen("$editableChanged",(function(t){e.editor.setEditable(t)})),this.workbench.listen("$copyableChanged",(function(t){e.editor.setCopyable(t)}))},e.prototype.onReset=function(e){return this.secretId=e.secretId,this.container=e.container,this.workbench=e.workbench,this._hideFirstScreen=!1,this.fpsMonitor.reset(),this.markTime=[],this.init(),!0},e.prototype.load=function(){this.workbench.inject("permission",this.permissionCtrl),this.workbench.inject("collabClient",this.collabClient)},e.prototype.showNoSupportBrowserTips=function(){if(m.PlatformUtil.isIE11())so.a.show({message:"为了有更好的体验，推荐使用最新版Chrome浏览器。",duration:5e3,autoClose:!0});else if(m.PlatformUtil.isChrome()){m.PlatformUtil.getChromeVersion()<53&&so.a.show({message:"为了有更好的体验，推荐使用最新版Chrome浏览器。",duration:5e3,autoClose:!0})}},e.prototype.hideFirstScreen=function(){he.a.getInstance(this.secretId).docRendered=!0,this._hideFirstScreen||(this._hideFirstScreen=!0,window.jsApi&&window.jsApi.invokeNative&&window.jsApi.invokeNative("docx","firstLoadFinished",{},(function(){m.Logger.info("PadEditor","firstLoadFinished",(new Date).toString())})),window.fisrtScreenLoading&&window.fisrtScreenLoading.hide(),m.Logger.info("PadEditor","hideFirstScreen"),setTimeout((function(){eo.b.getInstance().hide()}),500))},Object.defineProperty(e.prototype,"meloEditor",{get:function(){return this.editor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"atextCost",{get:function(){return this.markTime.length>=2?this.markTime[1]-this.markTime[0]:0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"workbenchCost",{get:function(){return this.markTime.length>=3?this.markTime[2]-this.markTime[1]:0},enumerable:!0,configurable:!0}),e}(),Co=function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},_o=function(e,t){var o,n,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};!function(e){e[e.MeloExt=0]="MeloExt",e[e.PublishPc=1]="PublishPc",e[e.PublishMobile=2]="PublishMobile",e[e.PublishPad=3]="PublishPad",e[e.Level2FeaturesPc=4]="Level2FeaturesPc",e[e.Level2FeaturesMobile=5]="Level2FeaturesMobile",e[e.Level2FeaturesPad=6]="Level2FeaturesPad",e[e.Level3FeaturesPc=7]="Level3FeaturesPc",e[e.Level3FeaturesMobile=8]="Level3FeaturesMobile",e[e.Level3FeaturesPad=9]="Level3FeaturesPad"}(bo||(bo={})),function(e){e[e.Mobile=0]="Mobile",e[e.Pc=1]="Pc",e[e.Pad=2]="Pad"}(yo||(yo={}));var wo=((go={})[bo.MeloExt]=function(){return o.e(4).then(o.bind(null,261))},go[bo.PublishPc]=function(){return Promise.all([o.e(2),o.e(5),o.e(0),o.e(10),o.e(24)]).then(o.bind(null,496))},go[bo.Level2FeaturesPc]=function(){return Promise.all([o.e(4),o.e(2),o.e(11),o.e(5),o.e(26),o.e(0),o.e(3)]).then(o.bind(null,484))},go[bo.Level3FeaturesPc]=function(){return Promise.all([o.e(4),o.e(2),o.e(1),o.e(11),o.e(5),o.e(0),o.e(3),o.e(10),o.e(8)]).then(o.bind(null,485))},go),So=function(){function e(){}return e.loadMeloExt=function(t){return Co(this,void 0,void 0,(function(){return _o(this,(function(o){switch(o.label){case 0:return[4,e.get(bo.MeloExt)];case 1:return o.sent().EditorLoader.load(t),[2]}}))}))},e.loadPublish=function(t,o){return Co(this,void 0,void 0,(function(){return _o(this,(function(n){switch(n.label){case 0:return t!==yo.Mobile?[3,2]:[4,e.get(bo.PublishMobile)];case 1:return n.sent().PublishLoader.load(o),[2];case 2:return t!==yo.Pad?[3,4]:[4,e.get(bo.PublishPad)];case 3:return n.sent().PublishLoader.load(o),[2];case 4:return[4,e.get(bo.PublishPc)];case 5:return n.sent().PublishLoader.load(o),[2]}}))}))},e.loadLevel2=function(t,o){return Co(this,void 0,void 0,(function(){return _o(this,(function(n){switch(n.label){case 0:return t!==yo.Mobile?[3,2]:[4,e.get(bo.Level2FeaturesMobile)];case 1:return n.sent().SecondaryLoader.load(o),[2];case 2:return t!==yo.Pad?[3,4]:[4,e.get(bo.Level2FeaturesPad)];case 3:return n.sent().SecondaryLoader.load(o),[2];case 4:return[4,e.get(bo.Level2FeaturesPc)];case 5:return n.sent().SecondaryLoader.load(o),[2]}}))}))},e.loadLevel3=function(t,o){return Co(this,void 0,void 0,(function(){return _o(this,(function(n){switch(n.label){case 0:return t!==yo.Mobile?[3,2]:[4,e.get(bo.Level3FeaturesMobile)];case 1:return n.sent().TertiaryLoader.load(o),[2];case 2:return t!==yo.Pad?[3,4]:[4,e.get(bo.Level3FeaturesPad)];case 3:return n.sent().TertiaryLoader.load(o),[2];case 4:return[4,e.get(bo.Level3FeaturesPc)];case 5:return n.sent().TertiaryLoader.load(o),[2]}}))}))},e.get=function(e){return new Promise((function(t,o){var n=wo[e];n?n().then(t,(function(e){g.a.fatal(e)})):o("Startup Module not found")}))},e}(),Eo=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),To=function(e){function t(){return e.call(this,"feature_loaded")||this}return Eo(t,e),t}(m.Notification),Ro=function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a},Io=function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},Oo=function(e,t){var o,n,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},Po=function(){function e(){this.isMeloExtLoaded=!1,this.isPublishLoaded=!1,this.isLevel1Loaded=!1,this.isLevel2Loaded=!1,this.isLevel3Loaded=!1,this.isAllLoaded=!1,this.isMeloExtDownloaded=!1,this.isPublishDownloaded=!1,this.isLevel2Downloaded=!1,this.isLevel3Downloaded=!1,this.isAllDownloaded=!1,this.platform=yo.Pc}return e.prototype.init=function(e,t,o,n){return Io(this,void 0,void 0,(function(){var r,i=this;return Oo(this,(function(s){switch(s.label){case 0:return this.platform=e,this.isMeloExtLoaded?[3,2]:[4,So.loadMeloExt(t)];case 1:s.sent(),this.isMeloExtLoaded=!0,this.isMeloExtDownloaded=!0,s.label=2;case 2:return o.context.isPublish?[4,So.loadPublish(e,o)]:[3,4];case 3:return s.sent(),this.isPublishLoaded=!0,this.isPublishDownloaded=!0,m.PerfUtil.mark("featuresPublishInitEnd"),[3,6];case 4:return[4,So.loadLevel2(e,o)];case 5:s.sent(),this.isLevel2Loaded=!0,this.isLevel2Downloaded=!0,m.PerfUtil.mark("featuresReadonlyInitEnd"),s.label=6;case 6:return t.view.forceRerender(),n(),(r=Object(O.c)()).privilegeAttribute&&r.privilegeAttribute.can_edit?[4,So.loadLevel3(e,o)]:[3,8];case 7:return s.sent(),this.isLevel3Loaded=!0,this.isLevel3Downloaded=!0,o.emit("$featureEditLoaded"),m.PerfUtil.mark("featuresEditInitEnd"),[3,9];case 8:a.GlobalContext.on(se.b.ON_PERMISSION_CHANGE,(function(t){return Io(i,void 0,void 0,(function(){return Oo(this,(function(n){switch(n.label){case 0:return t.permissionCtrl.canEdit?[4,So.loadLevel3(e,o)]:[3,2];case 1:n.sent(),this.isLevel3Loaded=!0,this.isLevel3Downloaded=!0,o.emit("$featureEditLoaded"),n.label=2;case 2:return[2]}}))}))}),this),s.label=9;case 9:return this.isAllLoaded=!0,a.GlobalContext.fire(new To),o.emit("$featureLoaded"),o.inject("isFeatureLoaded",!0),m.PerfUtil.mark("featuresInitEnd"),[2]}}))}))},e.prototype.destory=function(){this.isMeloExtLoaded=!1,this.isPublishLoaded=!1,this.isLevel1Loaded=!1,this.isLevel2Loaded=!1,this.isLevel3Loaded=!1,this.isAllLoaded=!1},e=Ro([Object(g.w)({singleton:!0})],e)}(),ko=function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a},No=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Mo=function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},Do=function(e,t){var o,n,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},xo=function(){function e(e){this.workbench=e}return e.prototype.attachEditor=function(e,t,o){return Mo(this,void 0,void 0,(function(){var o;return Do(this,(function(n){switch(n.label){case 0:return(o=vo.createInstance({secretId:Object(re.a)(),container:e,workbench:this.workbench})).editor.on(a.RenderNotificationTypes.SELECTION_END,(function(){return t.onSelectionChange()}),this),o.editor.on(a.StateNotification.EfficientModelChange,t.onDataChange,this),o.editor.on(a.FocusBlurNotificationType.ON_FOCUS,t.onFocus,this),o.editor.on(a.FocusBlurNotificationType.ON_BLUR,t.onBlur,this),this.startupService.isMeloExtDownloaded?[4,So.loadMeloExt(o.editor)]:[3,2];case 1:n.sent(),this.startupService.isMeloExtLoaded=!0,n.label=2;case 2:return window.pad=o,[2,o.editor]}}))}))},e.prototype.requestBlur=function(e){e.fire(new a.FocusBlurNotification(a.FocusBlurNotificationType.REQUEST_BLUR),!1)},e.prototype.requestFocus=function(e){e.fire(new a.FocusBlurNotification(a.FocusBlurNotificationType.ON_FOCUS),!1)},e.prototype.setValue=function(){},e.prototype.isCaret=function(e){return e.isCaret()},e.prototype.destroy=function(e){e.detach()},ko([Object(g.l)(),No("design:type",Po)],e.prototype,"startupService",void 0),e=ko([Object(g.b)("melo"),No("design:paramtypes",[g.B])],e)}(),Ao=(o(215),o(254)),Lo=o(253),Fo=o(140),Bo=o(237),Uo=o(250),jo=o(251),Go=o(256),Ho=o(248),Vo=o(252),Wo=function(){function e(){}return e.load=function(t){e.isLoaded||(e.isLoaded=!0,t.mount([Ao.a,Lo.a,Fo.a,Bo.a,Uo.a,jo.a,Go.a,Ho.a,Vo.a]))},e.isLoaded=!1,e}(),Qo=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),qo=function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a},Yo=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Jo=function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))},zo=function(e,t){var o,n,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},Ko=function(e){function t(t){var o=e.call(this,t)||this;return o.workbench=new g.C({menuSchema:W,toolbarSchema:q,statusbarSchema:Q,contextMenuSchema:V,toolbarAlignment:"center",disableStatusbar:!0}),m.PerfUtil.mark("workbenchInitBegin"),function(){var e=new D;if(e.initSentryErrorReport(),a.ReportHelper.errorHandler=e,!n.a.isDevEvn()){var t=new R;t.initMonitorErrorReport(),a.ReportHelper.monitorHandler=t;var o=new i;a.ReportHelper.tdwHandler=o}var r=new A.a({appkey:"JS0KLT3N3UFD0A",versionCode:"2.1.0",channelID:"Word"});window.beaconHandler=r,a.ReportHelper.beaconHandler=r}(),o.workbench.inject("clientVars",(function(){return Object(O.c)()})),o.workbench.inject("appid",""),o.workbench.mount([xo]),o.initConfig(),o.workbench.context.store.register("rootEditor",""),g.a.level="ERROR",a.GlobalContext.on(G.f.ON_DATA_READY,(function(){o.startupService.destory(),g.m.emitOn("$beforeDestroy",(function(e){return 1===e.scope})),g.m.emit("$onReset"),o.id&&o.workbench.close(o.id),o.syncConfig(),g.m.emitOn("$onInit",(function(e){return 1===e.scope})),o.init(),o.workbench.reset()})),a.GlobalContext.on(G.f.ON_GET_DATA_START,(function(){o.showPreloadHeader()})),o}return Qo(t,e),t.prototype.init=function(){var e=this;Wo.load(this.workbench),this.startupService.isLevel1Loaded=!1,m.PerfUtil.mark("featuresRenderInitEnd"),window.ClientVarsPromise&&window.ClientVarsPromise.then((function(t){return Jo(e,void 0,void 0,(function(){var e,t,o,n=this;return zo(this,(function(r){switch(r.label){case 0:return[4,this.workbench.open(xo,{content:""})];case 1:return e=r.sent(),t=e.editor,o=e.id,this.id=o,this.workbench.context.store.update("rootEditor",o),m.PerfUtil.mark("padEditorInitEnd"),this.startupService.init(yo.Pc,t,this.workbench,this.hidePreloadHeaderDelay.bind(this)),t.on(a.RenderNotificationTypes.SELECTION_END,(function(){t.selection.tableCellRangeAll?n.toolbarService.setSchema(Y):n.toolbarService.setSchema(q)})),[2]}}))}))}))},t.prototype.showPreloadHeader=function(){this.hidePreloadHeaderId&&(window.clearTimeout(this.hidePreloadHeaderId),this.hidePreloadHeaderId=void 0);var e=document.getElementById("pc-preload-header");e&&(e.style.opacity="1",e.style.display="block")},t.prototype.hidePreloadHeaderDelay=function(){var e=this;this.workbench.listenOnce("$toolbarUpdated",(function(){e.isPublish||e.workbench.configure({disableStatusbar:!1}),e.hidePreloadHeader()}))},t.prototype.hidePreloadHeader=function(){this.hidePreloadHeaderId&&(window.clearTimeout(this.hidePreloadHeaderId),this.hidePreloadHeaderId=void 0);var e=document.getElementById("pc-preload-header");e&&(e.style.opacity="0",this.hidePreloadHeaderId=window.setTimeout((function(){e.style.display="none"}),300))},t.prototype.componentDidMount=function(){this.workbench.attach(document.getElementById("workbench")),m.PerfUtil.mark("workbenchInitEnd"),this.init()},t.prototype.render=function(){return B.a.createElement("div",{style:{height:"100%",display:"flex",flexDirection:"column"}},!!this.configService.get("common.titlebar")&&B.a.createElement(H.a,null),B.a.createElement("div",{id:"workbench",style:{flex:"1 1 100%"}}))},qo([Object(g.l)(),Yo("design:type",g.z)],t.prototype,"toolbarService",void 0),qo([Object(g.l)(),Yo("design:type",Po)],t.prototype,"startupService",void 0),t}(ne);j.a.render(B.a.createElement(Ko,null),document.getElementById("app"))},,,function(e,t,o){"use strict";o.d(t,"c",(function(){return r})),o.d(t,"b",(function(){return s})),o.d(t,"a",(function(){return c}));var n,r,i=o(2),a=(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)});!function(e){e.ServerMessage="ServerMessage",e.PrivilegeChanged="PrivilegeChanged"}(r||(r={}));var s=function(e){function t(t){var o=e.call(this,r.ServerMessage)||this;return o.msg=t,o}return a(t,e),t}(i.Notification),c=function(e){function t(t,o){var n=e.call(this,r.PrivilegeChanged)||this;return n.privilege=t,n.diff=o,n}return a(t,e),t}(i.Notification)},function(e,t,o){"use strict";o.d(t,"b",(function(){return a})),o.d(t,"a",(function(){return s}));var n,r=o(1),i=(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.root=null,t.setRootRef=function(e){return t.root=e},t}return i(t,e),t.prototype.componentDidMount=function(){this.attachBox()},t.prototype.componentDidUpdate=function(){this.attachBox()},t.prototype.attachBox=function(){if(this.root){var e=this.props.layoutBox;this.root.__vm__=e,this.root.__type__=e.constructor.name,e.__node__=this.root}},t}(o.n(r).a.Component),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(a)},,function(e,t,o){"use strict";o.d(t,"b",(function(){return f})),o.d(t,"a",(function(){return m}));var n,r=o(0),i=o(104),a=function(){function e(){this.clients=new Map,this.stickyActions=new Map}return e.prototype.addClient=function(e,t){if(!this.clients.has(e)){this.clients.set(e,t);var o=this.stickyActions.get(e);o&&o.forEach((function(e){return t.onAction(e)}))}},e.prototype.get=function(e){var t=this.clients.get(e);return null==t?void 0:t.get()},e.prototype.sendAction=function(e,t,o,n){void 0===o&&(o=!0),void 0===n&&(n=!1);var r=this.clients.get(e);if(r)r.onAction(t);else if(o){var i=this.stickyActions.get(e);if(i){if(!n){var a=i.findIndex((function(e){return e.type===t.type}));a>=0&&i.splice(a,1)}}else i=[];i.push(t),this.stickyActions.set(e,i)}},e}(),s=o(161),c=o(149),l=o(148),u=o(146),h=o(107),d=(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),p=function(){function e(e){this.bridgeKey=e,e&&(this.bridge=new a)}return e.prototype.$onInit=function(e){var t,o=this;this.initContainerRender(e),this.initDecoratorRender(e),this.bridgeKey&&e.registerPlugin(((t={})[this.bridgeKey]=function(e,t,n,r){o.bridge.addClient(n,r)},t))},e}(),f=function(e){function t(){return e.call(this,i.a)||this}return d(t,e),t.prototype.initContainerRender=function(e){e.addContainerRender(r.ContainerType.Drawing,r.DrawingType.Image,Object(s.a)()),e.addContainerRender(r.ContainerType.Drawing,r.DrawingType.Splitline,Object(u.a)({instance:this.bridge,key:2}))},t.prototype.initDecoratorRender=function(e){e.addDecorator(r.DecoratorTypes.LinePaddingLeft,Object(l.a)({instance:this.bridge,key:1})),e.addStyleDecorator(r.BoxKind.Paragraph,c.a)},t}(p),m=function(e){function t(){return e.call(this,i.b)||this}return d(t,e),t.prototype.initContainerRender=function(e){},t.prototype.initDecoratorRender=function(e){var t=Object(h.b)();e.addDecorator(r.DecoratorTypes.Textframe,Object(h.a)(e,t,{instance:this.bridge,key:3})),e.addStyleProperties(t.getAllThemeStyleProperties())},t}(p)},,,,function(e,t){e.exports=Unitool},,,,,,,,,function(e,t,o){"use strict";o.d(t,"b",(function(){return r})),o.d(t,"f",(function(){return s})),o.d(t,"g",(function(){return c})),o.d(t,"e",(function(){return l})),o.d(t,"d",(function(){return u})),o.d(t,"a",(function(){return h})),o.d(t,"c",(function(){return d})),o.d(t,"h",(function(){return p}));var n,r,i=o(2),a=(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)});!function(e){e.ON_USER_JOIN="onUserJoin",e.ON_USER_LEAVE="onUserLeave",e.ON_USER_INFO_UPDATE="onUserInfoUpdate",e.ON_USER_CARET_UPDATE="onUserCaretUpdate",e.ON_MARK_MESSAGE="onMarkMessage",e.ON_TITLE_CHANGE="onTitleChange",e.ON_LIVE_MESSAGE="onLiveMessage"}(r||(r={}));var s=function(e){function t(t){var o=e.call(this,r.ON_USER_JOIN)||this;return o.userInfo=t,o}return a(t,e),t}(i.Notification),c=function(e){function t(t){var o=e.call(this,r.ON_USER_LEAVE)||this;return o.userInfo=t,o}return a(t,e),t}(i.Notification),l=function(e){function t(t){var o=e.call(this,r.ON_USER_INFO_UPDATE)||this;return o.userInfo=t,o}return a(t,e),t}(i.Notification),u=function(e){function t(t,o,n){var i=e.call(this,r.ON_USER_CARET_UPDATE)||this;return i.userId=t,i.gcp=o,i.isFocus=n,i}return a(t,e),t}(i.Notification),h=function(e){function t(t){var o=e.call(this,r.ON_MARK_MESSAGE)||this;return o.msg=t,o}return a(t,e),t}(i.Notification),d=function(e){function t(t,o){var n=e.call(this,r.ON_TITLE_CHANGE)||this;return n.newTitle=t,n.clientCookie=o,n}return a(t,e),t}(i.Notification),p=function(e){function t(t){var o=e.call(this,r.ON_LIVE_MESSAGE)||this;return o.data=t,o}return a(t,e),t}(i.Notification)},function(e,t,o){"use strict";o.d(t,"c",(function(){return r})),o.d(t,"b",(function(){return s})),o.d(t,"a",(function(){return c})),o.d(t,"d",(function(){return l}));var n,r,i=o(2),a=(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)});!function(e){e.ONENTEROFFLINEFlAG="onEnterOfflineFlag",e.ON_ENTER_OFFLINE_EDIT="onEnterOfflineEdit",e.ON_RESTORE_OFFLINE_DATA="onRestoreOfflineData",e.ON_RESTORE_OFFLINE_DATA_FINISH="onRestoreOfflineDataFinish",e.ON_WEBSOCKET_RECONNECTED_ONLINE="onWebsocketReconnectedOnline",e.ON_START_BLOCK_USER_EDIT="onStartBlockUserEdit",e.ON_END_BLOCK_USER_EDIT="onEndBlockUserEdit"}(r||(r={}));var s=function(e){function t(t){var o=e.call(this,r.ONENTEROFFLINEFlAG)||this;return o.hasUncommittedChanges=t,o}return a(t,e),t}(i.Notification),c=function(e){function t(t){var o=e.call(this,r.ON_ENTER_OFFLINE_EDIT)||this;return o.hasUncommittedChanges=t,o}return a(t,e),t}(i.Notification),l=(function(e){function t(){return e.call(this,r.ON_RESTORE_OFFLINE_DATA)||this}a(t,e)}(i.Notification),function(e){function t(){return e.call(this,r.ON_RESTORE_OFFLINE_DATA_FINISH)||this}a(t,e)}(i.Notification),function(e){function t(t){var o=e.call(this,r.ON_WEBSOCKET_RECONNECTED_ONLINE)||this;return o.hasUncommittedChanges=t,o}return a(t,e),t}(i.Notification));(function(e){function t(t){var o=e.call(this,r.ON_START_BLOCK_USER_EDIT)||this;return o.target=t,o}a(t,e)})(i.Notification),function(e){function t(t){var o=e.call(this,r.ON_END_BLOCK_USER_EDIT)||this;return o.target=t,o}a(t,e)}(i.Notification)}],[[226,7,6,9,18,16,14,13,17,15]]]);
//# sourceMappingURL=doc-pc.js.map