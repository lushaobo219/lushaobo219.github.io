(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{257:function(e,t,n){"use strict";n.d(t,"c",(function(){return o})),n.d(t,"i",(function(){return r})),n.d(t,"b",(function(){return i})),n.d(t,"d",(function(){return l})),n.d(t,"a",(function(){return s})),n.d(t,"f",(function(){return c})),n.d(t,"e",(function(){return u})),n.d(t,"g",(function(){return p})),n.d(t,"h",(function(){return d}));var o,r,i,a=n(0);!function(e){e[e.Normal=0]="Normal",e[e.Append=1]="Append",e[e.New=2]="New",e[e.Edit=3]="Edit"}(o||(o={})),function(e){e.add="add",e.modify="mod",e.delete="del"}(r||(r={})),function(e){e[e.None=0]="None",e[e.Appendable=1]="Appendable",e[e.Deletable=2]="Deletable",e[e.Editable=3]="Editable"}(i||(i={}));var s,c,l=function(){function e(){}return Object.defineProperty(e,"EmptyPlaceholder",{get:function(){return String.fromCharCode(8205)},enumerable:!0,configurable:!0}),e}();!function(e){e[e.Normal=0]="Normal",e[e.Through=1]="Through",e[e.Double=2]="Double"}(s||(s={})),function(e){e[e.External=0]="External",e[e.Embed=1]="Embed",e[e.Float=2]="Float"}(c||(c={}));var p,u=[a.StoryType.CodeblockStory];!function(e){e.CARET="comment_caret",e.PLACEHOLDER="comment_placeholder"}(p||(p={}));var d=[p.CARET,p.PLACEHOLDER]},266:function(e,t,n){e.exports={"translate-language-bar":"translate-language-bar--2USoy","language-box":"language-box--1uWS2","language-box-disable":"language-box-disable--2RfAn","exchange-arrow":"exchange-arrow--2IUAx","dui-translate-menu-item":"dui-translate-menu-item--2vMrD",checked:"checked--1a76b","translate-fail-container":"translate-fail-container--28apM","fail-icon":"fail-icon--1rrwd","fail-text":"fail-text--14Wgw","btn-text":"btn-text--3ytK3","translate-page-btn":"translate-page-btn--1F5lC",disable:"disable--y2w_5","translate-page-btn-text":"translate-page-btn-text--8bF8-","translate-save-btn-icon":"translate-save-btn-icon--DSv3B"}},276:function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return i}));var o=n(0),r=function(){function e(){this.fieldCodeParserMap=new Map}return e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.getRegisteredParser=function(e){return this.fieldCodeParserMap.get(e)},e.prototype.registerFieldCodeParser=function(e,t){this.fieldCodeParserMap.set(e,t)},e.prototype.removeFieldCodeParser=function(e){this.fieldCodeParserMap.delete(e)},e}(),i=function(e,t){var n={html:"",plain:""};if(!e.fieldInfo)return n;var i=o.FieldcodeManager.getInstance().getFieldcodeInfo(e.fieldInfo.fieldCode),a=r.getInstance().getRegisteredParser(i.fieldName);return a?a(e,t):n}},277:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return l}));var o,r,i=n(2),a=n(21),s=function(){return(s=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};!function(e){e[e.SnapScreenPc=0]="SnapScreenPc",e[e.SnapScreenMobile=1]="SnapScreenMobile",e[e.Presentation=2]="Presentation",e[e.ImageViewPc=3]="ImageViewPc",e[e.ImageViewMobile=4]="ImageViewMobile",e[e.OcrHandler=5]="OcrHandler",e[e.OcrPreviewHandler=6]="OcrPreviewHandler",e[e.VoiceInputHandler=7]="VoiceInputHandler"}(r||(r={}));var c=((o={})[r.SnapScreenPc]=function(){return Promise.all([n.e(2),n.e(28),n.e(0),n.e(3),n.e(27)]).then(n.bind(null,456))},o[r.Presentation]=function(){return Promise.all([n.e(1),n.e(23),n.e(0),n.e(3),n.e(22)]).then(n.bind(null,457))},o[r.ImageViewPc]=function(){return Promise.all([n.e(1),n.e(20)]).then(n.bind(null,284))},o[r.OcrPreviewHandler]=function(){return Promise.all([n.e(1),n.e(8),n.e(21)]).then(n.bind(null,459))},o),l=function(){function e(){}return e.importAll=function(e,t){var n=this;return void 0===t&&(t={}),new Promise((function(o,r){Promise.all(e.map((function(e){return e()}))).then((function(e){var t=e.reduce((function(e,t){return s(s({},e),t)}));o(t)}),(function(s){var c=t.name||"";setTimeout((function(){if(t.retryOnline&&!a.network.isOnline){i.Logger.info("DynamicImport| Module "+c+" load paused, retry after online.");var l=function(){a.network.isOnline&&(i.Logger.info("DynamicImport| Module "+c+" load resume."),n.importAll(e,{log:t.log}).then(o,r)),a.network.remove(l)};a.network.changeEnd(l)}else t.log&&i.Logger.error("DynamicImport| Module "+c+" load failed"),r(s)}),100)}))}))},e.get=function(e,t){void 0===t&&(t={});var n=c[e];if(!n)throw new Error("DynamicImport|Module "+r[e]+" not exist");return this.importAll([n],s(s({},t),{name:r[e],log:!0}))},e.getAll=function(e,t){void 0===t&&(t={});var n=e.map((function(e){var t=c[e];if(!t)throw new Error("DynamicImport|Module "+r[e]+" load failed");return t}));return this.importAll(n,s(s({},t),{name:e.map((function(e){return r[e]})).join(", "),log:!0}))},e}()},279:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var o=n(0),r=function(){function e(){}return e.create=function(t,n,r,i){var a=window.QRCode,s=i&&i.width?i.width:100,c=i&&i.height?i.height:100,l=i&&i.correctLevel?i.correctLevel:a.CorrectLevel.Q,p=document.createElement("div");p.style.width=s+"px",p.style.height=c+"px";var u=document.createElement("canvas");u.setAttribute("width",""+s),u.setAttribute("height",""+c),i&&i.autosize&&(u.style.width="100%",u.style.height="auto");var d=u.getContext("2d");if(new a(p,{width:s,height:c,correctLevel:l}).makeCode(n),d){var h=p.lastChild;h&&h instanceof HTMLImageElement?h.onload=function(){var n=new Image;n.width=s,n.height=c,n.onload=function(){if(n.src)if(d.drawImage(n,0,0,s,c),r){var o=new Image,a=e.getPercentByCorrectLevel(l),p=s*a/100,h=c*a/100;o.width=p,o.height=h;var f=(s-p)/2,m=(c-h)/2;o.onload=function(){for(d.drawImage(o,f,m,p,h);t.hasChildNodes();)t.lastChild.remove();t.appendChild(u)},i&&1===i.logoType?o.src="https://puui.qpic.cn/vupload/0/1582181097340_jsr4wwyn25.png/0":o.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiA8Zz4KICA8cmVjdCByeD0iNSIgc3Ryb2tlPSIjYTBhMGEwIiBoZWlnaHQ9IjQwIiB3aWR0aD0iNDAiIHk9IjAiIHg9IjAiIGZpbGw9IiNmZmYiLz4KICA8ZyBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGZpbGw9Im5vbmUiPgogICA8ZyBzdHJva2U9Im51bGwiPgogICAgPHJlY3Qgc3Ryb2tlPSJudWxsIiByeD0iNS42IiBoZWlnaHQ9IjMxLjAwMDAwMiIgd2lkdGg9IjMxLjAwMDAwMiIgeT0iNC41IiB4PSI0LjQ5OTk5OCIgZmlsbD0iIzAxODhGQiIvPgogICAgPHBhdGggc3Ryb2tlPSJudWxsIiBmaWxsPSIjMDBEQ0ZGIiBkPSJtMzUuNSwxMC4zMTI1bC02LjkwNTk4NywtNS44MTI1bC0wLjkzNzMxNiw1LjA4NDEwOWMtMC4wNzAwNjgsMC4zNzk5MjggMC4yMzU3MjQsMC43MjgzOTIgMC42MzkwMzQsMC43MjgzOTJsNy4yMDQyNjksMHoiLz4KICAgIDxwb2x5Z29uIHN0cm9rZT0ibnVsbCIgcG9pbnRzPSIyMC4xNjAxNjk2MDE0NDA0Myw2LjQzNzUgMTguODgzNTg4NzkwODkzNTU1LDEzLjQ4MTkzNTUwMTA5ODYzMyA2LjQzNzQ5ODA5MjY1MTM2NywxMy41MDI3ODU2ODI2NzgyMjMgMTEuODQ0OTU2Mzk4MDEwMjU0LDE5LjE3OTUwNjMwMTg3OTg4MyAxNy44NDYzNjg3ODk2NzI4NSwxOS4xNzk1MDYzMDE4Nzk4ODMgMTQuODczNDk2MDU1NjAzMDI3LDM1LjUgMjIuNTI3MTc3ODEwNjY4OTQ1LDM1LjUgMjUuNTAzNDIxNzgzNDQ3MjY2LDE5LjE3OTUwNjMwMTg3OTg4MyAzNC41NDAxMDIwMDUwMDQ4OCwxOS4xNzk1MDYzMDE4Nzk4ODMgMzQuODU0MTY5ODQ1NTgxMDU1LDE5LjE3MjcyNTY3NzQ5MDIzNCAiIGZpbGw9IiNGRkZGRkYiIGlkPSJGaWxsLTUiLz4KICAgPC9nPgogIDwvZz4KIDwvZz4KPC9zdmc+"}else t.appendChild(u)},n.src=o.NodeUtil.getAttr(h,"src")||""}:t.appendChild(p)}else t.appendChild(p)},e.getPercentByCorrectLevel=function(e){var t=window.QRCode,n=0;return e===t.CorrectLevel.L?n=7:e===t.CorrectLevel.M?n=15:e===t.CorrectLevel.Q?n=25:e===t.CorrectLevel.H&&(n=30),n},e}()},280:function(e,t,n){e.exports={mask:"mask--3aKXa",button:"button---Rpjp",element:"element--1ktWu","auth-tip-icon":"auth-tip-icon--TlTWe","auth-tip-lock":"auth-tip-lock--1FyaM","auth-tip-lock-add":"auth-tip-lock-add--210Jw","auth-tip-cooperation":"auth-tip-cooperation--apIOl","auth-tip-eye":"auth-tip-eye--tQNjg","auth-tip-edit":"auth-tip-edit--18_9F","auth-tip-text":"auth-tip-text--2Jri8","header-extra-element":"header-extra-element--2sOqc","permission-icon-button":"permission-icon-button--1J1to"}},291:function(e,t,n){e.exports={"collab-caret-container":"collab-caret-container--4UlxZ","collab-caret":"collab-caret--2S_lI","collab-caret-name":"collab-caret-name--gBDDW","collab-caret-name-fade-out":"collab-caret-name-fade-out--iZiUN"}},294:function(e,t,n){e.exports={"search-replace-container":"search-replace-container--1lTYG","search-replace-tab-container":"search-replace-tab-container--3vU46","search-replace-tab-li":"search-replace-tab-li--3YR94","search-replace-content-container":"search-replace-content-container--3NqWd","search-tab-content":"search-tab-content--3rbzp","search-replace-input":"search-replace-input--ELYxx","search-count-info":"search-count-info--mF4Lo","search-count-info1":"search-count-info1--2OYNS","search-count-info2":"search-count-info2--3DBGE",info:"info--3Kb_u",info2:"info2--ce81e","search-button-container":"search-button-container--3MscR","search-button-container2":"search-button-container2--2I-lG","search-replace-button":"search-replace-button--1Qp66","search-button-text":"search-button-text--2Q6u5","prev-button-image":"prev-button-image--3jWkm","next-button-image":"next-button-image--3p8wG","img-disabled":"img-disabled--30UoU","search-replace-close":"search-replace-close--3J2Ue","search-replace-container-mobile":"search-replace-container-mobile--Hz9GB","wrapper-left":"wrapper-left--u-R-A","wrapper-right":"wrapper-right--fHcjg","search-replace-close-mobile":"search-replace-close-mobile--1vv89","replace-input-wraper":"replace-input-wraper--10kso","search-replace-input-mobile":"search-replace-input-mobile--31P9i","search-count-info-mobile":"search-count-info-mobile--29X_C","search-button-container-mobile":"search-button-container-mobile--18JUk","search-replace-button-mobile":"search-replace-button-mobile--3iY10","icon-menu-search":"icon-menu-search--lD0QG"}},300:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var o=n(0),r=n(110),i=n(2),a=function(e){var t=r.a.imgPropertyToStyle(e),n=Object(i.twipsToPx)(t.imageWidth),o=Object(i.twipsToPx)(t.imageHeight),a=Object(i.twipsToPx)(t.croppedWidth),s=Object(i.twipsToPx)(t.croppedHeight),c=Object(i.twipsToPx)(t.marginLeft),l=Object(i.twipsToPx)(t.marginTop);if(e.anchorId){var p=document.getElementById(e.anchorId);p&&p.height&&p.width&&(o=p.height,n=p.width)}return'<span class="image-wrapper" style="display: inline-block; overflow: hidden; width: '+a+"px; height: "+s+'px;">\n            <img src="'+e.imgSrc+'"\n            width="'+n+'"\n            height="'+o+'"\n            style="margin-left: '+c+"px; margin-top: "+l+"px; width: "+n+"px; height: "+o+'px;"/>\n            </span>'},s=function(e){var t=e.getProperty();return t&&t instanceof o.ImageProperty?{html:a(t),plain:""}:{html:"",plain:""}}},303:function(e,t,n){e.exports={"text-flow-wrapper":"text-flow-wrapper--3kqsD","text-flow-seperator":"text-flow-seperator--2lH50","text-flow-item-container":"text-flow-item-container--3xiwe","text-flow-str":"text-flow-str--1cVsQ","text-flow-expand":"text-flow-expand--35Juw","text-flow-time":"text-flow-time--Gt0cf","text-flow-empty":"text-flow-empty--1wFng"}},306:function(e,t,n){"use strict";function o(e,t){var n={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()},o=t;return/(y+)/.test(o)&&(o=o.replace(RegExp.$1,e.getFullYear().toString().substr(4-RegExp.$1.length))),Object.keys(n).forEach((function(e){if(new RegExp("("+e+")").test(t)){var r=n[e];o=o.replace(RegExp.$1,1===RegExp.$1.length?r.toString():("00"+r).substr(r.toString().length))}})),o}n.d(t,"a",(function(){return o}))},307:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var o,r=n(1),i=n.n(r),a=(n(379),o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a(t,e),t.prototype.render=function(){return i.a.createElement("div",{style:{width:"100%",height:"48px",top:"45%",position:"fixed",zIndex:5e3}},i.a.createElement("div",{className:"presentation-spin-first-loading"},i.a.createElement("div",{className:"presentation-spin-first-loading-container",style:{transform:"translate(-50%, -50%) scale(1)"}},i.a.createElement("div",{className:"presentation-spin-first-loading-circle presentation-spin-first-loading-circle-dark"}))),i.a.createElement("div",{className:"presentation-loading-text",style:{textAlign:"center"}},"正在加载，请稍候..."))},t}(i.a.Component)},335:function(e,t,n){e.exports={"import-file-dialog-container":"import-file-dialog-container--Rn-27"}},336:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var o=n(2),r=function(){function e(){}return e.gotoTucaoWithLoginState=function(e){var t=document.createElement("form");t.id="form",t.name="form",t.style.display="none",t.setAttribute("target","_blank"),document.body.appendChild(t),Object.keys(e).forEach((function(n){var o=document.createElement("input");o.type="text",o.name=n,o.value=e[n],t.appendChild(o)})),t.method="POST",t.action="https://support.qq.com/product/28096",t.submit(),document.body.removeChild(t)},e.getClientInfo=function(e){var t=e.userName,n=e.userPic,o=e.userId||"";o?o.startsWith("p")&&(o=o.replace(/p./,"")):o=e.uin;var r=" ";return void 0!==e.collab_client_vars.pver&&(r=r+" pver/"+e.collab_client_vars.pver),void 0!==e.collab_client_vars.gray&&(r=r+" gray/"+e.collab_client_vars.gray),{openid:o,nickname:t,avatar:n,clientInfo:window.navigator.userAgent+r}},e.showSupportPage=function(e){var t=this.getClientInfo(e);t.customInfo=window.location.href,this.gotoTucaoWithLoginState(t)},e.jumpToCaoUrl=function(e){var t=encodeURIComponent(window.navigator.userAgent),n=encodeURIComponent(window.location.href);if(e){var r=this.getClientInfo(e),i=encodeURIComponent(r.nickname),a=encodeURIComponent(r.avatar),s=encodeURIComponent(r.openid);Object(o.openLink)("https://support.qq.com/embed/phone/28096?nickname="+i+"&avatar="+a+"&openid="+s+"&clientInfo="+t+"&customInfo="+n)}else Object(o.openLink)("https://support.qq.com/embed/phone/28096?clientInfo="+t+"&customInfo="+n)},e}()},338:function(e,t,n){e.exports={"page-button":"page-button--33UDZ","page-text":"page-text--Iw-ud"}},340:function(e,t,n){e.exports={placeholder:"placeholder--_8cQZ"}},341:function(e,t,n){},342:function(e,t,n){e.exports={"dialog-position":"dialog-position--2DbNO","page-setting-title":"page-setting-title--2fJ7N","dialog-body":"dialog-body--3yXP7","setting-panel":"setting-panel--3sJFe","setting-section":"setting-section--YKPoM","setting-section-papaer-orientation":"setting-section-papaer-orientation--BzQKE","setting-section-paper-size-wkn":"setting-section-paper-size-wkn--DDGNR","setting-section-paper-size-value":"setting-section-paper-size-value--3fo9s","setting-section-paper-margin-left-and-right":"setting-section-paper-margin-left-and-right--1XRb4","setting-section-paper-margin-top-and-bottom":"setting-section-paper-margin-top-and-bottom--1VRuF","setting-section-left":"setting-section-left--1AjJF","setting-section-right":"setting-section-right--2-cyV","paper-orientation-group":"paper-orientation-group--Z9zZg","unit-label":"unit-label--3mjtx","setting-name-right":"setting-name-right--3GR_j","number-input-error-text-combine":"number-input-error-text-combine--3mal0","setting-name":"setting-name--2BsR9","setting-name-paper-orientation":"setting-name-paper-orientation--2rciM","setting-name-paper-size-wkn":"setting-name-paper-size-wkn--1m3J5","setting-name-paper-size":"setting-name-paper-size--3gkbB","setting-name-paper-size-height":"setting-name-paper-size-height--1Evul","setting-name-paper-size-width":"setting-name-paper-size-width--3EHwD","setting-name-paper-margin":"setting-name-paper-margin--2qkTF","setting-name-paper-margin-right":"setting-name-paper-margin-right--39xpg","setting-name-paper-margin-top":"setting-name-paper-margin-top--aHIZm","setting-name-paper-margin-bottom":"setting-name-paper-margin-bottom--DhxdQ","preview-container":"preview-container--248bC","bottom-btns":"bottom-btns--1i3pW"}},345:function(e,t,n){e.exports={"number-input-container":"number-input-container--3HMM4","number-input-content":"number-input-content--21hnG",disabled:"disabled--3DaDs","number-input-inc-btn":"number-input-inc-btn--36LH4","number-input-inc-arrow":"number-input-inc-arrow--9SKHB","number-input-desc-btn":"number-input-desc-btn--radZ4","number-input-desc-arrow":"number-input-desc-arrow--3lS_C","number-input-error":"number-input-error--3HYUo"}},346:function(e,t,n){"use strict";n.d(t,"a",(function(){return y}));var o=n(5),r=n(0),i=n(2),a=(n(347),n(86)),s=n(110),c=n(300),l=n(11),p=n.n(l),u=n(1),d=n.n(u),h=n(277),f=n(18),m=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},g=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},y=function(){function e(e,t){this.contextService=e,this.workbench=t,this.context=e.context}return e.prototype.$onInit=function(e){var t=this;this.editor=e,this.editor.isEditable()||this.editor.on(r.RenderNotificationTypes.CONTAINER_FOCUS,(function(e){if(e.focus&&e.currentContainer&&e.currentContainer){var n=e.currentContainer;if(n.property instanceof r.ImageProperty)return t.currentImage=n,void(e.isLeftMouse&&t.openImageViewer())}}),this),this.editor.clipboardManager.addCopyContainerParser(r.ContainerType.Drawing,r.DrawingType.Image,c.a),this.editor.on(r.RenderNotificationTypes.IMAGE_SIZE_INIT,(function(e){e&&e.imageHeight>0&&e.imageWidth>0&&t.imageSizeInit(e.height,e.width,e.first,e.last)}),this)},e.prototype.setCurrentImage=function(e){this.currentImage=e},e.prototype.clearCurrentImage=function(){this.currentImage=null},e.prototype.getCurrentImage=function(){return this.currentImage},e.prototype.openImageViewer=function(){r.ReportHelper.tdwReport({opername:"doc_word_editor",module:"picture",action:"viewer"}),this.currentImage&&this.currentImage.property&&this.openPcImageViewer()},e.prototype.openPcImageViewer=function(){var e=this;h.a.get(h.b.ImageViewPc).then((function(t){var n=t.ImageViewer;if(e.currentImage&&e.currentImage.property){var o=e.editor.service.getDocument().getInlineShapes(r.DrawingType.Image),i=s.a.sortImageAttributes(o);if(!i)return;var a=i.imageSizeList,c=i.imageList,l=i.imageIdList,u=i.cropValueList;if(!c.length)return;var h=e.currentImage.property.anchorId,f=document.getElementById("app");if(!f)return;var m=document.getElementById("image-preview-container");m||((m=document.createElement("div")).id="image-preview-container",f.appendChild(m)),p.a.render(d.a.createElement(n,{anchorId:h,previewVisible:!0,imageSizeList:a,cropValueList:u,imageList:c,containerDom:m,imageIdList:l}),m),e.workbench.emit("$hideImageResizer"),e.clearCurrentImage()}}))},e.prototype.openMobileImageViewer=function(){},e.prototype.imageSizeInit=function(e,t,n,o){if(this.editor){var a=this.editor.getRangeFromIndex(n,o),c=this.editor.onDocument().getRange(a.begin(),a.end()).getInlineShapes(r.DrawingType.Image).item(0);if(c){var l=new r.ImageProperty,p=!1;e>0&&t>0&&(l.width=Object(i.pxToTwips)(t),l.height=Object(i.pxToTwips)(e),p=!0),c.getAnchorId()||(l.anchorId=s.a.getAttachmentId(),p=!0),p&&c.setImageProperties(l,this.editor.isEditable())}}},e.prototype.$beforeDestroy=function(e){this.editor.removeListener(r.RenderNotificationTypes.CONTAINER_FOCUS,this),this.editor.removeListener(r.RenderNotificationTypes.IMAGE_SIZE_INIT,this),r.GlobalContext.removeListener(a.f.SWITCH_TO_BACKGROUND,this)},e=m([Object(o.i)({name:f.a.ImageReadonly,scope:0,for:["melo"]}),g("design:paramtypes",[o.f,o.B])],e)}()},349:function(e,t,n){e.exports={"icon-menu-export":"icon-menu-export--mPioP"}},350:function(e,t,n){},351:function(e){e.exports=JSON.parse('{"v":"4.11.1","fr":24,"ip":0,"op":32,"w":16,"h":16,"nm":"1120 save","ddd":0,"assets":[],"layers":[{"ddd":0,"ind":1,"ty":4,"nm":"save - 2","sr":1,"ks":{"o":{"a":0,"k":100,"ix":11},"r":{"a":0,"k":0,"ix":10},"p":{"a":0,"k":[8.239,7.954,0],"ix":2},"a":{"a":0,"k":[6.077,4.744,0],"ix":1},"s":{"a":0,"k":[100,100,100],"ix":6}},"ao":0,"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[0,0],[0,0],[0,0]],"o":[[0,0],[0,0],[0,0]],"v":[[3.577,-2.244],[-0.911,2.244],[-3.577,-0.423]],"c":false},"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"st","c":{"a":0,"k":[0.5058823529411764,0.5254901960784314,0.5607843137254902,1],"ix":3},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":1,"ix":5},"lc":1,"lj":1,"ml":10,"nm":"Stroke 1","mn":"ADBE Vector Graphic - Stroke","hd":false},{"ty":"tr","p":{"a":0,"k":[6.077,4.744],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Group 1","np":2,"cix":2,"ix":1,"mn":"ADBE Vector Group","hd":false},{"ty":"tm","s":{"a":1,"k":[{"i":{"x":[0.712],"y":[1]},"o":{"x":[1],"y":[0]},"n":["0p712_1_1_0"],"t":12,"s":[100],"e":[0]},{"t":21}],"ix":1},"e":{"a":0,"k":100,"ix":2},"o":{"a":0,"k":0,"ix":3},"m":1,"ix":2,"nm":"Trim Paths 1","mn":"ADBE Vector Filter - Trim","hd":false}],"ip":0,"op":48,"st":0,"bm":0},{"ddd":0,"ind":2,"ty":4,"nm":"save - 1","sr":1,"ks":{"o":{"a":0,"k":100,"ix":11},"r":{"a":0,"k":0,"ix":10},"p":{"a":0,"k":[8.016,8.016,0],"ix":2},"a":{"a":0,"k":[9,9,0],"ix":1},"s":{"a":0,"k":[100,100,100],"ix":6}},"ao":0,"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[0,-3.59],[3.59,0],[0,3.59],[-3.59,0]],"o":[[0,3.59],[-3.59,0],[0,-3.59],[3.59,0]],"v":[[6.5,0],[0,6.5],[-6.5,0],[0,-6.5]],"c":true},"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"st","c":{"a":0,"k":[0.5058823529411764,0.5254901960784314,0.5607843137254902,1],"ix":3},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":1,"ix":5},"lc":1,"lj":1,"ml":10,"nm":"Stroke 1","mn":"ADBE Vector Graphic - Stroke","hd":false},{"ty":"tr","p":{"a":0,"k":[9,9],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Group 1","np":2,"cix":2,"ix":1,"mn":"ADBE Vector Group","hd":false},{"ty":"tm","s":{"a":1,"k":[{"i":{"x":[0.245],"y":[1]},"o":{"x":[0.333],"y":[0]},"n":["0p245_1_0p333_0"],"t":4,"s":[100],"e":[0]},{"t":11}],"ix":1},"e":{"a":0,"k":100,"ix":2},"o":{"a":0,"k":-90,"ix":3},"m":1,"ix":2,"nm":"Trim Paths 1","mn":"ADBE Vector Filter - Trim","hd":false}],"ip":0,"op":48,"st":0,"bm":0}]}')},352:function(e,t,n){e.exports={"fullsreen-button":"fullsreen-button--1qJdW","unfullsreen-button":"unfullsreen-button--35MKv"}},353:function(e,t,n){},354:function(e,t,n){},355:function(e,t,n){},356:function(e,t,n){},357:function(e,t,n){},358:function(e,t,n){},359:function(e,t,n){},360:function(e,t,n){},361:function(e,t,n){},363:function(e,t,n){},364:function(e,t,n){},365:function(e,t,n){},366:function(e,t,n){},367:function(e,t,n){},368:function(e,t,n){},369:function(e,t,n){},370:function(e,t,n){},371:function(e,t,n){},373:function(e,t,n){},374:function(e,t,n){},375:function(e,t,n){e.exports={"presentation-button":"presentation-button--1ECM5",focus:"focus--gNeyX"}},376:function(e,t,n){e.exports={"guide-image":"guide-image--24Xb2"}},377:function(e,t,n){e.exports={"dialog-wrapper":"dialog-wrapper--G9jX8","modal-close":"modal-close--3qr90","modal-close-x":"modal-close-x--3NkHn","modal-content":"modal-content--xh42m"}},378:function(e,t,n){e.exports={"presentation-status":"presentation-status--1JcCv"}},379:function(e,t,n){e.exports={"presentation-spin-first-loading-rotate":"presentation-spin-first-loading-rotate--kXybw"}},380:function(e,t,n){e.exports={"play-button":"play-button--3aCgS"}},381:function(e,t,n){},383:function(e,t,n){e.exports={"move-to-folder-wrapper":"move-to-folder-wrapper--mw5pm"}},384:function(e,t,n){},385:function(e,t,n){e.exports={"border-panel":"border-panel--3Ejmy","item-list":"item-list--3YONP","border-item":"border-item--1IZZF",selected:"selected--2vS_2","color-entry-wrapper":"color-entry-wrapper--YfMKc",disabled:"disabled--2GkVl","color-entry":"color-entry--a4-jR",left:"left--IAxLC","color-icon":"color-icon--1BvRh","color-bottom":"color-bottom--2W7m_",right:"right--2rXZY",arrow:"arrow--2CLeI","color-panel":"color-panel--DrPgP"}},387:function(e,t,n){e.exports={"row-col-container":"row-col-container--18qiR","cell-panel":"cell-panel--1__Rk","row-col-item":"row-col-item--3uh5H",higlight:"higlight--1exI3","row-col-panel-name-wrapper":"row-col-panel-name-wrapper--3BP83","row-col-panel-name":"row-col-panel-name--1w4dZ","row-col-panel-diy-wrapper":"row-col-panel-diy-wrapper--2ddF9","row-col-panel-diy":"row-col-panel-diy--14gjC"}},388:function(e,t,n){e.exports={"crd-body":"crd-body--_dp7M","crd-setting-group":"crd-setting-group--1KfU3","crd-setting-item":"crd-setting-item--3olZs","crd-setting-label-wrapper-left":"crd-setting-label-wrapper-left--17fPL","crd-setting-input-wrapper-big":"crd-setting-input-wrapper-big--8foQq","crd-setting-label-wrapper-right":"crd-setting-label-wrapper-right--1YriM","crd-setting-label-wrapper-right-big":"crd-setting-label-wrapper-right-big--otRPS","crd-unit-label":"crd-unit-label--BDnEf","crd-label":"crd-label--1o2g4","crd-setting-group-spacing":"crd-setting-group-spacing--1401E","crd-setting-group-indent":"crd-setting-group-indent--2EBWq","crd-setting-group-divider":"crd-setting-group-divider--vM1_V","crd-input-wrapper":"crd-input-wrapper--2jVCF","crd-input":"crd-input--3I2z4","crd-number-input":"crd-number-input--3ZbTx","crd-number-input-focus":"crd-number-input-focus--3X6zx","crd-number-input-error-text":"crd-number-input-error-text--33Nyu","crd-number-input-error":"crd-number-input-error--3Qsp7","pad-ui-input":"pad-ui-input--2yOPb","crd-input-inc-button":"crd-input-inc-button--2fvdw","crd-input-dec-button":"crd-input-dec-button--3HtVm","crd-dropdown-select-button":"crd-dropdown-select-button--2GnG0","crd-dropdown-overlay":"crd-dropdown-overlay--194lF","crd-dropdown-item":"crd-dropdown-item--34juC","crd-dropdown-overlay-big":"crd-dropdown-overlay-big--czQaZ","crd-dropdown-overlay-small":"crd-dropdown-overlay-small--3kEfb","crd-dropdown-select-open":"crd-dropdown-select-open--13jvO","crd-dropdown-select-small":"crd-dropdown-select-small--Tes0I","crd-dropdown-select-big":"crd-dropdown-select-big--149ds","crd-btns":"crd-btns--cpsYI",btn:"btn--14UWm"}},389:function(e,t,n){e.exports={"table-preview":"table-preview--kMUpn"}},390:function(e,t,n){e.exports={"common-drag-container":"common-drag-container--1ShAq","common-drag-cursor":"common-drag-cursor--3p4Q3","common-wrapper-preview":"common-wrapper-preview--i5nAS","common-drag-preview":"common-drag-preview--2_GzU","common-drag-shadow":"common-drag-shadow--1JxQu"}},391:function(e,t,n){e.exports={"bottom-btns":"bottom-btns--3jHda"}},392:function(e,t,n){e.exports={"title-default-add-placeholder":"title-default-add-placeholder---7WOw"}},458:function(e,t,n){"use strict";n.d(t,"a",(function(){return I}));var o,r=n(0),i=n(5),a=n(1),s=n.n(a),c=n(35),l=n.n(c),p=n(111),u=n.n(p),d=n(352),h=n.n(d),f=n(74),m=n.n(f),g=(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onFullSreenStatusChange=function(){t.forceUpdate()},t}return g(t,e),t.prototype.componentDidMount=function(){this.props.handler&&this.props.handler.on("change",this.onFullSreenStatusChange)},t.prototype.componentWillUnmount=function(){this.props.handler&&this.props.handler.off("change",this.onFullSreenStatusChange)},t.prototype.enterFullScreenMode=function(){this.props.handler&&this.props.handler.handleFullScreen(document.documentElement)},t.prototype.render=function(){var e=this,t=!1;this.props.handler&&(t=this.props.handler.isFullScreen());var n=t?"普通模式":"全屏模式",o=t?h.a["unfullsreen-button"]:h.a["fullsreen-button"];return s.a.createElement("div",null,s.a.createElement(u.a,{orientation:"vertical",style:{marginLeft:0,marginRight:16,verticalAlign:"middle",height:12,width:1,border:0,background:"rgba(0, 0, 0, 0.12)"}}),s.a.createElement("div",{className:m.a["statusbar-simple-button"]},s.a.createElement(l.a,{placement:"top",title:n},s.a.createElement("div",{className:o+" "+m.a["small-button"],onClick:function(){e.enterFullScreenMode()}}))))},t}(s.a.Component),v=[{name:"view-fullscreen",content:"全屏模式",shortcut:{win:"F11",mac:"⌃+⌘+F"},onClick:function(e,t){t.handleFullScreen(document.documentElement)}}],b=[{name:"full-screen",content:s.a.createElement(y,null)}],C=[{keyBindings:{mac:i.n.CTRL_MAC+i.n.COMMAND+i.o.F,win:i.o.F11},callback:function(e,t){t.handleFullScreen(document.documentElement)}}],_=n(2),w=n(18),R=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},S=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},E=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{c(o.next(e))}catch(e){i(e)}}function s(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))},T=function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},P=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],I=function(){function e(){this.fn=function(){for(var e=P.length,t={},n=0;n<e;n++){var o=P[n];if(o&&o[1]in document){for(n=0;n<o.length;n++)t[P[0][n]]=o[n];return t}}return!1},this.eventNameMap={change:this.fn().fullscreenchange,error:this.fn().fullscreenerror}}return e.prototype.onChange=function(e){this.on("change",e)},e.prototype.onError=function(e){this.on("error",e)},e.prototype.on=function(e,t){var n=this.eventNameMap[e];n&&document.addEventListener(n,t,!1)},e.prototype.off=function(e,t){var n=this.eventNameMap[e];n&&document.removeEventListener(n,t,!1)},e.prototype.isShowFullscrenn=function(){var e=_.PlatformUtil.isIE,t=_.PlatformUtil.isIE11,n=_.PlatformUtil.isMobile,o=_.PlatformUtil.isIPad,r=e()&&!t();return!n()&&!o()&&!r},e.prototype.isFullScreenEnable=function(){var e=this.fn().fullscreenEnabled;return document[e]},e.prototype.isFullScreen=function(){var e=this.fn().fullscreenElement;return Boolean(document[e])},e.prototype.getFullScreenElement=function(){var e=this.fn().fullscreenElement;return document[e]},e.prototype.requestFullScreen=function(e){return E(this,void 0,void 0,(function(){var t,n=this;return T(this,(function(o){return(t=e)||(t=document.documentElement),r.ReportHelper.tdwReport({opername:"doc_word_editor",module:"view",action:"enter_full_mode"}),[2,new Promise((function(e,o){var r=n.fn().requestFullscreen,i=function(){n.off("change",i),e()};t[r](),(_.PlatformUtil.isIE()||_.PlatformUtil.isEdge())&&t===document.documentElement&&(t.style.height="100%",t.style.width="100%"),n.on("change",i)}))]}))}))},e.prototype.cancelFullScreen=function(){return E(this,void 0,void 0,(function(){var e=this;return T(this,(function(t){return r.ReportHelper.tdwReport({opername:"doc_word_editor",module:"view",action:"exit_full_mode"}),[2,new Promise((function(t,n){if(e.isFullScreen){var o=function(){e.off("change",o),t()};document[e.fn().exitFullscreen](),e.on("change",o)}else t()}))]}))}))},e.prototype.handleFullScreen=function(e){this.isFullScreen()?this.cancelFullScreen():this.requestFullScreen(e)},e=R([Object(i.i)({name:w.a.Fullscreen,scope:1,menuItems:v,keymap:C,statusbarItems:b}),S("design:paramtypes",[])],e)}()},474:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var o,r=n(1),i=n.n(r),a=n(345),s=n.n(a),c=(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),l=function(e){function t(t){var n=e.call(this,t)||this;return n.handleChange=function(e){var t=e.target.value;t=void 0!==n.props.minValue&&n.props.minValue<0?t.replace(/[^\d.-]/g,""):t.replace(/[^\d.]/g,"");var o=void 0===n.props.allowDecimal||n.props.allowDecimal?t:t.replace(/[^\d]/g,""),r="-"===o,i=!1;0===Math.abs(parseFloat(o))&&(i=!0),n.isValid(o)||r||i?n.setState({value:o,valid:!0}):n.setState({value:o,valid:!1}),n.props.onChange&&n.props.onChange(o)},n.handelMoveup=function(e){if(!n.props.disabled){var t=0;isNaN(parseFloat(String(n.state.value)))||(t=parseFloat(String(n.state.value)));var o=n.props.step?n.props.step:1;t=n.stepUp(t,o),n.isValid(""+t)&&(n.setState({value:t,valid:!0}),n.props.onChange&&n.props.onChange(t))}},n.handleMovedown=function(e){if(!n.props.disabled){var t=0;isNaN(parseFloat(String(n.state.value)))||(t=parseFloat(String(n.state.value)));var o=n.props.step?n.props.step:1;t=n.stepDown(t,o),n.isValid(""+t)&&(n.setState({value:t,valid:!0}),n.props.onChange&&n.props.onChange(t))}},n.handleMouseOver=function(e){n.props.disabled||n.setState({showArrow:!0})},n.handleMouseOut=function(e){n.props.disabled||n.setState({showArrow:!1})},n.handleBlur=function(e){n.checkInput(n.state.value)},n.checkInput=function(e){var t=n.isValid(e);return n.setState({valid:t}),t},n.state={showArrow:!1,valid:!0,value:n.props.defaultValue},n}return c(t,e),t.prototype.isValid=function(e){return!isNaN(e)&&(!(void 0!==this.props.minValue&&e<this.props.minValue)&&!(void 0!==this.props.maxValue&&e>this.props.maxValue))},t.prototype.roundFloat=function(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)},t.prototype.floorFloat=function(e,t){return Math.floor(e*Math.pow(10,t))/Math.pow(10,t)},t.prototype.decimalCount=function(e){var t=e.toString().split(".")[1];return void 0!==t?t.length:0},t.prototype.stepUp=function(e,t){var n=this.decimalCount(t),o=(Math.floor(e*Math.pow(10,n)/(t*Math.pow(10,n)))+1)*t;return o=this.floorFloat(o,this.decimalCount(t)),void 0!==this.props.maxValue&&o>this.props.maxValue&&(o=this.props.maxValue),o},t.prototype.stepDown=function(e,t){var n=this.decimalCount(t),o=0===e*Math.pow(10,n)%(t*Math.pow(10,n))?1:0,r=(Math.floor(e*Math.pow(10,n)/(t*Math.pow(10,n)))-o)*t;return r=this.floorFloat(r,this.decimalCount(t)),void 0!==this.props.minValue&&r<this.props.minValue&&(r=this.props.minValue),r},t.prototype.setValue=function(e){var t=this;this.props.disabled||setTimeout((function(){var n=e?Math.floor(100*e)/100:e;void 0!==e?(isNaN(e)&&(n=void 0),t.props.minValue&&e<t.props.minValue&&(n=t.props.minValue),t.props.maxValue&&e>t.props.maxValue&&(n=t.props.maxValue)):n=void 0,t.setState({value:void 0===n?"":n,valid:!0}),t.props.onChange&&t.props.onChange(n)}),0)},t.prototype.render=function(){var e,t;e=this.state.showArrow?{display:"block"}:{display:"none"},this.state.valid||(t=void 0!==this.props.minValue&&void 0!==this.props.maxValue?"有效数值为"+this.props.minValue+"至"+this.props.maxValue:"无效数值");var n=this.props.disabled?[s.a["number-input-content"],s.a.disabled].join(" "):s.a["number-input-content"],o=this.state.valid?{}:{border:"1px solid #ef4e2f"};return i.a.createElement("div",{className:s.a["number-input-container"],style:this.props.style,onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut},i.a.createElement("input",{disabled:this.props.disabled,onBlur:this.handleBlur,value:this.state.value,className:n,style:o,onChange:this.handleChange}),i.a.createElement("div",{className:s.a["number-input-inc-btn"]+" "+s.a["number-input-inc-arrow"],style:e,onClick:this.handelMoveup}),i.a.createElement("div",{className:s.a["number-input-desc-btn"]+" "+s.a["number-input-desc-arrow"],style:e,onClick:this.handleMovedown}),i.a.createElement("span",{className:s.a["number-input-error"]},t))},t}(i.a.Component)},479:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var o=n(5),r=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},i=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(){this._measure=document.createElement("div"),this.setInvisible(),document.body.appendChild(this._measure)}return e.prototype.setInvisible=function(){this._measure.style.pointerEvents="none",this._measure.style.position="absolute",this._measure.style.top="-9999px",this._measure.style.zIndex="-9999"},e.prototype.clear=function(){this._measure.innerHTML="",this._measure.removeAttribute("style"),this._measure.removeAttribute("class")},e.prototype.reset=function(){this.clear(),this.setInvisible()},e.prototype.attachStyle=function(e){var t=this;e.classname&&this._measure.classList.add(e.classname),e.style&&Object.keys(e.style).forEach((function(n){t._measure.style[n]=e.style[n]}))},e.prototype.getText=function(e,t){return t?t.replace(/%0/g,e):e},e.prototype.wrapWidth=function(e,t,n,o,r){void 0===o&&(o="..."),this.clear(),this.attachStyle(n),this.setInvisible(),this._measure.style.whiteSpace="nowrap";var i=this.getText(e,r);if(this._measure.innerText=i,this._measure.clientWidth>t)for(var a=e.substr(0,e.length-1);a.length>0&&(i=this.getText(""+a+o,r),this._measure.innerText=i,!(this._measure.clientWidth<t));a=a.substr(0,a.length-1));var s=this._measure.innerText;return this.reset(),s},e.prototype.wrapLine=function(e,t,n,o,r,i){void 0===r&&(r="..."),void 0===i&&(i=!0),this.clear(),this.attachStyle(o),this.setInvisible(),this._measure.style.width=t+"px",this._measure.style.wordBreak="break-all",this._measure.style.whiteSpace="pre-wrap";var a=e.split("");this._measure.innerHTML="<span>"+r+"</span>\n"+a.map((function(e){return"<span>"+e+"</span>"})).join("");for(var s=this._measure.firstElementChild,c=s.offsetWidth,l=s.offsetTop,p=-1,u=-1;s;){if(s.offsetTop>l&&(u+=1,l=s.offsetTop),u>=n){p-=1;break}if(u===n-1&&("\n"===s.innerHTML||s.offsetLeft+s.offsetWidth+c>t))break;p+=1,s=s.nextElementSibling}if(this.reset(),p===e.length)return e;var d=e.substr(0,p);return i?""+d+r:d},e=r([Object(o.w)({singleton:!0}),i("design:paramtypes",[])],e)}()},481:function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var o=n(0),r=n(390),i=n.n(r),a=n(5),s=n(2),c=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},l=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=function(){function e(){var e=this;this.mouseUpState=!0,this.isMobileDrag=!1,this.throttleMove=Object(s.throttle)((function(t){e.onMouseMove(t)}),10),this.onMouseDown=function(t){var n=e.contextService.context.editor;if(n.isEditable()&&e.isDragEnable()){e.container&&e.cursor||e.init(),t&&(e.originEventType=t instanceof TouchEvent?"touch":"mouse",e.originX=t.pageX,e.originY=t.pageY);var o=e.getSelectedObject(t);if(o&&1===t.which)t.preventDefault(),t.stopPropagation(),e.mouseUpState=!1,e.draggingObject=o,e.sourceViewPoint=e.getSrcViewPoint(t),n.getRoot().removeEventListener("mousemove",e.throttleMove),n.getRoot().removeEventListener("mouseup",e.onMouseUp),n.getRoot().addEventListener("mousemove",e.throttleMove),n.getRoot().addEventListener("mouseup",e.onMouseUp)}},this.onMouseUp=function(t){var n=e.contextService.context.editor;if(n.isEditable()&&!e.mouseUpState)if(e.mouseUpState=!0,e.isNodeInEditor(t.target)){n.getRoot().removeEventListener("mousemove",e.throttleMove),n.getRoot().removeEventListener("mouseup",e.onMouseUp);var o=e.getXYInfo(t);if(o){var r=e.getViewRangePoint(o);r&&e.isValidPoint(r)&&(e.lastValidViewPoint=r)}e.finishDrag(!0,e.lastValidViewPoint)}else e.finishDrag(!1)};var t=this.contextService.context.editor;this.selector=t.createSelector(),t.getRoot().removeEventListener("mousedown",this.onMouseDown),t.getRoot().addEventListener("mousedown",this.onMouseDown)}return e.prototype.init=function(){var e=this.contextService.context.editor;if(this.draggingObject=void 0,this.isDrag=!1,e){var t=e.view.getDom();t&&(this.container=document.createElement("div"),this.container.id="common-drag-container",this.container.className=i.a["common-drag-container"],t.appendChild(this.container),this.preview=document.createElement("div"),this.preview.id="common-drag-preview",this.preview.className=i.a["common-drag-preview"],this.container.appendChild(this.preview),this.cursor=document.createElement("div"),this.cursor.id="common-drag-cursor",t.appendChild(this.cursor))}if(this.lastFormatInfo=null,this.mobileCursorOffset={x:-40,y:-30},this.isManuallyTriggerZoom=!1,s.PlatformUtil.isTimQQ()){var n=window.mqq;n&&n.invoke("ui","disableLongPress",{enable:!0},(function(){}))}},e.prototype.showCursor=function(e){if(e){var t=this.contextService.context.editor,n=e.getDocumentOffset(t.zoom),o=n.x,r=n.y;this.cursor.style.display="",this.cursor.classList.add(i.a["common-drag-cursor"]),this.cursor.style.left=o+"px",this.cursor.style.top=r+"px",this.cursor.style.height=e.caretHeight()+"px"}},e.prototype.hideCursor=function(){this.cursor.style.display="none",this.cursor.classList.remove(i.a["common-drag-cursor"])},e.prototype.showPreview=function(e,t,n){var o=this.getPreviewNode(n);this.preview&&(o&&o.previewNode&&(o.previewNode.classList.add(i.a["common-wrapper-preview"]),this.preview.innerHTML="",this.preview.appendChild(o.previewNode),this.preview.style.display="block"),this.preview.style.left=e+"px",this.preview.style.top=t+"px")},e.prototype.hidePreview=function(){this.preview.style.display="none"},e.prototype.isInMaskLayer=function(e){return!1},e.prototype.onMouseMove=function(e){if(this.contextService.context.editor.isEditable()&&e&&((e instanceof TouchEvent?"touch":"mouse")===this.originEventType&&(Math.abs(e.pageX-this.originX)>10||Math.abs(e.pageY-this.originY)>10)&&!this.mouseUpState)){0;var t=this.isNodeInEditor(e.target);if(t||(this.hideCursor(),this.hidePreview()),this.draggingObject&&(t||this.isInMaskLayer(e.target))){var n=this.getXYInfo(e);n&&(this.startDrag(n),this.dealMove(n))}else this.finishDrag(!1)}},e.prototype.getSrcViewPoint=function(e){if(e.touches&&e.touches.length){var t=e.touches[0];this.selector.updateStart(t.pageX,t.pageY,t.target)}else this.selector.updateStart(e.clientX,e.clientY,e.target);return this.selector.start},e.prototype.getXYInfo=function(e){var t=null;if("touchstart"===e.type||"touchmove"===e.type){if(!e.touches||!e.touches.length)return null;var n=e.touches[0],o=Math.max(0,n.pageX+this.mobileCursorOffset.x),r=Math.max(0,n.pageY+this.mobileCursorOffset.y),i=document.elementFromPoint(o,r);t=i?{target:i,x:o,y:r}:null}else"mousedown"===e.type||"mousemove"===e.type?t={target:e.target,x:e.clientX,y:e.clientY}:"mouseup"===e.type||e.type;return t?(this.lastFormatInfo=t,t):this.lastFormatInfo},e.prototype.startDrag=function(e){if(!this.isDrag&&(this.isDrag=!0,this.enableScroll(!1),document.body.style.cursor="default",this.draggingObject)){var t=this.draggingObject;t&&t.parentNode&&this.hasClass(t.parentNode,"cropped")&&(t=t.parentNode),this.startDragerApply(),this.contextService.context.editor.fire(new o.FocusBlurNotification(o.FocusBlurNotificationType.REQUEST_BLUR),!1)}},e.prototype.finishDrag=function(e,t){(this.hideCursor(),this.hidePreview(),e&&this.isDrag&&t)&&(this.contextService.context.editor.service.getDocument().getRange(t.gcp,t.gcp+1).storyType()!==o.TDStoryType.CodeblockStory&&this.finishDragApply(this.sourceViewPoint,t));this.isDrag=!1,this.lastFormatInfo=null,this.sourceViewPoint=null,this.lastValidViewPoint=null,document.body.style.cursor="",this.enableScroll(!0),this.draggingObject=void 0},e.prototype.isShowPanel=function(){return!1},e.prototype.dealMove=function(e){if(e){var t=this.getViewRangePoint(e);if(t&&this.isValidPoint(t)){this.lastValidViewPoint=t,this.showCursor(t);var n=this.contextService.context.editor,o=t.getDocumentOffset(n.zoom),r=o.x,i=o.y;this.showPreview(r,i,this.draggingObject)}else this.lastValidViewPoint=null,this.hideCursor(),this.hidePreview()}},e.prototype.hasClass=function(e,t){return!!(e&&e.classList&&t)&&e.classList.contains(t)},e.prototype.isNodeInEditor=function(e){return!0},e.prototype.enableScroll=function(e){},e.prototype.isNodeInDocCaretsNode=function(e){return!0},e.prototype.getViewRangePoint=function(e){if(e&&e.target)return this.selector.updateStart(e.x,e.y,e.target),this.selector.start},e.prototype.showFocusStatus=function(){var e=this.contextService.context.editor;e&&e.fire(new o.FocusBlurNotification(o.FocusBlurNotificationType.REQUEST_FOCUS),!1)},e.prototype.hideFocusStatus=function(){var e=this.contextService.context.editor;e&&(e.fire(new o.PanelNotification(o.PanelNotificationType.MOBILE_PANEL_HIDE),!1),e.fire(new o.FocusBlurNotification(o.FocusBlurNotificationType.REQUEST_BLUR),!1),e.fire(new o.FocusBlurNotification(o.FocusBlurNotificationType.ON_BLUR)))},c([Object(a.l)(),l("design:type",a.f)],e.prototype,"contextService",void 0),e}()},483:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var o,r,i=n(2),a=(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});!function(e){e.UI_STATE_CHANGE="UIStateChange"}(r||(r={}));var s=function(e){function t(t){var n=e.call(this,r.UI_STATE_CHANGE)||this;return n.target=t,n}return a(t,e),t}(i.Notification)},484:function(e,t,n){"use strict";n.r(t),n.d(t,"SecondaryLoader",(function(){return du}));var o,r=n(1),i=n.n(r),a=n(11),s=n.n(a),c=n(0),l=n(245),p=n(52),u=n(291),d=n.n(u),h=(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),f=function(e){function t(t){var n=e.call(this,t)||this;return n.state={userName:"",color:"",posX:0,posY:0,caretHeight:0,visible:!1,gcp:0},n}return h(t,e),t.prototype.componentDidMount=function(){var e=this;this.fadeTimeoutId=setTimeout((function(){e.hideUserName()}),3e3)},t.prototype.updateInfo=function(e,t){this.setState({userName:e,color:t})},t.prototype.update=function(e,t){if(void 0===t&&(t=!0),t){var n=this.props.editor.service.getSelection().storyRange();if(e>=n.begin()&&e<=n.end()){var o=this.props.editor.getViewRangeFromGcpRange(new c.GCPRange(e,0));if(o){var r=o.start.getDocumentOffset(this.props.editor.zoom),i=r.x,a=r.y,s=o.start.caretHeight();this.setState({posX:i,posY:a,caretHeight:s,visible:!0,gcp:e})}else this.setState({visible:!1,gcp:e})}else this.setState({visible:!1,gcp:e});var l=this.props.editor.getViewRangeFromGcpRange(new c.GCPRange(e,0));if(l){var p=Object(c.getFollowedViewRangePoint)(l.start),u=p.getDocumentOffset(this.props.editor.zoom),d=u.x,h=u.y,f=u.docLeft,m=u.docTop,g=u.docRight,y=u.docBottom;if(d<f||d>g||h<m||h>y)this.setState({visible:!1,gcp:e});else{var v=p.caretHeight();this.setState({posX:d,posY:h,caretHeight:v,visible:!0,gcp:e})}}else this.setState({visible:!1,gcp:e})}else this.setState({visible:!1,gcp:e})},t.prototype.showUserName=function(){this.fadeTimeoutId&&clearTimeout(this.fadeTimeoutId),this.userNameRef&&this.userNameRef.classList.remove(d.a["collab-caret-name-fade-out"])},t.prototype.hideUserName=function(){this.userNameRef&&this.userNameRef.classList.add(d.a["collab-caret-name-fade-out"])},t.prototype.render=function(){var e=this;return i.a.createElement("div",{style:{visibility:this.state.visible?"visible":"hidden"}},i.a.createElement("div",{className:d.a["collab-caret-container"]+" collab-caret-container",onMouseEnter:this.showUserName.bind(this),onMouseLeave:this.hideUserName.bind(this),style:{height:this.state.caretHeight,left:this.state.posX,top:this.state.posY}},i.a.createElement("div",{className:d.a["collab-caret"],style:{background:this.state.color?this.state.color:"1e6fff"}})),i.a.createElement("div",{className:d.a["collab-caret-name"],ref:function(t){e.userNameRef=t},style:{left:this.state.posX,top:this.state.posY>=22?this.state.posY-22:this.state.posY+this.state.caretHeight,background:this.state.color?this.state.color:"1e6fff"}},this.state.userName))},t}(i.a.Component),m=n(5),g=n(2),y=n(18),v=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},b=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},C=function(){function e(e){this.contextService=e,this.editor=null,this.collabCaretComponentMap=new Map,this.isComposing=!1,this.collabCaretChangedListener=null,this.mobileInitFocus=!1,this.isFocus=!0}return e.prototype.$onInit=function(e){var t=this;this.editor=e;var n=this.contextService.context.clientVars;this.userId=n.userId,this.colorPalette=n.colorPalette,this.collabClient=this.contextService.context.collabClient,this.editor.on(l.b.ON_USER_JOIN,(function(e){var n=t.getColorById(e.userInfo.colorId);t.addCollabCaretInternal(e.userInfo.userId,e.userInfo.name,n)}),this),this.editor.on(l.b.ON_USER_LEAVE,(function(e){t.removeCollabCaret(e.userInfo.userId)}),this),this.editor.on(l.b.ON_USER_INFO_UPDATE,(function(e){var n=t.getColorById(e.userInfo.colorId);t.updateCollabCaretInfoInternal(e.userInfo.userId,e.userInfo.name,n)}),this),this.editor.on(l.b.ON_USER_CARET_UPDATE,(function(e){t.updateCollabCaretPosInternal(e.userId,e.gcp,e.isFocus)}),this),this.editor.on(c.RenderNotificationTypes.SELECTION_CHANGE,(function(e){!t.isComposing&&p.a.getInstance().isEditable&&(t.isFocus=!0,t.sendCaretUpdateMsg())}),this),this.editor.on(c.FocusBlurNotificationType.ON_BLUR,(function(e){t.isFocus=!1,t.sendCaretUpdateMsg()}),this),this.editor.on(c.HiddenEditorNotificationType.ON_COMPOSITION_START,(function(e){t.isComposing=!0}),this),this.editor.on(c.HiddenEditorNotificationType.ON_COMPOSITION_END,(function(e){t.isComposing=!1}),this),this.editor.on(c.RenderNotificationTypes.TABLE_DID_SCROLL,this.onTableScroll,this)},e.prototype.$beforeDestroy=function(){var e=this;this.editor&&(this.editor.removeListener(l.b.ON_USER_JOIN,this),this.editor.removeListener(l.b.ON_USER_LEAVE,this),this.editor.removeListener(l.b.ON_USER_INFO_UPDATE,this),this.editor.removeListener(l.b.ON_USER_CARET_UPDATE,this),this.editor.removeListener(c.RenderNotificationTypes.SELECTION_CHANGE,this),this.editor.removeListener(c.HiddenEditorNotificationType.ON_COMPOSITION_START,this),this.editor.removeListener(c.HiddenEditorNotificationType.ON_COMPOSITION_END,this),this.editor.removeListener(c.RenderNotificationTypes.TABLE_DID_SCROLL,this),this.editor.removeListener(c.FocusBlurNotificationType.ON_BLUR,this)),Array.from(this.collabCaretComponentMap.keys()).forEach((function(t){e.removeCollabCaret(t)})),this.collabCaretComponentMap.clear(),this.editor=null,this.viewRange=void 0,this.lastSendUpdateId=null,this.isComposing=!1,this.collabCaretChangedListener=null,this.mobileInitFocus=!1},e.prototype.addCollabCaretInternal=function(e,t,n){var o=this;if(this.editor){var r=this.editor.view.getDom();if(r){var a=document.createElement("div");a.id="collab-caret-"+e.replace(".","-"),r instanceof HTMLElement&&r.appendChild(a),s.a.render(i.a.createElement(f,{editor:this.editor,ref:function(t){o.collabCaretComponentMap.set(e,t)}}),a);var c=this.collabCaretComponentMap.get(e);c&&c.updateInfo(t,n)}}},e.prototype.addCollabCaret=function(e,t,n,o){this.addCollabCaretInternal(e,t,n);var r=this.collabCaretComponentMap.get(e);r&&r.update(o)},e.prototype.removeCollabCaret=function(e){if(this.editor){var t=this.editor.view.getDom();if(t){var n=t.querySelector("#collab-caret-"+e.replace(".","-"));if(n)try{t.removeChild(n)}catch(e){g.Logger.error("collab caret already removed, "+e)}}}this.collabCaretComponentMap.delete(e)},e.prototype.updateCollabCaretInfoInternal=function(e,t,n){var o=this.collabCaretComponentMap.get(e);o?o.updateInfo(t,n):this.addCollabCaretInternal(e,t,n)},e.prototype.updateCollabCaretPosInternal=function(e,t,n){if(e&&e!==this.userId){var o=this.collabCaretComponentMap.get(e);if(o)o.update(t,n);else{var r=this.collabClient;if(r){var i=r.getUserInfo(e);i&&(this.addCollabCaretInternal(e,i.name,i.colorId),(o=this.collabCaretComponentMap.get(e))&&o.update(t,n))}}}},e.prototype.updateCollabCaret=function(e,t,n,o){var r=this.collabCaretComponentMap.get(e);r?(r.updateInfo(t,n),r.update(o)):this.addCollabCaret(e,t,n,o)},e.prototype.onCollabCaretChanged=function(e){this.collabCaretChangedListener=e},e.prototype.sendCaretUpdateMsg=function(){var e=this;this.lastSendUpdateId&&clearTimeout(this.lastSendUpdateId),this.lastSendUpdateId=setTimeout((function(){e.didSendCaretUpdateMsg(),e.lastSendUpdateId=null}),1e3)},e.prototype.didSendCaretUpdateMsg=function(){if(this.editor){var e=this.editor.viewSelection.getViewRange();if(!this.isFocus&&e){if(this.userId)(t=this.collabClient)&&t.sendCaretUpdateMesage({userId:this.userId,gcp:e.start.gcp,isFocus:this.isFocus})}else if(e&&this.valid(e)){var t;if(this.collabCaretChangedListener&&this.collabCaretChangedListener(e.start.gcp),this.userId)(t=this.collabClient)&&t.sendCaretUpdateMesage({userId:this.userId,gcp:e.start.gcp,isFocus:this.isFocus});this.viewRange=e}}},e.prototype.valid=function(e){return!!e&&(!this.viewRange||(e.start.gcp!==this.viewRange.start.gcp||e.start.getDocumentOffset()!==this.viewRange.start.getDocumentOffset()))},e.prototype.getColorById=function(e){var t="#1e6fff";return void 0!==e&&this.colorPalette&&(t=this.colorPalette[e%this.colorPalette.length]),t},e.prototype.onTableScroll=function(e){if(this.editor&&this.editor.isEditable()){var t=e.firstIndex,n=this.editor.getRangeFromIndex(t,t),o=this.editor.service.getDocument().getTableFromGcp(n.gcpBegin);o&&o.range&&this.collabCaretComponentMap.forEach((function(e){e&&o.range.contains(e.state.gcp)&&e.update(e.state.gcp)}))}},e=v([Object(m.i)({name:y.a.CollabCaret,scope:0,for:["melo"]}),b("design:paramtypes",[m.f])],e)}(),_=n(10),w=n.n(_),R=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{c(o.next(e))}catch(e){i(e)}}function s(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))},S=function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},E=function(){function e(){}return e.cloneDoc=function(e,t){return R(this,void 0,void 0,(function(){var n,o,r,i;return S(this,(function(a){return n=e.globalPadId,o=n.indexOf("$"),r=n.slice(0,o),i=n.slice(o+1,n.length),[2,new Promise((function(e,n){w.a.ajax({url:"/cgi-bin/online_docs/createdoc_new",type:"post",async:!0,timeout:3e4,data:{title:"副本-"+t,create_type:4,domain_id:r,pad_id:i,xsrf:Object(c.getXsrf)()},success:function(t){0!==t.retcode?n(t):e(t)},error:function(){n()}})}))]}))}))},e.saveAsTemplate=function(e,t){return R(this,void 0,void 0,(function(){return S(this,(function(n){return[2,new Promise((function(n,o){w.a.ajax({url:"/cgi-bin/template/mytemplate_add",type:"POST",data:{domain_id:e.domainId,pad_id:e.padId,title:t,xsrf:Object(c.getXsrf)()},xhrFields:{withCredentials:!0},success:function(e){e&&0===e.retcode?n():(42114===e.retcode?o("文件大于100KB，暂不支持保存为模板"):42113===e.retcode?o("模板已达上限，保存模板失败"):42112===e.retcode&&o("暂无权限访问文档，保存模板失败"),o("网络异常，保存模板失败"))},error:function(){o("网络异常，保存模板失败")}})}))]}))}))},e.report=function(e){return R(this,void 0,void 0,(function(){return S(this,(function(t){return[2,new Promise((function(t,n){w.a.ajax({url:"https://docs.qq.com/cgi-bin/online_docs/support_gettoken",type:"POST",data:{xsrf:Object(c.getXsrf)(),domain_id:e.domainId,pad_id:e.padId,dataType:"form"===e.padType?1:0},success:function(e){0===e.retcode&&e.token.length>0?t(e.token):n("请求失败，请稍后尝试。")},error:function(){n("请求失败，请稍后尝试。")}})}))]}))}))},e}(),T=n(30),P=n.n(T),I=(n(51),function(){return(I=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)}),x=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},O=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},L=function(){function e(e){var t={left:0,right:0,top:0,bottom:0};e.float({name:"support-mask",component:i.a.createElement("div",{id:"support_mask",style:I({display:"none",backgroundColor:"#000000",opacity:.2,position:"fixed",zIndex:6007},t)})}),e.float({name:"support-container",component:i.a.createElement("div",{id:"supportFrame-container",style:I({display:"none",width:381,height:331,margin:"auto",position:"absolute",zIndex:9007},t)})})}return e.prototype.report=function(e){var t=this;E.report(e).then((function(n){var o=e.userInfo.wx_openid,r=e.userInfo.uin||o,i="https://jubao.qq.com/uniform_impeach/tc_document_entry?token="+encodeURIComponent(n)+"&scene=6001&openid="+r;var a=document.getElementById("supportFrame-container"),s=document.createElement("iframe");s.src=i,s.style.width="100%",s.style.height="100%",s.style.border="none",a.appendChild(s),document.getElementById("support_mask").style.display="block",a.style.display="block",window.addEventListener("message",(function(e){try{if(e&&e.data){var n=e.data;"string"==typeof e.data&&(n=JSON.parse(e.data)),n&&"jubao"===n.from&&"jubao_close"===n.cmd&&(document.getElementById("support_mask").style.display="none",document.getElementById("supportFrame-container").style.display="none",document.getElementById("supportFrame-container").innerHTML="")}}catch(e){t.logger.error(" jubao message error ",e)}}),!1)})).catch((function(){P.a.show({message:"请求失败，请稍后尝试。",duration:3e3,autoClose:!0})}))},x([Object(m.q)(),O("design:type",m.r)],e.prototype,"logger",void 0),e}(),M=n(12),N=n(90),A=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},D=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},k=function(){function e(){}return e.prototype.checkCloneTips=function(){var e=Object(M.c)();if(("1"===Object(g.getUrlParameter)("newPad")||e&&e.newPad)&&("clone"===Object(g.getUrlParameter)("newPadType")||e&&"clone"===e.newPadType))try{var t=document.location.href.split("?")[0]+this.removeNewPadTypeParameter(this.removeNewPadParameter(window.location.search))+window.location.hash;history.replaceState(null,"",t)}catch(e){}},e.prototype.clone=function(e){var t=this.store.getValue("docTitle"),n={isFinished:!1,title:"副本-"+t,iconType:e.padType,tips:"正在生成副本..."};localStorage.setItem("jump_generatecopy",JSON.stringify(n));var o=!g.PlatformUtil.isWXMiniProgram()||!1;o?Object(g.openLink)("//docs.qq.com/scenario/jumppage.html?type=generatecopy"):P.a.show({message:"生成副本中，请稍候...",duration:5e3,autoClose:!0}),E.cloneDoc(e,t).then((function(n){var r=n.doc_url+"?newPad=1&newPadType=clone",i={isFinished:!0,title:"副本-"+t,iconType:e.padType,retcode:n.retcode,url:r};if(localStorage.setItem("jump_generatecopy",JSON.stringify(i)),!o){var a=n.doc_url.replace("/","/");if(a=a.startsWith("https://")?a:"https:"+a,a=N.a.updateQueryStringParameter(a,{newPad:1,newPadType:"clone"}),g.PlatformUtil.isWXMiniProgram())return void window.wx.miniProgram.redirectTo({url:"/pages/detail/detail?url="+encodeURIComponent(a)});if(window.mqq)return void window.mqq.ui.openUrl({url:a,target:0,style:3});Object(g.openLink)(a)}})).catch((function(n){var o={isFinished:!0,title:"副本-"+t,iconType:e.padType,retcode:n.retcode||-1,failImg:{src:"generator_fail"},tips:"生成副本失败，请稍后重试。"};localStorage.setItem("jump_generatecopy",JSON.stringify(o))})),c.ReportHelper.tdwReport({opername:"doc_word_editor",module:"copy",action:"clk_save"})},e.prototype.removeNewPadParameter=function(e){return e.replace(/(^\?|&)newPad=[^&]*(&)?/g,(function(e,t,n){return"?"===t||n?t:""}))},e.prototype.removeNewPadTypeParameter=function(e){return e.replace(/(^\?|&)newPadType=[^&]*(&)?/g,(function(e,t,n){return"?"===t||n?t:""}))},A([Object(m.l)(),D("design:type",m.x)],e.prototype,"store",void 0),e}(),j=n(336),F=n(36),H=n.n(F),B=n(265),U=n.n(B),V=n(63),W=n.n(V),G=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)a.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return a};var z=function(e){var t=e.defaultValue,n=e.onClose,o=e.onConfirm,a=G(Object(r.useState)(""),2),s=a[0],c=a[1],l=G(Object(r.useState)(t),2),p=l[0],u=l[1];return i.a.createElement("div",{style:{width:"100%"}},i.a.createElement(U.a,{value:p,inputStyle:s?{borderColor:"#ef4e2f"}:{},onChange:function(e){if(function(e){var t;return(null!==(t=e.match(/(:|：|\*|\\|\/|<|>|"|\?|\||(\ud83c[\udf00-\udfff])|(\ud83d[\udc00-\ude4f])|(\ud83d[\ude80-\udeff]))/,"ig"))&&void 0!==t?t:[]).length}(e)||function(e){var t;return(null!==(t=e.match(/(?:[\u2700-\u27bf]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff]|[\u0023-\u0039]\ufe0f?\u20e3|\u3299|\u3297|\u303d|\u3030|\u24c2|\ud83c[\udd70-\udd71]|\ud83c[\udd7e-\udd7f]|\ud83c\udd8e|\ud83c[\udd91-\udd9a]|\ud83c[\udde6-\uddff]|\ud83c[\ude01-\ude02]|\ud83c\ude1a|\ud83c\ude2f|\ud83c[\ude32-\ude3a]|\ud83c[\ude50-\ude51]|\u203c|\u2049|[\u25aa-\u25ab]|\u25b6|\u25c0|[\u25fb-\u25fe]|\u00a9|\u00ae|\u2122|\u2139|\ud83c\udc04|[\u2600-\u26FF]|\u2b05|\u2b06|\u2b07|\u2b1b|\u2b1c|\u2b50|\u2b55|\u231a|\u231b|\u2328|\u23cf|[\u23e9-\u23f3]|[\u23f8-\u23fa]|\ud83c\udccf|\u2934|\u2935|[\u2190-\u21ff])/g))&&void 0!==t?t:[]).length>0}(e))return u(e),void c("模板名称非法");(function(e){var t,n=0,o=0,r=e.length;for(o=0;o<r;o++)n+=(t=e.charCodeAt(o))<=127?1:t<=2047?2:t<=65535?3:4;return n})(e)<=36&&u(e),c("")}}),s?i.a.createElement("span",{style:{color:"#ef4e2f",marginTop:10}},s):null,i.a.createElement("div",{style:{display:"flex",marginTop:24}},i.a.createElement(H.a,{style:{marginRight:16,marginLeft:"auto"},onClick:n},"取消"),i.a.createElement(H.a,{type:"primary",disabled:""===p,onClick:function(){o(p)}},"确定")))};var K,q=n(335),Z=n.n(q),Q=function(){function e(e){this.slr=e}return e.prototype.importFile=function(e){var t=this;this.showFileBrowser((function(n){if(w()("#import-file-container").length)w()("#import-file-container").show();else{var o=w()('<div id="import-file-container" class="'+Z.a["import-file-dialog-container"]+'"></div>');w()("body").append(o)}t.slr.load("ImportFile",(function(t){t.show(document.getElementById("import-file-container"),{file:n[0],userDomain:e.userDomain,onClose:function(){w()("#import-file-container").hide()}})}))}));var n=localStorage.getItem("tdsourcetag");c.ReportHelper.tdwReport({opername:"doc_impexp",module:"doc_imp",action:"start",source3:""+n})},e.prototype.showFileBrowser=function(e){var t=this;w()("#_importFile").remove();var n=document.createElement("input");if(n.setAttribute("id","_importFile"),n.setAttribute("type","file"),n.setAttribute("style","display:none"),"undefined"!=typeof external&&void 0!==external.nativeCall)n.setAttribute("accept","*.*");else{n.setAttribute("accept","application/msword,application/vnd.ms-excel,application/vnd.ms-powerpoint,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.openxmlformats-officedocument.presentationml.presentation,text/plain,.xlsx,.xls,.doc,.docx,.csv,.txt,.ppt,.pptx,.pdf,application/pdf")}document.body.appendChild(n),w()(n).change((function(n){var o=n.target.files[0],r=o;if(navigator.userAgent.indexOf("MSIE")>0&&window.ActiveXObject)try{var i=window.ActiveXObject?new ActiveXObject("Scripting.FileSystemObject"):{};r=i.GetFile(o)||o}catch(e){g.Logger.error(e)}function a(){try{c.ReportHelper.tdwReport({opername:"doc_import",module:"import_fail",action:"count",obj2:location.href,obj3:2,ver1:"0",ver2:(/\.([^.]*)$/.exec(r.name)||[])[1]||"",ver3:"notSupport",file_type:{doc:1,xls:2,txt:3,csv:4}[(/\.([^.]{3})[^.]*$/.exec((""+r.name).toLowerCase())||[])[1]]||""})}catch(e){}}if(r&&r.name){var s=t.checkFileSize(o);if(s<=0)return P.a.show({message:"导入失败，不能导入空文件。",autoClose:!0,duration:3e3}),void a();var l=20;if(/.*\.(ppt|pptx|pdf)$/i.test(r.name)&&(l=100),s/1048576>=l)return P.a.show({message:"导入失败，文件大小超过"+l+"MB。",autoClose:!0,duration:3e3}),void a();if(!/.*\.(doc|docx|xls|xlsx|txt|csv|ppt|pptx|pdf)$/i.test(r.name))return P.a.show({message:"导入失败，仅支持 doc/docx/xls/xlsx/ppt/pptx/txt/csv/pdf 格式的文件。",autoClose:!0,duration:3e3}),void a();e(n.target.files)}})),n.click()},e.prototype.checkFileSize=function(e){var t=0;if(e&&e.size)t=e.size;else if(navigator.userAgent.indexOf("MSIE")>0&&window.ActiveXObject){t=new ActiveXObject("Scripting.FileSystemObject").GetFile(e).size}return t},e}(),X=n(109),Y=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},J=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},ee=function(){function e(e,t,n){this.workbench=t,this.slr=this.scriptLoaderService.getScriptLoader(),this.reportService=new L(e),this.cloneCtrl=new k,this.importService=new Q(this.slr),this.context=n.context}return e.prototype.$onInit=function(){var e=this;this.cloneCtrl.checkCloneTips(),this.workbench.listen("$requestFeedback",(function(t){var n=e.context.clientVars;e.goFeedbackPage(n,t)}))},e.prototype.goFeedbackPage=function(e,t){var n=j.a.getClientInfo(e);n.customInfo=window.location.href+"  errCode/"+t;var o=document.createElement("form");o.id="form",o.name="form",o.style.display="none",o.setAttribute("target",g.PlatformUtil.isTencentDocsPC()||g.PlatformUtil.isWXMiniProgram()||g.PlatformUtil.isWXFamily()?"_self":"_blank"),document.body.appendChild(o),Object.keys(n).forEach((function(e){var t=document.createElement("input"),r=n[e];t.type="text",t.name=e,t.value=r,o.appendChild(t)})),o.method="POST",o.action="https://support.qq.com/product/28096",o.submit(),document.body.removeChild(o)},e.prototype.saveAsTemplate=function(e,t){!function(e,t){var n,o=function(e){var t,n=0,o=0,r=e.length;for(o=0;o<r&&!((n+=(t=e.charCodeAt(o))<=127?1:t<=2047?2:t<=65535?3:4)>36);o++);return e.substring(0,o)}(e);n=W.a.confirm({title:"保存为我的模板",style:{width:376},content:i.a.createElement(z,{defaultValue:o,onClose:function(){n.close()},onConfirm:function(e){E.saveAsTemplate(t,e).then((function(){P.a.show({type:"info",autoClose:!0,message:"模板保存成功，在[新建-我的模板]中。",action:"查看",onClickAction:function(){window.open("https://docs.qq.com/desktop/templates-list.html?padtype=3")},duration:5e3})})).catch((function(e){P.a.show({type:"error",autoClose:!0,message:e,duration:5e3})})),n.close()}}),footer:null})}(e,t)},Y([Object(m.l)(),J("design:type",X.a)],e.prototype,"scriptLoaderService",void 0),e=Y([Object(m.i)({name:y.a.FileBase,scope:1}),J("design:paramtypes",[m.A,m.B,m.f])],e)}(),te=function(){function e(e,t){this.slr=t,this.widgetService=e,e.float({name:"transfer-auth",component:i.a.createElement("div",{id:"transfer-auth-container",style:{display:"none"}}),styles:{left:0,right:0,bottom:0,top:0}})}return e.prototype.showTransferAuth=function(e){var t=this,n=e.userId&&e.userId.replace(/^p\./,""),o=function(t){var o=document.getElementById("transfer-auth-container");o.style.display="block",t.show(o,{creatorDomain:e.creatorDomain,domainId:e.domainId,padId:e.padId,userId:n,onClose:function(){t.remove(),o.style.display="none"}})};this.transferModule?o(this.transferModule):this.slr.load("TransferAuth",(function(e){t.transferModule=e,o(e)}))},e.prototype.destroy=function(){this.widgetService&&(this.widgetService.remove("transfer-auth","float"),this.widgetService=void 0),this.transferModule=null},e}(),ne=[{name:"help-center",content:"帮助与反馈",respectOffline:!0},{name:"clone",content:"生成副本",respectOffline:!0,shouldDisabled:function(e){return!(e.permission&&e.permission.canCopyDoc)},onClick:function(e,t){var n=e.clientVars;t.clone(n)}},{name:"shortcut",content:"生成本地快捷方式",respectOffline:!0,onClick:function(e,t){t.createShortcut()}},{name:"feedback",content:"吐个槽",respectOffline:!0,onClick:function(e,t){var n=e.clientVars;t.goFeedbackPage(n)}},{name:"faq",content:"帮助中心",respectOffline:!0,onClick:function(e,t){t.openLink("https://kf.qq.com/product/txwd.html")}},{name:"about",content:"功能介绍",respectOffline:!0,onClick:function(e,t){t.openLink("https://docs.qq.com/doc/BqI21X2yZIht1Wa5TS2EGjbB05QQLU3t4SFA0D4QyU1D8UAQ0IQmKC2Cjyb92Epx2w1QB96n17FEoB312GIY0?pub=1&dver=2.1.0")}},{name:"report",content:"举报",respectOffline:!0,onClick:function(e,t){var n=e.clientVars;t.report(n)}},{name:"change-owner",content:"转让文档所有权",respectOffline:!0,shouldDisabled:function(e){return!e.clientVars.isCreator},onClick:function(e,t){var n=e.clientVars;t.showTransferAuth(n)}},{name:"save-as-template",content:"保存为我的模板",shouldDisabled:function(e){return!(e.permission&&e.permission.canCopyDoc)},respectOffline:!0,onClick:function(e,t){var n=e.clientVars;t.saveAsTemplate(n)}},{name:"new",content:"新建",respectOffline:!0,preventDismiss:!0},{name:"new-doc",content:"在线文档",onClick:function(e,t){t.openTemplateList("doc")}},{name:"new-sheet",content:"在线表格",onClick:function(e,t){t.openTemplateList("sheet")}},{name:"new-ppt",content:"在线幻灯片",onClick:function(e,t){t.openTemplateList("ppt")}},{name:"new-form",content:"在线收集表",onClick:function(e,t){t.openTemplateList("form")}},{name:"new-folder",content:"新建文件夹",onClick:function(e,t){t.createNewFolder("/")}},{name:"import-file",content:"导入本地文件",onClick:function(e,t){var n=e.clientVars;t.importFile(n)}},{name:"rename",content:"重命名",respectOffline:!0,shouldDisabled:function(e){return!(e.permission&&e.permission.canEditTitle)},onClick:function(){var e=document.getElementById("melo-doc-title");e.focus(),e.setSelectionRange(0,e.value.length)},preventFocus:!0}],oe=[{keyBindings:{win:c.KeyAssist.CTRL_WIN+c.KeyCode.S,mac:c.KeyAssist.COMMAND+c.KeyCode.S},callback:function(){}}],re=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},ie=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},ae=function(){function e(e,t,n){this.fileBase=e,this.widgetService=t,this.store=n,this.slr=this.scriptLoaderService.getScriptLoader()}return e.prototype.$onInit=function(){this.transferAuthCtrl=new te(this.widgetService,this.slr)},e.prototype.$beforeDestroy=function(){this.transferAuthCtrl.destroy()},e.prototype.clone=function(e){this.fileBase.cloneCtrl.clone(e)},e.prototype.createShortcut=function(){var e=this.store.getValue("docTitle"),t={url:window.location.href.replace("previewtip=1",""),fname:e,sheet:!1},n=JSON.stringify(t);n=encodeURIComponent(n),window.location.href="https://docs.qq.com/preview/link.url?info="+n,c.ReportHelper.tdwReport({opername:"doc_word_editor",module:"save_as",action:"save_as_shortcut"})},e.prototype.openLink=function(e){return Object(g.openLink)(e)},e.prototype.goFeedbackPage=function(e,t){this.fileBase.goFeedbackPage(e,t)},e.prototype.report=function(e){this.fileBase.reportService.report(e)},e.prototype.showTransferAuth=function(e){this.transferAuthCtrl.showTransferAuth(e)},e.prototype.saveAsTemplate=function(e){var t=this.store.getValue("docTitle");this.fileBase.saveAsTemplate(t,e),c.ReportHelper.tdwReport({opername:"doc_word_editor",module:"save_as",action:"save_as_templet"})},e.prototype.openTemplateList=function(e){var t;switch(e){case"doc":t=0;break;case"sheet":t=1;break;case"form":t=2;break;case"my":t=3;break;case"ppt":t=4;break;default:t=0}var n="https://docs.qq.com/desktop/templates-list.html?padtype="+t;Object(g.openLink)(n)},e.prototype.createNewFolder=function(e){var t="";t=""!==e&&"/"!==e?"https://docs.qq.com/desktop/folder/"+e+"?opennewfolder="+(new Date).getTime():"https://docs.qq.com/desktop/?opennewfolder="+(new Date).getTime(),Object(g.openLink)(t)},e.prototype.importFile=function(e){this.fileBase.importService.importFile(e)},re([Object(m.l)(),ie("design:type",X.a)],e.prototype,"scriptLoaderService",void 0),e=re([Object(m.i)({name:y.a.FilePc,scope:1,menuItems:ne,keymap:oe}),ie("design:paramtypes",[ee,m.A,m.x])],e)}(),se=n(488);!function(e){e[e.SEARCH_TAP=1]="SEARCH_TAP",e[e.REPLACE_TAP=2]="REPLACE_TAP"}(K||(K={}));var ce,le=n(294),pe=n.n(le),ue=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),de=function(e){function t(t){var n=e.call(this,t)||this;return n.searchInput=null,n.replaceInputSrc=null,n.replaceInputDst=null,n.searchLastTime=0,n.ref=null,n.mouseDown=!1,n.startLeft=0,n.startTop=0,n.startX=0,n.startY=0,n.maxLeft=0,n.maxTop=0,n.offsetLeft=0,n.offsetTop=0,n.state={searchTarget:"",searchCount:-1,selectedIndex:-1,replaceDst:"",visible:!1,tap:K.SEARCH_TAP,requestFocus:!1},n.mouseupHandler=n.onMouseUp.bind(n),n.mousemoveHandler=n.onMouseMove.bind(n),n}return ue(t,e),t.prototype.setRef=function(e){this.ref=e},t.prototype.componentDidMount=function(){var e;document.body.addEventListener("mousemove",this.mousemoveHandler),document.body.addEventListener("mouseup",this.mouseupHandler);var t=null===(e=document.getElementById("workbench-float-widgets"))||void 0===e?void 0:e.getBoundingClientRect();this.offsetLeft=(null==t?void 0:t.left)||0,this.offsetTop=(null==t?void 0:t.top)||0},t.prototype.componentWillUnmount=function(){document.body.removeEventListener("mousemove",this.mousemoveHandler),document.body.removeEventListener("mouseup",this.mouseupHandler)},t.prototype.componentDidUpdate=function(e,t){this.state.visible&&(t.visible?t.tap===K.REPLACE_TAP&&this.state.tap===K.SEARCH_TAP?this.focusSearhInput():t.tap===K.SEARCH_TAP&&this.state.tap===K.REPLACE_TAP?this.focusReplaceInput():this.state.requestFocus&&(this.state.tap===K.SEARCH_TAP?this.focusSearhInput():this.state.tap===K.REPLACE_TAP&&this.focusReplaceInput(),this.setState({requestFocus:!1})):(this.ref&&(this.ref.style.left=window.innerWidth-386-this.offsetLeft+"px",this.ref.style.top="10px"),this.state.tap===K.SEARCH_TAP?this.focusSearhInput():this.state.tap===K.REPLACE_TAP&&this.focusReplaceInput()))},t.prototype.focusSearhInput=function(){this.searchInput&&(this.searchInput.selectionStart=this.searchInput.value.length,this.searchInput.selectionEnd=this.searchInput.value.length,this.searchInput.focus())},t.prototype.focusReplaceInput=function(){this.replaceInputSrc&&(this.replaceInputSrc.selectionStart=this.replaceInputSrc.value.length,this.replaceInputSrc.selectionEnd=this.replaceInputSrc.value.length,this.replaceInputSrc.focus())},t.prototype.onMouseDown=function(e){if(this.ref){this.mouseDown=!0;var t=this.ref.getBoundingClientRect(),n=t.width,o=t.height,r=e.clientX,i=e.clientY;this.startLeft=parseInt(this.ref.style.left,10),this.startTop=parseInt(this.ref.style.top,10),this.startX=r,this.startY=i,this.maxLeft=window.innerWidth-n-this.offsetLeft,this.maxTop=window.innerHeight-o-this.offsetTop}},t.prototype.onMouseMove=function(e){if(this.mouseDown&&this.ref){var t=e.clientX,n=e.clientY,o=this.startLeft+t-this.startX,r=this.startTop+n-this.startY;o=Math.min(Math.max(0,o),this.maxLeft),r=Math.min(Math.max(0,r),this.maxTop),this.ref.style.left=o+"px",this.ref.style.top=r+"px"}},t.prototype.onMouseUp=function(){this.mouseDown=!1},t.prototype.switchSearchTap=function(e){e.stopPropagation(),this.setState({tap:K.SEARCH_TAP}),c.ReportHelper.tdwReport({opername:"doc_word_editor",module:"find",action:"find_tab_show"})},t.prototype.switchReplaceTap=function(e){e.stopPropagation(),this.setState({tap:K.REPLACE_TAP}),c.ReportHelper.tdwReport({opername:"doc_word_editor",module:"replace",action:"replace_tab_show"})},t.prototype.onTextChangeSearch=function(e){this.setState({searchTarget:e.target.value});var t=e.target.value;this.search(t)},t.prototype.search=function(e){var t=this;Date.now()-this.searchLastTime<500&&this.searchId&&clearTimeout(this.searchId),this.searchLastTime=Date.now(),this.searchId=setTimeout((function(){t.didSearch(e)}),500)},t.prototype.didSearch=function(e){e.length>0?this.props.handler.search(e):(this.setState({searchCount:-1}),this.props.handler.clearResult())},t.prototype.onTextChangeReplaceDst=function(e){this.setState({replaceDst:e.target.value})},t.prototype.onPrevClick=function(){this.props.handler.selectPrev(),this.state.tap===K.SEARCH_TAP?c.ReportHelper.tdwReport({opername:"doc_word_editor",module:"find",action:"find_last"}):c.ReportHelper.tdwReport({opername:"doc_word_editor",module:"replace",action:"replace_last"})},t.prototype.onNextClick=function(){this.props.handler.selectNext(),this.state.tap===K.SEARCH_TAP?c.ReportHelper.tdwReport({opername:"doc_word_editor",module:"find",action:"find_next"}):c.ReportHelper.tdwReport({opername:"doc_word_editor",module:"replace",action:"replace_next"})},t.prototype.onReplaceClick=function(){if(this.replaceInputDst){var e=this.replaceInputDst.value;this.props.handler.replace(e)}},t.prototype.onReplaceAllClick=function(){if(this.replaceInputDst){var e=this.replaceInputDst.value;this.props.handler.replaceAll(e)}},t.prototype.onKeyDown=function(e){13===e.keyCode&&this.props.handler.selectNext()},t.prototype.close=function(){this.props.handler.hideSearchDialog()},t.prototype.render=function(){var e=this,t=this.state.searchCount>=0?this.state.selectedIndex>=0?this.state.selectedIndex+1+"/"+this.state.searchCount:""+this.state.searchCount:"",n=this.state.searchCount>0?"":" img-disabled",o=p.a.getInstance().isEditable;return i.a.createElement("div",{className:pe.a["search-replace-container"],ref:this.setRef.bind(this),onKeyDown:this.onKeyDown.bind(this),tabIndex:0,style:{display:this.state.visible?"block":"none"}},i.a.createElement("div",{className:pe.a["search-replace-tab-container"],onMouseDown:this.onMouseDown.bind(this)},i.a.createElement("li",{className:pe.a["search-replace-tab-li"],onClick:this.switchSearchTap.bind(this),style:{color:this.state.tap===K.SEARCH_TAP?"#1e6fff":"#8c8c8c",borderBottom:this.state.tap===K.SEARCH_TAP?"2px solid #1e6fff":"none"}},"查找"),o?i.a.createElement("li",{className:pe.a["search-replace-tab-li"],onClick:this.switchReplaceTap.bind(this),style:{color:this.state.tap===K.REPLACE_TAP?"#1e6fff":"#8c8c8c",borderBottom:this.state.tap===K.REPLACE_TAP?"2px solid #1e6fff":"none"}},"替换"):null),i.a.createElement("div",{className:pe.a["search-replace-close"],onClick:this.close.bind(this)}),i.a.createElement("div",{className:pe.a["search-replace-content-container"]},i.a.createElement("div",{id:"search-tab-content",className:pe.a["search-tab-content"],style:{display:this.state.tap===K.SEARCH_TAP?"block":"none"}},i.a.createElement("div",{className:pe.a["search-input-wraper"]},i.a.createElement("input",{id:"search-input",className:pe.a["search-replace-input"],placeholder:"输入查找内容",ref:function(t){e.searchInput=t},value:this.state.searchTarget,onChange:this.onTextChangeSearch.bind(this)}),i.a.createElement("div",{className:pe.a["search-count-info1"]+" "+pe.a["search-count-info"]},t)),i.a.createElement("div",{className:pe.a["search-button-container"]},i.a.createElement("button",{id:"search-prev-button",className:pe.a["search-replace-button"],disabled:this.state.searchCount<=0,onClick:this.onPrevClick.bind(this)},i.a.createElement("div",{className:"prev-button-image"+n}),i.a.createElement("span",{className:pe.a["search-button-text"]},"上一个")),i.a.createElement("button",{id:"search-next-button",className:pe.a["search-replace-button"],disabled:this.state.searchCount<=0,onClick:this.onNextClick.bind(this)},i.a.createElement("span",{className:pe.a["search-button-text"]},"下一个"),i.a.createElement("div",{className:"next-button-image"+n})))),o?i.a.createElement("div",{id:"replace-tab-content",className:pe.a["search-tab-content"],style:{display:this.state.tap===K.REPLACE_TAP?"block":"none"}},i.a.createElement("div",{className:pe.a.info},"查找替换项"),i.a.createElement("div",{className:pe.a["search-input-wraper"]},i.a.createElement("input",{id:"replace-input-src",className:pe.a["search-replace-input"],placeholder:"输入查找内容",ref:function(t){e.replaceInputSrc=t},value:this.state.searchTarget,onChange:this.onTextChangeSearch.bind(this)}),i.a.createElement("div",{className:pe.a["search-count-info2"]+" "+pe.a["search-count-info"]},t)),i.a.createElement("div",{className:pe.a.info2},"替换为"),i.a.createElement("input",{id:"replace-input-dst",className:pe.a["search-replace-input"],placeholder:"输入替换内容",ref:function(t){e.replaceInputDst=t},value:this.state.replaceDst,onChange:this.onTextChangeReplaceDst.bind(this)}),i.a.createElement("div",{className:pe.a["search-button-container2"]},i.a.createElement("button",{id:"replace-prev-button",className:pe.a["search-replace-button"],disabled:this.state.searchCount<=0,onClick:this.onPrevClick.bind(this)},i.a.createElement("div",{className:"prev-button-image"+n}),i.a.createElement("span",{className:pe.a["search-button-text"]},"上一个")),i.a.createElement("button",{id:"replace-next-button",className:pe.a["search-replace-button"],disabled:this.state.searchCount<=0,onClick:this.onNextClick.bind(this)},i.a.createElement("span",{className:pe.a["search-button-text"]},"下一个"),i.a.createElement("div",{className:"next-button-image"+n})),i.a.createElement("button",{id:"replace-button",className:pe.a["search-replace-button"],disabled:this.state.searchCount<=0,onClick:this.onReplaceClick.bind(this)},"替换"),i.a.createElement("button",{id:"replace-all-button",className:pe.a["search-replace-button"],disabled:this.state.searchCount<=0,onClick:this.onReplaceAllClick.bind(this)},"全部替换"))):null))},t}(i.a.Component),he=(n(165),function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}()),fe=function(){return(fe=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},me=function(e){function t(t,n,o){var r=e.call(this,t,n,o)||this;return r.left=t,r.width=n,r.height=o,r}return he(t,e),t.prototype.style=function(){return fe(fe({},e.prototype.style.call(this)),{position:"absolute",top:"0",backgroundColor:"#f2e200",opacity:.5,zIndex:10})},t}(c.LineOverlayStyle),ge=function(e){function t(t,n){var o=e.call(this)||this;return o.editor=t,o.layoutChanged=n,o.searchRanges=[],o.editor.addLineOverlay(o),o}return he(t,e),t.prototype.onSearchResult=function(e){this.searchRanges=e,this.notifyUpdate()},t.prototype.getRanges=function(){return this.searchRanges},t.prototype.reset=function(){this.searchRanges=[]},t.prototype.getClassName=function(){return"melo-search-overlay"},t.prototype.onLayoutChanged=function(){this.layoutChanged()},t.prototype.checkOverlay=function(e,t,n){var o=[],r=this.searchRanges;if(r.length>0){var i=this.editor.getRangeFromIndex(e.firstIndex,e.lastIndex),a=Object(c.binarySearchStart)(i.begin(),i.end(),0,r.length-1,r);if(-1!==a){var s=Object(c.binarySearchEnd)(i.begin(),i.end(),a,r.length-1,r);if(-1!==s)for(var l=a;l<=s;l++){var p=r[l],u=this.styleFromRange(p,i.begin(),i.end(),t,n);u&&o.push(u)}}}return o},t.prototype.styleFromRange=function(e,t,n,o,r){var i=this.editor.getViewRangeFromGcpRange(e);if(!i)return null;var a=0,s=0;if(e.begin()<t&&e.end()>n)s=o;else if(e.begin()>=t&&e.end()<=n){a=i.start.linePosOffset(this.zoom);var c=i.end.linePosOffset(this.zoom);s=(c=c>0?c:o)-a}else e.begin()<t&&e.end()>t?s=i.end.linePosOffset(this.zoom):e.begin()<n&&e.end()>n&&(s=o-(a=i.start.linePosOffset(this.zoom)));return s>0?new me(a+"px",s+"px",r+"px"):null},t}(c.BaseLineOverlay),ye=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),ve=function(){return(ve=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},be=function(e){function t(t,n,o){var r=e.call(this,t,n,o)||this;return r.left=t,r.width=n,r.height=o,r}return ye(t,e),t.prototype.style=function(){return ve(ve({},e.prototype.style.call(this)),{position:"absolute",top:"0",backgroundColor:"#f1b900",opacity:1,zIndex:11})},t}(c.LineOverlayStyle),Ce=function(e){function t(t){var n=e.call(this)||this;return n.editor=t,n.searchSelectedRanges=[],n.editor.addLineOverlay(n),n}return ye(t,e),t.prototype.onSearchSelected=function(e){this.searchSelectedRanges=e},t.prototype.getRanges=function(){return this.searchSelectedRanges},t.prototype.reset=function(){this.searchSelectedRanges=[]},t.prototype.getClassName=function(){return"melo-search-selected-overlay"},t.prototype.onLayoutChanged=function(){},t.prototype.checkOverlay=function(e,t,n){var o=[];if(this.searchSelectedRanges&&this.searchSelectedRanges[0]){var r=this.searchSelectedRanges[0],i=this.editor.getRangeFromIndex(e.firstIndex,e.lastIndex);if(r.begin()>=i.begin()&&r.begin()<=i.end()||r.end()>=i.begin()&&r.end()<=i.end()){var a=this.styleFromRange(r,i.begin(),i.end(),t,n);a&&o.push(a)}}return o},t.prototype.styleFromRange=function(e,t,n,o,r){var i=this.editor.getViewRangeFromGcpRange(e);if(!i)return null;var a=0,s=0;if(e.begin()<t&&e.end()>n)s=o;else if(e.begin()>=t&&e.end()<=n){a=i.start.linePosOffset(this.zoom);var c=i.end.linePosOffset(this.zoom);s=(c=c>0?c:o)-a}else e.begin()<t&&e.end()>t?s=i.end.linePosOffset(this.zoom):e.begin()<n&&e.end()>n&&(s=o-(a=i.start.linePosOffset(this.zoom)));return s>0?new be(a+"px",s+"px",r+"px"):null},t}(c.BaseLineOverlay);!function(e){e.SEARCH="search",e.REPLACE="replace",e.ENTER="enter"}(ce||(ce={}));var _e=[{keyBindings:{win:c.KeyAssist.CTRL_WIN+c.KeyCode.F,mac:c.KeyAssist.COMMAND+c.KeyCode.F},callback:function(e){e.editor.run(ce.SEARCH)}},{keyBindings:{win:c.KeyAssist.CTRL_WIN+c.KeyCode.H,mac:c.KeyAssist.COMMAND+c.KeyCode.H},callback:function(e){e.editor.run(ce.REPLACE)}}],we=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Re=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Se={menu:[{name:"find-replace",content:"查找和替换",shortcut:{win:"Ctrl+F",mac:"⌘+F"},onClick:function(e,t){t.showSearchDialog()}}],toolbar:[{name:"find-replace",type:"icon",hasArrow:!1,preventFocus:!0,icon:i.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"},i.a.createElement("path",{fill:"#464D5A",d:"M5.99 6.49c2.538-2.539 6.654-2.539 9.192 0 2.36 2.359 2.526 6.08.5 8.632l2.417 2.416c.244.244.244.64 0 .884s-.64.244-.884 0l-2.4-2.4c-2.554 2.193-6.406 2.08-8.825-.34-2.539-2.538-2.539-6.654 0-9.192zm.99.99c-1.992 1.991-1.992 5.22 0 7.212 1.991 1.992 5.22 1.992 7.212 0s1.992-5.22 0-7.212-5.22-1.992-7.212 0z"})),tooltip:"查找和替换",shortcut:{win:"Ctrl+F",mac:"⌘+F"},respectPermission:!1,onClick:function(e,t){t.showSearchDialog()}}],mobileMoreMenu:[{name:"find-replace",content:function(){return p.a.getInstance().isEditable?"查找和替换":"查找"},iconClass:pe.a["icon-menu-search"],preventExpand:function(){return!p.a.getInstance().isEditable},onClick:function(e,t){c.ReportHelper.tdwReport({opername:"doc_word_editor",module:"moremenu",action:"find"}),p.a.getInstance().isEditable||t.showSearchDialog(K.SEARCH_TAP)}},{content:"查找",name:"find-replace-sub-find",onClick:function(e,t){c.ReportHelper.tdwReport({opername:"doc_word_editor",module:"moremenu",action:"find_find"}),t.showSearchDialog(K.SEARCH_TAP)}},{content:"查找并替换",name:"find-replace-sub-replace",shouldHide:function(){return!p.a.getInstance().isEditable},onClick:function(e,t){c.ReportHelper.tdwReport({opername:"doc_word_editor",module:"moremenu",action:"find_replace"}),t.showSearchDialog(K.REPLACE_TAP)}}]},Ee=Se.menu,Te=Se.toolbar,Pe=Se.mobileMoreMenu,Ie=function(){function e(e,t){this.store=e,this.widgetService=t,this.editor=null,this.searchResultRanges=[],this.searchTarget="",this.selectedIndex=-1,this.changedByReplace=!1,this.searchDialog=null}return e.prototype.$onInit=function(e){var t,n,o=this;this.editor=e,this.editor.registerPlugin((t=this,(n={})[ce.SEARCH]=function(e,n){t.showSearchDialog()},n[ce.REPLACE]=function(e,n){p.a.getInstance().isEditable&&t.showSearchDialog(K.REPLACE_TAP)},n[ce.ENTER]=function(e,n){t.enterSelectNext()||n()},n)),this.searchOverlay=new ge(e,(function(){o.onModelChanged()})),this.searchSelectedOverlay=new Ce(e)},e.prototype.$beforeDestroy=function(){this.editor=null,this.searchDialog=null,this.searchResultRanges=[],this.searchTarget="",this.selectedIndex=-1,this.changedByReplace=!1},e.prototype.initListener=function(){var e=this;this.editor&&this.editor.on(c.StateNotification.CoreSelectionChange,(function(t){e.onCoreSelectionChanged(t)}),this)},e.prototype.unInitListener=function(){this.editor&&this.editor.removeListener(c.StateNotification.CoreSelectionChange,this)},e.prototype.renderReactDom=function(){var e=this;this.editor&&this.widgetService.float({name:"searchDialogDom",component:i.a.createElement(de,{ref:function(t){e.searchDialog=t},handler:this})})},e.prototype.removeReactDom=function(){this.searchDialog&&this.widgetService.remove("searchDialogDom","float")},e.prototype.onCoreSelectionChanged=function(e){e&&this.selectedIndex>=0&&this.selectedIndex<this.searchResultRanges.length&&(this.searchResultRanges[this.selectedIndex].equal(e.range)||(this.selectedIndex=-1,this.searchSelectedOverlay&&this.searchSelectedOverlay.onSearchSelected([])))},e.prototype.onModelChanged=function(){var e=this;this.search(this.searchTarget),this.changedByReplace&&(this.changedByReplace=!1,setTimeout((function(){e.selectNext()})))},e.prototype.showSearchDialog=function(e){var t=this;if(void 0===e&&(e=K.SEARCH_TAP),!this.searchDialog)return this.renderReactDom(),void setTimeout((function(){t.showSearchDialog(e)}));this.searchDialog&&(this.searchDialog.state.visible?this.searchDialog.setState({tap:e,requestFocus:!0}):(this.initListener(),this.searchDialog.setState({searchTarget:"",searchCount:-1,selectedIndex:-1,replaceDst:"",visible:!0,tap:e,requestFocus:!1}))),this.editor&&this.editor.fire(new c.SearchDialogNotification(!0))},e.prototype.hideSearchDialog=function(){this.removeReactDom(),this.searchDialog=null,this.unInitListener(),this.clearResult(),this.editor&&this.editor.fire(new c.SearchDialogNotification(!1))},e.prototype.search=function(e){this.editor&&e.length>0&&(this.searchResultRanges=this.editor.service.getDocument().search(e),this.searchTarget=e,this.selectedIndex=-1,this.searchDialog&&this.searchDialog.setState({searchCount:this.searchResultRanges.length,selectedIndex:this.selectedIndex}),this.searchOverlay&&this.searchOverlay.onSearchResult(this.searchResultRanges),this.searchSelectedOverlay&&this.searchSelectedOverlay.onSearchSelected([]))},e.prototype.selectPrev=function(){if(this.editor&&this.searchResultRanges.length>0){if(this.selectedIndex>=0&&this.selectedIndex<this.searchResultRanges.length)0===this.selectedIndex&&(this.selectedIndex=this.searchResultRanges.length),this.selectedIndex-=1,this.doSelect();else{var e=this.editor.service.getSelection().range().begin();this.selectedIndex=this.binarySearchPrev(e,0,this.searchResultRanges.length-1),-1===this.selectedIndex&&(this.selectedIndex=this.searchResultRanges.length-1),this.doSelect()}this.searchDialog&&this.searchDialog.setState({searchCount:this.searchResultRanges.length,selectedIndex:this.selectedIndex})}},e.prototype.selectNext=function(){if(this.editor&&this.searchResultRanges.length>0){if(this.selectedIndex>=0&&this.selectedIndex<this.searchResultRanges.length)this.selectedIndex===this.searchResultRanges.length-1&&(this.selectedIndex=-1),this.selectedIndex+=1,this.doSelect();else{var e=this.editor.service.getSelection().range().begin();this.selectedIndex=this.binarySearchNext(e,0,this.searchResultRanges.length-1),-1===this.selectedIndex&&(this.selectedIndex=0),this.doSelect()}this.searchDialog&&this.searchDialog.setState({searchCount:this.searchResultRanges.length,selectedIndex:this.selectedIndex})}},e.prototype.doSelect=function(){var e=this.searchResultRanges[this.selectedIndex];this.editor&&this.editor.service.getSelection().setRange(e.begin(),e.end(),{scrollToView:c.ScrollViewType.Near}),this.searchSelectedOverlay&&this.searchSelectedOverlay.onSearchSelected([e])},e.prototype.enterSelectNext=function(){return!!(this.searchDialog&&this.searchDialog.state.visible&&this.searchResultRanges.length>0&&this.selectedIndex>=0&&this.selectedIndex<this.searchResultRanges.length)&&(this.selectNext(),!0)},e.prototype.binarySearchPrev=function(e,t,n){if(n-t>1){var o=Math.floor((t+n)/2),r=this.searchResultRanges[o];return r.end()>e?this.binarySearchPrev(e,t,o):r.end()<e?this.binarySearchPrev(e,o,n):o}return this.searchResultRanges[n].end()<=e?n:this.searchResultRanges[t].end()<=e?t:-1},e.prototype.binarySearchNext=function(e,t,n){if(n-t>1){var o=Math.floor((t+n)/2),r=this.searchResultRanges[o];return r.begin()>e?this.binarySearchNext(e,t,o):r.begin()<e?this.binarySearchNext(e,o,n):o}return this.searchResultRanges[t].begin()>=e?t:this.searchResultRanges[n].begin()>=e?n:-1},e.prototype.replace=function(e){if(p.a.getInstance().isEditable){if(this.editor)this.editor.service.getSelection().getText().toLowerCase()===this.searchTarget.toLowerCase()?(this.editor.service.getSelection().setText(e),this.changedByReplace=!0):this.selectNext();c.ReportHelper.tdwReport({opername:"doc_word_editor",module:"replace",action:"replace_replace"})}},e.prototype.replaceAll=function(e){var t=this;if(p.a.getInstance().isEditable){c.ReportHelper.tdwReport({opername:"doc_word_editor",module:"replace",action:"replace_replace_all"});var n=this.searchResultRanges.length;W.a.confirm({title:"提示",content:"确定将此文档内的"+n+"处 “"+this.searchTarget+"” "+(e?"全部替换为 “"+e+"” 吗？":"全部清除吗？"),onOk:function(){t.editor&&(t.editor.service.getDocument().replaceAll(t.searchResultRanges,e),t.editor.fire(new c.FocusBlurNotification(c.FocusBlurNotificationType.REQUEST_BLUR),!1)),c.ReportHelper.tdwReport({opername:"doc_word_editor",module:"replace",action:"replace_replace_all_confirm"}),W.a.confirm({title:"替换结果",content:"共完成"+n+"处结果替换。",cancelText:null})}})}},e.prototype.clearResult=function(){this.searchResultRanges=[],this.searchTarget="",this.selectedIndex=-1,this.searchOverlay&&this.searchOverlay.onSearchResult([]),this.searchSelectedOverlay&&this.searchSelectedOverlay.onSearchSelected([])},e=we([Object(m.i)({menuItems:Ee,toolbarItems:Te,mobileMenuItems:Pe,keymap:_e,name:y.a.Search,scope:0,for:["melo"]}),Re("design:paramtypes",[m.x,m.A])],e)}(),xe=n(113),Oe=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Le=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Me=function(){function e(){}return e.prototype.$onInit=function(){this.checkVipStatus(),this.vipService.initToast()},e.prototype.checkVipStatus=function(){this.vipService.checkVipStatus().then((function(e){var t=e.configs,n=t.canvip,o=t.ioscanpay;if(n&&n.enable){window.enableToCVipFeature=!0;try{document.dispatchEvent(new CustomEvent("canShowVipStatus",{detail:!0}))}catch(e){}}if(o&&o.enable){window.enabledIosPayFeature=!0;try{document.dispatchEvent(new CustomEvent("canIosPayStatus",{detail:!0}))}catch(e){}}}))},e.prototype.$onEnable=function(){this.checkVipStatus()},e.prototype.$onDisable=function(){window.enableToCVipFeature=!1,window.enabledIosPayFeature=!1,document.dispatchEvent(new CustomEvent("canShowVipStatus",{detail:!1})),document.dispatchEvent(new CustomEvent("canIosPayStatus",{detail:!1}))},e.prototype.$beforeDestroy=function(){this.$onDisable(),this.vipService.uninitToast()},Oe([Object(m.l)(),Le("design:type",xe.a)],e.prototype,"vipService",void 0),e=Oe([Object(m.i)({name:y.a.Vip,scope:1})],e)}(),Ne=n(74),Ae=n.n(Ne),De=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),ke=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return De(t,e),t.prototype.render=function(){return i.a.createElement("div",{className:Ae.a["statusbar-simple-text"]},this.props.wordCountInfo.isSelectedWord?this.props.wordCountInfo.selectedWordCount+"/"+this.props.wordCountInfo.allWordCount:this.props.wordCountInfo.allWordCount," 个字")},t}(r.Component),je=Object(m.D)(["wordCountInfo"])(ke);var Fe,He=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Be=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Ue=[{name:"word-count",content:i.a.createElement(je,null)}],Ve=function(){function e(e){this.store=e,this.editor=null,this.allWordCount=0,this.allWordCountLastTime=0,this.selectedWordCountLastTime=0}return e.prototype.$onInit=function(e){var t=this;this.editor=e,this.editor.on(c.RenderNotificationTypes.SELECTION_CHANGE,(function(e){t.onSelectionChanged(e)}),this),this.editor.on(c.StateNotification.NewDocument,(function(){t.countAllWord()}),this),this.editor.on(c.LayoutNotification.LayoutFinished,(function(){t.countAllWord()}),this),this.store.register("wordCountInfo",{allWordCount:0,isSelectedWord:!1,selectedWordCount:0}),setTimeout((function(){t.countAllWord()}),2e3)},e.prototype.$beforeDestroy=function(){this.editor&&(this.editor.removeListener(c.RenderNotificationTypes.SELECTION_CHANGE,this),this.editor.removeListener(c.StateNotification.NewDocument,this),this.editor.removeListener(c.LayoutNotification.LayoutFinished,this),this.editor=null),this.allWordCount=0,this.allWordCountLastTime=0,this.allWordCountId=null,this.selectedWordCountLastTime=0,this.selectedWordCountId=null},e.prototype.onSelectionChanged=function(e){e&&e.viewRange&&!e.viewRange.isCaret()?this.countSelectedWord():(this.selectedWordCountId&&clearTimeout(this.selectedWordCountId),this.store.update("wordCountInfo",{allWordCount:this.allWordCount,isSelectedWord:!1,selectedWordCount:0}))},e.prototype.countAllWord=function(){var e=this;Date.now()-this.allWordCountLastTime<500&&this.allWordCountId&&clearTimeout(this.allWordCountId),this.allWordCountLastTime=Date.now(),this.allWordCountId=setTimeout((function(){e.didCountAllWord()}),500)},e.prototype.didCountAllWord=function(){this.allWordCountLastTime=Date.now(),this.allWordCountId=null,this.editor&&(this.allWordCount=this.editor.wordCount,this.store.update("wordCountInfo",{allWordCount:this.allWordCount,isSelectedWord:!1,selectedWordCount:0}))},e.prototype.countSelectedWord=function(){var e=this;Date.now()-this.selectedWordCountLastTime<1e3&&this.selectedWordCountId&&clearTimeout(this.selectedWordCountId),this.selectedWordCountLastTime=Date.now(),this.selectedWordCountId=setTimeout((function(){e.didCountSelectedWord()}),1e3)},e.prototype.didCountSelectedWord=function(){if(this.selectedWordCountLastTime=Date.now(),this.selectedWordCountId=null,this.editor){var e=this.editor.service.getSelection().range(),t=this.editor.service.getSelection().storyRange();if(e.equal(t))this.store.update("wordCountInfo",{allWordCount:this.allWordCount,isSelectedWord:!0,selectedWordCount:this.allWordCount});else{var n=this.editor.service.getSelection().countWord();n<0&&(n=0),n>this.allWordCount&&(n=this.allWordCount),this.store.update("wordCountInfo",{allWordCount:this.allWordCount,isSelectedWord:!0,selectedWordCount:n})}}},e=He([Object(m.i)({statusbarItems:Ue,name:y.a.WordCount,scope:0,for:["melo"]}),Be("design:paramtypes",[m.x])],e)}(),We=n(35),Ge=n.n(We),ze=n(338),Ke=n.n(ze),qe=n(473),Ze=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),$e=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={pageCount:1,page:1},t.componentWillUnmount=function(){t.context.editor.removeCallBack(c.RenderNotificationTypes.SELECTION_END,t.updatePage),t.subscription.unsubscribe()},t.updatePage=function(){var e=t.context.editor.pageCount;(isNaN(e)||e<1)&&(e=1),t.setState({pageCount:e})},t.setPageMode=function(e){t.props.handler.setPageMode(e)},t}return Ze(t,e),t.prototype.componentWillMount=function(){this.updatePage()},t.prototype.componentDidMount=function(){var e=this;this.context.editor.on(c.RenderNotificationTypes.SELECTION_END,this.updatePage);var t=this.context.store.get("scrolled");this.subscription=t.pipe(Object(qe.a)(300)).subscribe((function(){var t=e.getCurrentPage();t!==e.state.page&&e.setState({page:t})}))},t.prototype.getCurrentPage=function(){var e=document.body.clientHeight/2,t=this.context.editor.getRoot();if(t)for(var n=t.querySelectorAll(".melo-logic-page"),o=0;o<n.length;o++){var r=n[o].getBoundingClientRect();if(r.top<e&&r.top+r.height>e)return o+1}return 1},t.prototype.render=function(){var e=this,t=this.state,n=t.page,o=t.pageCount,r=this.props.isPaged;return i.a.createElement("div",null,i.a.createElement("div",{className:Ae.a["statusbar-simple-button"]+" "+(r?Ae.a.active:"")},r?i.a.createElement(Ge.a,{placement:"top",title:"退出分页模式"},i.a.createElement("div",{className:Ke.a["page-button"]+" "+Ae.a["small-button"],onClick:function(){e.setPageMode(c.LayoutType.Scroll)}})):i.a.createElement(Ge.a,{placement:"top",title:"进入分页模式"},i.a.createElement("div",{className:Ke.a["page-button"]+" "+Ae.a["small-button"],onClick:function(){e.setPageMode(c.LayoutType.Paged)}}))),r?i.a.createElement("div",{className:Ke.a["page-text"]+" "+Ae.a["statusbar-simple-text"]},"第 ",n," 页 / 共 ",o," 页"):null)},t.contextType=m.h,t}(r.Component),Qe=Object(m.D)(["isPaged"])($e);!function(e){e.INSERT_PAGEBREAK="insert_pagebreak"}(Fe||(Fe={}));var Xe,Ye=[{keyBindings:{win:c.KeyAssist.CTRL_WIN+c.KeyCode.ENTER,mac:c.KeyAssist.COMMAND+c.KeyCode.ENTER},action:Fe.INSERT_PAGEBREAK}],Je=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},et=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},tt={menu:[{name:"view-page",content:"分页模式",onClick:function(e,t){var n=t.isPageMode()?c.LayoutType.Scroll:c.LayoutType.Paged;t.setPageMode(n)},shouldCheck:function(e,t){return t.isPageMode()}},{name:"insert-page-break",content:"分页符",icon:i.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"25",viewBox:"0 0 24 25"},i.a.createElement("g",{fill:"none",fillRule:"evenodd"},i.a.createElement("path",{fill:"#464D5A",d:"M18 14.7c.552 0 1 .448 1 1v4h-1.401l.001-3.599H6.4v3.598L5 19.7v-4c0-.552.448-1 1-1h12zm3-3V13H3v-1.3h18zM6.399 5L6.4 8.6h11.2L17.599 5H19v4c0 .552-.448 1-1 1H6c-.552 0-1-.448-1-1V5h1.399z"}))),shortcut:{win:"Ctrl+↵",mac:"⌘+↵"},onClick:function(e,t){t.insertPageBreak(),c.ReportHelper.tdwReport({opername:"doc_word_editor",module:"page",action:"insert_pagebreak",ver7:"pc_menu"})},shouldDisabled:function(e){return e.editor.selection.storyInfo.storyProp.storyType!==c.StoryType.MainTextStory||e.editor.docEnv.layoutType!==c.LayoutType.Paged||null!==e.editor.selection.tableCellRangeAll}}],statusBar:[{name:"page",content:i.a.createElement(Qe,null)}]},nt=tt.menu,ot=tt.statusBar,rt=function(){function e(e,t){this.store=e,this.contextService=t,this.store.register("isPaged","2"===Object(M.c)().pagingFlag)}return e.prototype.$onInit=function(e){var t,n,o=this;e.on(c.RenderNotificationTypes.PAGEGAP_DBCLICK,(function(){o.store.getValue("isPaged")&&o.setPageMode(c.LayoutType.Scroll)}),this),e.registerPlugin((t=this,(n={})[Fe.INSERT_PAGEBREAK]=function(e,n){e&&e instanceof c.MeloEditor&&e.isEditable()&&(t.insertPageBreak(),c.ReportHelper.tdwReport({opername:"doc_word_editor",module:"page",action:"insert_pagebreak",ver7:"shortcut_key"})),n()},n)),e.surface.keymapManager.addKeymaps(Ye)},e.prototype.$beforeDestroy=function(e){e.removeListener(c.RenderNotificationTypes.PAGEGAP_DBCLICK,this)},e.prototype.isPageMode=function(){var e=this.contextService.context.editor;return e instanceof c.MeloEditor&&e.docEnv.layoutType===c.LayoutType.Paged},e.prototype.setPageMode=function(e){var t=this.contextService.context.editor;t instanceof c.MeloEditor&&(t.setLayoutType(e),this.store.update("isPaged",e===c.LayoutType.Paged),this.setPagingFlag(e===c.LayoutType.Paged?2:1),c.ReportHelper.tdwReport({opername:"doc_word_editor",module:"page",action:e===c.LayoutType.Paged?"page_turn_on":"page_turn_off"}))},e.prototype.setPagingFlag=function(e){w.a.ajax({type:"get",url:"/sdc/settipflag",data:{type:36,flag:e,globalPadId:Object(M.c)().globalPadId,xsrf:Object(c.getXsrf)()}})},e.prototype.insertPageBreak=function(){var e=this.contextService.context.editor;e instanceof c.MeloEditor&&e&&e.selection.storyInfo.storyProp.storyType===c.StoryType.MainTextStory&&e.docEnv.layoutType===c.LayoutType.Paged&&null===e.selection.tableCellRangeAll&&e.service.getSelection().insertBreak(c.TDBreakType.PageBreak)},e=Je([Object(m.i)({name:y.a.Page,scope:0,for:["melo"],menuItems:nt,statusbarItems:ot}),et("design:paramtypes",[m.x,m.f])],e)}(),it=n(256),at=n(295),st=n.n(at),ct=n(340),lt=n.n(ct),pt=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),ut=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.container=null,t.state={on:"titlebar",unread:0,avatarLoaded:!1},t.componentDidMount=function(){(t.props.slr.listen("SL-INIT",(function(){t.initFeatureComponent()})),t.initFeatureComponent(),t.context.store.get("isTitlebarShowed").subscribe((function(e){t.setState({on:e?"titlebar":"toolbar"}),t.avatarComponent&&(t.avatarComponent.accountAvatar.inited=!1)})),t.props.hideUnread)||t.context.store.get("unreadsNum").subscribe((function(e){t.setState({unread:e})}))},t.initFeatureComponent=function(){t.props.slr.load("AccountAvatar",(function(e){t.avatarComponent=e,t.setState({avatarLoaded:!0});var n=null==Object(M.c)().userInfo?null:Object(M.c)().userInfo.uin,o=null==Object(c.getCookie)("utype")?null:Object(c.getCookie)("utype");e.init({container:t.container,userPic:Object(M.c)().userPic,nick:Object(M.c)().userName,userType:o,uin:n,isSquare:!0})})),t.props.slr.load("Account",(function(e){t.accountShow(e)}))},t.handleAvartarClick=function(){c.ReportHelper.tdwReport({opername:"doc_menubar",module:"avatar_button",action:"click"}),t.props.slr.load("Account",(function(e){t.accountShow(e)})),t.props.slr.dispatch("TXDOC-ACCOUNT-SHOW",{})},t}return pt(t,e),t.prototype.componentDidUpdate=function(){if(this.avatarComponent&&this.avatarComponent.accountAvatar&&!1===this.avatarComponent.accountAvatar.inited){window.enableToCVipFeature&&(this.avatarComponent.accountAvatar.state.enableVipFeature=window.enableToCVipFeature);var e=null==Object(M.c)().userInfo?null:Object(M.c)().userInfo.uin,t=null==Object(c.getCookie)("utype")?null:Object(c.getCookie)("utype");this.avatarComponent.init({container:this.container,userPic:Object(M.c)().userPic,userType:t,uin:e,nick:Object(M.c)().userName,isSquare:!0})}},t.prototype.componentWillUnmount=function(){this.avatarComponent=null},t.prototype.render=function(){var e=this,t=i.a.createElement(st.a,{count:this.state.unread,offsetX:-1,offsetY:1},i.a.createElement("div",{ref:function(t){e.container=t},className:"toolbar"===this.state.on?"":lt.a.placeholder}));if("toolbar"===this.state.on){var n=s.a.createPortal(i.a.createElement("div",{id:"account-avatar-toolbar",onClick:this.handleAvartarClick},t),document.getElementById("toolbar-account"),"account-avatar-toolbar");return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{style:{marginLeft:16,marginRight:20},onClick:this.handleAvartarClick},t),"toolbar"===this.state.on?n:null)}return i.a.createElement("div",{onClick:this.handleAvartarClick},t)},t.prototype.accountShow=function(e){var t=document.getElementById("accountContainer");"toolbar"===this.state.on?e.show(t,{right:59,top:-4,logoutRefresh:!1,padId:"",domainId:"",userInfo:{}}):e.show(t,{right:22,top:-54,logoutRefresh:!1,padId:"",domainId:"",userInfo:{}})},t.contextType=m.h,t}(r.Component),dt=n(229),ht=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{c(o.next(e))}catch(e){i(e)}}function s(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))},ft=function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},mt=function(){function e(){}return e.getUserMarkName=function(e,t){return ht(this,void 0,void 0,(function(){return ft(this,(function(n){return[2,new Promise((function(n,o){w.a.ajax({url:"/sdc/getusermarkname",xhrFields:{withCredentials:!0},data:{bkn:N.a.getBkn(),domainId:e.domainId,localPadId:e.localPadId,uids:"["+t.join(",")+"]",xsrf:Object(c.getXsrf)()},success:function(e){0===e.retcode&&n(e.result.rsp||[])},error:function(){o()}})}))]}))}))},e.getUnreadNum=function(){return ht(this,void 0,void 0,(function(){return ft(this,(function(e){return[2,new Promise((function(e,t){w.a.ajax({url:"/cgi-bin/online_docs/notify_getnum",xhrFields:{withCredentials:!0},data:{bkn:N.a.getBkn()},success:function(n){n&&0===n.retcode?e(n):t()},error:function(){t()}})}))]}))}))},e}(),gt=[{name:"avatar",type:"custom",preventFocus:!0,content:i.a.createElement("div",{id:"toolbar-account"}),respectPermission:!1}],yt=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},vt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},bt=function(){function e(e,t,n){var o=this;this.titlebar=e,this.store=t,this.wigetService=n,this.slr=this.scriptLoaderService.getScriptLoader(),t.register("unreadsNum",0),this.wigetService.float({name:"account-container",component:i.a.createElement("div",{id:"accountContainer"})}),this.titlebar.hydrate("titlebar-avatar",i.a.createElement(ut,{slr:this.slr})),mt.getUnreadNum().then((function(e){o.store.update("unreadsNum",e.unread_sum_count)}))}return e.prototype.$onInit=function(e){var t=this;e.on(dt.c.ServerMessage,(function(e){if(e.msg&&e.msg.message)try{var n=JSON.parse(e.msg.message);if(1===n.msgType){var o=t.store.get("unreadsNum");n.clearRedDot&&0!==n.clearRedDot?o.next(0):n.redDot&&o.next(o.getValue()+n.redDot)}}catch(e){return}}),this)},e.prototype.$beforeDestroy=function(e){e.removeListener(dt.c.ServerMessage,this)},yt([Object(m.l)(),vt("design:type",X.a)],e.prototype,"scriptLoaderService",void 0),e=yt([Object(m.i)({name:y.a.UserAvatar,scope:0,for:["melo"],toolbarItems:gt}),vt("design:paramtypes",[it.a,m.x,m.A])],e)}(),Ct=n(261),_t=n(72),wt=n.n(_t),Rt=n(112),St=n(342),Et=n.n(St),Tt=n(296),Pt=n.n(Tt),It=n(275),xt=n.n(It),Ot=n(474),Lt=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Mt=function(){return(Mt=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},Nt=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},At=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)a.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return a},Dt={portrait:1,lanscape:2},kt=[{value:"a3",name:"A3",width:29.7,height:41.99},{value:"a4",name:"A4",width:21,height:29.7},{value:"a5",name:"A5",width:14.8,height:21},{value:"b4",name:"B4",width:25.7,height:36.4},{value:"b5",name:"B5",width:18.2,height:25.7}],jt={paperSizeWidth:{step:.1,round:2,min:1,max:60,default:21},paperSizeHeight:{step:.1,round:2,min:1,max:60,default:29.7},paperMarginLeft:{step:.1,round:2,min:0,max:60,default:3.17},paperMarginTop:{step:.1,round:2,min:0,max:60,default:2.54},paperMarginRight:{step:.1,round:2,min:0,max:60,default:3.17},paperMarginBottom:{step:.1,round:2,min:0,max:60,default:2.54},limits:{minColumnWidth:.32,minRowHeight:.32}},Ft=function(e){function t(t){var n=e.call(this,t)||this;return n._shouldRefresh=!0,n._currentPageSize="a4",n._pageOrientation=Dt.portrait,n.previewCanvasWidth=276,n.previewCanvasHeight=276,n.handleCancelButtonClick=function(){n.props.onCancel&&n.props.onCancel()},n.handleConfirmButtonClick=function(){if(n.props.onConfirm){if(n.updatePaperMarginLRNumberInputState()||n.updatePaperMarginTBNumberInputState())return;var e=Mt({},n.state);n.state.pageWidth===n.props.defaultData.pageWidth&&(e.pageWidth=void 0),n.state.pageHeight===n.props.defaultData.pageHeight&&(e.pageHeight=void 0),n.state.marginTop===n.props.defaultData.marginTop&&(e.marginTop=void 0),n.state.marginRight===n.props.defaultData.marginRight&&(e.marginRight=void 0),n.state.marginBottom===n.props.defaultData.marginBottom&&(e.marginBottom=void 0),n.state.marginLeft===n.props.defaultData.marginLeft&&(e.marginLeft=void 0),n.props.onConfirm(e);var t=n.getMarginLeft(),o=n.getMarginRight(),r=n.getMarginTop(),i=n.getMarginBottom();t===n._oldPageData.marginLeft&&o===n._oldPageData.marginRight&&r===n._oldPageData.marginTop&&i===n._oldPageData.marginBottom||c.ReportHelper.tdwReport({opername:"doc_word_editor",module:"page",action:"margin_set",obj3:t+"*"+o+"*"+r+"*"+i});var a=n.getPageWidth(),s=n.getPageHeight();a===n._oldPageData.pageWidth&&s===n._oldPageData.pageHeight||c.ReportHelper.tdwReport({opername:"doc_word_editor",module:"page",action:"size_set",obj3:s+"*"+a});var l=Dt.portrait;if(n._oldPageData.pageWidth>n._oldPageData.pageHeight&&(l=Dt.lanscape),n._pageOrientation!==l){var p=0;n._pageOrientation===Dt.lanscape&&(p=1),c.ReportHelper.tdwReport({opername:"doc_word_editor",module:"page",action:"orientation_set",obj3:p})}}},n.setPageWidth=function(e){var t=parseFloat(String(e));isNaN(t)||(n.setState({pageWidth:n.cmToTwips(t)}),n.updatePaperSizeNumberInputState(t,n.getPageHeight()),n._shouldRefresh=!0)},n.setPageHeight=function(e){var t=parseFloat(String(e));isNaN(t)||(n.setState({pageHeight:n.cmToTwips(t)}),n.updatePaperSizeNumberInputState(n.getPageWidth(),t),n._shouldRefresh=!0)},n.setMarginTop=function(e){var t=parseFloat(String(e));isNaN(t)||(n.setState({marginTop:n.cmToTwips(t)}),n._shouldRefresh=!0)},n.setMarginRight=function(e){var t=parseFloat(String(e));isNaN(t)||(n.setState({marginRight:n.cmToTwips(t)}),n._shouldRefresh=!0)},n.setMarginBottom=function(e){var t=parseFloat(String(e));isNaN(t)||(n.setState({marginBottom:n.cmToTwips(t)}),n._shouldRefresh=!0)},n.setMarginLeft=function(e){var t=parseFloat(String(e));isNaN(t)||(n.setState({marginLeft:n.cmToTwips(t)}),n._shouldRefresh=!0)},n.handlePaperSizeWellKnownNameDropdownItemClick=function(e){var t,o,r;if(n._currentPageSize!==e){var i=null;try{for(var a=Nt(kt),s=a.next();!s.done;s=a.next()){var c=s.value;if(c.value===e){i=c;break}}}catch(e){t={error:e}}finally{try{s&&!s.done&&(o=a.return)&&o.call(a)}finally{if(t)throw t.error}}if(i){var l=i.width,p=i.height;n.getPageWidth()>n.getPageHeight()&&(l=(r=At([p,l],2))[0],p=r[1]),n._pageWidthInputRef.setValue(l),n._pageHeightInputRef.setValue(p)}n._shouldRefresh=!0}},n.drawVerticalDashedLine=function(e,t,n,o){for(var r=e,i=n;i<o;i+=4)r.beginPath(),r.moveTo(t,i),r.lineTo(t,Math.min(i+2,o)),r.lineWidth=1,r.strokeStyle="#ffa1a1",r.stroke();return r},n.drawHorizentalDashedLine=function(e,t,n,o){for(var r=e,i=n;i<o;i+=4)r.beginPath(),r.moveTo(i,t),r.lineTo(Math.min(i+2,o),t),r.lineWidth=1,r.strokeStyle="#ffa1a1",r.stroke();return r},n.state=Mt({},t.defaultData),n._oldPageData={pageWidth:n.getPageWidth(),pageHeight:n.getPageHeight(),marginTop:n.getMarginTop(),marginRight:n.getMarginRight(),marginBottom:n.getMarginBottom(),marginLeft:n.getMarginLeft()},n}return Lt(t,e),t.prototype.cmToTwips=function(e){return Object(g.ptToTwips)(e*g.PtPerCM)},t.prototype.twipsToCm=function(e){return Object(g.twipsToPt)(e)/g.PtPerCM},t.prototype.cmToPx=function(e){return Object(g.twipsToPx)(this.cmToTwips(e))},t.prototype.isNumberInputValueValid=function(e,t){if(isNaN(e))return!1;var n=t.min,o=t.max;return!(e<n||e>o)},t.prototype.isPaperSizeWidthValueValid=function(e){return this.isNumberInputValueValid(e,jt.paperSizeWidth)},t.prototype.isPaperSizeHeightValueValid=function(e){return this.isNumberInputValueValid(e,jt.paperSizeHeight)},t.prototype.isPaperMarginLeftValueValid=function(e){return this.isNumberInputValueValid(e,jt.paperMarginLeft)},t.prototype.isPaperMarginRightValueValid=function(e){return this.isNumberInputValueValid(e,jt.paperMarginRight)},t.prototype.isPaperMarginTopValueValid=function(e){return this.isNumberInputValueValid(e,jt.paperMarginTop)},t.prototype.isPaperMarginBottomValueValid=function(e){return this.isNumberInputValueValid(e,jt.paperMarginBottom)},t.prototype.getPageWidth=function(){return void 0!==this.state.pageWidth&&this.state.pageWidth!==c.TDConstants.Undefined?Math.round(100*this.twipsToCm(this.state.pageWidth))/100:jt.paperSizeWidth.default},t.prototype.getPageHeight=function(){return void 0!==this.state.pageHeight&&this.state.pageHeight!==c.TDConstants.Undefined?Math.round(100*this.twipsToCm(this.state.pageHeight))/100:jt.paperSizeHeight.default},t.prototype.getMarginTop=function(){return void 0!==this.state.marginTop&&this.state.marginTop!==c.TDConstants.Undefined?Math.round(100*this.twipsToCm(this.state.marginTop))/100:jt.paperMarginTop.default},t.prototype.getMarginRight=function(){return void 0!==this.state.marginRight&&this.state.marginRight!==c.TDConstants.Undefined?Math.round(100*this.twipsToCm(this.state.marginRight))/100:jt.paperMarginRight.default},t.prototype.getMarginBottom=function(){return void 0!==this.state.marginBottom&&this.state.marginBottom!==c.TDConstants.Undefined?Math.round(100*this.twipsToCm(this.state.marginBottom))/100:jt.paperMarginBottom.default},t.prototype.getMarginLeft=function(){return void 0!==this.state.marginLeft&&this.state.marginLeft!==c.TDConstants.Undefined?Math.round(100*this.twipsToCm(this.state.marginLeft))/100:jt.paperMarginLeft.default},t.getPaperSizeWellKnownNameAndValue=function(e,t){var n,o,r,i=At([e,t],2),a=i[0],s=i[1];a>s&&(s=(n=At([a,s],2))[0],a=n[1]);var c={name:"自定义",value:"custom"};try{for(var l=Nt(kt),p=l.next();!p.done;p=l.next()){var u=p.value;if(Math.abs(a-u.width)<.01&&Math.abs(s-u.height)<.01){c.name=u.name,c.value=u.value;break}}}catch(e){o={error:e}}finally{try{p&&!p.done&&(r=l.return)&&r.call(l)}finally{if(o)throw o.error}}return c},t.prototype.handlePaperOrientationSelectionChanged=function(e){var t=this.getPageWidth(),n=this.getPageHeight(),o=!1;if(isNaN(t)||isNaN(n)||(e===Dt.lanscape?n>=t&&(o=!0):t>=n&&(o=!0)),o){this._pageOrientation=e,this._pageWidthInputRef.setValue(n),this._pageHeightInputRef.setValue(t);var r=this.getMarginLeft(),i=this.getMarginTop(),a=this.getMarginRight(),s=this.getMarginBottom();this.isPaperMarginLeftValueValid(r)&&this.isPaperMarginTopValueValid(i)&&this.isPaperMarginRightValueValid(a)&&this.isPaperMarginBottomValueValid(s)&&(e===Dt.lanscape?(this._marginRightInputRef.setValue(Math.abs(i)),this._marginTopInputRef.setValue(Math.abs(r)),this._marginLeftInputRef.setValue(Math.abs(s)),this._marginBottomInputRef.setValue(Math.abs(a))):(this._marginTopInputRef.setValue(Math.abs(a)),this._marginLeftInputRef.setValue(Math.abs(i)),this._marginBottomInputRef.setValue(Math.abs(r)),this._marginRightInputRef.setValue(Math.abs(s)))),this._shouldRefresh=!0}},t.prototype.updatePaperSizeNumberInputState=function(e,n){var o=t.getPaperSizeWellKnownNameAndValue(e,n),r=(o.name,o.value);this._pageSizeSelectRef.handleClick(r)},t.prototype.updatePaperMarginLRNumberInputState=function(){var e=this.getMarginLeft(),t=this.getMarginRight(),n=this.getPageWidth();if(!(this.isPaperMarginLeftValueValid(e)&&this.isPaperMarginRightValueValid(t)&&this.isPaperSizeWidthValueValid(n)))return" ";var o=jt.limits.minColumnWidth,r=0;return o<n&&(r=n-o),e+t>=r?"左右边距相加需小于"+Math.round(100*r)/100+"cm":""},t.prototype.updatePaperMarginTBNumberInputState=function(){var e=this.getMarginTop(),t=this.getMarginBottom(),n=this.getPageHeight();if(!(this.isPaperMarginTopValueValid(e)&&this.isPaperMarginBottomValueValid(t)&&this.isPaperSizeHeightValueValid(n)))return" ";var o=jt.limits.minRowHeight,r=0;return o<n&&(r=n-o),e+t>=r?"上下边距相加需小于"+Math.round(100*r)/100+"cm":""},t.prototype.componentDidMount=function(){this.refreshPreview()},t.prototype.componentDidUpdate=function(){this.refreshPreview()},t.prototype.isPaperSizeValid=function(e,t){return this.isPaperSizeWidthValueValid(e)&&this.isPaperSizeHeightValueValid(t)},t.prototype.scaleMarginHorizontal=function(e,t,n,o){var r=NaN,i=NaN;this.isPaperMarginLeftValueValid(e)&&((isNaN(t)||e+t<n)&&(r=this.cmToPx(e)*o));this.isPaperMarginRightValueValid(t)&&((isNaN(e)||e+t<n)&&(i=this.cmToPx(t)*o));return{left:r,right:i}},t.prototype.scaleMarginVertical=function(e,t,n,o){var r=NaN,i=NaN;this.isPaperMarginTopValueValid(e)&&((isNaN(t)||Math.abs(e)+Math.abs(t)<n)&&(r=this.cmToPx(Math.abs(e))*o));this.isPaperMarginBottomValueValid(t)&&((isNaN(e)||Math.abs(e)+Math.abs(t)<n)&&(i=this.cmToPx(Math.abs(t))*o));return{top:r,bottom:i}},t.prototype.refreshPreview=function(){if(this._shouldRefresh){this._shouldRefresh=!1;var e=this.getPageWidth(),t=this.getPageHeight();if(this.isPaperSizeValid(e,t)){var n,o=this.getMarginLeft(),r=this.getMarginRight(),i=this.getMarginTop(),a=this.getMarginBottom(),s=this.cmToPx(e),c=this.cmToPx(t),l=s/c,p=232,u=232;l>1?(n=p/s,u=Math.round(p/l)):(n=u/c,p=Math.round(u*l));var d=this._canvas.getContext("2d"),h=this.previewCanvasWidth,f=this.previewCanvasHeight;d.clearRect(0,0,h,f);var m=Math.round((h-p)/2),g=Math.round((f-u)/2);d.beginPath(),d.rect(m,g,p,u),d.fillStyle="#fafafa",d.fill(),d.beginPath(),d.rect(m-.5,g-.5,p+1,u+1),d.strokeStyle="rgba(0,0,0,0.08)",d.lineWidth=1,d.stroke();var y=this.scaleMarginHorizontal(o,r,e,n),v=y.left,b=y.right,C=this.scaleMarginVertical(i,a,t,n),_=C.top,w=C.bottom,R=m+1,S=g+1,E=m+p-1,T=g+u-1;isNaN(v)||(R=Math.max(R,Math.round(m+v))),isNaN(b)||(E=Math.min(E,Math.round(m+p-b))),isNaN(_)||(S=Math.max(S,Math.round(g+_))),isNaN(T)||(T=Math.min(T,Math.round(g+u-w)));var P=E-R,I=T-S;P>1&&I>1&&(d.beginPath(),d.rect(R,S,P,I),d.fillStyle="#ffffff",d.fill()),isNaN(v)||this.drawVerticalDashedLine(d,Math.floor(m+v)+.5,g+1,g+u-1),isNaN(b)||this.drawVerticalDashedLine(d,Math.floor(m+p-b)+.5,g+1,g+u-1),isNaN(_)||this.drawHorizentalDashedLine(d,Math.floor(g+_)+.5,m+1,m+p-1),isNaN(T)||this.drawHorizentalDashedLine(d,Math.floor(g+u-w)+.5,m+1,m+p-1)}}},t.prototype.render=function(){var e=this,n=this.getPageWidth(),o=this.getPageHeight();n>o?this._pageOrientation=Dt.lanscape:n<o&&(this._pageOrientation=Dt.portrait);var r=t.getPaperSizeWellKnownNameAndValue(this.getPageWidth(),this.getPageHeight()).value;return this._currentPageSize=r,i.a.createElement("div",{className:Et.a["dialog-position"]},i.a.createElement("div",{style:{paddingBottom:"24px"}},i.a.createElement("span",{className:Et.a["page-setting-title"]},"页面设置")),i.a.createElement("div",{className:Et.a["dialog-body"]},i.a.createElement("div",{className:Et.a["setting-panel"]},i.a.createElement("div",{className:Et.a["setting-section"]+" "+Et.a["setting-section-papaer-orientation"]},i.a.createElement("div",{className:Et.a["setting-section-left"]},i.a.createElement("span",{className:Et.a["setting-name"]+" "+Et.a["setting-name-paper-orientation"]},"页面方向")),i.a.createElement("div",{className:Et.a["setting-section-right"]},i.a.createElement("div",{className:Et.a["paper-orientation-group"]},i.a.createElement(Pt.a,{checked:this._pageOrientation===Dt.lanscape,onChange:function(){e.handlePaperOrientationSelectionChanged(Dt.lanscape)}},"横向"),i.a.createElement(Pt.a,{style:{marginLeft:"23px"},checked:this._pageOrientation===Dt.portrait,onChange:function(){e.handlePaperOrientationSelectionChanged(Dt.portrait)}},"纵向")))),i.a.createElement("div",{className:Et.a["setting-section"]+" "+Et.a["setting-section-paper-size-wkn"]},i.a.createElement("div",{className:Et.a["setting-section-left"]},i.a.createElement("span",{className:Et.a["setting-name"]+" "+Et.a["setting-name-paper-size-wkn"]},"页面大小")),i.a.createElement("div",{className:Et.a["setting-section-right"]},i.a.createElement(xt.a,{style:{width:"182px",height:"36px"},defaultValue:r,onChange:this.handlePaperSizeWellKnownNameDropdownItemClick,ref:function(t){e._pageSizeSelectRef=t}},i.a.createElement(xt.a.Option,{value:"a3"},"A3"),i.a.createElement(xt.a.Option,{value:"a4"},"A4"),i.a.createElement(xt.a.Option,{value:"a5"},"A5"),i.a.createElement(xt.a.Option,{value:"b4"},"B4"),i.a.createElement(xt.a.Option,{value:"b5"},"B5"),i.a.createElement(xt.a.Option,{value:"custom"},"自定义")))),i.a.createElement("div",{className:Et.a["setting-section"]+" "+Et.a["setting-section-paper-size-value"]},i.a.createElement("div",{className:Et.a["setting-section-left"]},i.a.createElement("span",{className:Et.a["setting-name"]+" "+Et.a["setting-name-paper-size"]},"页面尺寸")),i.a.createElement("div",{className:Et.a["setting-section-right"]},i.a.createElement("span",{className:Et.a["setting-name"]+" "+Et.a["setting-name-right"]+" "+Et.a["setting-name-paper-size-height"]},"高"),i.a.createElement(Ot.a,{defaultValue:this.getPageHeight(),minValue:jt.paperSizeHeight.min,maxValue:jt.paperSizeHeight.max,step:jt.paperSizeHeight.step,round:jt.paperSizeHeight.round,onChange:this.setPageHeight,ref:function(t){e._pageHeightInputRef=t}}),i.a.createElement("span",{className:Et.a["unit-label"]},"cm"),i.a.createElement("span",{className:Et.a["setting-name"]+" "+Et.a["setting-name-right"]+" "+Et.a["setting-name-paper-size-width"]},"宽"),i.a.createElement(Ot.a,{defaultValue:this.getPageWidth(),minValue:jt.paperSizeWidth.min,maxValue:jt.paperSizeWidth.max,step:jt.paperSizeWidth.step,round:jt.paperSizeWidth.round,onChange:this.setPageWidth,ref:function(t){e._pageWidthInputRef=t}}),i.a.createElement("span",{className:Et.a["unit-label"]},"cm"))),i.a.createElement("div",{className:Et.a["setting-section"]+" "+Et.a["setting-section-paper-margin-left-and-right"]},i.a.createElement("div",{className:Et.a["setting-section-left"]},i.a.createElement("span",{className:Et.a["setting-name"]+" "+Et.a["setting-name-paper-margin"]},"页边距")),i.a.createElement("div",{className:Et.a["setting-section-right"]},i.a.createElement("span",{className:Et.a["setting-name"]+" "+Et.a["setting-name-right"]+" "+Et.a["setting-name-paper-margin-left"]},"左"),i.a.createElement(Ot.a,{defaultValue:this.getMarginLeft(),minValue:jt.paperMarginLeft.min,maxValue:jt.paperMarginLeft.max,step:jt.paperMarginLeft.step,round:jt.paperMarginLeft.round,onChange:this.setMarginLeft,ref:function(t){e._marginLeftInputRef=t}}),i.a.createElement("span",{className:Et.a["unit-label"]},"cm"),i.a.createElement("span",{className:Et.a["setting-name"]+" "+Et.a["setting-name-right"]+" "+Et.a["setting-name-paper-margin-right"]},"右"),i.a.createElement(Ot.a,{defaultValue:this.getMarginRight(),minValue:jt.paperMarginRight.min,maxValue:jt.paperMarginRight.max,step:jt.paperMarginRight.step,round:jt.paperMarginRight.round,onChange:this.setMarginRight,ref:function(t){e._marginRightInputRef=t}}),i.a.createElement("span",{className:Et.a["unit-label"]},"cm"),i.a.createElement("span",{className:Et.a["number-input-error-text-combine"]},this.updatePaperMarginLRNumberInputState()))),i.a.createElement("div",{className:Et.a["setting-section"]+" "+Et.a["setting-section-paper-margin-top-and-bottom"]},i.a.createElement("div",{className:Et.a["setting-section-left"]},i.a.createElement("span",{className:Et.a["setting-name"]+" "+Et.a["setting-name-placeholder"]})),i.a.createElement("div",{className:Et.a["setting-section-right"]},i.a.createElement("span",{className:Et.a["setting-name"]+" "+Et.a["setting-name-right"]+" "+Et.a["setting-name-paper-margin-top"]},"上"),i.a.createElement(Ot.a,{defaultValue:this.getMarginTop(),minValue:jt.paperMarginTop.min,maxValue:jt.paperMarginTop.max,step:jt.paperMarginTop.step,round:jt.paperMarginTop.round,onChange:this.setMarginTop,ref:function(t){e._marginTopInputRef=t}}),i.a.createElement("span",{className:Et.a["unit-label"]},"cm"),i.a.createElement("span",{className:Et.a["setting-name"]+" "+Et.a["setting-name-right"]+" "+Et.a["setting-name-paper-margin-bottom"]},"下"),i.a.createElement(Ot.a,{defaultValue:this.getMarginBottom(),minValue:jt.paperMarginBottom.min,maxValue:jt.paperMarginBottom.max,step:jt.paperMarginBottom.step,round:jt.paperMarginBottom.round,onChange:this.setMarginBottom,ref:function(t){e._marginBottomInputRef=t}}),i.a.createElement("span",{className:Et.a["unit-label"]},"cm"),i.a.createElement("span",{className:Et.a["number-input-error-text-combine"]},this.updatePaperMarginTBNumberInputState())))),i.a.createElement("div",{className:Et.a["preview-container"]},i.a.createElement("canvas",{width:this.previewCanvasWidth,height:this.previewCanvasHeight,ref:function(t){e._canvas=t}}))),i.a.createElement("div",{className:Et.a["bottom-btns"]},i.a.createElement(H.a,{style:{marginRight:"20px"},onClick:this.handleCancelButtonClick},"取消"),i.a.createElement(H.a,{type:"primary",onClick:this.handleConfirmButtonClick},"确定")))},t}(i.a.Component),Ht=function(){function e(e){var t=this;this.handler=e,this.handleCancel=function(){t.closePanel()},this.handleConfirm=function(e){t.handler.setPageSettingData(e),t.closePanel()}}return e.prototype.renderContent=function(){var e=this.handler.getPageSettingData();return i.a.createElement(Ft,{onCancel:this.handleCancel,onConfirm:this.handleConfirm,defaultData:e})},e.prototype.showPanel=function(){this.closePanel(),this._modal=W.a.confirm({title:null,style:{width:734,height:450},footer:null,content:this.renderContent()}),c.ReportHelper.tdwReport({opername:"doc_word_editor",module:"page",action:"pageoption_show"})},e.prototype.closePanel=function(){this._modal&&(this._modal.close(),this._modal=null)},e}();!function(e){e.ESCAPE="escape"}(Xe||(Xe={}));var Bt,Ut=[{keyBindings:{win:c.KeyCode.ESCAPE,mac:c.KeyCode.ESCAPE},action:Xe.ESCAPE}],Vt=(n(341),function(){return(Vt=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)}),Wt=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Gt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},zt=[{name:"insert-page-header",content:"插入页眉",shouldDisabled:function(e){return!(!e.permission||e.permission.isEditable)||e.editor.selection.storyInfo.storyProp.storyType!==c.StoryType.MainTextStory},onClick:function(e,t){t.updateMainDocRange(e.editor.selection.gcpRange),t.insertHeaderFooter(c.StoryType.PrimaryHeaderStory)}},{name:"insert-page-footer",content:"插入页脚",shouldDisabled:function(e){return!(!e.permission||e.permission.isEditable)||e.editor.selection.storyInfo.storyProp.storyType!==c.StoryType.MainTextStory},onClick:function(e,t){t.updateMainDocRange(e.editor.selection.gcpRange),t.insertHeaderFooter(c.StoryType.PrimaryFooterStory)}},{name:"page-settings",content:"页面设置",shouldDisabled:function(e){return!(!e.permission||e.permission.isEditable)},onClick:function(e,t){t.panelManager.showPanel()}}],Kt=function(){function e(e){this.workbench=e,this.lastMainDocRange=c.GCPRange.emptyRange(),this.panelManager=new Ht(this)}return e.prototype.$onInit=function(e){var t,n,o=this;this.editor=e,e.registerPlugin((t=this,(n={})[Xe.ESCAPE]=function(e,n){e&&e instanceof c.MeloEditor&&t.restoreMainDocRange(),n()},n)),e.surface.keymapManager.addKeymaps(Ut),e.on(c.RenderNotificationTypes.HEADERFOOTER_DBCLICK,(function(e){e&&W.a.confirm({content:"即将开始编辑页"+(e.isHeader?"眉":"脚")+"，点击确认继续。",onOk:function(){o.lastMainDocRange=e.lastRange;var t=e.isHeader?c.StoryType.PrimaryHeaderStory:c.StoryType.PrimaryFooterStory;e.shouldInsert?(o.insertHeaderFooter(t),c.ReportHelper.tdwReport({opername:"doc_word_editor",module:e.isHeader?"header":"footer",action:"dclk_insert"})):(e.range&&o.editor.setRangeTo(e.range,{forceNotify:!0}),c.ReportHelper.tdwReport({opername:"doc_word_editor",module:e.isHeader?"header":"footer",action:"dclk_edit"}))},onCancel:function(){c.ReportHelper.tdwReport({opername:"doc_word_editor",module:e.isHeader?"header":"footer",action:"dclk_cancel"})}})}),this),this.editor.addDecorator(c.DecoratorTypes.HeaderFooter,(function(e){var t=null,n={},r=o.editor.selection.storyInfo;if(Object(c.isHeaderStory)(r.storyProp.storyType)||Object(c.isFooterStory)(r.storyProp.storyType))t=o.getHeaderFooterLine(e);else if(e.storyId&&Object(c.isPageHeaderBox)(e)){var i=o.editor.service.getDocument().findStoryInfoFromId(e.storyId);i&&1===i.range.len&&(n.visibility="hidden")}return{component:t,overrideStyle:n}})),this.editor.clipboardManager.addPasteDstProcessor(c.PasteDstType.HeaderFooter,(function(e,t){c.OperationUtil.filterSpecialOps(e,c.FilterOpType.Table|c.FilterOpType.TitleStyle|c.FilterOpType.Plugin);var n=t.getSelection().validDeleteRange(),o=c.OperationFactory.getOp(c.OperationType.DeleteText,{range:n});return o&&e.insertOperation(o,0),Object(Rt.a)(e)}))},e.prototype.$beforeDestroy=function(){this.editor&&(this.editor.removeListener(c.RenderNotificationTypes.HEADERFOOTER_DBCLICK,this),this.editor=null),this.lastMainDocRange=c.GCPRange.emptyRange()},e.prototype.insertHeaderFooter=function(e){var t;switch(e){case c.StoryType.PrimaryHeaderStory:t=c.StoryType.PrimaryFooterStory;break;case c.StoryType.PrimaryFooterStory:t=c.StoryType.PrimaryHeaderStory;break;case c.StoryType.FirstPageHeaderStory:t=c.StoryType.FirstPageFooterStory;break;case c.StoryType.FirstPageFooterStory:t=c.StoryType.FirstPageHeaderStory;break;case c.StoryType.EvenPagesHeaderStory:t=c.StoryType.EvenPagesFooterStory;break;case c.StoryType.EvenPagesFooterStory:t=c.StoryType.EvenPagesHeaderStory}if(!t)return"";var n=this.insertHeaderOrFooter(e);return this.insertHeaderOrFooter(t),this.setRangeToHeaderFooter(n),n},e.prototype.insertHeaderOrFooter=function(e){var t=this.editor.service.getSelection().getSectionFormat().getHeaderFooterStoryId(e);if(t&&t!==c.TDConstants.Undefined)return t;var n=Math.random().toString(36).substr(2,6),o=new c.ParaProperty;o.textAlignment=c.TextAlignmentType.Center,Object(c.isHeaderStory)(e)&&(o.borderType=c.BorderTypes.Bottom);var r=new c.ParaBreakSpan;r.fontSize=180,this.editor.service.getDocument().insertStory(e,n,o,r);var i=this.editor.service.getSelection().range();return this.editor.service.getSelection().getSectionFormat().setHeaderFooterStoryId(e,n),this.editor.setRangeTo(i),c.ReportHelper.tdwReport({opername:"doc_word_editor",module:Object(c.isHeaderStory)(e)?"header":"footer",action:"insert"}),n},e.prototype.setRangeToHeaderFooter=function(e){var t=this.editor.service.getDocument().findStoryInfoFromId(e);t&&this.editor.setRangeTo(new c.GCPRange(t.range.end(),0),{forceNotify:!0})},e.prototype.getCurrentSection=function(){return this.editor.service.getDocument().getRange(0,0).getSectionFormat()},e.prototype.getPageSettingData=function(){var e=this.getCurrentSection();return{pageWidth:e.getPageWidth(),pageHeight:e.getPageHeight(),marginTop:e.getMarginTop(),marginRight:e.getMarginRight(),marginBottom:e.getMarginBottom(),marginLeft:e.getMarginLeft()}},e.prototype.setPageSettingData=function(e){if(e){var t=this.getPageSettingData(),n=Ct.SectionFormat.createEmptySectionFormat();void 0!==e.pageWidth&&e.pageWidth!==c.TDConstants.Undefined&&n.setPageWidth(e.pageWidth),void 0!==e.pageHeight&&e.pageHeight!==c.TDConstants.Undefined&&n.setPageHeight(e.pageHeight),void 0!==e.marginTop&&e.marginTop!==c.TDConstants.Undefined&&n.setMarginTop(e.marginTop),void 0!==e.marginRight&&e.marginRight!==c.TDConstants.Undefined&&n.setMarginRight(e.marginRight),void 0!==e.marginBottom&&e.marginBottom!==c.TDConstants.Undefined&&n.setMarginBottom(e.marginBottom),void 0!==e.marginLeft&&e.marginLeft!==c.TDConstants.Undefined&&n.setMarginLeft(e.marginLeft),this.editor.service.getDocument().getRange(0,0).setSectionFormat(n),this.workbench.emit("$sectionChanged",{cur:e,old:t})}},e.prototype.updateMainDocRange=function(e){this.lastMainDocRange=e},e.prototype.restoreMainDocRange=function(){this.editor.setRangeTo(this.lastMainDocRange)},e.prototype.toggleHeaderSeparator=function(){var e=this.editor.service.getSelection();if(e.storyType()===c.TDStoryType.PrimaryHeaderStory){var t=e.storyRange(),n=this.editor.service.getDocument().getRange(t.end()-1,t.end()).getParagraphFormat(),o=c.BorderTypes.None;n.getBorderType()===c.BorderTypes.None&&(o=c.BorderTypes.Bottom),n.setBorderType(o)}},e.prototype.hasHeaderSeparator=function(e){var t=this.editor.service.getDocument().findStoryInfoFromId(e);if(t){var n=t.range;return this.editor.service.getDocument().getRange(n.end()-1,n.end()).getParagraphFormat().getBorderType()===c.BorderTypes.Bottom}return!1},e.prototype.getHeaderFooterLine=function(e){var t=this,n=Object(c.isPageHeaderBox)(e),o=n&&this.hasHeaderSeparator(e.storyId),r={};return n?r.bottom="0px":r.top="-1px",i.a.createElement("div",{style:Vt({maxHeight:"1px",width:"100%",borderTop:"1px dashed rgba(0, 0, 0, 0.1)",zIndex:1,position:"absolute"},r),onMouseDown:function(e){e.stopPropagation()},onMouseMove:function(e){e.stopPropagation()},onMouseUp:function(e){e.stopPropagation()},onContextMenu:function(e){e.stopPropagation()}},i.a.createElement(wt.a,{dropContent:i.a.createElement("div",{className:"select-list-wrapper",style:{marginLeft:"0px"}},i.a.createElement("div",{className:"select-list-box"},i.a.createElement("li",{className:"select-list-item",onClick:function(){t.editor.service.getSelection().insertField("PAGE","1",{wrapAfter:!0})}},i.a.createElement("div",{className:"select-list-item-wrapper"},i.a.createElement("div",{className:"select-list-item-box"},"插入页码"))),n?i.a.createElement("li",{className:o?"select-list-item select-list-item-selected":"select-list-item",onClick:function(){t.toggleHeaderSeparator(),c.ReportHelper.tdwReport({opername:"doc_word_editor",module:"header",action:o?"header_gap_turn_off":"header_gap_turn_on",ver7:"pc_layer"})}},i.a.createElement("div",{className:"select-list-item-wrapper"},i.a.createElement("div",{className:"select-list-item-box"},"页眉分割线"))):null)),alignment:"left",placement:n?"bottom":"top",style:{width:"55px",height:"26px",backgroundColor:"#fff",border:"1px solid rgb(227, 227, 227)",boxShadow:"rgba(0, 0, 0, 0.06) 0px 2px 6px 0px",position:"absolute",top:n?"-1px":"-28px",right:"5px"}},i.a.createElement("div",{style:{width:"44px",lineHeight:"26px",display:"inline-block",textAlign:"center"}},n?"页眉":"页脚"),i.a.createElement("div",{className:"toolbar-button-arrow-container"},i.a.createElement("div",{className:"toolbar-button-arrow"}))))},e=Wt([Object(m.i)({name:y.a.Section,scope:0,for:["melo"],menuItems:zt}),Gt("design:paramtypes",[m.B])],e)}();!function(e){e.BACKSPACE="backspace",e.DELETE="delete",e.ARROW_LEFT="moveLeft",e.ARROW_RIGHT="moveRight",e.SELECT_LEFT="selectLeft",e.SELECT_RIGHT="selectRight"}(Bt||(Bt={}));var qt,Zt=n(276),$t=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Qt=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Xt=function(){function e(e){this.contextService=e}return e.prototype.$onInit=function(e){var t,n;this.editor=e,this.editor.registerPlugin((t=this,(n={})[Bt.BACKSPACE]=function(e,n){var o=t.getFieldInfo(-1);o?e.service.getSelection().delete(o.fieldRange):n()},n[Bt.DELETE]=function(e,n){var o=t.getFieldInfo(0);o?e.service.getSelection().delete(o.fieldRange):n()},n[Bt.ARROW_LEFT]=function(e,n){var o=t.getFieldInfo(-1);o?e.service.getSelection().setRange(o.fieldRange.begin(),o.fieldRange.begin()):n()},n[Bt.ARROW_RIGHT]=function(e,n){var o=t.getFieldInfo(0);o?e.service.getSelection().setRange(o.fieldRange.end(),o.fieldRange.end()):n()},n)),e.clipboardManager.addCopyModelParser(c.LayoutInputNodeType.FieldCode,Zt.b)},e.prototype.$beforeDestroy=function(){},e.prototype.getFieldInfo=function(e){var t=this.editor.onSelection().range().begin()+e,n=this.editor.getFieldEngine();return n?n.getFieldInfo(t):null},e=$t([Object(m.i)({name:y.a.Fieldcode,scope:0,for:["melo"]}),Qt("design:paramtypes",[m.f])],e)}(),Yt=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Jt=function(e){function t(t){var n=e.call(this)||this;return n.handler=t,n.isAutoUpdate=!1,n.isInlineBlock=!0,n.isShowDropdowns=!1,n.isShowHover=!1,n}return Yt(t,e),t.prototype.parse=function(e,t){return""},t.prototype.handleFieldClick=function(e,t){this.handler.onClickMention(e,t)},t}(c.FieldcodeProcessor),en=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},tn=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},nn=function(){function e(e,t,n){var o=this;this.editor=e,this.context=t,this.mentionService=n,this.slr=this.scriptLoaderService.getScriptLoader();var r=this;t.isPublish||this.slr.listen("SL-INIT",(function(){o.slr.load("AtMessage",(function(e){var t=document.createElement("div");r.editor.view.getDom().appendChild(t),e.init(t,{onToastClick:function(e){r.highlightMention(e.mentionId)}}),r.AtMessage=e}))})),this.addEvents()}return e.prototype.addEvents=function(){var e=this;g.PlatformUtil.isTencentDocsIPadApp()&&this.editor.on(c.FocusBlurNotificationType.REQUEST_FOCUS,(function(){e.AtMessage&&e.hiddenAllMentionMenu()}),this),this.editor.on(c.FocusBlurNotificationType.ON_FOCUS,(function(){e.AtMessage&&e.hiddenAllMentionMenu()}),this),this.editor.on(c.FieldNotification.FieldInsert,(function(t){var n=t.fieldCodes,o=[],r=Object(M.c)().userInfo,i=r&&r.tinyid;n.forEach((function(e){var t=c.FieldcodeManager.getInstance().getFieldcodeInfo(e);t&&t.fieldName===c.FieldType.MENTION_QQ&&t.instructions[0]&&i===t.instructions[2]&&o.push({mentionId:t.instructions[0]})})),e.AtMessage&&(e.AtMessage.updateDocMention(),o.length>0&&e.AtMessage.sendMentionAction(o,(function(){})))}),this),this.editor.on(c.FieldNotification.FieldDelete,(function(t){var n=t.fieldCodes,o=[],r=Object(M.c)().userInfo,i=r&&r.tinyid;n.forEach((function(e){var t=c.FieldcodeManager.getInstance().getFieldcodeInfo(e);t&&t.fieldName===c.FieldType.MENTION_QQ&&t.instructions[0]&&i===t.instructions[2]&&o.push(t.instructions[0])})),e.AtMessage&&(e.AtMessage.updateDocMention(),o.length>0&&e.AtMessage.deleteMentionAction(o,(function(){})))}),this)},e.prototype.hiddenAllMentionMenu=function(){var e=this.context.getHandler(un);e&&e.stopMentionInput(),this.AtMessage&&(this.AtMessage.hideQuickRemindMenu(),this.AtMessage.cancelMentionAction())},e.prototype.onDestory=function(){this.editor.removeListener(c.FocusBlurNotificationType.REQUEST_FOCUS,this),this.editor.removeListener(c.FocusBlurNotificationType.ON_FOCUS,this),this.editor.removeListener(c.RenderNotificationTypes.SELECTION_CHANGE,this),this.editor.removeListener(c.FieldNotification.FieldDelete,this),this.editor.removeListener(c.FieldNotification.FieldInsert,this)},e.prototype.onClickMention=function(e,t){var n=this;setTimeout((function(){var o=n.getTextFragmentBoxOffset(t);o||((o=c.LayoutUtil.getOffsetPoint(t,c.BoxKind.Document)).x=Object(g.twipsToPx)(o.x),o.y=Object(g.twipsToPx)(o.y));var r=o.x,i=o.y,a=Object(g.twipsToPx)(t.totalBoxSize.height);i=i+a+30,n.AtMessage&&(n.AtMessage.hideQuickRemindMenu(),n.AtMessage.setQuickRemindMenu({mentionId:e,pos:{x:r,y:i},visible:!0,rowHeight:a},(function(){n.AtMessage.hideQuickRemindMenu()})))}),20)},e.prototype.getTextFragmentBoxOffset=function(e){var t=this.editor.getRoot().getElementsByClassName("melo-page-view")[0];if(t){var n=t.getBoundingClientRect();if(Object(c.isTextLineFragmentBox)(e)){var o=e.__node__;if(o){var r=o.getBoundingClientRect();return{x:(r.left-n.left)/this.editor.zoom,y:(r.top-n.top)/this.editor.zoom}}}}return null},e.prototype.highlightMention=function(e){if(e){var t=this.mentionService.getMentionRange(e,c.FieldType.MENTION_QQ);if(t){this.editor.setRangeTo(new c.GCPRange(t.end(),0),{forceNotify:!0,scrollToView:3});var n=document.getElementById(e);n&&(n.style.background="#fff4c4",setTimeout((function(){n.style.background=""}),3e3))}else P.a.show({message:"当前文档@人的信息已被删除",duration:2e3,autoClose:!0})}},e.prototype.insertMention=function(e){var t=this.editor.service.getSelection(),n=Object(M.c)().globalPadId;t.insertField(c.FieldType.MENTION_QQ+" "+e.mentionId+" "+e.uin+" "+e.mentionFrom.uid+" "+n,"@"+e.nick)},e.prototype.insertMentions=function(e){if(e&&e.length>0){var t=this.editor.service.getSelection(),n=[],o=Object(M.c)().globalPadId;e.forEach((function(e){var t={fieldCode:c.FieldType.MENTION_QQ+" "+e.mentionId+" "+e.uin+" "+e.mentionFrom.uid+" "+o,fieldResult:"@"+e.nick};n.push(t)})),t.insertFields(n)}},e.prototype.onKeyboardDown=function(e){this.AtMessage&&this.AtMessage.keyboardDown({type:e})},e.prototype.onMentionEditChange=function(e){var t=this;setTimeout((function(){var n=t.editor.viewSelection.archorPoint.getDocumentOffset(t.editor.zoom),o=0;t.editor.viewSelection.archorPoint&&(o=t.editor.viewSelection.archorPoint.lineHeight,n.y+=o),t.AtMessage&&(t.AtMessage.addMentionAction({pos:n,rowHeight:o},(function(e){var n=t.context.getHandler(un);if(n&&e&&e.length>0){var o=[];e.forEach((function(e){o.push({mentionId:e.mentionId})})),n.completeMentionEdit(e)}})),t.AtMessage.search(e,(function(){})))}))},e.prototype.hideMobilePanel=function(){this.editor&&(this.editor.fire(new c.PanelNotification(c.PanelNotificationType.MOBILE_PANEL_HIDE),!1),this.editor.fire(new c.FocusBlurNotification(c.FocusBlurNotificationType.REQUEST_BLUR),!1),this.editor.fire(new c.FocusBlurNotification(c.FocusBlurNotificationType.ON_BLUR)))},e.prototype.cancelMentionAction=function(){this.AtMessage&&this.AtMessage.cancelMentionAction()},en([Object(m.l)(),tn("design:type",X.a)],e.prototype,"scriptLoaderService",void 0),e}(),on=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)a.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return a},rn=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(on(arguments[t]));return e},an=function(){function e(e){this.service=e}return e.prototype.getSearchText=function(){var e=this.service.getSelection().range();if(0===e.length()&&e.begin()>0)for(var t=e.begin()-1;t>=0&&e.begin()-t<20;){var n=this.service.getDocument().getTextFromGcpRange(new c.GCPRange(t,1));if(n===c.PlaceholderChar.FieldEnd||n===c.PlaceholderChar.FieldSep||n===c.PlaceholderChar.FieldBegin)return null;if("@"===n){var o=e.begin()-t-1;return o<=0?"":this.service.getDocument().getTextFromGcpRange(new c.GCPRange(t+1,o))}if(n===c.PlaceholderChar.Space||n===c.PlaceholderChar.ParagraphBreak)return null;t-=1}return null},e.prototype.getSearchTextRange=function(){var e=this.service.getSelection().range();if(0===e.length()&&e.begin()>0)for(var t=e.begin()-1;t>=0&&e.begin()-t<20;){if("@"===this.service.getDocument().getTextFromGcpRange(new c.GCPRange(t,1)))return{start:t,end:e.begin()};t-=1}return null},e.prototype.getMentionById=function(e,t){var n=[],o=this.service.getDocument().getFields();return rn(o).forEach((function(o){var r=o.getFieldInfo();if(r){var i=c.FieldcodeManager.getInstance().getFieldcodeInfo(r.fieldCode);if(i.instructions[0]===e&&i.fieldName===t){var a={};return a.mentionId=i.instructions[0],a.uin=i.instructions[1],a.mentionFrom=i.instructions[2],n.push(a),n}}})),n},e.prototype.getMentionByRange=function(e,t){var n=[],o=this.service.getDocument().getRange(e.begin(),e.end()).getFields();return rn(o).forEach((function(e){var o=e.getFieldInfo();if(o){var r=c.FieldcodeManager.getInstance().getFieldcodeInfo(o.fieldCode);if(r.fieldName===t){var i={};return i.mentionId=r.instructions[0],i.uin=r.instructions[1],i.mentionFrom=r.instructions[2],n.push(i),n}}})),n},e.prototype.getAllMentions=function(e){var t=[],n=this.service.getDocument().getFields();return rn(n).forEach((function(n){var o=n.getFieldInfo();if(o){var r=c.FieldcodeManager.getInstance().getFieldcodeInfo(o.fieldCode);if(r.fieldName===e){var i={};return i.mentionId=r.instructions[0],i.uin=r.instructions[1],i.mentionFrom=r.instructions[2],t.push(i),t}}})),t},e.prototype.getMentionRange=function(e,t){var n=this.service.getDocument().getFields(),o=null;return rn(n).some((function(n){var r=n.getFieldInfo();if(r){var i=c.FieldcodeManager.getInstance().getFieldcodeInfo(r.fieldCode);if(i.instructions[0]===e&&i.fieldName===t)return o=n.getRange(),!0}return!1})),o||null},e}();!function(e){e.ARROW_UP="moveUp",e.ARROW_DOWN="moveDown",e.ARROW_LEFT="moveLeft",e.ARROW_RIGHT="moveRight",e.ENTER="enter",e.ESCAPE="escape"}(qt||(qt={}));var sn=[{keyBindings:{win:c.KeyCode.ESCAPE,mac:c.KeyCode.ESCAPE},action:qt.ESCAPE}],cn=function(e,t){if(!e.fieldInfo)return{html:"",plain:""};for(var n=e.fieldInfo.fieldResultRange,o=e.getTextStream().readText(n.gcpBegin,n.len),r="",i=e.getBeginChild();i;){if(i instanceof c.TextGroupNode)for(var a=i.getBeginChild();a;){if(a.getTextRange().equal(e.fieldInfo.fieldResultRange))a instanceof c.TextNode&&(a.replacedProp=a.getProperty()?new c.TextSpan(a.getProperty()):new c.TextSpan),r+=t.parse(a).html;a=a.getNextSibling()}i=i.getNextSibling()}return{html:r,plain:o}},ln=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},pn=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},un=function(){function e(e){this.contextService=e,this.isInputMentionStatus=!1,this.mentionManager=null,this.mentionType=c.FieldType.MENTION_QQ,this.context=e.context}return e.prototype.$onInit=function(e){var t,n;this.editor=e,this.mentionService=new an(this.editor.service),this.editor.registerPlugin((t=this,(n={})[qt.ARROW_UP]=function(e,n){t&&t.getIsInputMentionStatus()?t.onKeyboardDown("UP"):n()},n[qt.ARROW_DOWN]=function(e,n){t&&t.getIsInputMentionStatus()?t.onKeyboardDown("DOWN"):n()},n[qt.ARROW_LEFT]=function(e,n){t&&t.getIsInputMentionStatus()?t.onKeyboardDown("LEFT"):n()},n[qt.ARROW_RIGHT]=function(e,n){t&&t.getIsInputMentionStatus()?t.onKeyboardDown("RIGHT"):n()},n[qt.ENTER]=function(e,n){t&&t.getIsInputMentionStatus()?t.onKeyboardDown("SELECT"):n()},n[qt.ESCAPE]=function(e,n){t&&t.getIsInputMentionStatus()?t.onKeyboardDown("ESC"):n()},n)),this.editor.surface.keymapManager.addKeymaps(sn),this.initMentionManager(),this.initEvents(this.editor),this.initProcessor(),Zt.a.getInstance().registerFieldCodeParser(c.FieldType.MENTION_QQ,cn)},e.prototype.$beforeDestroy=function(){var e;this.editor.removeListener(c.StateNotification.ModelChange,this),this.editor.removeListener(c.HiddenEditorNotificationType.ON_INPUT,this),c.FieldcodeManager.getInstance().removeProcessor(this.mentionType),null===(e=this.mentionManager)||void 0===e||e.onDestory(),this.mentionManager=null},e.prototype.getMentionService=function(){return this.mentionService},e.prototype.initProcessor=function(){var e=c.FieldcodeManager.getInstance();e.getProcessor(this.mentionType)&&e.removeProcessor(this.mentionType),e.addProcessor(this.mentionType,new Jt(this))},e.prototype.initEvents=function(e){var t=this;e.isEditable()&&(e.on(c.StateNotification.ModelChange,(function(){if(t.context.isOnline()&&t.editor.service.getDocument().storyId===c.StoryID.MainDocId&&t.isInputMentionStatus){var e=t.getMentionService().getSearchText();"string"==typeof e?t.onMentionEditChange(e):(t.isInputMentionStatus=!1,t.mentionManager&&t.mentionManager.cancelMentionAction())}}),this),e.on(c.HiddenEditorNotificationType.ON_INPUT,(function(e){t.context.isOnline()&&(t.editor.service.getDocument().storyId===c.StoryID.MainDocId&&e&&e.data&&t.editor&&"@"===e.data&&(t.isInputMentionStatus=!0,t.onMentionEditChange("")))}),this))},e.prototype.initMentionManager=function(){this.mentionManager=new nn(this.editor,this.context,this.mentionService),this.mentionType=c.FieldType.MENTION_QQ},e.prototype.stopMentionInput=function(){this.isInputMentionStatus=!1},e.prototype.onPermissionChange=function(){this.destroy(),this.initProcessor(),this.initEvents(this.editor),this.mentionManager&&this.mentionManager.addEvents()},e.prototype.removeEvents=function(){this.editor&&(this.editor.removeListener(c.StateNotification.ModelChange,this),this.editor.removeListener(c.HiddenEditorNotificationType.ON_INPUT,this))},e.prototype.removeProcessor=function(){c.FieldcodeManager.getInstance().removeProcessor(this.mentionType)},e.prototype.destroy=function(){this.removeEvents(),this.removeProcessor(),this.isInputMentionStatus=!1,this.mentionManager.onDestory()},e.prototype.getIsInputMentionStatus=function(){return this.isInputMentionStatus},e.prototype.completeMentionEdit=function(e){if(this.isInputMentionStatus=!1,e){var t=this.getMentionService().getSearchTextRange();t&&(this.editor.service.getSelection().setRange(t.start,t.end),this.insertMentions(e))}},e.prototype.insertAtTarget=function(){this.editor.onSelection().typeText("@"),this.isInputMentionStatus=!0,this.onMentionEditChange("")},e.prototype.getMentions=function(e){return e?this.getMentionService().getMentionById(e,this.mentionType):this.getMentionService().getAllMentions(this.mentionType)},e.prototype.onMentionEditChange=function(e){this.mentionManager.onMentionEditChange(e)},e.prototype.onClickMention=function(e,t){e&&this.mentionManager.onClickMention(e,t)},e.prototype.onKeyboardDown=function(e){e&&("ESC"===e&&(this.isInputMentionStatus=!1,this.mentionManager&&this.mentionManager.cancelMentionAction()),"SELECT"===e&&(this.isInputMentionStatus=!1),this.mentionManager.onKeyboardDown(e))},e.prototype.highlightMention=function(e){e&&this.mentionManager.highlightMention(e)},e.prototype.insertMention=function(e){e&&this.mentionManager.insertMention(e)},e.prototype.insertMentions=function(e){e&&this.mentionManager.insertMentions(e)},e=ln([Object(m.i)({name:y.a.FieldcodeMention,scope:0,for:["melo"]}),pn("design:paramtypes",[m.f])],e)}();var dn=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},hn=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},fn=[{name:"page-header-footer",content:"页眉页脚/页码",shouldDisabled:function(e){return!(!e.permission||e.permission.isEditable)}},{name:"insert-page-info",content:"页眉页脚/页码",icon:i.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"},i.a.createElement("g",{fill:"none",fillRule:"evenodd"},i.a.createElement("path",{fill:"#444D5B",fillRule:"nonzero",d:"M14.817 3c.276 0 .54.114.73.316l3.183 3.396c.173.185.27.43.27.683V19c0 .552-.448 1-1 1H5c-.552 0-1-.448-1-1V4c0-.552.448-1 1-1h9.817zM13.7 4.3H5.3v14.4h12.4V8.299l-4 .001v-4zM16 15.7V17H7v-1.3h9zM12 6v1.3H7V6h5zm3-1.365v2.364h2.217L15 4.635z"}))),shouldDisabled:function(e){return!(!e.permission||e.permission.isEditable)}},{name:"insert-page-number",content:"插入页码",shouldDisabled:function(e){return!(!e.permission||e.permission.isEditable)}},{name:"insert-page-number-at-cursor",content:"当前位置",onClick:function(e,t){t.insertPage("as-is")},shouldDisabled:function(e){var t=e.editor.selection.storyInfo.storyProp.storyType;return[c.StoryType.PrimaryHeaderStory,c.StoryType.PrimaryFooterStory].indexOf(t)<0}},{name:"insert-page-number-at-header",content:"位于页眉",onClick:function(e,t){t.insertPage("header")}},{name:"insert-page-number-at-footer",content:"位于页脚",onClick:function(e,t){t.insertPage("footer")}},{name:"format-page-number",content:"页码格式",shouldDisabled:function(e){return!(!e.permission||e.permission.isEditable)}},{name:"format-page-number-start-from-1",content:"页码从 1 开始计数",shouldCheck:function(e,t){return 1===t.getPageStart()},onClick:function(e,t){t.setPageStart(1)}},{name:"format-page-number-start-from-0",content:"页码从 0 开始计数",shouldCheck:function(e,t){return 0===t.getPageStart()},onClick:function(e,t){t.setPageStart(0)}}],mn=function(){function e(e){this.contextService=e}return e.prototype.$onInit=function(e){this.editor=e,this.sectionHandler=this.contextService.context.getHandler(Kt)},e.prototype.$beforeDestroy=function(){},e.prototype.insertPage=function(e){var t=this.editor.selection.storyInfo.storyProp.storyType;("header"===e&&t!==c.StoryType.PrimaryHeaderStory||"footer"===e&&t!==c.StoryType.PrimaryFooterStory)&&this.focusToHeaderFooter(e);var n=this.editor.service.getSelection(),o=n.isSelectionCollapseAtParaEnd();n.insertField("PAGE","1",{wrapAfter:"as-is"!==e&&!o}),c.ReportHelper.tdwReport({opername:"doc_word_editor",module:"pagenumbers",action:"insert",obj3:"as-is"!==e?e:void 0})},e.prototype.setPageStart=function(e){this.sectionHandler.getCurrentSection().setPageStartAt(e),c.ReportHelper.tdwReport({opername:"doc_word_editor",module:"pagenumbers",action:"numberbegin_set",obj3:"from"+e})},e.prototype.getPageStart=function(){return this.sectionHandler.getCurrentSection().getPageStartAt()},e.prototype.focusToHeaderFooter=function(e){var t=c.StoryType.PrimaryHeaderStory;"footer"===e&&(t=c.StoryType.PrimaryFooterStory);var n=this.sectionHandler.insertHeaderFooter(t),o=this.editor.service.getDocument().findStoryInfoFromId(n);o&&"header"===e?this.editor.setRangeTo(new c.GCPRange(o.range.begin(),0)):o&&"footer"===e&&this.editor.setRangeTo(new c.GCPRange(o.range.end(),0))},e=dn([Object(m.i)({menuItems:fn,name:y.a.FieldcodePage,scope:0,for:["melo"]}),hn("design:paramtypes",[m.f])],e)}(),gn=n(346),yn=new Map([[c.NumberListFormat.Number,"decimal"],[c.NumberListFormat.LowerLetter,"lower-alpha"],[c.NumberListFormat.UpperLetter,"upper-alpha"],[c.NumberListFormat.LowerRoman,"lower-roman"],[c.NumberListFormat.UpperRoman,"upper-roman"],[c.NumberListFormat.ChineseCountingThousand,"cjk-ideographic"]]),vn=new Map([[c.BulletText.Circle,"disc"],[c.BulletText.HollowCircle,"circle"],[c.BulletText.Square,"square"],[c.BulletText.Diamond,"disc"],[c.BulletText.Star,"disc"],[c.BulletText.Hook,"disc"],[c.BulletText.Arrow,"disc"]]),bn=function(){function e(){}return e.getHtmlListStyle=function(e){if(c.ListUtils.isNumberedFormat(e.listFormat))return yn.get(e.listFormat);var t=c.ListUtils.isTaskFormat(e.listFormat)?c.BulletText.Square:e.listText;return vn.get(t)},e}();function Cn(e,t){var n="";if(e.listMarkerSpanProp&&(n=(n+=c.CssUtil.computeTextSpanFullStyles(e.listMarkerSpanProp).cssText).replace(/"/g,"")),e.characterUnitLeftIndent?n+=";margin-left: "+(e.characterUnitLeftIndent-(t?t.characterUnitLeftIndent:0)).toString()+"em":e.leftIndent&&(n+=";margin-left: "+Object(g.twipsToPx)(e.leftIndent-(t?t.leftIndent:0)).toString()+"px"),e.characterUnitRightIndent?n+=";margin-right: "+(e.characterUnitRightIndent-(t?t.characterUnitRightIndent:0)).toString()+"em":e.rightIndent&&(n+=";margin-right: "+Object(g.twipsToPx)(e.rightIndent-(t?t.rightIndent:0)).toString()+"px"),e.characterUnitSpecialIndent<0)n+=";padding-left: "+(c.Defaults.listDefaultHanging-e.characterUnitSpecialIndent).toString()+"em;";else if(e.specialIndent<0){var o=e.listMarkerSpanProp?e.listMarkerSpanProp.fontSize:c.Defaults.fontSize;n+=";padding-left: "+(Object(g.twipsToPx)(c.Defaults.listDefaultHanging*o)-e.specialIndent).toString()+"px"}return{prefix:'<li style="'+n+'">',suffix:"</li>"}}function _n(e){var t=function(e){return bn.getHtmlListStyle({listFormat:e.listFmt,listText:e.lvlText})}(e),n=t?"list-style-type:"+t:"";return e.isBullet||e.isTask?{prefix:'<ul style="'+n+'">',suffix:"</ul>"}:e.isNumbered?{prefix:'<ol start="'+(e.order+1).toString()+'" style="'+n+'">',suffix:"</ol>"}:void 0}var wn=/(<.+?style=")(.+?)(".*?>)/,Rn=/(margin-(left|right)\s*:.+?(;|$))|(text-indent\s*:-.+?(;|$))/g;function Sn(e){var t=wn.exec(e);if(t&&t[1]&&t[2]&&t[3]){var n=t[2].replace(Rn,"");return""+t[1]+n+t[3]+e.substr(t[0].length)}return e}function En(e){var t="\t".repeat(e.listLevel);return e.isTask?t+="■ ":t+=e.actualText+" ",t}var Tn=function(e,t,n,o){for(var r,i,a,s="",l="",p=null,u=e,d=n;u;){var h=u.getProperty();if(u instanceof c.ParagraphNode&&h instanceof c.ListInfo&&(i=void 0,a=void 0,i=(r=u).getGCPRange(),1===(a=r.getLimitRanges()).length&&i.gcpBegin===a[0].gcpBegin&&i.len===a[0].len)){if(p){if(h.listLevel<p.listLevel)return d.html+=s,u;if(h.listLevel>p.listLevel){u=Tn(u,t,n,h);continue}}else{var f=_n(h);f&&(d.html+=f.prefix,s=f.suffix)}d.html+=l,l="";var m=Cn(h,o);d.html+=m.prefix,d.plain+=En(h),p=h}else g.Logger.error("listParser only support paragraphNode as children");var y=t.parse(u);d.html+=Sn(y.html),d.plain+=y.plain,u=u.getNextSibling()}return d.html+=l+s,null},Pn=function(e,t){var n=e.getListManager(),o={html:"",plain:""},r=e.getBeginChild();return r?n?(Tn(r,t,o),o):(g.Logger.error("listManager not exist"),function(e,t){for(var n="<div class='fall_back'>",o="",r=e.getBeginChild();r;){for(var i=r.getBeginChild();i;){var a=t.parse(i);n+=a.html,o+=a.plain,i=i.getNextSibling()}r=r.getNextSibling()}return{html:n+="</div>",plain:o}}(e,t)):o},In=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},xn=function(){function e(){}return e.prototype.$onInit=function(e){e.clipboardManager.addCopyModelParser(c.LayoutInputNodeType.List,Pn)},e=In([Object(m.i)({name:y.a.ListReadonly,scope:0,for:["melo"]})],e)}(),On=(n(301),n(348),function(){function e(){}return e.export=function(e){return new Promise((function(t,n){var o="//docs.qq.com/cgi-bin/redirect/"+e.creatorDomain+"/ep/pad/export/"+e.padId+"?ver=2";o=N.a.addFromParam(o,N.a.getEnvParam()),w.a.ajax({url:o,type:"POST",data:{v:2,infos:""},timeout:6e4,success:function(e,o){"success"===o&&e.s?t(e):n({status:o})},error:function(e){n(e)}})}))},e}()),Ln=n(349),Mn=[{name:"export-as",content:"导出为",respectOffline:!0,preventDismiss:!0,shouldDisabled:function(e){return!(e.permission&&e.permission.canCopyDoc)}},{name:"export-as-docx",content:"本地Word文档(.docx)",onClick:function(e,t){var n=e.editor,o=e.clientVars;t.exportAsDocx(n,o)}}],Nn=[{name:"export-as-docx",content:"导出为 Word",respectOffline:!0,iconClass:n.n(Ln).a["icon-menu-export"],shouldHide:function(){return!(p.a.getInstance().canCopyDoc&&(window.mqq&&window.mqq.compare("7.9.7")>=0&&!g.PlatformUtil.isQQMiniProgram()||g.PlatformUtil.isQQMiniProgram()&&g.UAUtil.versionToNum(Object(g.getUrlParameter)("qq_version"))>=80105||!g.PlatformUtil.isQQ()&&!g.PlatformUtil.isQQMiniProgram()&&!g.PlatformUtil.isTim()&&!0||!1)&&"complete"===document.readyState)},afterShow:function(){c.ReportHelper.tdwReport({opername:"doc_export",module:"mobile_export",action:"expo_export"})},onClick:function(e,t){t.exportAsDocx(e.editor,e.clientVars),c.ReportHelper.tdwReport({opername:"doc_export",module:"mobile_export",action:"clk_export"})}}],An=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Dn=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},kn=function(){function e(e,t){this.fileHandler=e,this.workbench=t,this.toast=null}return e.prototype.$onInit=function(){var e=this;this.workbench.listen("$requestExport",(function(t){var n=t.editor,o=t.clientVars;e.exportAsDocx(n,o)}))},e.prototype.checkTables=function(e){if(!e)return!1;for(var t=e.service.getDocument().getTables(),n=0;n<t.count();n++){var o=t.item(n);if(!o)return!1;if(!o.getTableInfo())return!1}return!0},e.prototype.exportAsDocx=function(e,t){var n=this;if(this.toast&&(this.toast.close(),this.toast=null),this.checkTables(e)){var o=(new Date).getTime();P.a.show({message:"正在导出，请稍候...",duration:3e3,autoClose:!0}),c.ReportHelper.tdwReport({opername:"doc_word_file",module:"save_as",action:"save_as_docx"}),On.export(t).then((function(e){n.afterExport(!0,t);var r="/ep/pad/exportfile/"+t.padId+"?s="+e.s,i="exportIframe";w()("#"+i).remove();w()('<iframe id="exportIframe" src="" style="display:none;"></iframe>').appendTo(document.body).attr("src",r);var a=(new Date).getTime()-o;c.ReportHelper.tdwReport({opername:"doc_export",module:"export_fail",action:"count",obj2:location.href,obj3:1,ver1:""+a})})).catch((function(e){if(g.PlatformUtil.isQQMiniProgram()&&window.mqq){var o=encodeURIComponent(JSON.stringify({success:!1}));window.wx&&window.wx.miniProgram&&window.wx.miniProgram.navigateTo({url:"/pages/qqNative/qqNative?action=openExportedFile&data="+o})}else 0;n.afterExport(!1,t),c.ReportHelper.tdwReport({opername:"doc_export",module:"export_fail",action:"count",obj2:location.href,obj3:2}),e.status})).finally((function(){n.toast&&(n.toast.close(),n.toast=null)}))}else P.a.show({message:"导出失败，请稍后重试。",duration:2e3,autoClose:!1,closable:!0})},e.prototype.afterExport=function(e,t){var n=this;e||W.a.confirm({content:"导出不成功，请稍后重试。",title:"提示",maskClosable:!1,okText:"确定",cancelText:"我要反馈",onOk:function(){},onCancel:function(){n.fileHandler.goFeedbackPage(t)}})},e=An([Object(m.i)({name:y.a.FileExport,scope:0,for:["melo"],menuItems:Mn,mobileMenuItems:Nn}),Dn("design:paramtypes",[ee,m.B])],e)}(),jn=n(494),Fn=n(486),Hn=n(289),Bn=n.n(Hn),Un=n(351),Vn=function(e){var t=e.updateTime,n="0";t&&(n=Object(Fn.a)(t,"yyyy-MM-dd HH:mm:ss"));var o={loop:!1,autoplay:!0,prerender:!0,animationData:Un};return i.a.createElement("div",{style:{width:16,padding:"6px 0"}},i.a.createElement(Bn.a,{options:o,key:n}))},Wn=n(475),Gn=n(476),zn=n(477),Kn=n(495),qn=n(478);var Zn=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)a.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return a},$n=function(e){var t=e.updateTime,n=e.show,o=void 0!==n&&n,a=e.online,s=void 0===a||a,c=e.modified,l=void 0!==c&&c,p=e.modifiedBy,u=Zn(Object(r.useState)(""),2),d=u[0],h=u[1],f=Zn(Object(r.useState)(""),2),m=f[0],g=f[1];return Object(r.useEffect)((function(){if(t&&Object(Wn.a)(Date.now(),t)<5)g("已自动保存"),setTimeout((function(){t&&o&&(g(""),h("最近保存 "+Object(Fn.a)(t,"HH:mm")))}),3e3);else if(t){var e=l?"最近保存 "+Object(Fn.a)(t,"HH:mm"):"上次修改是"+p+"在"+function(e){var t=Date.now();if(Object(Wn.a)(t,e)<60)return"刚刚";var n=Object(Gn.a)(t,e);if(n<60)return n+"分钟前";var o=Object(zn.a)(t,e);if(o<24)return o+"小时前";var r=Object(Kn.a)(t,e);return r<8?r+"天前":Object(qn.a)(e)!==Object(qn.a)(t)?Object(Fn.a)(e,"yyyy年MM月"):Object(Fn.a)(e,"MM月dd日")}(t)+"进行的";h(e)}}),[t]),o?s?i.a.createElement("span",null,t?m||d:d||"所有修改都会自动保存云端"):i.a.createElement("span",{style:{borderBottom:"none",cursor:"auto"}},"正在离线编辑"):null},Qn=(n(350),n(247)),Xn=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Yn=function(e){function t(t){var n=e.call(this,t)||this;return n.USER_WIDTH=32,n.MORE_BTN_OFFSET=20,n.handleUserLeave=function(e){n.collablist&&n.collablist.userLeave&&(n.collablist.userLeave(e),n.props.onChange(n.getUserNumber()),setTimeout((function(){n.forceUpdate()}),0))},n.handleUserUpdate=function(e){n.collablist&&n.collablist.userJoinOrUpdate&&(n.collablist.userJoinOrUpdate(e),n.props.onChange(n.getUserNumber()),setTimeout((function(){n.forceUpdate()}),0))},n.state={maxCount:5},n.container=i.a.createElement("div",{id:"collaboration-users-titlebar"}),n}return Xn(t,e),t.prototype.componentDidMount=function(){var e=this;this.userSub=this.context.store.get("userEvent").subscribe((function(t){switch(t.type){case"join":case"update":e.handleUserUpdate(t.user);break;case"leave":e.handleUserLeave(t.user)}})),this.subscription=Object(Qn.a)(window,"resize").pipe(Object(qe.a)(50)).subscribe((function(){})),this.props.slr.listen("SL-INIT",(function(){e.props.slr.load("Collaboration",(function(t){var n=document.getElementById("collaboration-users-titlebar");if(n&&(t.init(n,{getClientVars:M.c,getInterfaces:function(t){e.collablist=t},eventNotice:function(){},ref:function(t){e.list=t}}),e.context.collabClient)){var o=e.context.collabClient.getUserSet();Object.values(o).forEach((function(t){e.handleUserUpdate(t)}))}})),e.props.slr.load("GroupTips",(function(e){var t=document.getElementById("titlebar-qqgroup-info");t&&e&&e.show(t)}))}))},t.prototype.componentWillUnmount=function(){this.subscription&&this.subscription.unsubscribe(),this.userSub&&this.userSub.unsubscribe()},t.prototype.getUserNumber=function(){try{return(this.collablist.getRealInvatedNum||this.collablist.getRealRenderedNum||function(){return 0})()}catch(e){return 0}},t.prototype.render=function(){var e=this,t={};return document.getElementsByClassName("user-facepile-inline-wrapper").length<=0&&(t={marginLeft:0}),i.a.createElement("div",{style:t,className:"collab-users",ref:function(t){e.node=t}},this.container)},t.contextType=m.h,t}(r.Component),Jn=function(){return i.a.createElement("svg",{id:"offlineSVG",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",style:{width:16,height:16}},i.a.createElement("path",{fill:"#fe6c6c",d:"M0,5.31A11.22,11.22,0,0,1,6.49,2.1v1A10.2,10.2,0,0,0,.74,6Z"}),i.a.createElement("path",{fill:"#fe6c6c",d:"M16,5.31L15.26,6a10.2,10.2,0,0,0-5.75-2.9v-1A11.22,11.22,0,0,1,16,5.31Z"}),i.a.createElement("path",{fill:"#fe6c6c",d:"M2.45,7.73a7.76,7.76,0,0,1,4-2.15v1A6.76,6.76,0,0,0,3.16,8.44Z"}),i.a.createElement("path",{fill:"#fe6c6c",d:"M13.55,7.73l-0.71.71A6.76,6.76,0,0,0,9.51,6.61v-1A7.76,7.76,0,0,1,13.55,7.73Z"}),i.a.createElement("path",{fill:"#fe6c6c",d:"M4.88,10.15a4.29,4.29,0,0,1,1.61-1v1.1a3.3,3.3,0,0,0-.91.63Z"}),i.a.createElement("path",{fill:"#fe6c6c",d:"M11.12,10.15l-0.7.71a3.3,3.3,0,0,0-.91-0.63V9.13A4.29,4.29,0,0,1,11.12,10.15Z"}),i.a.createElement("rect",{fill:"#fe6c6c",x:"7.5",y:"1.72",width:"1",height:"8.82"}),i.a.createElement("circle",{fill:"#fe6c6c",cx:"8",cy:"13.04",r:"0.98",transform:"translate(-6.88 9.48) rotate(-45)"}))},eo=n(77),to=n(162),no=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),oo=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},ro=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},io=function(e){function t(t){var n=e.call(this,t)||this;return n.intervalId=null,n.modified=!1,n.setDataToStorePlugin=function(e,t,o,r){o===to.c.UserChangeset&&r&&r.changeset&&n.callback&&n.callback(r.changeset),t()},n.handleUpdate=function(e){var t=n.context.clientVars;if(n.intervalId&&window.clearInterval(n.intervalId),e)n.modified=!0,n.setState({time:new Date,modifiedBy:""});else if(null!==n.state.time)n.setState({time:new Date(n.state.time)});else if(t&&t.lastModifyTime!==t.metaCreateTime)if(t.lastModifyUser!==t.userId&&""===n.state.modifiedBy){var o=t.lastModifyUser.split(".")[1];o&&mt.getUserMarkName(t,[o]).then((function(e){n.setState({time:new Date(t.lastModifyTime),modifiedBy:e[0]?e[0].markName.substr(0,7):""})}))}else n.setState({time:new Date(t.lastModifyTime),modifiedBy:n.state.modifiedBy});n.intervalId=window.setTimeout(n.handleUpdate,6e4)},n.handleClick=function(){n.state.isOnline&&n.workbench.emit("$showRevision"),c.ReportHelper.tdwReport({opername:"doc_menubar",module:"autosave_hyperlinks",action:"click"})},n.setCollabUserCount=function(e){n.setState({collabUserCount:e})},n.state={isOnline:!0,collabUserCount:1,time:null,modifiedBy:""},n}return no(t,e),t.prototype.componentDidMount=function(){var e,t=this;if(c.GlobalContext.registerPlugin(((e={})[to.b.SetData2Store]=this.setDataToStorePlugin,e)),!this.props.hideTips){var n=eo.a.create((function(e){t.callback=function(t){e.next(t)}}));this.subscription=n.pipe(Object(qe.a)(300)).subscribe((function(e){t.handleUpdate(!!e)})),this.handleUpdate()}this.props.hideTips&&this.props.hideUsers||(this.onlineSubscription=this.store.get(m.d.IsOnline).subscribe((function(){t.setState({isOnline:t.context.isOnline()})})))},t.prototype.componentWillUnmount=function(){var e;this.intervalId&&window.clearInterval(this.intervalId),this.subscription&&this.subscription.unsubscribe(),this.onlineSubscription&&this.onlineSubscription.unsubscribe(),c.GlobalContext.unRegisterPlugin(((e={})[to.b.SetData2Store]=this.setDataToStorePlugin,e))},t.prototype.render=function(){var e=this,t=p.a.getInstance(),n=this.state,o=n.time,r=n.isOnline,a=n.collabUserCount,s=this.props,c=s.hideTips,l=s.hideUsers,u=i.a.createElement("span",null,"所有修订都会自动保存云端，",i.a.createElement("br",null),"点击可查看具体修订记录。");return this.state.isOnline||(u="正在离线编辑，编辑内容已保存至本地，联网后将自动同步。"),i.a.createElement(i.a.Fragment,null,!l&&r&&i.a.createElement(Yn,{slr:this.props.slr,onChange:function(t){t!==a&&e.setCollabUserCount(t)}}),!c&&t.isEditable&&i.a.createElement(Ge.a,{containerOffsetY:-8,title:u,overlayStyle:{textAlign:"center"},style:{marginLeft:10,display:Object(M.c)().isLogin?void 0:"none"}},i.a.createElement("div",{id:"status-tips-container",onClick:this.handleClick},t.canEdit&&r&&i.a.createElement(Vn,{updateTime:o}),t.canEdit&&!r&&i.a.createElement(Jn,null),t.canEdit&&i.a.createElement($n,{updateTime:o,show:a<=1,online:r,modified:this.modified,modifiedBy:this.state.modifiedBy}))))},t.contextType=m.h,oo([Object(m.l)(),ro("design:type",m.x)],t.prototype,"store",void 0),oo([Object(m.l)(),ro("design:type",m.B)],t.prototype,"workbench",void 0),t}(r.Component),ao=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},so=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},co=function(){function e(e,t){var n=this;this.titlebar=e,this.store=t,this.handleUserJoin=function(e){n.store.update("userEvent",{type:"join",user:e.userInfo})},this.handleUserLeave=function(e){n.store.update("userEvent",{type:"leave",user:e.userInfo})},this.handleUserUpdate=function(e){n.store.update("userEvent",{type:"update",user:e.userInfo})},this.slr=this.scriptLoaderService.getScriptLoader(),this.store.register("userEvent",{type:null,user:null}),this.titlebar.hydrate("titlebar-collab-status",i.a.createElement(io,{slr:this.slr}))}return e.prototype.$onInit=function(e){e.on(l.b.ON_USER_INFO_UPDATE,this.handleUserUpdate),e.on(l.b.ON_USER_JOIN,this.handleUserJoin),e.on(l.b.ON_USER_LEAVE,this.handleUserLeave)},e.prototype.$beforeDestroy=function(e){e.removeCallBack(l.b.ON_USER_INFO_UPDATE,this.handleUserUpdate),e.removeCallBack(l.b.ON_USER_JOIN,this.handleUserJoin),e.removeCallBack(l.b.ON_USER_LEAVE,this.handleUserLeave)},ao([Object(m.l)(),so("design:type",X.a)],e.prototype,"scriptLoaderService",void 0),e=ao([Object(m.i)({name:y.a.CollabStatus,scope:0,for:["melo"]}),so("design:paramtypes",[it.a,m.x])],e)}(),lo=function(){function e(e,t){var n=this;this.SCROLL_POS_REPORT_INTERVAL=3e4,this.SCROLL_POS_REPORT_INTERVAL_4_IOS=1e4,this.PAD_EDITOR_OFFSET=50,this.location={},this.scrollRoot=null,this.padbody=null,this.editor=e,this.collabClient=t,this.scrollRoot=e.view.getScrollRoot(),this.padbody=document.getElementById("padbody"),this.taskId=window.setTimeout((function(){n.start()}),1e3)}return e.prototype.destroy=function(){this.taskId&&(clearTimeout(this.taskId),this.taskId=void 0)},e.prototype.start=function(){var e=this,t=function(t){void 0===t&&(t=!1);var n=!1;if(N.a.getIsMobile()){var o=void 0;p.a.getInstance().isEditable?o=e.scrollRoot.scrollTop:(o=e.padbody.scrollTop-e.PAD_EDITOR_OFFSET)<0&&(o=0),e.scrollLocation&&o===e.scrollLocation.mobileScrollTop||(e.location.mobileScrollTop=o,e.scrollLocation.mobileScrollTop=o,n=!0)}else{var r=e.scrollRoot.scrollTop;e.scrollLocation&&r===e.scrollLocation.pcScrollTop||(e.location.pcScrollTop=r,e.scrollLocation.pcScrollTop=r,n=!0)}var i=e.collabClient.getPadRev();e.scrollLocation&&e.scrollLocation.rev===i||(e.location.rev=i,e.scrollLocation.rev=i,n=!0),n&&(e.location.ts=(new Date).getTime(),t||w.a.ajax({url:"/sdc/updatebrowselocation",type:"post",data:{padid:Object(M.c)().padId,location:JSON.stringify(e.location)}}),g.LocalStorageUtil.setItem(Object(M.c)().padId+"_scroll_pos",JSON.stringify(e.location)))},n=function(){var t=e.collabClient.getPadRev();e.location||(e.location={pcScrollTop:0,mobileScrollTop:0,rev:t}),e.scrollLocation=location,N.a.getIsMobile()?e.location.mobileScrollTop&&e.location.mobileScrollTop>0&&(p.a.getInstance().isEditable?e.doScroll():e.padbody.scrollTop=e.location.mobileScrollTop+e.PAD_EDITOR_OFFSET):e.location.pcScrollTop&&e.location.pcScrollTop>0&&e.doScroll()};if(this.scrollRoot){var o=Object(g.throttle)((function(){t(!0)}),200);this.scrollRoot.addEventListener("scroll",o)}var r=g.LocalStorageUtil.getItem(Object(M.c)().padId+"_scroll_pos");if(r){var i=JSON.parse(r);i&&(this.location=i,n())}w.a.ajax({url:"/sdc/getbrowselocation?padid="+Object(M.c)().padId,type:"get",success:function(t){if(t&&0===t.retcode){var o=e.location&&e.location.ts?e.location.ts:0;e.location=t.result,e.location&&void 0===e.location.ts&&(e.location.ts=1),e.location&&void 0!==e.location.rev&&e.location.ts>o&&(g.LocalStorageUtil.setItem(Object(M.c)().padId+"_scroll_pos",JSON.stringify(e.location)),n())}}}),this.scrollLocation||n();var a=this.SCROLL_POS_REPORT_INTERVAL;setTimeout((function(){setInterval(t,a)}),200),window.addEventListener("beforeunload",(function(){t()}))},e.prototype.doScroll=function(){var e=this.scrollRoot.scrollHeight,t=0;return!!((t=N.a.getIsMobile()&&this.location?this.location.mobileScrollTop:this.location.pcScrollTop)&&t<e)&&(w()(this.scrollRoot).animate({scrollTop:t},5),!0)},e}(),po=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},uo=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},ho=function(){function e(e){this.contextService=e}return e.prototype.$onInit=function(e){this.contextService.context.isPublish||(this.scrollController=new lo(e,this.contextService.context.collabClient))},e.prototype.$beforeDestroy=function(){this.scrollController&&(this.scrollController.destroy(),this.scrollController=void 0)},e=po([Object(m.i)({name:y.a.ScrollPosition,scope:0,for:["melo"]}),uo("design:paramtypes",[m.f])],e)}(),fo=n(458),mo=function(e){var t=e,n=t.marginLeft,o=t.marginRight;return'<hr class="horizontal-splitline '+t.type+'" style="color:'+(t.fillColor||"#000000")+";marginLeft:"+n+"%;marginRight:"+o+'%;"></hr>'},go=function(e){var t=e.getProperty();return t&&t instanceof c.SplitlineProperty?{html:mo(t),plain:""}:{html:"",plain:""}},yo=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},vo=function(){function e(){}return e.prototype.$onInit=function(e){e.clipboardManager.addCopyContainerParser(c.ContainerType.Drawing,c.DrawingType.Splitline,go)},e=yo([Object(m.i)({name:y.a.SplitlineReadonly,scope:0,for:["melo"]})],e)}(),bo=n(490),Co=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},_o=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},wo=function(){function e(e,t){this.widgetService=e,this.textFlowHandler=t,this.slr=this.scriptLoaderService.getScriptLoader(),this.widgetService.float({name:"help-center",component:i.a.createElement("div",{id:"help-center"})})}return e.prototype.$onInit=function(){var e=this;this.slr.listen("SL-INIT",(function(){e.slr.load("HelpCenter",(function(t){var n=document.getElementById("help-center");n&&t.show(n,{from:"word",onText:function(){e.textFlowHandler&&e.textFlowHandler.showTextHistory()}})}))}))},Co([Object(m.l)(),_o("design:type",X.a)],e.prototype,"scriptLoaderService",void 0),e=Co([Object(m.i)({scope:1,name:y.a.HelpCenter}),_o("design:paramtypes",[m.A,bo.a])],e)}(),Ro=n(491),So=n(246),Eo=new(function(){function e(){this.offlineSwitch=this.OfflineSwitch(),this.codeVersion=this.CodeVersion()}return e.prototype.OfflineSwitch=function(){return!!(window.App&&window.App.GlobalConfig&&window.App.GlobalConfig.IsSupportStore)},e.prototype.CodeVersion=function(){return window.App&&window.App.GlobalConfig&&window.App.GlobalConfig.globalCodeVersion?window.App.GlobalConfig.globalCodeVersion:""},e}()),To=function(){function e(){}return e.getInstance=function(){return e._instance||(e._instance=new e),e._instance},e.prototype.showEnterOfflineEditTips=function(e){Eo.offlineSwitch||(e?this._offlineEditModeTips=P.a.show({message:"网络异常，离线编辑中，文档最新内容会在网络恢复后同步。",type:"info",autoClose:!1,closable:!0,style:{zIndex:3998}}):this._offlineReadonlyModeTips=P.a.show({message:"离线查看中，文档最新内容会在网络恢复后同步。",type:"info",autoClose:!0,closable:!0,duration:5e3}))},e.prototype.showRestoreOfflineDataTips=function(){Eo.offlineSwitch||(this._offlineDataRestoringTips=P.a.show({message:"正在同步离线内容....",type:"info",autoClose:!1,closable:!0}))},e.prototype.showAutoClosableRestoreOfflineDataTips=function(){Eo.offlineSwitch||P.a.show({message:"正在同步离线内容....",type:"info",autoClose:!0,duration:2e3,closable:!0})},e.prototype.dismissAll=function(){this._offlineEditModeTips&&this._offlineEditModeTips.close(),this._offlineReadonlyModeTips&&this._offlineReadonlyModeTips.close(),this._offlineDataRestoringTips&&this._offlineDataRestoringTips.close()},e}(),Po=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Io=function(){function e(){}return e.prototype.$onInit=function(e){e.on(So.c.ON_ENTER_OFFLINE_EDIT,(function(){To.getInstance().showEnterOfflineEditTips(p.a.getInstance().isEditable)}),this),e.on(So.c.ON_RESTORE_OFFLINE_DATA,(function(){To.getInstance().showRestoreOfflineDataTips()}),this),e.on(So.c.ON_RESTORE_OFFLINE_DATA_FINISH,(function(){To.getInstance().dismissAll()}),this),e.on(So.c.ON_WEBSOCKET_RECONNECTED_ONLINE,(function(e){To.getInstance().dismissAll(),e&&e.hasUncommittedChanges&&To.getInstance().showAutoClosableRestoreOfflineDataTips()}),this),e.on(So.c.ON_START_BLOCK_USER_EDIT,(function(){p.a.getInstance().setPrivilege({isBlocked:!0})}),this),e.on(So.c.ON_END_BLOCK_USER_EDIT,(function(){p.a.getInstance().setPrivilege({isBlocked:!1})}),this)},e.prototype.$beforeDestroy=function(e){e.removeListener(So.c.ON_ENTER_OFFLINE_EDIT,this),e.removeListener(So.c.ON_RESTORE_OFFLINE_DATA,this),e.removeListener(So.c.ON_RESTORE_OFFLINE_DATA_FINISH,this),e.removeListener(So.c.ON_WEBSOCKET_RECONNECTED_ONLINE,this),e.removeListener(So.c.ON_START_BLOCK_USER_EDIT,this),e.removeListener(So.c.ON_END_BLOCK_USER_EDIT,this)},e=Po([Object(m.i)({name:y.a.OfflineEdit,scope:0,for:["melo"]})],e)}(),xo=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{c(o.next(e))}catch(e){i(e)}}function s(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))},Oo=function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},Lo=function(){function e(){}return e.getModifier=function(e){return xo(this,void 0,void 0,(function(){return Oo(this,(function(t){return[2,new Promise((function(t,n){w.a.ajax({url:"//docs.qq.com/cgi-bin/online_docs/oplist_digest_get",xhrFields:{withCredentials:!0},data:{domain_id:e.domainId,pad_id:e.padId,detail_user_num:2,xsrf:Object(c.getXsrf)()},success:function(e){0===e.retcode?t(e):n()},error:function(e){n(e)}})}))]}))}))},e}(),Mo=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},No=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Ao=function(){function e(e){var t=this;this.featureService=e,this.formatText=function(e){for(var t="",n=0;n<e.oplist.length;n++){var o=e.oplist[n].nickname;if("string"==typeof o){var r=o.length>10?10:o.length;if(t.length+r>30){t=(t=t.slice(0,-1))+"等"+e.user_count+"人修改过该文档。";break}o.length>10&&(o=o.slice(0,10)+"..."),t=n===e.oplist.length-1?""+t+o+"修改过该文档。":""+t+o+"、"}}return t},this.showSnackbar=function(e){if(e.oplist){var n=t.formatText(e);P.a.show({message:n,action:"查看修订记录",autoClose:!1,closable:!0,type:"info",onClickAction:function(){try{c.ReportHelper.tdwReport({opername:"doc_update_notify",module:"doc_update_notify_toast",action:"clk_update_revise"})}catch(e){}var e=t.featureService.get(y.a.RevisionRecord);e&&e.revisionRecordController.show()},onClose:function(){try{c.ReportHelper.tdwReport({opername:"doc_update_notify",module:"doc_update_notify_toast",action:"clk_update_close"})}catch(e){}}})}}}return e.prototype.$onInit=function(e){var t=this,n=N.a.getQuery("u_n_source"),o=Object(g.removeURLParameter)(window.location.href,"u_n_source");if(n){window.history.replaceState(null,"",o);try{c.ReportHelper.tdwReport({opername:"doc_update_notify",module:"doc_update_notify_channe",action:{1:"update_notify_tdoc",2:"update_notify_qq",3:"update_notify_app",4:"update_notify_wechat"}[n]})}catch(e){}if(p.a.getInstance().isEditable){var r=Object(M.c)();Lo.getModifier(r).then((function(e){t.showSnackbar(e)}))}}},e.prototype.$beforeDestroy=function(){},e=Mo([Object(m.i)({name:y.a.UpdateNotice,scope:0,for:["melo"]}),No("design:paramtypes",[m.k])],e)}(),Do=n(257);var ko,jo=T.Snackbar,Fo=V.Modal,Ho=function(){function e(){}return e.getAuthorId=function(){return Object(c.getCookie)("uid")||""},e.getDocId=function(){return Object(M.c)().globalPadId},e.isCreator=function(){return Object(M.c)().isCreator},e.getUserName=function(){return Object(M.c)().userName},e.getUserAvatar=function(){return Object(M.c)().userPic},e.isDocCreator=function(){return Object(M.c)().isCreator},e.isCommentEditable=function(){if(this.isLogin()&&p.a.getInstance().isEditable)return!0;var e=Object(M.c)();return!(!e.privilegeAttribute||1!==e.privilegeAttribute.can_comment)},e.getSid=function(){return Object(M.c)().collab_client_vars.client.sid},e.isLogin=function(){return!0===Object(M.c)().isLogin},e.getUid=function(){return Object(M.c)().userInfo.tinyid||Object(M.c)().userInfo.uid||""},e.showErrorTips=function(e){jo.show({message:e,duration:3e3,autoClose:!0,type:"error"})},e.isMobile=function(){return!1},Object.defineProperty(e,"Modal",{get:function(){return Fo},enumerable:!0,configurable:!0}),e.confirmDelete=function(e){Fo.confirm({title:"删除批注",content:"删除后无法撤销，确认删除此条批注吗？",onOk:e,onCancel:function(){}})},e.getPermissionOnCommentOfAuthor=function(t){return this.isCommentEditable()?t!==e.getAuthorId()&&t?this.isDocCreator()?Do.b.Deletable:Do.b.Appendable:Do.b.Editable:Do.b.None},e.isLocalUpdateMessage=function(e){return this.getSid()===e&&this.getAuthorId().length>0},e}(),Bo=function(){function e(){}return Object.defineProperty(e,"defaultMode",{get:function(){return Do.f.External},enumerable:!0,configurable:!0}),e.getRecordStack=function(){var e=JSON.parse(g.LocalStorageUtil.getItem("word-comment-mode")||"[]");return Array.isArray(e)?e:[]},e.isMatchRecord=function(e,t,n){return Array.isArray(e)&&3===e.length&&e[0]===t&&e[1]===n},e.destroy=function(){this._mode=void 0},e.reverseFindIndex=function(e,t){for(var n=e.length-1;n>=0;--n)if(t(e[n]))return n;return-1},e.getMode=function(){var e=this;if(void 0!==this._mode)return this._mode;var t=this.getRecordStack(),n=Object(M.c)(),o=n.uin,r=n.globalPadId;if(o&&r&&Array.isArray(t)){var i=t.find((function(t){return e.isMatchRecord(t,o,r)}));if(i){var a=parseInt(i[2],10);if(a>=Do.f.External&&a<=Do.f.Embed)return this._mode=a,this._mode}}return this._mode=this.defaultMode,this._mode},e.setMode=function(e){var t=this;this._mode=e;var n=this.getRecordStack(),o=Object(M.c)(),r=o.uin,i=o.globalPadId;if(r&&i&&Array.isArray(n)){var a=this.reverseFindIndex(n,(function(e){return t.isMatchRecord(e,r,i)}));-1===a&&e!==this.defaultMode?(n.push([r,i,e]),n.length>200&&n.splice(0,n.length-200)):(n.splice(a,1),e!==this.defaultMode&&n.push([r,i,e])),g.LocalStorageUtil.setItem("word-comment-mode",JSON.stringify(n))}},e}(),Uo=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();!function(e){e.VisibilityChanged="CommentVisibilityChanged",e.ModeChanged="CommentModeChanged",e.PositionCollected="CommentPositionCollected",e.Count="CommentCount",e.ToolbarShow="CommentToolbarShow",e.ShortcutPositionChanged="CommentShortcutPositionChange"}(ko||(ko={}));var Vo=function(e){function t(t,n){var o=e.call(this,t)||this;return o.data=n,o}return Uo(t,e),t}(g.Notification),Wo=function(){function e(e){this._isHidden=!0,this._mode=Bo.getMode(),this._manager=e,this._editor=e.editor,this._views=[]}return e.prototype.registerViewType=function(e,t){var n=new t(this._manager);return this._views[e]=n,n},Object.defineProperty(e.prototype,"previewMode",{get:function(){var e=this._views[this._mode];return!!e&&e.previewMode},set:function(e){var t=this._views[this._mode];t&&(t.previewMode=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isEmbed",{get:function(){return this._mode===Do.f.Embed},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isExternal",{get:function(){return this._mode===Do.f.External},enumerable:!0,configurable:!0}),e.prototype.canCancel=function(e){var t=this._views[this._mode];return!t||t.canCancel(e)},Object.defineProperty(e.prototype,"canHide",{get:function(){var e=this._views[this._mode];return!e||e.canHide},enumerable:!0,configurable:!0}),e.prototype.activate=function(e){var t=this._views[this._mode];t&&(t.activate(e),this._isHidden&&e&&e===this._manager.newAnchorId&&this.showOne([e]))},Object.defineProperty(e.prototype,"manager",{get:function(){return this._manager},enumerable:!0,configurable:!0}),e.prototype.ensureViewLoaded=function(){var e=this;return new Promise((function(t){if(e._views[e._mode])t();else var n=setInterval((function(){e._views[e._mode]&&(clearInterval(n),t())}),100)}))},e.prototype.getView=function(e){return this._views[e]},e.prototype.forceUpdate=function(){var e=this._views[this._mode];e&&e.forceUpdate()},e.prototype.clearCache=function(){var e=this._views[this._mode];e&&e.clearCache()},e.prototype.syncData=function(){var e=this._views[this._mode];e&&e.syncData()},Object.defineProperty(e.prototype,"isHidden",{get:function(){return this._isHidden},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mode",{get:function(){return this._mode},set:function(e){this._views[this._mode]&&this._views[e]&&(Bo.setMode(e),this._views[this._mode].toggle(!1),this._mode=e,this._views[this._mode].toggle(!0,this._manager.activator.activeAnchorId),this._editor.fire(new Vo(ko.ModeChanged,e),!1))},enumerable:!0,configurable:!0}),e.prototype.hide=function(){var e=this._views[this._mode];e&&e.canHide&&(this._isHidden=!0,this._manager.activator.activate(""),e.toggle(!1),this._editor.fire(new Vo(ko.VisibilityChanged,!1),!1))},e.prototype.show=function(e,t){void 0===t&&(t=!1);var n=this._views[this._mode];n&&(n.canHide||t)&&(this._isHidden=!1,n.toggle(!0,e,t),this._editor.fire(new Vo(ko.VisibilityChanged,!0),!1))},e.prototype.showOne=function(e){var t=this._views[this._mode];t&&(this._isHidden?t.peek(e):t.hover(e,!0),this.manager.activator.temporaryActivate(e[0]))},e.prototype.hideOne=function(e){var t=this._views[this._mode];t&&(this._isHidden?t.peek([]):t.hover(e,!1),this.manager.activator.temporaryActivate(""))},e.prototype.onCommentAdd=function(e){var t=this._views[this._mode];t&&t.onCommentAdd(e)},e.prototype.onCommentDelete=function(e){var t=this._views[this._mode];t&&t.onCommentDelete(e)},e.prototype.onRenderLayoutChange=function(){var e=this._views[this._mode];e&&e.onRenderLayoutChange()},e.prototype.onRenderFinish=function(){var e=this._views[this._mode];e&&e.onRenderFinish()},e}(),Go=function(){function e(){}return e.comment=function(e){return{commentId:e.str_commentid,authorId:e.str_author,publishTime:Number(e.uint64_time),editTime:Number(e.uint64_time),repliedId:e.bytes_repliedid,name:e.str_author_name,avatar:e.str_head_url,anchorId:e.str_anchor,content:e.str_content}},e.convertRepose=function(t){for(var n=[],o=0;o<t.length;o++){var r=t[o],i=e.comment(r);n.push(i)}return n},e.parseReposeData=function(t){for(var n=t.str_docid,o=t.rpt_comment,r=[],i=0;i<o.length;i++){var a=o[i],s=e.comment(a);r.push(s)}return{docId:n,comments:r}},e.addCommentOrReply=function(t,n){for(var o=t.comments,r=[],i=0;i<o.length;i++){var a=o[i],s={bytes_repliedid:a.repliedid,str_anchor:a.anchorId,str_content:a.content};r.push(s)}w.a.ajax({type:"POST",contentType:"application/json; charset=utf-8",url:"/v3/oidbinterface/oidb_0xbca_0?sdkappid=20344",dataType:"json",data:JSON.stringify({str_docid:t.docid,str_sid:Ho.getSid(),rpt_comment:r,bool_sync_to_qgroup:t.sendMsgToGroup}),success:function(t){var o;"OK"===t.ActionStatus&&(o=e.parseReposeData(t)),n&&n(t.ErrorCode,o)},error:function(e){n&&n(-1,e)}})},e.modifyCommentOrReply=function(t,n){for(var o=t.comments,r=[],i=0;i<o.length;i++){var a=o[i],s={str_commentid:a.commentId,str_anchor:a.anchorId,str_content:a.content};r.push(s)}w.a.ajax({type:"POST",contentType:"application/json; charset=utf-8",url:"/v3/oidbinterface/oidb_0xbcc_0?sdkappid=20344",dataType:"json",data:JSON.stringify({str_docid:t.docid,str_sid:Ho.getSid(),rpt_comment:r}),success:function(t){var o;"OK"===t.ActionStatus&&(o=e.parseReposeData(t)),n&&n(t.ErrorCode,o)},error:function(e){n&&n(-1,e)}})},e.deleteCommentOrReply=function(e,t){w.a.ajax({type:"POST",contentType:"application/json; charset=utf-8",url:"/v3/oidbinterface/oidb_0xbce_0?sdkappid=20344",dataType:"json",data:JSON.stringify({str_docid:e.docid,str_anchorid:e.anchorId,str_sid:Ho.getSid(),str_commentid:e.commentId,uint32_opr_flag:1===e.opr_flag?e.opr_flag:0}),success:function(e){var n;"OK"===e.ActionStatus&&(n={docId:e.str_docid,commentId:e.str_commentid,anchorId:e.str_anchorid,opr_flag:Number(e.uint32_opr_flag)}),t&&t(e.ErrorCode,n)},error:function(e){t&&t(-1,e)}})},e.redoCommentOrReply=function(e,t){w.a.ajax({type:"POST",contentType:"application/json; charset=utf-8",url:"/v3/oidbinterface/oidb_0xbcf_0?sdkappid=20344",dataType:"json",data:JSON.stringify({str_docid:e.docid,str_anchorid:e.anchorId,str_commentid:e.commentId}),success:function(e){var n;"OK"===e.ActionStatus&&(n={docId:e.str_docid,commentId:e.str_commentid}),t&&t(e.ErrorCode,n)},error:function(e){t&&t(-1,e)}})},e.getCommentsAndReplyByAnchors=function(t,n){w.a.ajax({type:"POST",contentType:"application/json; charset=utf-8",url:"/v3/oidbinterface/oidb_0xbd0_0?sdkappid=20344",dataType:"json",data:JSON.stringify({str_docid:t.docid,rpt_anchorlist:t.anchorlist,uint32_new_num:2,uint32_old_num:2}),success:function(t){var o;if("OK"===t.ActionStatus){for(var r=t.rpt_anchorlist,i=[],a=0;a<r.length;a++){var s=r[a],c=e.convertRepose(s.rpt_new_comment_list),l=e.convertRepose(s.rpt_old_comment_list),p={anchorId:s.str_anchor,comment_count:Number(s.uint64_comment_count),new_comment_list:c,old_comment_list:l};i.push(p)}o={docid:t.str_docid,responseAnchors:i}}n&&n(t.ErrorCode,o)},error:function(e){n&&n(-1,e)}})},e.getCommentByAnchorid=function(t,n){e._getCommentByAnchorid(t,0,e._getCommentByAnchoridCallBack,n)},e._getCommentByAnchoridCallBack=function(t,n,o,r,i,a){if(0===t)if(1===o){if(e.comments_cache.has(r.anchorId)){var s=e.comments_cache.get(r.anchorId);Array.isArray(s)&&Array.isArray(a.comment)&&(s=s.concat(a.comment)),a.comment=s,e.comments_cache.delete(r.anchorId)}i&&i(0,a)}else{if(e.comments_cache.has(r.anchorId)){var c=e.comments_cache.get(r.anchorId);if(!Array.isArray(c)||!Array.isArray(a.comment))return e.comments_cache.has(r.anchorId)&&e.comments_cache.delete(r.anchorId),void i(t,"getCommentByAnchorid error");c=c.concat(a.comment),e.comments_cache.set(r.anchorId,c)}else e.comments_cache.set(r.anchorId,a.comment);e._getCommentByAnchorid(r,n,e._getCommentByAnchoridCallBack,i)}else i&&(e.comments_cache.has(r.anchorId)&&e.comments_cache.delete(r.anchorId),i(t,"getCommentByAnchorid error"))},e._getCommentByAnchorid=function(t,n,o,r){w.a.ajax({type:"POST",contentType:"application/json; charset=utf-8",url:"/v3/oidbinterface/oidb_0xbd1_0?sdkappid=20344",dataType:"json",data:JSON.stringify({str_docid:t.docid,str_anchor:t.anchorId,msg_cookie:{uint64_time:n}}),success:function(n){var i,a,s;if("OK"===n.ActionStatus){var c=n.msg_cookie;a=Number(c.uint64_time),s=n.uint32_complete_flag;var l=n.msg_anchorcomments,p=e.convertRepose(l.rpt_comment);i={anchorId:l.str_anchor,comment_count:Number(l.uint64_comment_count),comment:p}}o&&o(n.ErrorCode,a,s,t,r,i)},error:function(e){o&&o(e.ErrorCode,0,0,t,r,"")}})},e.getGroupInfo=function(e,t){w.a.ajax({type:"POST",contentType:"application/x-www-form-urlencoded; charset=utf-8",url:"/cgi-go/discuss/check_sync",dataType:"json",data:{globalPadId:e.globalPadId,type:0,xsrf:e.xsrf},success:function(e){var n={},o=-1;e&&void 0!==e.retcode&&(o=e.retcode),e&&e.canSyncToQgroup&&e.qgroupName&&(n={sendMsgToGroup:e.canSyncToQgroup,groupName:e.qgroupName}),t&&t(o,n)},error:function(e){g.Logger.warn("word_comment: getGroupInfo failed! err = "+e),t&&t(-1,e)}})},e.comments_cache=new Map,e}(),zo=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)a.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return a},Ko=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(zo(arguments[t]));return e},qo=function(){function e(e,t){var n=this;this._anchors=[],this._anchorMap=new Map,this._recycledAnchors=new Map,this._fullyDeleteAnchorIds=new Set,this._countMap=new Map,this._commentAnchorsPulling=!1,this._groupName="",this._manager=e,this._onChanged=t,setTimeout((function(){n.requestGroupInfo()}),50)}return Object.defineProperty(e.prototype,"manager",{get:function(){return this._manager},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"emptyAnchorIds",{get:function(){var e=this._manager.engine.anchorIds,t=[];return this._fullyDeleteAnchorIds.forEach((function(n){e.has(n)&&t.push(n)})),t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"countMap",{get:function(){return this._countMap},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"groupName",{get:function(){return this._groupName},enumerable:!0,configurable:!0}),e.prototype.sortCommentList=function(e){e.sort((function(e,t){return void 0===e.publishTime||isNaN(e.publishTime)?1:void 0===t.publishTime||isNaN(t.publishTime)||e.publishTime<t.publishTime?-1:e.publishTime>t.publishTime?1:0}))},e.prototype.notifyCount=function(){this._manager.editor.fire(new Vo(ko.Count,null))},e.prototype.countComment=function(e){this._countMap.set(e.anchorId,e.commentCount),this.notifyCount()},e.prototype.countComments=function(e,t){var n=this;void 0===t&&(t=!1),t&&this._countMap.clear(),e.forEach((function(e){n._countMap.set(e.anchorId,e.commentCount)})),this.notifyCount()},e.prototype.removeCommentCount=function(e){this._countMap.delete(e),this.notifyCount()},e.prototype.notifyDataChange=function(){this._onChanged&&this._onChanged()},e.prototype.generateAppendCommentContent=function(){return{commentItemType:Do.c.Append}},Object.defineProperty(e.prototype,"anchors",{get:function(){return this._anchors},enumerable:!0,configurable:!0}),e.prototype.getCommentAnchors=function(e){var t=this;return e.map((function(e){return t.get(e)})).filter((function(e){return!!e}))},e.prototype.requestPullCommentAnchors=function(e,t){var n=this;e.length?this._commentAnchorsPulling?t&&t(0):(this._commentAnchorsPulling=!0,this.requestPullCommentAnchorsEx(e,(function(e){t&&t(e),n._commentAnchorsPulling=!1}))):t&&t(0)},e.prototype.requestPullCommentAnchorsEx=function(e,t){var n=this;if(e.length){var o=[];o=e.length>50?e.slice(0,50):e,Go.getCommentsAndReplyByAnchors({docid:Ho.getDocId(),anchorlist:o},(function(o,r){if(0===o&&r){for(var i=r.responseAnchors,a=0;a<i.length;a++){var s=i[a],c=s.new_comment_list.concat(s.old_comment_list);if(c.length>0){Ho.isCommentEditable()&&c.push(n.generateAppendCommentContent()),n.sortCommentList(c);var l=n._anchorMap.get(s.anchorId);if(l)l.commentCount=s.comment_count,l.commentList=c;else{var p={anchorId:s.anchorId,commentCount:s.comment_count,commentList:c};n._anchors.push(p),n._anchorMap.set(p.anchorId,p)}}else 0===s.comment_count&&n._fullyDeleteAnchorIds.add(s.anchorId);n._recycledAnchors.delete(s.anchorId)}e.splice(0,50),n.countComments(n._anchors),n.requestPullCommentAnchorsEx(e,t)}else t&&t(o),g.Logger.warn("word_comment: getCommentsAndReplyByAnchors error! result = "+o)}))}else t&&t(0)},e.prototype.requestPullCommentContents=function(e,t,n){var o=this;Go.getCommentByAnchorid({docid:Ho.getDocId(),anchorId:e},(function(r,i){if(0===r){var a=o._anchorMap.get(e);a&&(a.commentCount=i.comment_count,a.commentList=i.comment,Ho.isCommentEditable()&&a.commentList.push(o.generateAppendCommentContent()),o.sortCommentList(a.commentList),o.countComment(a),n||o.notifyDataChange())}else g.Logger.warn("word_comment: requestPullCommentContents error! anchorId = "+e+", result = "+r);t&&t(r)}))},e.prototype.asyncRequestPullAllCommentContents=function(){var e=this;setTimeout((function(){for(var t=0;t<e._anchors.length;t++){var n=e._anchors[t];n.commentCount!==n.commentList.length-1&&e.requestPullCommentContents(n.anchorId)}}),100)},e.prototype.requestAddComment=function(e,t,n,o){var r=this;void 0===n&&(n=!1),Go.addCommentOrReply({docid:Ho.getDocId(),comments:[{anchorId:e,content:t}],sendMsgToGroup:n},(function(n,i){if(0===n&&i){var a=i.comments[0];r.addContent(e,a,!0),c.ReportHelper.tdwReport({opername:"doc_cooper",module:"word_comment",action:"comment_suc"})}else g.Logger.warn("word_comment: reqeustAddComment error! anchorId = "+e+", commentText = "+t+", result = "+n);o&&o(n)}))},e.prototype.requestEditComment=function(e,t,n,o){var r=this;Go.modifyCommentOrReply({docid:Ho.getDocId(),comments:[{anchorId:e,commentId:t,content:n}]},(function(n,i){if(0===n){var a=i.comments[0],s=r._manager.editInfo&&r._manager.editInfo.anchorId===e&&r._manager.editInfo.commentId===t;r.editContent(e,a,s)}else{(a=r.getContent(e,t))&&(a.content=a.originContent,r.editContent(e,a)),g.Logger.warn("word_comment: requestEditComment error! anchorId = "+e+", commentId = "+(i?i.commentId:"")+", result = "+n)}o&&o(n)}))},e.prototype.requestDeleteComment=function(e,t,n){var o=this;Go.deleteCommentOrReply({docid:Ho.getDocId(),anchorId:e,commentId:t},(function(r,i){0===r&&i&&i.anchorId===e&&i.commentId===t&&0===i.opr_flag?o.deleteContent(e,t):g.Logger.warn("word_comment: requestDeleteComment error! anchorId = "+e+", commentId = "+(i?i.commentId:"")+", result = "+r+", opFlag = "+(i?i.opr_flag:"error")),n&&n(r)}))},e.prototype.requestClearCommentAnchor=function(e,t){var n=this;Go.deleteCommentOrReply({docid:Ho.getDocId(),anchorId:e,opr_flag:1},(function(o,r){0===o&&r&&r.anchorId===e&&1===r.opr_flag?n.delete(e):g.Logger.warn("word_comment: requestClearCommentAnchor error! anchorId = "+e+", result = "+o+", opFlag = "+(r?r.opr_flag:"error")),t&&t(o)}))},e.prototype.reset=function(){(this._anchors.length>0||this._anchorMap.size>0)&&(this._anchors=[],this._anchorMap=new Map,this.notifyDataChange())},e.prototype.serialize=function(e){var t=this,n=[],o=new Set;return e.forEach((function(e){t._fullyDeleteAnchorIds.has(e)||o.add(e)})),this._anchorMap.forEach((function(e,r){o.delete(r)?n.push(e):e.commentCount>0&&t._recycledAnchors.set(r,e)})),o.delete(this._manager.newAnchorId),this._anchors=n,this._anchorMap.clear(),this._anchors.forEach((function(e){return t._anchorMap.set(e.anchorId,e)})),this.countComments(this._anchors,!0),Ko(o)},e.prototype.createEmptyAnchor=function(e,t){return{anchorId:e,commentCount:0,commentList:[{commentItemType:t,avatar:Ho.getUserAvatar(),name:Ho.getUserName()}]}},e.prototype.get=function(e){return e===this._manager.newAnchorId?this.createEmptyAnchor(e,Do.c.New):this._anchorMap.get(e)||this._recycledAnchors.get(e)||null},e.prototype.has=function(e,t){var n=this._anchorMap.get(e);return!!n&&(!t||!!n.commentList.find((function(e){return e.commentId===t})))},e.prototype.isFullyDelete=function(e){return this._fullyDeleteAnchorIds.has(e)},e.prototype.delete=function(e,t){for(var n=-1,o=0;o<this._anchors.length;o++){if(this._anchors[o].anchorId===e){n=o;break}}n>=0&&(this._anchors.splice(n,1),this._anchorMap.delete(e),this._recycledAnchors.delete(e),this._fullyDeleteAnchorIds.add(e),this.removeCommentCount(e),t||this.notifyDataChange())},e.prototype.getContent=function(e,t){var n=this._anchorMap.get(e);if(n)for(var o=n.commentList,r=0;r<o.length;r++){var i=o[r];if(i.commentId===t)return i}return null},e.prototype.push=function(e,t){if(t.docId===Ho.getDocId()&&t.comments.length>0)for(var n=0;n<t.comments.length;n++){var o=t.comments[n];if(o.anchorId)switch(e){case Do.i.add:this.addContent(o.anchorId,o);break;case Do.i.modify:this.editContent(o.anchorId,o);break;case Do.i.delete:this.deleteContent(o.anchorId,o.commentId)}}},e.prototype.addContent=function(e,t,n){this.deleteContent(e,t.commentId,!0);var o=this._anchorMap.get(e)||null;if(o||(o=this.createEmptyAnchor(e,Do.c.Append),this._anchors.push(o),this._anchorMap.set(e,o)),o){var r=o.commentList;0===r.length||1===r.length&&r[0].commentItemType===Do.c.New?(r.splice(r.length-1),r.push(t),Ho.isCommentEditable()&&r.push(this.generateAppendCommentContent())):r.splice(r.length-1,0,t),o.commentCount+=1,this.sortCommentList(r),this.countComment(o),n||this.notifyDataChange()}},e.prototype.deleteContent=function(e,t,n){var o=this._anchorMap.get(e);if(o){for(var r=o.commentList,i=-1,a=0;a<r.length;a++){if(r[a].commentId===t){i=a;break}}i>=0&&(r.splice(i,1),o.commentCount-=1,0===o.commentCount?this.delete(e,!0):this.countComment(o),n||this.notifyDataChange())}},e.prototype.editContent=function(e,t,n){var o=this.getContent(e,t.commentId);if(o&&void 0!==t.editTime&&void 0!==o.editTime){if(t.editTime<o.editTime)return;o.editTime=t.editTime,o.content!==t.content&&(o.content=t.content,n||this.notifyDataChange())}},e.getVisualComments=function(e,t,n,o){void 0===o&&(o={});var r=e.commentList;if(r.length>0)if(t){if(!n||o.disableSpecial||r.some((function(e){return e.commentItemType===Do.c.Edit})))r=r.slice(0,r.length-1);else if(o.cacheContent&&r.length>0){var i=r[r.length-1],a=i.commentItemType===Do.c.New?{commentItemType:Do.c.Append}:i;r=Ko(r.slice(0,r.length-1),[o.cacheContent,a])}}else if(void 0!==o.capcacity){if((r=r.slice(0,r.length-1)).length>o.capcacity){var s={isFoldComment:!0,foldCount:r.length-o.capcacity};r=[r[0],s,r[r.length-2],r[r.length-1]],c.ReportHelper.tdwReport({opername:"doc_cooper",module:"word_comment",action:"fold_com"})}}else r=r.slice(0,r.length-1);return r.slice()},e.prototype.requestGroupInfo=function(){var e=this;Go.getGroupInfo({globalPadId:Ho.getDocId(),type:0,xsrf:Object(c.getXsrf)()},(function(t,n){0===t&&n&&n.sendMsgToGroup&&n.groupName&&n.groupName.length>0?e._groupName=n.groupName:0!==t&&g.Logger.warn("word_comment: requestGroupInfo failed! result = "+t)}))},e}(),Zo=function(){function e(){}return e.hasNode=function(e){return!!e.__node__},e.getAncestor=function(e,t){for(var n=e;n;n=n.parentBox)if(n.kind===t)return n},e.getFirstDescendant=function(e,t){for(var n=e;n;n=n.firstChild)if(n.kind===t)return n},e.estimateCommentHeightAfterAdd=function(e){return(e||0)+54},e.getAvailablePageHeight=function(e){for(var t=e;t;){if(Object(c.isTextPageBox)(t))return Object(g.twipsToPx)(t.totalHeight);t=t.parentBox}},e}(),$o=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)a.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return a},Qo=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat($o(arguments[t]));return e},Xo=function(){function e(e){var t=this;this._tablePositionCache=new Map,this._resetTableCache=function(){t._tablePositionCache.clear()},this._editor=e,this._editor.on(c.RenderNotificationTypes.RENDER_LAYOUT_CHANGE,this._resetTableCache,this),this._editor.on(c.RenderNotificationTypes.RENDER_FINISH_TABLE,this._resetTableCache,this)}return e.prototype.destroy=function(){this._editor.removeListener(c.RenderNotificationTypes.RENDER_LAYOUT_CHANGE,this),this._editor.removeListener(c.RenderNotificationTypes.RENDER_FINISH_TABLE,this)},e.prototype.fromViewRangePoint=function(e,t,n){var o=e.getLineDocumentOffset(this._editor.zoom),r=o.x;return n&&n.alignToLeafBoxInX&&(r=e.getDocumentOffset(this._editor.zoom).x),{x:Math.round(r+t.x),y:Math.round(o.y+t.y)}},e.prototype.fromViewRange=function(e,t){return t&&t.alignToBottom?this.fromViewRangePoint(e.end,{x:0,y:e.start.lineHeight},t):this.fromViewRangePoint(e.start,{x:0,y:0},t)},e.accumulate=function(e,t){void 0===t&&(t=0);var n=new Array(e.length+1);n[0]=t;for(var o=1;o<n.length;++o)n[o]=n[o-1]+e[o-1];return n},e.prototype.getAllTableBox=function(e){if(e.nextSibling)return[e];var t=[e];if(!e.nextSibling)for(var n=Zo.getAncestor(e,c.BoxKind.LogicPage);n&&Object(c.isLogicPageBox)(n.nextSibling);){n=n.nextSibling;var o=Zo.getFirstDescendant(n,c.BoxKind.Table);if(!o||o.nextSibling)break;t.push(o)}return t},e.prototype.getTablePositionCache=function(t,n){var o=this._tablePositionCache.get(t);if(o)return o;var r=this._editor.getViewRangeFromGcpRange(n);if(r){var i=Zo.getAncestor(r.start.leafBox,c.BoxKind.Table);if(i){for(var a=this._editor.scrollHandler.getScrollRoot(),s=a.getBoundingClientRect(),l=this.getAllTableBox(i),p=[],u=void 0,d=0;d<l.length;++d){var h=l[d].children.length,f=l[d];if(Zo.hasNode(f)){var m=f.__node__.getBoundingClientRect();if(0===m.height||0===m.width)p.push.apply(p,Qo(l[d].children.map((function(){}))));else{void 0===u&&(u=Math.round((m.left-s.left)/this._editor.zoom));var y=Math.round((m.top-s.top)/this._editor.zoom)+a.scrollTop,v=e.accumulate(l[d].children.map((function(e){return Object(g.twipsToPx)(e.totalHeight)})),y).slice(0,h);p.push.apply(p,Qo(v))}}else p.push.apply(p,Qo(l[d].children.map((function(){}))))}if(void 0!==u)return o={colOffsets:e.accumulate(i.colWidths.map((function(e){return Object(g.twipsToPx)(e)})),u),rowOffsets:p},this._tablePositionCache.set(t,o),o}}},e.prototype.fromTable=function(e){var t=this._editor.service.getDocument().getTableFullInfoFromGcp(e.gcpBegin);if(t){var n=this.getTablePositionCache(t.tableProp.tableId,e);if(n){var o=n.rowOffsets[t.rowIndex];if(void 0!==o){var r=n.colOffsets[t.cellIndex];return{x:Math.round(r),y:Math.round(o)}}}}},e.prototype.fromRange=function(e,t){var n=e;if(t&&t.alignToTableCell){var o=this.fromTable(n);if(o)return o}var r=this._editor.getViewRangeFromGcpRange(n);return r?this.fromViewRange(r,t):void 0},e.prototype.fromSelection=function(e){return this.fromRange(this._editor.service.getSelection().range(),e)},Object.defineProperty(e,"INVISIBLE_POSITION",{get:function(){return-99999},enumerable:!0,configurable:!0}),Object.defineProperty(e,"INVISIBLE_POSITION_2D",{get:function(){return{x:0,y:-99999}},enumerable:!0,configurable:!0}),e.init=function(t){this._instance=new e(t)},e.destory=function(){this._instance&&this._instance.destroy()},e.getPositionFromRange=function(e,t){return this._instance?this._instance.fromRange(e,t):void 0},e.getPositionFromSelection=function(e){return this._instance?this._instance.fromSelection(e):void 0},e}(),Yo=function(){function e(e){var t=this;this._activeAnchorId="",this._currentRange=c.GCPRange.emptyRange(),this._byMouseOrTouch=!1,this._byArrowKey=!1,this._responseToSelectionChange=!0,this._handleMouseOrTouchEvent=function(){t._byMouseOrTouch=!0},this._handleSelectionChanged=function(e){Ho.isLogin()&&t.onSelectionChanged(e)},this._manager=e,this._editor=e.editor,this._view=e.view,this._editor.on(c.RenderNotificationTypes.SELECTION_END,this._handleSelectionChanged,this),this._editor.on(c.MouseNotificationType.MOUSE_EVENT,this._handleMouseOrTouchEvent,this),this._editor.on(c.TouchNotificationType.TOUCH_EVENT,this._handleMouseOrTouchEvent,this)}return e.prototype.destroy=function(){this._editor.removeListener(c.RenderNotificationTypes.SELECTION_END,this),this._editor.removeListener(c.MouseNotificationType.MOUSE_EVENT,this),this._editor.removeListener(c.TouchNotificationType.TOUCH_EVENT,this)},Object.defineProperty(e.prototype,"activeCommentRange",{get:function(){return this._activeCommentRange},enumerable:!0,configurable:!0}),e.prototype.onArrowKey=function(){this._byArrowKey=!0},e.prototype.reSelection=function(e){if(this._byMouseOrTouch)if(e.isEmpty()){if(this._manager.isPlaceholder(e.begin()))return this._editor.service.getSelection().setRange(e.begin()+1,e.end()+1),!0}else if(this._manager.isPlaceholder(e.begin()))return this._editor.service.getSelection().setRange(e.begin()+1,e.end()),!0;return!1},e.prototype.onSelectionChanged=function(e){if(this._responseToSelectionChange){if(this._manager.view.isHidden||e.option&&!e.option.forceFocus)return(this._byMouseOrTouch||this._byArrowKey)&&this.activate("",!1),void this.clearSelectionState();var t=this._editor.selection.gcpRange;if(!this.reSelection(t)){if(t.isEmpty()){if(!t.equal(this._currentRange))if(this._currentRange=t,this._activeAnchorId!==this._manager.newAnchorId||this._byMouseOrTouch||this._byArrowKey){var n=this.seekAnchorInRange();n!==this._activeAnchorId?this.activate(Ho.isMobile()?"":n,!1):Ho.isMobile()&&(this._byMouseOrTouch||this._byArrowKey?this.activate("",!1):this._editor.fire(new c.FocusBlurNotification(c.FocusBlurNotificationType.REQUEST_BLUR),!1))}else this._manager.overlay.onCommentChanged()}else(this._byMouseOrTouch||this._byArrowKey)&&this.activate("",!1);this._byMouseOrTouch=!1,this._byArrowKey=!1}}else this.clearSelectionState()},e.prototype.forceActivateSelection=function(){this._currentRange=this._editor.selection.gcpRange;var e=this.seekAnchorInRange();this.activate(e,!1)},e.prototype.binarySearchIntersect=function(e,t,n){if(n>t){var o=Math.floor((t+n)/2),r=this._manager.engine.commentInfos[o].range;return e.end()<=r.begin()?this.binarySearchIntersect(e,t,o):e.begin()>=r.end()?this.binarySearchIntersect(e,o+1,n):o}return-1},e.prototype.searchFirstIntersect=function(e){for(var t=this._manager.engine.commentInfos,n=(t.length>0&&e.end()>=t[0].range.begin()&&e.begin()<=t[t.length-1].range.end()?this.binarySearchIntersect(e,0,t.length):-1)-1;n>=0&&t[n].range.intersect(e);)n-=1;return n+1},e.prototype.getContinuousRanges=function(e,t){for(var n=this._manager.engine.commentInfos,o=t-1;o>=0&&n[o].anchorIds.includes(e);)o-=1;for(var r=t+1;r<n.length&&n[r].anchorIds.includes(e);)r+=1;for(var i=n[o+1].range,a=o+2;a<r;++a)i=i.unionRange(n[a].range);return i},e.prototype.searchPerfectAnchor=function(e,t){var n=this,o=this._manager.engine.commentInfos[t];if(o.anchorIds.length>1){for(var r=o.anchorIds.map((function(e){return n.getContinuousRanges(e,t)})),i=0,a=Math.round(r[0].intersectRange(e).len/r[0].len*1e4),s=1;s<r.length;++s){var c=Math.round(r[s].intersectRange(e).len/r[s].len*1e4);(c>a||c===a&&(r[s].len>r[i].len||o.anchorIds[s]===this._activeAnchorId))&&(i=s,a=c)}return o.anchorIds[i]}return o.anchorIds[0]},e.prototype.seekAnchorInRange=function(){var e=this._currentRange.clone();if(this._currentRange.isEmpty()){var t=this._editor.service.getSelection().getParaRange(e.begin());if(t&&t.begin()!==e.begin()){var n=this._manager.engine.isPlaceholderAllowed(e.gcpBegin)?2:1,o=Math.max(e.gcpBegin-n,0),r=e.gcpBegin-o;if(!(r>0))return"";e=new c.GCPRange(o,r)}}var i="",a=this.searchFirstIntersect(e);return a>-1?(i=this.searchPerfectAnchor(e,a),this._activeCommentRange=this._manager.engine.commentInfos[a].range):this._activeCommentRange=void 0,i},Object.defineProperty(e.prototype,"activeAnchorId",{get:function(){return this._activeAnchorId},enumerable:!0,configurable:!0}),e.prototype.temporaryActivate=function(e){this._manager.overlay.activate([e||this._activeAnchorId])},e.prototype.clearSelectionState=function(){this._byMouseOrTouch=!1,this._byArrowKey=!1},e.prototype.activate=function(e,t,n){void 0===t&&(t=!0),void 0===n&&(n=!1);var o=e&&e===this._manager.newAnchorId;if(o?this.clearSelectionState():this._manager.newAnchorId&&this._manager.cancelAdd(),this._activeAnchorId!==e){if(this._activeAnchorId=e,t){var r=this._manager.engine.getRanges(e);if(r.length>0){this._activeCommentRange=r[0];var i=r[0].end();this._currentRange=new c.GCPRange(i+(this._manager.isPlaceholder(i)?1:0),0),this._editor.setRangeTo(this._currentRange,{scrollToView:o||n?c.ScrollViewType.None:c.ScrollViewType.Near,forceFocus:!1,mobileContextMenu:c.MobileContextMenuType.Keep,mobileSelectionDrag:c.MobileSelectionDragType.Hide})}else o&&(this._activeCommentRange=this._editor.service.getSelection().range())}this._manager.overlay.activate([e]),this._view.activate(e)}},e.prototype.silentActivateNew=function(e){var t=this;if(void 0===e&&(e=!0),this._activeAnchorId=this._manager.newAnchorId,this._activeCommentRange=this._editor.service.getSelection().range(),this._manager.overlay.activate([this._manager.newAnchorId]),this._responseToSelectionChange=!1,setTimeout((function(){t._responseToSelectionChange=!0}),800),e){var n=Xo.getPositionFromSelection({alignToBottom:!0});if(n){var o=n.y+Zo.estimateCommentHeightAfterAdd();Ho.isMobile()?this._editor.scrollHandler.scrollToIfNeedMobile(0,o,0):this._editor.scrollHandler.scrollToIfNeed(0,o,0)}}},e.prototype.onCancelAdd=function(){this._manager.newAnchorId===this._activeAnchorId&&(this._activeAnchorId="")},e}(),Jo=(n(353),function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}()),er=function(e){function t(t){var n=e.call(this,t)||this;return n.state={top:0},n}return Jo(t,e),t.prototype.render=function(){return i.a.createElement("div",{className:"comment-container",id:"comment-container",style:{top:this.state.top}},i.a.createElement("div",{className:"comment-container-main"},this.props.mainComponents),i.a.createElement("div",{className:"comment-container-right"},this.props.rightComponents))},t}(i.a.Component),tr=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},nr=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},or=function(){function e(e){this._initialized=!1,this._retryInitAfterChildrenLoaded=!1,this._manager=e,this._ref=i.a.createRef()}return e.prototype.destroy=function(){this._widgetService.remove("comment-container","embed")},e.prototype.config=function(e){this._children=e,this._retryInitAfterChildrenLoaded&&(this._retryInitAfterChildrenLoaded=!1,this._initialized=this.renderContainer())},e.prototype.renderContainer=function(){if(this._children){var e=this._children.getConfig();return this._widgetService.embed({name:"comment-container",component:i.a.createElement(er,{editor:this._manager.editor,mainComponents:e.main,rightComponents:e.right,ref:this._ref})}),!0}return!1},e.prototype.onSurfacePaddingChange=function(){this._ref.current&&this._ref.current.setState({top:this._manager.editor.view.getPadding().top||0})},e.prototype.onLayoutChange=function(){this._initialized||(this._initialized=this.renderContainer(),this._retryInitAfterChildrenLoaded=!this._initialized)},e.prototype.onNetworkChange=function(){this._children&&this._children.onNetworkChange()},tr([Object(m.l)(),nr("design:type",m.A)],e.prototype,"_widgetService",void 0),e}(),rr=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),ir=function(){return(ir=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},ar=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.anchorIds=[],t.isActived=!1,t.isCaret=!1,t.isTemporaryCaret=!1,t}return rr(t,e),t.prototype.style=function(){var t=this.isCaret?.48:.2,n=ir(ir({},e.prototype.style.call(this)),{position:"absolute",top:"0",backgroundColor:this.isCaret?"#3eedff":"#73f2ff",opacity:this.isActived?1:t});return this.isTemporaryCaret&&(n.backgroundColor="#1e6fff",n.opacity=.3),n},t}(c.LineOverlayStyle),sr=function(e){function t(t){var n=e.call(this,t)||this;return n.state={actived:!1},n}return rr(t,e),t.prototype.componentWillUnmount=function(){this.props.removeRenderCommentOverlayRef&&this.props.removeRenderCommentOverlayRef(this)},t.prototype.isActived=function(e){var t=!1;if(e&&e.length>0&&this.props.commentIdList)for(var n=0;n<this.props.commentIdList.length;++n){var o=this.props.commentIdList[n];if(o.length>0&&e.includes(o)){t=!0;break}}return t},t.prototype.updateActiveState=function(e){this.props.style.isActived=this.isActived(e),this.setState({actived:this.props.style.isActived})},t.prototype.render=function(){this.props.addRenderCommentOverlayRef&&this.props.addRenderCommentOverlayRef(this);var e=this.props,t=e.style,n=e.classNames,o=t.style();return i.a.createElement("div",{className:n,style:o})},t}(i.a.Component),cr=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),lr=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)a.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return a},pr=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(lr(arguments[t]));return e},ur=function(e){function t(t){var n=e.call(this)||this;return n._activeAnchorIds=[],n._ranges=[],n._enabled=!0,n.overlayRefList=new Set,n._temporaryCaret=!1,n._manager=t,n._editor=t.editor,n._editor.addLineOverlay(n),n}return cr(t,e),t.prototype.addRenderCommentOverlayRef=function(e){this.overlayRefList.has(e)||this.overlayRefList.add(e)},t.prototype.removeRenderCommentOverlayRef=function(e){this.overlayRefList.has(e)&&this.overlayRefList.delete(e)},t.prototype.calcRanges=function(){var e=this;this._ranges=[],this._manager.engine.commentInfos.forEach((function(t){(t.anchorIds.length>1||!e._manager.data.isFullyDelete(t.anchorIds[0]))&&e._ranges.push(t.range)}))},t.prototype.getRanges=function(){if(this._temporaryCaret=!1,this._enabled){if(this._manager.engine.updated&&this.calcRanges(),this._manager.newAnchorId){var e=this._editor.selection.gcpRange;if(0===e.len){this._temporaryCaret=!0;var t=pr(this._ranges,[new c.GCPRange(e.gcpBegin,1)]);return t.sort((function(e,t){return e.gcpBegin===t.gcpBegin?e.len-t.len:e.gcpBegin-t.gcpBegin})),t}}return this._ranges}return[]},Object.defineProperty(t.prototype,"enabled",{get:function(){return this._enabled},set:function(e){e!==this._enabled&&(this._enabled=e,this.onCommentChanged())},enumerable:!0,configurable:!0}),t.prototype.reset=function(){this._ranges=[]},t.prototype.onLayoutChanged=function(){},t.prototype.getCommentOverLayClassName=function(e){var t=this.getClassName();return(e.anchorIds||[]).forEach((function(e){t=t+" melo-comment-id-"+e})),t},t.prototype.getClassName=function(){return"melo-comment-overlay"},t.prototype.checkOverlay=function(e,n,o){var r=[],i=this.getRanges();if(i.length>0){var a=this._editor.getRangeFromIndex(e.firstIndex,e.lastIndex),s=e.edge,c=Object(g.twipsToPx)(s.left);s.recycle();var l=t.binarySearchStartForComment(a.begin(),a.end(),0,i.length-1,i);if(-1!==l){var p=t.binarySearchEndForComment(a.begin(),a.end(),l,i.length-1,i);if(-1!==p)for(var u=l;u<=p;u++){var d=i[u],h=this.styleFromRange(d,a.begin(),a.end(),n,o,c);h&&r.push(h)}}}return r},t.prototype.renderOverlay=function(e,t,n,o){var r=this,a=this.checkOverlay(e,t,n);return 0===a.length?null:1===a.length?i.a.createElement(sr,{key:o,classNames:this.getCommentOverLayClassName(a[0]),style:a[0],commentIdList:a[0].anchorIds,addRenderCommentOverlayRef:this.addRenderCommentOverlayRef.bind(this),removeRenderCommentOverlayRef:this.removeRenderCommentOverlayRef.bind(this)}):i.a.createElement("div",{key:o},a.map((function(e,t){return i.a.createElement(sr,{key:t,classNames:r.getCommentOverLayClassName(e),style:e,commentIdList:e.anchorIds,addRenderCommentOverlayRef:r.addRenderCommentOverlayRef.bind(r),removeRenderCommentOverlayRef:r.removeRenderCommentOverlayRef.bind(r)})})))},t.prototype.styleFromRange=function(e,t,n,o,r,i){void 0===i&&(i=0);var a=this._editor.getViewRangeFromGcpRange(e);if(!a)return null;var s=this._manager.engine.rangeInfoMap.get(e),c=s?s.anchorIds:[],l=s?!!s.isCaret:this._temporaryCaret,p=l&&0===c.length,u=0,d=0;if(e.begin()<=t&&e.end()>=n?(d=o,u+=i):e.begin()>t&&e.end()<n?(u=a.start.linePosOffset(this.zoom),d=a.end.linePosOffset(this.zoom)-u):e.begin()<=t&&e.end()>t?(d=a.end.linePosOffset(this.zoom),u+=i,d-=i):e.begin()<n&&e.end()>=n&&(d=o-(u=a.start.linePosOffset(this.zoom)),d+=i),l&&(e.begin()>=t&&e.end()<=n?(d=2*this.zoom,u-=this.zoom):d=0),d>0){var h=new ar(u+"px",d+"px",r+"px");return h.anchorIds=c,h.isActived=this.isActive(c),h.isCaret=l,h.isTemporaryCaret=p,h}return null},t.prototype.onCommentChanged=function(e){void 0===e&&(e=!1),e&&this.calcRanges(),this.notifyUpdate()},t.prototype.activate=function(e){var t=!1;this._activeAnchorIds.length!==e.length?t=!0:e.length>0&&this._activeAnchorIds.length>0&&(t=e[0]!==this._activeAnchorIds[0]),t&&(this._activeAnchorIds=e,this._updateRenderOverlays(),this.onCommentChanged())},t.prototype._updateRenderOverlays=function(){var e=this;this.overlayRefList&&this.overlayRefList.forEach((function(t){t.updateActiveState(e._activeAnchorIds)}))},t.prototype.isActive=function(e){var t=this;return e.some((function(n){return e.length>0&&t._activeAnchorIds.includes(n)}))},t.binarySearchStartForComment=function(e,t,n,o,r){if(o-n>1){var i=Math.floor((n+o)/2),a=r[i],s=r[n];return a.begin()>e?this.binarySearchStartForComment(e,t,n,i,r):s.begin()<=e&&s.end()>=e?this.binarySearchStartForComment(e,t,n,n,r):a.end()<e?this.binarySearchStartForComment(e,t,i,o,r):i}return r[n].end()>=e&&r[n].end()<=t||r[n].begin()<=e&&r[n].end()>=t?n:r[n].begin()>t||r[o].end()<e?-1:r[n].begin()>=e||r[n].end()<=t?n:o},t.binarySearchEndForComment=function(e,t,n,o,r){if(o-n>1){var i=Math.floor((n+o)/2),a=r[i],s=r[n];return a.begin()>t?this.binarySearchEndForComment(e,t,n,i,r):a.end()<=t?this.binarySearchEndForComment(e,t,i,o,r):s.begin()<=e&&s.end()>=e?this.binarySearchEndForComment(e,t,n,i,r):i}return r[o].begin()>=e&&r[o].begin()<=t||r[o].end()>=e&&r[o].end()<=t?o:r[n].end()>=e&&r[n].end()<=t?n:r[n].begin()>t||r[o].end()<e?r[n].begin()<=e&&r[n].end()>=t?n:-1:r[o].begin()<t?o:n},t}(c.BaseLineOverlay),dr=function(){function e(e,t){this._enabled=!1,this._notifyUpdate=!1,this._heights=new Map,this._recycleHeights=new Map,this._lastLayoutHeights=new Map,this._enabled=e,this._manager=t,this._onHeightUpdate=function(){}}return e.prototype.registerCallback=function(e){this._onHeightUpdate=e},Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){this._enabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"notifyUpdate",{get:function(){return this._notifyUpdate},set:function(e){this._notifyUpdate=e},enumerable:!0,configurable:!0}),e.prototype.width=function(){return 0},e.prototype.getLayoutHeight=function(e){return this._enabled&&(this._heights.get(e)||this._recycleHeights.get(e))||0},e.prototype.height=function(e){var t=this.getLayoutHeight(e);return this._lastLayoutHeights.set(e,t),Object(g.pxToTwips)(t)},e.prototype.wrapType=function(){return c.WrapType.Inline},e.prototype.fitToParentWidth=function(e){return this.getLayoutHeight(e)>0},e.prototype.getLastLayoutHeight=function(e){return this._lastLayoutHeights.get(e)},e.prototype.setHeight=function(e,t){t!==this._heights.get(e)&&(this._heights.set(e,t),this._recycleHeights.delete(e),this._notifyUpdate&&this._onHeightUpdate(e))},e.prototype.silentSetHeight=function(e,t){this._heights.set(e,t),this._recycleHeights.delete(e)},e.prototype.deleteHeight=function(e){var t=this._heights.get(e);void 0!==t&&(this._heights.delete(e),this._lastLayoutHeights.delete(e),this._manager.data.isFullyDelete(e)||this._recycleHeights.set(e,t),this._notifyUpdate&&this._onHeightUpdate(e))},e.prototype.marginTop=function(){return 0},e.prototype.marginRight=function(){return 0},e.prototype.marginBottom=function(){return 0},e.prototype.marginLeft=function(){return 0},e}(),hr=function(){function e(e){this._previewMode=!1,this.canHide=!0,this._manager=e,this._editor=e.editor,this._renderRef=i.a.createRef()}return Object.defineProperty(e.prototype,"renderRef",{get:function(){return this._renderRef},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"previewMode",{get:function(){return this._previewMode},set:function(e){e!==this._previewMode&&(this._previewMode=e,this._manager.overlay.enabled=!e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"manager",{get:function(){return this._manager},enumerable:!0,configurable:!0}),e.prototype.forceUpdate=function(){this._renderRef.current&&this._renderRef.current.forceUpdate()},e.prototype.clearCache=function(){},e.prototype.syncData=function(){},e.prototype.onRenderLayoutChange=function(){},e.prototype.onRenderFinish=function(){},e}(),fr=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),mr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._sectionRenders=new Map,t}return fr(t,e),t.prototype.add=function(e,t){this._sectionRenders.set(e,t)},t.prototype.remove=function(e,t){return this._sectionRenders.get(e)===t&&(this._sectionRenders.delete(e),!0)},t}(hr),gr=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),yr=function(e){function t(t){var n=e.call(this,t)||this;return n._sectionPlaceholders=new Map,n._placeholderAllowedAnchorId="",n._placeholderSnapshot=new Set,n.canHide=!1,n._onLayoutHeightUpdate=function(e){if(n._manager.view.isEmbed&&e){var t=e.split(c.CommentSpanPropKey.commentsConnection),o=n._manager.engine.getPlaceholderInfo(t[0]);if(o){var r=o.map((function(e){return new c.GCPRange(e.gcpBegin-1,2)}));n._manager.fireLayoutChange(r)}}},n._placeholderPropertyGetter=t.placeholderPropertyGetter,n._placeholderPropertyGetter.registerCallback(n._onLayoutHeightUpdate),n}return gr(t,e),t.prototype.canCancel=function(e){return!this._manager.engine.isPlaceholderAllowed(e)&&Ho.isMobile()},Object.defineProperty(t.prototype,"previewMode",{get:function(){return this._previewMode},set:function(e){e!==this._previewMode&&(this._previewMode=e,this._manager.activator.activate(""),this._sectionPlaceholders.forEach((function(t){t.setState({preview:e})})))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"containerUpdateCallback",{get:function(){var e=this;return function(){e._containerUpdateCallback&&e._containerUpdateCallback()}},enumerable:!0,configurable:!0}),t.prototype.triggerFullReflow=function(){var e=this._manager.engine.placeholderInfos.map((function(e){return new c.GCPRange(e.gcpBegin-1,2)}));e.length>0&&this._manager.fireLayoutChange(e.slice())},t.prototype.toggle=function(e,t,n){var o=this;if(void 0===n&&(n=!1),this._renderRef.current){var r=this._manager.hasComment;this._containerUpdateCallback=r?function(){o._containerUpdateCallback=void 0,o._placeholderPropertyGetter.notifyUpdate=!0,o.triggerFullReflow(),o._editor.once(c.RenderNotificationTypes.RENDER_LAYOUT_CHANGE,(function(){if(void 0!==t?o.activate(t):o.forceUpdate(),!n){var e=o._editor.viewSelection.getViewRange();e&&o._editor.scrollHandler.checkViewRange(e.end)}}))}:void 0,this._placeholderPropertyGetter.notifyUpdate=!r,this._placeholderPropertyGetter.enabled=e,this.subView.toggleSubMode(e),this._renderRef.current.toggle(e)}},t.prototype.toggleSubMode=function(){return!1},t.prototype.forceUpdate=function(){e.prototype.forceUpdate.call(this),this.subView&&this.subView.forceUpdate()},t.prototype.remove=function(t,n){return!!e.prototype.remove.call(this,t,n)&&(this._placeholderPropertyGetter.deleteHeight(t),!0)},t.prototype.onUpdate=function(e){var t=this._sectionRenders.get(e);if(t&&t.root){var n=t.root.clientHeight,o=n-(this._placeholderPropertyGetter.getLastLayoutHeight(e)||0);Math.abs(o)>.5&&(t.recordDeltaHeight(o),this._placeholderPropertyGetter.setHeight(e,n))}},t.prototype.addPlaceholder=function(e,t){this._sectionPlaceholders.set(e,t)},t.prototype.removePlaceholder=function(e,t){this._sectionPlaceholders.get(e)===t&&this._sectionPlaceholders.delete(e)},t.prototype.hasPlaceholder=function(e){return this._manager.engine.hasPlaceholder(e)||e===this._manager.newAnchorId&&e===this._placeholderAllowedAnchorId},Object.defineProperty(t.prototype,"subView",{get:function(){return this._manager.view.getView(Ho.isMobile()?Do.f.External:Do.f.Float)},enumerable:!0,configurable:!0}),t.prototype.getLayoutBoxInfo=function(e){var t=this._sectionPlaceholders.get(e);if(t){var n=t.props.layoutBox;if((!n.prevSibling||0===n.prevSibling.totalWidth)&&Object(c.isTextLineBox)(n.parentBox)){var o=n.parentBox;if(!o.prevSibling&&Object(c.isParagraphBox)(o.parentBox)){var r=o.parentBox;if(!r.prevSibling&&Object(c.isTextPageBox)(r.parentBox))return{isFirst:!0,maxHeight:Object(g.twipsToPx)(r.parentBox.totalHeight)}}}}return{isFirst:!1,maxHeight:void 0}},t.prototype.updatePosition=function(e,t){var n=this._sectionRenders.get(e);if(n){var o=void 0,r=void 0;if(this._manager.isPageMode()){var i=this.getLayoutBoxInfo(e);i.isFirst&&(o=Xo.getPositionFromRange(new c.GCPRange(t,1)),r=i.maxHeight)}if(!o){var a=this._manager.engine.isPlaceholderAtEmptyParagraph(t);o=Xo.getPositionFromRange(new c.GCPRange(t-1,1),{alignToBottom:!a})}if(o){var s=n.state.y!==Xo.INVISIBLE_POSITION_2D.y?n.state.y:o.y;return n.updateLayout(0,o.y,r),o.y-s+n.consumeDeltaHeight()}}return 0},t.prototype.updatePositionBy=function(e,t){if(0!==t){var n=this._sectionRenders.get(e);if(n&&n.visible){var o=n.state.y;n.updateLayout(0,o+t)}}},t.prototype.onRenderFinish=function(){this._renderRef.current&&this.triggerFullReflow()},t.prototype.requireReflowNext=function(e,t){return!!(this._placeholderSnapshot.size>0&&t)&&(!this._placeholderSnapshot.has(e.data)&&this._placeholderSnapshot.has(t.data))},t.prototype.incrementalReflow=function(){var e=this._manager.engine.placeholderInfos;if(e.length>0){for(var t=this._manager.reflowRanges,n=0,o=0,r=0;n<e.length&&r<t.length;++r){for(;n<e.length&&e[n].gcpBegin<t[r].gcpBegin;)this.updatePositionBy(e[n].data,o),n+=1;if(n<e.length){var i=t[r].end();do{var a=e[n];if(!this._placeholderPropertyGetter.getLastLayoutHeight(a.data)&&!this._manager.data.isFullyDelete(a.data))return;o=this.updatePosition(a.data,a.gcpBegin),n+=1}while(n<e.length&&e[n].gcpBegin<i);this.requireReflowNext(e[n-1],e[n])&&(o=this.updatePosition(e[n].data,e[n].gcpBegin),n+=1)}}if(0!==o)for(;n<e.length;)this.updatePositionBy(e[n].data,o),n+=1}this._placeholderSnapshot=new Set(e.map((function(e){return e.data})))},t.prototype.reflow=function(){var e=this._manager.engine.placeholderInfos;if(e.length>0){var t=this._manager.reflowRanges;if(t.length>0){for(var n=0;n<e.length&&e[n].gcpBegin<t[0].gcpBegin;)n+=1;for(;n<e.length;)this.updatePosition(e[n].data,e[n].gcpBegin),n+=1}}},t.prototype.onRenderLayoutChange=function(){if(this._renderRef.current){this._renderRef.current.onLayoutChange(),this._manager.isPageMode()?this.reflow():this.incrementalReflow();var e=this._manager.activator.activeAnchorId;e&&!this.hasPlaceholder(e)&&this.subView.onRenderLayoutChange()}},t.prototype.onCommentAdd=function(e){if(e.placeholder){var t=this._placeholderPropertyGetter.getLastLayoutHeight(e.placeholder.origin||""),n=Zo.estimateCommentHeightAfterAdd(t);this._placeholderPropertyGetter.silentSetHeight(e.placeholder.current,n)}else this.subView.onCommentAdd(e)},t.prototype.onCommentDelete=function(e){e.placeholder&&e.placeholder.origin&&this._placeholderPropertyGetter.deleteHeight(e.placeholder.origin)},t.prototype.syncData=function(){this._renderRef.current&&this._renderRef.current.syncData(),this.subView.syncData()},t.prototype.activate=function(e){this._renderRef.current&&(e&&this.hasPlaceholder(e)?(this._renderRef.current.activate(e),this.subView.activate("")):(this._renderRef.current.activate(""),this.subView.activate(e)))},t.prototype.hover=function(){},t.prototype.peek=function(e){this.subView.peek(e)},t}(mr),vr=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)a.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return a},br=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(vr(arguments[t]));return e},Cr=function(){function e(e){this._commentInfos=[],this._anchorIds=new Set,this._rangeInfoMap=new Map,this._idRangeMap=new Map,this._updated=!1,this._placeholderInfos=[],this._placeholderAnchorIds=new Set,this._idPlaceholderMap=new Map,this._editor=e}return e.prototype.destroy=function(){this._collectRanges&&this._collectRanges.destroy()},Object.defineProperty(e.prototype,"updated",{get:function(){var e=this._updated;return this._updated=!1,e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"commentInfos",{get:function(){return this._commentInfos},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"placeholderInfos",{get:function(){return this._placeholderInfos},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"anchorIds",{get:function(){return this._anchorIds},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rangeInfoMap",{get:function(){return this._rangeInfoMap},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"idRangeMap",{get:function(){return this._idRangeMap},enumerable:!0,configurable:!0}),e.prototype.getPlaceholderInfo=function(e){return this._idPlaceholderMap.get(e)},e.prototype.hasPlaceholder=function(e){return this._placeholderAnchorIds.has(e)},Object.defineProperty(e.prototype,"hasCollectableCommentInfo",{get:function(){return this._commentInfos.length>0||this._placeholderInfos.length>0},enumerable:!0,configurable:!0}),e.prototype.parseCollection=function(){var e=this;this._anchorIds.clear(),this._rangeInfoMap.clear(),this._idRangeMap.clear(),this._commentInfos.forEach((function(t){e._rangeInfoMap.set(t.range,t),t.anchorIds.forEach((function(n){e._anchorIds.add(n),e._idRangeMap.has(n)?e._idRangeMap.get(n).push(t.range):e._idRangeMap.set(n,[t.range])}))})),this._placeholderAnchorIds.clear(),this._idPlaceholderMap.clear(),this._placeholderInfos.forEach((function(t){t.data.split(c.CommentSpanPropKey.commentsConnection).forEach((function(n){e._placeholderAnchorIds.add(n),e._idPlaceholderMap.has(n)?e._idPlaceholderMap.get(n).push(t):e._idPlaceholderMap.set(n,[t])}))}))},e.prototype.isSpecial=function(e,t){var n=e.getAttributes();return n instanceof c.EmbedCommentProperty&&n.type===t},e.prototype.isPlaceholder=function(e){return this.isSpecial(e,Do.g.PLACEHOLDER)},e.prototype.isCaret=function(e){return this.isSpecial(e,Do.g.CARET)},e.prototype.isUncommentable=function(e){return e.getType()===c.TDSpanType.ParaBreak||this.isPlaceholder(e)},e.prototype.collectInRange=function(e){var t=this;br(this._editor.service.getDocument().getRange(e.gcpBegin,e.end(),!1).getSpans()).forEach((function(e){var n=e.getComments();if(n!==c.TDConstants.Undefined&&n.length>0&&!t.isUncommentable(e)){var o={range:e.getRange(),anchorIds:n};1===o.range.len&&t.isCaret(e)&&(o.isCaret=!0),t._commentInfos.push(o)}else t.isPlaceholder(e)&&t._placeholderInfos.push({gcpBegin:e.getRange().gcpBegin,data:e.getAttributes().data})}))},e.prototype.computeCollectRange=function(e){var t=this;if(this._collectRanges){if(e){e.values.forEach((function(e){return t._collectRanges.insertRange(g.StringUtil.generateRandomId(),e)}));var n=[];return this._collectRanges.forEachRange((function(e){return n.push(e.range),!1}),!0),n}}else if(e)return e.values;return[new c.GCPRange(0,this._editor.service.getDocument().getDocLength())]},e.prototype.collectComments=function(e){var t=this;this._updated=!0,this._commentInfos=[],this._placeholderInfos=[],this.computeCollectRange(e).forEach((function(e){t.collectInRange(e)})),this.parseCollection(),this._anchorIds.size>0?(this._collectRanges||(this._collectRanges=this._editor.createRangeManager(!1)),this._collectRanges.removeAll(),this._rangeInfoMap.forEach((function(e,n){t._collectRanges.insertRange(g.StringUtil.generateRandomId(),n)})),this._placeholderInfos.forEach((function(e){t._collectRanges.insertRange(g.StringUtil.generateRandomId(),new c.GCPRange(e.gcpBegin,1))}))):this._collectRanges&&(this._collectRanges.destroy(),this._collectRanges=void 0)},e.prototype.getSpecialSpan=function(e,t){var n=this._editor.service.getDocument().getRange(e,e+1).getSpans().item(0);if(n){if(this.isSpecial(n,t))return n;if(t===Do.g.CARET&&(n=n.getPrev())&&this.isSpecial(n,t))return n}},e.prototype.findCaretGcp=function(e){var t=this.getSpecialSpan(e,Do.g.CARET);return t?t.getRange().gcpBegin:void 0},e.prototype.createPlaceholderProperty=function(e){var t=new c.EmbedCommentProperty;return t.type=Do.g.PLACEHOLDER,t.data=e,t},e.prototype.createCaretProperty=function(e){var t=new c.EmbedCommentProperty;return t.type=Do.g.CARET,t.comments=e,t},e.prototype.insertCommentDrawing=function(e,t,n,o){if(n>0&&this._editor.isEditable()){var r=this._editor.service.getDocument().getRange(n-1,n).getSpans().item(0);if(r){var i=r.getLink();if(i!==c.TDConstants.Undefined&&i)t.link=i}}e.insertDrawing(o,t)},e.prototype.addCommentPlaceholder=function(e,t,n){var o=this.getSpecialSpan(t,Do.g.PLACEHOLDER);if(o){var r=o.getAttributes().data,i=r;if(!r.includes(e)){i=""+r+c.CommentSpanPropKey.commentsConnection+e;var a=this.createPlaceholderProperty(i);n.setSpanProperty(o.getRange(),a)}return{origin:r,current:i,changed:e}}return this.insertCommentDrawing(n,this.createPlaceholderProperty(e),t,c.OperationUtil.getFixPos(n.operations,t)),{origin:void 0,current:e,changed:e}},e.prototype.isPlaceholderAllowed=function(e){return this._editor.service.getDocument().getRange(e,e+1).storyType()===c.TDStoryType.MainTextStory&&!this._editor.service.getDocument().getTableFromGcp(e)},e.prototype.addComment=function(e,t,n){var o=this;if(t&&e.length>0){var r=c.DeltaOption.createLocalDeltaOption(this._editor.service.getSelection().range()).buildDelta();r.globalOpts.updateSelection=!(n&&!1===n.updateSelection),e.forEach((function(e){e.isEmpty()||br(o._editor.service.getDocument().getRange(e.gcpBegin,e.end()).getSpans()).forEach((function(n){if(!o.isUncommentable(n)){var i=n.getAttributes().clone();i.addComment(t),r.setSpanProperty(e,i)}}))})),1===e.length&&e[0].isEmpty()&&this.insertCommentDrawing(r,this.createCaretProperty([t]),e[0].gcpBegin,e[0].gcpBegin);var i=e[e.length-1],a=void 0;if(r.operations.length>0&&this.isPlaceholderAllowed(i.begin())&&(a=this.addCommentPlaceholder(t,i.end(),r)),r.operations.length>0){if(this._editor.applyDelta(r),n&&n.returnDirtyRange)return{placeholder:a,dirtyRange:new c.ModelDirtyRange(r.operations.map((function(e){return e instanceof c.InsertOperation?new c.GCPRange(e.range.gcpBegin,e.changeLen):e.afterRange.clone()})))};if(a)return{placeholder:a}}}return{}},e.prototype.injectCommentTraitToApool=function(e){var t=this._editor.service.getDocument().getStoryRangeFromGcpRange(new c.GCPRange(0,1)),n=this._editor.service.getDocument().getRange(t.len-2,t.len-1).getSpans().item(0);if(n&&n.getType()===c.TDSpanType.ParaBreak){var o=n.getAttributes().clone();0===o.comments.length?o.addComment(" "):o.deleteComment(" "),e.setSpanProperty(n.getRange(),o,c.TDSetPropMode.Cover)}},e.prototype.deleteCommentWithDelta=function(e,t){var n=this,o=this._idRangeMap.get(e)||[],r=!1,i=void 0;return o.forEach((function(o){br(n._editor.service.getDocument().getRange(o.gcpBegin,o.end()).getSpans()).forEach((function(a){var s=a.getAttributes().clone();s.deleteComment(e);var l=c.OperationUtil.getFixedGcpRange(t.operations,o);t.setSpanProperty(l,s,c.TDSetPropMode.Cover),0===s.comments.length&&n.isCaret(a)?(t.deleteText(l),r=!0):r=!1,i={changed:e};var p=n.getSpecialSpan(o.end(),Do.g.PLACEHOLDER);if(p){var u=p.getAttributes().data.replace(new RegExp(e+";?"),""),d=new c.GCPRange(c.OperationUtil.getFixPos(t.operations,o.end()),1);if(u.length>0){var h=n.createPlaceholderProperty(u);t.setSpanProperty(d,h)}else t.deleteText(d)}}))})),{isPureCaretDelete:r,placeholderDeltaInfo:i}},e.prototype.deleteComment=function(e,t){var n=t&&t.silent?this.silentDelta():c.DeltaOption.createLocalDeltaOption(this._editor.service.getSelection().range()).buildDelta(),o=this.deleteCommentWithDelta(e,n),r=o.isPureCaretDelete,i=o.placeholderDeltaInfo;return n.operations.length>0?(t&&t.readonlyMode&&r&&this.injectCommentTraitToApool(n),this._editor.applyDelta(n),{placeholder:i}):{}},e.prototype.silentDeleteInvalidComments=function(e){var t=this,n=this.silentDelta();e.forEach((function(e){t.deleteCommentWithDelta(e,n)})),n.operations.length>0&&this._editor.applyDelta(n)},e.prototype.isPlaceholderAtEmptyParagraph=function(e){var t=this._editor.service.getSelection().getParaRange(e);if(t&&e-1===t.begin()){var n=this._editor.service.getDocument().getRange(e,e+1).getSpans().item(0);if(n){var o=n.getPrev();return o&&this.isCaret(o)}}return!1},e.prototype.getRanges=function(e){return this._idRangeMap.get(e)||[]},e.prototype.isPlaceholderValidateAtGcp=function(e,t){var n=this.getRanges(e);return n.length>0&&n[n.length-1].end()===t},e.prototype.fixPlaceholderMismatch=function(e,t,n){var o=this,r=t.getRange().gcpBegin,i=t.getAttributes(),a=[],s=e.filter((function(e){return o.isPlaceholderValidateAtGcp(e,r)})).join(c.CommentSpanPropKey.commentsConnection),l=new c.GCPRange(c.OperationUtil.getFixPos(n.operations,r),1);if(s!==i.data)if(s)n.setSpanProperty(l,this.createPlaceholderProperty(s));else{n.deleteText(l);var p=i.data.split(c.CommentSpanPropKey.commentsConnection);p.some((function(e){var t=o._idPlaceholderMap.get(e);return t&&t.length>1}))&&p.forEach((function(e){o.getRanges(e).forEach((function(e){a.push(c.OperationUtil.getFixedGcpRange(n.operations,e))}))}))}else if(i.comments.length>0){var u=i.clone();u.comments=[],n.setSpanProperty(l,u)}return a},e.prototype.fixPlaceholderMissing=function(e,t,n){var o=this,r=t.getRange().gcpBegin,i=e.filter((function(e){return o.isPlaceholderValidateAtGcp(e,r)}));if(i.length>0)return this.insertCommentDrawing(n,this.createPlaceholderProperty(i.join(c.CommentSpanPropKey.commentsConnection)),r,c.OperationUtil.getFixPos(n.operations,r)),i},e.prototype.fixGlobalPlaceholderMissing=function(e,t){var n=this;if(this._anchorIds.size!==this._placeholderAnchorIds.size){var o=[];this._anchorIds.forEach((function(e){n._placeholderAnchorIds.has(e)||o.push(e)}));var r=new Map;o.forEach((function(e){if(!t||!t.has(e)){var o=n._idRangeMap.get(e);if(o&&o.length>0){var i=o[o.length-1].end();r.has(i)?r.get(i).push(e):r.set(i,[e])}}})),br(r).sort((function(e,t){return e[0]-t[0]})).forEach((function(t){var o=vr(t,2),r=o[0],i=o[1];if(n.isPlaceholderAllowed(r)){var a=c.OperationUtil.getFixPos(e.operations,r);n.insertCommentDrawing(e,n.createPlaceholderProperty(i.join(c.CommentSpanPropKey.commentsConnection)),r,a)}}))}},e.prototype.silentDelta=function(e){var t=c.DeltaOption.createLocalDeltaOption(e||this._editor.service.getSelection().range());return t.undoOption.fromUndo=!1,t.undoOption.needMergeUndoStackTop=!0,t.updateSelection=!1,this._editor.run("isUndoAvailable")||(t.undoOption.needInverse=!1),t.buildDelta()},e.prototype.extendFixRange=function(e){if(e){var t=e.begin(),n=e.len+1,o=this._editor.service.getDocument().getRange(t,t+1).getSpans().item(0);return o&&this.isPlaceholder(o)&&(t-=1,n+=1),new c.GCPRange(Math.max(t,0),n)}return new c.GCPRange(0,this._editor.service.getDocument().getDocLength())},e.prototype.fixComment=function(e,t){var n=this;if(e&&this._editor.service.getDocument().getExceptionRanges().some((function(t){return t.intersect(e)})))return[];var o=[],r=this.extendFixRange(e),i=br(this._editor.service.getDocument().getRange(r.gcpBegin,r.end()).getSpans()),a=t||this.silentDelta(r),s=[],l=new Set;return i.forEach((function(e){if(n.isPlaceholderAllowed(e.getRange().gcpBegin)){if(n.isPlaceholder(e))o.push.apply(o,br(n.fixPlaceholderMismatch(s,e,a)));else if(s.length>0){var t=n.fixPlaceholderMissing(s,e,a);t&&t.forEach((function(e){return l.add(e)}))}var r=e.getComments();r!==c.TDConstants.Undefined&&(s=r)}})),this.fixGlobalPlaceholderMissing(a,l),!t&&a.operations.length>0&&this._editor.applyDelta(a),o},e.prototype.upgradeComment=function(){var e=this.silentDelta();return this.fixGlobalPlaceholderMissing(e),e.operations.length>0&&(this._editor.applyDelta(e),!0)},e}(),_r=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},wr=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Rr=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)a.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return a},Sr=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(Rr(arguments[t]));return e},Er=function(){function e(e,t){var n=this;this._ready=!1,this._reflowRangeMap=new Map,this._positionIdMap=new Map,this._refreshCommentAtLayoutChange=!1,this._isCommentUpgradeDataChange=!1,this._newAnchorId="",this._commentRepeatFixCount=0,this._reportInfoStack=[],this._onModelChange=function(e){var t=n.getDirtyRange(e);if(t&&(n._lastDirtyRange=t,t.values.forEach((function(e){var t=n._reflowRangeMap.get(e.gcpBegin);(!t||t.len<e.len)&&n._reflowRangeMap.set(e.gcpBegin,e)})),t!==n._layoutOnlyDirtyRange&&(n._layoutOnlyDirtyRange=void 0,n.collectCommentProperties(),n._overlay.onCommentChanged(),!e.fromServer&&n._lastDirtyRange&&!n._editor.isCompositing()&&n._commentRepeatFixCount<10))){var o=n._lastDirtyRange;setTimeout((function(){n.collectCommentProperties(),n.applyCommentFix(o)?(n._commentRepeatFixCount>0&&n._reportInfoStack.push(n.getReportInfo()),n._commentRepeatFixCount+=1):(n._reportInfoStack.length>0&&(n._editor.isCompositing()||c.ReportHelper.captureException(c.MonitorName.COMMENT_REPEAT_FIX,{},new Error(JSON.stringify(n._reportInfoStack))),n._reportInfoStack=[]),n._commentRepeatFixCount=0)}),0)}},this._onEfficientModelChange=function(e){n.getDirtyRange(e)&&(n._ready&&!n._refreshCommentAtLayoutChange&&(n.collectCommentPositions(),n.refreshData()),n._layoutOnlyDirtyRange=void 0),n._refreshCommentAtLayoutChange=!1},this._onFirstRenderFinish=function(){n.collectCommentPositions()},this._onRenderFinish=function(){n._isPageMode!==n.isPageMode()&&(n._isPageMode=n.isPageMode(),n._view.onRenderFinish(),n.collectCommentPositions())},this._onSurfacePaddingChange=function(){n._renderer.onSurfacePaddingChange()},this._onLayoutChange=function(){Ho.isLogin()&&(n._renderer.onLayoutChange(),n.hasComment?(n._refreshCommentAtLayoutChange&&(n.collectCommentPositions(),n.refreshData()),n._view.syncData(),n._view.onRenderLayoutChange()):n._data.reset(),n._reflowRangeMap.clear())},this._onServerMessage=function(e){var t=e.msg.payload;Ho.isLogin()&&t&&!Ho.isLocalUpdateMessage(t.sid)&&n.decodeServerMessage(e)},this._onNetworkChange=function(){n._renderer.onNetworkChange()},this._editor=e,this._handler=t,this._engine=new Cr(this._editor),Xo.init(this._editor),this._view=new Wo(this),this._placeholderPropertyGetter=new dr(this._view.isEmbed,this),this._view.registerViewType(Do.f.Embed,yr),this._renderer=new or(this),this._activator=new Yo(this),this._overlay=new ur(this),this._data=new qo(this,(function(){n._view.syncData()})),this._isPageMode=this.isPageMode(),this.init(),this._store&&(this._onlineSubscription=this._store.get(m.d.IsOnline).subscribe(this._onNetworkChange))}return e.prototype.destroy=function(e){e.removeListener(c.StateNotification.ModelChange,this),e.removeListener(c.StateNotification.EfficientModelChange,this),e.removeListener(c.RenderNotificationTypes.RENDER_LAYOUT_CHANGE,this),e.removeListener(c.RenderNotificationTypes.RENDER_FINISH,this),e.removeListener(dt.c.ServerMessage,this),this._activator.destroy(),this._renderer.destroy(),this._engine.destroy(),this._onlineSubscription.unsubscribe(),Xo.destory(),Bo.destroy()},Object.defineProperty(e.prototype,"isOnline",{get:function(){return!!this._store&&this._store.getValue(m.d.IsOnline)},enumerable:!0,configurable:!0}),e.prototype.configRenderer=function(e){this._renderer.config(e)},Object.defineProperty(e.prototype,"placeholderPropertyGetter",{get:function(){return this._placeholderPropertyGetter},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"engine",{get:function(){return this._engine},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isMultiEditorMode",{get:function(){return this._contextService.context.editors.length>1},enumerable:!0,configurable:!0}),e.prototype.getDirtyRange=function(e){if(Ho.isLogin()&&!this.isMultiEditorMode){var t=Sr(e.changeData.dirtyRangeMap.values());if(t.length>1){var n=t.map((function(e){return e.values})).reduce((function(e,t){return e.concat(t)}));return new c.ModelDirtyRange(n)}return t[0]}},e.prototype.isPageMode=function(){return this._editor.docEnv.layoutType===c.LayoutType.Paged},e.prototype.getReportInfo=function(){if(this._lastDirtyRange){var e=[],t=[],n=this._engine,o=n.commentInfos,r=n.placeholderInfos,i=0,a=0;return this._lastDirtyRange.values.slice().sort((function(e,t){return e.gcpBegin-t.gcpBegin})).forEach((function(n){for(;i<o.length;++i){var s=o[i];if(s.range.end()>=n.gcpBegin-5&&e.push({ids:s.anchorIds.join(","),s:s.range.gcpBegin,e:s.range.end()}),s.range.gcpBegin>n.end()+5)break}for(;a<r.length;++a){var c=r[a];if(c.gcpBegin>n.gcpBegin-5&&t.push({ids:c.data,s:c.gcpBegin}),c.gcpBegin>n.end()+5)break}})),{comments:e,placeholders:t}}},Object.defineProperty(e.prototype,"hasComment",{get:function(){return this._engine.hasCollectableCommentInfo||!!this._newAnchorId},enumerable:!0,configurable:!0}),e.prototype.fireLayoutChange=function(e){this._layoutOnlyDirtyRange=new c.ModelDirtyRange(e),this._editor.fire(new c.ModelChangeNotification({dirtyRangeMap:new Map([[c.StoryID.MainDocId,this._layoutOnlyDirtyRange]])}))},e.prototype.refreshData=function(e,t){var n=this,o=this._data.serialize(this._engine.anchorIds);this._view.clearCache(),o.length>0?this._data.requestPullCommentAnchors(o,(function(o){0===o&&n._data.asyncRequestPullAllCommentContents(),n._view.syncData(),e&&e(),t&&t(!0)})):t&&t(!1)},e.prototype.isPlaceholder=function(e){var t=this._editor.service.getDocument().getRange(e,e+1).getSpans().item(0);return t&&this._engine.isPlaceholder(t)},e.prototype.isCaret=function(e){var t=this._editor.service.getDocument().getRange(e,e+1).getSpans().item(0);return t&&this._engine.isCaret(t)},e.prototype.applyCommentFix=function(e){var t=this;if(this._isCommentUpgradeDataChange)return this._isCommentUpgradeDataChange=!1,!1;var n=!1;if(this.hasComment&&this._editor.isEditable()){var o=this._engine.silentDelta(e.unionValue),r=e.values.slice().sort((function(e,t){return e.gcpBegin-t.gcpBegin})).map((function(e){return t._engine.fixComment(e,o)})).reduce((function(e,t){return e.concat(t)}));o.operations.length>0&&(this._editor.applyDelta(o),n=!0),r.length>0&&this.fireLayoutChange(r)}return n},e.prototype.handleCommentOpenOptions=function(){var e=Object(g.getUrlParameter)("anchorId");e&&(this._data.has(e)?this._activator.activate(e):Ho.showErrorTips("批注已被删除"))},e.prototype.init=function(){var e=this;Ho.isLogin()&&(this.collectCommentProperties(),this._renderer.onLayoutChange(),this._isCommentUpgradeDataChange=this._engine.upgradeComment(),this._isCommentUpgradeDataChange&&c.ReportHelper.monitor(c.MonitorName.COMMENT_UPGRADE),this._engine.placeholderInfos.some((function(t){return!e._engine.isPlaceholderAllowed(t.gcpBegin)}))&&c.ReportHelper.monitor(c.MonitorName.COMMENT_INVALID_PLACEHOLDER),this._view.ensureViewLoaded().then((function(){e._ready=!0,e._view.show("",!0),e.refreshData(void 0,(function(t){e.collectCommentPositions()||e._editor.once(c.RenderNotificationTypes.RENDER_FINISH,e._onFirstRenderFinish,e),e._overlay.onCommentChanged(t),e.handleCommentOpenOptions()})),e._onLayoutChange(),e._editor.on(c.StateNotification.ModelChange,e._onModelChange,e),e._editor.on(c.StateNotification.EfficientModelChange,e._onEfficientModelChange,e),e._editor.on(dt.c.ServerMessage,e._onServerMessage,e),e._editor.on(c.RenderNotificationTypes.RENDER_LAYOUT_CHANGE,e._onLayoutChange,e),e._editor.on(c.RenderNotificationTypes.RENDER_FINISH,e._onRenderFinish,e)})))},e.prototype.collectCommentProperties=function(e){var t=e||this._lastDirtyRange;this._engine.collectComments(t)},e.prototype.collectCommentPosition=function(e,t,n){var o=this,r=Xo.getPositionFromRange(e.range,{alignToTableCell:!0});if(void 0!==r){var i=t.get(r.y),a=i||[];e.anchorIds.forEach((function(e){n.has(e)||o._data.isFullyDelete(e)||(n.add(e),a.push(e))})),a!==i&&t.set(r.y,a)}return!!r},e.prototype.collectCommentPositions=function(){var e=this,t=new Map,n=new Set,o=this._engine.commentInfos,r=!0;return o.forEach((function(o){e.collectCommentPosition(o,t,n)||(r=!1)})),this._positionIdMap=t,this._editor.fire(new Vo(ko.PositionCollected,this._positionIdMap),!1),r},e.prototype.onEditorVisibiltyChanged=function(e){e?this.collectCommentPositions():this._view.mode===Do.f.Embed&&(this._view.mode=Do.f.External)},Object.defineProperty(e.prototype,"editor",{get:function(){return this._editor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ready",{get:function(){return this._ready},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"handler",{get:function(){return this._handler},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activator",{get:function(){return this._activator},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"view",{get:function(){return this._view},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"overlay",{get:function(){return this._overlay},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"positionIdMap",{get:function(){return this._positionIdMap},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"editInfo",{get:function(){return this._editInfo},set:function(e){this._editInfo=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reflowRanges",{get:function(){return Sr(this._reflowRangeMap.values()).sort((function(e,t){return e.gcpBegin-t.gcpBegin}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"newAnchorId",{get:function(){return this._newAnchorId},enumerable:!0,configurable:!0}),e.prototype.getAnchorIdByPosition=function(e){return this._positionIdMap.get(e)},e.prototype.switch=function(e){this.cancelAdd(),c.ReportHelper.tdwReport({opername:"doc_cooper",module:"word_comment",action:"comment_position",ver5:this._view.isEmbed?"in":"out"}),this._view.mode=e},e.prototype.setPreviewMode=function(e){this._view.previewMode=e},e.prototype.normalizeAddRanges=function(){var e=this._editor.service.getSelection().range();if(e.isEmpty()){var t=this._engine.findCaretGcp(e.gcpBegin);return void 0!==t?[new c.GCPRange(t,1)]:[e]}return this._editor.selection.tableCellRangeAll?this._editor.selection.gcpRanges:[e]},e.prototype.disableUIBeforeAdd=function(){this._editor.fire(new c.FocusBlurNotification(c.FocusBlurNotificationType.REQUEST_BLUR),!1),Ho.isMobile()&&(this._mobileToolbarService&&this._mobileToolbarService.closePanel(),this._editor.fire(new c.SelectionChangeNotification(this._editor.viewSelection.getViewRange(),this._editor.zoom,{scrollToView:c.ScrollViewType.None,forceFocus:!1,mobileContextMenu:c.MobileContextMenuType.Hide,mobileSelectionDrag:c.MobileSelectionDragType.Hide}))),this._workbench.emit("$toggleLinkTips",!1)},e.prototype.addComment=function(){var e=this._editor.service.getSelection().range(),t=this.normalizeAddRanges();1!==t.length||t[0].begin()===e.begin()&&t[0].end()===e.end()||this._editor.setRangeTo(t[0],{forceFocus:!1}),this._newAnchorId=g.StringUtil.generateRandomId();var n=1===t.length&&t[0].isEmpty();if(t.length>0){this.disableUIBeforeAdd();var o=t[t.length-1].end();if(this._view.canCancel(o))this._activator.silentActivateNew(!1),!Ho.isMobile()&&n&&this._overlay.onCommentChanged(),this._view.syncData();else{this._activator.silentActivateNew();var r=this._engine.addComment(t,this._newAnchorId,{updateSelection:!1,returnDirtyRange:!1});this._view.onCommentAdd(r)}}},e.prototype.enableUIAfterAdd=function(){this._workbench.emit("$toggleLinkTips",!0)},e.prototype.cancelAdd=function(){this._newAnchorId&&(this._newAnchorId="",Ho.isMobile()||this._overlay.onCommentChanged(),this.activator.onCancelAdd(),this._view.syncData(),this.enableUIAfterAdd())},e.prototype.confirmAdd=function(){if(this._newAnchorId){var e=this.normalizeAddRanges(),t=e[e.length-1].end();this._view.canCancel(t)&&(this._view.onCommentAdd(this._engine.addComment(e,this._newAnchorId,{updateSelection:!1})),this._refreshCommentAtLayoutChange=!0),this.enableUIAfterAdd(),this._newAnchorId=""}},e.prototype.deleteComment=function(e){var t=this,n=this._engine.deleteComment(e,{readonlyMode:!this._editor.isEditable(),silent:!0});if(this._view.onCommentDelete(n),this._editor.isEditable()){var o=this._data.emptyAnchorIds;o.length>0&&this._editor.once(c.RenderNotificationTypes.RENDER_LAYOUT_CHANGE,(function(){t._engine.silentDeleteInvalidComments(o)}))}},e.prototype.decodeServerMessage=function(e){var t=e.msg.payload;if(t.comment){for(var n=t.comment,o=[],r=0;r<n.length;r++){var i=n[r];try{var a={commentId:i.commentid,authorId:i.author,publishTime:Number(i.time),editTime:Number(i.time),repliedId:i.repliedid,name:decodeURI(i.author_name),avatar:i.head_url,anchorId:i.anchor,content:decodeURI(i.content)};o.push(a)}catch(e){g.Logger.error("comment|response decode error "+JSON.stringify(i))}}var s={docId:t.docid,comments:o};this._data.push(t.op,s)}},_r([Object(m.l)(),wr("design:type",m.x)],e.prototype,"_store",void 0),_r([Object(m.l)(),wr("design:type",m.t)],e.prototype,"_mobileToolbarService",void 0),_r([Object(m.l)(),wr("design:type",m.f)],e.prototype,"_contextService",void 0),_r([Object(m.l)(),wr("design:type",m.B)],e.prototype,"_workbench",void 0),e}(),Tr=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)a.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return a},Pr=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(Tr(arguments[t]));return e},Ir=function(e,t){var n=[],o=t.data,r=[];return o.getCommentAnchors([e]).forEach((function(e){r=Pr(r,e.commentList)})),r.forEach((function(e){void 0!==e.content&&n.push(e.content)})),n},xr=function(e,t,n,o,r){var i=o?n.main+n.sub:n.main,a=new c.GCPRange(t.gcpBegin+i,0),s=new c.TextSpan,l=new c.ParaBreakSpan(s),p=r||new c.ParaProperty,u=c.OperationFactory.getOp(c.OperationType.InsertParagraph,{text:c.PlaceholderChar.ParagraphBreak,spanProperty:l,paraProperty:p,range:a});return e.addOperation(u),{main:o?n.main:n.main+1,sub:n.sub+1}},Or=function(e,t,n,o){var r=o?n.main+n.sub:n.main,i=c.OperationUtil.moveOffset(t.clone(),r);e.addOperation(i||t)},Lr=function(e,t,n){if(!(null==n?void 0:n.isFromInternal)||n.isFromOtherPad)return e;var o,r=c.DeltaOption.createLocalDeltaOption(e.globalOpts.originRange).buildDelta(),i=!t.view.isHidden&&t.view.isEmbed,a=!1,s={main:0,sub:0},l=[];return e.forEachOp((function(e){e instanceof c.InsertParaOperation&&l.push(e)})),o=l.shift(),e.forEachOp((function(e){if(e instanceof c.InsertStoryBeginOperation&&(a=!0),e instanceof c.InsertOperation&&e.param&&e.param.spanProperty){var n=e.param.spanProperty;if(n instanceof c.EmbedCommentProperty&&Do.h.includes(n.type)){if(i)Ir(n.data,t).forEach((function(t,n,i){s=0===n?xr(r,e.range,s,a,null==o?void 0:o.param.paraProperty):xr(r,e.range,s,a),s=function(e,t,n,o,r){var i=o?n.main+n.sub:n.main,a=new c.GCPRange(t.gcpBegin+i,0),s=new c.TextSpan,l=c.OperationFactory.getOp(c.OperationType.InsertText,{text:r,spanProperty:s,range:a});return e.addOperation(l),{main:o?n.main:n.main+r.length,sub:n.sub+r.length}}(r,e.range,s,a,t),n===i.length-1&&(s=xr(r,e.range,s,a))}));s={main:a?s.main:s.main-1,sub:s.sub-1}}else e instanceof c.InsertParaOperation?(o=l.shift(),n.comments&&n.comments.length>0&&(n.comments=[]),Or(r,e,s,a)):(n.comments&&n.comments.length>0&&(n.comments=[]),Or(r,e,s,a))}else Or(r,e,s,a);e instanceof c.InsertStoryEndOperation&&(a=!1)})),r},Mr=n(230),Nr=(n(354),n(355),function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}()),Ar=new RegExp("("+/[-:@a-zA-Z0-9_.,~%+/\\?=&#!;()[\]$]/.source+")"),Dr=new RegExp(/\b(?:(?:https?|s?ftp|ftps|file|nfs):\/\/|mailto:|tel:|www\.)/.source+Ar.source+"+","ig"),kr=function(e){function t(t){var n=e.call(this,t)||this;return n._ref=i.a.createRef(),n.state={maxHeight:0},n}return Nr(t,e),t.prototype.escape=function(e){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},t.prototype.renderHTML=function(e){return e.replace(Dr,(function(e){return'<a href="javascript:void(0);" data-href='+(e.indexOf(":")>-1?e:"//"+e)+">"+e+"</a>"}))},t.prototype._handleClick=function(e){if(e.target){var t=e.target;if("A"===t.tagName&&t.dataset){e.preventDefault();var n=t.dataset.href;n&&Object(g.openLinkWithCheck)(n,Ho.getDocId(),Ho.getAuthorId())}}},t.prototype.onRenderFinish=function(){if(this.props.maxLine&&this._ref.current){var e=parseFloat(getComputedStyle(this._ref.current).lineHeight||"");if(!Number.isNaN(e))if(Math.round(this._ref.current.getBoundingClientRect().height/e)>this.props.maxLine){var t=this.props.maxLine*e;Math.abs(t-this.state.maxHeight)>.5&&this.setState({maxHeight:t})}}else 0!==this.state.maxHeight&&this.setState({maxHeight:0})},t.prototype.componentDidMount=function(){this.onRenderFinish()},t.prototype.componentDidUpdate=function(){this.onRenderFinish()},t.prototype.render=function(){var e=this.props.text?this.renderHTML(this.escape(this.props.text)):"",t=this.state.maxHeight?{maxHeight:this.state.maxHeight+"px"}:{};return i.a.createElement("div",{className:"comment-text-box "+(this.props.className||""),ref:this._ref},this.props.children,i.a.createElement("span",{className:this.state.maxHeight?"comment-text-abstract":"",style:t,onClick:this._handleClick,dangerouslySetInnerHTML:{__html:e}}),this.state.maxHeight?i.a.createElement("div",null,"..."):null)},t}(i.a.Component),jr=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Fr=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return jr(t,e),t.prototype.render=function(){var e=this.props.comment,t=e.content&&e.content.startsWith(Do.d.EmptyPlaceholder)?"":e.content;return i.a.createElement("div",{className:"comment-embed-item-preview"},i.a.createElement(kr,{className:"comment-embed-text-preview",text:t},i.a.createElement("span",{className:"author-name"},e.name,":")))},t}(i.a.Component),Hr=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return jr(t,e),t.prototype.render=function(){var e=qo.getVisualComments(this.props.anchor,!1,!1);return i.a.createElement("div",{className:"comment-embed-group-preview"},e.map((function(e){return i.a.createElement(Fr,{key:e.commentId,comment:e})})))},t}(i.a.Component),Br=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return jr(t,e),t.prototype.render=function(){var e=this.props.data.split(c.CommentSpanPropKey.commentsConnection),t=this.props.manager.data.getCommentAnchors(e),n={};return this.props.maxHeight&&(n.maxHeight=this.props.maxHeight+"px",n.overflowY="auto"),t.length>0?i.a.createElement("div",{className:"comment-section-preview",style:n},t.map((function(e){return i.a.createElement(Hr,{key:e.anchorId,anchor:e})}))):null},t}(i.a.Component),Ur=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Vr=function(e){function t(t){var n=e.call(this,t)||this;return n.state={preview:!1},n}return Ur(t,e),t.prototype.componentDidMount=function(){var e=this.props.view.getView(Do.f.Embed);e&&e.addPlaceholder(this.props.data,this)},t.prototype.componentDidUpdate=function(){var e=this.props.view.getView(Do.f.Embed);e&&e.addPlaceholder(this.props.data,this)},t.prototype.componentWillUnmount=function(){var e=this.props.view.getView(Do.f.Embed);e&&e.removePlaceholder(this.props.data,this)},t.prototype.render=function(){if(this.state.preview){var e=Zo.getAvailablePageHeight(this.props.layoutBox),t=i.a.createElement(Br,{manager:this.props.view.manager,data:this.props.data,maxHeight:e});if(t)return t}return i.a.createElement("span",{ref:this.setRootRef},"​")},t}(Mr.b);var Wr,Gr=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),zr=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Gr(t,e),t.prototype.render=function(){var e=this.props.layoutBox.property;if(e){var n=t.renders[e.type];if(n)return n(this.props.layoutBox,this.props.containerFocus,this.props.context,e.data)}return i.a.createElement("span",{ref:this.setRootRef})},t}(Mr.b);!function(e){e.ARROW_LEFT="moveLeft",e.ARROW_UP="moveUp",e.ARROW_RIGHT="moveRight",e.ARROW_DOWN="moveDown",e.SELECT_LEFT="selectLeft",e.SELECT_RIGHT="selectRight",e.SELECT_UP="selectUp",e.SELECT_DOWN="selectDown",e.BACKSPACE="backspace"}(Wr||(Wr={}));var Kr=[{keyBindings:{win:c.KeyCode.ARROW_LEFT,mac:c.KeyCode.ARROW_LEFT},action:Wr.ARROW_LEFT},{keyBindings:{win:c.KeyCode.ARROW_UP,mac:c.KeyCode.ARROW_UP},action:Wr.ARROW_UP},{keyBindings:{win:c.KeyCode.ARROW_RIGHT,mac:c.KeyCode.ARROW_RIGHT},action:Wr.ARROW_RIGHT},{keyBindings:{win:c.KeyCode.ARROW_DOWN,mac:c.KeyCode.ARROW_DOWN},action:Wr.ARROW_DOWN},{keyBindings:{win:c.KeyAssist.SHIFT+c.KeyCode.ARROW_LEFT,mac:c.KeyAssist.SHIFT+c.KeyCode.ARROW_LEFT},action:Wr.SELECT_LEFT},{keyBindings:{win:c.KeyAssist.SHIFT+c.KeyCode.ARROW_RIGHT,mac:c.KeyAssist.SHIFT+c.KeyCode.ARROW_RIGHT},action:Wr.SELECT_RIGHT},{keyBindings:{win:c.KeyAssist.SHIFT+c.KeyCode.ARROW_UP,mac:c.KeyAssist.SHIFT+c.KeyCode.ARROW_UP},action:Wr.SELECT_UP},{keyBindings:{win:c.KeyAssist.SHIFT+c.KeyCode.ARROW_DOWN,mac:c.KeyAssist.SHIFT+c.KeyCode.ARROW_DOWN},action:Wr.SELECT_DOWN},{keyBindings:{win:c.KeyCode.BACKSPACE,mac:c.KeyCode.BACKSPACE},action:Wr.BACKSPACE}],qr=function(e,t){var n="",o="",r=e.getProperty();if(r instanceof c.EmbedCommentProperty){var i=r.data,a=Ir(i,t);n=function(e){var t=new RegExp(c.PlaceholderChar.ParagraphBreak+"|"+c.PlaceholderChar.ParagraphReturn+"|"+c.PlaceholderChar.TableStart+"|"+c.PlaceholderChar.TableEnd+"|"+c.PlaceholderChar.TableCellBreak+"|"+c.PlaceholderChar.TableCellStart+"|"+c.PlaceholderChar.TableRowBreak+"|"+c.PlaceholderChar.TableRowStart,"g"),n=c.CssUtil.computeTextSpanFullStyles(new c.TextSpan).cssText;return n=n.replace(/"/g,""),e.map((function(e,o,r){return'<br/><span style="'+n+'">'+Object(g.escapeHTML)(e?e.replace(t,""):e)+"</span>"+(o===r.length-1?"<br/>":"")})).join("")}(a),o="\n"+a.join("\n")+"\n"}return{html:n,plain:o}},Zr=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},$r=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Qr=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)a.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return a},Xr=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(Qr(arguments[t]));return e},Yr=function(){function e(e){var t=this;this._workbench=e,this._editor=null,this._needRestoreVisiblity=!1,this.commnetCopyParser=function(e){return t._editor&&t.isEmbeded?qr(e,t._manager):{html:"",plain:""}},this.commentPasteDeltaProcessor=function(e,n,o){return Lr(e,t._manager,o)},this._workbench.listen("$closeComment",(function(e){void 0===e&&(e=!1),t.close(!!e)})),this._workbench.listen("$restoreComment",(function(){t.restore()})),this._workbench.listen("$previewComment",(function(e){void 0===e&&(e=!0),t.setPreviewMode(!!e)})),this._workbench.listen("$rightDrawerWillOpen",(function(){t.setCommentVisible(!1)}))}return e.prototype.$onInit=function(e){var t,n;this._editor=e,this._manager=new Er(e,this),e.clipboardManager.addCopyContainerParser(c.ContainerType.Drawing,c.DrawingType.EmbedComment,this.commnetCopyParser),e.clipboardManager.addPasteDeltaProcessor(this.commentPasteDeltaProcessor),e.registerPlugin(function(e){var t;return(t={})[Wr.ARROW_LEFT]=function(t,n){t&&t instanceof c.MeloEditor&&e&&(e.onArrowKey(),e.isPlaceholder(t.service.getSelection().range().end()-1)&&t.surface.selectionHandler.moveLeft()),n()},t[Wr.ARROW_RIGHT]=function(t,n){t&&t instanceof c.MeloEditor&&e&&(e.onArrowKey(),e.isPlaceholder(t.service.getSelection().range().end()+1)&&t.surface.selectionHandler.moveRight()),n()},t[Wr.ARROW_UP]=function(t,n){n(),t&&t instanceof c.MeloEditor&&e&&(e.onArrowKey(),e.isEmbeded&&e.isPlaceholder(t.service.getSelection().range().end()-1)&&t.surface.selectionHandler.moveUp())},t[Wr.ARROW_DOWN]=function(t,n){n(),t&&t instanceof c.MeloEditor&&e&&(e.onArrowKey(),e.isEmbeded&&e.isPlaceholder(t.service.getSelection().range().end()-1)&&t.surface.selectionHandler.moveDown())},t[Wr.SELECT_LEFT]=function(t,n){if(t&&t instanceof c.MeloEditor&&e){var o=t.service.getSelection().range();(e.isPlaceholder(o.begin()-1)||o.len>1&&e.isPlaceholder(o.end()-2))&&t.surface.selectionHandler.selectLeft()}n()},t[Wr.SELECT_RIGHT]=function(t,n){if(t&&t instanceof c.MeloEditor&&e){var o=t.service.getSelection().range();(e.isPlaceholder(o.end())||o.len>1&&e.isPlaceholder(o.begin()+1))&&t.surface.selectionHandler.selectRight()}n()},t[Wr.SELECT_UP]=function(t,n){n(),t&&t instanceof c.MeloEditor&&e&&e.isEmbeded&&e.isPlaceholder(t.service.getSelection().range().begin()-1)&&t.surface.selectionHandler.selectUp()},t[Wr.SELECT_DOWN]=function(t,n){n(),t&&t instanceof c.MeloEditor&&e&&e.isEmbeded&&e.isPlaceholder(t.service.getSelection().range().end()-1)&&t.surface.selectionHandler.selectDown()},t[Wr.BACKSPACE]=function(t,n){var o=!1;if(t&&t instanceof c.MeloEditor){var r=t.service.getSelection().range();if(e&&r.isEmpty()){var i=e.getBackspaceStrategy(r.end());i===Do.a.Through?(o=!0,t.surface.selectionHandler.moveLeft()):i===Do.a.Double&&(t.surface.selectionHandler.selectLeft(),t.surface.selectionHandler.selectLeft())}}n(),o&&t.surface.selectionHandler.moveRight()},t}(this)),e.surface.keymapManager.addKeymaps(Kr),c.EmbedCommentPropertyGetters.getInstance().add(Do.g.PLACEHOLDER,this._manager.placeholderPropertyGetter),zr.renders=((t={})[Do.g.PLACEHOLDER]=(n=this._manager,function(e,t,o,r){return i.a.createElement(Vr,{layoutBox:e,containerFocus:t,context:o,key:g.StringUtil.generateRandomId(),data:r,view:n.view})}),t),this._editor.addContainerRender(c.ContainerType.Drawing,c.DrawingType.EmbedComment,(function(e,t,n){return i.a.createElement(zr,{layoutBox:e,containerFocus:t,context:n,key:g.StringUtil.generateRandomId()})}))},e.prototype.$beforeDestroy=function(e){this._manager.destroy(e),this._editor=null},e.prototype.registerRendererChildrenType=function(e){this._manager.configRenderer(new e(this._manager))},e.prototype.getManager=function(){return this._manager},e.prototype.setPreviewMode=function(e){this._manager.setPreviewMode(e)},e.prototype.removeListener=function(){this._editor&&this._editor.removeListener(c.StateNotification.ModelChange,this)},Object.defineProperty(e.prototype,"isCommentVisible",{get:function(){return!this._manager.view.isHidden},enumerable:!0,configurable:!0}),e.prototype.setCommentVisible=function(e,t){void 0===t&&(t=!1),e?this._manager.view.show():(t&&!this._manager.view.canHide&&(this._manager.view.mode=Do.f.External),this._manager.view.hide())},e.prototype.open=function(){this.isCommentVisible||this.setCommentVisible(!0)},e.prototype.close=function(e){void 0===e&&(e=!1),this.isCommentVisible&&(this._needRestoreVisiblity=this.isCommentVisible,this.setCommentVisible(!1,e))},e.prototype.restore=function(){this._needRestoreVisiblity&&!this.isCommentVisible&&(this._needRestoreVisiblity=!1,this.setCommentVisible(!0))},e.prototype.onEditorVisibiltyChanged=function(e){this._manager.onEditorVisibiltyChanged(e)},e.prototype.addComment=function(){this._manager.newAnchorId||this._manager.addComment()},e.prototype.hasComment=function(){return!!this._editor&&this._manager.engine.commentInfos.length>0},e.prototype.isEditable=function(){return this._manager.isOnline&&Ho.isCommentEditable()},Object.defineProperty(e.prototype,"inAddMode",{get:function(){return!!this._manager.newAnchorId},enumerable:!0,configurable:!0}),e.prototype.isParaBreakRange=function(e){if(this._editor&&1===e.len){var t=this._editor.service.getDocument().getRange(e.gcpBegin,e.end()).getSpans().item(0);return t&&t.getType()===c.TDSpanType.ParaBreak}return!1},Object.defineProperty(e.prototype,"ready",{get:function(){return this._manager.ready},enumerable:!0,configurable:!0}),e.prototype.canAddComment=function(){var e=this;if(this._manager.ready&&this._manager.isOnline&&!this._manager.isMultiEditorMode&&!this.inAddMode&&Ho.isCommentEditable()){if(this._editor.selection.tableCellRangeAll)return this._editor.selection.gcpRanges.some((function(t){return!e.isParaBreakRange(t)}));if(this._editor.onSelection().isSelectionAtParaBreak())return!1;var t=this._editor.selection.storyInfo.storyProp.storyType;if(t===c.StoryType.MainTextStory||Do.e.includes(t))return this.isEditable()}return!1},e.prototype.has=function(e,t){if(this._editor){var n=this._manager.engine.anchorIds;return Ho.isMobile()?n.has(e):this._manager.data.has(e,t)}return!1},e.prototype.activate=function(e,t,n){return this._manager.data.has(e,t)?(this.setCommentVisible(!0),this._manager.activator.activate(e),!0):(n&&Ho.showErrorTips("批注已被删除"),!1)},e.prototype.isPlaceholder=function(e){return this._manager.isPlaceholder(e)},e.prototype.getBackspaceStrategy=function(e){return this._manager.isPlaceholder(e-1)?this._manager.isCaret(e-2)?Do.a.Double:Do.a.Through:Do.a.Normal},e.prototype.switch=function(e){this._manager.switch(e)},e.prototype.getComments=function(){return this._editor?Xr(this._manager.engine.anchorIds):[]},Object.defineProperty(e.prototype,"isEmbeded",{get:function(){return!this._manager.view.isHidden&&this._manager.view.isEmbed},enumerable:!0,configurable:!0}),e.prototype.onArrowKey=function(){this._manager.activator.onArrowKey()},e=Zr([Object(m.i)({name:y.a.Comment,scope:0,for:["melo"]}),$r("design:paramtypes",[m.B])],e)}(),Jr=(n(368),n(369),function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}()),ei="comment-shortcut "+(Ho.isMobile()?"comment-shortcut-mobile":""),ti=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._onHover=function(e){Ho.isMobile()||t.props.onHover(t.getPosition(e))},t._onLeave=function(e){Ho.isMobile()||t.props.onLeave(t.getPosition(e))},t._onClick=function(e){t.props.onClick(t.getPosition(e)),c.ReportHelper.tdwReport({opername:"doc_cooper",module:"word_comment",action:"entry_number"})},t}return Jr(t,e),t.prototype.getPosition=function(e){return e.target.offsetTop},t.prototype.render=function(){return i.a.createElement("div",{className:ei,style:{top:this.props.position+"px"},onMouseEnter:this._onHover,onMouseLeave:this._onLeave,onClick:this._onClick},i.a.createElement("div",{className:"comment-shortcut-button"},i.a.createElement("div",{className:"comment-shortcut-button-tag"},Math.min(this.props.count,99))))},t}(i.a.Component),ni=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),oi=function(e){function t(t){var n=e.call(this,t)||this;return n._onPositionCollected=function(e){var t=[];e.data.size>0&&e.data.forEach((function(e,n){var o=e.length;o>0&&t.push({position:n,count:o})})),n.setState({shortcuts:t})},n._onShortcutPositionChanged=function(e){n.setState({disablePosition:e.data})},n._onHover=function(e){if(!n.props.manager.newAnchorId&&!n.props.manager.isMultiEditorMode){var t=n.props.manager.getAnchorIdByPosition(e);t&&n.props.manager.view.showOne(t)}},n._onLeave=function(e){if(!n.props.manager.newAnchorId&&!n.props.manager.isMultiEditorMode){var t=n.props.manager.getAnchorIdByPosition(e);t&&n.props.manager.view.hideOne(t)}},n._onClick=function(e){if(n.props.manager.isOnline&&!n.props.manager.isMultiEditorMode){var t=n.props.manager.getAnchorIdByPosition(e);t&&(n.props.manager.view.isHidden?(n.props.manager.view.hideOne(t),n.props.manager.view.show(t[0])):n.props.manager.activator.activate(t[0],!0,n.props.manager.view.isEmbed))}},n.state={shortcuts:[],disablePosition:Xo.INVISIBLE_POSITION},n.props.manager.editor.on(ko.PositionCollected,n._onPositionCollected,n),n.props.manager.editor.on(ko.ShortcutPositionChanged,n._onShortcutPositionChanged,n),n}return ni(t,e),t.prototype.componentWillUnmount=function(){this.props.manager.editor.removeListener(ko.PositionCollected,this),this.props.manager.editor.removeListener(ko.ShortcutPositionChanged,this)},t.prototype.render=function(){var e=this;return i.a.createElement("div",{className:"comment-shortcut-container"},this.state.shortcuts.map((function(t,n){return Math.abs(t.position-e.state.disablePosition)>1?i.a.createElement(ti,{count:t.count,position:t.position,key:n,onHover:e._onHover,onLeave:e._onLeave,onClick:e._onClick}):null})))},t}(i.a.Component),ri=(n(357),n(358),n(359),n(360),n(361),n(263)),ii=n.n(ri),ai=n(305),si=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),ci=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},li=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},pi=Ho.isMobile()?ai.Checkbox:ri.Checkbox,ui=Ho.isMobile()?"comment-input-box-mobile":"",di=function(e){function t(t){var n=e.call(this,t)||this;return n._focused=!1,n._editing=!1,n._committer=void 0,n._commitable=!0,n._isTouching=!1,n._onInput=function(){if(n._ref.current){var e=n._ref.current.offsetHeight;n.autosize(),Math.abs(e-n._ref.current.offsetHeight)>.5&&n.props.onHeightUpdate(),n.props.silentMode||0===n._ref.current.value.length===n.state.enableControl&&n.setState({enableControl:!n.state.enableControl})}},n._onKeydown=function(e){"Enter"===e.key?229===e.keyCode?e.preventDefault():e.ctrlKey&&(e.preventDefault(),n.commit()):"Tab"===e.key?e.preventDefault():n.props.silentMode&&"Backspace"===e.key&&!n.getValue()&&n.props.onDelete&&n._commitable&&(n._commitable=!1,n._ref.current&&n._ref.current.blur(),n.props.onDelete(!0))},n._onCancel=function(){n._ref.current&&n._ref.current.blur(),n.props.silentMode||(n.setState({enableControl:!1}),n.setEditContentState(!0)),n.clearValue(),n.props.onCancel&&n.props.onCancel()},n._onConfirm=function(){n.commit()||n._onCancel()},n._beginInput=function(){if(n.notifyEditStateChange(!0),n.setEditContentState(!1),!n._focused){n._focused=!0,n._featureService.disableScope(0),n._workbench.emit("$toggleLinkTips",!1),n.props.silentMode&&n.resetCommitter(setInterval((function(){return n.commit(!0)}),2e3)),n.props.onFocusChanged&&n.props.onFocusChanged(!0);var e=n._contextService.context.editor;setTimeout((function(){e.fire(new c.FocusBlurNotification(c.FocusBlurNotificationType.ON_BLUR))}),100)}},n._endInput=function(){if(n.notifyEditStateChange(!1),n._selection=void 0,n._focused){if(n._focused=!1,n._featureService.enableScope(0),n._workbench.emit("$toggleLinkTips",!0),n.props.silentMode){n.resetCommitter(void 0);var e=n.getValue();n.props.onCommit(e||"",n.state.syncMessage,!1)}n.props.onFocusChanged&&n.props.onFocusChanged(!1)}},n._onSelect=function(){if(n._ref.current&&Ho.isMobile()){var e=[n._ref.current.selectionStart,n._ref.current.selectionEnd];!n._selection||n._isTouching||n._selection[0]===e[0]&&n._selection[1]===e[1]||n._contextService.context.editor.fire(new Vo(ko.ToolbarShow,null)),n._selection=e}},n._onClick=function(){0},n._ref=i.a.createRef(),n._lastCommit=n.props.text||"",n.state={enableControl:!n.props.silentMode&&!!n.props.text&&n.props.text.length>0,syncMessage:!0},n.setEditContentState(!n.state.enableControl),n}return si(t,e),t.prototype.setEditContentState=function(e){this.props.onEditContentStateChanged&&this.props.onEditContentStateChanged(e)},Object.defineProperty(t.prototype,"isTouching",{get:function(){return this._isTouching},set:function(e){this._isTouching=e},enumerable:!0,configurable:!0}),t.prototype.autosize=function(){this._ref.current&&(this._ref.current.style.height="0px",this._ref.current.style.height=this._ref.current.scrollHeight+"px")},t.prototype.indent=function(e){this._ref.current&&(0===e&&this._ref.current.style.textIndent?(this._ref.current.style.textIndent="",this.autosize()):e>0&&(this._ref.current.style.textIndent=e+"px",this.autosize()))},t.prototype.clearValue=function(){this._ref.current&&(this._ref.current.value="",this._ref.current.style.height="0px")},t.prototype.getValue=function(){if(this._ref.current){var e=this._ref.current.value;if(this.props.silentMode||this.clearValue(),e.replace(/(^\s*)|(\s*$)/g,"").length>0)return e}},t.prototype.notifyEditStateChange=function(e){this._editing!==e&&(this._editing=e,this.props.onEditStateChanged&&this.props.onEditStateChanged(e))},t.prototype.focus=function(){var e=this;this._ref.current&&(this.notifyEditStateChange(!0),this.autosize(),setTimeout((function(){e._ref.current&&(e._ref.current.selectionStart=e._ref.current.value.length)})),Ho.isMobile()?this._ref.current.focus({preventScroll:!0}):setTimeout((function(){e._ref.current&&e._ref.current.focus()}),150))},t.prototype.blur=function(){this._ref.current&&this._ref.current.blur()},Object.defineProperty(t.prototype,"focused",{get:function(){return this._focused},enumerable:!0,configurable:!0}),t.prototype.componentDidMount=function(){this.props.autofocus&&this.focus()},t.prototype.componentDidUpdate=function(e,t){this.state.enableControl!==t.enableControl&&this.props.onHeightUpdate(),this.props.autofocus&&this.focus()},t.prototype.componentWillUnmount=function(){this._endInput(),this._committer||clearInterval(this._committer)},t.prototype.commit=function(e){if(void 0===e&&(e=!1),!this._commitable)return!1;this._ref.current&&!e&&this._ref.current.blur(),this.props.silentMode||(this.setState({enableControl:!1}),this.setEditContentState(!0));var t=this.getValue();return!(!t||e&&t===this._lastCommit)&&(this._lastCommit=t,this.props.onCommit(t,this.state.syncMessage,!!e),!0)},t.prototype.toggleSyncOption=function(e){this.setState({syncMessage:e})},t.prototype.resetCommitter=function(e){this._committer&&clearInterval(this._committer),this._committer=e},t.prototype.render=function(){return i.a.createElement("div",{className:"comment-input-box "+(this.props.className||"")+" "+ui},i.a.createElement("textarea",{className:"comment-textarea",ref:this._ref,maxLength:140,spellCheck:!1,onChange:this._onInput,onKeyDown:this._onKeydown,onSelect:this._onSelect,onClick:this._onClick,placeholder:this.props.placeholder||"输入批注内容",autoFocus:!1,defaultValue:this.props.text||"",onFocus:this._beginInput,onBlur:this._endInput}),this.state.enableControl?i.a.createElement("div",{className:"comment-input-control"},this.props.group&&this.props.group.length>0?i.a.createElement("div",{className:"comment-input-checkbox"},i.a.createElement(pi,{checked:this.state.syncMessage,onChange:this.toggleSyncOption.bind(this),shape:"circle"},i.a.createElement("span",{className:"comment-input-label"},"同步到群: ",this.props.group))):null,i.a.createElement("div",{className:"comment-input-seperator"}),i.a.createElement("div",{className:this.props.largeLayout?"comment-input-group-large":"comment-input-group"},i.a.createElement("div",{className:"comment-input-button",onClick:this._onCancel},"取消"),i.a.createElement("div",{className:"comment-input-button comment-input-confirm",onClick:this._onConfirm},"确定"))):null)},ci([Object(m.l)(),li("design:type",m.f)],t.prototype,"_contextService",void 0),ci([Object(m.l)(),li("design:type",m.k)],t.prototype,"_featureService",void 0),ci([Object(m.l)(),li("design:type",m.B)],t.prototype,"_workbench",void 0),t}(i.a.Component),hi=function(){function e(){}return e.forceWebviewRerender=function(){0},e.clearKeyboardPadding=function(e){void 0===e&&(e=0)},e.preventNativeContextMenuByBlur=function(){},e}(),fi=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),mi=function(e){function t(t){var n=e.call(this,t)||this;return n._commentRenderTrait={},n._longTouchFired=!1,n._onFocusChanged=function(e){e||(Ho.isMobile()&&n.props.manager.editor.fire(new Vo(ko.ToolbarShow,null),!1),n.props.onExitEdit(n.props.commentContent.commentId))},n._onConfirm=function(e,t,o){n.props.onConfirm(e,t,n.props.commentContent.commentId,o)},n._onMouseDown=function(){if(!Ho.isMobile()&&n._ref.current){var e=n._ref.current.getBoundingClientRect();n.props.manager.editor.fire(new Vo(ko.ToolbarShow,{x:e.right,y:e.top,comment:n.props.commentContent,onDelete:n._onDelete,onAppend:n.props.onAppend,style:{transform:"translate(-100%, -100%)"}}),!1)}},n._onMouseLeave=function(){Ho.isMobile()||n.props.manager.editor.fire(new Vo(ko.ToolbarShow,null),!1)},n._onContextMenuBegin=function(){Ho.isMobile()&&(n._input.current&&(n._input.current.isTouching=!0),n._longTouch=setTimeout((function(){hi.preventNativeContextMenuByBlur(),n._longTouch=void 0,n._longTouchFired=!0,n.onContextMenu()}),200))},n._onContextMenuCancel=function(){Ho.isMobile()&&(n._input.current&&(n._input.current.isTouching=!1),void 0!==n._longTouch&&(clearTimeout(n._longTouch),n._longTouch=void 0),n._longTouchFired?n._longTouchFired=!1:n.props.manager.editor.fire(new Vo(ko.ToolbarShow,null)))},n._onDelete=function(){n.props.onDelete(n.props.commentContent.commentId)},n._input=i.a.createRef(),n._author=i.a.createRef(),n._ref=i.a.createRef(),n}return fi(t,e),t.prototype.onRenderFinish=function(){this._input.current&&(this._author.current?this._input.current.indent(this._author.current.getBoundingClientRect().width/this.props.manager.editor.zoom):this._input.current.indent(0)),this._commentRenderTrait={id:this.props.commentContent.commentId,type:this.props.commentContent.commentItemType,text:this.props.commentContent.content,disabled:this.props.commentContent.disabled}},t.prototype.componentDidMount=function(){this.onRenderFinish()},t.prototype.componentDidUpdate=function(){this.onRenderFinish()},t.prototype.onContextMenu=function(){var e=this;if(this._ref.current){this.props.onForceParentClick();var t=this._ref.current.getBoundingClientRect();this.props.manager.editor.fire(new Vo(ko.ToolbarShow,{x:(t.left+t.right)/2,y:t.top,comment:this.props.commentContent,onDelete:function(){e._input.current&&e._input.current.focused&&e._input.current.blur(),hi.clearKeyboardPadding(),e._onDelete()},onAppend:this.props.onAppend,style:{transform:"translate(-50%, -100%)"}}),!1)}},t.prototype.shouldComponentUpdate=function(e){return(!this._input.current||!this._input.current.focused)&&(e.active!==this.props.active||e.commentContent.commentId!==this._commentRenderTrait.id||e.commentContent.commentItemType!==this._commentRenderTrait.type||e.commentContent.content!==this._commentRenderTrait.text||e.commentContent.disabled!==this._commentRenderTrait.disabled)},t.prototype.render=function(){var e=this,t=this.props.commentContent,n=Ho.getPermissionOnCommentOfAuthor(t.authorId)>=Do.b.Editable,o=t.content&&t.content.startsWith(Do.d.EmptyPlaceholder)?"":t.content;return i.a.createElement("div",{id:"comment-id-"+t.commentId,className:"comment-embed-item-wrapper "+(Ho.isMobile()?"comment-embed-item-wrapper-mobile":""),onMouseDown:this._onMouseDown,onMouseLeave:this._onMouseLeave,ref:this._ref},i.a.createElement("div",{className:"comment-embed-item",onTouchStart:this._onContextMenuBegin,onTouchMove:this._onContextMenuCancel,onTouchEnd:this._onContextMenuCancel},n?i.a.createElement("div",{className:"comment-content-box"},i.a.createElement("div",{className:"comment-author-info-box"},i.a.createElement("span",{ref:this._author,className:"author-name"},t.name||Ho.getUserName(),":")),i.a.createElement(di,{ref:this._input,className:"comment-embed-input-box",text:o,autofocus:t.commentItemType===Do.c.Append||t.commentItemType===Do.c.New,group:this.props.group,silentMode:!0,onCommit:this._onConfirm,onDelete:this._onDelete,onHeightUpdate:this.props.onHeightUpdate,largeLayout:!0,onFocusChanged:this._onFocusChanged,onEditStateChanged:function(n){return e.props.onEditStateChanged(n,t.commentId)}})):i.a.createElement("div",{className:"comment-content-box",onClick:function(){}},i.a.createElement(kr,{className:"comment-embed-text",text:o},i.a.createElement("span",{className:"author-name"},t.name,":")))))},t}(i.a.Component),gi=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),yi=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._autoCommitted=!1,t._onExitEdit=function(e){!e&&t._appendingCommentId&&(t._appendingCommentId=void 0,t.props.onEndAppend())},t._onClick=function(e){e&&(e.preventDefault(),e.stopPropagation()),t.props.manager.activator.activate(t.props.anchor.anchorId,!0,!0),setTimeout((function(){t.props.manager.editor.fire(new c.FocusBlurNotification(c.FocusBlurNotificationType.ON_BLUR),!1)}),100)},t._onClickItem=function(){t.props.manager.activator.activate(t.props.anchor.anchorId,!0,!0),setTimeout((function(){t.props.manager.editor.fire(new c.FocusBlurNotification(c.FocusBlurNotificationType.ON_BLUR),!1)}),100)},t._onConfirm=function(e,n,o,r){(o||t._appendingCommentId)&&t.props.onConfirm(e,n,o||t._appendingCommentId,r)},t._onDelete=function(e){var n=e||t._appendingCommentId;n&&Ho.confirmDelete((function(){t.props.onDelete(n),t._onExitEdit(e)}))},t._onEditStateChanged=function(e,n){t.props.manager.editInfo=e?{anchorId:t.props.anchor.anchorId,commentId:n}:void 0},t}return gi(t,e),t.prototype.resetAllCommentType=function(e){this.props.anchor.commentList.forEach((function(t){var n=t;t.commentItemType!==Do.c.Append&&t.commentId!==e&&(n.commentItemType=Do.c.Normal)}))},t.prototype.onAppend=function(){this.props.active||this.props.manager.activator.activate(this.props.anchor.anchorId,!0,!0),this.props.onAppend()},t.prototype.componentDidUpdate=function(){0!==this.props.anchor.commentCount||this._autoCommitted||(this._autoCommitted=!0,this.props.onAppend())},t.prototype.render=function(){var e=this,t=this.props.active;t||this.resetAllCommentType();var n,o=this.props.manager.isOnline,r=!this.props.appendingPlaceholder&&this.props.anchor.commentCount>0,a=qo.getVisualComments(this.props.anchor,t,o,{disableSpecial:r});this.props.appendingPlaceholder&&(this._appendingCommentId?(n=a.findIndex((function(t){return t.commentId===e._appendingCommentId})))>-1&&a.splice(n,1):(n=a.findIndex((function(t){return t.content===e.props.appendingPlaceholder})))>-1&&(this._appendingCommentId=a.splice(n,1)[0].commentId));return i.a.createElement("div",{className:"comment-embed-group "+(t?"comment-embed-group-active":""),onClick:this._onClick},a.map((function(n){return i.a.createElement(mi,{key:n.commentId||"new",manager:e.props.manager,onHeightUpdate:e.props.onHeightUpdate,onAppend:e.onAppend.bind(e),onConfirm:e._onConfirm,onDelete:e._onDelete,onExitEdit:e._onExitEdit,commentContent:n,active:t&&o,onForceParentClick:e._onClickItem,onEditStateChanged:e._onEditStateChanged})})))},t}(i.a.Component),vi=function(){function e(){}return e.onCommentError=function(e,t){10010===e?Ho.showErrorTips("文档权限发生变化，批注"+t+"失败。"):Ho.showErrorTips("批注"+t+"失败，请检查网络或稍后再试。")},e.confirm=function(e,t,n,o,r,i){var a=this;if(r){var s=e.getContent(t,r);return s&&(s.originContent=s.content,s.content=n),new Promise((function(o){e.requestEditComment(t,r,n,(function(e){0===e?o(!0):i||(a.onCommentError(e,"编辑"),s&&(s.content=s.originContent),o(!1))})),c.ReportHelper.tdwReport({opername:"doc_cooper",module:"word_comment",action:"edit_com",ver5:e.manager.view.isEmbed?"in":"out"})}))}return new Promise((function(r){e.requestAddComment(t,n,o,(function(n){0===n?(r(!0),t===e.manager.newAnchorId&&e.manager.confirmAdd()):(r(!1),a.onCommentError(n,"添加"))})),c.ReportHelper.tdwReport({opername:"doc_cooper",module:"word_comment",action:t===e.manager.newAnchorId?"send_com":"append_com",ver5:e.manager.view.isEmbed?"in":"out"})}))},e.delete=function(e,t,n){var o=this,r=e.get(t);if(!r)return Promise.resolve(!1);var i=r.commentCount;return new Promise(n?function(r){e.requestDeleteComment(t,n,(function(n){0===n?(1===i&&e.manager.deleteComment(t),r(!0)):(r(!1),o.onCommentError(n,"删除"))})),c.ReportHelper.tdwReport({opername:"doc_cooper",module:"word_comment",action:"del_com",ver5:e.manager.view.isEmbed?"in":"out",ver6:"single"})}:function(n){e.requestClearCommentAnchor(t,(function(r){0===r?(e.manager.deleteComment(t),n(!0)):(n(!1),o.onCommentError(r,"删除"))})),c.ReportHelper.tdwReport({opername:"doc_cooper",module:"word_comment",action:"del_com",ver5:e.manager.view.isEmbed?"in":"out",ver6:"group"})})},e}(),bi=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Ci=function(){return(Ci=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},_i=function(e){function t(t){var n=e.call(this,t)||this;return n._appendingAnchorId="",n._appendingPlaceholder="",n._deltaHeight=0,n._destroyed=!1,n._onRenderUpdate=function(){n.props.renderer.onUpdate(n.props.data)},n._onEndAppend=function(){n._appendingAnchorId="",n._appendingPlaceholder="",n.forceUpdate()},n._ref=i.a.createRef(),n.state=Ci(Ci({},Xo.INVISIBLE_POSITION_2D),{maxHeight:0}),n.props.renderer.add(n.props.data,n),n}return bi(t,e),Object.defineProperty(t.prototype,"root",{get:function(){return this._ref.current?this._ref.current:void 0},enumerable:!0,configurable:!0}),t.prototype.recordDeltaHeight=function(e){this._deltaHeight=e},t.prototype.consumeDeltaHeight=function(){var e=this._deltaHeight;return this._deltaHeight=0,e},t.prototype.updateLayout=function(e,t,n){(Math.abs(e-this.state.x)>.5||Math.abs(t-this.state.y)>.5||Math.abs((n||0)-this.state.maxHeight)>.5)&&this.setState({x:e,y:t,maxHeight:n||0})},t.prototype.preventContextMenu=function(){this._ref.current&&(this._ref.current.oncontextmenu=null,this._ref.current.addEventListener("contextmenu",(function(e){e.preventDefault(),e.stopPropagation()})))},t.prototype.componentDidMount=function(){this._onRenderUpdate(),this.preventContextMenu()},t.prototype.componentDidUpdate=function(){this._onRenderUpdate(),this.preventContextMenu()},t.prototype.componentWillUnmount=function(){this.props.renderer.remove(this.props.data,this),this._destroyed=!0},t.prototype.confirm=function(e,t,n,o,r){var i=this;vi.confirm(this.props.manager.data,e.anchorId,t,n,o,r).then((function(){r||i._destroyed||i.forceUpdate()}))},t.prototype.delete=function(e,t){var n=this,o=this.props.manager.data;vi.delete(o,e.anchorId,t).then((function(r){if(!r){var i=o.getContent(e.anchorId,t);i&&(i.disabled=!0,n.forceUpdate())}}));var r=o.getContent(e.anchorId,t);r&&(r.disabled=!0,this.forceUpdate())},t.prototype.append=function(e){this._appendingAnchorId=e.anchorId,this._appendingPlaceholder=""+Do.d.EmptyPlaceholder+g.StringUtil.generateRandomId(),this.forceUpdate(),this.confirm(e,this._appendingPlaceholder,!1)},Object.defineProperty(t.prototype,"visible",{get:function(){return this.state.y>Xo.INVISIBLE_POSITION},enumerable:!0,configurable:!0}),t.prototype.render=function(){var e=this,t=this.props.data.split(c.CommentSpanPropKey.commentsConnection),n=this.props.manager.newAnchorId,o=this.props.manager.data.getCommentAnchors(t);if(0===o.length)return null;var r={left:this.state.x+"px",top:this.state.y+"px"};return this.state.maxHeight>0&&(r.maxHeight=this.state.maxHeight+"px",r.overflowY="auto"),i.a.createElement("div",{ref:this._ref,className:"comment-section",style:r},o.map((function(t){return i.a.createElement(yi,{key:t.anchorId,manager:e.props.manager,anchor:t,active:t.anchorId===e.props.activeAnchorId||t.anchorId===n,appendingPlaceholder:e._appendingAnchorId===t.anchorId?e._appendingPlaceholder:"",onHeightUpdate:e._onRenderUpdate,onAppend:function(){return e.append(t)},onEndAppend:e._onEndAppend,onConfirm:function(n,o,r,i){return e.confirm(t,n,o,r,i)},onDelete:function(n){return e.delete(t,n)}})})))},t}(i.a.Component),wi=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Ri=function(){return(Ri=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function Si(e){var t=e.view.getPadding(),n=e.service.getDocument().getRange(0,0).getSectionFormat(),o=Object(g.twipsToPx)(n.getMarginLeft())+(t.left||0)+1,r=Object(g.twipsToPx)(n.getPageWidth()-n.getMarginLeft()-n.getMarginRight());return{left:o,width:Math.max(0,r-2)}}var Ei=function(e){function t(t){var n=e.call(this,t)||this;return n.state=Ri(Ri({},n.getLayout()||{left:0,width:0}),{sections:n.getSections(),activeAnchorId:"",rendering:!1}),n._renderer=n.props.manager.view.getView(Do.f.Embed),n}return wi(t,e),t.prototype.getLayout=function(){return Si(this.props.manager.editor)},t.prototype.onLayoutChange=function(){var e=this.getLayout();e&&(Math.abs(e.left-this.state.left)>.5||Math.abs(e.width-this.state.width)>.5)&&this.setState(e)},t.prototype.getSections=function(){return this.props.manager.engine.placeholderInfos.map((function(e){return e.data}))},t.prototype.syncData=function(){var e=this.props.manager.newAnchorId||this.state.activeAnchorId;this.setState({sections:this.getSections(),activeAnchorId:e})},t.prototype.toggle=function(e){e?this.setState({sections:this.getSections(),rendering:!0}):this.setState({rendering:!1})},t.prototype.componentDidUpdate=function(){this._renderer.containerUpdateCallback()},t.prototype.activate=function(e){this.setState({activeAnchorId:e})},t.prototype.render=function(){var e=this;return this.state.rendering?i.a.createElement("div",{className:"comment-embed-container",style:{width:this.state.width+"px",left:this.state.left+"px"}},this.state.sections.map((function(t){return i.a.createElement(_i,{key:t,manager:e.props.manager,renderer:e._renderer,data:t,activeAnchorId:e.state.activeAnchorId})}))):null},t}(i.a.Component),Ti=(n(370),function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}()),Pi=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ti(t,e),t.prototype.handleClick=function(e){e.handler()},t.prototype.render=function(){var e=this,t=this.props.comment?Ho.getPermissionOnCommentOfAuthor(this.props.comment.authorId):Do.b.None,n=this.props.items.filter((function(e){return(!e.permission||e.permission<=t)&&!e.disable}));return n.length>0?i.a.createElement("div",{className:this.props.className},n.map((function(t,n){return i.a.createElement("div",{key:n,className:"comment-toolbar-item",onClick:function(){return e.handleClick(t)}},t.name)}))):null},t}(i.a.Component),Ii=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),xi=function(){return(xi=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},Oi=function(){},Li=function(e){function t(t){var n=e.call(this,t)||this;return n._callbackRegistered=!1,n._onShow=function(e){if(e.data){var t=e.data;if(n._ref.current){n.clearReset();var o=n._ref.current.parentElement.getBoundingClientRect(),r=n.props.manager.editor.zoom;n.setState({x:(t.x-o.left)/r,y:(t.y-o.top)/r,comment:t.comment,onDelete:t.onDelete,onAppend:t.onAppend,style:t.style})}}else n.asyncReset()},n._onScroll=Object(g.throttle)((function(){n.isShow&&n.reset()}),100),n._onSelectionChange=function(e){e.option&&e.option.mobileContextMenu===c.MobileContextMenuType.Keep||n.reset()},n._onMouseEnter=n.clearReset.bind(n),n._onMouseLeave=n.asyncReset.bind(n),n._onSwitch=function(){n.run((function(){n.state.comment&&n.state.comment.anchorId&&n.props.manager.activator.activeAnchorId!==n.state.comment.anchorId&&n.props.manager.activator.activate(n.state.comment.anchorId),n.props.manager.switch(Do.f.External)}))},n.state={x:Xo.INVISIBLE_POSITION,y:Xo.INVISIBLE_POSITION,onDelete:Oi,onAppend:Oi},n._ref=i.a.createRef(),n.props.manager.editor.on(ko.ToolbarShow,n._onShow,n),n}return Ii(t,e),t.prototype.componentWillUnmount=function(){var e=this.props.manager.editor;e.removeListener(ko.ToolbarShow,this),Ho.isMobile()&&(e.removeListener(c.RenderNotificationTypes.SELECTION_CHANGE,this),e.scrollHandler.removeScrollListener(this._onScroll))},t.prototype.componentDidUpdate=function(){var e=this;if(Ho.isMobile()){var t=this.props.manager.editor,n=t.scrollHandler;this.isShow?this._callbackRegistered||(setTimeout((function(){e.isShow&&n.addScrollListener(e._onScroll)}),300),t.on(c.RenderNotificationTypes.SELECTION_CHANGE,this._onSelectionChange,this),this._callbackRegistered=!0):(this._callbackRegistered=!1,t.removeListener(c.RenderNotificationTypes.SELECTION_CHANGE,this),n.removeScrollListener(this._onScroll))}},Object.defineProperty(t.prototype,"isShow",{get:function(){return this.state.x!==Xo.INVISIBLE_POSITION},enumerable:!0,configurable:!0}),t.prototype.reset=function(){this._resetTimeout=void 0,this.setState({x:Xo.INVISIBLE_POSITION,y:Xo.INVISIBLE_POSITION,onDelete:Oi,onAppend:Oi})},t.prototype.asyncReset=function(){var e=this;this._resetTimeout||(this._resetTimeout=setTimeout((function(){e.reset()}),100))},t.prototype.clearReset=function(){this._resetTimeout&&(clearTimeout(this._resetTimeout),this._resetTimeout=void 0)},t.prototype.run=function(e){e(),this.reset()},t.prototype.render=function(){var e=Ho.isMobile()?"comment-embed-item-toolbar-mobile":"comment-embed-item-toolbar",t=this.state.y>Xo.INVISIBLE_POSITION,n=this.state.comment;return i.a.createElement("div",{className:"comment-embed-item-toolbar-container",ref:this._ref,style:xi({opacity:t?1:0,left:this.state.x,top:this.state.y},this.state.style),onMouseEnter:this._onMouseEnter,onMouseLeave:this._onMouseLeave},i.a.createElement(Pi,{className:e,comment:this.state.comment,items:[{name:"删除",permission:Do.b.Deletable,disable:!n||!n.commentId,handler:this.run.bind(this,this.state.onDelete)},{name:"追加批注",permission:Do.b.Appendable,disable:!n||n.commentItemType===Do.c.Append||n.commentItemType===Do.c.New,handler:this.run.bind(this,this.state.onAppend)},{name:Ho.isMobile()?"浮层展示":"侧边展示",handler:this._onSwitch,disable:!this.props.manager.isOnline}]}))},t}(i.a.Component),Mi=function(){function e(e){this._manager=e}return e.prototype.onNetworkChange=function(){this._manager.view.forceUpdate()},e.prototype.getConfig=function(){return{main:[i.a.createElement(Ei,{key:"comment-embed-container",ref:this._manager.view.getView(Do.f.Embed).renderRef,manager:this._manager})],right:[i.a.createElement(oi,{key:"comment-shortcut",manager:this._manager}),i.a.createElement(Li,{key:"comment-embed-toolbar",manager:this._manager})]}},e}(),Ni=(n(363),function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}()),Ai=function(e){function t(t){var n=e.call(this,t)||this;n._editorFocused=!1,n._onChange=function(){if((n._editorFocused||!n.props.manager.editor.selection.isCollapse())&&n.props.manager.handler.canAddComment()){var e=Xo.getPositionFromSelection({alignToTableCell:!0});void 0!==e&&n.updatePosition(e.y)}else n.updatePosition(Xo.INVISIBLE_POSITION)},n._onFocus=function(){n._editorFocused=!0,n._onChange()},n._onBlur=function(){n._editorFocused=!1,n._onChange()},n._onClick=function(){n.props.manager.handler.addComment(),c.ReportHelper.tdwReport({opername:"doc_cooper",module:"word_comment",action:"call_oper",ver5:n.props.manager.view.isEmbed?"in":"out",ver6:"float"})},n.state={position:Xo.INVISIBLE_POSITION};var o=n.props.manager.editor;return o.on(c.FocusBlurNotificationType.ON_FOCUS,n._onFocus,n),o.on(c.FocusBlurNotificationType.ON_BLUR,n._onBlur,n),o.on(c.RenderNotificationTypes.SELECTION_END,n._onChange,n),n}return Ni(t,e),t.prototype.componentWillUnmount=function(){var e=this.props.manager.editor;e.removeListener(c.FocusBlurNotificationType.ON_FOCUS,this),e.removeListener(c.FocusBlurNotificationType.ON_BLUR,this),e.removeListener(c.RenderNotificationTypes.SELECTION_END,this)},t.prototype.updatePosition=function(e){Math.abs(e-this.state.position)>.5&&(this.setState({position:e}),this.props.manager.editor.fire(new Vo(ko.ShortcutPositionChanged,e)))},t.prototype.onNetworkChange=function(){this._onChange()},t.prototype.render=function(){return this.props.manager.isMultiEditorMode?null:i.a.createElement("div",{className:"comment-add-shortcut-wrapper",style:{top:this.state.position},onClick:this._onClick},i.a.createElement("div",{className:"comment-add-shortcut"}))},t}(i.a.Component),Di=(n(364),function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}()),ki=function(e){function t(t){var n=e.call(this,t)||this;n._onScroll=function(){var e=n.props.manager.editor,t=e.scrollHandler.getScrollTop()/e.zoom;Math.abs(t-n.state.position)>.5&&n.setState({position:t})},n._onVisibilityChanged=function(e){n.setState({visible:e.data})},n._onModeChanged=function(e){n.setState({mode:e.data})},n._onCount=function(){var e=0,t=n.props.manager.data.countMap;t&&t.forEach((function(t){return e+=t})),e!==n.state.count&&n.setState({count:e})},n._onSwitch=function(){n.props.manager.switch(Do.f.Embed)},n._onClose=function(){n.props.manager.view.hide()},n.state={count:0,visible:!n.props.manager.view.isHidden,mode:n.props.manager.view.mode,position:0},n._root=i.a.createRef();var o=n.props.manager.editor;return o.on(ko.VisibilityChanged,n._onVisibilityChanged,n),o.on(ko.Count,n._onCount,n),o.on(ko.ModeChanged,n._onModeChanged,n),o.scrollHandler.addScrollListener(n._onScroll),n}return Di(t,e),t.prototype.componentWillUnmount=function(){var e=this.props.manager.editor;e.removeListener(ko.VisibilityChanged,this),e.removeListener(ko.Count,this),e.removeListener(ko.ModeChanged,this),e.scrollHandler.removeScrollListener(this._onScroll)},t.prototype.render=function(){var e=this.state.visible&&this.state.mode===Do.f.External&&this.state.count>0?1:0;return i.a.createElement("div",{ref:this._root,className:"comment-menu",style:{transform:"scale("+e+")",top:this.state.position}},i.a.createElement("div",{className:"comment-menu-counter"},"批注数("+this.state.count+")"),i.a.createElement("div",{className:"comment-menu-seperator"}),i.a.createElement(We.Tooltip,{title:"将批注嵌入正文中展示",trigger:"hover",offset:-20},i.a.createElement("div",{className:this.props.manager.isOnline?"comment-menu-switch":"comment-menu-switch-disabled",onClick:this._onSwitch},"嵌入正文")),i.a.createElement("div",{className:"comment-menu-close",onClick:this._onClose}))},t}(i.a.Component),ji=(n(365),n(366),n(367),n(306)),Fi=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Hi=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._commentRenderTrait={},t._onConfirm=function(e,n){t.props.commentContent.commentItemType===Do.c.Edit&&(t.props.commentContent.commentItemType=Do.c.Normal),t.props.onConfirm(e,n,t.props.commentContent.commentId)},t._onCancel=function(){t.props.commentContent.commentItemType===Do.c.Edit&&(t.props.commentContent.commentItemType=Do.c.Normal),t.props.onCancel(t.props.commentContent.commentItemType===Do.c.New)},t._handleEdit=function(){t.props.commentContent.commentItemType=Do.c.Edit,t.props.onEnterEdit(t.props.commentContent.commentId)},t}return Fi(t,e),t.prototype.onRenderFinish=function(){this._commentRenderTrait={id:this.props.commentContent.commentId,type:this.props.commentContent.commentItemType,text:this.props.commentContent.content,isFold:this.props.commentContent.isFoldComment,count:this.props.commentContent.foldCount,disabled:this.props.commentContent.disabled}},t.prototype.componentDidMount=function(){this.onRenderFinish()},t.prototype.componentDidUpdate=function(){this.onRenderFinish()},t.prototype.shouldComponentUpdate=function(e){return e.active!==this.props.active||e.commentContent.commentId!==this._commentRenderTrait.id||e.commentContent.commentItemType!==this._commentRenderTrait.type||e.commentContent.content!==this._commentRenderTrait.text||e.commentContent.isFoldComment!==this._commentRenderTrait.isFold||e.commentContent.foldCount!==this._commentRenderTrait.count||e.commentContent.disabled!==this._commentRenderTrait.disabled},t.formatDate=function(e){if(Number.isNaN(e))return"";var t="yy-MM-dd hh:mm",n=new Date(e);return n.getFullYear()===(new Date).getFullYear()&&(t="MM-dd hh:mm"),Object(ji.a)(n,t)},t.prototype.render=function(){var e=this,n=this.props.commentContent,o=void 0!==n.commentItemType&&n.commentItemType!==Do.c.Normal,r=n.commentItemType===Do.c.Edit||n.commentItemType===Do.c.New,a=n.content&&n.content.startsWith(Do.d.EmptyPlaceholder)?"":n.content,s="comment-content-wrapper";return this.props.active&&!n.disabled&&(s+=" comment-content-wrapper-active"),o&&(s+=" comment-content-wrapper-editing"),n.disabled&&(s+=" comment-content-wrapper-disabled"),n.isFoldComment?i.a.createElement("div",{className:"comment-content-wrapper",style:{paddingTop:"10px"}},i.a.createElement("div",{className:"comment-content-box",style:{paddingBottom:"10px"}},i.a.createElement("div",{className:"fold-content"},"已折叠",n.foldCount,"条批注"))):i.a.createElement("div",{id:"comment-id-"+n.commentId,className:""+s},i.a.createElement("div",{className:"comment-content-box"},n.commentItemType!==Do.c.Append?i.a.createElement("div",{className:"content-header"},i.a.createElement("div",{className:"profile"},i.a.createElement("div",{className:"avatar"},i.a.createElement("img",{src:n.avatar})),i.a.createElement("div",{className:"author-name"},n.name)),o?null:i.a.createElement("div",{className:"comment-external-item-toolbar-container"},i.a.createElement("span",{className:"comment-external-item-toolbar-padding"}),i.a.createElement("div",{className:"publish-time"},t.formatDate(1e3*Number(n.publishTime))),this.props.active?i.a.createElement(Pi,{className:"comment-external-item-toolbar",comment:this.props.commentContent,items:[{name:"编辑",permission:Do.b.Editable,handler:this._handleEdit},{name:"删除",permission:Do.b.Deletable,handler:function(){return Ho.confirmDelete((function(){return e.props.onDelete(e.props.commentContent.commentId)}))}}]}):null)):i.a.createElement("div",{className:"add-header"},"追加批注"),o?i.a.createElement(di,{text:a,className:"comment-external-input-box",autofocus:r,placeholder:n.commentItemType===Do.c.Append?"点击添加批注":void 0,group:this.props.group,onCommit:this._onConfirm,onCancel:this._onCancel,onHeightUpdate:this.props.onHeightUpdate,onEditStateChanged:function(t){return e.props.onEditStateChanged(t,n.commentId)},onEditContentStateChanged:this.props.onEditContentStateChanged}):i.a.createElement(kr,{text:a,maxLine:this.props.active?0:3})))},t}(i.a.Component),Bi=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();function Ui(e){e.preventDefault(),e.stopPropagation()}var Vi=function(e){function t(t){var n=e.call(this,t)||this;return n._contentSaved=!0,n.onClick=function(e){if(e.preventDefault(),e.stopPropagation(),!n.props.active){var t=n.props,o=t.anchor,r=t.data;n.props.onClick(),o.commentCount!==o.commentList.length-1&&r.requestPullCommentContents(o.anchorId)}},n._onEditStateChanged=function(e,t){n.props.data.manager.editInfo=e?{anchorId:n.props.anchor.anchorId,commentId:t}:void 0},n._onEditContentStateChanged=function(e){n._contentSaved=e},n.state={hover:!1},n._ref=i.a.createRef(),n}return Bi(t,e),t.prototype.preventContextMenu=function(){this._ref.current&&(this._ref.current.removeEventListener("contextmenu",Ui),this._ref.current.addEventListener("contextmenu",Ui))},t.prototype.componentDidMount=function(){this.props.onRef(this.props.anchor.anchorId,this),this.preventContextMenu()},t.prototype.componentDidUpdate=function(){this.props.onRef(this.props.anchor.anchorId,this),this.preventContextMenu()},t.prototype.componentWillUnmount=function(){this.props.onDeref(this.props.anchor.anchorId)},t.prototype.clearCache=function(){this._cacheContent=void 0},t.prototype.onDeleteAll=function(){var e=this;W.a.confirm({title:"删除批注",content:"删除后无法撤销，确定删除此内容下的所有批注吗？",onOk:function(){vi.delete(e.props.data,e.props.anchor.anchorId)},onCancel:function(){}})},t.prototype.onConfirm=function(e,t,n){var o=this,r=this.props.anchor.anchorId;vi.confirm(this.props.data,r,e,t,n).then((function(e){(!e||o.props.anchor.commentCount>0)&&(o._cacheContent=void 0),o.forceUpdate(),o.props.data.manager.view.isHidden&&o.props.data.manager.view.show(o.props.anchor.anchorId)})),n||(this._cacheContent={avatar:Ho.getUserAvatar(),name:Ho.getUserName(),content:e,commentId:g.StringUtil.generateRandomId(),disabled:!0}),this.forceUpdate()},t.prototype.onDelete=function(e){var t=this;if(vi.delete(this.props.data,this.props.anchor.anchorId,e).then((function(n){if(!n){var o=t.props.data.getContent(t.props.anchor.anchorId,e);o&&(o.disabled=!1,t.forceUpdate())}})),e){var n=this.props.data.getContent(this.props.anchor.anchorId,e);n&&(n.disabled=!0,this.forceUpdate())}},t.prototype.resetAllCommentType=function(e){this.props.anchor.commentList.forEach((function(t){var n=t;t.commentItemType!==Do.c.Append&&t.commentId!==e&&(n.commentItemType=Do.c.Normal)}))},t.prototype.onCancel=function(e){e&&this.props.data.manager.cancelAdd(),this.forceUpdate(),c.ReportHelper.tdwReport({opername:"doc_cooper",module:"word_comment",action:"cancel_com"})},t.prototype.onEnterEdit=function(e){this.resetAllCommentType(e),this.forceUpdate()},t.prototype.shouldComponentUpdate=function(){return this._contentSaved},t.prototype.render=function(){var e=this;if(void 0===this.props.position||this.props.data.isFullyDelete(this.props.anchor.anchorId))return null;var t=this.props.active;t||this.resetAllCommentType();var n=this.props.data.manager.isOnline,o=qo.getVisualComments(this.props.anchor,t,n,{cacheContent:this._cacheContent,capcacity:3}),r=1===o.length&&o[0].commentItemType===Do.c.New;return i.a.createElement("div",{id:"comment-external-group-anchor-id-"+this.props.anchor.anchorId,className:"comment-external-group-wrapper "+(t?"comment-external-group-wrapper-active":""),style:{top:this.props.position},onClick:this.onClick.bind(this),ref:this._ref},i.a.createElement("div",{className:"comment-external-group "+(t||this.state.hover?"comment-external-group-active":"")},Ho.isDocCreator()&&t&&n&&!r?i.a.createElement("div",{className:"comment-external-group-delete-container"},i.a.createElement("div",{className:"comment-external-group-delete-box",onClick:this.onDeleteAll.bind(this)},i.a.createElement("div",{className:"comment-external-group-delete-img"}),i.a.createElement("div",{className:"comment-external-group-delete"},"删除该组批注"))):"",o.map((function(o){return i.a.createElement(Hi,{key:o.commentId||"new",commentContent:o,active:t&&n,group:e.props.data.groupName,onConfirm:e.onConfirm.bind(e),onCancel:e.onCancel.bind(e),onEnterEdit:e.onEnterEdit.bind(e),onDelete:e.onDelete.bind(e),onHeightUpdate:e.props.onHeightUpdate,onEditStateChanged:e._onEditStateChanged,onEditContentStateChanged:e._onEditContentStateChanged})}))),t?i.a.createElement("div",{className:"comment-external-group-triangle"}):"")},t}(i.a.Component),Wi=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Gi=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)a.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return a},zi=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(Gi(arguments[t]));return e},Ki=function(e){function t(t){var n=e.call(this,t)||this;n._groupRenders=new Map,n._partialTimeout=null,n._positionRefs=new Map,n._onPositionCollected=function(e){var t=new Map;e.data.size>0&&e.data.forEach((function(e,n){e.forEach((function(e,o){t.set(e,{expectedPosition:n,index:o})}))})),n._positionRefs=t,n.props.manager.newAnchorId||n.setState({anchorParams:n.sort(n.state.anchorParams.map((function(e){return e.anchor})))})},n._onGroupRef=function(e,t){n._groupRenders.set(e,t)},n._onGroupDeref=function(e){n._groupRenders.delete(e)},n._onGroupClick=function(e){n.state.partial&&(n.partial([],!1),n.props.manager.view.show()),n.props.manager.activator.activate(e)},n._onMouseEnter=function(){n.state.partial&&n.clearPartialTimeout()},n._onMouseLeave=function(){n.state.partial&&!n.state.activeAnchorId&&n.partial([],!0)},n._onHeightUpdate=n.updateRenderPosition.bind(n);var o=n.props.manager.data.anchors;return n._positionRefAnchorId=o.length>0?o[0].anchorId:"",n.state={partial:!0,activeAnchorId:"",anchorParams:[],basePosition:0,positions:[]},n.props.manager.editor.on(ko.PositionCollected,n._onPositionCollected,n),n}return Wi(t,e),t.prototype.componentWillUnmount=function(){this.props.manager.editor.removeListener(ko.PositionCollected,this)},t.prototype.componentDidMount=function(){this.updateRenderPosition()},t.prototype.componentDidUpdate=function(){this.updateRenderPosition()},t.prototype.activate=function(e){e&&(this._positionRefAnchorId=e),this.setState({activeAnchorId:e})},t.prototype.clearCache=function(){this._groupRenders.forEach((function(e){e.clearCache()}))},t.prototype.syncData=function(){var e,t=this.props.manager,n=t.newAnchorId,o=t.data;e=this.state.partial?n?[o.get(n)]:[]:n&&!o.has(n)?zi(o.anchors,[o.get(n)]):o.anchors;var r=n||this.state.activeAnchorId;r&&(this._positionRefAnchorId=r),this.setState({anchorParams:this.sort(e),activeAnchorId:r})},t.prototype.clearHoverState=function(){this.hover(this.state.anchorParams.map((function(e){return e.anchor.anchorId})),!1)},t.prototype.togglePartial=function(e){this.clearHoverState();var t=e?[]:this.props.manager.data.anchors;this.setState({partial:e,anchorParams:this.sort(t)})},t.prototype.clearPartialTimeout=function(){null!==this._partialTimeout&&(clearTimeout(this._partialTimeout),this._partialTimeout=null)},t.prototype.partial=function(e,t){var n=this;if(void 0===t&&(t=!0),e.length>0||!t){this.clearPartialTimeout(),this.clearHoverState();var o=this.props.manager.data.getCommentAnchors(e);this.setState({anchorParams:this.sort(o)}),this.hover(e,!0)}else this._partialTimeout=setTimeout((function(){n.clearPartialTimeout(),n.clearHoverState(),n.state.partial&&n.setState({anchorParams:[]})}),200)},t.prototype.sort=function(e){var t=this;return e.map((function(e){if(e.anchorId===t.props.manager.newAnchorId){var n=(Xo.getPositionFromSelection({alignToTableCell:!0})||{y:void 0}).y;return{anchor:e,ref:void 0!==n?{expectedPosition:n,index:-1}:void 0}}return{anchor:e,ref:t._positionRefs.get(e.anchorId)}})).sort((function(e,t){return e.ref?t.ref?e.ref.expectedPosition-t.ref.expectedPosition||e.ref.index-t.ref.index:1:t.ref?-1:0}))},t.prototype.getVisibleRange=function(){for(var e=this.state.anchorParams,t=0;t<e.length&&void 0===e[t].ref;)t+=1;if(t<e.length){for(var n=e.length-1;n>=t&&void 0===e[n].ref;)n-=1;if(n>=t){for(var o=t;o<=n;++o)if(void 0===e[o].ref)return[-1,-1];return[t,n+1]}}return[-1,-1]},t.prototype.getDomHeight=function(e){if(e===this.props.manager.newAnchorId)return 250;var t=document.getElementById("comment-external-group-anchor-id-"+e);return t?t.offsetHeight:void 0},t.prototype.rearrangePosition=function(e,t,n){for(var o=this,r=this.state.anchorParams,i=Math.max(r.findIndex((function(e){return e.anchor.anchorId===o._positionRefAnchorId})),t),a=e,s=i+1;s<n;++s){var c=this.getDomHeight(r[s-1].anchor.anchorId);if(c){var l=c+10;e[s]-e[s-1]<l&&(a[s]=e[s-1]+l)}}for(s=i-1;s>=t;--s){var p=this.getDomHeight(r[s].anchor.anchorId);if(p){l=p+10;e[s+1]-e[s]<l&&(a[s]=e[s+1]-l)}}},t.prototype.updateRenderPosition=function(){var e=this,t=0,n=[],o=this.state.anchorParams;if(this.state.anchorParams.length>0){var r=Gi(this.getVisibleRange(),2),i=r[0],a=r[1];if(a>i){t=o[i].ref.expectedPosition;for(var s=i;s<a;++s)n[s]=o[s].ref.expectedPosition-t;this.rearrangePosition(n,i,a),(Math.abs(t-this.state.basePosition)>.5||n.length!==this.state.positions.length||n.some((function(t,n){return t!==e.state.positions[n]})))&&this.setState({basePosition:t,positions:n})}}},t.prototype.hover=function(e,t){var n=this;if(void 0===t&&(t=!0),e.length>0){var o=this.props.manager.activator.activeAnchorId;t&&(o||(this._positionRefAnchorId=e[0],this.updateRenderPosition())),e.forEach((function(e){var o=n._groupRenders.get(e);o&&o.setState({hover:t})}))}},t.prototype.render=function(){var e=this;return i.a.createElement("div",{className:"comment-external-container",onMouseEnter:this._onMouseEnter,onMouseLeave:this._onMouseLeave,style:{top:this.state.basePosition}},this.state.anchorParams.map((function(t,n){return i.a.createElement(Vi,{key:t.anchor.anchorId,data:e.props.manager.data,anchor:t.anchor,position:e.state.positions[n],active:t.anchor.anchorId===e.state.activeAnchorId,onHeightUpdate:e._onHeightUpdate,onClick:function(){return e._onGroupClick(t.anchor.anchorId)},onRef:e._onGroupRef,onDeref:e._onGroupDeref})})))},t}(i.a.Component),qi=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Zi=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return qi(t,e),t.prototype.toggle=function(e,t){this._renderRef.current&&(this._renderRef.current.togglePartial(!e),e&&void 0!==t&&this._renderRef.current.activate(t))},t.prototype.toggleSubMode=function(e){return e||this.toggle(!1),!0},t.prototype.canCancel=function(){return!0},t.prototype.clearCache=function(){this._renderRef.current&&this._renderRef.current.clearCache()},t.prototype.syncData=function(){this._renderRef.current&&this._renderRef.current.syncData()},t.prototype.activate=function(e){this._renderRef.current&&this._renderRef.current.activate(e)},t.prototype.onCommentAdd=function(){},t.prototype.onCommentDelete=function(){},t.prototype.hover=function(e,t){this._renderRef.current&&this._renderRef.current.hover(e,t)},t.prototype.peek=function(e){this._renderRef.current&&this._renderRef.current.partial(e)},t}(hr),$i=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Qi=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._syncedByAdd=!1,t}return $i(t,e),t.prototype.add=function(t,n){e.prototype.add.call(this,t,n),this._section=n},t.prototype.remove=function(t,n){return!!e.prototype.remove.call(this,t,n)&&(this._section=void 0,!0)},t.prototype.isActive=function(){return this._renderRef.current&&this._manager.activator.activeAnchorId===this._renderRef.current.state.activeAnchorId},t.prototype.canCancel=function(){return!0},t.prototype.onUpdate=function(){if(this._section){var e=Xo.INVISIBLE_POSITION_2D;if(this.isActive()){var t=this._manager.activator.activeCommentRange;t&&(e=Xo.getPositionFromRange(t,{alignToBottom:!0,alignToLeafBoxInX:!0})||Xo.INVISIBLE_POSITION_2D)}this._section.updateLayout(e.x,e.y)}},t.prototype.syncData=function(){this._renderRef.current&&!this._syncedByAdd&&this._renderRef.current.forceUpdate(),this._syncedByAdd=!1},t.prototype.activate=function(e){this._renderRef.current&&this._renderRef.current.activate(e)},t.prototype.onCommentAdd=function(){this._syncedByAdd=!0,this._manager.newAnchorId&&this.activate(this._manager.newAnchorId)},t.prototype.onCommentDelete=function(){},t.prototype.onRenderLayoutChange=function(){this._renderRef.current&&(this._renderRef.current.onLayoutChange(),this.onUpdate())},t.prototype.peek=function(e){this._manager.view.getView(Do.f.External).peek(e)},t.prototype.hover=function(e){this._renderRef.current&&this._renderRef.current.setState({anchors:e})},t.prototype.toggle=function(e,t){this._renderRef.current&&this._renderRef.current.activate(e&&void 0!==t?t:"")},t.prototype.toggleSubMode=function(e){return e||this.toggle(!1),!0},t}(mr),Xi=(n(356),function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}()),Yi=function(){return(Yi=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},Ji=function(e){function t(t){var n=e.call(this,t)||this;return n._exitHandle=void 0,n._ref=i.a.createRef(),n.state=Yi(Yi({},n.getLayout()||{left:0,width:0}),{anchors:[],activeAnchorId:""}),n._renderer=n.props.manager.view.getView(Do.f.Float),n}return Xi(t,e),t.prototype.getLayout=function(){return Si(this.props.manager.editor)},t.prototype.onLayoutChange=function(){var e=this.getLayout();e&&(Math.abs(e.left-this.state.left)>.5||Math.abs(e.width-this.state.width)>.5)&&this.setState(e)},t.prototype.toggleOn=function(e){this._ref.current&&(this._ref.current.style.opacity=e?"1":"0")},t.prototype.resetHandle=function(e){this._exitHandle&&clearTimeout(this._exitHandle),this._exitHandle=e},t.prototype.activate=function(e){var t=this;if(e){this.toggleOn(!0),this.resetHandle();var n=this.props.manager.activator.activeCommentRange,o=[e];if(e&&n){var r=this.props.manager.engine.rangeInfoMap.get(n);r&&(o=r.anchorIds)}this.setState({activeAnchorId:e,anchors:o})}else this.toggleOn(!1),this.resetHandle(setTimeout((function(){t.toggleOn(!0),t.setState({activeAnchorId:"",anchors:[]})}),300))},t.prototype.render=function(){return i.a.createElement("div",{className:"comment-float-container",ref:this._ref},this.state.anchors.length>0?i.a.createElement(_i,{manager:this.props.manager,renderer:this._renderer,data:this.state.anchors.join(c.CommentSpanPropKey.commentsConnection),activeAnchorId:this.state.activeAnchorId}):null)},t}(i.a.Component),ea=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),ta=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._addShourtcutRef=i.a.createRef(),t._menuRef=i.a.createRef(),t}return ea(t,e),t.prototype.onNetworkChange=function(){e.prototype.onNetworkChange.call(this),this._addShourtcutRef.current&&this._addShourtcutRef.current.onNetworkChange(),this._menuRef.current&&this._menuRef.current.forceUpdate()},t.prototype.getConfig=function(){var t=e.prototype.getConfig.call(this),n=this._manager.view.registerViewType(Do.f.Float,Qi),o=this._manager.view.registerViewType(Do.f.External,Zi);return t.main.push(i.a.createElement(Ji,{key:"comment-float-container",ref:n.renderRef,manager:this._manager})),t.right.push(i.a.createElement(Ai,{key:"comment-add-shortcut",manager:this._manager,ref:this._addShourtcutRef}),i.a.createElement(ki,{key:"comment-menu",manager:this._manager,ref:this._menuRef}),i.a.createElement(Ki,{key:"comment-external-container",ref:o.renderRef,manager:this._manager})),t},t}(Mi);var na,oa=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},ra=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},ia={menu:[{name:"insert-comment",content:"批注",respectOffline:!0,icon:i.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"},i.a.createElement("g",{fill:"none",fillRule:"evenodd"},i.a.createElement("path",{d:"M0 0H24V24H0z"}),i.a.createElement("path",{fill:"#444D5B",fillRule:"nonzero",d:"M19.5 5c.276 0 .5.224.5.5v11c0 .276-.224.5-.5.5h-5.494l-1.987 3-2.042-3H4.5c-.276 0-.5-.224-.5-.5v-11c0-.276.224-.5.5-.5h15zm-.8 1.3H5.3v9.4h5.364l1.34 1.968 1.304-1.968H18.7V6.3zm-6.072 1.698v2.375l2.371.001v1.25h-2.372l.001 2.374h-1.25v-2.375l-2.379.001v-1.25h2.378l.001-2.376h1.25z"}))),onClick:function(e,t){t.core.addComment(),c.ReportHelper.tdwReport({opername:"doc_cooper",module:"word_comment",action:"call_oper",ver5:t.core.isEmbeded?"in":"out",ver6:"menu",ver7:e.editor.service.getSelection().range().isEmpty()?"not_select":"select"})},shouldDisabled:function(e,t){return!t.core.canAddComment()}},{name:"view-comment",content:"显示批注",onClick:function(e,t){t.core.setCommentVisible(!t.core.isCommentVisible,!0),t.core.isCommentVisible||c.ReportHelper.tdwReport({opername:"doc_cooper",module:"word_comment",action:"hide"})},shouldCheck:function(e,t){return t.core.isCommentVisible},shouldDisabled:function(e,t){return!t.core.ready||t.core.getManager().isMultiEditorMode}}],contextMenu:[{name:"comment",content:"批注",respectOffline:!0,icon:i.a.createElement("svg",{width:"22",height:"22",viewBox:"0 0 22 22",xmlns:"http://www.w3.org/2000/svg"},i.a.createElement("g",{fill:"none",fillRule:"evenodd"},i.a.createElement("path",{d:"M-1-1h24v24H-1z"}),i.a.createElement("path",{d:"M3.625 4.625v10.75h5.682l1.705 2.504 1.659-2.504h5.704V4.625H3.625z",stroke:"#5C5C5C",strokeWidth:"1.25"}),i.a.createElement("path",{d:"M11.003 6.998c.345 0 .625.28.625.625v1.75l1.746.001a.625.625 0 0 1 0 1.25h-1.747l.001 1.75a.625.625 0 1 1-1.25 0v-1.75H8.623a.625.625 0 1 1 0-1.25h1.753l.001-1.75c0-.346.28-.626.625-.626z",fill:"#5C5C5C"}))),shouldHide:function(e,t){return!t.core.canAddComment()},onClick:function(e,t){t.core.addComment(),c.ReportHelper.tdwReport({opername:"doc_cooper",module:"word_comment",action:"call_oper",ver5:t.core.isEmbeded?"in":"out",ver6:"rightmenu",ver7:e.editor.service.getSelection().range().isEmpty()?"not_select":"select"})}}],toolbar:[{name:"insert-comment",type:"icon",icon:i.a.createElement("svg",{width:"22",height:"22",viewBox:"0 0 22 22",xmlns:"http://www.w3.org/2000/svg"},i.a.createElement("g",{fill:"none",fillRule:"evenodd"},i.a.createElement("path",{d:"M-1-1h24v24H-1z"}),i.a.createElement("path",{d:"M3.625 4.625v10.75h5.682l1.705 2.504 1.659-2.504h5.704V4.625H3.625z",stroke:"#5C5C5C",strokeWidth:"1.25"}),i.a.createElement("path",{d:"M11.003 6.998c.345 0 .625.28.625.625v1.75l1.746.001a.625.625 0 0 1 0 1.25h-1.747l.001 1.75a.625.625 0 1 1-1.25 0v-1.75H8.623a.625.625 0 1 1 0-1.25h1.753l.001-1.75c0-.346.28-.626.625-.626z",fill:"#5C5C5C"}))),tooltip:"添加批注",respectOffline:!0,respectPermission:function(e,t){return!t.core.canAddComment()},onClick:function(e,t){t.core.addComment(),c.ReportHelper.tdwReport({opername:"doc_cooper",module:"word_comment",action:"call_oper",ver5:t.core.isEmbeded?"in":"out",ver6:"toolbar",ver7:e.editor.service.getSelection().range().isEmpty()?"not_select":"select"})},shouldDisabled:function(e,t){return!t.core.canAddComment()}}]},aa=ia.menu,sa=ia.contextMenu,ca=ia.toolbar,la=function(){function e(e){this._core=e}return e.prototype.$onInit=function(){this._core?this._core.registerRendererChildrenType(ta):g.Logger.error("comment| cannot get comment core handler")},Object.defineProperty(e.prototype,"core",{get:function(){return this._core},enumerable:!0,configurable:!0}),e=oa([Object(m.i)({menuItems:aa,contextMenuItems:sa,toolbarItems:ca,name:y.a.CommentPc,scope:0,for:["melo"]}),ra("design:paramtypes",[Yr])],e)}(),pa=n(489),ua=(n(371),function(){return(ua=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)}),da=function(){function e(){}return e.reportPrintRecordEvent=function(e){return new Promise((function(t,n){$.ajax({type:"post",url:"/cgi-go/padinfo/set_version_record",data:ua(ua({},e),{xsrf:Object(c.getXsrf)()}),success:function(e){var o=JSON.parse(e);0===o.retcode?t(o):n(o)},error:function(e){n(e)}})}))},e}();!function(e){e[e.SHCORTCUT_TRIGGER=1]="SHCORTCUT_TRIGGER",e[e.BUTTON_TRIGGER=2]="BUTTON_TRIGGER"}(na||(na={}));var ha,fa=[{name:"print",content:"打印",shortcut:{mac:"⌘+P",win:"Ctrl+P"},shouldDisabled:function(e){return!(e.permission&&e.permission.canPrint)},onClick:function(e,t){t.showPrintPreview(e,na.BUTTON_TRIGGER)}}],ma=[{keyBindings:{mac:m.n.COMMAND+m.o.P,win:m.n.CTRL_WIN+m.o.P},callback:function(e,t){t.showPrintPreview(e,na.SHCORTCUT_TRIGGER)}}],ga=n(100),ya=n(99),va=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},ba=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Ca=function(){function e(e,t,n,o,r){var i=this;this.sectionHandler=t,this.pageHandler=n,this.workbench=o,this.featureService=r,this.printStatus=!1,this.isSuccessPrint=!1,this.insertPrintStyleSheet=function(e){var t=document.createElement("style");t.type="text/css",t.media="print",t.id="print-media-style-54c5ece316f2022a03779596d98e4bba";try{t.appendChild(document.createTextNode(e))}catch(n){t.cssText=e}var n=document.getElementsByTagName("head")[0];n&&n.appendChild(t)},this.removePrintStyleSheet=function(){var e=document.getElementById("print-media-style-54c5ece316f2022a03779596d98e4bba"),t=document.getElementsByTagName("head")[0];t&&e&&t.removeChild(e)},this.setPageSize=function(e,t,n){var o="@page {\n  size: "+e+"mm "+t+"mm "+n+";\n  margin: 0;\n}\n";i.removePrintStyleSheet(),i.insertPrintStyleSheet(o)},this.setStandardPage=function(e,t){var n="@page {\n  size: "+e+" "+t+";\n  margin: 0;\n}\n";i.removePrintStyleSheet(),i.insertPrintStyleSheet(n)},this.resetPrintConfig=function(){try{var e=i.sectionHandler.getPageSettingData();if(e&&e.pageWidth&&e.pageHeight){var t=e.pageHeight>e.pageWidth?"":"landscape",n=Object(g.twipsToPt)(e.pageWidth)/(72/2.55),o=Object(g.twipsToPt)(e.pageHeight)/(72/2.55),r=Ft.getPaperSizeWellKnownNameAndValue(n,o);r&&r.value&&("custom"===r.value?i.setPageSize(10*n,10*o,t):i.setStandardPage(r.value,t))}}catch(e){}},this.context=e.context}return e.prototype.$beforeDestroy=function(){this.editor&&(this.isSuccessPrint=!1,this.printUtils.finishPrinting(),this.editor.removeListener(c.RenderNotificationTypes.FULL_RENDER_FINISH,this),this.editor.removeListener(ga.b.FINISH_IMAGE_LOAD,this))},e.prototype.$onInit=function(e){this.editor=e},Object.defineProperty(e.prototype,"printResult",{get:function(){return this.isSuccessPrint},enumerable:!0,configurable:!0}),e.prototype.reportPrintEvent=function(){var e=this.context.collabClient;e&&da.reportPrintRecordEvent({globalPadId:Object(M.c)().globalPadId,opType:1,recordType:5,rev:e.getPadRev()}).then((function(){})).catch((function(){}))},e.prototype.doAfterPrint=function(){var e=this;window.onafterprint=function(){e.printUtils.finishPrinting(),e.editor.removeListener(c.RenderNotificationTypes.FULL_RENDER_FINISH,e),e.editor.removeListener(ga.b.FINISH_IMAGE_LOAD,e)}},e.prototype.doPrint=function(){var e=this;this.reportPrintEvent(),this.workbench.emit("$closeComment",!0);var t=this.featureService.get(y.a.Outline),n=this.featureService.get(y.a.Translate),o=!1,r=!1;n&&(null==n?void 0:n.isTranslateOpened())&&(o=null==n?void 0:n.isTranslateOpened(),null==n||n.closeTranslate()),t&&t.outlineCtrl&&t.outlineCtrl.isOutlineShow()&&(r=t.outlineCtrl.isOutlineShow(),t.outlineCtrl.hide()),setTimeout((function(){window.print(),e.isSuccessPrint=!0,e.printStatus=!1,r&&t&&t.outlineCtrl&&setTimeout((function(){t.outlineCtrl.show()}),1e3),n&&(null==n?void 0:n.isTranslateOpened())&&o&&setTimeout((function(){null==n||n.openTranslate()}),1e3),e.doAfterPrint()}),200)},e.prototype.doBeforePrinting=function(e){var t=this;this.isSuccessPrint=!1,T.Snackbar.show({message:"准备打印中，请稍等。",type:"info",duration:1e3}),this.printStatus=!0;var n=ya.a.getInitImageCount();this.printUtils.startPrinting(n);var o=ya.a.getAllImages(e);e.once(c.RenderNotificationTypes.FULL_RENDER_FINISH,(function(){0!==o&&n!==o?t.editor.once(ga.b.FINISH_IMAGE_LOAD,(function(){t.doPrint()})):t.doPrint()})),e.fire(new c.FullRenderNotification),setTimeout((function(){t.doAfterPrint(),t.printStatus=!1}),600)},e.prototype.showPrintPreview=function(e,t){var n=this,o=(new Date).getTime(),r=e.editor;this.printUtils=ya.a.getInstance(r),window.print&&this.context.isFeatureLoaded&&"complete"===document.readyState&&!this.printStatus?this.pageHandler.isPageMode()?(this.resetPrintConfig(),this.doBeforePrinting(r)):(r.once(c.RenderNotificationTypes.RENDER_FINISH,(function(){n.resetPrintConfig(),n.doBeforePrinting(r)})),this.pageHandler.setPageMode(c.LayoutType.Paged)):T.Snackbar.show({message:"文档尚未加载完成，请稍后再试。",type:"info",duration:3e3});var i=(new Date).getTime()-o,a="否";this.isSuccessPrint&&(a="是"),c.ReportHelper.tdwReport({opername:"doc_word_file",module:"print_invoke",action:"invoke_count",obj3:i,ver5:t,ver6:a})},e=va([Object(m.i)({name:y.a.Print,scope:0,for:["melo"],menuItems:fa,keymap:ma}),ba("design:paramtypes",[m.f,Kt,rt,m.B,m.k])],e)}(),_a=n(372),wa=n.n(_a),Ra=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Sa=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Ea=function(){function e(e,t){var n=this;this.workbench=t,this.authExpTipsShowed=!1,this.handleLogin=function(){n.slr.load("Login",(function(e){var t=document.getElementById("loginContainer");t&&e.show(t,{padId:"",domainId:"",isMaskClose:!0})}))},this.slr=this.scriptLoaderService.getScriptLoader(),e.float({name:"login-container-readonly",component:i.a.createElement("div",{id:"loginContainer"})}),this.workbench.listen("$requestLogin",(function(){n.handleLogin()})),wa.a.setCallback((function(e){1e4!==e.code&&10001!==e.code||n.accountSwitched()}))}return e.prototype.$onInit=function(){var e=this;this.slr.listen("SL-INIT",(function(){if(-1!==location.href.indexOf("autoshowlogin")&&(e.handleLogin(),window.history.replaceState)){var t=Object(g.removeURLParameter)(window.location.href,"autoshowlogin");window.history.replaceState(window.history.state,document.title,t)}})),this.slr.listen("TX-LOGIN-PSKEY-EXPIRED",this.onLoginExpire.bind(this))},e.prototype.onLoginExpire=function(){var e=this;this.authExpTipsShowed||(P.a.show({message:"登录过期",action:"重新登录",autoClose:!1,onClickAction:function(){e.handleLogin()}}),this.authExpTipsShowed=!0)},e.prototype.accountSwitched=function(){P.a.show({message:"帐号信息变化",action:"刷新",type:"info",autoClose:!1,id:"checkIfAccountSwitched-1",closable:!0,onClickAction:function(){window.location.reload()}})},Ra([Object(m.l)(),Sa("design:type",X.a)],e.prototype,"scriptLoaderService",void 0),e=Ra([Object(m.i)({name:y.a.Login,scope:1}),Sa("design:paramtypes",[m.A,m.B])],e)}(),Ta=(n(373),function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}()),Pa=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Ia=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},xa=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.clickHandler=function(){t.props.slr.load("PermitApply",(function(e){e.permitApply(t.context.clientVars.padType,null,(function(){t.props.onPermissionChange()}))})),c.ReportHelper.tdwReport({opername:"doc_menubar",module:"request_access_button",action:"click"}),c.ReportHelper.tdwReport({opername:"doc_author",module:"edit",action:t.props.canClone?"readonly_edit_tip_clk_pc":"readonly_apply_tip_clk_pc"})},t.loginHandler=function(){t.workbench.emit("$requestLogin"),c.ReportHelper.tdwReport({opername:"doc_login",module:"readonly",action:"readonly_tip_login_pc"})},t}return Ta(t,e),t.prototype.render=function(){return this.props.isLogin&&this.props.canApply?i.a.createElement("div",{className:"readonly_tip_popup"},i.a.createElement("div",{className:"readonly_tip_content"},"你只能查看此文档。若要编辑文档，请向文档创建者",i.a.createElement("b",null,this.props.owner),"申请编辑权限",this.props.canClone?"或生成副本进行编辑":"","。"),i.a.createElement(H.a,{className:"readonly_tip_action",onClick:this.clickHandler},this.props.canClone?"编辑文档":"申请编辑权限")):this.props.isLogin?i.a.createElement("div",{className:"readonly_tip_popup"},i.a.createElement("div",{className:"readonly_tip_content"},this.props.content)):i.a.createElement("div",{className:"readonly_tip_popup"},i.a.createElement("div",{className:"readonly_tip_content"},"你只能查看此文档。若要编辑文档，请登录后编辑。"),i.a.createElement(H.a,{className:"readonly_tip_action",onClick:this.loginHandler},"立即登录"))},t.contextType=m.h,Pa([Object(m.l)(),Ia("design:type",m.B)],t.prototype,"workbench",void 0),t}(r.Component),Oa=n(480),La=function(){return(La=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},Ma=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{c(o.next(e))}catch(e){i(e)}}function s(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))},Na=function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},Aa=function(){function e(){}return e.checkIsApplyIn24H=function(e){return Ma(this,void 0,void 0,(function(){return Na(this,(function(t){return[2,new Promise((function(t,n){w.a.ajax({url:"/cgi-bin/online_docs/auth_apply/check",xhrFields:{withCredentials:!0},data:{bkn:N.a.getBkn(),domainId:e.domainId,localPadId:e.localPadId,xsrf:Object(c.getXsrf)()},success:function(e){t({apply:10003===e.retcode||10004===e.retcode,pass:"1"===String(e.pass),nopass:"0"===String(e.pass)})},error:function(){t({apply:!1})}})}))]}))}))},e.getPolicy=function(e){return Ma(this,void 0,void 0,(function(){return Na(this,(function(t){return[2,new Promise((function(t,n){var o={};N.a.getQuery("route_ip")&&(o.route_ip=N.a.getQuery("route_ip")),N.a.getQuery("room_route_ip")&&(o.room_route_ip=N.a.getQuery("room_route_ip")),w.a.ajax({type:"get",url:Object(g.getUidParam)("//docs.qq.com/cgi-bin/redirect/"+e.creatorDomain+"/ep/api/getpadinfo"),data:La({localPadId:e.padId,type:1,ver:2,xsrf:Object(c.getXsrf)()},o),xhrFields:{withCredentials:!0},success:function(e){0===e.retcode&&t(e)},error:function(){n()}})}))]}))}))},e}(),Da=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),ka={width:74,height:24,padding:0,fontSize:12,minWidth:74,lineHeight:"1.67",marginLeft:3,marginRight:16,color:"rgba(0, 0, 0, 0.64)",border:"solid 1px rgba(0, 0, 0, 0.12)",borderRadius:12,paddingLeft:4},ja={whiteSpace:"pre-wrap",width:190},Fa=function(e){function t(t){var n=e.call(this,t)||this;return n.componentDidMount=function(){n.privilegeCtrl.canEdit||n.checkApply(),n.onlineState=n.context.store.get(m.d.IsOnline),n.onlineState.pipe(Object(Oa.a)()).subscribe((function(e){n.setState({isOnline:e})}))},n.checkApply=function(){var e=n.context.clientVars;Aa.checkIsApplyIn24H(e).then((function(e){var t=e.apply,o=e.pass,r=e.nopass;n.setState({apply:t,pass:o,nopass:r})})),mt.getUserMarkName(e,[e.ownerId]).then((function(e){n.setState({owner:e[0].markName})}))},n.handleMouseOver=function(){n.dropdownVisible||n.setState({tooltipsVisible:!0})},n.handleMouseOut=function(){n.setState({tooltipsVisible:!1})},n.privilegeCtrl=p.a.getInstance(),n.state={apply:!1,pass:!1,nopass:!1,isOnline:!0,owner:"",tooltipsVisible:!1},n}return Da(t,e),t.prototype.render=function(){var e=this;if(!this.privilegeCtrl.canEdit){var t="",n=!0,o=Object(M.c)(),r=p.a.getInstance().canCopyDoc;return o.isLogin?(t="当前文档权限为“只能查看”，点击申请编辑权限"+(r?"或生成副本":"")+"。",!this.state.apply||this.state.pass||this.state.nopass?this.state.apply&&this.state.nopass&&(t="权限申请未通过，“只能查看”文档。",n=!1):(t="权限申请已提交，请等待创建者审核。",n=!1)):t="当前文档权限为“只能查看”，登录后获得更多操作权限。",i.a.createElement(wt.a,{dropContent:i.a.createElement(xa,{isLogin:this.context.clientVars.isLogin,onPermissionChange:this.checkApply,content:t,canApply:n,canClone:r,owner:this.state.owner,slr:this.props.slr}),onVisibleChange:function(t){e.dropdownVisible=t,t&&e.setState({tooltipsVisible:!1}),t&&c.ReportHelper.tdwReport({opername:"doc_menubar",module:"only_view_button",action:"click"}),t&&!o.isLogin?c.ReportHelper.tdwReport({opername:"doc_login",module:"readonly",action:"readonly_clk_pc"}):t&&o.isLogin&&c.ReportHelper.tdwReport({opername:"doc_author",module:"edit",action:r?"readonly_edit_tip_exp_pc":"readonly_apply_tip_exp_pc"})},disabled:!this.state.isOnline},i.a.createElement(Ge.a,{visible:this.state.tooltipsVisible,title:t,trigger:"hover",overlayStyle:ja,disabled:!this.state.isOnline},i.a.createElement(H.a,{type:"default",size:"small",style:ka},i.a.createElement("span",{onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut},"只能查看",i.a.createElement("span",{style:{color:"rgba(0, 0, 0, 0.4)"}}," ▾")))))}return null},t.contextType=m.h,t}(r.Component);!function(e){e.SELECT_WORD="selectWord",e.SELECT_PARA="selectParagraph"}(ha||(ha={}));var Ha=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Ba=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Ua=function(){function e(e,t,n){var o=this;this.titlebar=e,this.workbench=n,this.permissionTipsShowed=!1,this.slr=this.scriptLoaderService.getScriptLoader(),this.context=t.context,this.titlebar.hydrate("titlebar-readonly-tips",i.a.createElement(Fa,{slr:this.slr,ref:function(e){o.readonlyTipsComponent=e}}))}return e.prototype.$afterPermissionChanged=function(){this.readonlyTipsComponent&&this.readonlyTipsComponent.forceUpdate()},e.prototype.$onInit=function(e){var t,n;e.registerPlugin((t=this,(n={})[ha.SELECT_WORD]=function(e,n){p.a.getInstance().isBlocked||t.showReadonlyTips(),n()},n[ha.SELECT_PARA]=function(e,n){p.a.getInstance().isBlocked||t.showReadonlyTips(),n()},n))},e.prototype.showReadonlyTips=function(){var e=this,t=this.context.permission,n=this.context.clientVars,o=n.isLogin,r=n.padType;o?t.isEditable||this.permissionTipsShowed||(P.a.show({message:"当前文档权限为“只能查看”。",autoClose:!0,duration:5e3,action:"申请编辑权限",onClickAction:function(){e.slr.load("PermitApply",(function(t){t.permitApply(r,null,(function(){e.readonlyTipsComponent&&e.readonlyTipsComponent.checkApply()}))})),c.ReportHelper.tdwReport({opername:"doc_author",module:"edit",action:"try_edit_toast_apply_clk_pc"})}}),this.permissionTipsShowed=!0,c.ReportHelper.tdwReport({opername:"doc_author",module:"edit",action:"try_edit_toast_apply_exp_pc"})):this.permissionTipsShowed||(P.a.show({message:"你只能查看此文档。若要编辑文档，请登录后编辑。",type:"info",autoClose:!0,duration:5e3,action:"立即登录",onClickAction:function(){e.workbench.emit("$requestLogin"),c.ReportHelper.tdwReport({opername:"doc_login",module:"readonly",action:"try_edit_toast_login_clk_pc"})}}),this.permissionTipsShowed=!0,c.ReportHelper.tdwReport({opername:"doc_login",module:"readonly",action:"try_edit_toast_login_exp_pc"}))},Ha([Object(m.l)(),Ba("design:type",X.a)],e.prototype,"scriptLoaderService",void 0),e=Ha([Object(m.i)({name:y.a.ReadonlyTips,scope:0,for:["melo"]}),Ba("design:paramtypes",[it.a,m.f,m.B])],e)}(),Va=(n(374),function(){function e(){}return e.publishDocument=function(){return new Promise((function(e,t){var n="/dop-api/publish?normal=1&id="+window.location.pathname.split("/").pop();w.a.ajax({type:"get",url:n,timeout:3e4,cache:!0,xhrFields:{withCredentials:!0},success:function(n){0===n.retcode?e(n):t(n)},error:function(e,n,o){t(o)}})}))},e.cancelPublishDocument=function(){return new Promise((function(e,t){var n="/dop-api/resetPubStat?id="+window.location.pathname.split("/").pop();w.a.ajax({type:"get",url:n,timeout:3e4,cache:!0,xhrFields:{withCredentials:!0},success:function(n){0===n.retcode?e(n):t(n)},error:function(e,n,o){t(o)}})}))},e}()),Wa=n(279),Ga=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),za=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ga(t,e),t.prototype.componentDidMount=function(){this.qrcodeContainer&&Wa.a.create(this.qrcodeContainer,this.props.shareUrl,!0,{correctLevel:window.QRCode.CorrectLevel.H,width:156,height:156,autosize:!0,logoType:1})},t.prototype.render=function(){var e=this;return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"publish-panel-qrcode-container",ref:function(t){e.qrcodeContainer=t}}),i.a.createElement("div",{className:"publish-panel-qrcode-text"},"使用微信 / QQ扫一扫",i.a.createElement("br",null),"把网页分享给好友"))},t}(i.a.Component),Ka=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),qa=function(e){function t(t){var n=e.call(this,t)||this;n.handlePublish=function(){n.doPublish()},n.handleUpdate=function(){c.ReportHelper.tdwReport({opername:"doc_word_file",module:"to_web",action:"click_refresh"}),n.doPublish(!0)},n.handleCopy=function(){if(c.ReportHelper.tdwReport({opername:"doc_word_file",module:"to_web",action:"copy_link_setmenu"}),void 0!==window.clipboardData)window.clipboardData.setData("Text",n.shareUrl);else if(void 0!==window.getSelection){var e=document.createElement("textarea");e.innerHTML=n.shareUrl,document.body.appendChild(e);try{e.select(),document.execCommand("copy")}catch(e){}document.body.removeChild(e)}n.setState({snackbarVisible:!0}),setTimeout((function(){n.setState({snackbarVisible:!1})}),2e3)},n.doPublish=function(e){void 0===e&&(e=!1),Va.publishDocument().then((function(t){n.props.onPublish&&n.props.onPublish(t.pub),n.setState({publishStatus:2}),e?(P.a.show({message:"已同步到网页",type:"success",duration:2e3,autoClose:!0}),n.forceUpdate()):(c.ReportHelper.tdwReport({opername:"doc_word_file",module:"to_web",action:"click_generate_suc"}),window.open(n.shareUrl),P.a.show({message:"已发布为网页",type:"success",duration:3e3,autoClose:!0,action:"查看",onClickAction:function(){window.open(n.shareUrl)}}))})).catch((function(){e?P.a.show({message:"同步到网页失败",duration:2e3,autoClose:!0}):(P.a.show({message:"生成网页失败",duration:2e3,autoClose:!0}),c.ReportHelper.tdwReport({opername:"doc_word_file",module:"to_web",action:"click_generate_fail"}))}))},n.handleCancel=function(){c.ReportHelper.tdwReport({opername:"doc_word_file",module:"to_web",action:"click_confirm_stop"}),Va.cancelPublishDocument().then((function(){P.a.show({message:"已停用网页",type:"success",duration:2e3,autoClose:!0}),n.props.onCancel&&n.props.onCancel()})).catch((function(){P.a.show({message:"停用网页失败",duration:2e3,autoClose:!0})}))},n.showModal=function(){c.ReportHelper.tdwReport({opername:"doc_word_file",module:"to_web",action:"click_stop"}),n.closeModal(),n._modal=W.a.confirm({title:"停用网页",content:"确认将停用此网页吗?",okText:"确定",cancelText:"取消",onOk:n.handleCancel,onCancel:n.closeModal})},n.closeModal=function(){n._modal&&(n._modal.close(),n._modal=null)},n.showQrcodeModal=function(){n.closeQrcodeModal(),n._qrcodeModal=W.a.confirm({title:"生成二维码",content:i.a.createElement(za,{shareUrl:n.shareUrl}),footer:null,style:{width:386,height:386}})},n.closeQrcodeModal=function(){n._qrcodeModal&&(n._qrcodeModal.close(),n._qrcodeModal=null)},n.handleGenerateQrcode=function(){n.showQrcodeModal()},n.handleCheckStateChange=function(e){n.setState({shouldCheck:e}),g.LocalStorageUtil.isLocalStorageSupported()&&g.LocalStorageUtil.setItem("word-sava-to-web-tips-"+n.props.clientVars.uin,""+e)};var o=g.LocalStorageUtil.isLocalStorageSupported()&&"true"===g.LocalStorageUtil.getItem("word-sava-to-web-tips-"+t.clientVars.uin);n.state={publishStatus:n.props.publishStatus,shouldCheck:o,snackbarVisible:!1};var r=window.location.pathname.split("/").pop();return n.shareUrl="https://docs.qq.com/doc/"+r+"?pub=1&dver="+t.clientVars.collab_client_vars.dver,n}return Ka(t,e),t.prototype.getPanelContent=function(){if(2===this.state.publishStatus){var e=this.context.collabClient,t=!1;e&&(t=e.getPadRev()>this.props.handler.getPublishVer());var n=t?{display:"block"}:{display:"none"};return[i.a.createElement("div",{key:"publish-panel-content-published",className:"publish-panel-content",style:{marginBottom:100}},i.a.createElement("div",{className:"publish-panel-content-text"},"网页网址"),i.a.createElement("div",{className:"publish-panel-qrcode",onClick:this.handleGenerateQrcode}),i.a.createElement("div",{style:{marginTop:8,marginBottom:8}},i.a.createElement(U.a,{value:this.shareUrl,style:{width:"386px"},inputStyle:{height:"34px",color:"rgb(84, 84, 84)"}})),i.a.createElement("div",{style:n},i.a.createElement("span",{className:"publish-panel-content-text"},"文档内容有更新，是否需要同步到网页？"),i.a.createElement("span",{className:"publish-panel-content-link",onClick:this.handleUpdate},"同步内容")))]}return[i.a.createElement("div",{key:"publish-panel-content-first-publish",className:"publish-panel-content"},i.a.createElement("div",{className:"publish-panel-content-text"},"生成一个新网页链接，任何人都可阅读。"),i.a.createElement("div",{className:"publish-panel-content-text"},"网页不显示工具栏，阅读者不能申请原文档的查看和编辑权限。"))]},t.prototype.getPanelFooter=function(){return 2===this.state.publishStatus?[i.a.createElement("div",{key:"publish-panel-footer-published",className:"publish-panel-footer"},i.a.createElement(H.a,{onClick:this.handleCopy,style:{marginRight:16}},"复制网址"),i.a.createElement(H.a,{onClick:this.showModal},"停用网页"),i.a.createElement(P.a,{type:"success",visible:this.state.snackbarVisible},"已复制链接"))]:[i.a.createElement("div",{key:"publish-panel-footer-publish",className:"publish-panel-footer"},i.a.createElement(ii.a,{hollow:!0,style:{float:"left",marginRight:188,marginTop:4},checked:this.shouldTipsCheck(),onChange:this.handleCheckStateChange},"下次不再提示"),i.a.createElement(H.a,{type:"primary",onClick:this.handlePublish},"生成网页"))]},t.prototype.shouldTipsCheck=function(){return this.state.shouldCheck},t.prototype.render=function(){return i.a.createElement("div",null,i.a.createElement("div",{className:"publish-panel-header"},i.a.createElement("span",{className:"publish-panel-header-text"},2===this.state.publishStatus?"已发布为网页":"发布为网页")),this.getPanelContent(),this.getPanelFooter())},t.contextType=m.h,t}(i.a.Component),Za=[{name:"publish",content:"发布为网页",respectOffline:!0,shouldDisabled:function(e){return!(e.permission&&e.permission.canEdit)},shortcut:function(e,t){return{win:2===t.getStatus()?"已发布":"",mac:2===t.getStatus()?"已发布":""}},onClick:function(e,t){t.showPanel()}}],$a=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Qa=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Xa=function(){function e(e){var t=this;this.handleCancel=function(){t.setStatus(1),t.closePanel()},this.handlePublish=function(e){t.setStatus(2),t.setPublishVer(e)},this.publishStatus=1,this.publishVer=-1,this.context=e.context}return e.prototype.$onInit=function(){var e=this.context.clientVars;e&&void 0!==e.pub&&-1!==e.pub&&(this.publishStatus=2,this.publishVer=e.pub)},e.prototype.getStatus=function(){return this.publishStatus},e.prototype.setStatus=function(e){this.publishStatus=e},e.prototype.getPublishVer=function(){return this.publishVer},e.prototype.setPublishVer=function(e){this.publishVer=e},e.prototype.renderContent=function(){var e=this.context.clientVars;return i.a.createElement(qa,{publishStatus:this.getStatus(),onCancel:this.handleCancel,handler:this,onPublish:this.handlePublish,clientVars:e})},e.prototype.showPanel=function(){var e=this,t=this.context.clientVars;2===this.getStatus()?c.ReportHelper.tdwReport({opername:"doc_word_file",module:"to_web",action:"click_entrance_generated"}):c.ReportHelper.tdwReport({opername:"doc_word_file",module:"to_web",action:"click_entrance"}),this.closePanel(),g.LocalStorageUtil.isLocalStorageSupported()&&"true"===g.LocalStorageUtil.getItem("word-sava-to-web-tips-"+t.uin)&&1===this.getStatus()?Va.publishDocument().then((function(n){c.ReportHelper.tdwReport({opername:"doc_word_file",module:"to_web",action:"click_generate_suc"}),e.handlePublish(n.pub),e.showModal();var o=window.location.pathname.split("/").pop();window.open("https://docs.qq.com/doc/"+o+"?pub=1&dver="+t.collab_client_vars.dver),P.a.show({message:"已发布为网页",type:"success",duration:3e3,autoClose:!0,action:"查看",onClickAction:function(){window.open("https://docs.qq.com/doc/"+o+"?pub=1&dver="+t.collab_client_vars.dver)}})})).catch((function(){P.a.show({message:"生成网页失败",duration:2e3,autoClose:!0}),c.ReportHelper.tdwReport({opername:"doc_word_file",module:"to_web",action:"click_generate_fail"})})):this.showModal()},e.prototype.showModal=function(){this._modal=W.a.confirm({title:null,style:{width:440},footer:null,content:this.renderContent()})},e.prototype.closePanel=function(){this._modal&&(this._modal.close(),this._modal=null)},e=$a([Object(m.i)({name:y.a.Publish,scope:1,menuItems:Za}),Qa("design:paramtypes",[m.f])],e)}(),Ya=n(280),Ja=n.n(Ya);var es,ts=Object(m.D)(["shareContainerShow"])((function(e){var t=e.shareContainerShow;return i.a.createElement("div",{className:Ja.a.mask,id:"shareContainer",style:{display:t?"block":"none"}})})),ns=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),os=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},rs=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},is=function(e){function t(t){var n=e.call(this,t)||this;return n.onlineState=n.store.get(m.d.IsOnline),n.state={isOnline:n.onlineState.value},n}return ns(t,e),t.prototype.componentDidMount=function(){var e=this;this.onlineState.pipe(Object(Oa.a)()).subscribe((function(t){e.setState({isOnline:t})}))},t.prototype.render=function(){var e=this;return Object(M.c)().isLogin?i.a.createElement(H.a,{className:Ja.a.button+" "+Ja.a.element,type:"primary",style:{height:28,width:64,minWidth:64,fontWeight:500},disabled:!this.state.isOnline,onClick:function(){c.ReportHelper.tdwReport({opername:"doc_menubar",module:"share_button",action:"click"}),e.props.handler&&e.props.handler.handleShare()}},"分享"):null},os([Object(m.l)(),rs("design:type",m.x)],t.prototype,"store",void 0),t}(r.Component),as=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),ss=function(){return(ss=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},cs=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},ls=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},ps=function(e){function t(t){var n=e.call(this,t)||this;n.isOpend=!1,n.policies=[{content:i.a.createElement("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",version:"1.1"},i.a.createElement("defs",null,i.a.createElement("linearGradient",{x1:"100%",y1:"13.875%",x2:"0%",y2:"86.125%",id:"linearGradient-3"},i.a.createElement("stop",{stopColor:"#81868F",offset:"0%"}),i.a.createElement("stop",{stopColor:"#464D5A",offset:"100%"}))),i.a.createElement("g",{id:"titlebar/authority/invite",stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},i.a.createElement("rect",{id:"矩形",x:"0",y:"0",width:"24",height:"24"}),i.a.createElement("path",{d:"M10,12 C11.2109594,12 12.5036834,12.2280707 13.6890505,12.6461663 L13,14.3597006\n                    L13.0014563,14.5163969 C12.166725,14.2232096 11.2210705,14.0320184 10.2501148,14.0036638\n                    L10,14 C6.99322656,14 4.15741327,15.599305 4.00632239,17.0117116 L4,17.1289412 L4,19 L13,19\n                    L13,21 L2,21 L2,17.1289412 C2,14.0518668 6.3678026,12 10,12 Z M19,12 L19,15 L22,15 L22,17\n                    L19,17 L19,20 L17,20 L17,16.999 L14,17 L14,15 L17,14.999 L17,12 L19,12 Z M10,4 C11.9329966,4\n                    13.5,5.56700338 13.5,7.5 C13.5,9.43299662 11.9329966,11 10,11 C8.06700338,11 6.5,9.43299662\n                    6.5,7.5 C6.5,5.56700338 8.06700338,4 10,4 Z M10,6 C9.17157288,6 8.5,6.67157288 8.5,7.5 C8.5,8.32842712\n                    9.17157288,9 10,9 C10.8284271,9 11.5,8.32842712 11.5,7.5 C11.5,6.67157288 10.8284271,6 10,6 Z",id:"形状结合",fill:"url(#linearGradient-3)",fillRule:"nonzero"}))),tips:function(){return"邀请他人一起协作"}},{content:i.a.createElement("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",version:"1.1"},i.a.createElement("defs",null,i.a.createElement("linearGradient",{x1:"100%",y1:"13.875%",x2:"0%",y2:"86.125%",id:"linearGradient-4"},i.a.createElement("stop",{stopColor:"#81868F",offset:"0%"}),i.a.createElement("stop",{stopColor:"#464D5A",offset:"100%"}))),i.a.createElement("g",{id:"titlebar/authority/appoint",stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},i.a.createElement("rect",{id:"矩形备份-2",x:"0",y:"0",width:"24",height:"24"}),i.a.createElement("path",{d:"M10,12 C11.34023,12 12.7806132,12.279363 14.064766,12.7865122 C14.0217739,13.0179044 14,13.2564094\n                    14,13.5 C14,14.0367097 14.1057048,14.5487308 14.2971093,15.0162534 C14.2727999,15.0311377 14.248623,15.0461724\n                    14.2245817,15.0613565 C13.1653929,14.47262 11.7374379,14.0470977 10.2501148,14.0036638 L10,14 C6.99322656,14\n                    4.15741327,15.599305 4.00632239,17.0117116 L4,17.1289412 L4,19 L11.999,19 L11.999,21 L2,21 L2,17.1289412\n                    C2,14.0518668 6.3678026,12 10,12 Z M14,18.7500547 C14,17.5186246 15.2166041,16.5934203 16.5888385,16.2033252\n                    C16.6065376,16.1988069 16.6235575,16.1940388 16.6406004,16.189354 C16.8009771,16.1449634 16.9640407,16.1082171\n                    17.1273547,16.0792138 C17.1539545,16.0745886 17.1802984,16.0701045 17.206643,16.0658242 C17.3757022,16.0383342\n                    17.5446407,16.0192869 17.711667,16.0089943 C17.7168253,16.0086798 17.7218141,16.00838 17.7268012,16.0080882\n                    L17.7396132,16.007353 C17.8270537,16.0024705 17.9139398,16 18,16 C19.8160987,16 22,17.1001775 22,18.7500547\n                    L22,21 L14,21 L14,18.7500547 Z M18,11.5 C19.1045695,11.5 20,12.3954305 20,13.5 C20,14.6045695 19.1045695,15.5\n                    18,15.5 C17.8389019,15.5 17.6822525,15.480953 17.5321808,15.4449881 L17.5331904,15.4452298 L17.4809601,15.4319899\n                    C17.4530802,15.4245186 17.4254407,15.4164598 17.3980556,15.4078277 L17.5331904,15.4452298 C17.4702695,15.4301855\n                    17.4085037,15.4121675 17.3480497,15.3913328 C17.3155068,15.3801128 17.2835659,15.3681662 17.2520238,15.3554387\n                    C17.2395094,15.3503883 17.2271417,15.3452508 17.2148374,15.3399936 C17.1791527,15.3247512 17.1438051,15.3084033\n                    17.1090332,15.2910726 C17.0983207,15.2857334 17.0876517,15.2802952 17.0770386,15.2747646 C17.0471066,15.2591634\n                    17.017768,15.242915 16.9888926,15.2259626 C16.9708893,15.2153951 16.9529212,15.2044628 16.935142,15.1932583\n                    C16.9129781,15.1792948 16.8908776,15.1647504 16.8690885,15.1497855 C16.8497672,15.1365128 16.8308485,15.1230261\n                    16.8121786,15.1092223 C16.7913658,15.0938327 16.7709324,15.0781052 16.7508169,15.0619972 C16.7324412,15.0472841\n                    16.7142487,15.0321828 16.6963323,15.0167695 C16.5475102,14.8887806 16.4175518,14.7389884 16.3115537,14.5724557\n                    C16.3028356,14.5587652 16.2940615,14.5445998 16.2854607,14.5303181 C16.2696625,14.5040761 16.2545927,14.4777057\n                    16.2401144,14.4509683 C16.2314834,14.4350255 16.2231502,14.4191249 16.2150265,14.4031002 C16.1994636,14.3723993\n                    16.184687,14.3412824 16.1707024,14.3097362 C16.1651637,14.2972494 16.1595801,14.2842918 16.1541304,14.2712643\n                    C16.1401466,14.2378231 16.1271379,14.2041822 16.1150266,14.170116 C16.1102515,14.1566821 16.1056587,14.143311\n                    16.1012045,14.1298767 C16.0893763,14.0942186 16.0784496,14.057838 16.0685466,14.0210378 C16.0636931,14.0029817\n                    16.0592183,13.985377 16.0549787,13.9676808 C16.0486758,13.9413805 16.0428648,13.9147377 16.0375906,13.8879024\n                    C16.0348149,13.8737889 16.0321453,13.8593788 16.029631,13.8449155 C16.0102139,13.7335555 16,13.6179706 16,13.5\n                    C16,12.3954305 16.8954305,11.5 18,11.5 Z M10,4 C11.9329966,4 13.5,5.56700338 13.5,7.5 C13.5,9.43299662 11.9329966,11 10,11\n                    C8.06700338,11 6.5,9.43299662 6.5,7.5 C6.5,5.56700338 8.06700338,4 10,4 Z M10,6 C9.17157288,6 8.5,6.67157288 8.5,7.5\n                    C8.5,8.32842712 9.17157288,9 10,9 C10.8284271,9 11.5,8.32842712 11.5,7.5 C11.5,6.67157288 10.8284271,6 10,6 Z",id:"形状结合",fill:"url(#linearGradient-4)",fillRule:"nonzero"}))),tips:function(e){return n.getSummary(e)}},{content:i.a.createElement("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",version:"1.1"},i.a.createElement("defs",null,i.a.createElement("linearGradient",{x1:"100%",y1:"17.2296249%",x2:"0%",y2:"82.7703751%",id:"linearGradient-5"},i.a.createElement("stop",{stopColor:"#81868F",offset:"0%"}),i.a.createElement("stop",{stopColor:"#464D5A",offset:"100%"}))),i.a.createElement("g",{id:"titlebar/authority/visible",stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},i.a.createElement("rect",{id:"矩形",x:"0",y:"0",width:"24",height:"24"}),i.a.createElement("path",{d:"M10,12 C10.8340432,12 11.706873,12.1081901 12.5566997,12.3121398 C11.8210755,12.7738238\n                    11.1461542,13.3473052 10.5514188,14.0166701 L10.2501148,14.0036638 L10,14 C6.99322656,14\n                    4.15741327,15.599305 4.00632239,17.0117116 L4,17.1289412 L4,19 L10.378334,19.0009076\n                    C11.0545231,19.8048574 11.8429226,20.4800738 12.7118758,21.0010208 L2,21 L2,17.1289412\n                    C2,14.0518668 6.3678026,12 10,12 Z M17.0645932,13 C19.5392001,13 21.7196602,14.4328147\n                    23,16.6090261 C21.7190588,18.7853629 19.5388588,20.2177825 17.0645932,20.2177825\n                    C14.5899863,20.2177825 12.4095262,18.7849677 11.1291864,16.6087564 C12.4101277,14.4324196\n                    14.5903276,13 17.0645932,13 Z M17.0648979,14.3709946 C15.8041322,14.3709946 14.7820797,15.3808418\n                    14.7820797,16.6265516 C14.7820797,17.8722613 15.8041322,18.8821086 17.0648979,18.8821086 C18.3256636,18.8821086\n                    19.3477162,17.8722613 19.3477162,16.6265516 C19.3477162,15.3808418 18.3256636,14.3709946 17.0648979,14.3709946\n                    Z M17.0499566,15.3147064 C17.8063984,15.3147064 18.4196157,15.9206147 18.4196157,16.6680406 C18.4196157,17.4154664\n                    17.8063984,18.0213748 17.0499566,18.0213748 C16.2935147,18.0213748 15.6802974,17.4154664 15.6802974,16.6680406\n                    C15.6802974,15.9206147 16.2935147,15.3147064 17.0499566,15.3147064 Z M10,4 C11.9329966,4 13.5,5.56700338 13.5,7.5\n                    C13.5,9.43299662 11.9329966,11 10,11 C8.06700338,11 6.5,9.43299662 6.5,7.5 C6.5,5.56700338 8.06700338,4 10,4 Z M10,6\n                    C9.17157288,6 8.5,6.67157288 8.5,7.5 C8.5,8.32842712 9.17157288,9 10,9 C10.8284271,9 11.5,8.32842712 11.5,7.5 C11.5,6.67157288\n                    10.8284271,6 10,6 Z",id:"形状",fill:"url(#linearGradient-5)",fillRule:"nonzero"}))),tips:function(){return"所有人可查看"}},{content:i.a.createElement("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",version:"1.1"},i.a.createElement("defs",null,i.a.createElement("linearGradient",{x1:"100%",y1:"14.8613313%",x2:"0%",y2:"85.1386687%",id:"linearGradient-6"},i.a.createElement("stop",{stopColor:"#81868F",offset:"0%"}),i.a.createElement("stop",{stopColor:"#464D5A",offset:"100%"}))),i.a.createElement("g",{id:"titlebar/authority/edit",stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},i.a.createElement("rect",{id:"矩形备份",x:"0",y:"0",width:"24",height:"24"}),i.a.createElement("path",{d:"M17.1272192,13.2263731 L20.783921,15.8644155 L18.0978094,19.7175968 L18,19.752 L14.539,21\n                    L14.3953513,21.052011 L14.3974525,17.1189907 L17.1272192,13.2263731 Z M10,12 C11.5935959,12\n                    13.3287916,12.3949724 14.7745777,13.0982104 L13.6117206,14.7572579 C12.6431128,14.3302531\n                    11.466467,14.0391846 10.2501148,14.0036638 L10,14 C6.99322656,14 4.15741327,15.599305\n                    4.00632239,17.0117116 L4,17.1289412 L4,19 L12.396,19 L12.395,21 L2,21 L2,17.1289412\n                    C2,14.0518668 6.3678026,12 10,12 Z M18.6892215,11 L22.3407965,13.6314943 L21.3718504,15.019906\n                    L17.7221169,12.3772603 L18.6892215,11 Z M10,4 C11.9329966,4 13.5,5.56700338 13.5,7.5 C13.5,9.43299662\n                    11.9329966,11 10,11 C8.06700338,11 6.5,9.43299662 6.5,7.5 C6.5,5.56700338 8.06700338,4 10,4 Z M10,6\n                    C9.17157288,6 8.5,6.67157288 8.5,7.5 C8.5,8.32842712 9.17157288,9 10,9 C10.8284271,9 11.5,8.32842712\n                    11.5,7.5 C11.5,6.67157288 10.8284271,6 10,6 Z",id:"形状结合",fill:"url(#linearGradient-6)",fillRule:"nonzero"}))),tips:function(){return"所有人可编辑"}}],n.componentDidMount=function(){n.container=i.a.createElement("div",{id:"coorperation-container",style:{height:"100%",position:"relative"}}),window.addEventListener("changePermission",(function(){n.permissionButtonClickHandler({onClose:function(){n.drawerService.closeRightDrawer(),n.props.handler&&n.props.handler.handleShare()}})})),n.props.handler&&(n.props.handler.policyListener=function(e){var t=n.policies[e.policy];void 0!==t?n.setState({tooltip:t.tips(e.memlist),content:t.content}):g.Logger.error(e)})},n.permissionButtonClickHandler=function(e){void 0===e&&(e={}),c.ReportHelper.tdwReport({opername:"doc_menubar",module:"cooperation_button",action:"click"}),n.isOpend?n.drawerService.closeRightDrawer():(n.drawerService.showRightDrawer({content:n.container,style:{paddingTop:0},onOpen:function(){n.module?n.showCooperation(e):n.scriptLoader.getScriptLoader().load("CooperationV2",(function(t){n.module=t,n.showCooperation(e)}));n.workbench.emit("$humtransDone")},onClose:function(){n.module&&n.module.remove(!0),n.isOpend=!1}}),n.isOpend=!0)},n.getShareUrl=function(){var e=n.context.clientVars.shortLink||window.location.href.split("#")[0];if(-1===e.indexOf("?"))return e;var t=e.split("?")[1],o=e.split("?")[0];return t?o:e},n.refreshPolicy=function(){Aa.getPolicy(n.context.clientVars).then((function(e){var t=n.policies[e.policy];n.setState({tooltip:t.tips(e.memlist),content:t.content})}))},n.shouldShowPermissionButton=function(){var e=n.context.clientVars;return 4&e.rightFlag&&(e.isTimOnline||e.isMac)};var o=n.contextService.context.clientVars;return n.state={tooltip:n.policies[o.policy].tips([]),content:n.policies[o.policy].content},n}return as(t,e),t.prototype.componentWillUnmount=function(){this.module=null},t.prototype.showCooperation=function(e){var t=this,n=this.context.clientVars,o=n.globalPadId,r=o.indexOf("$"),i=o.slice(0,r);this.props.handler&&this.props.handler.hideShare(),this.module.init(document.getElementById("coorperation-container"),ss({invokeFrom:"Root",padId:n.padId,owner:{name:n.userName,avatar:n.userPic,type:"owner",uin:n.uin},domainId:i,creatorDomain:n.creatorDomain,shareLink:this.getShareUrl(),shareTitle:function(){return t.context.store.getValue("docTitle")},shareDocType:n.padType,onAuthUpdated:function(e){var n=t.policies[e.policy];t.setState({tooltip:n.tips(e.memlist),content:n.content})},onShare:function(){t.props.handler&&t.props.handler.handleShare()},onClose:function(){t.drawerService.closeRightDrawer()},showAdvPermissionsCmp:!1},e)),this.workbench.emit("$humtransDone")},t.prototype.getSummary=function(e){var t="暂未邀请他人一起协作";if(e&&e.length>0){var n=e[0].nick||"";n.length>8&&(n=n.substr(0,8),n+="..."),t="与"+(n+(e.length>1?"等"+e.length+"人":""))+"一起协作"}return t},t.prototype.render=function(){var e=this.context,t=e.clientVars,n=e.permission;return t.isLogin&&this.shouldShowPermissionButton()&&n.isEditable?i.a.createElement("div",null,i.a.createElement("div",{className:Ja.a["permission-icon-button"],onClick:this.permissionButtonClickHandler},i.a.createElement(Ge.a,{title:this.state.tooltip,className:Ja.a["header-extra-element"]},this.state.content))):null},t.contextType=m.h,cs([Object(m.l)(),ls("design:type",m.B)],t.prototype,"workbench",void 0),cs([Object(m.l)(),ls("design:type",m.f)],t.prototype,"contextService",void 0),cs([Object(m.l)(),ls("design:type",m.g)],t.prototype,"drawerService",void 0),cs([Object(m.l)(),ls("design:type",X.a)],t.prototype,"scriptLoader",void 0),t}(r.Component),us=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},ds=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},hs=function(){function e(e,t,n,o,r){var a=this;this.store=e,this.widgetService=t,this.workbench=r,this.getShareUrl=function(){var e=a.context.clientVars.shortLink||window.location.href.split("#")[0];if(-1===e.indexOf("?"))return e;var t=e.split("?")[1],n=e.split("?")[0];return t?n:e},this.hideShare=function(){a.module&&a.module.hide()},this.slr=this.scriptLoaderService.getScriptLoader(),this.store.register("shareContainerShow",!1),this.context=o.context,n.hydrate("titlebar-policy-button",i.a.createElement(ps,{handler:this})),n.hydrate("titlebar-share-button",i.a.createElement(is,{handler:this})),r.listen("$policyUpdated",(function(e){a.policyListener&&a.policyListener(e)}))}return e.prototype.$onInit=function(){this.widgetService.float({name:"share-container",component:i.a.createElement(ts,null)})},e.prototype.$beforeDestroy=function(){this.widgetService.remove("share-container","float")},e.prototype.handleShare=function(){var e=this;this.store.update("shareContainerShow",!0);var t=this.context.clientVars;this.module?this.module.show({onAuthUpdated:function(t){e.workbench.emit("$policyUpdated",t)},onClose:function(){e.store.update("shareContainerShow",!1)}}):(this.slr.load("Share",(function(n){var o=t.globalPadId,r=o.indexOf("$"),i=o.slice(0,r);e.module=n,n.init(document.getElementById("shareContainer"),{invokeFrom:"Root",padId:t.padId,shareLink:e.getShareUrl(),shareTitle:function(){return e.store.getValue("docTitle")},shareDocType:t.padType,domainId:i,creatorDomain:t.creatorDomain,havePermission:4&t.rightFlag,onAuthUpdated:function(t){e.policyListener&&e.policyListener(t)},onClose:function(){e.store.update("shareContainerShow",!1)}})}),(function(){e.store.update("shareContainerShow",!1)})),this.workbench.emit("$humtransDone"))},us([Object(m.l)(),ds("design:type",X.a)],e.prototype,"scriptLoaderService",void 0),e=us([Object(m.i)({name:y.a.Share,scope:1}),ds("design:paramtypes",[m.x,m.A,it.a,m.f,m.B])],e)}(),fs=n(277),ms=n(375),gs=n.n(ms),ys=function(){return i.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",version:"1.1"},i.a.createElement("defs",null,i.a.createElement("linearGradient",{x1:"100%",y1:"0%",x2:"0%",y2:"100%",id:"linearGradient-2"},i.a.createElement("stop",{stopColor:"#81868F",offset:"0%"}),i.a.createElement("stop",{stopColor:"#464D5A",offset:"100%"}))),i.a.createElement("g",{id:"titlebar/slide/show",stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},i.a.createElement("g",{id:"演示备份-2"},i.a.createElement("g",{id:"slideshow-24px"},i.a.createElement("g",null,i.a.createElement("polygon",{id:"路径",points:"0 0 24 0 24 24 0 24"}))),i.a.createElement("path",{d:"M12,2.5 C17.2467051,2.5 21.5,6.75329488 21.5,12 C21.5,17.2467051 17.2467051,21.5 12,21.5\nC6.75329488,21.5 2.5,17.2467051 2.5,12 C2.5,6.75329488 6.75329488,2.5 12,2.5 Z M12,4.5 C7.85786438,4.5\n4.5,7.85786438 4.5,12 C4.5,16.1421356 7.85786438,19.5 12,19.5 C16.1421356,19.5 19.5,16.1421356 19.5,12\nC19.5,7.85786438 16.1421356,4.5 12,4.5 Z M10.3,8.74650195 C10.3570552,8.74650195 10.4129274,8.76277196\n10.4610626,8.7934035 L15.1022739,11.7469016 C15.2420563,11.835854 15.2832621,12.0212802 15.1943097,12.1610626\nC15.1707361,12.1981069 15.1393181,12.2295248 15.1022739,12.2530984 L10.4610626,15.2065965 C10.3212802,15.2955489\n10.135854,15.2543431 10.0469016,15.1145607 C10.01627,15.0664254 10,15.0105533 10,14.9534981 L10,9.04650195\nC10,8.88081652 10.1343146,8.74650195 10.3,8.74650195 Z",id:"形状",fill:"url(#linearGradient-2)",fillRule:"nonzero"}))))},vs=function(){return i.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",version:"1.1"},i.a.createElement("defs",null,i.a.createElement("linearGradient",{x1:"100%",y1:"0%",x2:"0%",y2:"100%",id:"linearGradient-2"},i.a.createElement("stop",{offset:".077%",stopColor:"#0DA0FF"}),i.a.createElement("stop",{offset:"100%",stopColor:"#0059F8"}))),i.a.createElement("g",{id:"titlebar/slide/show",stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},i.a.createElement("g",{id:"演示备份-2"},i.a.createElement("g",{id:"slideshow-24px"},i.a.createElement("g",null,i.a.createElement("polygon",{id:"路径2",points:"0 0 24 0 24 24 0 24"}))),i.a.createElement("path",{d:"M12,2.5 C17.2467051,2.5 21.5,6.75329488 21.5,12 C21.5,17.2467051 17.2467051,21.5 12,21.5\n    C6.75329488,21.5 2.5,17.2467051 2.5,12 C2.5,6.75329488 6.75329488,2.5 12,2.5 Z M12,4.5 C7.85786438,4.5\n    4.5,7.85786438 4.5,12 C4.5,16.1421356 7.85786438,19.5 12,19.5 C16.1421356,19.5 19.5,16.1421356 19.5,12\n    C19.5,7.85786438 16.1421356,4.5 12,4.5 Z M10.3,8.74650195 C10.3570552,8.74650195 10.4129274,8.76277196\n    10.4610626,8.7934035 L15.1022739,11.7469016 C15.2420563,11.835854 15.2832621,12.0212802 15.1943097,12.1610626\n    C15.1707361,12.1981069 15.1393181,12.2295248 15.1022739,12.2530984 L10.4610626,15.2065965 C10.3212802,15.2955489\n    10.135854,15.2543431 10.0469016,15.1145607 C10.01627,15.0664254 10,15.0105533 10,14.9534981 L10,9.04650195\n    C10,8.88081652 10.1343146,8.74650195 10.3,8.74650195 Z",id:"形状",fill:"url(#linearGradient-2)",fillRule:"nonzero"}))))},bs=n(53),Cs=n.n(bs),_s=n(111),ws=n.n(_s),Rs=n(378),Ss=n.n(Rs),Es=function(e){var t=e.handleLocalPresentation,n=e.handleRemotePresentation,o=e.remoteMemberCount,r=void 0===o?-1:o,a=e.disableRemotePresentation,s=e.disabled;return i.a.createElement(Cs.a,{style:{height:"auto",width:180}},i.a.createElement(Cs.a.Item,{id:"local-presentation",onClick:t,disabled:s},"本地播放"),i.a.createElement(ws.a,null),i.a.createElement(Cs.a.Item,{id:"remote-presentation",style:{display:"flex",flexDirection:"column",height:"auto",alignItems:"flex-start"},onClick:n,disabled:a||s},i.a.createElement("p",null,"开始远程演示"),0===r&&i.a.createElement("p",{className:Ss.a["presentation-status"]},"等待收看者加入"),r>0&&i.a.createElement("p",{className:Ss.a["presentation-status"]},r,"人正在等待观看")))},Ts=n(377),Ps=n.n(Ts),Is=function(e){var t=e.children,n=e.onClose;return i.a.createElement("div",{className:Ps.a["dialog-wrapper"]},i.a.createElement("div",{className:Ps.a["top-tip"]}),i.a.createElement("button",{"aria-label":"Close",className:Ps.a["modal-close"],onClick:function(){return n&&n()}},i.a.createElement("span",{className:Ps.a["modal-close-x"]})),i.a.createElement("div",{className:Ps.a["modal-content"]},t))},xs=n(376),Os=n.n(xs),Ls=function(e){var t=e.onClose,n=e.onInvite;return i.a.createElement(Is,{onClose:t},i.a.createElement("h1",null,"欢迎使用远程演示"),i.a.createElement("p",null,"手机电脑同步观看，语音讨论更加高效"),i.a.createElement("div",{className:Os.a["guide-image"]}),i.a.createElement(H.a,{type:"primary",size:"large",onClick:n,style:{width:240}},"邀请好友"))},Ms=Object(m.D)(["roomId"])((function(e){var t=e.onClose,n=e.onCopy,o=e.startRemotePresentation,a=e.stopInvite,s=e.changeFlipAuth,c=e.roomId,l=Object(r.useRef)(null),p=Object(r.useMemo)((function(){return Object(M.c)().collab_client_vars.client.upid}),[]),u=Object(r.useMemo)((function(){return"https://docs.qq.com/meeting/"+p+"?id="+c}),[p,c]);return Object(r.useEffect)((function(){l.current&&Wa.a.create(l.current,u,!0,{height:120,width:120})}),[u]),i.a.createElement(Is,{onClose:function(){return t&&t()}},i.a.createElement("h1",null,"邀请好友加入"),i.a.createElement("div",{ref:l,style:{height:120,width:120,marginTop:12}}),i.a.createElement("div",{style:{marginTop:20,display:"inline-flex"}},i.a.createElement(U.a,{value:u,style:{width:192,height:32}}),i.a.createElement(H.a,{style:{height:34,width:74,marginLeft:-2},onClick:function(){return n(u)}},"复制链接")),i.a.createElement(H.a,{type:"primary",size:"large",style:{width:240,marginTop:20},onClick:function(){o&&o()}},"开始远程演示"),i.a.createElement(H.a,{type:"default",size:"large",style:{width:240,marginTop:12},onClick:function(){a&&a()}},"关闭邀请"),i.a.createElement(ii.a,{defaultChecked:!0,style:{marginTop:20},onChange:function(e){return s(e)}},"允许观看者翻看文档全文"))})),Ns=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)a.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return a},As=function(e){var t=e.onClick,n=e.active,o=e.focus,a=e.onMouseEnter,s=void 0===a?function(){}:a,c=e.onMouseLeave,l=void 0===c?function(){}:c,p=Ns(Object(r.useState)(!1),2),u=p[0],d=p[1];return i.a.createElement(Ge.a,{title:"播放",key:"titlebar-presentation-button",visible:!o&&u},i.a.createElement("div",{className:gs.a["presentation-button"]+" "+(o?gs.a.focus:""),onClick:function(e){t(e),d(!1)},onMouseEnter:function(){d(!0),s()},onMouseLeave:function(){d(!1),l()}},n?i.a.createElement(vs,null):i.a.createElement(ys,null)))};!function(e){e[e.None=0]="None",e[e.Menu=1]="Menu",e[e.Guide=2]="Guide",e[e.Invite=3]="Invite"}(es||(es={}));var Ds=Object(m.D)(["waitingForRemotePresentation","menuActive","menuHover","menuLastHover","isPresentationDisabled"])((function(e){var t,n,o=e.handler,a=e.waitingForRemotePresentation,s=e.menuActive,c=e.menuHover,l=e.menuLastHover,p=e.isPresentationDisabled,u=Ns(Object(r.useState)(es.None),2),d=u[0],h=u[1],f=Object(r.useContext)(m.h);return d===es.Guide?i.a.createElement("div",{id:"presentationGuideDialog"},i.a.createElement(Ge.a,{trigger:"click",title:i.a.createElement(Ls,{onClose:function(){return h(es.None)},onInvite:function(){a||o.createShowRoom((function(){h(es.None)})),h(es.Invite)}}),defaultVisible:d===es.Guide,onVisibleChange:function(e){return!e&&h(es.None)}},i.a.createElement(As,{focus:!0,active:!1,onClick:function(){h(es.None)}}))):d===es.Invite?i.a.createElement("div",{id:"presentationInviteDialog"},i.a.createElement(Ge.a,{trigger:"click",title:i.a.createElement(Ms,{onClose:function(){return h(es.None)},onCopy:function(e){return o.copyLiveLink(e)},startRemotePresentation:function(){o.startLiving(),h(es.None)},stopInvite:function(){o.closeShowRoom(),h(es.None)},changeFlipAuth:function(e){o.setAllowFlip(e)}}),defaultVisible:d===es.Invite,onVisibleChange:function(e){return!e&&h(es.None)}},i.a.createElement(As,{focus:!0,active:!0,onClick:function(){h(es.None)}}))):i.a.createElement("div",{id:"presentationMenu"},i.a.createElement(wt.a,{animated:!1,dropContent:i.a.createElement(Es,{disabled:p,handleLocalPresentation:function(){h(es.None),o.showPresentation()},handleRemotePresentation:function(){h(a?es.Invite:es.Guide)},disableRemotePresentation:!(null===(n=null===(t=o.context)||void 0===t?void 0:t.permission)||void 0===n?void 0:n.canEdit),remoteMemberCount:a?o.getMemberCount():-1}),visible:s&&"presentation"===l,onVisibleChange:function(e){e?(f.store.update("menuActive",!0),f.store.update("menuHover","presentation"),f.store.update("menuLastHover","presentation")):(f.store.update("menuActive",!1),f.store.update("menuHover","none"))}},i.a.createElement(As,{active:a,onClick:function(){h(d===es.None?es.Menu:es.None)},focus:s&&"presentation"===l&&("presentation"===c||"none"===c),onMouseEnter:function(){f.store.update("menuLastHover","presentation"),f.store.update("menuHover","presentation")},onMouseLeave:function(){f.store.update("menuHover","none")}})))})),ks=[{keyBindings:{win:c.KeyCode.PAGE_UP,mac:c.KeyCode.PAGE_UP},callback:function(e,t){t&&t.moveToPrePage()}},{keyBindings:{win:c.KeyCode.PAGE_DOWN,mac:c.KeyCode.PAGE_DOWN},callback:function(e,t){t&&t.moveToNextPage()}},{keyBindings:{win:c.KeyCode.ARROW_UP,mac:c.KeyCode.ARROW_UP},callback:function(e,t){t&&t.moveToPreLine()},shouldPreventDefault:!1},{keyBindings:{win:c.KeyCode.ARROW_DOWN,mac:c.KeyCode.ARROW_DOWN},callback:function(e,t){t&&t.moveToNextLine()},shouldPreventDefault:!1},{keyBindings:{win:c.KeyCode.ARROW_LEFT,mac:c.KeyCode.ARROW_LEFT},callback:function(e,t){t&&t.moveToPrePage()},shouldPreventDefault:!1},{keyBindings:{win:c.KeyCode.ARROW_RIGHT,mac:c.KeyCode.ARROW_RIGHT},callback:function(e,t){t&&t.moveToNextPage()},shouldPreventDefault:!1},{keyBindings:{win:c.KeyCode.ESCAPE,mac:c.KeyCode.ESCAPE},callback:function(e,t){t&&t.hidePresentation()},shouldPreventDefault:!1}],js=n(380),Fs=n.n(js),Hs=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Bs=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.shouldShowPresentationButton=function(){return!g.PlatformUtil.isIE()},t}return Hs(t,e),t.prototype.enterLocalMode=function(){this.props.handler&&this.props.handler.showPresentation()},t.prototype.render=function(){var e=this;return this.shouldShowPresentationButton()?i.a.createElement("div",{className:Ae.a["statusbar-simple-button"]},i.a.createElement(Ge.a,{placement:"top",title:"开始播放"},i.a.createElement("div",{className:Fs.a["play-button"]+" "+Ae.a["small-button"],onClick:function(){e.enterLocalMode()}}))):null},t}(i.a.Component),Us=[{name:"play",content:i.a.createElement(Bs,null)}],Vs=n(307),Ws=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Gs=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},zs=function(){function e(e,t,n,o){var r=this;this.titlebar=e,this.store=n,this.surfaceService=o,this.createSurface=function(){r.surfaceService.create("float",void 0,{background:"#ffffff",overflowX:"hidden",overflowY:"auto",width:0,height:0,top:0,left:0,position:"fixed"}).then((function(e){var t=e.id;r.surfaceId=t}))},this.context=t.context,this.store.register("roomId",""),this.store.register("waitingForRemotePresentation",!1),this.store.register("isPresentationDisabled",!1),this.titlebar.hydrate("titlebar-presentation-button",i.a.createElement(Ds,{handler:this})),this.createSurface()}return e.prototype.showLoading=function(){var e=document.getElementById("grid-float"),t=document.createElement("div"),n=e.querySelector("div[class^=scrollable]");t.id="presentation-loading",n.appendChild(t),s.a.render(i.a.createElement(Vs.a,null),t)},e.prototype.makeSurfaceFullscreen=function(){var e=document.getElementById("grid-float");e.style.bottom="0",e.style.right="0",e.style.width="100%",e.style.height="100%";var t=this.context.getHandler(fo.a),n=e.querySelector("div[class^=scrollable]");n.style.width="100%",n.style.height="100%",n.style.top="0",n.style.left="0",n.style.position="absolute",t&&t.requestFullScreen(document.documentElement),this.showLoading()},e.prototype.$onInit=function(e){this.editor=e},e.prototype.$onDisable=function(){this.store.update("isPresentationDisabled",!0)},e.prototype.$onEnable=function(){this.store.update("isPresentationDisabled",!1)},e.prototype.showPresentation=function(){var e=this;this.makeSurfaceFullscreen(),this.presentationCtrl?this.presentationCtrl.startLocalPresentation(this.surfaceId):this.dynamicImportPresentation().then((function(){e.presentationCtrl.startLocalPresentation(e.surfaceId)}))},e.prototype.hidePresentation=function(){this.presentationCtrl&&this.presentationCtrl.handleEndPlay()},e.prototype.moveToNextLine=function(){this.presentationCtrl&&this.presentationCtrl.moveToNextLine()},e.prototype.moveToPreLine=function(){this.presentationCtrl&&this.presentationCtrl.moveToPreLine()},e.prototype.moveToNextPage=function(){this.presentationCtrl&&this.presentationCtrl.moveToNextPage()},e.prototype.moveToPrePage=function(){this.presentationCtrl&&this.presentationCtrl.moveToPrePage()},e.prototype.startLiving=function(){var e=this;this.makeSurfaceFullscreen(),this.presentationCtrl?this.presentationCtrl.startRemotePresentation(this.surfaceId):this.dynamicImportPresentation().then((function(){e.presentationCtrl.startRemotePresentation(e.surfaceId)}))},e.prototype.copyLiveLink=function(e){var t=this;this.presentationCtrl?this.presentationCtrl.copyLiveLink(e):this.dynamicImportPresentation().then((function(){t.presentationCtrl.copyLiveLink(e)}))},e.prototype.isOnAir=function(){return!!this.presentationCtrl&&this.presentationCtrl.isOnAir()},e.prototype.stopRemotePresentation=function(){this.presentationCtrl&&this.presentationCtrl.handleEndPlay()},e.prototype.getMemberCount=function(){return this.presentationCtrl?this.presentationCtrl.getMemberCount()-1:0},e.prototype.setAllowFlip=function(e){if(this.presentationCtrl)return this.presentationCtrl.setAllowFlip(e)},e.prototype.createShowRoom=function(e){var t=this;void 0===e&&(e=function(){}),this.presentationCtrl?this.presentationCtrl.createShowRoom(e):this.dynamicImportPresentation().then((function(){t.presentationCtrl.createShowRoom(e)}))},e.prototype.closeShowRoom=function(){this.presentationCtrl&&this.presentationCtrl.closeShowRoom()},e.prototype.dynamicImportPresentation=function(){var e=this;return fs.a.get(fs.b.Presentation).then((function(t){var n=t.PresentationController;e.presentationCtrl=new n(e.editor),e.presentationCtrl.onClose=e.createSurface,e.presentationCtrl.initContext(e.context)}))},e=Ws([Object(m.i)({name:y.a.Presentation,scope:0,for:["melo"],keymap:ks,statusbarItems:Us}),Gs("design:paramtypes",[it.a,m.f,m.x,m.y])],e)}(),Ks=(n(381),[{name:"help-and-feedback-sub-about-template",content:"关于模板",shouldHide:function(e){var t=e.clientVars;return!(t.isOwner&&t.templateInfo&&2===t.templateInfo.templateType&&t.templateInfo.templateId)},onClick:function(e,t){t.toggleTemplateInfo()}}]),qs=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Zs=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},$s=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Qs=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.dom=i.a.createRef(),t}return qs(t,e),t.prototype.componentDidMount=function(){this.props.mounted(this.dom.current)},t.prototype.render=function(){return i.a.createElement("div",{id:"Template-Panel-container"},i.a.createElement("div",{id:"Template-Panel-box",ref:this.dom}))},t}(i.a.Component),Xs=function(){function e(e,t){var n=this;this.drawerService=t,this.renderInPc=function(e){var t=document.getElementById("Template-Panel-container"),o=Object(M.c)();t&&t.appendChild(e),n.pcIninted||(n.template.initShow(e,o),w()(e).on("click","#template-info-close-button",(function(){n.drawerService.closeRightDrawer(),n.isShown=!1})),n.pcIninted=!0)},this.context=e.context,this.slr=this.scriptLoaderService.getScriptLoader(),this.container=i.a.createElement(Qs,{mounted:this.renderInPc}),this.pcIninted=!1,this.isShown=!1}return e.prototype.$beforeDestroy=function(){this.pcIninted=!1,this.isShown=!1},e.prototype.$onInit=function(){var e=this,t=this.context.clientVars,n=t.isOwner,o=t.templateInfo&&t.templateInfo.templateId,r=t.templateInfo&&2===t.templateInfo.templateType;n&&void 0!==o&&r&&this.slr.listen("SL-INIT",(function(){e.templateInit(e.toggleTemplateInfo.bind(e))}))},e.prototype.toggleTemplateInfo=function(){var e=this;Object(M.c)();this.slr.load("TemplateInfo",(function(t){if(e.isShown)return e.drawerService.closeRightDrawer(),void(e.isShown=!1);e.template=t;try{e.isShown=!0,e.drawerService.showRightDrawer({name:"templateInfo",title:"",content:e.container,style:{backgroundColor:"#fff",width:301}})}catch(e){g.Logger.error(e)}}))},e.prototype.templateInit=function(e){var t=Object(M.c)();this.getalltipflag({globalPadId:t.globalPadId,xsrf:Object(c.getXsrf)()},(function(t){0===t.createByTemplateFlag&&e()}))},e.prototype.getalltipflag=function(e,t){w.a.ajax({type:"get",url:"/ep/api/getalltipflag",data:e,success:function(e){100===e.retcode&&"function"==typeof t&&t(e)}})},Zs([Object(m.l)(),$s("design:type",X.a)],e.prototype,"scriptLoaderService",void 0),e=Zs([Object(m.i)({name:y.a.TemplateInfo,scope:1,mobileMenuItems:Ks}),$s("design:paramtypes",[m.f,m.g])],e)}(),Ys=n(382),Js=n.n(Ys),ec=n(383),tc=n.n(ec),nc=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),oc=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},rc=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},ic=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.addSuccessCb=function(){var e=t.context.getService(m.B);null!==e&&e.emit("$moveDocDone")},t.handleLogin=function(){t.workbench.emit("$requestLogin")},t}return nc(t,e),t.prototype.render=function(){var e=this.context.clientVars;return i.a.createElement("div",{className:tc.a["move-to-folder-wrapper"]},i.a.createElement(Js.a,{key:"tdocs-header-badge",domainId:e.domainId,localPadId:e.localPadId,isCreator:e.isCreator,padType:e.padType,padTitle:e.padTitle,addSuccessCb:this.addSuccessCb,isLogin:e.isLogin,doLogin:this.handleLogin}))},t.contextType=m.h,oc([Object(m.l)(),rc("design:type",m.B)],t.prototype,"workbench",void 0),t}(r.Component),ac=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},sc=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},cc=function(){function e(e,t,n){var o=this;this.contextService=e,this.workbench=t,this.notifyHumtransDone=function(){o.slr&&o.slr.dispatch("DOC_HUMTRANS_DONE")},this.slr=this.scriptLoaderService.getScriptLoader(),t.listen("$humtransDone",this.notifyHumtransDone),n.hydrate("titlebar-move-to",i.a.createElement(ic,{ref:function(e){o.moveToComponent=e}}))}return e.prototype.$afterPermissionChanged=function(){this.moveToComponent&&this.moveToComponent.forceUpdate()},ac([Object(m.l)(),sc("design:type",X.a)],e.prototype,"scriptLoaderService",void 0),e=ac([Object(m.i)({name:y.a.MoveTo,scope:1}),sc("design:paramtypes",[m.f,m.B,it.a])],e)}(),lc=n(140),pc=(n(384),Object(m.D)(["zoomLevel"])((function(e){var t=e.handler,n=e.zoomLevel,o="preview-scale-icon";return 1===n&&(o+="disable"),t?i.a.createElement("div",{id:"pcqq-preview-scalebar-contanier"},i.a.createElement("span",{id:"preview-scale-zoomout",className:"preview-scale-icon",onClick:function(){t.setZoomLevel(n-.05)}}),i.a.createElement("span",{id:"preview-scale-zoomin",className:"preview-scale-icon",onClick:function(){t.setZoomLevel(n+.05)}}),i.a.createElement("span",{id:"preview-scale-restore",className:o,onClick:function(){t.setZoomLevel(1)}})):null}))),uc=n(255),dc=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},hc=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},fc=function(){function e(e){this.zoom=e}return e.prototype.$onInit=function(){this.renderPreview()},e.prototype.renderPreview=function(){var e=this;if(p.a.getInstance().isPreview){w()("#tdocs-titlebar").hide(),w()("#workbench-toolbar").hide(),w()("#workbench-drawer").hide(),w()("#accountContainer").hide(),w()("#loginContainer").hide(),w()("#help-center").hide(),w()("#supportFrame-container").hide(),w()("#support_mask").hide(),w()("#transfer-auth-container").hide(),w()(".search-replace-container").hide(),w()("#read-record-container").hide(),w()("#shareContainer").hide(),w()("#workbench-statusbar").hide(),w()("#content-container").css({top:0,bottom:0}),w()("body").css({background:"#2b2b2b"}),w()("html").css({background:"#2b2b2b"}),w()(".surface").css({paddingTop:0,paddingLeft:0,paddingRight:0}),w()(".melo-page-view").css({background:"#2b2b2b"});var t=document.createElement("div");t.id="preview-zoombar-container",document.getElementById("padbody").appendChild(t),s.a.render(i.a.createElement(pc,{handler:this.zoom}),t),setTimeout((function(){w()("#pcqq-preview-scalebar-contanier").addClass("hidden"),e.mousemoveSub=Object(Qn.a)(document.body,"mousemove").pipe(Object(uc.a)(100)).subscribe((function(t){e.handleMousemove(t)}))}),5e3),c.ReportHelper.tdwReport({opername:"doc_core",module:"visit",action:"preview_page"})}},e.prototype.handleMousemove=function(e){var t=e.pageY;window.innerHeight-t<=window.innerHeight/4?w()("#pcqq-preview-scalebar-contanier").removeClass("hidden"):w()("#pcqq-preview-scalebar-contanier").addClass("hidden")},e.prototype.$beforeDestroy=function(){this.mousemoveSub&&this.mousemoveSub.unsubscribe()},e=dc([Object(m.i)({name:y.a.DocPreview,scope:1}),hc("design:paramtypes",[lc.a])],e)}(),mc=n(481),gc=(n(389),function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}()),yc=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return gc(t,e),t.prototype.unInit=function(){},t.prototype.isShowPanel=function(){return!0},t.prototype.startDragerApply=function(){},t.prototype.isDragEnable=function(){return this.contextService.context.editor.isEditable()},t.prototype.finishDragApply=function(e,t){if(t&&e){var n=this.contextService.context.editor,o=n.service.getDocument().findStoryInfoFromGcp(t.gcp);if((null==o?void 0:o.storyProp.storyType)===c.StoryType.MainTextStory){var r=n.service.getDocument().getTableFromGcp(e.gcp);r&&(r.moveTo(t.gcp),c.ReportHelper.tdwReport({opername:"doc_word_editor",module:"table",action:"table_move"}))}}},t.prototype.getPreviewNode=function(e){var t=document.createElement("div");t.className="table-preview";var n=0;return e&&(n=e.parentNode.clientWidth),{previewNode:t,clientWidth:n}},t.prototype.isValidPoint=function(e){return!this.selector.hasPointInTable()},t.prototype.getSelectedObject=function(e){var t=e.target;return"touchstart"===e.type&&e.touches.length&&(t=e.touches[0].target),this.isInTableIcon(t)&&this.isNodeInEditor(t)?t:null},t.prototype.isInTableIcon=function(e){return!!(e.className&&e.className.indexOf&&-1!==e.className.indexOf("table-icon")||e.parentElement&&e.parentElement.className&&e.parentElement.className.indexOf&&-1!==e.parentElement.className.indexOf("table-icon"))},t.prototype.getTableNode=function(e){for(var t=e;t;){if(t.className&&t.className.indexOf&&-1!==t.className.indexOf("melo-table-wrapper"))return t;t=t.parentElement}return t},t.prototype.getSrcViewPoint=function(e){var t=null;if(e.touches&&e.touches.length){var n=e.touches[0];t=this.getTableNode(n.target)}else t=this.getTableNode(e.target);if(t){var o=t.getBoundingClientRect();this.selector.updateStart(o.left+1,o.top+1,e.target)}return this.selector.start},t}(mc.a);function vc(e,t){var n=function(e,t){if(!Array.isArray(e))return{error:"The coefficient matrix[a] must be an array.(a = "+e+" ')"};if(!Array.isArray(t))return{error:"The constant vector[b] must be an array.(b = "+t+")"};if(!e.length)return{error:"The coefficient matrix[a] length shall not be less than 1.(a = "+e+")"};if(!t.length)return{error:"The constant vector[b] length shall not be less than 1.(b = "+t+")"};if(e.length!==t.length)return{error:"The coefficient matrix[a] and constant vector[b] length must be equal."};for(var n=t.length,o=0;o<n;o++){if(!e[o]||!Array.isArray(e[o]))return{error:"The coefficient matrix[a] row must be array. (a["+o+"] = "+e[o]+")"};for(var r=0;r<n;r++)if(!isFinite(e[o][r]))return{error:"The coefficient matrix[a] element is NaN or Infinity. (a["+o+"]["+r+"] = "+e[o][r]+")"};if(!isFinite(t[o]))return{error:"The constant vector[b] element is NaN or Infinity. (b["+o+"] = "+t[o]+")"}}return null}(e,t);if(n)return n;for(var o,r,i,a,s=t.length,c=[],l=0;l<s;l++){o=l,r=e[l][l];for(var p=l;p<s;p++)i=e[p][l],Math.abs(i)>Math.abs(r)&&(r=i,o=p);if(0===r)return{error:"The linear equations have no solution or multiple solutions."};o!==l&&(a=e[l],e[l]=e[o],e[o]=a,a=t[l],t[l]=t[o],t[o]=a);for(var u=l+1;u<s;u++){i=e[u][l]/r;for(var d=l;d<s;d++)e[u][d]-=e[l][d]*i;t[u]-=t[l]*i}}c[s-1]=t[s-1]/e[s-1][s-1];for(l=s-2;l>=0;l--){a=0;for(p=l+1;p<s;p++)a+=e[l][p]*c[p];c[l]=(t[l]-a)/e[l][l]}return{value:c}}function bc(e,t,n){for(var o=e[t][n].prop,r=0;r<o.rowSpan;r++)for(var i=0;i<o.colSpan;i++)if(0!==r||0!==i){e[t+r]||e.push([]);var a=e[t+r],s={prop:o.clone(),cell:null,computedStyle:null};s.prop.isMerged=!0,s.prop.rowSpan=-1,s.prop.colSpan=-1,a[n+i]=s}}var Cc={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#0ff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000",blanchedalmond:"#ffebcd",blue:"#00f",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",burntsienna:"#ea7e5d",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#0ff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#f0f",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#789",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#0f0",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#f0f",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#f00",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#fff",whitesmoke:"#f5f5f5",yellow:"#ff0",yellowgreen:"#9acd32"};function _c(e){if(e&&e.toLowerCase().startsWith("#")){var t=parseInt("0x"+e.slice(1),16);return.299*(16711680&t)+.578*(65280&t)+.114*(255&t)}return"transparent"===e?16777215:0}function wc(e,t){return e===t?0:_c(e)<=_c(t)?1:-1}function Rc(e){return"string"!=typeof e?null:"transparent"===e||"none"===e?"transparent":"#"===e[0]?e:e.toLowerCase().startsWith("rgb")?function(e){var t=e.toString().match(/\d*(\.*)\d+/g);if(!t||t.length<3)return"#000";var n=1;if(t&&t[3]&&(n=Number(t[3])),0===n)return"transparent";for(var o="#",r=0;r<3;r++)o+=1===n?("0"+Number(t[r]).toString(16)).slice(-2):("0"+(Number(t[r])*n+255*(1-n)).toString(16)).slice(-2);return o}(e):Cc[t=e]?Cc[t]:null;var t}function Sc(e,t,n){var o=e.length,r=e[0]?e[0].length:0;if(t>=o||n>r||!e[t][n].isMerged)return{row:t,col:n};for(var i=0;i<t;i++)for(var a=0;a<n;a++){var s=e[i][a];if(s.rowSpan+i-1>=t&&s.colSpan+a-1>=n)return{row:i,col:a}}return{row:t,col:n}}var Ec=function(){function e(){}return e.isMsoTable=function(e){if("table"===c.NodeUtil.getTagName(e).toLowerCase()){var t=c.NodeUtil.getProp(e,"className");if(t)return-1!==t.indexOf("Mso")&&-1!==t.indexOf("Table")}return!1},e.cellDefaultStyleFromMso=function(e,t){t.isPasteFromMsoTable&&(e.set("font-size","14px"),e.set("line-height","100%"),e.set("font-family","宋体"))},e}(),Tc=function(){function e(){}return e.isSplitlineOperation=function(e){if(e instanceof c.InsertOperation&&e.param.spanProperty instanceof c.SplitlineProperty)return!0;return!1},e.isNumberingOperation=function(e){if(e instanceof c.InsertParaOperation&&e.param.paraProperty instanceof c.NumberingProperty)return!0;return!1},e.isTableCellStart=function(e){if(e instanceof c.InsertParaOperation&&e.param.spanProperty instanceof c.TableCellStartSpan)return!0;return!1},e.findClosestParagraph=function(e){if(!e)return null;for(var t=e.length-1;t>=0;t--){var n=e[t];if(this.isTableCellStart(n))return null;if(n instanceof c.InsertParaOperation&&!this.isNumberingOperation(n))return t-1>=0&&this.isSplitlineOperation(e[t-1])?null:{operation:n,index:t};if(!(n instanceof c.InsertParaOperation))return null}return null},e}(),Pc=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Ic=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)a.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return a},xc=function(){function e(){}return e.parseTableStyles=function(t){var n=new Map,o=window.getComputedStyle(t),r=e.parseNodeBGColor(t,o);return r&&n.set("background-color",r),n},e.parseCellProp=function(e,t,n){var o=new c.TableCellProperty;return o.tableDepth=1,this.parseBgColor(e,t,o,n),this.parseBorder(e,t,o),this.parseVerticalAlgin(e,t,o),this.parseMergeInfo(e,o),o},e.parseMergeInfo=function(e,t){var n=e.getAttribute("rowspan");n&&(t.rowSpan=parseInt(n,10));var o=e.getAttribute("colspan");o&&(t.colSpan=parseInt(o,10))},e.parseNodeBGColor=function(e,t){return e.style?Rc(e.style.backgroundColor||t.backgroundColor):null},e.parseBgColor=function(e,t,n,o){var r=o.get("background-color"),i=this.parseNodeBGColor(e,t);r&&i&&"transparent"!==i?n.cellcolor=i:r&&i&&"transparent"===i?n.cellcolor=r:i&&(n.cellcolor=i)},e.getBorderColor=function(e,t,n){return e&&0!==e.length||t&&0!==t.length||n&&0!==n.length?e&&parseFloat(e)<=0||"none"===t||"transparent"===n||"initial"===e||null===t||0===t.length?"transparent":n:"transparent"},e.parseBorder=function(e,t,n){var o,r,i=t,a={top:this.getBorderColor(i.borderTopWidth,i.borderTopStyle,i.borderTopColor),right:this.getBorderColor(i.borderRightWidth,i.borderRightStyle,i.borderRightColor),bottom:this.getBorderColor(i.borderBottomWidth,i.borderBottomStyle,i.borderBottomColor),left:this.getBorderColor(i.borderLeftWidth,i.borderLeftStyle,i.borderLeftColor)};try{for(var s=Pc(Object.entries(a)),c=s.next();!c.done;c=s.next()){var l=Ic(c.value,2),p=l[0],u=l[1],d=null;if(u&&(d=Rc(u)),d)switch(p){case"top":n.borderTopColor=d;break;case"right":n.borderRightColor=d;break;case"bottom":n.borderBottomColor=d;break;case"left":n.borderLeftColor=d}}}catch(e){o={error:e}}finally{try{c&&!c.done&&(r=s.return)&&r.call(s)}finally{if(o)throw o.error}}},e.parseVerticalAlgin=function(e,t,n){var o=e.style.verticalAlign||e.getAttribute("valign")||t.verticalAlign||"";n.vAlign="baseline"===o?"middle":o},e.parseProperty=function(e,t,n){var o=new c.TableProperty,r=this.parseSizeInfo(e,t,n);return o.rowHeights=r.rowHeights,o.colWidths=r.colWidths,o},e.parseSizeInfo=function(e,t,n){var o=this.parseColCount(t),r=this.parseRowCount(t),i=this.parseColWidths(this.parseTableWidth(e,n),t,o)||[],a=this.parseRowHeights(t,r)||[];return{colCount:o,rowCount:r,colWidths:i=i.map(Math.floor).map(g.pxToTwips),rowHeights:a=a.map(Math.floor).map(g.pxToTwips)}},e.parseColCount=function(e){var t=0,n=e.querySelector("tr"),o=null;return n&&(o=c.NodeUtil.getDirectElementListForTags(n,["td","th"])),o&&o.length&&(t=[].slice.call(o).reduce((function(e,t){return e+(parseInt(t.getAttribute("colspan")||"1",10)||1)}),0)),t},e.parseColWidths=function(e,t,n){var o=this.parseColWidthsByCal(e,t);return o&&o.length===n?o:null},e.parseColWidthsByCal=function(e,t){var n=this.getColWidthsAndSpanInfo(e,t),o=this.calculateColWidths(n);return o&&o.map((function(e){return e||117}))||null},e.getColWidthsAndSpanInfo=function(e,t){var n=[],o=[];if(t)for(var r=c.NodeUtil.getDirectElementListForTags(t,["tr"]).map((function(e){return c.NodeUtil.getDirectElementListForTags(e,["td","th"])})),i=[],a=r[0].reduce((function(e,t){return e+(t?Math.max(1,t.colSpan):0)}),0),s=0;s<r.length;s++){n[s]=[],o[s]=[],i[s]||i.push([]);for(var l=0,p=0;p<a;p++)if(null!==i[s][p]){var u=r[s][p-l];if(u){var d=u.colSpan,h=u.rowSpan,f=this.parseColWidth(u,e);n[s][p]=f,o[s][p]=d,i[s][p]=u;for(var m=0;m<h;m++)for(var g=0===m?1:0;g<d;g++)i[s+m]||i.push([]),i[s+m][p+g]=null}else n[s][p]=0,o[s][p]=1}else l+=1,n[s][p]=0,o[s][p]=0}return{colWidths:n,spanInfos:o}},e.parseColWidth=function(e,t){var n=e.style.width||e.width;return n.length>0?this.parseStringToNum(n,t)||e.offsetWidth||117:e.offsetWidth||117},e.parseTableWidth=function(e,t){var n=e.style.width||e.width;return n.length>0?this.parseStringToNum(n,t):e.offsetWidth},e.parseStringToNum=function(e,t){return Number.isNaN(Number(e))?e.endsWith("%")?Math.floor(parseFloat(e)/100*t):Object(g.ptToPx)(Object(g.dimensionSizeToPt)(e,parseInt(e,10)||0)):parseInt(e,10)},e.calculateColWidths=function(e){var t=e.colWidths,n=e.spanInfos;if(!t.length)return null;for(var o=t.length,r=t[0].length,i=[],a=[],s=[],c=[],l=0;l<r;l++){s[l]=0;for(var p=0;p<o;p++)if(1===n[p][l]){s[l]=t[p][l];break}0===s[l]&&c.push(l)}for(var u=0;u<c.length;u++)for(var d=c[u],h=0;h<o;h++){var f=n[h][d];if(f>1){for(var m=t[h][d],g=[],y=0;y<c.length;y++)d<=c[y]&&c[y]<d+f?g.push(1):g.push(0);for(var v=d;v<d+f;v++)m-=s[v]||0;i.push(g),a.push(m);break}}if(i.length>0){var b=vc(i,a).value;if("object"==typeof b&&b.length===c.length)for(u=0;u<b.length;u++)s[c[u]]=b[u]}return s},e.parseRowCount=function(e){return c.NodeUtil.getDirectElementListForTags(e,["tr"]).length},e.parseRowHeights=function(e,t){var n=this,o=c.NodeUtil.getDirectElementListForTags(e,["tr"]).map((function(e){var t=e.getAttribute("height"),o=e.style.height;if(t&&t.length||o&&o.length)return window.navigator.userAgent.match(/Mac\sOS\sX/i)?o&&o.length>0?n.parseStringToNum(o,0):n.parseStringToNum(t,0):t&&t.length>0?n.parseStringToNum(t,0):n.parseStringToNum(o,0);for(var r=Array.from(e.getElementsByTagName("td")),i=0;i<r.length;i++){var a=r[i].getAttribute("height");if(a&&a.length)return n.parseStringToNum(a,0);var s=r[i].style.height;if(s&&s.length)return n.parseStringToNum(s,0)}return 28}));return o.length===t?o:null},e.getBody=function(e){return e.querySelector("tbody")},e.getCells=function(e){return c.NodeUtil.getDirectElementListForTags(e,["tr"]).map((function(e){return c.NodeUtil.getDirectElementListForTags(e,["th","td"])}))},e.fixCellsMerge=function(e,t){return function(e,t){for(var n=[],o=0;o<e.rowHeights.length;o++){n.length<=o&&n.push([]);for(var r=n[o],i=t[o].length,a=0,s=0;a<e.colWidths.length&&!(a-s>=i);a++)if(n[o][a])s+=1;else{var c=t[o][a-s].prop;r[a]=t[o][a-s],(c.rowSpan>1||c.colSpan>1)&&bc(n,o,a)}}return n}(e,t)},e.fixCellsException=function(e,t){return function(e,t){for(var n=[],o=0;o<e.rowHeights.length;o++){n.push([]);for(var r=0;r<e.colWidths.length;r++)if(t[o][r])n[o].push(t[o][r]);else{var i=new c.TableCellProperty;i.tableDepth=1;var a={prop:i,cell:null,computedStyle:null};n[o].push(a)}}return n}(e,t)},e.fixCellsProp=function(e){!function(e){for(var t=e.length,n=e[0]?e[0].length:0,o=0;o<t;o++)for(var r=0;r<n;r++){var i=e[o][r];if(!i.isMerged){if(o>0){if(!(s=e[(a=Sc(e,o-1,r)).row][a.col]).has(c.TableCellPropKey.borderBottomColor)&&!i.has(c.TableCellPropKey.borderTopColor))continue;!i.has(c.TableCellPropKey.borderTopColor)||wc(s.borderBottomColor,i.borderTopColor)>0?i.borderTopColor=s.borderBottomColor:s.borderBottomColor=i.borderTopColor}if(r>0){var a,s;if(!(s=e[(a=Sc(e,o,r-1)).row][a.col]).has(c.TableCellPropKey.borderRightColor)&&!i.has(c.TableCellPropKey.borderLeftColor))continue;!i.has(c.TableCellPropKey.borderLeftColor)||wc(s.borderRightColor,i.borderLeftColor)>0?i.borderLeftColor=s.borderRightColor:s.borderRightColor=i.borderLeftColor}}}}(e)},e.getCellPasteItems=function(t,n){return t.map((function(t){return t.map((function(t){var o=window.getComputedStyle(t);return{cell:t,prop:e.parseCellProp(t,o,n),computedStyle:o}}))}))},e.parseCell=function(e,t,n,o,r,i,a,s){r.insertTableCellStart(r.currentRange().begin(),new c.TableCellStartSpan);var l=new Map;e&&(c.NodeUtil.getStyleMap(e).forEach((function(e,t){l.set(t,e)})),n&&(a.validTextAttris.forEach((function(e){var t=n[e];t&&l.set(e,t)})),a.validParaAttris.forEach((function(e){var t=n[e];t&&l.set(e,t)}))),Ec.cellDefaultStyleFromMso(l,a),l.delete("background"),l.delete("background-color"),l.delete("color"),s(e,l,r,i,a));var p=new c.TableCellBreakSpan,u=Tc.findClosestParagraph(r.operations);if(u){var d=u.operation,h=u.index;p.merge(d.param.spanProperty),t.merge(d.param.paraProperty),r.operations.splice(h,1),r.moveTo(new c.GCPRange(r.currentRange().begin()-d.changeLen,r.currentRange().len))}else{var f=Object(Ct.genParaProperty)(l);t.merge(f)}r.insertTableCellPara(r.currentRange().begin(),p,t)},e.ascertainType=function(e,t){return!!t&&(t instanceof window[e]||!!t.ownerDocument&&!!t.ownerDocument.defaultView&&t instanceof t.ownerDocument.defaultView.window[e])},e.isHTMLTableElement=function(e){return this.ascertainType("HTMLTableElement",e)},e}(),Oc=function(){return(Oc=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},Lc=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Mc=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Nc=function(){function e(){}return e.onPaste=function(e,t,n,o,r,i){if(!r.isInTable&&xc.isHTMLTableElement(e)){var a=e,s=xc.getBody(a);if(s){var l=Ec.isMsoTable(e),p=this.featureService.get(y.a.Section),u=3e3;if(p)u=((v=p.getPageSettingData()).pageWidth||c.Defaults.section.pageSize.width)-(v.marginLeft||c.Defaults.section.pageMargins.left)-(v.marginRight||c.Defaults.section.pageMargins.right);var d=xc.parseTableStyles(a),h=xc.parseProperty(a,s,Object(g.twipsToPx)(u));if(0!==h.rowHeights.length&&0!==h.colWidths.length){var f=g.StringUtil.generateRandomId();if(h.tableId=f,h.subId=c.DOC_ID,p){var m=null!==a.style.marginLeft?Object(g.ptToTwips)(Object(g.dimensionSizeToPt)(a.style.marginLeft,0)):0,v=p.getPageSettingData();h.paddingLeft=(v.marginLeft||c.Defaults.section.pageMargins.left)+(m||0),h.paddingRight=v.marginRight||c.Defaults.section.pageMargins.right}n.startCreateTable(n.currentRange().end(),h),this.parseCells(h,s,d,t,n,o,Oc(Oc({},r),{isInTable:!0,isPasteFromMsoTable:l}),i),n.endCreateTable(n.currentRange().end(),h)}}}},e.parseCells=function(e,t,n,o,r,i,a,s){var l=new c.TableRowBreakSpan,p=new c.TableRowStartSpan,u=new c.TableRowProperty;u.tableDepth=1;var d=xc.getCells(t),h=xc.getCellPasteItems(d,n);h=xc.fixCellsMerge(e,h);var f=(h=xc.fixCellsException(e,h)).map((function(e){return e.map((function(e){return e.prop}))}));xc.fixCellsProp(f),h.forEach((function(e){r.insertTableRowStart(r.currentRange().end(),p),e.forEach((function(e){xc.parseCell(e.cell,e.prop,e.computedStyle,o,r,i,a,s)})),r.insertTableRowPara(r.currentRange().end(),l,u)}))},Lc([Object(m.l)(),Mc("design:type",m.f)],e,"contextService",void 0),Lc([Object(m.l)(),Mc("design:type",m.k)],e,"featureService",void 0),e}(),Ac=function(e,t,n,o,r,i){return!!xc.isHTMLTableElement(e)&&(Nc.onPaste(e,t,n,o,r,i),!0)},Dc=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)a.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return a},kc=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(Dc(arguments[t]));return e},jc=new RegExp(c.PlaceholderChar.TableCellBreak+"|"+c.PlaceholderChar.TableCellStart+"|"+c.PlaceholderChar.TableRowBreak+"|"+c.PlaceholderChar.TableRowStart,"g"),Fc=function(e,t){for(var n=[],o=e.getBeginChild(!0);o;)n.push(o),o=o.getNextSibling(!0);return n.map((function(e){return t.parse(e)}))},Hc=function(e,t,n){return t.map((function(t){return t.map((function(t,o){return function(e,t,n){var o=t.isMerged(),r=1,i=1,a="",s="",l="",p=t.getProperty();if(p&&o)return{html:"",plain:""};p&&(r=p.rowSpan,i=p.colSpan,s=p.vAlign,l=p.hAlign,a=c.CssUtil.computeStyles(p).cssText);var u=Fc(t,e).reduce((function(e,t){return{html:e.html+t.html,plain:e.plain+t.plain}})),d='<td\n            style="'+(o?"display:none;":"")+"width:"+Object(g.twipsToPx)(n)+"px; "+a+'"\n            width='+Object(g.twipsToPx)(n)+"\n            colspan="+i+"\n            rowspan="+r+'\n            align="'+l+'"\n            valign="'+s+'"\n            >'+u.html+"</td>\n    ",h=o?"":u.plain.replace(c.PlaceholderChar.TableCellBreak,c.PlaceholderChar.ParagraphBreak);return{html:d,plain:h=h.replace(jc,"")}}(e,t,function(e,t,n){if(0===n.length||t<1)return 0;var o=n.slice(e,e+t);return 0===o.length?0:o.reduce((function(e,t){return e+t}),0)}(o,t.getProperty().colSpan||0,n))}))}))},Bc=function(e){return e.map((function(e){return e.map((function(e){return e.plain})).join("\t")})).join("\n")+"\n"},Uc=function(e,t,n,o){var r=t.map((function(t,o){return'<tr style= "'+function(e,t){return"height: "+(n[t]>0?Object(g.twipsToPx)(n[t]):"27")+"px;"}(0,o)+'">'+function(t,n){return t.map((function(t,o){return e[n][o].html})).join("")}(t,o)+"</tr>"})).join(""),i=o.map((function(e){return'<col style="width: '+Object(g.twipsToPx)(e)+'px" width="'+Object(g.twipsToPx)(e)+'px"/>'})).join("");return'<table style="'+("border-collapse:collapse;border:none;width:"+Object(g.twipsToPx)(o.reduce((function(e,t){return e+t}),0))+";")+'"><colgroup>'+i+"</colgroup><tbody>"+r+"</tbody></table>"},Vc=function(e){var t=-1,n=-1,o=e.getTextRange().begin(),r=e.getTextStream().tableStream.getTableFullInfoFromGcp(o);return r&&(t=r.rowIndex,n=r.cellIndex),{rowIndex:t,cellIndex:n}},Wc=function(e,t){var n=[],o=[],r=[],i=e.getOffsets(),a=e.getLimitRanges(),s=e.getProperty();if(s&&(n=s.rowHeights,o=s.colWidths),i.length>1){var l=Number.MAX_VALUE,p=Number.MAX_VALUE,u=0,d=0,h=new Map;i.forEach((function(t){e.seek([t]);var n=e.getBeginChild();if(n){var o=Vc(n).rowIndex;l=Math.min(o,l),u=Math.max(o,u);var r=h.get(o);r||(r=[],h.set(o,r));var i=n.getBeginChild();if(i){var a=Vc(i).cellIndex;p=Math.min(a,p),d=Math.max(a,d),r.push(i)}}})),r=kc(h.keys()).sort((function(e,t){return e-t})).map((function(e){return h.get(e)})),n=n.slice(l,u+1),o=o.slice(p,d+1)}else{if((a[0]||c.GCPRange.invalidRange()).equal(e.getGCPRange())){if(m=e.getBeginChild())for(;m;){var f=[];for(y=m.getBeginChild();y;)f.push(y),y=y.getNextSibling();r.push(f.slice(1,f.length-1)),m=m.getNextSibling()}}else{var m,g=e.getLimitRange();if(m=e.getBeginChild()){var y,v=n[Vc(m).rowIndex];if(y=m.getBeginChild()){var b=o[Vc(y).cellIndex],C=y.getGCPRange();if(g.begin()===C.begin()&&g.end()===C.end()){var _=Hc(t,[[y]],[b]);return{html:Uc(_,[[y]],[v],[b]),plain:Bc(_)}}return Fc(y,t).reduce((function(e,t){return{html:e.html+t.html,plain:e.plain+t.plain}}))}}}}var w=Hc(t,r,o);return{html:Uc(w,r,n,o),plain:Bc(w)}},Gc=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)a.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return a},zc=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(Gc(arguments[t]));return e},Kc=function(e,t){var n=Object(Rt.a)(e);if(n){var o=c.OperationUtil.getOpsType(e.operations),r=c.FilterOpType.TitleStyle|c.FilterOpType.Plugin;o===c.OpsType.Mix&&(r|=c.FilterOpType.Table),c.OperationUtil.filterSpecialOps(n,r);var i=t.getSelection().validDeleteRange();n=o===c.OpsType.Table?qc(n,t,i):function(e,t,n){var o=c.DeltaOption.createLocalDeltaOption(n).buildDelta(),r=t.getSelection().tableCellRangeAll();if(!r)return null;var i=t.getSelection().getTable();if(!i)return null;Zc(i,i.getTableInfo().tableProp,r.cellRange,o),e.forEachOp((function(e){c.OperationUtil.moveOffset(e,-n.end())}));var a=null,s=-1;Object(c.cellRangeEach)(r.cellRange,!1,(function(t,n){if(s!==t&&(a=i.getRow(t),s=t),!a)return!1;var r=a.getCell(n);if(!r||!r.range)return!1;var l=c.OperationUtil.getFixPos(o.operations,r.range.begin()+1),p=l;return o.deleteText(new c.GCPRange(l,r.range.length()-2)),e.forEachOp((function(e){var t=e.clone();t&&r.range&&(c.OperationUtil.moveOffset(t,p),o.addOperation(t))})),!0}));var l=o.currentRange().end();return o.moveTo(new c.GCPRange(n.begin(),l-n.begin())),o}(n,t,i)}return n};function qc(e,t,n){var o,r=c.DeltaOption.createLocalDeltaOption(n).buildDelta(),i=c.OperationUtil.spliceOpsInCell(e.operations);(o=r.operations).push.apply(o,zc(i.otherOps));var a=t.getSelection().tableCellRangeAll();if(!a)return null;var s=t.getSelection().getTable();if(!s)return null;var l=s.getTableInfo();if(!l)return null;var p=a.cellRange,u=p.from,d=p.to,h={from:u.clone(),to:d.clone()};h.to.row=Math.max(d.row,u.row+i.rowCount-1),h.to.col=Math.max(d.col,u.col+i.colCount-1),Zc(s,l.tableProp,h,r),function(e,t,n,o,r,i){var a=t-(o.colCount-r.from.col),s=e-(o.rowCount-r.from.row);if(a>0){i.createCol({tableProp:o.tableProp},o.colCount-1,a);var c=n.getTableContentWidth(),l=o.tableProp.colWidths,p=l[o.colCount-1];l.splice.apply(l,zc([o.colCount-1,0],new Array(a).fill(p)));var u=l.reduce((function(e,t){return e+t||0}),0);l.map((function(e){return(e||0)/u*c})).forEach((function(e,t){var n=Math.floor(Object(g.twipsToPx)(e));i.setColWidth({tableProp:o.tableProp},t,Object(g.pxToTwips)(n))}))}s>0&&i.createRow({tableProp:o.tableProp},o.rowCount-1,s)}(i.rowCount,i.colCount,s,l,a.cellRange,r);var f=l.tableRange.end(),m=new c.TableRowBreakSpan,y=new c.TableRowStartSpan,v=new c.TableRowProperty;v.tableDepth=1;var b=new c.TableCellBreakSpan,C=new c.TableCellStartSpan,_=new c.TableCellProperty;_.tableDepth=1;for(var w=l.rowCount-1;w>=h.to.row+1;w--){if(!(P=s.getCellRange(w,l.colCount-1)))throw new Error("tablePaste not found cellRange.");for(var R=h.to.col;R>l.colCount-1;R--)r.insertTableCellPara(P.end(),b,_),r.insertTableCellStart(P.end(),C)}for(w=h.to.row;w>=h.from.row;w--){var S=w>l.rowCount-1;if(S){r.insertTableRowPara(f-1,m,v);for(var E=l.colCount-1;E>h.to.col;E--)r.insertTableCellPara(f,b,_),r.insertTableCellStart(f,C)}var T=function(e){var t=e>l.colCount-1,n=i.tableOps[(w-u.row)%i.rowCount][(e-u.col)%i.colCount],o=0;if(S)o=f;else if(t){if(!(a=s.getCellRange(w,l.colCount-1)))throw new Error("tablePaste not found cellRange.");o=a.end()}else{var a;if(!(a=s.getCellRange(w,e)))throw new Error("tablePaste not found cellRange.");r.deleteText(a),o=a.begin()}n.slice(0).reverse().forEach((function(e){var t=e.clone();t instanceof c.IContentOperationBase&&c.OperationUtil.moveOffset(t,o-t.range.begin()),r.addOperation(t)}))};for(R=h.to.col;R>=h.from.col;R--)T(R);if(S){for(E=h.from.col-1;E>=0;E--)r.insertTableCellPara(f,b,_),r.insertTableCellStart(f,C);r.insertTableRowStart(f,y)}}for(w=h.from.row-1;w>=0;w--){var P;if(!(P=s.getCellRange(w,l.colCount-1)))throw new Error("tablePaste not found cellRange.");for(R=h.to.col;R>l.colCount-1;R--)r.insertTableCellPara(P.end(),b,_),r.insertTableCellStart(P.end(),C)}return function(e,t,n,o){var r=t.getCellRange(n,o);r&&e.moveTo(new c.GCPRange(r.begin()+1,0))}(r,s,h.from.row,h.from.col),r}function Zc(e,t,n,o){e.getMergesInfo().forEach((function(e){Object(c.getRangeRelation)(n,e)!==c.RangeRelation.Apart&&o.unMergeCell(t,e)}))}var $c,Qc=function(e,t){var n=t.getSelection().range(),o=Object(Rt.a)(e);if(o){var r=c.OperationUtil.getOpsType(o.operations);if(r===c.OpsType.Table)return o=qc(e,t,n);var i=c.FilterOpType.TitleStyle|c.FilterOpType.Plugin;r===c.OpsType.Mix&&(i|=c.FilterOpType.Table),c.OperationUtil.filterSpecialOps(o,i),o.deleteText(t.getSelection().validDeleteRange()),o.moveTo(new c.GCPRange(c.OperationUtil.getFixPos(o.operations,n.begin()),0))}return o},Xc=function(e,t){var n,o=c.OperationUtil.getTableCount(e.operations);return t.getDocument().getTableCount()+o>Ct.MAX_TABLE_COUNT?(P.a.show({message:"超过表格上限，请删除其他表格后插入。",duration:5e3,autoClose:!0}),c.ReportHelper.tdwReport({opername:"doc_word_editor",module:"table",action:"reach_limit_merge"}),null):(e.forEachOp((function(e){e instanceof c.MergeTableCellOperation&&n?e.param.tableProp.tableId=n:e instanceof c.InsertTableStartParaOperation?n=g.StringUtil.generateRandomId():e instanceof c.InsertTableEndParaOperation&&(e.param.paraProperty.tableId=n)})),e)},Yc=function(e){for(var t=e;!Object(c.isTableBox)(t)&&t.parentBox;)t=t.parentBox;if(Object(c.isTableBox)(t)){var n=t.__node__;return n||null}return null},Jc=n(387),el=n.n(Jc),tl=n(42),nl=n.n(tl),ol=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),rl=function(e){function t(t){var n=e.call(this,t)||this;return n.onMouseEnter=function(e){var t=e.currentTarget.getAttribute("data-row")||"-1",o=e.currentTarget.getAttribute("data-col")||"-1";n.setState({row:parseInt(t,10),col:parseInt(o,10)})},n.handleMouseLeaveCellsPanel=function(){n.setState({row:-1,col:-1})},n.onClick=function(e){if(n.props.onRCItemClick){var t=n.context.getHandler(n.props.handler);n.props.onRCItemClick(Math.max(1,n.state.row+1),Math.max(1,n.state.col+1),t),c.ReportHelper.tdwReport({opername:"doc_word_editor",module:"insert",action:"table",obj3:0,ver1:n.state.row+1+"x"+(n.state.col+1)})}e.stopPropagation()},n.showDiyModal=function(){var e=n.context.getHandler(n.props.handler);n.props.showDiyInput(e)},n.isCellHiglight=function(e,t){return e<=n.state.row&&t<=n.state.col},n.state={row:-1,col:-1},n}return ol(t,e),t.prototype.render=function(){for(var e,t=[],n=0;n<8;n++){for(var o=0;o<10;o++){var r=nl()(el.a["row-col-item"],((e={})[el.a.higlight]=this.isCellHiglight(n,o),e)),a=n+"_"+o;t.push(i.a.createElement("span",{key:a,"data-row":n,"data-col":o,onMouseEnter:this.onMouseEnter,className:r}))}t.push(i.a.createElement("div",{key:n}))}var s=this.state.row>=0?this.state.row+1+"X"+(this.state.col+1)+" 表格":"插入表格";return i.a.createElement("div",{className:el.a["row-col-container"]},i.a.createElement("div",{className:el.a["row-col-panel-name-wrapper"]},i.a.createElement("span",{className:el.a["row-col-panel-name"]},s)),i.a.createElement("div",{className:el.a["cell-panel"],onClick:this.onClick,onMouseLeave:this.handleMouseLeaveCellsPanel},t),i.a.createElement(ws.a,null),i.a.createElement("div",{className:el.a["row-col-panel-diy-wrapper"]},i.a.createElement("span",{className:el.a["row-col-panel-diy"],onClick:this.showDiyModal},"自定义行列数")))},t.contextType=m.h,t}(i.a.Component),il=n(385),al=n.n(il);!function(e){e[e.Error=-1]="Error",e[e.None=0]="None",e[e.InnerHor=1]="InnerHor",e[e.InnerVer=2]="InnerVer",e[e.InnerAll=3]="InnerAll",e[e.Left=4]="Left",e[e.Top=8]="Top",e[e.Right=16]="Right",e[e.Bottom=32]="Bottom",e[e.Outer=60]="Outer",e[e.All=63]="All"}($c||($c={}));var sl,cl=[{type:$c.All,tooltips:"所有框线",icon:i.a.createElement("svg",{width:"22px",height:"22px",viewBox:"0 0 22 22",version:"1.1"},i.a.createElement("g",{id:"_图标/工具栏/02_表格/所有边框",stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},i.a.createElement("g",{id:"编组-17备份-32"},i.a.createElement("g",{id:"Group复制-3",opacity:"0",fill:"#000000"},i.a.createElement("rect",{id:"Rectangle",opacity:"0.0599999987",x:"0",y:"0",width:"22",height:"22"}),i.a.createElement("rect",{id:"Rectangle",opacity:"0.100000001",x:"3",y:"3",width:"16",height:"16"}),i.a.createElement("rect",{id:"Rectangle",opacity:"0.119999997",x:"4",y:"4",width:"14",height:"14"})),i.a.createElement("g",{id:"编组-73",transform:"translate(4.000000, 4.000000)"},i.a.createElement("rect",{id:"矩形",fill:"#5C5C5C",x:"7",y:"1",width:"1.2",height:"13"}),i.a.createElement("rect",{id:"矩形",stroke:"#5C5C5C",strokeWidth:"1.2",x:"0.6",y:"0.6",width:"13.8",height:"13.8",rx:"0.5"}),i.a.createElement("polygon",{id:"矩形",fill:"#5C5C5C",points:"14 7 14 8.2 1 8.2 1 7"})))))},{type:$c.InnerAll,tooltips:"内部框线",icon:i.a.createElement("svg",{width:"22px",height:"22px",viewBox:"0 0 22 22",version:"1.1"},i.a.createElement("g",{id:"_图标/工具栏/02_表格/内部边框",stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},i.a.createElement("g",{id:"编组-17备份-33"},i.a.createElement("g",{id:"Group复制-3",opacity:"0",fill:"#000000"},i.a.createElement("rect",{id:"Rectangle",opacity:"0.0599999987",x:"0",y:"0",width:"22",height:"22"}),i.a.createElement("rect",{id:"Rectangle",opacity:"0.100000001",x:"3",y:"3",width:"16",height:"16"}),i.a.createElement("rect",{id:"Rectangle",opacity:"0.119999997",x:"4",y:"4",width:"14",height:"14"})),i.a.createElement("g",{id:"编组-73",transform:"translate(4.000000, 4.000000)"},i.a.createElement("rect",{id:"矩形",fill:"#5C5C5C",x:"7",y:"1",width:"1.2",height:"13"}),i.a.createElement("rect",{id:"矩形",stroke:"#CCCCCC",strokeWidth:"1.2",x:"0.6",y:"0.6",width:"13.8",height:"13.8",rx:"0.5"}),i.a.createElement("polygon",{id:"矩形",fill:"#5C5C5C",points:"14 7 14 8.2 1 8.2 1 7"})))))},{type:$c.InnerHor,tooltips:"内部横框线",icon:i.a.createElement("svg",{width:"22px",height:"22px",viewBox:"0 0 22 22",version:"1.1"},i.a.createElement("g",{id:"_图标/工具栏/02_表格/水平边框",stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},i.a.createElement("g",{id:"编组-17备份-35"},i.a.createElement("g",{id:"Group复制-3",opacity:"0",fill:"#000000"},i.a.createElement("rect",{id:"Rectangle",opacity:"0.0599999987",x:"0",y:"0",width:"22",height:"22"}),i.a.createElement("rect",{id:"Rectangle",opacity:"0.100000001",x:"3",y:"3",width:"16",height:"16"}),i.a.createElement("rect",{id:"Rectangle",opacity:"0.119999997",x:"4",y:"4",width:"14",height:"14"})),i.a.createElement("g",{id:"编组-73",transform:"translate(4.000000, 4.000000)"},i.a.createElement("rect",{id:"矩形",fill:"#CCCCCC",x:"7",y:"1",width:"1.2",height:"13"}),i.a.createElement("rect",{id:"矩形",stroke:"#CCCCCC",strokeWidth:"1.2",x:"0.6",y:"0.6",width:"13.8",height:"13.8",rx:"0.5"}),i.a.createElement("polygon",{id:"矩形",fill:"#CCCCCC",points:"14 7 14 8.2 1 8.2 1 7"}),i.a.createElement("polygon",{id:"矩形",fill:"#5C5C5C",points:"15 7 15 8.2 0 8.2 0 7"}))),i.a.createElement("path",{d:"M4.5,4 L18.5,4 C18.7761424,4 19,4.22385763 19,4.5 L19,5.2 L4,5.2 L4,4.5 C4,4.22385763 4.22385763,4 4.5,4 Z",id:"矩形",fill:"#5C5C5C",opacity:"0"}),i.a.createElement("path",{d:"M4,17.8 L19,17.8 L19,18.5 C19,18.7761424 18.7761424,19 18.5,19 L4.5,19 C4.22385763,19 4,18.7761424 4,18.5 L4,17.8 Z",id:"矩形备份",fill:"#5C5C5C",opacity:"0"})))},{type:$c.InnerVer,tooltips:"内部竖框线",icon:i.a.createElement("svg",{width:"22px",height:"22px",viewBox:"0 0 22 22",version:"1.1"},i.a.createElement("g",{id:"_图标/工具栏/02_表格/垂直边框",stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},i.a.createElement("g",{id:"编组-17备份-34"},i.a.createElement("g",{id:"Group复制-3",opacity:"0",fill:"#000000"},i.a.createElement("rect",{id:"Rectangle",opacity:"0.0599999987",x:"0",y:"0",width:"22",height:"22"}),i.a.createElement("rect",{id:"Rectangle",opacity:"0.100000001",x:"3",y:"3",width:"16",height:"16"}),i.a.createElement("rect",{id:"Rectangle",opacity:"0.119999997",x:"4",y:"4",width:"14",height:"14"})),i.a.createElement("g",{id:"编组-73",transform:"translate(4.000000, 4.000000)"},i.a.createElement("rect",{id:"矩形",fill:"#CCCCCC",x:"7",y:"1",width:"1.2",height:"13"}),i.a.createElement("rect",{id:"矩形",stroke:"#CCCCCC",strokeWidth:"1.2",x:"0.6",y:"0.6",width:"13.8",height:"13.8",rx:"0.5"}),i.a.createElement("polygon",{id:"矩形",fill:"#CCCCCC",points:"14 7 14 8.2 1 8.2 1 7"}),i.a.createElement("path",{d:"M0.5,0 L1.2,0 L1.2,15 L0.5,15 C0.223857625,15 2.2904412e-14,14.7761424 2.2759572e-14,14.5 L2.2759572e-14,0.5 C2.27257543e-14,0.223857625 0.223857625,5.07265313e-17 0.5,0 Z",id:"矩形",fill:"#5C5C5C",opacity:"0"}),i.a.createElement("path",{d:"M14.3,0 L15,0 L15,15 L14.3,15 C14.0238576,15 13.8,14.7761424 13.8,14.5 L13.8,0.5 C13.8,0.223857625 14.0238576,5.07265313e-17 14.3,0 Z",id:"矩形备份",fill:"#5C5C5C",opacity:"0",transform:"translate(14.400000, 7.500000) scale(-1, 1) translate(-14.400000, -7.500000) "}),i.a.createElement("rect",{id:"矩形",fill:"#5C5C5C",x:"7",y:"0",width:"1.2",height:"15"})))))},{type:$c.Outer,tooltips:"外部框线",icon:i.a.createElement("svg",{width:"22px",height:"22px",viewBox:"0 0 22 22",version:"1.1"},i.a.createElement("g",{id:"_图标/工具栏/02_表格/外部边框",stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},i.a.createElement("g",{id:"编组-17备份-33"},i.a.createElement("g",{id:"Group复制-3",opacity:"0",fill:"#000000"},i.a.createElement("rect",{id:"Rectangle",opacity:"0.0599999987",x:"0",y:"0",width:"22",height:"22"}),i.a.createElement("rect",{id:"Rectangle",opacity:"0.100000001",x:"3",y:"3",width:"16",height:"16"}),i.a.createElement("rect",{id:"Rectangle",opacity:"0.119999997",x:"4",y:"4",width:"14",height:"14"})),i.a.createElement("g",{id:"编组-73",transform:"translate(4.000000, 4.000000)"},i.a.createElement("rect",{id:"矩形",fill:"#CCCCCC",x:"7",y:"1",width:"1.2",height:"13"}),i.a.createElement("polygon",{id:"矩形",fill:"#CCCCCC",points:"14 7 14 8.2 1 8.2 1 7"}),i.a.createElement("rect",{id:"矩形",stroke:"#5C5C5C",strokeWidth:"1.2",x:"0.6",y:"0.6",width:"13.8",height:"13.8",rx:"0.5"})))))},{type:$c.Left,tooltips:"左侧框线",icon:i.a.createElement("svg",{width:"22px",height:"22px",viewBox:"0 0 22 22",version:"1.1"},i.a.createElement("g",{id:"_图标/工具栏/02_表格/左侧边框",stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},i.a.createElement("g",{id:"编组-17备份-40"},i.a.createElement("g",{id:"Group复制-3",opacity:"0",fill:"#000000"},i.a.createElement("rect",{id:"Rectangle",opacity:"0.0599999987",x:"0",y:"0",width:"22",height:"22"}),i.a.createElement("rect",{id:"Rectangle",opacity:"0.100000001",x:"3",y:"3",width:"16",height:"16"}),i.a.createElement("rect",{id:"Rectangle",opacity:"0.119999997",x:"4",y:"4",width:"14",height:"14"})),i.a.createElement("g",{id:"编组-73",transform:"translate(4.000000, 4.000000)"},i.a.createElement("rect",{id:"矩形",fill:"#CCCCCC",x:"7",y:"1",width:"1.2",height:"13"}),i.a.createElement("rect",{id:"矩形",stroke:"#CCCCCC",strokeWidth:"1.2",x:"0.6",y:"0.6",width:"13.8",height:"13.8",rx:"0.5"}),i.a.createElement("polygon",{id:"矩形",fill:"#CCCCCC",points:"14 7 14 8.2 1 8.2 1 7"}),i.a.createElement("path",{d:"M0.5,0 L1.2,0 L1.2,15 L0.5,15 C0.223857625,15 1.4483999e-16,14.7761424 0,14.5 L0,0.5 C-3.38176876e-17,0.223857625 0.223857625,5.07265313e-17 0.5,0 Z",id:"矩形",fill:"#5C5C5C"})))))},{type:$c.Top,tooltips:"顶部框线",icon:i.a.createElement("svg",{width:"22px",height:"22px",viewBox:"0 0 22 22",version:"1.1"},i.a.createElement("g",{id:"_图标/工具栏/02_表格/顶部边框",stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},i.a.createElement("g",{id:"编组-17备份-41"},i.a.createElement("g",{id:"Group复制-3",opacity:"0",fill:"#000000"},i.a.createElement("rect",{id:"Rectangle",opacity:"0.0599999987",x:"0",y:"0",width:"22",height:"22"}),i.a.createElement("rect",{id:"Rectangle",opacity:"0.100000001",x:"3",y:"3",width:"16",height:"16"}),i.a.createElement("rect",{id:"Rectangle",opacity:"0.119999997",x:"4",y:"4",width:"14",height:"14"})),i.a.createElement("g",{id:"编组-73",transform:"translate(4.000000, 4.000000)"},i.a.createElement("rect",{id:"矩形",fill:"#CCCCCC",x:"7",y:"1",width:"1.2",height:"13"}),i.a.createElement("rect",{id:"矩形",stroke:"#CCCCCC",strokeWidth:"1.2",x:"0.6",y:"0.6",width:"13.8",height:"13.8",rx:"0.5"}),i.a.createElement("polygon",{id:"矩形",fill:"#CCCCCC",points:"14 7 14 8.2 1 8.2 1 7"})),i.a.createElement("path",{d:"M4.5,4 L18.5,4 C18.7761424,4 19,4.22385763 19,4.5 L19,5.2 L4,5.2 L4,4.5 C4,4.22385763 4.22385763,4 4.5,4 Z",id:"矩形",fill:"#5C5C5C"}))))},{type:$c.Right,tooltips:"右侧框线",icon:i.a.createElement("svg",{width:"22px",height:"22px",viewBox:"0 0 22 22",version:"1.1"},i.a.createElement("g",{id:"_图标/工具栏/02_表格/右侧边框",stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},i.a.createElement("g",{id:"编组-17备份-42"},i.a.createElement("g",{id:"Group复制-3",opacity:"0",fill:"#000000"},i.a.createElement("rect",{id:"Rectangle",opacity:"0.0599999987",x:"0",y:"0",width:"22",height:"22"}),i.a.createElement("rect",{id:"Rectangle",opacity:"0.100000001",x:"3",y:"3",width:"16",height:"16"}),i.a.createElement("rect",{id:"Rectangle",opacity:"0.119999997",x:"4",y:"4",width:"14",height:"14"})),i.a.createElement("g",{id:"编组-73",transform:"translate(4.000000, 4.000000)"},i.a.createElement("rect",{id:"矩形",fill:"#CCCCCC",x:"7",y:"1",width:"1.2",height:"13"}),i.a.createElement("rect",{id:"矩形",stroke:"#CCCCCC",strokeWidth:"1.2",x:"0.6",y:"0.6",width:"13.8",height:"13.8",rx:"0.5"}),i.a.createElement("polygon",{id:"矩形",fill:"#CCCCCC",points:"14 7 14 8.2 1 8.2 1 7"}),i.a.createElement("path",{d:"M13.8,0 L14.5,0 C14.7761424,-5.07265313e-17 15,0.223857625 15,0.5 L15,14.5 C15,14.7761424 14.7761424,15 14.5,15 L13.8,15 L13.8,0 Z",id:"矩形",fill:"#5C5C5C"})))))},{type:$c.Bottom,tooltips:"底部框线",icon:i.a.createElement("svg",{width:"22px",height:"22px",viewBox:"0 0 22 22",version:"1.1"},i.a.createElement("g",{id:"_图标/工具栏/02_表格/底部边框",stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},i.a.createElement("g",{id:"编组-17备份-43"},i.a.createElement("g",{id:"Group复制-3",opacity:"0",fill:"#000000"},i.a.createElement("rect",{id:"Rectangle",opacity:"0.0599999987",x:"0",y:"0",width:"22",height:"22"}),i.a.createElement("rect",{id:"Rectangle",opacity:"0.100000001",x:"3",y:"3",width:"16",height:"16"}),i.a.createElement("rect",{id:"Rectangle",opacity:"0.119999997",x:"4",y:"4",width:"14",height:"14"})),i.a.createElement("g",{id:"编组-73",transform:"translate(4.000000, 4.000000)"},i.a.createElement("rect",{id:"矩形",fill:"#CCCCCC",x:"7",y:"1",width:"1.2",height:"13"}),i.a.createElement("rect",{id:"矩形",stroke:"#CCCCCC",strokeWidth:"1.2",x:"0.6",y:"0.6",width:"13.8",height:"13.8",rx:"0.5"}),i.a.createElement("polygon",{id:"矩形",fill:"#CCCCCC",points:"14 7 14 8.2 1 8.2 1 7"})),i.a.createElement("path",{d:"M4.5,17.8 L18.5,17.8 C18.7761424,17.8 19,18.0238576 19,18.3 L19,19 L4,19 L4,18.3 C4,18.0238576 4.22385763,17.8 4.5,17.8 Z",id:"矩形",fill:"#5C5C5C",transform:"translate(11.500000, 18.400000) scale(1, -1) translate(-11.500000, -18.400000) "}))))},{type:$c.None,tooltips:"无框线",icon:i.a.createElement("svg",{width:"22px",height:"22px",viewBox:"0 0 22 22",version:"1.1"},i.a.createElement("g",{id:"_图标/工具栏/02_表格/无边框",stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},i.a.createElement("g",{id:"编组-17备份-31"},i.a.createElement("g",{id:"Group复制-3",opacity:"0",fill:"#000000"},i.a.createElement("rect",{id:"Rectangle",opacity:"0.0599999987",x:"0",y:"0",width:"22",height:"22"}),i.a.createElement("rect",{id:"Rectangle",opacity:"0.100000001",x:"3",y:"3",width:"16",height:"16"}),i.a.createElement("rect",{id:"Rectangle",opacity:"0.119999997",x:"4",y:"4",width:"14",height:"14"})),i.a.createElement("g",{id:"编组-73",transform:"translate(4.000000, 4.000000)"},i.a.createElement("rect",{id:"矩形",fill:"#CCCCCC",x:"7",y:"1",width:"1.2",height:"13"}),i.a.createElement("rect",{id:"矩形",stroke:"#CCCCCC",strokeWidth:"1.2",x:"0.6",y:"0.6",width:"13.8",height:"13.8",rx:"0.5"}),i.a.createElement("polygon",{id:"矩形",fill:"#CCCCCC",points:"14 7 14 8.2 1 8.2 1 7"})))))}],ll=n(386),pl=n.n(ll),ul=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),dl=function(){return(dl=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},hl=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleClick=function(){t.props.onClick(t.props.type,!t.props.selected)},t}return ul(t,e),t.prototype.render=function(){var e,t=nl()(al.a["border-item"],((e={})[al.a.selected]=this.props.selected,e));return i.a.createElement(Ge.a,{title:this.props.tooltips,trigger:"hover",zIndex:10001},i.a.createElement("div",{className:t,onClick:this.handleClick},this.props.icon))},t}(i.a.Component),fl=function(e){function t(t){var n=e.call(this,t)||this;return n.notifyInfo=function(e,t){if(n.props.onBorderInfo){var o=n.context.getHandler(n.props.handler);n.props.onBorderInfo(e,t,o)}},n.updatePropsData=function(e){if(n.props.updateDataCallback){var t=n.context.getHandler(n.props.handler),o={type:e};n.props.updateDataCallback(n.context,t,o)}},n.onColorChange=function(e){n.setState({showColor:!1,selectColor:e}),n.notifyInfo($c.All,e),pl.a.saveRecentColor(e)},n.showColor=function(){n.state.type===$c.None||n.setState({showColor:!0})},n.hideColor=function(){n.setState({showColor:!1})},n.handleItemClick=function(e,t){var o;e===$c.None?(n.notifyInfo($c.None,null),n.setState({type:$c.None}),n.updatePropsData($c.None)):t?(n.notifyInfo(e,n.state.selectColor),n.setState({type:n.state.type|e}),n.updatePropsData(n.state.type|e)):(n.notifyInfo(e,null),n.setState({type:n.state.type&~e}),n.updatePropsData(n.state.type&~e)),o=e===$c.All?0:e===$c.None?1:2,c.ReportHelper.tdwReport({opername:"doc_word_editor",module:"table",action:"table_borderline_set",obj3:o})},n.state={showColor:!1,selectColor:c.Defaults.defaultBorder.borderColor,type:t.type},n}return ul(t,e),t.prototype.componentWillReceiveProps=function(e){e.type&&this.setState({type:e.type})},t.prototype.render=function(){var e,t=this,n=this.state.type===$c.None;return i.a.createElement(wt.a.Keep,null,i.a.createElement("div",{className:al.a["border-panel"]},i.a.createElement("div",{className:al.a["item-list"]},cl.map((function(e){var o=e.type===$c.None?n:(t.state.type&e.type)===e.type;return i.a.createElement(hl,dl({key:e.type},e,{onClick:t.handleItemClick,selected:o}))}))),i.a.createElement(ws.a,null),i.a.createElement("div",{className:nl()(al.a["color-entry-wrapper"],(e={},e[al.a.disabled]=n,e)),onMouseEnter:this.showColor,onMouseLeave:this.hideColor},i.a.createElement("div",{className:al.a["color-entry"]},i.a.createElement("div",{className:al.a.left},i.a.createElement("div",{className:al.a["color-icon"]},i.a.createElement("svg",{width:"22px",height:"22px",viewBox:"0 0 22 22",version:"1.1"},i.a.createElement("g",{id:"边框颜色填色",stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"}),i.a.createElement("g",{fill:"#5C5C5C",id:"Fill-11"}),i.a.createElement("path",{d:"M7.3842,10.7682 L7.2642,10.9742 L7.2482,11.2112 L6.9962,14.9282 C6.9842,15.0972 7.1712,15.2052 7.3122,15.1112 L10.4052,13.0342 L10.5982,12.9042 L10.7162,12.7022 L15.1052,5.1872 C15.1752,5.0662 15.1342,4.9102 15.0132,4.8402 L12.1192,3.1702 C11.9962,3.0982 11.8392,3.1402 11.7672,3.2632 L7.3842,10.7682 Z M12.2642,4.4262 L13.8412,5.3372 L9.8502,12.1702 C9.8422,12.1832 9.8322,12.1952 9.8192,12.2032 L8.1212,13.3432 L8.2602,11.3032 C8.2612,11.2882 8.2662,11.2732 8.2732,11.2602 L12.2642,4.4262 Z"})),i.a.createElement("div",{className:al.a["color-bottom"],style:{backgroundColor:this.state.selectColor}})),i.a.createElement("div",{className:al.a.name},"边框颜色")),i.a.createElement("div",{className:al.a.right},i.a.createElement("div",{className:al.a.arrow}))),i.a.createElement("div",{className:al.a["color-panel"]},this.state.showColor?i.a.createElement(m.e,{handler:this.props.handler,showSubPalette:!1,showNoColor:!0,onItemClick:function(e,n,o){t.onColorChange(o.value)}}):""))))},t.contextType=m.h,t}(i.a.Component),ml=n(388),gl=n.n(ml),yl=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),vl=function(){return(vl=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},bl=function(e){return"请输入"+e+"的倍数或因子"},Cl=function(e,t){return"最大拆分"+("row"===e?"行":"列")+"数为"+t},_l=function(e){function t(t){var n=e.call(this,t)||this;return n.rowBaseCount=1,n.colBaseCount=1,n.rowCountQueue=[],n.colCountQueue=[],n.currentRowCount=0,n.currentColCount=0,n.incRowCount=function(){n.setSplitCount(vl(vl({},n.state.splitCount),{rowCount:n.getRowCount(n.state.splitCount.rowCount,!0)}))},n.decRowCount=function(){n.setSplitCount(vl(vl({},n.state.splitCount),{rowCount:n.getRowCount(n.state.splitCount.rowCount,!1)}))},n.incColCount=function(){n.setSplitCount(vl(vl({},n.state.splitCount),{colCount:n.getColCount(n.state.splitCount.colCount,!0)}))},n.decColCount=function(){n.setSplitCount(vl(vl({},n.state.splitCount),{colCount:n.getColCount(n.state.splitCount.colCount,!1)}))},n.onRowCountChange=function(e){var t=Number(e.target.value),o=n.state.splitCount.colCount;n.setSplitCount({rowCount:t,colCount:o})},n.onColCountChange=function(e){var t=n.state.splitCount.rowCount,o=Number(e.target.value);n.setSplitCount({rowCount:t,colCount:o})},n.filterInput=function(e){var t=e.charCode||e.keyCode;t>=48&&t<=57||45===t||46===t||8===t||9===t||37===t||39===t||0===t||e.preventDefault()},n.state={splitCount:t.initialValue,isValid:!1},n.rowBaseCount=t.initialValue.rowCount,n.colBaseCount=t.initialValue.colCount,n.currentRowCount=t.handler.getRowCount(),n.currentColCount=t.handler.getColCount(),n.genCountQueue(),n}return yl(t,e),t.prototype.setSplitCount=function(e){var t=e.rowCount,n=e.colCount;t=t<=0?1:t,n=n<=0?1:n;var o,r,i=Math.max(100-this.currentRowCount,1),a=Math.max(60-this.currentColCount,1),s=!0;t>i&&(t=i-i%this.rowBaseCount,o=Cl("row",t),c.ReportHelper.tdwReport({opername:"doc_word_editor",module:"table",action:"table_split",obj3:t+"-"+n,ver1:"0",ver5:"1"})),n>a&&(n=a-a%this.colBaseCount,r=Cl("col",n),c.ReportHelper.tdwReport({opername:"doc_word_editor",module:"table",action:"table_split",obj3:t+"-"+n,ver1:"0",ver5:"1"})),t%this.rowBaseCount!=0&&this.rowBaseCount%t!=0&&(o=bl(this.rowBaseCount),s=!1,c.ReportHelper.tdwReport({opername:"doc_word_editor",module:"table",action:"table_split",obj3:t+"-"+n,ver1:"0",ver5:"2"})),n%this.colBaseCount!=0&&this.colBaseCount%n!=0&&(r=bl(this.colBaseCount),s=!1,c.ReportHelper.tdwReport({opername:"doc_word_editor",module:"table",action:"table_split",obj3:t+"-"+n,ver1:"0",ver5:"2"})),e={rowCount:t,colCount:n},this.setState({splitCount:e,isValid:s,rowErrorText:o,colErrorText:r}),this.props.valueChange(e,s)},t.prototype.genCountQueue=function(){var e=this.rowBaseCount,t=this.colBaseCount,n=100-this.currentRowCount,o=60-this.currentColCount,r=0;for(r=1;r<=n;)r<e?(e%r==0&&this.rowCountQueue.push(r),r+=1):(this.rowCountQueue.push(r),r+=e);for(this.rowCountQueue.push(r),r=1;r<=o;)r<t?(t%r==0&&this.colCountQueue.push(r),r+=1):(this.colCountQueue.push(r),r+=t);this.colCountQueue.push(r)},t.prototype.getRowCount=function(e,t){var n=this.rowCountQueue,o=this.binSearchIndex(n,e,0,n.length-1);return(t?n[o+1]:n[o-1])||e},t.prototype.getColCount=function(e,t){var n=this.colCountQueue,o=this.binSearchIndex(n,e,0,n.length-1);return(t?n[o+1]:n[o-1])||e},t.prototype.binSearchIndex=function(e,t,n,o){if(n===o)return n;var r=Math.floor((n+o)/2);return t>e[r]?this.binSearchIndex(e,t,r+1,o):t<e[r]?this.binSearchIndex(e,t,n,r):r},t.prototype.render=function(){var e=this.state.splitCount,t=e.rowCount,n=e.colCount,o=this.state,r=o.rowErrorText,a=o.colErrorText;return i.a.createElement("div",{className:gl.a["pad-ui-dialog-content"]+" "+gl.a["crd-body"]},i.a.createElement("div",{className:gl.a["crd-setting-group"]+" "+gl.a["crd-setting-group-spacing"]},i.a.createElement("div",{className:gl.a["crd-setting-item"]},i.a.createElement("div",{className:gl.a["crd-setting-label-wrapper-left"]},i.a.createElement("span",{className:gl.a["crd-label"]},"行数")),i.a.createElement("div",{className:gl.a["crd-number-input"]},i.a.createElement("input",{type:"text",className:"dui-input-input",value:t,onKeyPress:this.filterInput,onChange:this.onRowCountChange}),i.a.createElement("div",{className:gl.a["crd-input-inc-button"]+" "+gl.a["input_inc_pap-spacing-after"],onClick:this.incRowCount}),i.a.createElement("div",{className:gl.a["crd-input-dec-button"]+" "+gl.a["input_dec_pap-spacing-after"],onClick:this.decRowCount}),i.a.createElement("span",{className:gl.a["crd-number-input-error-text"],style:{display:r?"block":"none"}},r)),i.a.createElement("div",{className:gl.a["crd-setting-label-wrapper-right-big"]},i.a.createElement("span",{className:gl.a["crd-label"]},"列数")),i.a.createElement("div",{className:gl.a["crd-number-input"]},i.a.createElement("input",{type:"text",className:"dui-input-input",value:n,onKeyPress:this.filterInput,onChange:this.onColCountChange}),i.a.createElement("div",{className:gl.a["crd-input-inc-button"]+" "+gl.a["input_inc_pap-spacing-after"],onClick:this.incColCount}),i.a.createElement("div",{className:gl.a["crd-input-dec-button"]+" "+gl.a["input_dec_pap-spacing-after"],onClick:this.decColCount}),i.a.createElement("span",{className:gl.a["crd-number-input-error-text"],style:{display:a?"block":"none"}},a)))))},t}(i.a.Component),wl=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)a.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return a},Rl=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(wl(arguments[t]));return e},Sl={alias:"#FF0000",value:"#FF0000"};!function(e){e.BACKSPACE="backspace",e.DELETE="delete",e.TAB="tab",e.SHIFT_TAB="shiftTab",e.SELECT_ALL="selectAll",e.ARROW_LEFT="moveLeft",e.ARROW_RIGHT="moveRight",e.ARROW_UP="moveUp",e.ARROW_DOWN="moveDown",e.ENTER="enter"}(sl||(sl={}));var El=function(e){var t;return(t={})[sl.DELETE]=function(t,n){if(t&&t instanceof c.MeloEditor&&t.isEditable()){if(!e)return;if(e&&e.tableCellRange)e.clearRangeContent();else{var o=e.getNextTable();if(o&&t.isCaret()){var r=o.getTableInfo();if(r)return void o.selectRange({from:new c.TableCellCoords(0,0),to:new c.TableCellCoords(r.rowCount-1,r.colCount-1)})}n()}}else n()},t[sl.TAB]=function(t,n){if(t instanceof c.MeloEditor&&e&&e.tableCellRangeAll&&e.tableCellRangeAll.cellRange&&t.isEditable()){var o=t.service.getSelection().getTables().item(0);if(!o)return;var r=o.getTableInfo();if(!r)return;var i=e.tableCellRangeAll.cellRange.to,a=i.row,s=i.col;r.rowCount-1===a&&r.colCount-1===s?e.insertRow(1,"below"):e.setCaretNextCell(t.service.getSelection().range().end(),!0)}else n()},t[sl.SHIFT_TAB]=function(t,n){e&&e.tableCellRangeAll&&t instanceof c.MeloEditor&&t.isEditable()?e.setCaretPrevCell(t.service.getSelection().range().begin(),!0):n()},t[sl.SELECT_ALL]=function(t,n){e&&e.tableCellRangeAll&&t instanceof c.MeloEditor&&t.isEditable()?e.selCurTable():n()},t[sl.ARROW_LEFT]=function(t,n){if(e&&t instanceof c.MeloEditor&&t.isEditable()&&t.isCaret())if(e.tableCellRangeAll){if(e.setCaretPrev())return}else{var o=t.service.getSelection().range().begin();if(o>0){var r=t.service.getDocument().getTableFromGcp(o-1);if(r){var i=r.getLastValidCell();return void(i&&i.setCaretEnd())}}}n()},t[sl.ARROW_RIGHT]=function(t,n){if(e&&t instanceof c.MeloEditor&&t.isEditable()&&t.isCaret())if(e.tableCellRangeAll){if(e.setCaretNext())return}else{var o=t.service.getSelection().range().begin(),r=t.service.getDocument().getTableFromGcp(o+1);if(r){var i=r.getCell(0,0);return void(i&&i.setCaretStart())}}n()},t[c.MODEL_DID_CHANGE_ACTION]=function(t,n,o,r){return e&&e.checkTablesStructure(o,r)?n():1001},t[sl.BACKSPACE]=function(t,n){if(t&&t instanceof c.MeloEditor&&t.isEditable()){if(!e)return;if(e.tableCellRange){if(!(r=t.service.getSelection().getTable()))return;var o=e.tableCellRange.cellRange;return void e.clearInRange(r,o)}if(e.tableCellRangeAll&&t.isCaret()){var r,i=e.tableCellRangeAll;if(!(r=t.service.getSelection().getTables().getItemForTableId(i.tableId)))return;var a=r.getCell(i.cellRange.from.row,i.cellRange.from.col);if(a&&a.range&&a.range.begin()===t.service.getSelection().range().begin()&&!e.isListCellHead())return;return void n()}var s=e.getPrevTable();if(s&&t.isCaret()&&(i=s.getTableInfo()))return void s.selectRange({from:new c.TableCellCoords(0,0),to:new c.TableCellCoords(i.rowCount-1,i.colCount-1)});n()}else n()},t},Tl=[{keyBindings:{win:c.KeyAssist.SHIFT+c.KeyCode.TAB,mac:c.KeyAssist.SHIFT+c.KeyCode.TAB},action:sl.SHIFT_TAB},{keyBindings:{win:c.KeyAssist.CTRL_WIN+c.KeyCode.A,mac:c.KeyAssist.COMMAND+c.KeyCode.A},action:sl.SELECT_ALL}],Pl=n(391),Il=n.n(Pl),xl=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Ol=function(e){function t(t){var n=e.call(this,t)||this;return n.diyContent=function(){var e={width:"100px",display:"inline-block"};return i.a.createElement("div",{style:{paddingTop:"26px",width:"100%"}},i.a.createElement("span",{style:{marginRight:"12px",userSelect:"none"}},"行数"),i.a.createElement(Ot.a,{defaultValue:n.state.diyRowCount,onChange:n.setDiyRow,style:e,minValue:1,maxValue:100,step:1,allowDecimal:!1}),i.a.createElement("span",{style:{marginRight:"12px",marginLeft:"45px",userSelect:"none"}},"列数"),i.a.createElement(Ot.a,{defaultValue:n.state.diyColCount,onChange:n.setDiyCol,style:e,minValue:1,maxValue:60,step:1,allowDecimal:!1}),i.a.createElement("div",{className:Il.a["bottom-btns"]},i.a.createElement(F.Button,{style:{marginRight:"20px"},onClick:n.props.onCancel},"取消"),i.a.createElement(F.Button,{type:"primary",onClick:n.onDiyCreate},"确定")))},n.onDiyCreate=function(){n.rowAndColisValid(n.state.diyRowCount,n.state.diyColCount)&&n.props.onCreate&&(n.props.onCreate(n.state.diyRowCount,n.state.diyColCount),c.ReportHelper.tdwReport({opername:"doc_word_editor",module:"insert",action:"table",obj3:1,ver1:n.state.diyRowCount+"x"+n.state.diyColCount}))},n.setDiyCol=function(e){var t=parseInt(e,10);n.setState({diyColCount:t})},n.setDiyRow=function(e){var t=parseInt(e,10);n.setState({diyRowCount:t})},n.state={diyRowCount:2,diyColCount:5},n}return xl(t,e),t.prototype.rowAndColisValid=function(e,t){return!isNaN(e)&&!isNaN(t)&&(!(e<1||e>100)&&!(t<1||t>60))},t.prototype.render=function(){return this.diyContent()},t.contextType=m.h,t}(i.a.Component),Ll=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Ml=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Nl=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Al=function(){var e=Rl([{name:"insert-table",content:"表格",icon:i.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"},i.a.createElement("g",{fill:"none",fillRule:"evenodd"},i.a.createElement("path",{fill:"#464D5A",fillRule:"nonzero",d:"M19.5 5c.276 0 .5.224.5.5v13c0 .276-.224.5-.5.5h-15c-.276 0-.5-.224-.5-.5v-13c0-.276.224-.5.5-.5h15zM9 15.028H5.299L5.3 17.7H9v-2.672zm9.7 0h-8.45V17.7h8.45v-2.672zM9 10.75H5.299v3.028H9V10.75zm9.7 0h-8.45v3.028h8.45V10.75zM9 6.299L5.3 6.3l-.001 3.2H9V6.299zm9.7.001l-8.45-.001V9.5h8.45V6.3z"}))),shouldDisabled:function(e,t){return!t.canAddTable()},style:{padding:0}},{name:"format-table",content:"表格格式",shouldDisabled:function(e,t){return!t||!t.tableCellRangeAll&&!t.tableCellRange}},{name:"table-border",content:"边框线",style:{padding:0}},{name:"table-border-component",content:function(e,t){return i.a.createElement(fl,{type:t.getBorderType(),onBorderInfo:function(e,t,n){n.setBorderColor(e,t)}})},preventHighlight:!0,style:{width:"auto",height:"auto",padding:"0",position:"inherit"}},{name:"table-fill-color",content:"填充颜色",style:{padding:0}},{name:"table-fill-color-component",content:i.a.createElement(m.e,{getData:function(){return Sl},showSubPalette:!1,showNoColor:!1,onItemClick:function(e,t,n){t.setBgColor(n.value)}}),preventHighlight:!0,style:{width:"auto",height:"auto",padding:"0"}},{name:"merge-cell",content:"合并单元格",onClick:function(e,t){t.mergeCell(),c.ReportHelper.tdwReport({opername:"doc_word_editor",module:"table",action:"table_merge",obj3:2})},shouldDisabled:function(e,t){return!t.canMerge()}},{name:"table-horizental-align",content:"水平对齐"}],[{text:"左对齐",id:"table-horizental-align-left",alignType:c.TextAlignmentType.Left},{text:"居中对齐",id:"table-horizental-align-center",alignType:c.TextAlignmentType.Center},{text:"右对齐",id:"table-horizental-align-right",alignType:c.TextAlignmentType.Right},{text:"两端对齐",id:"table-horizental-align-justify",alignType:c.TextAlignmentType.Justify}].map((function(e){return{name:e.id,content:e.text,shouldCheck:function(t,n){return e.alignType===n.getAlignment()},onClick:function(t,n){n.setAlignment(e.alignType)}}})),[{name:"table-vertical-align",content:"垂直对齐"}],[{text:"顶端对齐",id:"table-vertical-align-top",alignType:c.VerticalAlignmentType.AlignVerticalTop},{text:"居中对齐",id:"table-vertical-align-center",alignType:c.VerticalAlignmentType.AlignVerticalCenter},{text:"底端对齐",id:"table-vertical-align-bottom",alignType:c.VerticalAlignmentType.AlignVerticalBottom}].map((function(e){return{name:e.id,content:e.text,shouldCheck:function(t,n){return!(!n||!n.tableCellRangeAll&&!n.tableCellRange||e.alignType!==n.getVerticalAligin())},onClick:function(t,n){n.setVerticalAlign(e.alignType)}}})),[{name:"table-panel",content:i.a.createElement(rl,{onRCItemClick:function(e,t,n){n.addTable(e,t)},showDiyInput:function(e){e.showRowColInput()}}),preventHighlight:!0,style:{width:"auto",height:"auto",padding:"0"}}]),t=[{name:"insertRowAbove",content:function(e,t){var n=t.getInsertRowCount();return n?"上方插入"+n+"行":""},onClick:function(e,t){var n=t.getInsertRowCount();n&&t.insertRow(n,"above")},shouldHide:function(e,t){return!t.tableCellRangeAll}},{name:"insertRowBelow",content:function(e,t){var n=t.getInsertRowCount();return n?"下方插入"+n+"行":""},onClick:function(e,t){var n=t.getInsertRowCount();n&&t.insertRow(n,"below")},shouldHide:function(e,t){return!t.tableCellRangeAll}},{name:"removeRow",content:"删除所在行",onClick:function(e,t){t.removeRow()},shouldHide:function(e,t){return!t.tableCellRangeAll}},{name:"insertColLeft",content:function(e,t){var n=t.getInsertColCount();return n?"左边插入"+n+"列":""},onClick:function(e,t){var n=t.getInsertColCount();n&&t.insertCol(n,"left")},shouldHide:function(e,t){return!t.tableCellRangeAll}},{name:"insertColRight",content:function(e,t){var n=t.getInsertColCount();return n?"右边插入"+n+"列":""},onClick:function(e,t){var n=t.getInsertColCount();n&&t.insertCol(n,"right")},shouldHide:function(e,t){return!t.tableCellRangeAll}},{name:"removeCol",content:"删除所在列",onClick:function(e,t){t.removeCol()},shouldHide:function(e,t){return!t.tableCellRangeAll}},{name:"mergeCells",content:"合并单元格",onClick:function(e,t){t.mergeCell(),c.ReportHelper.tdwReport({opername:"doc_word_editor",module:"table",action:"table_merge",obj3:1})},shouldHide:function(e,t){return!t.tableCellRangeAll},shouldDisabled:function(e,t){return!t.canMerge()}},{name:"splitCells",content:"拆分单元格",onClick:function(e,t){var n=t.tableCellRangeAll.cellRange,o={rowCount:n.to.row-n.from.row+1,colCount:n.to.col-n.from.col+1},r=!0,a=i.a.createElement(_l,{handler:t,valueChange:function(e,t){o=e,r=t},initialValue:o});W.a.confirm({title:"拆分单元格",content:a,onOk:function(e){if(null==e||e.preventDefault(),r){var n=o.rowCount,i=o.colCount;t.tableCellSplit(n,i)}else;}})},shouldHide:function(e,t){return!t.tableCellRangeAll},shouldDisabled:function(e,t){return!t.canSplit()}},{name:"deleteTable",content:"删除表格",onClick:function(e,t){t.removeTable()},shouldHide:function(e,t){return!t.tableCellRangeAll}}];t.forEach((function(e){var t=e.shouldDisabled,n=e.shouldHide;e.shouldDisabled=function(e,n){return!(!e.permission||e.permission.isEditable)||!!t&&t(e,n)},e.shouldHide=function(e,t){return!!e.isPublish||!!n&&n(e,t)}}));var n={width:"66px",height:"40px"},o={top:{type:m.p.Icon,data:{alias:"",value:c.VerticalAlignmentType.AlignVerticalTop},tooltips:"顶端对齐",icon:i.a.createElement("svg",{width:"22px",height:"22px",viewBox:"0 0 22 22",version:"1.1"},i.a.createElement("g",{stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},i.a.createElement("g",null,i.a.createElement("rect",{id:"Rectangle",fill:"#000000",opacity:"0",x:"0",y:"0",width:"22",height:"22"}),i.a.createElement("path",{d:"M4,5 L18,5 L18,6.4 L4,6.4 L4,5 Z M10.38,10.65 L8.5,10.65 L11,7.65 L13.5,10.65 L11.63,10.65 L11.63,17 L10.38,17 L10.38,10.65 Z",id:"形状结合",fill:"#5C5C5C"})))),style:n},middle:{type:m.p.Icon,data:{alias:"",value:c.VerticalAlignmentType.AlignVerticalCenter},tooltips:"居中对齐",icon:i.a.createElement("svg",{width:"22px",height:"22px",viewBox:"0 0 22 22",version:"1.1"},i.a.createElement("g",{stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},i.a.createElement("g",null,i.a.createElement("rect",{id:"Rectangle",fill:"#000000",opacity:"0",x:"0",y:"0",width:"22",height:"22"}),i.a.createElement("path",{d:"M3.5,10.3 L18.5,10.3 L18.5,11.7 L3.5,11.7 L3.5,10.3 Z M10.38,16 L8.5,16 L11,13 L13.5,16 L11.63,16 L11.63,19 L10.38,19 L10.38,16 Z M11.63,6 L13.5,6 L11,9 L8.5,6 L10.38,6 L10.38,3 L11.63,3 L11.63,6 Z",id:"形状",fill:"#5C5C5C"})))),style:n},bottom:{type:m.p.Icon,data:{alias:"",value:c.VerticalAlignmentType.AlignVerticalBottom},tooltips:"底端对齐",icon:i.a.createElement("svg",{width:"22px",height:"22px",viewBox:"0 0 22 22",version:"1.1"},i.a.createElement("g",{stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},i.a.createElement("g",null,i.a.createElement("rect",{id:"Rectangle",fill:"#000000",opacity:"0",x:"0",y:"0",width:"22",height:"22"}),i.a.createElement("path",{d:"M11.63,11.35 L13.5,11.35 L11,14.35 L8.5,11.35 L10.38,11.35 L10.38,5 L11.63,5 L11.63,11.35 Z M4,17 L4,15.6 L18,15.6 L18,17 L4,17 Z",id:"形状结合",fill:"#5C5C5C"})))),style:n}},r=Object.values(o);return{menu:e,contextMenu:t,toolbar:[{name:"insert-table",type:"icon",preventFocus:!0,icon:i.a.createElement("svg",{width:"22px",height:"22px",viewBox:"0 0 22 22",version:"1.1"},i.a.createElement("g",{stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},i.a.createElement("g",null,i.a.createElement("rect",{id:"Rectangle复制-16",fill:"#000000",opacity:"0",x:"0",y:"0",width:"22",height:"22"}),i.a.createElement("path",{d:"M9.25,9.75 L9.25,12.7781485 L17.75,12.7781485 L17.75,9.75 L9.25,9.75 Z M8,9.75 L4.25,9.75 L4.25,12.7781485 L8,12.7781485 L8,9.75 Z M9.25,16.75 L17.75,16.75 L17.75,14.0281485 L9.25,14.0281485 L9.25,16.75 Z M8,16.75 L8,14.0281485 L4.25,14.0281485 L4.25,16.75 L8,16.75 Z M9.25,5.25 L9.25,8.5 L17.75,8.5 L17.75,5.25 L9.25,5.25 Z M8,5.25 L4.25,5.25 L4.25,8.5 L8,8.5 L8,5.25 Z M3.5,4 L18.5,4 C18.7761424,4 19,4.22385763 19,4.5 L19,17.5 C19,17.7761424 18.7761424,18 18.5,18 L3.5,18 C3.22385763,18 3,17.7761424 3,17.5 L3,4.5 C3,4.22385763 3.22385763,4 3.5,4 Z",id:"形状结合",fill:"#5C5C5C",fillRule:"nonzero"})))),tooltip:"插入表格",dropDownContent:rl,dropDownContentProps:function(e,t){return{onRCItemClick:function(e,n){t.addTable(e,n)},showDiyInput:function(){t.showRowColInput()}}},shouldDisabled:function(e,t){return!t.canAddTable()||!t.canAddTable()}},{name:"cell-color",type:"icon",hasArrow:!0,icon:i.a.createElement("svg",{width:"22px",height:"22px",viewBox:"0 0 22 22",version:"1.1"},i.a.createElement("g",{stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},i.a.createElement("rect",{id:"Rectangle",fill:"#000000",opacity:"0",x:"0.0209008325",y:"3.41060513e-13",width:"22",height:"22"}),i.a.createElement("path",{d:"M4.89744078,8.47154846 L2.76042343,10.6085658 L1.87653995,9.72468234 L4.89744078,6.70378151 L4.89744078,5.56119865 C4.89744078,5.28505627 5.12129841,5.06119865 5.39744078,5.06119865 L14.3974408,5.06119865 C14.6735832,5.06119865 14.8974408,5.28505627 14.8974408,5.56119865 L14.8974408,15.5611986 C14.8974408,15.837341 14.6735832,16.0611986 14.3974408,16.0611986 L5.39744078,16.0611986 C5.12129841,16.0611986 4.89744078,15.837341 4.89744078,15.5611986 L4.89744078,8.47154846 Z M6.14744078,14.8111986 L13.6474408,7.31119865 L13.6474408,6.31119865 L6.14744078,6.31119865 L6.14744078,14.8111986 L6.14744078,14.8111986 Z M16.0186756,5.48204165 L17.8766924,6.11304067 C18.2571295,6.24323774 18.5690605,6.55585804 18.6983267,6.93649057 C18.8275929,7.3171231 18.7552188,7.70989336 18.5076914,7.97105752 C18.2465273,8.21858485 17.853757,8.29095894 17.4731245,8.16169276 C17.092492,8.03242657 16.7798717,7.72049558 16.6496746,7.34005851 L16.0186756,5.48204165 Z",id:"形状",fill:"#5C5C5C",transform:"translate(10.318960, 10.561199) rotate(-315.000000) translate(-10.318960, -10.561199) "}))),tooltip:"填充颜色",onClick:function(e,t){var n,o=null!==(n=t.lastBgColor)&&void 0!==n?n:Sl;t.setBgColor(o.value)},color:function(e,t){return t.lastBgColor.value},dropDownContent:m.e,dropDownContentProps:function(e,t){return{style:{width:120,maxHeight:483},defaultData:Sl,showSubPalette:!0,getData:function(){return t.lastBgColor},onItemClick:function(e,n,o){t.setBgColor(o.value)}}},onArrowClick:function(){}},{name:"cell-border",type:"icon",hasArrow:!0,icon:i.a.createElement("svg",{width:"22px",height:"22px",viewBox:"0 0 22 22",version:"1.1"},i.a.createElement("g",{stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},i.a.createElement("g",{id:"编组-17备份"},i.a.createElement("g",{id:"Group复制-3",opacity:"0",fill:"#000000"},i.a.createElement("rect",{id:"Rectangle",opacity:"0.0599999987",x:"0",y:"0",width:"22",height:"22"})),i.a.createElement("path",{d:"M11.61,4.75 L11.61,10.36 L17.25,10.36 L17.25,4.75 L11.61,4.75 Z M10.36,4.75 L4.75,4.75 L4.75,10.36 L10.36,10.36 L10.36,4.75 Z M4.75,11.61 L4.75,17.25 L10.36,17.25 L10.36,11.61 L4.75,11.61 Z M11.61,17.25 L17.25,17.25 L17.25,11.61 L11.61,11.61 L11.61,17.25 Z M4,3.5 L18,3.5 C18.2761424,3.5 18.5,3.72385763 18.5,4 L18.5,18 C18.5,18.2761424 18.2761424,18.5 18,18.5 L4,18.5 C3.72385763,18.5 3.5,18.2761424 3.5,18 L3.5,4 C3.5,3.72385763 3.72385763,3.5 4,3.5 Z",id:"形状结合",fill:"#5C5C5C"})))),tooltip:"边框",dropDownContent:fl,dropDownContentProps:function(e,t){return{type:t.getBorderType(),color:"black",onBorderInfo:function(e,n){t.setBorderColor(e,n)}}}},{name:"cell-merge",type:"icon",hasArrow:!1,icon:i.a.createElement("svg",{width:"22px",height:"22px",viewBox:"0 0 22 22",version:"1.1"},i.a.createElement("desc",null,"Created with Sketch."),i.a.createElement("g",{id:"_图标/工具栏/02_表格/合并单元格",stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},i.a.createElement("g",null,i.a.createElement("rect",{id:"Rectangle",fill:"#000000",opacity:"0",x:"0",y:"0",width:"22",height:"22"}),i.a.createElement("path",{d:"M11,8 L9.8,8 L9.8,4.7 L5.2,4.7 L5.2,17.3 L9.8,17.3 L9.8,14 L11,14 L11,18 C11,18.2761424 10.7761424,18.5 10.5,18.5 L4.5,18.5 C4.22385763,18.5 4,18.2761424 4,18 L4,4 C4,3.72385763 4.22385763,3.5 4.5,3.5 L10.5,3.5 C10.7761424,3.5 11,3.72385763 11,4 L11,8 Z M12,14 L13.2,14 L13.2,17.3 L17.8,17.3 L17.8,4.7 L13.2,4.7 L13.2,8 L12,8 L12,4 C12,3.72385763 12.2238576,3.5 12.5,3.5 L18.5,3.5 C18.7761424,3.5 19,3.72385763 19,4 L19,18 C19,18.2761424 18.7761424,18.5 18.5,18.5 L12.5,18.5 C12.2238576,18.5 12,18.2761424 12,18 L12,14 Z M8.5,11.5 L6.25,11.5 L6.25,10.5 L8.5,10.5 L8.5,9 L11,10.9746835 L11,11.0253165 L8.5,13 L8.5,11.5 Z M14.5,11.5 L14.5,13 L12,11.0253165 L12,10.9746835 L14.5,9 L14.5,10.5 L16.75,10.5 L16.75,11.5 L14.5,11.5 Z",id:"形状结合",fill:"#5C5C5C",fillRule:"nonzero"})))),tooltip:"合并单元格",onClick:function(e,t){t.canMerge()&&(t.mergeCell(),c.ReportHelper.tdwReport({opername:"doc_word_editor",module:"table",action:"table_merge",obj3:0}))},shouldDisabled:function(e,t){return!t.canMerge()}},{name:"align-vertical",type:"icon",hasArrow:!0,dropDownContent:m.v,dropDownContentProps:function(e,t){return{style:{width:70},listConfig:{items:r},defaultData:o.middle.data,onItemClick:function(e,n,o){t.setVerticalAlign(parseInt(o.value,10))}}},icon:function(e,t){var n=t.getVerticalAligin();return n===c.VerticalAlignmentType.AlignVerticalTop?o.top.icon:n===c.VerticalAlignmentType.AlignVerticalCenter?o.middle.icon:n===c.VerticalAlignmentType.AlignVerticalBottom?o.bottom.icon:o.middle.icon},tooltip:"垂直对齐"}]}}(),Dl=Al.menu,kl=Al.toolbar,jl=Al.contextMenu,Fl=function(){function e(e,t,n){var o=this;this.contextService=e,this.fileHandler=t,this.workbench=n,this._tableRangesCache={},this.lastBgColor=Sl,this.newDocument=function(){o.contextService.context.editor.once(c.RenderNotificationTypes.RENDER_FINISH,(function(){o.prepareTableRangesCache()}))},this.workbench.listen("$sectionChanged",(function(e){var t=e.cur,n=e.old;o.updateTablePadding(t,n)}))}var t;return t=e,e.prototype.$onInit=function(e){this._dragger=new yc,this.listen(e),e.registerPlugin(El(this)),e.surface.keymapManager.addKeymaps(Tl),e.clipboardManager.addCopyModelParser(c.LayoutInputNodeType.Table,Wc),e.clipboardManager.addPasteNodeProcessor(Ac),e.clipboardManager.addPasteDstProcessor(c.PasteDstType.Table,Kc),e.clipboardManager.addPasteDstProcessor(c.PasteDstType.Cell,Qc),e.clipboardManager.addPasteDeltaProcessor(Xc),e.addScrollContainer(Yc),e.on(c.StateNotification.NewDocument,this.newDocument),e.registerPlugin(El(this)),e.service.getDocument().getTableCount()>0&&c.ReportHelper.monitor(c.MonitorName.HAS_TABLE)},e.prototype.$beforeDestroy=function(e){e&&(e.removeCallBack(c.StateNotification.NewDocument,this.newDocument),e.removeListener(c.RenderNotificationTypes.TABLE_ROW_COL_CHANGE,this),e.removeListener(c.RenderNotificationTypes.SEL_TABLE,this)),this._dragger&&(this._dragger.unInit(),this._dragger=null)},e.prototype.prepareTableRangesCache=function(){var e=this.contextService.context.editor;this._tableRangesCache=e.service.getDocument().getTableRangesMap()},e.prototype.checkTablesStructure=function(e,t){var n=this.contextService.context.editor,o=n.service.getDocument().getTableRangesMap(),r=Object.keys(o);if(e.globalOpts.fromServer||e.msg&&e.msg.startsWith("tablefix")||"revertforfix"===e.msg)return!0;var i=t.get(c.StoryID.MainDocId);if(!i)return!0;for(var a=0;a<r.length;a++){var s=r[a];if(!this._tableRangesCache[s]||o[s].length()!==this._tableRangesCache[s].length()){var l=n.service.getDocument().getTable(s);if(!l)continue;var p=l.range;if(!p)continue;if(n&&i.intersect(p)&&!l.checkData())return this.showFixTipsForTable(s),g.Logger.error("table check failed, delta msg:"+e.msg+", tableId:"+s+" "),c.ReportHelper.captureException(c.MonitorName.TABLE_DATA_CHECK_FAILED,{extra:{from:e.msg,tableId:s}}),!1}this._tableRangesCache[s]=o[s]}return!0},e.prototype.showFixTipsForTable=function(e){var t=this;P.a.show({message:"表格内容出现异常。",type:"error",closable:!0,autoClose:!1,action:"立即处理",onClickAction:function(){t.fixTable(e),t.showFixResultTipForTable(e)}})},e.prototype.showFixResultTipForTable=function(e){var t=this.contextService.context.editor.service.getDocument().getTable(e);!t||t.checkData()?this.showFixSuccessTip():this.showFixFailedTip(e)},e.prototype.contactUSForTable=function(e){this.fileHandler.goFeedbackPage(Object(M.c)(),"table fix error"+e)},e.prototype.showFixFailedTip=function(e){var t=this;c.ReportHelper.captureException(c.MonitorName.TABLE_DATA_FIX_FAILED,{extra:{tableId:e}}),g.Logger.error("table check failed, tableId:"+e+" "),setTimeout((function(){p.a.getInstance().disableEditForKey("table_check_failed"),g.Logger.error("table fix failed:"+e),P.a.show({message:"表格修复失败，请联系我们进行处理。",type:"error",autoClose:!1,action:"联系我们",onClickAction:function(){t.contactUSForTable(e)}})}),50)},e.prototype.showFixSuccessTip=function(){P.a.show({message:"处理成功。",type:"success",duration:3e3,autoClose:!0})},e.prototype.fixTable=function(e){var t=this.contextService.context.editor.service.getDocument().getTable(e);t&&t.fixTable()},e.prototype.mergeCell=function(){this.tableCellRangeAll?this.contextService.context.editor.service.getSelection().getTableRangeSevice().merge():g.Logger.error("mergeCell range is empty")},e.prototype.canMerge=function(){var e=this.contextService.context.editor,t=this.tableCellRange;if(t){var n=t.cellRange,o=e.service.getSelection().getTable();return!!o&&o.canMerge(n)}return!1},e.prototype.canSplit=function(){var e=this.tableCellRangeAll;if(e){var t=this.contextService.context.editor,n=e.cellRange,o=t.service.getSelection().getTable();return!!o&&o.isSingleRange(n)}return!1},e.prototype.listen=function(e){e.on(c.RenderNotificationTypes.TABLE_ROW_COL_CHANGE,(function(t){var n=t.edge,o=t.firstIndex,r=t.twips,i=t.diffLeft,a=t.diffRight,s=e.getRangeFromIndex(o,o),c=e.service.getDocument().getTableFullInfoFromGcp(s.gcpBegin);if(c&&c.tableCellProp){var l=e.service.getDocument().getTables().getItemForTableId(c.tableProp.tableId);if(!l)return;if("top"===n||"bottom"===n){var p=c.rowIndex-1;"bottom"===n&&(p+=Math.max(c.tableCellProp.rowSpan,0)),p>=0&&l.getRow(p).setRowHeight(r)}else if("left"===n||"right"===n){var u=c.cellIndex-1;"right"===n&&(u+=Math.max(c.tableCellProp.colSpan,0));var d=l.getCol(Math.max(u,0));d&&(-1===u?d.setColWidth(r,i):u===c.colCount-1?d.setColWidth(r,void 0,a):d.setColWidth(r))}}}),this),e.on(c.RenderNotificationTypes.SEL_TABLE,(function(t){if(e.isEditable()){var n=t.firstIndex,o=e.getRangeFromIndex(n,n),r=e.service.getDocument().getTableFromGcp(o.gcpBegin);r&&r.selectAll()}}),this)},e.prototype.addTable=function(e,t){var n=this.contextService.context.editor;if(n.service.getDocument().getTableCount()>=Ct.MAX_TABLE_COUNT)P.a.show({message:"超过表格上限，请删除其他表格后插入。",duration:5e3,autoClose:!0}),c.ReportHelper.tdwReport({opername:"doc_word_editor",module:"table",action:"reach_limit_merge"});else{var o=n.service.getSelection().range();n.service.getSelection().getTables().add(o,e,t),c.ReportHelper.tdwReport({opername:"doc_word_editor",module:"table",action:"insert_table_gray"})}},e.prototype.insertRow=function(e,t){var n=this.contextService.context.editor,o=this.tableCellRangeAll;if(o){var r=o.cellRange,i=n.service.getSelection().getTable();if(!i)return;var a=null;if(t===c.InsertTableDirection.below){var s=(l=r.to.row)+1;a=i.insertRow(s,e,l,t)}else if(t===c.InsertTableDirection.above){var l;s=l=r.from.row;a=i.insertRow(s,e,l,t)}if(c.ReportHelper.tdwReport({opername:"doc_word_editor",module:"table",action:"table_insert_row"}),a){var p=a.leftTopCell();p&&p.setCaretStart()}}},e.prototype.removeRow=function(){var e=this.contextService.context.editor,t=this.tableCellRangeAll;if(t){var n=t.cellRange,o=n.from.row,r=n.to.row-n.from.row+1,i=e.service.getSelection().getTable();if(!i)return;var a=i.getTableInfo();if(!a)return;a.rowCount===r?(i.remove(),c.ReportHelper.tdwReport({opername:"doc_word_editor",module:"table",action:"table_delete"})):(i.removeRow(o,r),c.ReportHelper.tdwReport({opername:"doc_word_editor",module:"table",action:"table_delete_row"}))}},e.prototype.insertCol=function(e,t){var n=this.contextService.context.editor,o=this.tableCellRangeAll;if(o){var r=o.cellRange,i=n.service.getSelection().getTable();if(!i)return;if(t===c.InsertTableDirection.right){var a=(s=r.to.col)+1;i.insertCol(a,e,s,t)}else if(t===c.InsertTableDirection.left){var s;a=s=r.from.col;i.insertCol(a,e,s,t)}c.ReportHelper.tdwReport({opername:"doc_word_editor",module:"table",action:"table_insert_column"})}},e.prototype.removeCol=function(){var e=this.contextService.context.editor,t=this.tableCellRangeAll;if(t){var n=t.cellRange,o=n.from.col,r=n.to.col-n.from.col+1,i=e.service.getSelection().getTable();if(!i)return;var a=i.getTableInfo();if(!a)return;a.colCount===r?(i.remove(),c.ReportHelper.tdwReport({opername:"doc_word_editor",module:"table",action:"table_delete"})):(i.removeCol(o,r),c.ReportHelper.tdwReport({opername:"doc_word_editor",module:"table",action:"table_delete_column"}))}},Object.defineProperty(e.prototype,"tableCellRangeAll",{get:function(){return this.contextService.context.editor.selection.tableCellRangeAll},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tableCellRange",{get:function(){return this.contextService.context.editor.selection.tableCellRange},enumerable:!0,configurable:!0}),e.prototype.setBgColor=function(e){var t=this.contextService.context.editor;this.lastBgColor={alias:e,value:e},t.service.getSelection().getTableRangeSevice().setBgColor(e)},e.prototype.setVerticalAlign=function(e){var t="";switch(e){case c.VerticalAlignmentType.AlignVerticalTop:t="alignment_up_set";break;case c.VerticalAlignmentType.AlignVerticalCenter:t="alignment_center_set";break;case c.VerticalAlignmentType.AlignVerticalBottom:t="alignment_below_set"}c.ReportHelper.tdwReport({opername:"doc_word_editor",module:"table",action:t}),this.contextService.context.editor.service.getSelection().getTableRangeSevice().setVerticalAlign(e)},e.prototype.getVerticalAligin=function(){return this.tableCellRangeAll?this.contextService.context.editor.service.getSelection().getTableRangeSevice().getVerticalAlign():c.VerticalAlignmentType.AlignVerticalCenter},e.prototype.setBorderColor=function(e,t){var n=this.contextService.context.editor;n.service.getSelection().getTableRangeSevice().setBorderColor(e,t);var o=this.tableCellRangeAll;if(o){var r=void 0,i=o.cellRange,a=i.to.row-i.from.row+1,s=i.to.col-i.from.col+1,l=n.service.getSelection().getTable();if(!l)return;var p=l.getTableInfo();if(!p)return;r=p.rowCount===a&&p.colCount===s+1?0:1,c.ReportHelper.tdwReport({opername:"doc_word_editor",module:"table",action:"table_borderline_color",obj3:r,ver1:null===t?"0":t})}},e.prototype.getBorderType=function(){return this.tableCellRangeAll?this.contextService.context.editor.service.getSelection().getTableRangeSevice().getBorderType():c.BORDER_STYLE.BORDER_ALL},e.prototype.clearRangeContent=function(){return this.contextService.context.editor.service.getSelection().getTableRangeSevice().clearContent()},e.prototype.setCaretNextCell=function(e,t){var n=this.contextService.context.editor.service.getSelection().getTables().item(0);return!!n&&n.setCaretNextCell(e,t)},e.prototype.setCaretPrevCell=function(e,t){var n=this.contextService.context.editor.service.getSelection().getTables().item(0);return!!n&&n.setCaretPrevCell(e,t)},e.prototype.setCaretPrev=function(){if(!this.tableCellRangeAll)return!1;var e=this.contextService.context.editor,t=e.service.getSelection().getTables().item(0);if(!t||!t.range)return!1;var n=this.tableCellRangeAll.cellRange.from,o=t.getCell(n.row,n.col),r=e.service.getSelection().range().begin();if(!o||!o.contentRange||r!==o.contentRange.begin())return!1;var i=o.prev(!0);if(i)i.setCaretEnd();else{var a=Math.max(t.range.begin()-1,0);e.service.getSelection().setRange(a,a)}return!0},e.prototype.setCaretNext=function(){if(!this.tableCellRangeAll)return!1;var e=this.contextService.context.editor,t=e.service.getSelection().getTables().item(0);if(!t||!t.range)return!1;var n=this.tableCellRangeAll.cellRange.from,o=t.getCell(n.row,n.col),r=e.service.getSelection().range().begin();if(!o||!o.range||r!==o.range.end()-1)return!1;var i=o.next(!0);if(i)i.setCaretStart();else{var a=t.range.end();e.service.getSelection().setRange(a,a)}return!0},e.prototype.tableCellSplit=function(e,t){var n=this.contextService.context.editor.service.getSelection().getTables().item(0);if(n&&this.tableCellRangeAll){var o=this.tableCellRangeAll.cellRange.from,r=o.row,i=o.col;n.split(r,i,e,t)}c.ReportHelper.tdwReport({opername:"doc_word_editor",module:"table",action:"table_split",obj3:e+"-"+t,ver1:"1"})},e.prototype.getRowCount=function(){return this.contextService.context.editor.service.getSelection().getTableRangeSevice().getRowCount()},e.prototype.getColCount=function(){return this.contextService.context.editor.service.getSelection().getTableRangeSevice().getColCount()},e.prototype.setAlignment=function(e){this.contextService.context.editor.service.getSelection().getParagraphFormat().setAlignment(e)},e.prototype.getAlignment=function(){return this.contextService.context.editor.service.getSelection().getParagraphFormat().getAlignment()},e.prototype.clearFormatting=function(){this.contextService.context.editor.service.getSelection().clearFormatting()},e.prototype.getPrevTable=function(){var e=this.contextService.context.editor,t=e.service.getSelection().range();return t&&t.begin()>1?e.service.getDocument().getTableFromGcp(t.begin()-1):null},e.prototype.getNextTable=function(){var e=this.contextService.context.editor,t=e.service.getSelection().range();if(t){var n=e.service.getDocument().getTableFromGcp(t.begin()+1);if(n&&n.range&&n.range.begin()===t.begin()+1)return n}return null},e.prototype.selCurTable=function(){var e=this.contextService.context.editor.service.getSelection().getTables().item(0);e&&e.selectAll()},e.prototype.removeTable=function(){var e=this.contextService.context.editor.service.getSelection().getTables().item(0),t=e&&e.getTableId();e&&t&&(e.remove(),c.ReportHelper.tdwReport({opername:"doc_word_editor",module:"table",action:"table_delete"}))},e.prototype.isListCellHead=function(){var e=this.contextService.context.editor.service.getSelection();return e.isSelectionBelongsToSameList()&&(e.isSelectionCollapseAtParaStart()||e.isSelectAllParagraph())},e.prototype.canAddTable=function(){var e=this.contextService.context.editor,t=e.onSelection();return!!e.isEditable()&&(t.storyType()===c.TDStoryType.MainTextStory&&!this.tableCellRangeAll)},e.prototype.clearInRange=function(e,t){var n=e.getTableInfo();if(n){var o=t;n.rowCount===o.to.row-o.from.row+1&&n.colCount===o.to.col-o.from.col+1?this.removeTable():this.clearRangeContent()}},e.prototype.getMergeCellRanges=function(){return this.tableCellRangeAll?this.contextService.context.editor.service.getSelection().getTableRangeSevice().getMergeCellRanges():null},e.prototype.getInsertRowCount=function(){var e,t,n,o,r=1;if(!this.tableCellRangeAll)return 0;if(!this.tableCellRange)return 1;var i=this.tableCellRangeAll.cellRange,a=Object(c.countRows)(i),s=this.getMergeCellRanges();if(s&&s.length>0)if(e=i.from.row,t=i.from.col,n=i.to.row,o=i.to.col,e===n)r=1;else for(var l=t;l<=o;l++){for(var p=0,u=0;u<s.length;u++){var d=s[u];d.from.col<=l&&d.to.col>=l&&d.from.row>=e&&d.to.row<=n&&(p+=Math.abs(d.to.row-d.from.row))}var h=a-p;r=Math.max(r,h)}else r=a;return r},e.prototype.getInsertColCount=function(){var e,t,n,o,r=1;if(!this.tableCellRangeAll)return 0;if(!this.tableCellRange)return 1;var i=this.tableCellRangeAll.cellRange,a=Object(c.countCols)(i),s=this.getMergeCellRanges();if(s&&s.length>0)if(e=i.from.row,t=i.from.col,n=i.to.row,t===(o=i.to.col))r=1;else for(var l=e;l<=n;l++){for(var p=0,u=0;u<s.length;u++){var d=s[u];d.from.row<=l&&d.to.row>=l&&d.from.col>=t&&d.to.col<=o&&(p+=Math.abs(d.to.col-d.from.col))}var h=a-p;r=Math.max(r,h)}else r=a;return r},e.prototype.updateTablePadding=function(e,t){var n,o,r=this.contextService.context.editor,i=void 0!==e.marginLeft&&void 0!==t.marginLeft?e.marginLeft-t.marginLeft:0,a=void 0!==e.marginRight&&void 0!==t.marginRight?e.marginRight-t.marginRight:0,s=r.service.getDocument().getTables();try{for(var c=Nl(s),l=c.next();!l.done;l=c.next()){var p=l.value,u=p.getTableInfo();if(u&&u.tableProp){var d=0!==i?Math.max(u.tableProp.paddingLeft+i,Object(g.pxToTwips)(1)):void 0,h=0!==a?Math.max(u.tableProp.paddingRight+a,Object(g.pxToTwips)(1)):void 0;p.setPadding(d,h)}}}catch(e){n={error:e}}finally{try{l&&!l.done&&(o=c.return)&&o.call(c)}finally{if(n)throw n.error}}},e.prototype.showRowColInput=function(){var e=this;this._modal=V.Modal.confirm({title:"自定义行列数",footer:null,content:i.a.createElement(Ol,{handler:t,onCreate:function(t,n){e.hideRowColInput(),e.addTable(t,n)},onCancel:function(){e.hideRowColInput()}}),onCancel:function(){e._modal=null}})},e.prototype.hideRowColInput=function(){this._modal&&(this._modal.close(),this._modal=null)},e=t=Ll([Object(m.i)({name:y.a.Table,scope:0,for:["melo"],menuItems:Dl,toolbarItems:kl,contextMenuItems:jl}),Ml("design:paramtypes",[m.f,ee,m.B])],e)}();var Hl={menuPara:[],contextMenuPara:[{name:"paragraph-format",content:"段落格式"}],toolbarPara:[{name:"inc-indent",type:"icon",hasArrow:!1,icon:i.a.createElement("svg",{width:"22px",height:"22px",viewBox:"0 0 22 22",version:"1.1"},i.a.createElement("g",{stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},i.a.createElement("g",null,i.a.createElement("rect",{id:"矩形-cop",x:"0",y:"0",width:"22",height:"22"}),i.a.createElement("path",{d:"M9,8.5 L18,8.5 L18,9.75 L9,9.75 L9,8.5 Z M9,12.25 L18,12.25 L18,13.5 L9,13.5 L9,12.25 Z M4,11 L7,8 L7,14 L4,11 Z M4,4.75 L18,4.75 L18,6 L4,6 L4,4.75 Z M4,16 L18,16 L18,17.25 L4,17.25 L4,16 Z",id:"形状结合",fill:"#5C5C5C",transform:"translate(11.000000, 11.000000) scale(-1, 1) translate(-11.000000, -11.000000) "})))),tooltip:"增加缩进",shortcut:{win:"Ctrl+M",mac:"⌘+M"}},{name:"desc-indent",type:"icon",hasArrow:!1,icon:i.a.createElement("svg",{width:"22px",height:"22px",viewBox:"0 0 22 22",version:"1.1"},i.a.createElement("g",{stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},i.a.createElement("g",null,i.a.createElement("rect",{id:"矩形-copy",x:"0",y:"0",width:"22",height:"22"}),i.a.createElement("path",{d:"M9,8.5 L18,8.5 L18,9.75 L9,9.75 L9,8.5 Z M9,12.25 L18,12.25 L18,13.5 L9,13.5 L9,12.25 Z M4,11 L7,8 L7,14 L4,11 Z M4,4.75 L18,4.75 L18,6 L4,6 L4,4.75 Z M4,16 L18,16 L18,17.25 L4,17.25 L4,16 Z",id:"形状结合",fill:"#5C5C5C"})))),tooltip:"减少缩进",shortcut:{win:"Ctrl+Shift+M",mac:"⌘+Shift+M"}}]},Bl=Hl.menuPara,Ul=Hl.contextMenuPara,Vl=Hl.toolbarPara,Wl={menuFont:[],contextMenuFont:[],toolbarFont:[{name:"bold",type:"icon",hasArrow:!1,icon:i.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"},i.a.createElement("g",{fill:"none",fillRule:"evenodd"},i.a.createElement("g",{stroke:"#464D5A",strokeWidth:"1.3"},i.a.createElement("path",{d:"M5.5.65H.65v5.7H5.5c.787 0 1.5-.319 2.015-.835C8.031 5 8.35 4.287 8.35 3.5c0-.787-.319-1.5-.835-2.015C7 .969 6.287.65 5.5.65zM6.25 6.4H.65v6.2h5.6c.856 0 1.631-.347 2.192-.908.561-.561.908-1.336.908-2.192 0-.856-.347-1.631-.908-2.192C7.881 6.747 7.106 6.4 6.25 6.4z",transform:"translate(7 5.5)"})))),tooltip:"加粗",shortcut:{win:"Ctrl+B",mac:"⌘+B"}},{name:"italic",type:"icon",hasArrow:!1,icon:i.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"},i.a.createElement("g",{fill:"none",fillRule:"evenodd"},i.a.createElement("path",{fill:"#464D5A",d:"M13 6L14.5 6 10.5 18 9 18z"}),i.a.createElement("path",{fill:"#464D5A",d:"M10.625 5.75h5.25c.345 0 .625.28.625.625S16.22 7 15.875 7h-5.25C10.28 7 10 6.72 10 6.375s.28-.625.625-.625zM7.125 17h5.75c.345 0 .625.28.625.625s-.28.625-.625.625h-5.75c-.345 0-.625-.28-.625-.625S6.78 17 7.125 17z"}))),tooltip:"倾斜",shortcut:{win:"Ctrl+I",mac:"⌘+I"}},{name:"underline",type:"icon",hasArrow:!1,icon:i.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"},i.a.createElement("g",{fill:"none",fillRule:"evenodd"},i.a.createElement("path",{fill:"#464D5A",d:"M18 18.3v1.3H5v-1.3h13zM8.4 5v7.5c0 1.653 1.294 3.004 2.924 3.095l.176.005c1.653 0 3.004-1.294 3.095-2.924l.005-.176V5H16v7.5c0 2.485-2.015 4.5-4.5 4.5S7 14.985 7 12.5V5h1.4z"}))),tooltip:"下划线",shortcut:{win:"Ctrl+U",mac:"⌘+U"}},{name:"strike-through",type:"icon",hasArrow:!1,icon:i.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"},i.a.createElement("g",{fill:"none",fillRule:"evenodd"},i.a.createElement("g",{fill:"#464D5A"},i.a.createElement("path",{d:"M9.743 7.443c.206.17.396.36.566.568.485.622.73 1.405.686 2.2.008.687-.182 1.361-.545 1.94-.38.59-.916 1.059-1.545 1.352-.734.344-1.535.513-2.342.496-.876.009-1.743-.175-2.544-.537-.763-.349-1.45-.85-2.019-1.476l.909-1.033c.472.53 1.042.962 1.675 1.27.631.307 1.321.466 2.02.465.76.04 1.512-.185 2.13-.64.806-.704 1.017-1.89.504-2.84-.18-.297-.43-.545-.726-.722-.406-.236-.824-.45-1.252-.64l-.889-.403h3.372zM6.715 0c1.447-.005 2.833.596 3.836 1.662l-.808.97c-.796-.832-1.89-1.297-3.028-1.29-.666-.02-1.319.195-1.848.61-.46.364-.723.932-.707 1.527-.006.371.107.734.323 1.032.201.278.455.51.748.682.282.186.656.35 1.14.568l.073.032H3.563c-.045-.044-.088-.089-.13-.136-.523-.579-.795-1.35-.757-2.137-.007-.644.172-1.276.515-1.817.38-.55.9-.982 1.504-1.249C5.327.151 6.017-.004 6.715 0z",transform:"translate(5 5)"}),i.a.createElement("path",{d:"M0 7H14V8.25H0z",transform:"translate(5 5)"})))),tooltip:"删除线",shortcut:{win:"Ctrl+D",mac:"⌘+D"}},{name:"heading",hasArrow:!0,type:"text",text:function(){return"正文"},tooltip:"设置标题，可生成目录",style:{width:54},dropDownContent:m.v,dropDownContentProps:function(){return{style:{width:152}}}},{name:"font",hasArrow:!0,type:"text",text:function(){return"默认字体"},tooltip:"字体",style:{width:68},dropDownContent:m.v,dropDownContentProps:function(){return{style:{width:230}}}},{name:"font-size",type:"text",hasArrow:!0,tooltip:"字号",text:function(){return"四号"},style:{width:40},dropDownContent:m.v,dropDownContentProps:function(){return{style:{width:90}}}},{name:"format-paint",hasArrow:!1,type:"icon",tooltip:"格式刷，双击可重复使用",icon:i.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"},i.a.createElement("g",{fill:"none",fillRule:"evenodd"},i.a.createElement("path",{fill:"#464D5A",d:"M13.5 14v4.078L10.5 20v-6h3zm5-9c.276 0 .5.224.5.5v5c0 .276-.224.5-.5.5h-4.231l-1.519 1.488V14H11.5v-2l.007-.001L12.525 11H5.5c-.276 0-.5-.224-.5-.5v-5c0-.276.224-.5.5-.5h13zm-.75 1.25H6.25v3.5h11.5v-3.5z"})))},{name:"clear-format",hasArrow:!1,type:"icon",tooltip:"清除格式",icon:i.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"},i.a.createElement("g",{fill:"none",fillRule:"evenodd"},i.a.createElement("path",{fill:"#464D5A",d:"M5 18.25H19V19.5H5z"}),i.a.createElement("path",{fill:"#464D5A",fillRule:"nonzero",d:"M13.353 4.974l5.4 5.4c.166.166.18.427.045.62l-.058.068L12.801 17h-1.689l2.931-2.93-4.387-4.387-4.028 4.027L8.918 17H7.166l-2.919-2.92c-.186-.186-.18-.494.013-.687l8.405-8.406c.194-.194.502-.2.688-.013z"}),i.a.createElement("path",{fill:"#464D5A",d:"M7 15.75L13 15.75 12 17 8 17z"})))}]},Gl=Wl.menuFont,zl=Wl.contextMenuFont,Kl=Wl.toolbarFont;var ql,Zl,$l,Ql=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Xl=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Yl=(ql=[],Zl=[],{menu:[].concat(Bl).concat(Gl).concat([{name:"spellcheck",content:"智能纠错",shouldDisabled:function(){return!0}}]).concat([{name:"markdown",content:"Markdown",shouldDisabled:function(){return!0}}]),contextMenu:ql=(ql=ql.concat(Ul)).concat(zl),toolbar:Zl=(Zl=Zl.concat(Vl)).concat(Kl)}),Jl=Yl.menu,ep=Yl.contextMenu,tp=Yl.toolbar,np=function(){function e(e){this.contextService=e,this.context=e.context}return e.prototype.$onInit=function(e){},e.prototype.$beforeDestroy=function(e){},e=Ql([Object(m.i)({name:y.a.ReadonlyToolbar,scope:0,for:["melo"],menuItems:Jl,contextMenuItems:ep,toolbarItems:tp}),Xl("design:paramtypes",[m.f])],e)}(),op=n(392),rp=n.n(op),ip=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),ap=function(){return(ap=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},sp=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ip(t,e),t.prototype.getHeightStyle=function(){var e=Object(g.twipsToPx)(this.props.lineHeight)+"px";return{height:e,lineHeight:e}},t.prototype.render=function(){return i.a.createElement("div",{className:rp.a["title-default-add-placeholder"]+" title-default-add-placeholder",style:ap(ap({},this.props.fontStyle),this.getHeightStyle())},this.props.content)},t}(i.a.Component);!function(e){e.BACKSPACE="backspace",e.ENTER="enter"}($l||($l={}));var cp,lp=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},pp=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)a.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return a},up=function(){function e(){}return e.prototype.$onInit=function(e){var t,n,o=this;c.Defaults.curDocDataVersion<c.Defaults.newDefaultStyleVersion||(e.addDecorator(c.DecoratorTypes.LinePlaceholder,(function(t,n,r){return o.shouldDecorate(t)?o.getDecorator(e,t,n,r):null})),e.registerPlugin((t=this,(n={})[$l.BACKSPACE]=function(e,n){if(e&&e instanceof c.MeloEditor&&e.isEditable()&&c.Defaults.curDocDataVersion>=c.Defaults.newDefaultStyleVersion){var o=e,r=o.service.getSelection(),i=r.range().gcpBegin;t&&o.isCaret()&&0===i&&t.isFirstParaEmpty(o)&&t.isFirstParaHeadingHolderStyle(o)&&r.delete()}n()},n[$l.ENTER]=function(e,n){if(e&&e instanceof c.MeloEditor&&e.isEditable()&&c.Defaults.curDocDataVersion>=c.Defaults.newDefaultStyleVersion){var o=e,r=o.service.getSelection(),i=r.range().gcpBegin,a=o.service.getDocument(),s=a.getFirstParaRange();t&&o.isCaret()&&s&&i===s.end()-1&&a.isParaCountMoreThan(1)&&!a.isParaCountMoreThan(2)&&t.isFirstParaHeadingHolderStyle(o,!0)&&t.isSecondParaEmpty(o)&&t.isSecondParaNormalHolderStyle(o)?r.setRange(s.end(),s.end()):n()}else n()},n)))},e.prototype.isFirstParaEmpty=function(e){var t=e.service.getDocument(),n=t.getFirstParaRange();return!!n&&t.isParaEmpty(n.gcpBegin)},e.prototype.isSecondParaEmpty=function(e){var t=e.service.getDocument(),n=t.getFirstParaRange();return!!n&&t.isParaEmpty(n.end())},e.prototype.isFirstParaHeadingHolderStyle=function(e,t){void 0===t&&(t=!1);var n=e.service.getDocument(),o=n.getFirstParaRange();if(o){var r=n.getParaStyleAtRange(o);if(r.length>0){var i=pp(r,1)[0];return n.isParaHeading(i,c.BuiltinStyleName.Title)&&i.textAlignment===c.TextAlignmentType.Left&&(!!t||i.listId===c.Defaults.paragraph.listId)&&(!!t||this.isParaNoIndent(i))}}return!1},e.prototype.isFirstParaNormalHolderStyle=function(e,t){void 0===t&&(t=!1);var n=e.service.getDocument(),o=n.getFirstParaRange();if(o){var r=n.getParaStyleAtRange(o);if(r.length>0){var i=pp(r,1)[0];return!n.isParaHeading(i)&&i.textAlignment===c.TextAlignmentType.Left&&(!!t||i.listId===c.Defaults.paragraph.listId)&&(!!t||this.isParaNoIndent(i))}}return!1},e.prototype.isSecondParaNormalHolderStyle=function(e,t){void 0===t&&(t=!1);var n=e.service.getDocument(),o=n.getFirstParaRange();if(o){var r=n.getParaStyleAtRange(new c.GCPRange(o.end(),0));if(r.length>0){var i=pp(r,1)[0];return!n.isParaHeading(i)&&i.textAlignment===c.TextAlignmentType.Left&&(!!t||i.listId===c.Defaults.paragraph.listId)&&(!!t||this.isParaNoIndent(i))}}return!1},e.prototype.isParaNoIndent=function(e){return e.specialIndent===c.Defaults.paragraph.specialIndent&&e.characterUnitSpecialIndent===c.Defaults.paragraph.characterUnitSpecialIndent&&e.leftIndent===c.Defaults.paragraph.leftIndent&&e.characterUnitLeftIndent===c.Defaults.paragraph.characterUnitLeftIndent&&e.rightIndent===c.Defaults.paragraph.rightIndent&&e.characterUnitRightIndent===c.Defaults.paragraph.characterUnitRightIndent},e.prototype.getHolderFontStyle=function(e,t){var n=e.service.getDocument().getOutlineStyleProps(t);return n&&n.spanProperty?{fontFamily:n.spanProperty.fontFamily,fontSize:Object(g.twipsToPt)(n.spanProperty.fontSize)+"pt",fontWeight:n.spanProperty.fontWeight}:{}},e.prototype.shouldDecorate=function(e){return!!e&&(!!e.isFirst&&(!!e.parentBox&&(!!Object(c.isParagraphBox)(e.parentBox)&&0===this.getCurLogicPageIndex(e.parentBox))))},e.prototype.getCurLogicPageIndex=function(e){if(e.parentBox)return Object(c.isLogicPageBox)(e.parentBox)?e.parentBox.getSiblingIndex():this.getCurLogicPageIndex(e.parentBox)},e.prototype.getDecorator=function(e,t,n,o){var r=e.service.getDocument().isParaCountMoreThan(1),a=e.service.getDocument().isParaCountMoreThan(2);if(n&&this.isFirstParaEmpty(e)){if(this.isFirstParaHeadingHolderStyle(e)){var s="请输入标题",l=t.rect.height;return i.a.createElement(sp,{key:o,content:s,fontStyle:this.getHolderFontStyle(e,c.BuiltinStyleType.Title),lineHeight:l})}if(!r&&this.isFirstParaNormalHolderStyle(e)){s="请输入正文",l=t.rect.height;return i.a.createElement(sp,{key:o,content:s,fontStyle:this.getHolderFontStyle(e,c.BuiltinStyleType.Normal),lineHeight:l})}}if(!a&&!n&&this.isSecondParaEmpty(e)&&this.isFirstParaHeadingHolderStyle(e,!0)&&this.isSecondParaNormalHolderStyle(e)){s="请输入正文",l=t.rect.height;return i.a.createElement(sp,{key:o,content:s,fontStyle:this.getHolderFontStyle(e,c.BuiltinStyleType.Normal),lineHeight:l})}return null},e=lp([Object(m.i)({name:y.a.TitleDefaultAdd,scope:0,for:["melo"]})],e)}(),dp=n(482),hp=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},fp=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},mp=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)a.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return a},gp=function(){function e(e,t){var n=this;this.contextService=e,this.store=t,this.context=e.context,t.get("zoomLevel").pipe(Object(dp.a)()).subscribe((function(e){var t=mp(e,2),o=t[0],r=t[1];n.context.editors.filter((function(e){return e instanceof c.MeloEditor})).forEach((function(e){e.zoom=r,e.fire(new c.ZoomNotification(c.ZoomNotificationType.ZOOM_FINISH,o,r))}))}))}return e=hp([Object(m.i)({name:y.a.ZoomMelo,scope:0,for:["melo"]}),fp("design:paramtypes",[m.f,m.x])],e)}(),yp=n(487),vp=function(){this.url="",this.type="",this.source="",this.target="",this.text="",this.index=0,this.retry=0},bp=function(){function e(){this.waitingPool=[],this.sendingPool=[]}return e.prototype.addAjax=function(t){this.sendingPool.length<e.maxLen?this.send(t):this.waitingPool.push(t)},e.prototype.abort=function(){this.sendingPool.forEach((function(e){e.ajaxItem.abort()})),this.sendingPool=[],this.waitingPool=[]},e.prototype.send=function(t){var n=this,o=w.a.ajax({url:t.url,type:t.type,timeout:3e3,data:{source:t.source,target:t.target,text:t.text,pass_text:t.index,bkn:this.getBkn(),xsrf:Object(c.getXsrf)()},xhrFields:{withCredentials:!0},success:function(o){if("object"!=typeof o)try{o=JSON.parse(o)}catch(e){o={}}if(0===o.retcode||o.retcode===e.noSupport||o.retcode===e.noSupportOld){for(var r=0;r<n.sendingPool.length;r++)if(t===n.sendingPool[r].item){n.sendingPool.splice(r,1);break}if(n.waitingPool.length>0){var i=n.waitingPool.shift();i&&n.send(i)}t.successCb&&t.successCb(t.index,o,n.isFinished())}else n.handleError(t,o)},error:function(e){n.handleError(t,e)}});this.sendingPool.push({item:t,ajaxItem:o})},e.prototype.handleError=function(t,n){g.Logger.log("translate retcode ",n);for(var o=0;o<this.sendingPool.length;o++)if(t===this.sendingPool[o].item){this.sendingPool.splice(o,1);break}if(t.retry<e.maxRetry)t.retry+=1,this.send(t);else{if(this.waitingPool.length>0){var r=this.waitingPool.shift();r&&this.send(r)}t.errorCb&&t.errorCb(t.index,n,this.isFinished())}},e.prototype.getBkn=function(){var e=Object(c.getCookie)("p_skey");if(!e)return"";for(var t=e.slice(0,10),n=5381,o=0;o<t.length;o++)n+=(n<<5)+t.charCodeAt(o);return 2147483647&n},e.prototype.isFinished=function(){return 0===this.sendingPool.length&&0===this.waitingPool.length},e.maxLen=6,e.maxRetry=3,e.noSupportOld=-1001,e.noSupport=-2003,e}(),Cp=n(266),_p=n.n(Cp),wp=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();!function(e){e[e.UNSUPPORTED=0]="UNSUPPORTED",e[e.ERROR=1]="ERROR"}(cp||(cp={}));var Rp,Sp=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return wp(t,e),t.prototype.onClick=function(){this.props.failType===cp.UNSUPPORTED?this.props.handler.closeTranslate():(this.props.handler.removeFailView(),this.props.handler.checkLanguage())},t.prototype.render=function(){var e=this.props.failType===cp.UNSUPPORTED?"暂不支持翻译此语言。":"翻译失败，请稍后重试。",t=this.props.failType===cp.UNSUPPORTED?"退出翻译":"重新翻译";return i.a.createElement("div",null,i.a.createElement("div",{className:_p.a["fail-icon"]}),i.a.createElement("div",{className:_p.a["fail-text"]},e,i.a.createElement("span",{className:_p.a["btn-text"],onClick:this.onClick.bind(this)},t)))},t}(i.a.Component);!function(e){e.UNDEFINED="undefined",e.UNSUPPORTED="unspported",e.AUTO="auto",e.CHINESE="zh",e.ENGLISH="en"}(Rp||(Rp={}));var Ep=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Tp=function(e){function t(t){var n=e.call(this,t)||this;return n.state={disable:!0,visible:!0},n}return Ep(t,e),t.prototype.onClick=function(){this.state.disable||this.props.handler.saveTranslate()},t.prototype.render=function(){return i.a.createElement("div",{className:_p.a["translate-page-btn"]+" "+(this.state.disable?_p.a.disable:""),onClick:this.onClick.bind(this),style:{visibility:this.state.visible?"visible":"hidden"}},i.a.createElement("div",{className:_p.a["translate-save-btn-icon"]}),i.a.createElement("span",{className:_p.a["translate-page-btn-text"]},"生成新文档"))},t}(i.a.Component),Pp=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Ip=function(e){function t(t){var n=e.call(this,t)||this;return n.state={disable:!1,visible:!0},n}return Pp(t,e),t.prototype.onClick=function(){this.props.handler.closeTranslate()},t.prototype.render=function(){return i.a.createElement("div",{className:_p.a["translate-page-btn"]+" "+(this.state.disable?_p.a.disable:""),onClick:this.onClick.bind(this),style:{left:"unset",right:15,visibility:this.state.visible?"visible":"hidden"}},i.a.createElement("span",{className:_p.a["translate-page-btn-text"]},"退出翻译"))},t}(i.a.Component);var xp=n(483);var Op,Lp=n(161),Mp=n(146),Np=n(148),Ap=n(149),Dp=n(46),kp=n(300),jp=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Fp=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Hp=function(){function e(e){this.workbench=e}return e.prototype.attachEditor=function(e,t,n){var o={layoutType:n.layoutType,editable:!1,copyable:p.a.getInstance().isCopyable,uniqueId:"id_translate"},r=c.MeloEditor.emptyEditor(o);return r.addContainerRender(c.ContainerType.Drawing,c.DrawingType.Image,Object(Lp.a)()),r.addContainerRender(c.ContainerType.Drawing,c.DrawingType.Splitline,Object(Mp.a)()),r.addDecorator(c.DecoratorTypes.LinePaddingLeft,Object(Np.a)()),r.addStyleDecorator(c.BoxKind.Paragraph,Ap.a),r.addDecorator(c.DecoratorTypes.LineFragment,Object(Dp.b)(r)),this.workbench.emit("$beforeMeloAttach",r),r.attachEditor(e),Ct.EditorLoader.load(r),r.clipboardManager.addCopyModelParser(c.LayoutInputNodeType.Table,Wc),r.clipboardManager.addCopyContainerParser(c.ContainerType.Drawing,c.DrawingType.Image,kp.a),r.clipboardManager.addCopyModelParser(c.LayoutInputNodeType.List,Pn),r},e.prototype.requestBlur=function(e){e.fire(new c.FocusBlurNotification(c.FocusBlurNotificationType.REQUEST_BLUR),!1)},e.prototype.requestFocus=function(e){e.fire(new c.FocusBlurNotification(c.FocusBlurNotificationType.REQUEST_FOCUS),!1)},e.prototype.setValue=function(){},e.prototype.isCaret=function(e){return e.isCaret()},e.prototype.destroy=function(e){e.detach()},e=jp([Object(m.b)("translate"),Fp("design:paramtypes",[m.B])],e)}(),Bp=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Up=function(e){function t(t){var n=e.call(this,t)||this;return n.languageMap=(new Map).set(Rp.CHINESE,"中文").set(Rp.ENGLISH,"英文"),n.state={languageId:Rp.ENGLISH},n}return Bp(t,e),t.prototype.isSelected=function(e){return this.state.languageId===e},t.prototype.onMenuClick=function(e){this.state.languageId!==e&&(this.setState({languageId:e}),this.props.handler.switchLanguage(e))},t.prototype.render=function(){var e=this;return i.a.createElement("div",{className:_p.a["translate-language-bar"]},i.a.createElement("div",{className:_p.a["language-box"]+" "+_p.a["language-box-disable"]},"自动识别"),i.a.createElement("div",{className:_p.a["exchange-arrow"]}),i.a.createElement(wt.a,{dropContent:i.a.createElement((function(){return i.a.createElement(Cs.a,{onClick:function(t){return e.onMenuClick(t)}},i.a.createElement(Cs.a.Item,{id:Rp.CHINESE,className:_p.a["dui-translate-menu-item"]+" "+(e.isSelected(Rp.CHINESE)?_p.a.checked:"")},e.languageMap.get(Rp.CHINESE)),i.a.createElement(Cs.a.Item,{id:Rp.ENGLISH,className:_p.a["dui-translate-menu-item"]+" "+(e.isSelected(Rp.ENGLISH)?_p.a.checked:"")},e.languageMap.get(Rp.ENGLISH)))}),null)},i.a.createElement("div",{className:_p.a["language-box"]},this.languageMap.get(this.state.languageId))))},t}(i.a.Component),Vp=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Wp=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Gp=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)a.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return a},zp=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(Gp(arguments[t]));return e},Kp=function(e,t,n,o,r){this.text="",this.translateText="",this.text=e,this.translateText=t,this.translatable=n,this.span=o,this.paraProp=r};!function(e){e[e.TranslateAll=0]="TranslateAll",e[e.TranslateDiff=1]="TranslateDiff",e[e.TranslateFinish=2]="TranslateFinish"}(Op||(Op={}));var qp={menu:[{name:"translate",content:"智能翻译",respectOffline:!0,onClick:function(e,t){e.editor.fire(new xp.a("translate")),t.isTranslateOpened()?t.closeTranslate():t.openTranslate()},shouldCheck:function(e,t){return t.isTranslateOpened()}}],toolbar:[{name:"translate",type:"icon",hasArrow:!1,preventFocus:!0,icon:i.a.createElement("svg",{width:"22px",height:"22px",viewBox:"0 0 22 22",version:"1.1"},i.a.createElement("g",{stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},i.a.createElement("g",null,i.a.createElement("rect",{id:"Rectangle",fill:"#000000",opacity:"0",x:"0",y:"0",width:"22",height:"22"}),i.a.createElement("path",{d:"M16,16 L16,17.5 C16,17.7761424 15.7761424,18 15.5,18 L3.5,18 C3.22385763,18 3,17.7761424 3,17.5 L3,5.5 C3,5.22385763 3.22385763,5 3.5,5 L5,5 L5,3.5 C5,3.22385763 5.22385763,3 5.5,3 L17.5,3 C17.7761424,3 18,3.22385763 18,3.5 L18,15.5 C18,15.7761424 17.7761424,16 17.5,16 L16,16 Z M16,14.75 L16.75,14.75 L16.75,4.25 L6.25,4.25 L6.25,5 L15.5,5 C15.7761424,5 16,5.22385763 16,5.5 L16,14.75 Z M4.25,6.25 L4.25,16.75 L14.75,16.75 L14.75,6.25 L4.25,6.25 Z M8.40729614,7.67535211 L12.6304721,7.67535211 L12.6304721,8.42074756 C12.4330472,9.00146262 12.0553648,9.50417118 11.4888412,9.92887324 C12.0038627,10.1195558 12.604721,10.258234 13.3,10.3275731 L12.9824034,11.1163055 C12.0381974,11.0036295 11.2656652,10.7782774 10.6476395,10.4315818 C9.99527897,10.7522752 9.19699571,11.0122969 8.2527897,11.2116468 L7.83218884,10.457584 C8.61330472,10.301571 9.29141631,10.1108884 9.85793991,9.87686891 C9.43733906,9.49550379 9.12832618,9.02746479 8.9223176,8.4727519 L8.40729614,8.4727519 L8.40729614,7.67535211 Z M9.79785408,8.4727519 C9.98669528,8.87145179 10.2699571,9.20081257 10.6476395,9.47816901 C11.1111588,9.18347779 11.4630901,8.85411701 11.6948498,8.4727519 L9.79785408,8.4727519 Z M8.65622318,11.6103467 L10.1755365,11.6103467 L10.1755365,10.925623 L11.0682403,10.925623 L11.0682403,11.6103467 L12.6991416,11.6103467 L12.6991416,12.4250813 L11.0682403,12.4250813 L11.0682403,13.1704767 L13.1197425,13.1704767 L13.1197425,14.0198808 L11.0682403,14.0198808 L11.0682403,15.45 L10.1755365,15.45 L10.1755365,14.0198808 L8.28712446,14.0198808 L8.28712446,13.1704767 L10.1755365,13.1704767 L10.1755365,12.4250813 L8.65622318,12.4250813 L8.65622318,11.6103467 Z M6.50171674,7.45 C7.04248927,7.87470206 7.50600858,8.29940412 7.89227468,8.71543879 L7.27424893,9.34815818 C6.94806867,8.94945829 6.47596567,8.52475623 5.86652361,8.074052 L6.50171674,7.45 Z M5.3,9.95487541 L7.30858369,9.95487541 L7.30858369,13.4131636 C7.51459227,13.1964789 7.72060086,12.9624594 7.94377682,12.7197725 L8.18412017,13.6818527 C7.66909871,14.2365655 7.11974249,14.7392741 6.54463519,15.1813109 L6.20128755,14.3665764 C6.35579399,14.2278982 6.4416309,14.0632178 6.4416309,13.8638678 L6.4416309,10.8216143 L5.3,10.8216143 L5.3,9.95487541 Z",id:"形状",fill:"#5C5C5C",fillRule:"nonzero"})))),tooltip:"智能翻译",respectOffline:!0,respectPermission:function(){return!Object(M.c)().isLogin},shouldChecked:function(e,t){return t.isTranslateOpened()},onClick:function(e,t){t.isTranslateOpened()?t.closeTranslate():t.openTranslate()}}]},Zp=qp.menu,$p=qp.toolbar,Qp=function(){function e(e,t,n,o,r,i){var a=this;this.contextService=e,this.workbench=t,this.store=n,this.toolbarService=o,this.widgetService=r,this.featureService=i,this.editor=null,this.translateEditor=null,this.translateSender=null,this.translateState=Op.TranslateFinish,this.gcp=0,this.originLanguage=Rp.AUTO,this.targetLanguage=Rp.UNDEFINED,this.clientVars=this.contextService.context.clientVars,this.store.register("translateOpened",!1),this.workbench.listen("$rightDrawerWillOpen",(function(){a.isTranslateOpened()&&a.closeTranslate()}))}return e.prototype.$onInit=function(e){this.editor=e,this.workbench.mount([Hp])},e.prototype.$beforeDestroy=function(){this.editor=null,this.translateEditor=null,this.translateSender=null,this.isOpened=!1,this.translateState=Op.TranslateFinish,this.translateList=[],this.gcp=0,this.sectIter=void 0,this.paraIter=void 0,this.dirtyRange=void 0,this.diffRange=void 0,this.originLanguage=Rp.AUTO,this.targetLanguage=Rp.UNDEFINED},e.prototype.initTranslateEditor=function(){var e=this;return new Promise((function(t,n){if(e.editor){var o=e.featureService.get(y.a.ZoomBase);e.workbench.open(Hp,{content:{layoutType:e.editor.docEnv.layoutType},mode:"horizontal",noFocus:!0}).then((function(n){var r=n.id,i=n.editor;e.translateEditor=i,e.translateEditorId=r,null==o||o.setAlign(r,"Left"),null==o||o.setAlign(e.store.getValue("rootEditor"),"Right"),t()}),(function(){n()}))}else n()}))},e.prototype.destroyTranslateEditor=function(){this.translateEditor&&this.translateEditor.detach(),this.workbench.close(this.translateEditorId),this.translateEditor=null},e.prototype.showFailView=function(e){if(this.translateEditor){this.translateSaveBtn&&this.translateSaveBtn.setState({visible:!1});var t=this.translateEditor.view.getDom();if(t){var n=document.createElement("div");n.id=_p.a["translate-fail-container"],t.appendChild(n),s.a.render(i.a.createElement(Sp,{handler:this,failType:e}),n)}}},e.prototype.removeFailView=function(){if(this.translateEditor){var e=this.translateEditor.view.getDom();if(e){var t=e.querySelector("#"+_p.a["translate-fail-container"]);t&&e.removeChild(t)}this.translateSaveBtn&&this.translateSaveBtn.setState({visible:!0})}},e.prototype.setTranslateState=function(e){this.translateState=e,e===Op.TranslateAll?p.a.getInstance().disableEditForKey("translate"):p.a.getInstance().enableEditForKey("translate"),e===Op.TranslateFinish&&this.dirtyRange&&this.translateDiff(),this.translateSaveBtn&&this.translateSaveBtn.setState({disable:e!==Op.TranslateFinish})},e.prototype.onModelChanged=function(e){var t=this;if(this.originLanguage!==Rp.UNSUPPORTED){var n=e.changeData.dirtyRangeMap.get(c.StoryID.MainDocId);n&&n.values.forEach((function(e){t.dirtyRange?t.dirtyRange=t.dirtyRange.unionRange(e):t.dirtyRange=e.clone()})),this.translateState===Op.TranslateFinish&&this.dirtyRange&&this.translateDiff()}},e.prototype.isTranslateOpened=function(){return this.isOpened},e.prototype.openTranslate=function(){var e=this;this.isOpened||this.initTranslateEditor().then((function(){e.workbench.configure({paddingTop:80}),e.editor.view.setPadding({top:0}),e.translateEditor.view.setPadding({top:0}),e.widgetService.float({name:"TranslateLanguageBar",component:i.a.createElement(Up,{ref:function(t){e.translateLanguageBar=t},handler:e})});var t=e.translateEditor.view.getDom();if(t){var n=document.createElement("div");n.id="translate-save-btn-container",t.appendChild(n),s.a.render(i.a.createElement(Tp,{ref:function(t){e.translateSaveBtn=t},handler:e}),n);var o=document.createElement("div");o.id="translate-exit-btn-container",t.appendChild(o),s.a.render(i.a.createElement(Ip,{handler:e}),o)}e.workbench.emit("$closeComment",!0),e.editor.fire(new c.ScrollableResizeNotification),e.editor.on(c.StateNotification.EfficientModelChange,(function(t){e.onModelChanged(t)}),e),e.translateSender||(e.translateSender=new bp),setTimeout((function(){e.store.get("translateOpened").next(!0)}),100),c.ReportHelper.tdwReport({opername:"doc_word_editor",module:"translate",action:"turn_on"}),e.isOpened=!0,e.toolbarService.$forceUpdate(),e.checkLanguage()}),(function(){g.Logger.error("translate|openTranslate failed")}))},e.prototype.closeTranslate=function(){if(this.isOpened){var e=this.featureService.get(y.a.ZoomBase);null==e||e.setAlign(this.store.getValue("rootEditor"),"Center"),this.destroyTranslateEditor(),this.workbench.configure({paddingTop:0}),this.editor.view.resetPadding(),this.widgetService.remove("TranslateLanguageBar","float"),this.workbench.emit("$restoreComment"),this.editor.fire(new c.ScrollableResizeNotification),this.editor.removeListener(c.StateNotification.EfficientModelChange,this),this.translateSender&&(this.translateSender.abort(),this.translateSender=null),this.store.get("translateOpened").next(!1),c.ReportHelper.tdwReport({opername:"doc_word_editor",module:"translate",action:"turn_off"}),this.isOpened=!1}},e.prototype.checkLanguage=function(){var e=this;if(this.editor&&this.translateSender){this.targetLanguage=Rp.UNDEFINED;var t=this.editor.service.getTranslate().getCheckText();if(0===t.length)return this.originLanguage=Rp.UNSUPPORTED,void this.showFailView(cp.UNSUPPORTED);var n=new vp;n.url="https://docs.qq.com/cgi-bin/translate/translate_check",n.type="POST",n.text=t,n.successCb=function(t,n,o){g.Logger.log("translate checkLanguage successCb: "+n.lang),e.targetLanguage===Rp.UNDEFINED&&("zh"===n.lang?(e.originLanguage=Rp.CHINESE,e.targetLanguage=Rp.ENGLISH,e.translateLanguageBar&&e.translateLanguageBar.setState({languageId:e.targetLanguage}),e.removeFailView(),e.translateAll()):"en"===n.lang?(e.originLanguage=Rp.ENGLISH,e.targetLanguage=Rp.CHINESE,e.translateLanguageBar&&e.translateLanguageBar.setState({languageId:e.targetLanguage}),e.removeFailView(),e.translateAll()):(e.originLanguage=Rp.UNSUPPORTED,e.showFailView(cp.UNSUPPORTED)))},n.errorCb=function(t,n,o){g.Logger.log("translate checkLanguage errorCb: "+n),e.showFailView(cp.ERROR)},this.translateSender.addAjax(n)}},e.prototype.switchLanguage=function(e){this.originLanguage!==Rp.UNSUPPORTED&&this.translateEditor&&this.translateSender&&(this.targetLanguage=e,this.translateSender.abort(),this.translateEditor.emptyContent(),this.translateAll())},e.prototype.translateAll=function(){this.editor&&this.translateEditor&&(this.gcp=0,this.sectIter=this.editor.service.getDocument().getRange(0,0,!1).getSections().item(0),this.sectIter&&(this.insertSection(),this.paraIter=this.editor.service.getDocument().getRange(0,0,!1).getParagraphs().item(0),this.paraIter&&(this.setTranslateState(Op.TranslateAll),this.prepareParagraph(),this.translateBatch())))},e.prototype.insertSection=function(){if(this.sectIter){var e=this.sectIter.getSectionFormat().getAttributes();this.translateEditor.service.getTranslate().insertSection(this.gcp,new c.SectBreakSpan,e)}},e.prototype.insertParagraph=function(){0!==this.translateList.length&&(this.gcp=this.translateEditor.service.getTranslate().insertParagraph(this.gcp,this.translateList),this.translateList=[])},e.prototype.nextParagraph=function(){if(!this.sectIter||!this.paraIter)return!1;if(this.paraIter.getRange().end()===this.sectIter.getRange().end()-1){var e=this.sectIter.getRange(),t=this.editor.service.getDocument().getStoryRangeFromGcpRange(new c.GCPRange(0,0));if(this.sectIter=this.sectIter.getNext(),e.end()>=t.end()||!this.sectIter)return!1;this.gcp+=1,this.insertSection(),e=this.sectIter.getRange(),this.paraIter=this.editor.service.getDocument().getRange(e.begin(),e.begin(),!1).getParagraphs().item(0)}else this.paraIter=this.paraIter.getNext();return!0},e.prototype.prepareParagraph=function(){if(this.paraIter){this.translateList=[],this.pushParaToList(this.paraIter);var e=this.paraIter.getFormat().getAttributes(),t=this.editor.service.getDocument().getRange(this.paraIter.getRange().begin(),this.paraIter.getRange().end(),!1).getSpans().item(0);if(e instanceof c.TableProperty&&t&&t.getType()===c.TDSpanType.TableStartBreak)for(;this.paraIter&&(this.paraIter=this.paraIter.getNext(),!(this.paraIter&&(this.pushParaToList(this.paraIter),e=this.paraIter.getFormat().getAttributes(),t=this.editor.service.getDocument().getRange(this.paraIter.getRange().begin(),this.paraIter.getRange().end(),!1).getSpans().item(0),e instanceof c.TableProperty&&t&&t.getType()===c.TDSpanType.TableEndBreak))););}},e.prototype.translateDiff=function(){if(this.editor&&this.translateEditor&&this.dirtyRange){var e=this.dirtyRange.begin(),t=this.dirtyRange.end(),n=this.editor.service.getDocument().getRange(t-1,t,!1).getSpans().item(0),o=this.editor.service.getDocument().getStoryRangeFromGcpRange(new c.GCPRange(0,0));n&&n.getType()===c.TDSpanType.ParaBreak&&n.getRange().end()<o.end()-1&&(t+=1);var r=this.editor.service.getDocument().getRange(e,t,!1).getParagraphs();this.dirtyRange=void 0,this.diffRange=this.findDiffRange(r.item(0),r.item(r.count()-1)),this.diffRange?(this.setTranslateState(Op.TranslateDiff),this.prepareDiff(r),this.translateBatch()):g.Logger.log("translate diff range not found")}},e.prototype.findDiffRange=function(e,t){if(e&&t){var n=-1,o=-1,r=this.editor.service.getDocument().getStoryRangeFromGcpRange(new c.GCPRange(0,0)),i=this.translateEditor.service.getDocument().getStoryRangeFromGcpRange(new c.GCPRange(0,0)),a=this.translateEditor.service.getDocument().getRange(0,0,!1).getParagraphs().item(0);if(e.getRange().begin()===r.begin())n=i.begin();else{var s=e.getPrev();if(!s)return;for(var l=s.getFormat().getParaId();a;){if(a.getFormat().getParaId()===l){n=a.getRange().end();break}a=a.getNext()}}if(t.getRange().end()===r.end()-1)o=i.end()-1;else{var p=t.getNext();if(!p)return;for(var u=p.getFormat().getParaId();a;){if(a.getFormat().getParaId()===u){o=a.getRange().begin();break}a=a.getNext()}}return n>=0&&o>=n?new c.GCPRange(n,o-n):void 0}},e.prototype.prepareDiff=function(e){var t=this;this.translateList=[],zp(e).forEach((function(e){t.pushParaToList(e)}))},e.prototype.replaceDiff=function(){0!==this.translateList.length&&this.diffRange&&(this.translateEditor.service.getTranslate().replaceDiff(this.diffRange,this.translateList),this.translateList=[],this.diffRange=void 0)},e.prototype.translateBatch=function(){var e=this;if(this.translateSender&&this.translateList){for(var t=0,n=0;n<this.translateList.length;n++){var o=this.translateList[n];if(o.translatable){t+=1;var r=new vp;r.index=n,r.url="https://docs.qq.com/cgi-bin/translate/translate_do",r.type="POST",r.source=this.originLanguage,r.target=this.targetLanguage,r.text=o.text,r.successCb=function(t,n,o){e.translateList&&t>=0&&t<e.translateList.length&&(n&&n.records&&n.records.length>0&&t===Number(n.pass_text)&&(e.translateList[t].translateText=n.records[0].targetText));o&&e.onBatchTranslated()},r.errorCb=function(t,n,o){g.Logger.log("translate para errorCb: "+t),e.translateList&&t>=0&&t<e.translateList.length&&(e.translateList[t].translateText=e.translateList[t].text),o&&e.onBatchTranslated()},this.translateSender.addAjax(r)}}g.Logger.log("translate list size: "+this.translateList.length+", add count: "+t),0===t&&this.onBatchTranslated()}},e.prototype.onBatchTranslated=function(){if(g.Logger.log("translate onParagraphTranslated"),this.editor&&this.translateEditor)if(this.translateState===Op.TranslateAll){if(this.insertParagraph(),!this.nextParagraph())return void this.setTranslateState(Op.TranslateFinish);this.prepareParagraph(),this.translateBatch()}else this.translateState===Op.TranslateDiff&&(this.replaceDiff(),this.setTranslateState(Op.TranslateFinish));else this.setTranslateState(Op.TranslateFinish)},e.prototype.pushParaToList=function(e){var t=this,n=e.getRange(),o=e.getFormat().getAttributes(),r=this.editor.service.getDocument().getRange(n.begin(),n.end(),!1).getSpans();zp(r).forEach((function(e){var n=e.getRange(),r=t.editor.service.getDocument().getTextFromGcpRange(n),i=e.getFont().getAttributes(),a=t.editor.service.getTranslate().isValid(r,i,n),s=a.translatable;if(a.preservable){var c=new Kp(r,"",s,i,o);t.translateList.push(c)}}))},e.prototype.saveTranslate=function(){if(this.editor&&this.translateEditor&&this.clientVars){var e=this.translateEditor.service.getTranslate().getTranslateDeltaData();if(null===e)return;var t=this.editor.run("transDeltaToAtextData",e,0);if(0===t.length)return;!function(e,t,n){var o=JSON.parse(t),r={isFinished:!1,title:e,iconType:n,tips:"新建翻译文档中..."};localStorage.setItem("jump_translate",JSON.stringify(r)),window.open("//docs.qq.com/scenario/jumppage.html?type=translate"),w.a.ajax({url:"https://docs.qq.com/cgi-bin/translate/translate_save",type:"POST",data:{title:e,atext:JSON.stringify({text:o.atext.text,attribs:o.atext.attribs}),apool:JSON.stringify(o.apool),xsrf:Object(c.getXsrf)()},xhrFields:{withCredentials:!0},success:function(t){if("object"!=typeof t)try{t=JSON.parse(t)}catch(e){t={}}if(g.Logger.log("saveTranslate ret="+t.retcode),0===t.retcode){var o={isFinished:!0,title:e,iconType:n,retcode:t.retcode,url:t.doc_url};localStorage.setItem("jump_translate",JSON.stringify(o))}else{var r={isFinished:!0,title:e,iconType:n,retcode:t.retcode||-1,failImg:{src:"fail_translation_v2"},tips:"译文生成新文档失败，请关闭当前页面后重试。"};localStorage.setItem("jump_translate",JSON.stringify(r))}},error:function(t){g.Logger.log("saveTranslate error");var o={isFinished:!0,title:e,iconType:n,retcode:-1,failImg:{src:"fail_translation_v2"},tips:"译文生成新文档失败，请关闭当前页面后重试。"};localStorage.setItem("jump_translate",JSON.stringify(o))}}),c.ReportHelper.tdwReport({opername:"doc_word_editor",module:"translate",action:"create_newfile"})}(this.store.getValue("docTitle")+" - 译文",t,this.clientVars.padType)}},e=Vp([Object(m.i)({menuItems:Zp,toolbarItems:$p,name:y.a.Translate,scope:0,for:["melo"]}),Wp("design:paramtypes",[m.f,m.B,m.x,m.z,m.A,m.k])],e)}(),Xp=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{c(o.next(e))}catch(e){i(e)}}function s(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))},Yp=function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},Jp=function(){function e(){}return e.docRecover=function(e){return Xp(this,void 0,void 0,(function(){return Yp(this,(function(t){return[2,new Promise((function(t,n){w.a.ajax({url:"//docs.qq.com/cgi-bin/online_docs/doc_recover",type:"POST",data:{domain_id:e.domainId,pad_id:e.padId,xsrf:Object(c.getXsrf)()},success:function(e){0===e.retcode?t(e):n(e)},error:function(e){n(e)}})}))]}))}))},e}(),eu=n(287),tu=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},nu=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},ou=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{c(o.next(e))}catch(e){i(e)}}function s(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))},ru=function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},iu=function(){function e(e){var t=this;this.contextService=e,this.closeModal=function(){},this.show=function(){var e=V.Modal.confirm({title:"提示",content:"回收站中的文档不能编辑，如要使用请还原文档。",okText:"还原",onOk:t.confirmHandler,onCancel:t.cancelHandler,onClose:t.cancelHandler}).close;t.closeModal=e,document.removeEventListener("visibilitychange",t.visibilitychangeHandler)},this.visibilitychangeHandler=function(){t.show()},this.cancelHandler=this.cancelHandler.bind(this),this.confirmHandler=this.confirmHandler.bind(this),this.context=this.contextService.context}return e.prototype.$onInit=function(){return ou(this,void 0,void 0,(function(){var e,t,n;return ru(this,(function(o){switch(o.label){case 0:return this.clientVars=this.context.clientVars,this.fromTrash=Object(g.getUrlParameter)("fromTrash"),null!==this.fromTrash&&(e=document.location.href,e=Object(g.removeURLParameter)(e,"fromTrash"),history.replaceState("","",e)),t=2===this.clientVars.docStatus,window.clientVarsOnline&&(t=2===window.clientVarsOnline.docStatus),n=!1,window.App.GlobalConfig.IsSupportStore?[4,window.offlineDataHelperInstance.isDeletedDoc()]:[3,2];case 1:n=o.sent(),o.label=2;case 2:return g.Logger.info("RecoverDocHandler init isDelete:"+t+" isDeletedOffline:"+n),(t||n)&&this.show(),[2]}}))}))},e.prototype.$beforeDestroy=function(){return ou(this,void 0,void 0,(function(){return ru(this,(function(e){return this.closeModal(),[2]}))}))},e.prototype.cancelHandler=function(){return window.setTimeout((function(){window.location.href="https://docs.qq.com/desktop/trash"})),!1},e.prototype.confirmHandler=function(){var e=this,t=Object(M.c)();Jp.docRecover(t).then((function(n){if(n.folder_info&&n.folder_info.folder_id){P.a.show({message:"还原成功",autoClose:!0}),window.App.GlobalConfig.IsSupportStore&&window.offlineDataHelperInstance.recoverDoc(n.folder_info.folder_id)}e.fromTrash&&t&&n.folder_info&&Object(eu.a)("RECOVER",{domainId:t.domainId,localPadId:t.padId,padType:t.padType,title:t.padTitle,url:t.shortLink,list_item_type:1,parent_folder_id:n.folder_info.folder_id}),setTimeout(e.reloadForce,2e3),e.closeModal()})).catch((function(t){if(void 0===t&&(t={}),e.vipService.showVipToast({errorCode:t.retcode}))document.addEventListener("visibilitychange",e.visibilitychangeHandler);else{var n="还原文件失败，请重试"+(t.retcode?" ("+t.retcode+")":"")+"。";P.a.show({message:n,autoClose:!0})}}))},e.prototype.reloadForce=function(){window.location.reload(!0)},tu([Object(m.l)(),nu("design:type",xe.a)],e.prototype,"vipService",void 0),e=tu([Object(m.i)({name:y.a.RecoverDoc,scope:0,for:["melo"]}),nu("design:paramtypes",[m.f])],e)}(),au=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},su=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},cu=function(){function e(e,t,n,o){var r=this;this.store=e,this.drawerService=t,this.workbench=n,this.contextService=o,this.notificationListShowing=!1,this.applicationUnreadNumber=0,this.setUnreadNotificationNumber=function(e){r.applicationUnreadNumber=0,r.addUnreadNotificationNumber(e)},this.addUnreadNotificationNumber=function(e){void 0===e&&(e=0),r.applicationUnreadNumber+=e,r.setOutSideRedPoint(!0);var t=new CustomEvent("setUnreadNotificationNumberNoti",{detail:{number:r.applicationUnreadNumber}});document.dispatchEvent(t)},this.delUnreadNotificationNumber=function(e){void 0===e&&(e=0),r.applicationUnreadNumber-=e,r.applicationUnreadNumber<0&&(r.applicationUnreadNumber=0),r.setOutSideRedPoint();var t=new CustomEvent("setUnreadNotificationNumberNoti",{detail:{number:r.applicationUnreadNumber}});document.dispatchEvent(t)},this.clearUnreadNotificationNumber=function(){r.applicationUnreadNumber=0,r.setOutSideRedPoint(!0);var e=new CustomEvent("setUnreadNotificationNumberNoti",{detail:{number:0}});document.dispatchEvent(e)},this.loadNotificationModule=function(e){void 0!==r.module?e(r.module):r.slr.load("Notifications",(function(t){e(t)}))},this.showNotification=function(){r.notificationListShowing||(r.drawerService.showRightDrawer({content:r.container,onOpen:function(){var e=document.getElementById("notification-container"),t={from:"core-doc"},n=r.contextService.context.clientVars;n.isCreator&&(t.domainId=n.domainId,t.localPadId=n.localPadId),r.module.showNotification(e,t),r.notificationListShowing=!0,r.slr.dispatch("NOTIFICATION_WND_DID_SHOW")},style:{width:324,paddingTop:0,background:"#FFF"}}),r.store.update("unreadsNum",0))},this.hideNotification=function(){r.notificationListShowing=!1,r.drawerService.closeRightDrawer();var e=new CustomEvent("notification-reset-current-edit");document.dispatchEvent(e),r.slr.dispatch("NOTIFICATION_WND_WILL_HIDEN")},this.initNotification=function(){r.loadNotificationModule((function(e){r.module||(r.slr.listen("NOTIFICATION-CLOSE",(function(){r.hideNotification()})),r.slr.listen("ONE_KEY_PERMISSION_TO_VIEWABLE",(function(){var e=r.contextService.context.clientVars;Aa.getPolicy(e).then((function(e){r.workbench.emit("$policyUpdated",e)}))}))),r.module=e,r.showNotification()}))},this.handleDropdownClick=function(){r.notificationListShowing?r.hideNotification():r.module?r.showNotification():r.initNotification();var e=r.contextService.context.clientVars;if(w()("#notification-dropdown-line").find(".redpoint").length>0){var t={};e.isCreator&&(t={detail:{localPadID:e.localPadId,domainID:e.domainId}});var n=new CustomEvent("notification-update-list",t);document.dispatchEvent(n)}e.isCreator||r.clearUnreadNotificationNumber()},this.container=i.a.createElement("div",{id:"notification-container",style:{height:"100%"}}),this.store.register("unreadsNum",0),this.slr=this.scriptLoaderService.getScriptLoader();mt.getUnreadNum().then((function(e){void 0!==e.unread_sum_count?(r.setUnreadNotificationNumber(e.unread_sum_count),r.store.update("unreadsNum",e.unread_sum_count)):r.clearUnreadNotificationNumber()})),document.addEventListener("resetOuterUnreadNumberNoti",(function(e){r.setUnreadNotificationNumber(e.detail.number),r.store.update("unreadsNum",e.detail.number)})),w()(document).on("click","#notification-dropdown-line",this.handleDropdownClick)}return e.prototype.$onInit=function(){this.store.get(m.d.IsOnline).subscribe((function(e){if(e){var t=new CustomEvent("notification-list-online");document.dispatchEvent(t)}else{var n=new CustomEvent("notification-list-offline");document.dispatchEvent(n)}}))},e.prototype.$beforeDestroy=function(){this.module=null},e.prototype.setOutSideRedPoint=function(e){void 0===e&&(e=!1)},au([Object(m.l)(),su("design:type",X.a)],e.prototype,"scriptLoaderService",void 0),e=au([Object(m.i)({name:y.a.UnreadNotify,scope:1}),su("design:paramtypes",[m.x,m.g,m.B,m.f])],e)}(),lu=n(492),pu=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{c(o.next(e))}catch(e){i(e)}}function s(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((o=o.apply(e,t||[])).next())}))},uu=function(e,t){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},du=function(){function e(){}return e.load=function(t){return pu(this,void 0,void 0,(function(){var n;return uu(this,(function(o){switch(o.label){case 0:return e.isLoaded?[2]:(e.isLoaded=!0,t.mount([C,ee,ae,se.a,Ie,Me,Ve,rt,bt,Kt,Xt,un,mn,gn.a,xn,kn,jn.a,co,ho,fo.a,vo,wo,Ro.a,Io,Ao,Yr,la,pa.a,Ca,Ea,Ua,Xa,hs,zs,Xs,cc,fc,Fl,np,up,gp,yp.a,Qp,iu,cu,lu.a]),t.context.isPreview?[4,fs.a.get(fs.b.OcrPreviewHandler,{retryOnline:!0})]:[3,2]);case 1:n=o.sent().OcrPreviewHandler,t.mount([n]),o.label=2;case 2:return[2]}}))}))},e.isLoaded=!1,e}()},490:function(e,t,n){"use strict";n.d(t,"a",(function(){return N}));var o,r=n(0),i=n(19),a=n(4),s=n(1),c=n.n(s),l=n(303),p=n.n(l),u=n(5),d=n(479),h=(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),f=function(){return(f=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},m=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},g=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},y=function(e){function t(t){var n=e.call(this,t)||this;return n.textRef=c.a.createRef(),n.state={expand:!1},n}return h(t,e),t.prototype.componentDidMount=function(){var e=this;this.props.noCollapse||this.state.expand||setTimeout((function(){if(e.textRef.current){var t=e.props.item.texts.join("\n"),n=e._ellipseService.wrapLine(t,e.textRef.current.offsetWidth,4,{classname:p.a["text-flow-str"]},"... 显示全部",!1);n!==t&&e.setState({clamp:n})}}),0)},t.prototype.render=function(){var e=this;return c.a.createElement("div",{style:f({padding:"16px",borderBottom:"1px solid rgba(0, 0, 0, 0.06)"},this.props.style)},c.a.createElement("div",{className:p.a["text-flow-str"],ref:this.textRef},this.state.clamp?this.state.clamp:this.props.item.texts.join("\n"),this.state.clamp?c.a.createElement("span",null,"... ",c.a.createElement("span",{className:p.a["text-flow-expand"],onClick:function(){e.setState({clamp:void 0,expand:!0})}},"查看全部")):null),c.a.createElement("div",{className:p.a["text-flow-time"]},this.getTimeString(this.props.item.time)))},t.prototype.getTimeString=function(e){function t(t){var n=new Date(e),o=t,r={"M+":n.getMonth()+1,"d+":n.getDate(),"h+":n.getHours(),"m+":n.getMinutes(),"s+":n.getSeconds()};return/(y+)/.test(o)&&(o=o.replace(RegExp.$1,(""+n.getFullYear()).substr(4-RegExp.$1.length))),Object.keys(r).forEach((function(e){new RegExp("("+e+")").test(o)&&(o=o.replace(RegExp.$1,1===RegExp.$1.length?r[e]:("00"+r[e]).substr((""+r[e]).length)))})),o}var n=new Date(e),o=e-(new Date).setHours(0,0,0,0);return o>=0&&o<864e5?"今天 "+t("hh:mm:ss"):n.getFullYear()===(new Date).getFullYear()?""+t("MM-dd hh:mm:ss"):""+t("yyyy-MM-dd hh:mm:ss")},m([Object(u.l)(),g("design:type",d.a)],t.prototype,"_ellipseService",void 0),t}(c.a.Component),v=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),b=function(e){function t(t){var n=e.call(this,t)||this,o=n.props.handler.getTextFlow();return n.state={current:o.current,textFlow:o.past},n.props.handler.onTextFlowChanged=function(){var e=n.props.handler.getTextFlow();n.setState({current:e.current,textFlow:e.past})},n}return v(t,e),t.prototype.componentWillUnmount=function(){this.props.handler.onTextFlowChanged=void 0},t.prototype.render=function(){var e=this;return c.a.createElement("div",{className:p.a["text-flow-wrapper"]},c.a.createElement("div",{className:p.a["text-flow-seperator"]}),0!==this.state.textFlow.length||this.state.current?c.a.createElement("div",{className:p.a["text-flow-item-container"]},this.state.current?c.a.createElement(y,{key:"current",item:this.state.current,noCollapse:!0,style:{padding:"16px 0px"}}):null,this.state.textFlow.map((function(t,n){return c.a.createElement(y,{key:e.state.textFlow.length-n,item:t,style:{padding:"16px 0px"}})}))):c.a.createElement("div",{className:p.a["text-flow-empty"],style:{paddingTop:"222px"}},"无文本"))},t}(c.a.Component),C=n(2),_=n(12),w=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)a.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return a},R=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(w(arguments[t]));return e},S=function(){function e(){this.singleMax=1e4,this.totalMax=1e5,this.INDEX_KEY="text_flow_index",this.SAVE_TIME=2592e6,this.cache=[],this.index=[],this.readCache()}return e.prototype.getCache=function(){return this.cache},e.prototype.append=function(e,t){e.length>0&&(this.cache.unshift({texts:e,time:t}),this.saveCache(this.cache,t))},e.prototype.saveTemp=function(e,t){e.length>0&&this.saveCache([{texts:e,time:t}].concat(this.cache),t)},e.prototype.readCache=function(){var e,t;try{var n=C.LocalStorageUtil.getItem(this.getCacheKey());n&&(e=this.cache).push.apply(e,R(JSON.parse(n)));var o=C.LocalStorageUtil.getItem(this.INDEX_KEY);o&&(t=this.index).push.apply(t,R(JSON.parse(o)))}catch(e){C.Logger.error("text flow read cache error",e)}},e.prototype.saveCache=function(e,t){var n=this,o=[],r=0;e.some((function(e){var t=0;return e.texts.forEach((function(e){return t+=e.length})),r+t>n.singleMax||(r+=t,o.push(e),!1)})),C.LocalStorageUtil.setItem(this.getCacheKey(),JSON.stringify(o)),this.insertIndex(this.getCacheKey(),r,t)},e.prototype.insertIndex=function(e,t,n){var o=this.index.find((function(t){return t.key===e}));o?(o.count=t,o.time=n):this.index.unshift({key:e,count:t,time:n}),this.shrinkIndex(),C.LocalStorageUtil.setItem(this.INDEX_KEY,JSON.stringify(this.index))},e.prototype.shrinkIndex=function(){var e=this;this.index.sort((function(e,t){return t.time-e.time}));var t=0,n=!1,o=Date.now();this.index=this.index.filter((function(r){var i=!1;return r.time-o>e.SAVE_TIME?i=!0:!n&&t+r.count>e.totalMax&&(n=!0),n||i?(C.LocalStorageUtil.removeItem(r.key),!1):(t+=r.count,!0)}))},e.prototype.getCacheKey=function(){var e=Object(_.c)();return e.globalPadId+"_"+e.userDomain+"_text_flow"},e}(),E=n(18),T=[{name:"text-history",content:"最近输入文本",onClick:function(e,t){t.showTextHistory()}}],P=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},I=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},x=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)a.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return a},O=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(x(arguments[t]));return e},L=[r.PlaceholderChar.StoryBegin,r.PlaceholderChar.StoryEnd,r.PlaceholderChar.FloatingAnchor,r.PlaceholderChar.TableStart,r.PlaceholderChar.TableEnd,r.PlaceholderChar.TableRowStart,r.PlaceholderChar.TableRowBreak,r.PlaceholderChar.TableCellStart,r.PlaceholderChar.TableCellBreak],M=new RegExp(L.join("|"),"g"),N=function(){function e(e,t){var n=this;this.drawerService=e,this.widgetService=t,this.textFlowCache=new S,this.currentRecord=void 0,this.currentBeginTime=0,this.currentUpdateTime=0,this.mobileDom=null,this.mobileRef=null,this.textFlowMobileIsVisible=!1,this.throttleMobile=Object(C.throttle)((function(){n.textFlowCache.saveTemp(n.extractCurrentRecord(),n.currentUpdateTime)}),5e3),this.beforeunload=function(){n.textFlowCache.append(n.extractCurrentRecord(),n.currentUpdateTime)}}return e.prototype.$onInit=function(e){var t=this;e.on(i.e.LocalChange,(function(e){t.updateCurrentRecord(e.changeset,e.apool),t.onTextFlowChanged&&t.onTextFlowChanged()}),this),window.addEventListener("beforeunload",this.beforeunload)},e.prototype.$beforeDestroy=function(e){e.removeListener(i.e.LocalChange,this),window.removeEventListener("beforeunload",this.beforeunload),this.mobileDom&&this.widgetService.remove("text-flow-mobile","float"),this.mobileRef=null,this.currentRecord=void 0,this.textFlowCache=new S,this.currentBeginTime=0,this.currentUpdateTime=0},e.prototype.getTextFlow=function(){var e=this.extractCurrentRecord();return{current:e.length>0?{texts:e,time:this.currentUpdateTime}:void 0,past:this.textFlowCache.getCache()}},e.prototype.dissectChangeset=function(e){var t=[],n=a.Changeset.unpack(e.cs);if(n){for(var o=a.Changeset.opIterator(n.opsStr),i=a.Changeset.stringIterator(n.charBank),s=!1,c="",l=function(){var n=o.next();if("+"===n.opcode){var r=i.take(n.chars);""===r.replace(/\*/g,"")&&a.Changeset.eachAttribNumber(n.attribs,(function(t){var n=e.ap.getAttrib(t);!n||"table"!==n[0]&&"container-type"!==n[0]||(r="")})),s?c+=r:c=r}else s&&(t.push.apply(t,O(c.split("\n"))),c="");s="+"===n.opcode};o.hasNext();)l();c&&t.push.apply(t,O(c.split("\n"))),t=t.map((function(e){return r.FieldUtil.getFilterFieldCodeText(e.replace(M," "))})).filter((function(e){return!!e}))}return t},e.prototype.compose=function(e,t,n){var o=a.Changeset.moveOpsToNewPool(t,n,e.ap);return{cs:a.Changeset.compose(e.cs,o,e.ap),ap:e.ap}},e.prototype.extractCurrentRecord=function(){return this.currentRecord?this.dissectChangeset(this.currentRecord):[]},e.prototype.updateOrCache=function(e,t){a.ChangesetTool.autoReport=!1;try{var n=Date.now();0===this.currentBeginTime&&(this.currentBeginTime=n);var o=n-this.currentBeginTime>6e5,r=this.currentRecord,i=r?this.compose(r,e,t):{cs:e,ap:t};!o||r&&this.dissectChangeset(r).length>=this.dissectChangeset(i).length?this.currentRecord=i:(this.textFlowCache.append(this.extractCurrentRecord(),this.currentUpdateTime),this.currentRecord={cs:e,ap:t},this.currentBeginTime=n),this.currentUpdateTime=n}catch(n){C.Logger.info("text_flow update error: "+n.message),this.textFlowCache.append(this.extractCurrentRecord(),this.currentUpdateTime),this.currentRecord={cs:e,ap:t},this.currentBeginTime=Date.now(),this.currentUpdateTime=this.currentBeginTime}finally{a.ChangesetTool.autoReport=!0}},e.prototype.updateCurrentRecord=function(e,t){e&&t&&this.updateOrCache(e,t)},e.prototype.showTextHistory=function(){this.drawerService.showRightDrawer({name:"textHistory",content:c.a.createElement(b,{handler:this}),style:{paddingTop:0},title:"最近输入文本",titleStyle:{opacity:.64,fontSize:15,fontWeight:500,lineHeight:1.07,letterSpacing:.38,padding:"24px 0px"}})},e.prototype.setTextFlowMobileVisible=function(e){this.textFlowMobileIsVisible=e},e.prototype.getTextFlowMobileVisible=function(){return this.textFlowMobileIsVisible},e=P([Object(u.i)({mobileMenuItems:T,name:E.a.TextFlow,scope:0,for:["melo"]}),I("design:paramtypes",[u.g,u.A])],e)}()}}]);
//# sourceMappingURL=features-pc-readonly-pc-c7bb01f9.js.map