var melo=function(e,t,r,n,o){"use strict";function i(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var a,s,p,l,c=i(t),u=i(o),h=function(){function e(){}return e.isTextNode=function(e){return!!e&&e.nodeType===Node.TEXT_NODE},e.getTagName=function(e){return e?e.nodeName:""},e.getValue=function(e){return e?e.nodeValue:null},e.getAttr=function(e,t){return this.isElementNode(e)?e.getAttribute(t):null},e.getChildNodeNum=function(e){return e.childNodes.length},e.getChildNode=function(t,r){return e.getChildNodeNum(t)>r&&r>=0?t.childNodes.item(r):null},e.getInnerHTML=function(e){return this.isElementNode(e)?e.innerHTML:""},e.getProp=function(e,t){if(e instanceof Element){return"className"===t&&"http://www.w3.org/2000/svg"===e.namespaceURI?e[t].baseVal:e[t]}return null},e.getStyleMap=function(t){var r=new Map,n=e.getAttr(t,"style");if(n){var o=n.split(";");if(o)for(var i=0;i<o.length;i++)if(o[i]){var a=o[i].split(":");a&&a[0]&&a[1]&&r.set(a[0].trim(),a[1].trim())}}return r},e.getScrollOffset=function(e,t){var r={scrollX:0,scrollY:0};if(e)for(var n=e.parentElement;n&&n!==t;)r.scrollX+=n.scrollLeft,r.scrollY+=n.scrollTop,n=n.parentElement;return r},e.getOffsetByPosition=function(e,t,r){if(this.isTextNode(e)){var o=e.textContent;if(o){var i=new n.UString(o);return this.binarySearchPosition(i,e,t,r,0,i.graphemeCount(),o.length)}}return{offset:0,offsetUString:0,offsetPx:0}},e.binarySearchPosition=function(e,t,r,n,o,i,a){if(i-o>1){var s=Math.floor((o+i)/2);return(p=document.createRange()).setStart(t,e.graphemeIndex2CharCodeIndexRange(o).start),p.setEnd(t,e.graphemeIndex2CharCodeIndexRange(s).end>a?a:e.graphemeIndex2CharCodeIndexRange(s).end),n<=(c=(l=p.getBoundingClientRect()).left-r)+(u=l.width)?this.binarySearchPosition(e,t,r,n,o,s,a):this.binarySearchPosition(e,t,r,n,s,i,a)}var p,l,c,u;return(p=document.createRange()).setStart(t,e.graphemeIndex2CharCodeIndexRange(o).start),p.setEnd(t,e.graphemeIndex2CharCodeIndexRange(o).end+1>a?a:e.graphemeIndex2CharCodeIndexRange(o).end+1),n<=(c=(l=p.getBoundingClientRect()).left-r)+(u=l.width)/2?{offset:o,offsetUString:e.graphemeIndex2CharCodeIndexRange(o).start,offsetPx:c}:{offset:i,offsetUString:e.graphemeIndex2CharCodeIndexRange(o).end+1,offsetPx:c+u}},e.getDirectElementListForTags=function(e,t){if(!e||!t)return[];var r=e.children;return r?[].slice.call(r).filter((function(e){return t.some((function(t){return e.tagName.toLowerCase()===t}))})):[]},e.isElementNode=function(e){if(null==e)return!1;if(e instanceof Element)return!0;var t=e,r="";do{if(t=Object.getPrototypeOf(t),"[object Element]"===(r=Object.prototype.toString.call(t))||"[object ElementPrototype]"===r)return!0}while(null!==t&&"[object Node]"!==r&&"[object NodePrototype]"!==r);return!1},e}();(a=e.MonitorName||(e.MonitorName={})).JS_ERROR_RELEASE="JS_ERROR_RELEASE",a.JS_ERROR_RELEASE_ONCE="JS_ERROR_RELEASE_ONCE",a.JS_ERROR_GRAY="JS_ERROR_GRAY",a.PV="PV",a.JS_ERROR_TOB="JS_ERROR_TOB",a.JS_ERROR_TOB_ONCE="JS_ERROR_TOB_ONCE",a.JQUERY_REWRITE_ERROR="JQUERY_REWRITE_ERROR",a.NON_EDIT_ERROR="NON_EDIT_ERROR",a.AUTO_TEST_ERROR="AUTO_TEST_ERROR",a.ACTIVE_REPORT_ERROR="ACTIVE_REPORT_ERROR",a.IGNORE_JS_ERROR_PLAY_BACKGROUND_MUSIC="IGNORE_JS_ERROR_PLAY_BACKGROUND_MUSIC",a.IGNORE_JS_ERROR_SET_KEYBOARD_HEIGHT="IGNORE_JS_ERROR_SET_KEYBOARD_HEIGHT",a.IGNORE_JS_ERROR_TEST="IGNORE_JS_ERROR_TEST",a.IGNORE_JS_ERROR_WEIXIN_JSBRIDGE="IGNORE_JS_ERROR_WEIXIN_JSBRIDGE",a.IGNORE_JS_ERROR_CAPTURED_EXCEPTION="IGNORE_JS_ERROR_CAPTURED_EXCEPTION",a.IGNORE_JS_ERROR_RELOCATEFORNATIVE="IGNORE_JS_ERROR_RELOCATEFORNATIVE",a.IGNORE_JS_ERROR_COMMON_BANNER="IGNORE_JS_ERROR_COMMON_BANNER",a.IGNORE_JS_ERROR_VIVO="IGNORE_JS_ERROR_VIVO",a.IGNORE_JS_ERROR_X5="IGNORE_JS_ERROR_X5",a.IGNORE_JS_ERROR_CEFQUERY="IGNORE_JS_ERROR_CEFQUERY",a.IGNORE_JS_ERROR_EXECUTE_JS_INTERFACE="IGNORE_JS_ERROR_EXECUTE_JS_INTERFACE",a.IGNORE_JS_ERROR_QTCONFIG="IGNORE_JS_ERROR_QTCONFIG",a.IGNORE_JS_ERROR_LOWB_INJECTION="IGNORE_JS_ERROR_LOWB_INJECTION",a.CHANGESET_ERROR_RELEASE="CHANGESET_ERROR_RELEASE",a.CHANGESET_ERROR_GRAY="CHANGESET_ERROR_GRAY",a.CHANGESET_ERROR_TOB="CHANGESET_ERROR_TOB",a.CHANGESET_ERROR_ONCE="CHANGESET_ERROR_ONCE",a.CHANGESET_ERROR_CONTINUE="CHANGESET_ERROR_CONTINUE",a.CHANGESET_ERROR_INIT="CHANGESET_ERROR_INIT",a.CHANGESET_ERROR_CREATE_DELTA="CHANGESET_ERROR_CREATE_DELTA",a.CHANGESET_ERROR_APPLY_DELTA="CHANGESET_ERROR_APPLY_DELTA",a.CHANGESET_ERROR_DELTA2CS="CHANGESET_ERROR_DELTA2CS",a.CHANGESET_ERROR_APPLY_OFFLINE="CHANGESET_ERROR_APPLY_OFFLINE",a.CHANGESET_ERROR_APPLY_ONLINE="CHANGESET_ERROR_APPLY_ONLINE",a.CHANGESET_ERROR_EASYSYNC="CHANGESET_ERROR_EASYSYNC",a.CHANGESET_ERROR_VERIFY="CHANGESET_ERROR_VERIFY",a.CHANGESET_ERROR_VERIFY_MODELEN="CHANGESET_ERROR_VERIFY_MODELEN",a.CHANGESET_ERROR_MAIN_RANGE="CHANGESET_ERROR_MAIN_RANGE",a.CHANGESET_ERROR_COMMIT="CHANGESET_ERROR_COMMIT",a.CHANGESET_ERROR_COMMIT_SPIKE="CHANGESET_ERROR_COMMIT_SPIKE",a.CHANGESET_ERROR_EXCEPTION="CHANGESET_ERROR_EXCEPTION",a.DATA_PRODUCE="DATA_PRODUCE",a.DATA_PRODUCE_TABLE_HEADER="DATA_PRODUCE_TABLE_HEADER",a.DATA_PRODUCE_TABLE="DATA_PRODUCE_TABLE",a.DATA_TRANSFORM="DATA_TRANSFORM",a.DATA_TRANSFORM_TABLE="DATA_TRANSFORM_TABLE",a.DATA_VERIFY="DATA_VERIFY",a.DATA_COMPOSE="DATA_COMPOSE",a.DATA_COMPOSE_TABLE_HEADER="DATA_COMPOSE_TABLE_HEADER",a.DATA_COMPOSE_TABLE="DATA_COMPOSE_TABLE",a.DATA_ACCEPT="DATA_ACCEPT",a.DATA_ACCEPT_TABLE_HEADER="DATA_ACCEPT_TABLE_HEADER",a.DATA_ACCEPT_TABLE="DATA_ACCEPT_TABLE",a.DATA_PRODUCE_ERROR_FRONT="DATA_PRODUCE_ERROR_FRONT",a.DATA_PRODUCE_ERROR_BACK="DATA_PRODUCE_ERROR_BACK",a.DATA_PRODUCE_ERROR_TIMEOUT="DATA_PRODUCE_ERROR_TIMEOUT",a.DATA_PRODUCE_ERROR_TIPS="DATA_PRODUCE_ERROR_TIPS",a.DATA_PRODUCE_LITTLE_UNCOMMIT="DATA_PRODUCE_LITTLE_UNCOMMIT",a.JS_ERROR_FREQUENT="JS_ERROR_FREQUENT",a.JS_ERROR_FREQUENT_HUNDRED="JS_ERROR_FREQUENT_HUNDRED",a.CORE_INDEX_PRODUCE_DELTA="CORE_INDEX_PRODUCE_DELTA",a.CORE_INDEX_PRODUCE_CHANGESET="CORE_INDEX_PRODUCE_CHANGESET",a.FRAME_DROP_NORMAL="FRAME_DROP_NORMAL",a.FRAME_DROP_SERIOUS="FRAME_DROP_SERIOUS",a.HTML_PARSE_ERROR="HTML_PARSE_ERROR",a.HOT_UPGRADE="HOT_UPGRADE",a.HOT_UPGRADE_STOCK="HOT_UPGRADE_STOCK",a.TABLE_MERGE="TABLE_MERGE",a.HAS_TABLE="HAS_TABLE",a.PV_PUBLISH="PV_PUBLISH",a.PV_TOB="PV_TOB",a.TABLE_DATA_CHECK_FAILED="TABLE_DATA_CHECK_FAILED",a.TABLE_DATA_FIX_FAILED="TABLE_DATA_FIX_FAILED",a.COMMENT_INVALID_PLACEHOLDER="COMMENT_INVALID_PLACEHOLDER",a.COMMENT_REPEAT_FIX="COMMENT_REPEAT_FIX",a.COMMENT_UPGRADE="COMMENT_UPGRADE",a.NOTIFICATION_LISTENERS_EXCEED="NOTIFICATION_LISTENERS_EXCEED",a.PERFORMANCE_REPORT_NEGATIVE_ERROR="PERFORMANCE_REPORT_NEGATIVE_ERROR",(s=e.RavenLogger||(e.RavenLogger={})).DEFAULT="javascript",s.CHANGESET_COMMIT="changeset_commit",s.ACTIVE_REPORT="active_report",s.NON_EDIT_ERROR="non_edit_error",(p=e.ChangesetDataType||(e.ChangesetDataType={})).EDIT_DATA="0",p.INIT_DATA="1",p.APPLY_SERVER_DATA="2",(l=e.EditorDocumentType||(e.EditorDocumentType={})).DOCUMENT="1",l.TABLE="2";var f=!0;window.addEventListener("online",(function(){f=!0})),window.addEventListener("offline",(function(){f=!1}));var d=function(){function e(){var e=this;this.reportDataCache=new Map,this.reportAtInterval(),window.addEventListener("beforeunload",(function(){e.doActionReport()}))}return e.prototype.coreIndexReport=function(e,t,r){this.action(e,r),g.monitor(t)},e.prototype.action=function(e,t){try{if(t.reportAtOnce)g.tdwReportSingle(e);else{var n=e.opername+"&"+e.module+"&"+e.action+"&"+e.ver5,o=this.reportDataCache.get(n);o?o.obj3+=e.obj3:o=e,this.reportDataCache.set(n,o)}}catch(e){r.Logger.error(e)}},e.prototype.reportAtInterval=function(){var e=this;setTimeout((function(){e.doActionReport(),e.reportAtInterval()}),5e3)},e.prototype.doActionReport=function(){this.reportDataCache.size>0&&f&&(this.reportDataCache.forEach((function(e){g.tdwReport(e)})),this.reportDataCache.clear())},e}(),g=function(){function t(){}return t.monitor=function(e){t.monitorHandler&&t.monitorHandler.monitor(e)},t.monitorWtihPlatform=function(e){t.monitorHandler&&t.monitorHandler.monitorWtihPlatform(e)},t.captureException=function(r,n,o){t.errorHandler&&(n.logger||(n.logger=e.RavenLogger.ACTIVE_REPORT),t.errorHandler.captureException(r,n,o))},t.captureChangesetException=function(t,n,o){n.option||(r.Logger.error("ravenExtraData.option undefined is not allowed"),n.option={}),n.option.needBreakAndRefresh=!0,n.logger=e.RavenLogger.CHANGESET_COMMIT,this.captureException(t,n,o)},t.tdwReport=function(e,r){var n=e;t.tdwHandler&&(n&&"doc_word_editor"===n.opername&&(n.ver10="new_menubar"),t.tdwHandler.tdwReport(n,r))},t.tdwReportSingle=function(e){t.tdwHandler&&t.tdwHandler.tdwReportSingle(e)},t.onUserAction=function(e,t){this.beaconHandler&&this.beaconHandler.onUserAction(e,t)},t.coreIndexReport=function(e,r,n){t.performanHandler&&t.performanHandler.coreIndexReport(e,r,n)},t.performanHandler=new d,t}();function y(e,t,r){for(var n=0,o=0,i=0;n<e.length&&o<t.length;){var a=r(e[n],t[o]);0===a?(i+=1,n+=1,o+=1):a<0?n+=1:o+=1}return i}function m(e,t,r){for(var n=[],o=[],i=[],a=0,s=0;a<e.length&&s<t.length;){var p=e[a],l=t[s],c=r(p,l);0===c?(i.push(p),a+=1,s+=1):c<0?(n.push(p),a+=1):(o.push(l),s+=1)}return a<e.length&&b(n,e,a),s<t.length&&b(o,t,s),{local:n,income:o,share:i}}function b(e,t,r){for(var n=r;n<t.length;n++)e.push(t[n])}function P(e,t,r){for(var n=new Array(e.length+t.length),o=0,i=0,a=0;i<e.length&&a<t.length;){var s=e[i],p=t[a];r(s,p)<=0?(n[o]=s,o+=1,i+=1):(n[o]=p,o+=1,a+=1)}return i<e.length&&(o=v(n,e,o,i)),a<t.length&&(o=v(n,t,o,a)),n}function v(e,t,r,n){for(var o=n;o<t.length;o++)e[r]=t[o],r+=1;return r}function x(){var e=r.pxToTwips(8);return r.PlatformUtil.isMac()||!r.PlatformUtil.isIE()&&!r.PlatformUtil.isFireFox()||(e=r.pxToTwips(18)),e}function T(){var e=r.pxToTwips(8);return r.PlatformUtil.isMac()||!r.PlatformUtil.isIE()&&!r.PlatformUtil.isFireFox()||(e=r.pxToTwips(18)),e}window.ReportHelper=g;var _,S,C,B=function(){function e(){}return e.intersection=function(e,t){var r={start:Math.max(e.start,t.start),end:Math.min(e.end,t.end)};return this.isValid(r)?r:null},e.isValid=function(e){return e.end>=e.start},e.intersectionLength=function(e,t){var r=this.intersection(e,t);return r?r.end-r.start+1:0},e}();(_=e.KeyCode||(e.KeyCode={}))[_.EMPTY=-1]="EMPTY",_[_.BACKSPACE=8]="BACKSPACE",_[_.TAB=9]="TAB",_[_.ENTER=13]="ENTER",_[_.SHIFT=16]="SHIFT",_[_.CTRL=17]="CTRL",_[_.ALT=18]="ALT",_[_.CAPS_LOCK=20]="CAPS_LOCK",_[_.ESCAPE=27]="ESCAPE",_[_.SPACE=32]="SPACE",_[_.PAGE_UP=33]="PAGE_UP",_[_.PAGE_DOWN=34]="PAGE_DOWN",_[_.END=35]="END",_[_.HOME=36]="HOME",_[_.ARROW_LEFT=37]="ARROW_LEFT",_[_.ARROW_UP=38]="ARROW_UP",_[_.ARROW_RIGHT=39]="ARROW_RIGHT",_[_.ARROW_DOWN=40]="ARROW_DOWN",_[_.INSERT=45]="INSERT",_[_.DELETE=46]="DELETE",_[_.NUM_0=48]="NUM_0",_[_.NUM_1=49]="NUM_1",_[_.NUM_2=50]="NUM_2",_[_.NUM_3=51]="NUM_3",_[_.NUM_4=52]="NUM_4",_[_.NUM_5=53]="NUM_5",_[_.NUM_6=54]="NUM_6",_[_.NUM_7=55]="NUM_7",_[_.NUM_8=56]="NUM_8",_[_.NUM_9=57]="NUM_9",_[_.A=65]="A",_[_.B=66]="B",_[_.C=67]="C",_[_.D=68]="D",_[_.E=69]="E",_[_.F=70]="F",_[_.G=71]="G",_[_.H=72]="H",_[_.I=73]="I",_[_.J=74]="J",_[_.K=75]="K",_[_.L=76]="L",_[_.M=77]="M",_[_.N=78]="N",_[_.O=79]="O",_[_.P=80]="P",_[_.Q=81]="Q",_[_.R=82]="R",_[_.S=83]="S",_[_.T=84]="T",_[_.U=85]="U",_[_.V=86]="V",_[_.W=87]="W",_[_.X=88]="X",_[_.Y=89]="Y",_[_.Z=90]="Z",_[_.META_LEFT=91]="META_LEFT",_[_.META_RIGHT=93]="META_RIGHT",_[_.SMALL_KEYBOARD_NUM_0=96]="SMALL_KEYBOARD_NUM_0",_[_.SMALL_KEYBOARD_NUM_1=97]="SMALL_KEYBOARD_NUM_1",_[_.SMALL_KEYBOARD_NUM_2=98]="SMALL_KEYBOARD_NUM_2",_[_.SMALL_KEYBOARD_NUM_3=99]="SMALL_KEYBOARD_NUM_3",_[_.SMALL_KEYBOARD_NUM_4=100]="SMALL_KEYBOARD_NUM_4",_[_.SMALL_KEYBOARD_NUM_5=101]="SMALL_KEYBOARD_NUM_5",_[_.SMALL_KEYBOARD_NUM_6=102]="SMALL_KEYBOARD_NUM_6",_[_.SMALL_KEYBOARD_NUM_7=103]="SMALL_KEYBOARD_NUM_7",_[_.SMALL_KEYBOARD_NUM_8=104]="SMALL_KEYBOARD_NUM_8",_[_.SMALL_KEYBOARD_NUM_9=105]="SMALL_KEYBOARD_NUM_9",_[_.NUM_TIMES=106]="NUM_TIMES",_[_.NUM_PLUS=107]="NUM_PLUS",_[_.NUM_MINUS=109]="NUM_MINUS",_[_.NUM_DIVIDE=111]="NUM_DIVIDE",_[_.F1=112]="F1",_[_.F2=113]="F2",_[_.F3=114]="F3",_[_.F4=115]="F4",_[_.F5=116]="F5",_[_.F6=117]="F6",_[_.F7=118]="F7",_[_.F8=119]="F8",_[_.F9=120]="F9",_[_.F10=121]="F10",_[_.F11=122]="F11",_[_.F12=123]="F12",_[_.EQUAL=187]="EQUAL",_[_.MINUS=189]="MINUS",(S=e.KeyCodeFireFox||(e.KeyCodeFireFox={}))[S.EQUAL=61]="EQUAL",S[S.MINUS=173]="MINUS",S[S.META_FIREFOX=224]="META_FIREFOX",(C=e.KeyAssist||(e.KeyAssist={}))[C.SHIFT=1e3]="SHIFT",C[C.ALT=1e4]="ALT",C[C.CTRL_WIN=1e5]="CTRL_WIN",C[C.CTRL_MAC=2e5]="CTRL_MAC",C[C.WIN=1e6]="WIN",C[C.COMMAND=2e6]="COMMAND";var R,w,I,E,L;function O(e){var t=new RegExp("(?:^|;+|\\s+)"+e+"=([^;]*)"),r=document.cookie.match(t);return(r?r[1]:"")||null}(R=e.MouseCode||(e.MouseCode={}))[R.PRIMARY_BUTTON=1e7]="PRIMARY_BUTTON",R[R.SECONDARY_BUTTON=2e7]="SECONDARY_BUTTON",R[R.MIDDLE_BUTTON=4e7]="MIDDLE_BUTTON",(w=e.WheelCode||(e.WheelCode={}))[w.WHEEL_ANTICLOCKWISE=1e8]="WHEEL_ANTICLOCKWISE",w[w.WHEEL_CLOCKWISE=2e8]="WHEEL_CLOCKWISE",(I=e.KeyType||(e.KeyType={})).KEY_UP="keyup",I.KEY_PRESS="keypress",I.KEY_DOWN="keydown",(E=e.IPadKeyCode||(e.IPadKeyCode={})).EMPTY="",E.A="a",E.B="b",E.C="c",E.D="d",E.E="e",E.F="f",E.G="g",E.H="h",E.I="i",E.J="j",E.K="k",E.L="l",E.M="m",E.N="n",E.O="o",E.P="p",E.Q="q",E.R="r",E.S="s",E.T="t",E.U="u",E.V="v",E.W="w",E.X="x",E.Y="y",E.Z="z",E.ARROW_LEFT="left",E.ARROW_UP="up",E.ARROW_RIGHT="right",E.ARROW_DOWN="down",E.EQUAL="=",(L=e.IPadKeyModifier||(e.IPadKeyModifier={})).NONE="",L.COMMAND="command",L.CTRL="control",L.SHIFT="shift",L.ALT="alt",L.COMMAND_SHIFT="shift|command";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
var N=function(e,t){return(N=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)};function k(e,t){function r(){this.constructor=e}N(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var M=function(){return(M=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function D(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}function F(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function A(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a}function K(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(A(arguments[t]));return e}var G,H=function(){function e(){}return e.prototype.setData=function(e){},e.prototype.postNext=function(){},e.prototype.postPrev=function(){},e.prototype.notEqual=function(e){return!this.equal(e)},e}();!function(e){e[e.RED=0]="RED",e[e.BLACK=1]="BLACK"}(G||(G={}));var j=function(){},U=function(){function e(){}return e.prototype.left=function(e){return null!==e?e.left:null},e.prototype.right=function(e){return null!==e?e.right:null},e.prototype.parent=function(e){return null!==e?e.parent:null},e.prototype.setLeft=function(e,t){return null!==e?(e.left=t,e.left):null},e.prototype.setRight=function(e,t){return null!==e?(e.right=t,e.right):null},e.prototype.setParent=function(e,t){return null!==e?(e.parent=t,e.parent):null},e.prototype.color=function(e){return null!==e?e.color:null},e.prototype.setColor=function(e,t){return null!==e?(e.color=t,e.color):null},e.prototype.reset=function(e,t,r,n,o){this.setLeft(e,t),this.setRight(e,r),this.setParent(e,n),void 0!==o&&this.setColor(e,o)},e.prototype.isRoot=function(e){return this.color(e)===G.BLACK&&this.parent(this.parent(e))===e},e.prototype.isHeader=function(e){return this.color(e)===G.RED&&this.parent(this.parent(e))===e},e.prototype.root=function(e){for(;!this.isRoot(e);)e=this.parent(e);return e},e.prototype.header=function(e){for(;!this.isHeader(e);)e=this.parent(e);return e},e.prototype.leftMostChild=function(e){for(;this.left(e);)e=this.left(e);return e},e.prototype.rightMostChild=function(e){for(;this.right(e);)e=this.right(e);return e},e.prototype.next=function(e){if(this.isHeader(e))return this.left(e);if(this.right(e))return this.leftMostChild(this.right(e));for(var t=this.parent(e);e===this.right(t);)e=t,t=this.parent(e);return this.right(e)===t?e:t},e.prototype.prev=function(e){if(this.isHeader(e))return this.right(e);if(this.left(e))return this.rightMostChild(this.left(e));for(var t=this.parent(e);e===this.left(t);)e=t,t=this.parent(e);return this.left(e)===t?e:t},e.prototype.deep=function(e,t){for(var r=0;t?e!==t:!this.isHeader(e);e=this.parent(e))r+=1;return r},e.prototype.rotateLeft=function(e,t){var r=this.right(t),n=this.left(r);this.setRight(t,n),n&&this.setParent(n,t);var o=this.parent(t);this.setParent(r,o),o===e?this.setParent(e,r):this.left(o)===t?this.setLeft(o,r):this.setRight(o,r),this.setLeft(r,t),this.setParent(t,r)},e.prototype.rotateRight=function(e,t){var r=this.left(t),n=this.right(r);this.setLeft(t,n),n&&this.setParent(n,t);var o=this.parent(t);this.setParent(r,o),o===e?this.setParent(e,r):this.left(o)===t?this.setLeft(o,r):this.setRight(o,r),this.setRight(r,t),this.setParent(t,r)},e.prototype.insertFixUp=function(e,t){for(;t!==this.parent(e)&&this.color(this.parent(t))===G.RED;){var r=this.parent(t),n=this.parent(r);if(this.left(n)===r){if(!(i=this.right(n))||this.color(i)!==G.RED){if(t===this.right(r)){this.rotateLeft(e,r);var o=t;t=r,r=o}this.setColor(r,G.BLACK),this.setColor(n,G.RED),this.rotateRight(e,n);break}this.setColor(r,G.BLACK),this.setColor(i,G.BLACK),this.setColor(n,G.RED),t=n}else{var i;if(!(i=this.left(n))||this.color(i)!==G.RED){if(t===this.left(r)){this.rotateRight(e,r);o=t;t=r,r=o}this.setColor(r,G.BLACK),this.setColor(n,G.RED),this.rotateLeft(e,n);break}this.setColor(r,G.BLACK),this.setColor(i,G.BLACK),this.setColor(n,G.RED),t=n}}this.color(this.parent(e))===G.RED&&this.setColor(this.parent(e),G.BLACK)},e.prototype.eraseSwap=function(e,t){var r=this.leftMostChild(this.right(t)),n=this.parent(t),o=this.left(t),i=this.right(r);if(r===this.right(t))this.setParent(t,r),this.setRight(r,t);else{var a=this.right(t),s=this.parent(r);this.setParent(t,s),this.setRight(r,a),this.setParent(a,r),this.setLeft(s,t)}this.setLeft(t,null),this.setRight(t,i),this.setParent(r,n),this.setLeft(r,o),this.setParent(o,r),i&&this.setParent(i,t),n===e?this.setParent(n,r):this.left(n)===t?this.setLeft(n,r):this.setRight(n,r);var p=this.color(t);this.setColor(t,this.color(r)),this.setColor(r,p)},e.prototype.eraseFixUp=function(e,t){for(;t!==this.parent(e);){if(this.color(t)===G.RED){this.setColor(t,G.BLACK);break}var r=this.parent(t);if(this.left(r)===t){var n=this.right(r);if(this.color(n)===G.RED&&(this.rotateLeft(e,r),this.setColor(r,G.RED),this.setColor(n,G.BLACK),n=this.right(r)),!(o=this.right(n))||this.color(o)===G.BLACK){if(!(i=this.left(n))||this.color(i)===G.BLACK){this.setColor(n,G.RED),t=r;continue}this.rotateRight(e,n),this.setColor(n,G.RED),this.setColor(i,G.BLACK),n=this.right(r),o=this.right(n)}this.rotateLeft(e,r),this.setColor(n,this.color(r)),this.setColor(r,G.BLACK),this.setColor(o,G.BLACK);break}var o;n=this.left(r);if(this.color(n)===G.RED&&(this.rotateRight(e,r),this.setColor(r,G.RED),this.setColor(n,G.BLACK),n=this.left(r)),!(o=this.left(n))||this.color(o)===G.BLACK){var i;if(!(i=this.right(n))||this.color(i)===G.BLACK){this.setColor(n,G.RED),t=r;continue}this.rotateLeft(e,n),this.setColor(n,G.RED),this.setColor(i,G.BLACK),n=this.left(r),o=this.left(n)}this.rotateRight(e,r),this.setColor(n,this.color(r)),this.setColor(r,G.BLACK),this.setColor(o,G.BLACK);break}},e.prototype.eraseCut=function(e,t){var r=this.left(t);r||(r=this.right(t));var n=this.parent(t);r&&this.setParent(r,n),n===e?r?(this.setParent(e,r),this.color(r)===G.RED&&this.setColor(r,G.BLACK)):this.setParent(e,e):this.left(n)===t?this.setLeft(n,r):this.setRight(n,r),this.left(e)===t&&(this.right(t)?this.setLeft(e,this.leftMostChild(this.right(t))):this.setLeft(e,this.parent(t))),this.right(e)===t&&(this.left(t)?this.setRight(e,this.rightMostChild(this.left(t))):this.setRight(e,this.parent(t)))},e.prototype.insert=function(e,t,r){if(t===e)(t=this.right(e))===e?this.reset(e,r,r,r):(this.setRight(t,r),this.setRight(e,r));else if(this.left(t)){for(t=this.left(t);this.right(t);)t=this.right(t);this.setRight(t,r)}else this.setLeft(t,r),t===this.left(e)&&this.setLeft(e,r);return this.reset(r,null,null,t,G.RED),this.insertFixUp(e,r),r},e.prototype.insertToRight=function(e,t,r){if(t===e)(t=this.left(e))===e?this.reset(e,r,r,r):(this.setLeft(t,r),this.setLeft(e,r));else if(this.right(t)){for(t=this.right(t);this.left(t);)t=this.left(t);this.setLeft(t,r)}else this.setRight(t,r),t===this.right(e)&&this.setRight(e,r);return this.reset(r,null,null,t,G.RED),this.insertFixUp(e,r),r},e.prototype.insertRoot=function(e,t){return this.reset(e,t,t,t),this.reset(t,null,null,e,G.BLACK),t},e.prototype.insertLeft=function(e,t,r){return this.setLeft(t,r),t===this.left(e)&&this.setLeft(e,r),this.reset(r,null,null,t,G.RED),this.insertFixUp(e,r),r},e.prototype.insertRight=function(e,t,r){return this.setRight(t,r),t===this.right(e)&&this.setRight(e,r),this.reset(r,null,null,t,G.RED),this.insertFixUp(e,r),r},e.prototype.erase=function(e,t){return this.left(t)&&this.right(t)&&this.eraseSwap(e,t),this.eraseFixUp(e,t),this.eraseCut(e,t),t},e}(),z=function(e){function t(t,r){var n=e.call(this)||this;return n.node=t,n.policy=r,n}return k(t,e),t.prototype.copy=function(){return new t(this.node,this.policy)},t.prototype.data=function(){return null},t.prototype.setData=function(e){},t.prototype.next=function(){return this.node=this.policy.next(this.node),this},t.prototype.postNext=function(){var e=this.copy();return this.next(),e},t.prototype.prev=function(){return this.node=this.policy.prev(this.node),this},t.prototype.postPrev=function(){var e=this.copy();return this.prev(),e},t.prototype.equal=function(e){return this.node===e.getNode()},t.prototype.getNode=function(){return this.node},t}(H),W=function(){function e(e){this._header=e,this.resetHeader()}return e.prototype.resetHeader=function(){var e=this.header();this.policy().reset(e,e,e,e,G.RED)},e.prototype.policy=function(){return this._policy||(this._policy=new U),this._policy},e.prototype.header=function(){return this._header},e.prototype.root=function(){return this.policy().parent(this.header())},e.prototype.leftMost=function(){return this.policy().left(this.header())},e.prototype.rightMost=function(){return this.policy().right(this.header())},e.prototype.insert=function(e,t){return this.policy().insert(this.header(),e,t)},e.prototype.erase=function(e){return this.policy().erase(this.header(),e)},e.prototype.deep=function(e){return this.policy().deep(this.header(),e)},e}(),V=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return k(t,e),t}(j),Y=(function(e){function t(){var t=new V;return e.call(this,t)||this}k(t,e)}(W),function(){function e(e){this.val=e}return e.prototype.copy=function(){return new e(this.val)},e.pos=function(t){return new e(t)},e.zero=function(){return new e(0)},e.invalid=function(){return new e(-1)},e.add=function(t,r){return new e(t.val+r.val)},e.prototype.addTo=function(e){this.val=this.val+e.val},e.minus=function(t,r){return new e(t.val-r.val)},e.prototype.minusTo=function(e){this.val=this.val-e.val},e.more=function(e,t){return e.val>t.val},e.prototype.moreThan=function(e){return this.val>e.val},e.less=function(e,t){return e.val<t.val},e.prototype.lestThan=function(e){return this.val<e.val},e.equal=function(e,t){return e.val===t.val},e.prototype.equalThan=function(e){return this.val===e.val},e.prototype.toString=function(){return String(this.val)},e}());function q(e){return"number"==typeof e?Y.pos(e):e}var X,J,Z=Y.pos(-1);(X=e.PosPolicy||(e.PosPolicy={}))[X.Outer=0]="Outer",X[X.Inner=1]="Inner",(J=e.DupPolicy||(e.DupPolicy={}))[J.Allow=0]="Allow",J[J.Forbid=1]="Forbid";var Q=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return k(t,e),t}(j),$=function(t){function r(){var r=null!==t&&t.apply(this,arguments)||this;return r.posPolicy=e.PosPolicy.Outer,r.dupPolicy=e.DupPolicy.Forbid,r}return k(r,t),r.prototype.off=function(e){return null!==e?e.off.copy():Y.zero()},r.prototype.setOff=function(e,t){return null!==e?(e.off=t,e.off):Y.zero()},r.prototype.data=function(e){return null!==e?e.data:null},r.prototype.setData=function(e,t){return null!==e?(e.data=t,e.data):null},r.prototype.cmpPos=function(t,r){return this.posPolicy===e.PosPolicy.Outer?!r.lestThan(t):this.posPolicy===e.PosPolicy.Inner&&t.lestThan(r)},r.prototype.findInsertPos=function(t,r){var n=this.parent(t);if(n===t)return n;var o=t;if(this.dupPolicy===e.DupPolicy.Forbid)for(;n;)if(this.off(n).lestThan(r))r.minusTo(this.off(n)),n=this.right(n);else{if(!r.lestThan(this.off(n)))return null;o=n,n=this.left(n)}else if(this.dupPolicy===e.DupPolicy.Allow)for(;n;)this.cmpPos(this.off(n),r)?(r.minusTo(this.off(n)),n=this.right(n)):(o=n,n=this.left(n));return o},r.prototype.position=function(e,t){for(var r=e,n=this.off(r),o=this.parent(r);o!==t;o=this.parent(o))this.right(o)===r&&n.addTo(this.off(o)),r=o;return n},r.prototype.findOuter=function(e,t){var r=this.parent(e);if(r===e)return e;for(var n=t.copy(),o=e;r;)this.cmpPos(this.off(r),n)?(n.minusTo(this.off(r)),r=this.right(r)):(o=r,r=this.left(r));return o},r.prototype.findInner=function(e,t){var r=this.parent(e);if(r===e)return e;for(var n=t.copy(),o=e;r;)this.cmpPos(this.off(r),n)?(n.minusTo(this.off(r)),o=r,r=this.right(r)):r=this.left(r);return o},r.prototype.insertSpace=function(e,t,r){var n=this.parent(e);if(n!==e)for(var o=t.copy();n;)this.cmpPos(this.off(n),o)?(o.minusTo(this.off(n)),n=this.right(n)):(this.setOff(n,Y.add(this.off(n),r)),n=this.left(n))},r.prototype.eraseSpace=function(e,t,r){var n=this.parent(e);if(n!==e)for(var o=t.copy();n;)this.cmpPos(this.off(n),o)?(o.minusTo(this.off(n)),n=this.right(n)):(this.setOff(n,Y.minus(this.off(n),r)),n=this.left(n))},r.prototype.rotateLeft=function(e,r){var n=this.right(r);this.setOff(n,Y.add(this.off(n),this.off(r))),t.prototype.rotateLeft.call(this,e,r)},r.prototype.rotateRight=function(e,r){var n=this.left(r);this.setOff(r,Y.minus(this.off(r),this.off(n))),t.prototype.rotateRight.call(this,e,r)},r.prototype.eraseSwap=function(e,r){for(var n=this.right(r);this.left(n);)n=this.left(n);var o=this.off(n);this.setOff(n,Y.add(this.off(r),o)),this.setOff(r,Y.zero());for(var i=this.parent(n);i!==r;i=this.parent(i))this.setOff(i,Y.minus(this.off(i),o));t.prototype.eraseSwap.call(this,e,r)},r.prototype.eraseCut=function(e,r){if(this.right(r))for(var n=this.off(r),o=this.right(r);o;o=this.left(o))this.setOff(o,Y.add(this.off(o),n));t.prototype.eraseCut.call(this,e,r)},r}(U),ee=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return k(t,e),t.prototype.copy=function(){return new t(this.node,this.policy)},t.prototype.data=function(){return this.policy.data(this.node)},t.prototype.setData=function(e){this.policy.setData(this.node,e)},t}(z),te=function(e){function t(t,r,n){var o=e.call(this,t)||this;return o._header=t,o._posPolicy=r,o._dupPolicy=n,o.resetHeader(),o}return k(t,e),t.prototype.resetHeader=function(){var t=this.header();return this.policy().setOff(t,Y.zero()),e.prototype.resetHeader.call(this)},t.prototype.policy=function(){return this._ftPolicy||(this._ftPolicy=new $),this._ftPolicy.posPolicy=this._posPolicy,this._ftPolicy.dupPolicy=this._dupPolicy,this._ftPolicy},t.prototype._eraseSpace=function(e,t){for(var r=this,n=[],o=this.policy().findOuter(this.header(),e),i=this.policy().findOuter(this.header(),Y.add(e,t));o!==i;)o&&n.push(o),o=this.policy().next(o);return n.forEach((function(e){var t=r.position(e);r.policy().erase(r.header(),e),r.policy().setOff(e,t),r.policy().reset(e,null,null,null)})),this.policy().eraseSpace(this.header(),e,t),n},t.prototype._allocNode=function(e,t){var r=new Q;return this.policy().setOff(r,e),this.policy().setData(r,t),r},t.prototype.insertFloat=function(e,t){var r=q(e),n=this.policy().findInsertPos(this.header(),r);if(n){var o=this._allocNode(r,t);return this.policy().insert(this.header(),n,o),new ee(o,this.policy())}return this.end()},t.prototype.insertSpace=function(e,t){this.policy().insertSpace(this.header(),q(e),q(t))},t.prototype.eraseSpace=function(e,t,r){var n=this._eraseSpace(q(e),q(t));r&&r(n)},t.prototype.eraseFloat=function(e){this.policy().erase(this.header(),e.getNode())},t.prototype.position=function(e){return e instanceof ee?this.policy().position(e.getNode(),this.header()):e instanceof Q?this.policy().position(e,this.header()):Y.invalid()},t.prototype.findOuter=function(e){return new ee(this.policy().findOuter(this.header(),q(e)),this.policy())},t.prototype.findInner=function(e){return new ee(this.policy().findInner(this.header(),q(e)),this.policy())},t.prototype.setDefaultData=function(e){return this.policy().setData(this.header(),e)},t.prototype.begin=function(){return new ee(this.leftMost(),this.policy())},t.prototype.end=function(){return new ee(this.header(),this.policy())},t.prototype.rbegin=function(){return new ee(this.rightMost(),this.policy())},t}(W),re=function(t){function r(r,n){void 0===r&&(r=e.PosPolicy.Outer),void 0===n&&(n=e.DupPolicy.Forbid);var o=new Q;return t.call(this,o,r,n)||this}return k(r,t),r}(te),ne=function(){function e(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this.gcpBegin=e,this.len=t}return e.prototype.begin=function(){return this.gcpBegin},e.prototype.end=function(){return this.gcpBegin+this.len},e.prototype.length=function(){return this.len},e.prototype.isEmpty=function(){return this.len<=0},e.prototype.isNull=function(){return 0===this.gcpBegin&&this.len<=0},e.prototype.isValid=function(){return this.gcpBegin>=0&&this.len>=0},e.prototype.intersect=function(e,t){var r=!0;return(this.end()<e.begin()||this.end()===e.begin()&&this.length()>0&&!t||this.begin()>e.end()||this.begin()===e.end()&&e.length()>0&&!t)&&(r=!1),r},e.prototype.contains=function(t){var r=t instanceof e?t.begin():t,n=t instanceof e?t.end():t,o=!1;return this.begin()<=r&&(n<this.end()||n===this.end()&&r!==n)&&(o=!0),o},e.prototype.intersectRange=function(t){var r=Math.max(this.begin(),t.begin());return new e(r,Math.min(this.end(),t.end())-r)},e.prototype.unionRange=function(t){var r=Math.min(this.begin(),t.begin());return new e(r,Math.max(this.end(),t.end())-r)},e.prototype.lessThan=function(e){return this.begin()<e.begin()||this.begin()===e.begin()&&this.end()<e.end()},e.prototype.notEqual=function(e){return this.gcpBegin!==e.gcpBegin||this.len!==e.len},e.prototype.equal=function(e){return!this.notEqual(e)},e.prototype.clone=function(){return new e(this.gcpBegin,this.len)},e.prototype.copyFrom=function(e){return this.gcpBegin=e.gcpBegin,this.len=e.len,this},e.prototype.relativeInRange=function(t){return new e(this.begin()-t.begin(),this.length())},e.emptyRange=function(){return new e(0,0)},e.invalidRange=function(){return new e(-1,-1)},e.inset=function(t,r){return new e(t.begin()+r,t.length()-2*r)},e.insetBoth=function(t,r,n){return new e(t.begin()+r,t.length()-r-n)},e}(),oe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return k(t,e),t}(j),ie=function(e,t,r){this.node=e,this.bLeft=t,this.pos=r},ae=function(e){function t(t){void 0===t&&(t=!1);var r=e.call(this)||this;return r.isPolicy2=t,r}return k(t,e),t.prototype.left=function(e){return this.isPolicy2?null!==e?e.left2:null:null!==e?e.left:null},t.prototype.right=function(e){return this.isPolicy2?null!==e?e.right2:null:null!==e?e.right:null},t.prototype.parent=function(e){return this.isPolicy2?null!==e?e.parent2:null:null!==e?e.parent:null},t.prototype.setLeft=function(e,t){return this.isPolicy2&&null!==e?(e.left2=t,e.left2):null!==e?(e.left=t,e.left):null},t.prototype.setRight=function(e,t){return this.isPolicy2&&null!==e?(e.right2=t,e.right2):null!==e?(e.right=t,e.right):null},t.prototype.setParent=function(e,t){return this.isPolicy2&&null!==e?(e.parent2=t,e.parent2):null!==e?(e.parent=t,e.parent):null},t.prototype.color=function(e){return this.isPolicy2?null!==e?e.color2:null:null!==e?e.color:null},t.prototype.setColor=function(e,t){return this.isPolicy2&&null!==e?(e.color2=t,e.color2):null!==e?(e.color=t,e.color):null},t.prototype.off=function(e){return this.isPolicy2?null!==e?e.off2.copy():Y.zero():null!==e?e.off.copy():Y.zero()},t.prototype.setOff=function(e,t){return this.isPolicy2&&null!==e?(e.off2=t.copy(),e.off2):null!==e?(e.off=t.copy(),e.off):Y.zero()},t.prototype.len=function(e){return null!==e?e.len.copy():Y.zero()},t.prototype.setLen=function(e,t){return null!==e?(e.len=t.copy(),e.len):Y.zero()},t.prototype.findForInsertFloat=function(e,t,r){var n=this.parent(e);if(n===e)return e;for(var o=e,i=t.copy();n;)if(this.off(n).lestThan(Y.add(i,r))){if(i.lestThan(Y.add(this.off(n),this.len(n))))return null;i.minusTo(this.off(n)),n=this.right(n)}else o=n,n=this.left(n);return o},t.prototype.findForInsertSpace=function(e,t){var r=t.copy(),n=this.parent(e);if(n===e)return new ie(e,!0,r);for(;;)if(this.off(n).lestThan(r)){if(r.lestThan(Y.add(this.off(n),this.len(n))))return new ie(n,!1,Y.minus(r,this.off(n)));if(r.minusTo(this.off(n)),!this.right(n))return n=this.next(n),new ie(n,!0,r);n=this.right(n)}else{if(!this.left(n))return new ie(n,!0,r);n=this.left(n)}},t.prototype.insertFloat=function(t,r,n){return e.prototype.insertToRight.call(this,t,r,n)},t.prototype.insertSpaceBefore=function(e,t,r){var n=t;this.setOff(n,Y.add(this.off(n),r));for(var o=this.parent(n);o!==e;)this.left(o)===n&&this.setOff(o,Y.add(this.off(o),r)),n=o,o=this.parent(n)},t.prototype.eraseSpaceBefore=function(e,t,r){var n=t;this.setOff(n,Y.minus(this.off(n),r));for(var o=this.parent(n);o!==e;)this.left(o)===n&&this.setOff(o,Y.minus(this.off(o),r)),n=o,o=this.parent(n)},t.prototype.find=function(e,t,r){var n=this.parent(e);if(n===e)return null;for(var o=t;n;)if(o.lestThan(this.off(n)))n=this.left(n);else{if(o.lestThan(Y.add(this.off(n),this.len(n))))return r.val=Y.minus(o,this.off(n)).val,n;o=Y.minus(o,this.off(n)),n=this.right(n)}return null},t.prototype.position=function(e,t){var r=e,n=this.off(r);if(void 0!==t)for(var o=this.parent(r);o!==t;o=this.parent(o))this.right(o)===r&&n.addTo(this.off(o)),r=o;else for(o=this.parent(r);!this.isHeader(o);o=this.parent(o))this.right(o)===r&&n.addTo(this.off(o)),r=o;return n},t.prototype.rotateLeft=function(t,r){var n=this.right(r);this.setOff(n,Y.add(this.off(n),this.off(r))),e.prototype.rotateLeft.call(this,t,r)},t.prototype.rotateRight=function(t,r){var n=this.left(r);this.setOff(r,Y.minus(this.off(r),this.off(n))),e.prototype.rotateRight.call(this,t,r)},t.prototype.eraseSwap=function(t,r){for(var n=this.right(r);this.left(n);)n=this.left(n);var o=this.off(n);this.setOff(n,Y.add(this.off(r),o)),this.setOff(r,Y.zero());for(var i=this.parent(n);i!==r;i=this.parent(i))this.setOff(i,Y.minus(this.off(i),o));e.prototype.eraseSwap.call(this,t,r)},t.prototype.eraseCut=function(t,r){if(this.right(r))for(var n=this.off(r),o=this.right(r);o;o=this.left(o))this.setOff(o,Y.add(this.off(o),n));e.prototype.eraseCut.call(this,t,r)},t}(U),se=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return k(t,e),t.prototype.resetHeader=function(){var e=this.header();this.policy1().setOff(e,Y.zero()),this.policy2().setOff(e,Y.zero()),this.policy1().reset(e,e,e,e,G.RED),this.policy2().reset(e,e,e,e,G.RED)},t.prototype._allocNode=function(){return new oe},t.prototype.policy1=function(){return this._mirrorPolicy1||(this._mirrorPolicy1=new ae),this._mirrorPolicy1},t.prototype.policy2=function(){return this._mirrorPolicy2||(this._mirrorPolicy2=new ae(!0)),this._mirrorPolicy2},t.prototype.policy=function(){return this.policy1()},t.prototype.split=function(e,t){var r=this._allocNode();return this.policy().setLen(r,Y.minus(this.policy().len(e),t)),this.policy1().setOff(r,t),this.policy2().setOff(r,t),this.policy1().right(e)?this.policy1().insertLeft(this.header(),this.policy1().leftMostChild(this.policy1().right(e)),r):this.policy1().insertRight(this.header(),e,r),this.policy2().right(e)?this.policy2().insertLeft(this.header(),this.policy2().leftMostChild(this.policy2().right(e)),r):this.policy2().insertRight(this.header(),e,r),this.cutRight(e,t),r},t.prototype.cutLeft=function(e,t){this.policy().setLen(e,Y.minus(this.policy().len(e),t)),this.policy1().setOff(e,Y.add(this.policy1().off(e),t));for(var r=this.policy1().right(e);r;r=this.policy1().left(r))this.policy1().setOff(r,Y.minus(this.policy1().off(r),t));this.policy2().setOff(e,Y.add(this.policy2().off(e),t));for(r=this.policy2().right(e);r;r=this.policy2().left(r))this.policy2().setOff(r,Y.minus(this.policy2().off(r),t))},t.prototype.extendLeft=function(e,t){this.policy().setLen(e,Y.add(this.policy().len(e),t)),this.policy1().setOff(e,Y.minus(this.policy1().off(e),t));for(var r=this.policy1().right(e);r;r=this.policy1().left(r))this.policy1().setOff(r,Y.add(this.policy1().off(r),t));this.policy2().setOff(e,Y.minus(this.policy2().off(e),t));for(r=this.policy2().right(e);r;r=this.policy2().left(r))this.policy2().setOff(r,Y.add(this.policy2().off(r),t))},t.prototype.cutRight=function(e,t){this.policy().setLen(e,t)},t.prototype.extendRight=function(e,t){this.policy().setLen(e,Y.add(this.policy().len(e),t))},t.prototype._eraseMapping=function(e){var t=this.policy1().position(e),r=this.policy2().position(e);return this.policy1().erase(this.header(),e),this.policy2().erase(this.header(),e),this.policy1().setOff(e,t),this.policy2().setOff(e,r),e},t.prototype._eraseSpace=function(e,t,r,n){var o,i,a=this,s=[],p=r.findForInsertSpace(this.header(),e);if(p.node===this.header())return s;if(p.bLeft)o=p.node;else{if(Y.less(Y.add(p.pos,t),r.len(p.node))){var l=this.split(p.node,Y.add(p.pos,t));return this.cutRight(p.node,p.pos),r.eraseSpaceBefore(this.header(),l,t),s}this.cutRight(p.node,p.pos),o=r.next(p.node)}var c=r.findForInsertSpace(this.header(),Y.add(e,t));if((i=c.node)!==this.header())if(c.bLeft){var u=r.prev(o);u!==this.header()&&Y.equal(r.position(i),Y.add(Y.add(r.position(u),r.len(u)),t))&&Y.equal(n.position(i),Y.add(n.position(u),n.len(u)))&&(r.setLen(u,Y.add(r.len(u),r.len(i))),i=r.next(i))}else this.cutLeft(i,c.pos);for(;o!==i;o=r.next(o))s.push(o);return s.forEach((function(e){a._eraseMapping(e)})),i!==this.header()&&r.eraseSpaceBefore(this.header(),i,t),s},t.prototype.mapping=function(e,t,r){e=q(e),t=q(t),r=q(r);var n=this.policy1().findForInsertFloat(this.header(),e,r);if(!n)return null;var o=this.policy2().findForInsertFloat(this.header(),t,r);if(!o)return null;var i=this.policy1().position(n),a=this.policy2().position(o);if(n!==this.header()&&n===o&&Y.equal(Y.minus(i,r),e)&&Y.equal(Y.minus(a,r),t))return this.extendLeft(n,r),n;var s=this.policy1().prev(n),p=this.policy2().prev(o),l=this.policy1().position(s),c=this.policy2().position(p);if(s!==this.header()&&s===p&&Y.equal(Y.minus(e,l),this.policy().len(s))&&Y.equal(Y.minus(t,c),this.policy().len(p)))return this.extendRight(s,r),s;var u=this._allocNode();return this.policy().setLen(u,r),this.policy1().setOff(u,Y.minus(e,l)),this.policy2().setOff(u,Y.minus(t,c)),this.policy1().insertFloat(this.header(),s,u),this.policy2().insertFloat(this.header(),p,u),u},t.prototype.forwardMapping=function(e,t){e=q(e),t=q(t);var r=e.copy(),n=this.policy1().find(this.header(),e,r);return n?Y.add(r,this.policy2().position(n,this.header())):t},t.prototype.backwardMapping=function(e,t){e=q(e),t=q(t);var r=e.copy(),n=this.policy2().find(this.header(),e,r);return n?Y.add(r,this.policy1().position(n,this.header())):t},t.prototype.insertSpace1=function(e,t){e=q(e),t=q(t);var r=this.policy1().findForInsertSpace(this.header(),e);if(r.node!==this.header())if(r.bLeft)this.policy1().insertSpaceBefore(this.header(),r.node,t);else{var n=this.split(r.node,r.pos);this.policy1().insertSpaceBefore(this.header(),n,t)}},t.prototype.insertSpace2=function(e,t){e=q(e),t=q(t);var r=this.policy2().findForInsertSpace(this.header(),e);if(r.node!==this.header())if(r.bLeft)this.policy2().insertSpaceBefore(this.header(),r.node,t);else{var n=this.split(r.node,r.pos);this.policy2().insertSpaceBefore(this.header(),n,t)}},t.prototype.eraseSpace=function(e,t,r,n,o){e=q(e),t=q(t);var i=this._eraseSpace(e,t,r,n);o&&o(i)},t.prototype.eraseSpace1=function(e,t,r){return e=q(e),t=q(t),this.eraseSpace(e,t,this.policy1(),this.policy2(),r)},t.prototype.eraseSpace2=function(e,t,r){return e=q(e),t=q(t),this.eraseSpace(e,t,this.policy2(),this.policy1(),r)},t.prototype.forwardSpace=function(e,t,r){e=q(e),t=q(t),r=q(r);var n,o,i=[],a=e.copy(),s=this.policy1().find(this.header(),e,a);if(!s)return i;var p=this.policy2().position(s);n=Y.add(p,a),o=Y.add(p,this.policy2().len(s)),a=(e=Y.add(e,t)).copy();var l,c=this.policy1().find(this.header(),e,a);if(c){p=this.policy2().position(c);l=Y.add(p,a)}else c=this.header(),l=r;for(var u=new ne(n.val,0);;){if(s===c){c!==this.header()?u.len=Math.min(o.val,l.val)-u.begin():u.len=o.val-u.begin(),i.push(u);break}if(u.len=o.val-u.begin(),i.push(u),(s=this.policy1().next(s))===this.header()){n=r,o=r;break}n=this.policy2().position(s),o=Y.add(n,this.policy2().len(s)),u=new ne(n.val,0)}return i},t}(W),pe=function(e){function t(){var t=new oe;return e.call(this,t)||this}return k(t,e),t}(se),le=function(){function e(e){this._propertyType=null,this._bagMap=e?new Map(e.entries()):new Map}return Object.defineProperty(e.prototype,"propertyType",{get:function(){return this._propertyType},set:function(e){this._propertyType=e},enumerable:!0,configurable:!0}),e.prototype.prefixGet=function(e){var t,r,n;try{for(var o=F(this._bagMap.entries()),i=o.next();!i.done;i=o.next()){var a=A(i.value,2),s=a[0],p=a[1];if(s.startsWith(e)){n=[s,p];break}}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}return n},e.prototype.get=function(e,t){var r=this._bagMap.get(e);return void 0!==r?r:t},e.prototype.set=function(e,t){return this._bagMap.set(e,t),this},e.prototype.has=function(e){return this._bagMap.has(e)},e.prototype.delete=function(e){return this._bagMap.delete(e)},Object.defineProperty(e.prototype,"size",{get:function(){return this._bagMap.size},enumerable:!0,configurable:!0}),e.prototype.clone=function(){var t=new e(this._bagMap);return t.propertyType=this.propertyType,t},e.prototype.equalTo=function(e,t){var r,n,o=this._bagMap,i=e._bagMap;this._bagMap.size<e._bagMap.size&&(o=e._bagMap,i=this._bagMap);var a=!0;try{for(var s=F(o.entries()),p=s.next();!p.done;p=s.next()){var l=A(p.value,2),c=l[0],u=l[1];if(!(t.includes(c)||i.has(c)&&i.get(c)===u)){a=!1;break}}}catch(e){r={error:e}}finally{try{p&&!p.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return a},e.prototype.merge=function(e,t,r){var n,o,i=[];try{for(var a=F(e._bagMap.entries()),s=a.next();!s.done;s=a.next()){var p=A(s.value,2),l=p[0],c=p[1];!r.includes(l)&&t.includes(l)&&this._bagMap.get(l)!==c&&(this._bagMap.set(l,c),i.push(l))}}catch(e){n={error:e}}finally{try{s&&!s.done&&(o=a.return)&&o.call(a)}finally{if(n)throw n.error}}return i},e.prototype.cover=function(e,t,r,n){var o,i,a=[];try{for(var s=F(this._bagMap.keys()),p=s.next();!p.done;p=s.next()){var l=p.value;!e._bagMap.has(l)&&n.includes(l)&&(this._bagMap.delete(l),a.push(l))}}catch(e){o={error:e}}finally{try{p&&!p.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}return{modifiedProps:this.merge(e,t,r),clearedProps:a}},e.prototype.clear=function(t){var r,n,o,i,a=[];if(t instanceof e)try{for(var s=F(t._bagMap.keys()),p=s.next();!p.done;p=s.next()){var l=p.value;this._bagMap.delete(l)&&a.push(l)}}catch(e){r={error:e}}finally{try{p&&!p.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}else try{for(var c=F(t),u=c.next();!u.done;u=c.next()){l=u.value;this._bagMap.delete(l)&&a.push(l)}}catch(e){o={error:e}}finally{try{u&&!u.done&&(i=c.return)&&i.call(c)}finally{if(o)throw o.error}}return a},e.prototype.common=function(e){var t,r,n=[];try{for(var o=F(this._bagMap.keys()),i=o.next();!i.done;i=o.next()){var a=i.value;this._bagMap.get(a)!==e._bagMap.get(a)&&(this._bagMap.delete(a),n.push(a))}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}return n},e}(),ce=new Map,ue=function(){function e(){}return e.hasPropKeyList=function(e){return ce.has(e)},e.getPropKeyList=function(e){return ce.get(e)},e.setPropKeyList=function(e,t){ce.set(e,t)},e}(),he=function(){function e(){}return e.createProperty=function(e){if(e&&e.propertyType){var t=this.propertyTypeMap.get(e.propertyType);if(t)return new t(e)}return null},e.setPropertyClassType=function(e,t){this.propertyTypeMap.set(e,t)},e.propertyTypeMap=new Map,e}(),fe=function(){function e(t){this._propBag=t&&t instanceof le?t:new le,this._initPropKeyList(),t&&t instanceof e&&this.merge(t)}return e.prototype._initPropKeyList=function(){var e=ue.getPropKeyList(this.propertyType);e?this._propKeyList=e:(he.setPropertyClassType(this.propertyType,this.constructor),this._propKeyList={propList:[],notAllowedCopyProps:[],notCompareProps:[]},this._prepareProp(),ue.setPropKeyList(this.propertyType,this._propKeyList)),this._propBag.propertyType=this.propertyType},e.prototype._appendPropList=function(e){var t,r,n;(t=this._propKeyList.propList).push.apply(t,K(e.propList)),(r=this._propKeyList.notAllowedCopyProps).push.apply(r,K(e.notAllowedCopyProps)),(n=this._propKeyList.notCompareProps).push.apply(n,K(e.notCompareProps))},e.prototype._prepareProp=function(){for(var t=Object.getPrototypeOf(this);t!==Object.prototype&&t instanceof e;)t.hasOwnProperty("propKeyList")&&this._appendPropList(t.propKeyList()),t=Object.getPrototypeOf(t)},e.prototype.propKeyList=function(){return{propList:[],notAllowedCopyProps:[],notCompareProps:[]}},e.prototype.getPropBag=function(e){return void 0===e&&(e=!1),e?this._propBag:this._propBag.clone()},e.prototype.has=function(e){return this._propBag.has(e)},e.prototype.delete=function(e){return this._propBag.delete(e)},e.prototype.clone=function(){var e=this._propBag.clone(),t=Object.create(this);return t._propBag=e,t},e.prototype.equalTo=function(e){return e.constructor.name===this.constructor.name&&this._propBag.equalTo(e._propBag,this._propKeyList.notCompareProps)},e.prototype.merge=function(e){return{modifiedProps:this._propBag.merge(e._propBag,this._propKeyList.propList,this._propKeyList.notAllowedCopyProps),clearedProps:[]}},e.prototype.cover=function(e){var t=this,r=e._propKeyList.propList.filter((function(e){return t._propKeyList.propList.includes(e)}));return this._propBag.cover(e._propBag,this._propKeyList.propList,this._propKeyList.notAllowedCopyProps,r)},e.prototype.clear=function(t){return{modifiedProps:[],clearedProps:t instanceof e?this._propBag.clear(t._propBag):this._propBag.clear(t)}},e.prototype.common=function(e){return{modifiedProps:[],clearedProps:this._propBag.common(e._propBag)}},e}();(e.CommonPropKey||(e.CommonPropKey={})).hidden="common_hidden";var de,ge,ye,me,be,Pe,ve,xe,Te,_e,Se,Ce,Be,Re,we,Ie,Ee,Le,Oe,Ne,ke,Me,De=[e.CommonPropKey.hidden],Fe=[],Ae=[],Ke=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return k(r,t),r.prototype.propKeyList=function(){return{propList:De,notAllowedCopyProps:Fe,notCompareProps:Ae}},Object.defineProperty(r.prototype,"hidden",{get:function(){return this._propBag.get(e.CommonPropKey.hidden,!1)},set:function(t){this._propBag.set(e.CommonPropKey.hidden,t)},enumerable:!0,configurable:!0}),r}(fe);function Ge(t){return t===e.StoryType.PrimaryHeaderStory||t===e.StoryType.FirstPageHeaderStory||t===e.StoryType.EvenPagesHeaderStory}function He(t){return t===e.StoryType.PrimaryFooterStory||t===e.StoryType.FirstPageFooterStory||t===e.StoryType.EvenPagesFooterStory}(de=e.TDSetPropMode||(e.TDSetPropMode={}))[de.Merge=0]="Merge",de[de.Cover=1]="Cover",de[de.Clear=2]="Clear",(ge=e.FontWeightType||(e.FontWeightType={}))[ge.normal=400]="normal",ge[ge.bold=700]="bold",ge[ge.Light=300]="Light",ge[ge.Medium=500]="Medium",(ye=e.SplitlineStyle||(e.SplitlineStyle={})).Normal="normal",ye.NormalBold2="normal-bold-2",ye.NormalBold3="normal-bold-3",ye.NormalBold8="normal-bold-8",ye.NormalBold12="normal-bold-12",ye.Dashed="dashed",ye.Dotted="dotted",ye.SpaceDotted="space-dotted",ye.Wavy="wavy",ye.WavyBold2="wavy-bold-2",ye.WavyBold4="wavy-bold-4",ye.WavyDouble="wavy-double",ye.ShadingV="shading-v",ye.ShadingX="shading-x",ye.ShadingSlash="shading-slash",(me=e.TextDirectionType||(e.TextDirectionType={}))[me.Horizontal=0]="Horizontal",me[me.VerticalFarEast=1]="VerticalFarEast",me[me.Upward=2]="Upward",me[me.Downward=3]="Downward",me[me.HorizontalRotatedFarEast=4]="HorizontalRotatedFarEast",me[me.Vertical=5]="Vertical",(be=e.VerticalAlignmentType||(e.VerticalAlignmentType={}))[be.AlignVerticalTop=0]="AlignVerticalTop",be[be.AlignVerticalCenter=1]="AlignVerticalCenter",be[be.AlignVerticalJustify=2]="AlignVerticalJustify",be[be.AlignVerticalBottom=3]="AlignVerticalBottom",(Pe=e.TextAlignmentType||(e.TextAlignmentType={}))[Pe.Left=0]="Left",Pe[Pe.Center=1]="Center",Pe[Pe.Right=2]="Right",Pe[Pe.Justify=3]="Justify",Pe[Pe.Distribute=4]="Distribute",(ve=e.OutlineLevel||(e.OutlineLevel={}))[ve.Normal=0]="Normal",ve[ve.Level1=1]="Level1",ve[ve.Level2=2]="Level2",ve[ve.Level3=3]="Level3",ve[ve.Level4=4]="Level4",ve[ve.Level5=5]="Level5",ve[ve.Level6=6]="Level6",ve[ve.Level7=7]="Level7",ve[ve.Level8=8]="Level8",ve[ve.Level9=9]="Level9",(xe=e.LineSpacingType||(e.LineSpacingType={}))[xe.Multiple=0]="Multiple",xe[xe.Exactly=1]="Exactly",xe[xe.AtLeast=2]="AtLeast",(Te=e.BaseLineAlignmentType||(e.BaseLineAlignmentType={}))[Te.Top=0]="Top",Te[Te.Center=1]="Center",Te[Te.BaseLine=2]="BaseLine",Te[Te.Bottom=3]="Bottom",Te[Te.Auto=4]="Auto",(_e=e.SuperSubScriptType||(e.SuperSubScriptType={}))[_e.None=0]="None",_e[_e.Super=1]="Super",_e[_e.Sub=2]="Sub",(Se=e.WhiteSpaceType||(e.WhiteSpaceType={}))[Se.Normal=0]="Normal",Se[Se.Nowrap=1]="Nowrap",(Ce=e.WordBreakType||(e.WordBreakType={}))[Ce.BreakAll=0]="BreakAll",Ce[Ce.BreakWord=1]="BreakWord",Ce[Ce.KeepAll=2]="KeepAll",(Be=e.OverflowWrapType||(e.OverflowWrapType={}))[Be.Normal=0]="Normal",Be[Be.BreakWord=1]="BreakWord",(Re=e.PaperOrientation||(e.PaperOrientation={}))[Re.Portrait=0]="Portrait",Re[Re.Landscape=1]="Landscape",(we=e.GridType||(e.GridType={}))[we.None=0]="None",we[we.Lines=1]="Lines",we[we.LinesAndChars=2]="LinesAndChars",we[we.SnapToChars=3]="SnapToChars",(Ie=e.SectionType||(e.SectionType={}))[Ie.Continuous=0]="Continuous",Ie[Ie.NewColumn=1]="NewColumn",Ie[Ie.NewPage=2]="NewPage",Ie[Ie.EvenPage=3]="EvenPage",Ie[Ie.OddPage=4]="OddPage",(Ee=e.BorderStyleType||(e.BorderStyleType={})).none="none",Ee.hidden="hidden",Ee.dotted="dotted",Ee.dashed="dashed",Ee.solid="solid",(Le=e.StoryType||(e.StoryType={}))[Le.MainTextStory=0]="MainTextStory",Le[Le.PrimaryHeaderStory=1]="PrimaryHeaderStory",Le[Le.EvenPagesHeaderStory=2]="EvenPagesHeaderStory",Le[Le.FirstPageHeaderStory=3]="FirstPageHeaderStory",Le[Le.PrimaryFooterStory=4]="PrimaryFooterStory",Le[Le.EvenPagesFooterStory=5]="EvenPagesFooterStory",Le[Le.FirstPageFooterStory=6]="FirstPageFooterStory",Le[Le.TextFrameStory=7]="TextFrameStory",Le[Le.ListTemplateStory=8]="ListTemplateStory",Le[Le.CodeblockStory=9]="CodeblockStory",(Oe=e.StoryID||(e.StoryID={})).MainDocId="BB08J2",Oe.ListTemplateId="LSTTMP",Oe.ListTemplateIdCompt="xxxxxx",(e.BulletListFormat||(e.BulletListFormat={})).Bullet="bullet",(e.TaskListFormat||(e.TaskListFormat={})).Task="task",(Ne=e.TaskState||(e.TaskState={})).Done="",Ne.Todo="",(ke=e.ListType||(e.ListType={}))[ke.Bullet=0]="Bullet",ke[ke.Numbered=1]="Numbered",ke[ke.Task=2]="Task",ke[ke.None=3]="None",(Me=e.NumberListFormat||(e.NumberListFormat={})).Number="number",Me.LowerLetter="lowerLetter",Me.UpperLetter="upperLetter",Me.LowerRoman="lowerRoman",Me.UpperRoman="upperRoman",Me.ChineseCountingThousand="chineseCountingThousand";var je,Ue,ze,We,Ve,Ye,qe,Xe,Je,Ze,Qe,$e,et,tt=M(M(M({},e.BulletListFormat),e.TaskListFormat),e.NumberListFormat);(je=e.BulletText||(e.BulletText={})).Circle="",je.HollowCircle="",je.Square="",je.Diamond="",je.Star="",je.Hook="",je.Arrow="",(Ue=e.BorderTypes||(e.BorderTypes={}))[Ue.None=0]="None",Ue[Ue.Top=1]="Top",Ue[Ue.Right=2]="Right",Ue[Ue.Bottom=4]="Bottom",Ue[Ue.Left=8]="Left",(ze=e.WrapType||(e.WrapType={}))[ze.None=0]="None",ze[ze.Square=1]="Square",ze[ze.Through=2]="Through",ze[ze.Tight=3]="Tight",ze[ze.TopAndBottom=4]="TopAndBottom",ze[ze.Behind=5]="Behind",ze[ze.Front=6]="Front",ze[ze.Inline=7]="Inline",(We=e.ContainerType||(e.ContainerType={}))[We.Drawing=0]="Drawing",We[We.Plugin=1]="Plugin",(Ve=e.DrawingType||(e.DrawingType={})).Default="default",Ve.Splitline="splitline",Ve.Image="image",Ve.Textframe="textframe",Ve.EmbedComment="embedcomment",(Ye=e.TextframeType||(e.TextframeType={}))[Ye.Normal=0]="Normal",Ye[Ye.Codeblock=1]="Codeblock",(qe=e.PluginType||(e.PluginType={})).Default="default",qe.File="file",qe.Audio="audio",qe.Video="video",qe.Location="location",qe.Calendar="calendar",qe.Database="database",(Xe=e.DiffType||(e.DiffType={}))[Xe.None=0]="None",Xe[Xe.Minus=1]="Minus",Xe[Xe.Plus=2]="Plus",(Je=e.StyleType||(e.StyleType={}))[Je.Paragraph=0]="Paragraph",Je[Je.Character=1]="Character",(Ze=e.BuiltinStyleType||(e.BuiltinStyleType={}))[Ze.None=0]="None",Ze[Ze.Normal=1]="Normal",Ze[Ze.Heading1=2]="Heading1",Ze[Ze.Heading2=3]="Heading2",Ze[Ze.Heading3=4]="Heading3",Ze[Ze.Heading4=5]="Heading4",Ze[Ze.Heading5=6]="Heading5",Ze[Ze.Heading6=7]="Heading6",Ze[Ze.Heading7=8]="Heading7",Ze[Ze.Heading8=9]="Heading8",Ze[Ze.Heading9=10]="Heading9",Ze[Ze.Title=11]="Title",Ze[Ze.Subtitle=12]="Subtitle",Ze[Ze.Comments=13]="Comments",(Qe=e.BuiltinStyleName||(e.BuiltinStyleName={})).None="",Qe.Normal="normal",Qe.Heading1="heading1",Qe.Heading2="heading2",Qe.Heading3="heading3",Qe.Heading4="heading4",Qe.Heading5="heading5",Qe.Heading6="heading6",Qe.Heading7="heading7",Qe.Heading8="heading8",Qe.Heading9="heading9",Qe.Title="title",Qe.Subtitle="subtitle",Qe.Comments="comments",($e=e.ShadingType||(e.ShadingType={})).ShadingNone="none",$e.ShadingColor="color",$e.ShadingTexture="image",(et=e.FieldCharType||(e.FieldCharType={})).None="none",et.Begin="begin",et.Separate="separate",et.End="end";var rt,nt,ot=function(){function t(){}return t.author="",t.fontFamily=["-apple-system",'"Helvetica Neue"',"Helvetica",'"PingFang SC"','"Microsoft YaHei"','"Source Han Sans SC"','"Noto Sans CJK SC"','"WenQuanYi Micro Hei"',"sans-serif"].join(","),t.fontSize=240,t.lineHeight=1,t.minLineHeight=375,t.Default_DocData_Version=6,t.newDefaultStyleVersion=8,t.curDocDataVersion=Number.MAX_SAFE_INTEGER,t.font={fontSize:t.fontSize,fontFamily:t.fontFamily,fontWeight:400,underline:!1,strike:!1,italic:!1,textColor:"black",textBackground:"transparent",linkColor:"#1e6fff",link:"",letterSpacing:0,superScript:!1,subScript:!1},t.paragraph={textAlignment:e.TextAlignmentType.Left,outlineLevel:e.OutlineLevel.Normal,specialIndent:0,characterUnitSpecialIndent:0,leftIndent:0,characterUnitLeftIndent:0,rightIndent:0,characterUnitRightIndent:0,mirrorIndents:!1,autoAdjustRightIndent:!0,lineSpacing:1.3,lineSpacingRule:e.LineSpacingType.Multiple,spaceBefore:0,lineUnitBefore:0,spaceBeforeAuto:!1,spaceAfter:0,lineUnitAfter:0,spaceAfterAuto:!1,disableLineHeightGrid:!0,keepWithNext:!1,keepTogether:!1,pageBreakBefore:!1,widowControl:!1,suppressLineNumbers:!1,suppressAutoHyphens:!1,farEastLineBreakControl:!0,wordBreak:e.WordBreakType.BreakAll,hangingPunctuation:!0,halfWidthPunctuationOnTopOfLine:!1,addSpaceBetweenFarEastAndAlpha:!0,addSpaceBetweenFarEastAndDigit:!0,baseLineAlignment:e.BaseLineAlignmentType.BaseLine,styleName:e.BuiltinStyleName.Normal,tableDepth:0,listId:"",listLevel:-1,listTemplateId:"",taskState:e.TaskState.Todo,borderType:e.BorderTypes.None},t.section={pageSize:{width:11906,height:16838,orientation:e.PaperOrientation.Portrait},pageMargins:{top:1500,right:1200,bottom:1500,left:1200,header:851,footer:992,gutter:0},columns:{equalWidth:!0,num:1,sep:!1,space:425,cols:[]},docGrid:{charSpace:0,linePitch:312,type:e.GridType.Lines},textDirection:e.TextDirectionType.Horizontal,sectionType:e.SectionType.NewPage,vAlign:e.VerticalAlignmentType.AlignVerticalTop,titlePg:!1,defaultHeaderRefId:"",firstHeaderRefId:"",evenHeaderRefId:"",defaultFooterRefId:"",firstFooterRefId:"",evenFooterRefId:"",pageStartAt:1},t.headerMaxHeightRatio=.3,t.footerMaxHeightRatio=.3,t.paperMarginBottom=375,t.listLevelLimit=8,t.maxSupportListLevelLimit=9,t.table={marginTop:r.pxToTwips(8),marginBottom:r.pxToTwips(8)},t.tableRow={rowHeight:r.pxToTwips(32)},t.defaultBorder={borderWidth:r.pxToTwips(1),borderStyle:e.BorderStyleType.solid,borderColor:"black"},t.tableCell={cellcolor:"transparent",borderTop:t.defaultBorder,borderRight:t.defaultBorder,borderBottom:t.defaultBorder,borderLeft:t.defaultBorder,colSpan:1,rowSpan:1,isMerged:!1,padding:{left:r.pxToTwips(4),top:r.pxToTwips(4),bottom:r.pxToTwips(3),right:r.pxToTwips(4)}},t.tableCellStyle={cellcolor:"transparent",borderTop:t.defaultBorder,borderRight:t.defaultBorder,borderBottom:t.defaultBorder,borderLeft:t.defaultBorder},t.listDefaultHanging=-1.6,t.mentionColor="#1e6fff",t.docLinkColor="#1e6fff",t.containerMargin={left:30,top:30,right:30,bottom:0},t.tabSize=8,t.nativeScreenSize={width:0,height:0},t.ellipsis="...",t.pageBoxShawdow="0 0 10px 0 rgba(0, 0, 0, 0.06), 0 0 0 1px rgba(0, 0, 0, 0.04)",t}();(rt=e.PropertyType||(e.PropertyType={})).StoryProperty="StoryProperty",rt.SectionProperty="SectionProperty",rt.ParaProperty="ParaProperty",rt.NumberingProperty="NumberingProperty",rt.TextSpan="TextSpan",rt.StoryBreakSpan="StoryBreakSpan",rt.SectBreakSpan="SectBreakSpan",rt.PageBreakSpan="PageBreakSpan",rt.ParaBreakSpan="ParaBreakSpan",rt.TableRowBreakSpan="TableRowBreakSpan",rt.TableRowStartSpan="TableRowStartSpan",rt.TableCellBreakSpan="TableCellBreakSpan",rt.TableCellStartSpan="TableCellStartSpan",rt.TableStartBreakSpan="TableStartBreakSpan",rt.TableEndBreakSpan="TableEndBreakSpan",rt.TableSpan="TableSpan",rt.FieldCharSpan="FieldCharSpan",rt.TableProperty="TableProperty",rt.TableRowProperty="TableRowProperty",rt.TableCellProperty="TableCellProperty",rt.TableRowBreakCell="TableRowBreakCell",rt.DefaultContainerProperty="DefaultContainerProperty",rt.DefaultPluginProperty="DefaultPluginProperty",rt.DefaultDrawingProperty="DefaultDrawingProperty",rt.ImageProperty="ImageProperty",rt.SplitlineProperty="SplitlineProperty",rt.TextframeProperty="TextframeProperty",rt.CodeblockProperty="CodeblockProperty",rt.EmbedCommentProperty="EmbedCommentProperty",(nt=e.SectPropKey||(e.SectPropKey={})).pageWidth="sect_pageWidth",nt.pageHeight="sect_pageHeight",nt.pageOrientation="sect_pageOrientation",nt.marginTop="sect_marginTop",nt.marginRight="sect_marginRight",nt.marginBottom="sect_marginBottom",nt.marginLeft="sect_marginLeft",nt.marginHeader="sect_marginHeader",nt.marginFooter="sect_marginFooter",nt.marginGutter="sect_marginGutter",nt.columnEqualWidth="sect_columnEqualWidth",nt.columnNum="sect_columnNum",nt.columnSep="sect_columnSep",nt.columnSpace="sect_columnSpace",nt.columns="sect_columns",nt.docGridCharSpace="sect_docGridCharSpace",nt.docGridLinePitch="sect_docGridLinePitch",nt.docGridType="sect_docGridType",nt.textDirection="sect_textDirection",nt.sectionType="sect_sectionType",nt.vAlign="sect_vAlign",nt.titlePg="sect_titlePg",nt.defaultHeaderRefId="sect_defaultHeaderRefId",nt.firstHeaderRefId="sect_firstHeaderRefId",nt.evenHeaderRefId="sect_evenHeaderRefId",nt.defaultFooterRefId="sect_defaultFooterRefId",nt.firstFooterRefId="sect_firstFooterRefId",nt.evenFooterRefId="sect_evenFooterRefId",nt.pageStartAt="page_start_at";var it,at=[e.SectPropKey.pageWidth,e.SectPropKey.pageHeight,e.SectPropKey.pageOrientation,e.SectPropKey.marginTop,e.SectPropKey.marginRight,e.SectPropKey.marginBottom,e.SectPropKey.marginLeft,e.SectPropKey.marginHeader,e.SectPropKey.marginFooter,e.SectPropKey.marginGutter,e.SectPropKey.columnEqualWidth,e.SectPropKey.columnNum,e.SectPropKey.columnSep,e.SectPropKey.columnSpace,e.SectPropKey.columns,e.SectPropKey.docGridCharSpace,e.SectPropKey.docGridLinePitch,e.SectPropKey.docGridType,e.SectPropKey.textDirection,e.SectPropKey.sectionType,e.SectPropKey.vAlign,e.SectPropKey.titlePg,e.SectPropKey.defaultHeaderRefId,e.SectPropKey.firstHeaderRefId,e.SectPropKey.evenHeaderRefId,e.SectPropKey.defaultFooterRefId,e.SectPropKey.firstFooterRefId,e.SectPropKey.evenFooterRefId,e.SectPropKey.pageStartAt],st=[],pt=[],lt=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return k(r,t),r.prototype.propKeyList=function(){return{propList:at,notAllowedCopyProps:st,notCompareProps:pt}},Object.defineProperty(r.prototype,"propertyType",{get:function(){return e.PropertyType.SectionProperty},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"pageWidth",{get:function(){return this._propBag.get(e.SectPropKey.pageWidth,ot.section.pageSize.width)},set:function(t){this._propBag.set(e.SectPropKey.pageWidth,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"pageHeight",{get:function(){return this._propBag.get(e.SectPropKey.pageHeight,ot.section.pageSize.height)},set:function(t){this._propBag.set(e.SectPropKey.pageHeight,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"pageOrientation",{get:function(){return this._propBag.get(e.SectPropKey.pageOrientation,ot.section.pageSize.orientation)},set:function(t){this._propBag.set(e.SectPropKey.pageOrientation,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"pageSize",{get:function(){return{width:this.pageWidth,height:this.pageHeight,orientation:this.pageOrientation}},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"marginTop",{get:function(){return this._propBag.get(e.SectPropKey.marginTop,ot.section.pageMargins.top)},set:function(t){this._propBag.set(e.SectPropKey.marginTop,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"marginRight",{get:function(){return this._propBag.get(e.SectPropKey.marginRight,ot.section.pageMargins.right)},set:function(t){this._propBag.set(e.SectPropKey.marginRight,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"marginBottom",{get:function(){return this._propBag.get(e.SectPropKey.marginBottom,ot.section.pageMargins.bottom)},set:function(t){this._propBag.set(e.SectPropKey.marginBottom,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"marginLeft",{get:function(){return this._propBag.get(e.SectPropKey.marginLeft,ot.section.pageMargins.left)},set:function(t){this._propBag.set(e.SectPropKey.marginLeft,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"marginHeader",{get:function(){return this._propBag.get(e.SectPropKey.marginHeader,ot.section.pageMargins.header)},set:function(t){this._propBag.set(e.SectPropKey.marginHeader,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"marginFooter",{get:function(){return this._propBag.get(e.SectPropKey.marginFooter,ot.section.pageMargins.footer)},set:function(t){this._propBag.set(e.SectPropKey.marginFooter,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"marginGutter",{get:function(){return this._propBag.get(e.SectPropKey.marginGutter,ot.section.pageMargins.gutter)},set:function(t){this._propBag.set(e.SectPropKey.marginGutter,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"pageMargins",{get:function(){return{top:this.marginTop,right:this.marginRight,bottom:this.marginBottom,left:this.marginLeft,header:this.marginHeader,footer:this.marginFooter,gutter:this.marginGutter}},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"columnEqualWidth",{get:function(){return this._propBag.get(e.SectPropKey.columnEqualWidth,ot.section.columns.equalWidth)},set:function(t){this._propBag.set(e.SectPropKey.columnEqualWidth,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"columnNum",{get:function(){return this._propBag.get(e.SectPropKey.columnNum,ot.section.columns.num)},set:function(t){this._propBag.set(e.SectPropKey.columnNum,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"columnSep",{get:function(){return this._propBag.get(e.SectPropKey.columnSep,ot.section.columns.sep)},set:function(t){this._propBag.set(e.SectPropKey.columnSep,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"columnSpace",{get:function(){return this._propBag.get(e.SectPropKey.columnSpace,ot.section.columns.space)},set:function(t){this._propBag.set(e.SectPropKey.columnSpace,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"columns",{get:function(){if(this._propBag.has(e.SectPropKey.columns)){var t=this._propBag.get(e.SectPropKey.columns,"");try{return JSON.parse(t)}catch(e){return ot.section.columns.cols}}return ot.section.columns.cols},set:function(t){this._propBag.set(e.SectPropKey.columns,JSON.stringify(t))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"pageColumns",{get:function(){return{equalWidth:this.columnEqualWidth,num:this.columnNum,sep:this.columnSep,space:this.columnSpace,cols:this.columns}},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"docGridCharSpace",{get:function(){return this._propBag.get(e.SectPropKey.docGridCharSpace,ot.section.docGrid.charSpace)},set:function(t){this._propBag.set(e.SectPropKey.docGridCharSpace,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"docGridLinePitch",{get:function(){return this._propBag.get(e.SectPropKey.docGridLinePitch,ot.section.docGrid.linePitch)},set:function(t){this._propBag.set(e.SectPropKey.docGridLinePitch,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"docGridType",{get:function(){return this._propBag.get(e.SectPropKey.docGridType,ot.section.docGrid.type)},set:function(t){this._propBag.set(e.SectPropKey.docGridType,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"docGrid",{get:function(){return{charSpace:this.docGridCharSpace,linePitch:this.docGridLinePitch,type:this.docGridType}},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"textDirection",{get:function(){return this._propBag.get(e.SectPropKey.textDirection,ot.section.textDirection)},set:function(t){this._propBag.set(e.SectPropKey.textDirection,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"sectionType",{get:function(){return this._propBag.get(e.SectPropKey.sectionType,ot.section.sectionType)},set:function(t){this._propBag.set(e.SectPropKey.sectionType,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"vAlign",{get:function(){return this._propBag.get(e.SectPropKey.vAlign,ot.section.vAlign)},set:function(t){this._propBag.set(e.SectPropKey.vAlign,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"titlePg",{get:function(){return this._propBag.get(e.SectPropKey.titlePg,ot.section.titlePg)},set:function(t){this._propBag.set(e.SectPropKey.titlePg,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"defaultHeaderRefId",{get:function(){return this._propBag.get(e.SectPropKey.defaultHeaderRefId,ot.section.defaultHeaderRefId)},set:function(t){this._propBag.set(e.SectPropKey.defaultHeaderRefId,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"firstHeaderRefId",{get:function(){return this._propBag.get(e.SectPropKey.firstHeaderRefId,ot.section.firstHeaderRefId)},set:function(t){this._propBag.set(e.SectPropKey.firstHeaderRefId,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"evenHeaderRefId",{get:function(){return this._propBag.get(e.SectPropKey.evenHeaderRefId,ot.section.evenHeaderRefId)},set:function(t){this._propBag.set(e.SectPropKey.evenHeaderRefId,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"defaultFooterRefId",{get:function(){return this._propBag.get(e.SectPropKey.defaultFooterRefId,ot.section.defaultFooterRefId)},set:function(t){this._propBag.set(e.SectPropKey.defaultFooterRefId,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"firstFooterRefId",{get:function(){return this._propBag.get(e.SectPropKey.firstFooterRefId,ot.section.firstFooterRefId)},set:function(t){this._propBag.set(e.SectPropKey.firstFooterRefId,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"evenFooterRefId",{get:function(){return this._propBag.get(e.SectPropKey.evenFooterRefId,ot.section.evenFooterRefId)},set:function(t){this._propBag.set(e.SectPropKey.evenFooterRefId,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"pageStartAt",{get:function(){return this._propBag.get(e.SectPropKey.pageStartAt,ot.section.pageStartAt)},set:function(t){this._propBag.set(e.SectPropKey.pageStartAt,t)},enumerable:!0,configurable:!0}),r}(Ke);(it=e.ParaPropKey||(e.ParaPropKey={})).textAlignment="para_textAlignment",it.outlineLevel="para_outlineLevel",it.specialIndent="para_specialIndent",it.characterUnitSpecialIndent="para_characterUnitSpecialIndent",it.leftIndent="para_leftIndent",it.characterUnitLeftIndent="para_characterUnitLeftIndent",it.rightIndent="para_rightIndent",it.characterUnitRightIndent="para_characterUnitRightIndent",it.mirrorIndents="para_mirrorIndents",it.autoAdjustRightIndent="para_autoAdjustRightIndent",it.lineSpacing="para_lineSpacing",it.lineSpacingRule="para_lineSpacingRule",it.spaceBefore="para_spaceBefore",it.lineUnitBefore="para_lineUnitBefore",it.spaceBeforeAuto="para_spaceBeforeAuto",it.spaceAfter="para_spaceAfter",it.lineUnitAfter="para_lineUnitAfter",it.spaceAfterAuto="para_spaceAfterAuto",it.disableLineHeightGrid="para_disableLineHeightGrid",it.keepWithNext="para_keepWithNext",it.keepTogether="para_keepTogether",it.pageBreakBefore="para_pageBreakBefore",it.widowControl="para_widowControl",it.suppressLineNumbers="para_suppressLineNumbers",it.suppressAutoHyphens="para_suppressAutoHyphens",it.farEastLineBreakControl="para_farEastLineBreakControl",it.wordBreak="para_wordBreak",it.hangingPunctuation="para_hangingPunctuation",it.halfWidthPunctuationOnTopOfLine="para_halfWidthPunctuationOnTopOfLine",it.addSpaceBetweenFarEastAndAlpha="para_addSpaceBetweenFarEastAndAlpha",it.addSpaceBetweenFarEastAndDigit="para_addSpaceBetweenFarEastAndDigit",it.baseLineAlignment="para_baseLineAlignment",it.styleName="para_styleName",it.tableDepth="para_tableDepth",it.listId="para_listId",it.listTemplateId="para_listTemplateId",it.listLevel="para_listLevel",it.taskState="para_task",it.borderType="para_border",it.paraId="para_id";var ct,ut=[e.ParaPropKey.textAlignment,e.ParaPropKey.outlineLevel,e.ParaPropKey.specialIndent,e.ParaPropKey.characterUnitSpecialIndent,e.ParaPropKey.leftIndent,e.ParaPropKey.characterUnitLeftIndent,e.ParaPropKey.rightIndent,e.ParaPropKey.characterUnitRightIndent,e.ParaPropKey.mirrorIndents,e.ParaPropKey.autoAdjustRightIndent,e.ParaPropKey.lineSpacing,e.ParaPropKey.lineSpacingRule,e.ParaPropKey.spaceBefore,e.ParaPropKey.lineUnitBefore,e.ParaPropKey.spaceBeforeAuto,e.ParaPropKey.spaceAfter,e.ParaPropKey.lineUnitAfter,e.ParaPropKey.spaceAfterAuto,e.ParaPropKey.disableLineHeightGrid,e.ParaPropKey.keepWithNext,e.ParaPropKey.keepTogether,e.ParaPropKey.pageBreakBefore,e.ParaPropKey.widowControl,e.ParaPropKey.suppressLineNumbers,e.ParaPropKey.suppressAutoHyphens,e.ParaPropKey.farEastLineBreakControl,e.ParaPropKey.wordBreak,e.ParaPropKey.hangingPunctuation,e.ParaPropKey.halfWidthPunctuationOnTopOfLine,e.ParaPropKey.addSpaceBetweenFarEastAndAlpha,e.ParaPropKey.addSpaceBetweenFarEastAndDigit,e.ParaPropKey.baseLineAlignment,e.ParaPropKey.styleName,e.ParaPropKey.tableDepth,e.ParaPropKey.listId,e.ParaPropKey.listTemplateId,e.ParaPropKey.listLevel,e.ParaPropKey.taskState,e.ParaPropKey.borderType,e.ParaPropKey.paraId],ht=[e.ParaPropKey.paraId],ft=[e.ParaPropKey.paraId],dt=[e.ParaPropKey.textAlignment,e.ParaPropKey.outlineLevel,e.ParaPropKey.specialIndent,e.ParaPropKey.characterUnitSpecialIndent,e.ParaPropKey.leftIndent,e.ParaPropKey.characterUnitLeftIndent,e.ParaPropKey.rightIndent,e.ParaPropKey.characterUnitRightIndent,e.ParaPropKey.mirrorIndents,e.ParaPropKey.autoAdjustRightIndent,e.ParaPropKey.lineSpacing,e.ParaPropKey.lineSpacingRule,e.ParaPropKey.spaceBefore,e.ParaPropKey.lineUnitBefore,e.ParaPropKey.spaceBeforeAuto,e.ParaPropKey.spaceAfter,e.ParaPropKey.lineUnitAfter,e.ParaPropKey.spaceAfterAuto,e.ParaPropKey.disableLineHeightGrid,e.ParaPropKey.keepWithNext,e.ParaPropKey.keepTogether,e.ParaPropKey.pageBreakBefore,e.ParaPropKey.widowControl,e.ParaPropKey.suppressLineNumbers,e.ParaPropKey.suppressAutoHyphens,e.ParaPropKey.farEastLineBreakControl,e.ParaPropKey.wordBreak,e.ParaPropKey.hangingPunctuation,e.ParaPropKey.halfWidthPunctuationOnTopOfLine,e.ParaPropKey.addSpaceBetweenFarEastAndAlpha,e.ParaPropKey.addSpaceBetweenFarEastAndDigit,e.ParaPropKey.baseLineAlignment,e.ParaPropKey.styleName,e.ParaPropKey.listId,e.ParaPropKey.listTemplateId,e.ParaPropKey.listLevel,e.ParaPropKey.borderType],gt=function(t){function n(n){var o=t.call(this,n)||this;return n instanceof le&&n.has(e.ParaPropKey.paraId)||(o.paraId=r.StringUtil.generateRandomId()),o}return k(n,t),n.prototype.propKeyList=function(){return{propList:ut,notAllowedCopyProps:ht,notCompareProps:ft}},Object.defineProperty(n.prototype,"propertyType",{get:function(){return e.PropertyType.ParaProperty},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"textAlignment",{get:function(){return this._propBag.get(e.ParaPropKey.textAlignment,ot.paragraph.textAlignment)},set:function(t){this._propBag.set(e.ParaPropKey.textAlignment,t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"outlineLevel",{get:function(){return this._propBag.get(e.ParaPropKey.outlineLevel,ot.paragraph.outlineLevel)},set:function(t){this._propBag.set(e.ParaPropKey.outlineLevel,t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"specialIndent",{get:function(){return this._propBag.get(e.ParaPropKey.specialIndent,ot.paragraph.specialIndent)},set:function(t){this._propBag.set(e.ParaPropKey.specialIndent,t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"characterUnitSpecialIndent",{get:function(){return this._propBag.get(e.ParaPropKey.characterUnitSpecialIndent,ot.paragraph.characterUnitSpecialIndent)},set:function(t){this._propBag.set(e.ParaPropKey.characterUnitSpecialIndent,t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"specialIndentConfig",{get:function(){return{valueIndent:this.specialIndent,characterUnitIndent:this.characterUnitSpecialIndent}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"leftIndent",{get:function(){return this._propBag.get(e.ParaPropKey.leftIndent,ot.paragraph.leftIndent)},set:function(t){this._propBag.set(e.ParaPropKey.leftIndent,t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"characterUnitLeftIndent",{get:function(){return this._propBag.get(e.ParaPropKey.characterUnitLeftIndent,ot.paragraph.characterUnitLeftIndent)},set:function(t){this._propBag.set(e.ParaPropKey.characterUnitLeftIndent,t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"leftIndentConfig",{get:function(){return{valueIndent:this.leftIndent,characterUnitIndent:this.characterUnitLeftIndent}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"rightIndent",{get:function(){return this._propBag.get(e.ParaPropKey.rightIndent,ot.paragraph.rightIndent)},set:function(t){this._propBag.set(e.ParaPropKey.rightIndent,t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"characterUnitRightIndent",{get:function(){return this._propBag.get(e.ParaPropKey.characterUnitRightIndent,ot.paragraph.characterUnitRightIndent)},set:function(t){this._propBag.set(e.ParaPropKey.characterUnitRightIndent,t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"rightIndentConfig",{get:function(){return{valueIndent:this.rightIndent,characterUnitIndent:this.characterUnitRightIndent}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"mirrorIndents",{get:function(){return this._propBag.get(e.ParaPropKey.mirrorIndents,ot.paragraph.mirrorIndents)},set:function(t){this._propBag.set(e.ParaPropKey.mirrorIndents,t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"autoAdjustRightIndent",{get:function(){return this._propBag.get(e.ParaPropKey.autoAdjustRightIndent,ot.paragraph.autoAdjustRightIndent)},set:function(t){this._propBag.set(e.ParaPropKey.autoAdjustRightIndent,t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"lineSpacing",{get:function(){return this._propBag.get(e.ParaPropKey.lineSpacing,ot.paragraph.lineSpacing)},set:function(t){this._propBag.set(e.ParaPropKey.lineSpacing,t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"lineSpacingRule",{get:function(){return this._propBag.get(e.ParaPropKey.lineSpacingRule,ot.paragraph.lineSpacingRule)},set:function(t){this._propBag.set(e.ParaPropKey.lineSpacingRule,t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"lineSpacingConfig",{get:function(){return{rule:this.lineSpacingRule,value:this.lineSpacing}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"spaceBefore",{get:function(){return this._propBag.get(e.ParaPropKey.spaceBefore,ot.paragraph.spaceBefore)},set:function(t){this._propBag.set(e.ParaPropKey.spaceBefore,t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"lineUnitBefore",{get:function(){return this._propBag.get(e.ParaPropKey.lineUnitBefore,ot.paragraph.lineUnitBefore)},set:function(t){this._propBag.set(e.ParaPropKey.lineUnitBefore,t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"spaceBeforeAuto",{get:function(){return this._propBag.get(e.ParaPropKey.spaceBeforeAuto,ot.paragraph.spaceBeforeAuto)},set:function(t){this._propBag.set(e.ParaPropKey.spaceBeforeAuto,t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"spaceBeforeConfig",{get:function(){return{space:this.spaceBefore,lineUnit:this.lineUnitBefore,spaceAuto:this.spaceBeforeAuto}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"spaceAfter",{get:function(){return this._propBag.get(e.ParaPropKey.spaceAfter,ot.paragraph.spaceAfter)},set:function(t){this._propBag.set(e.ParaPropKey.spaceAfter,t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"lineUnitAfter",{get:function(){return this._propBag.get(e.ParaPropKey.lineUnitAfter,ot.paragraph.lineUnitAfter)},set:function(t){this._propBag.set(e.ParaPropKey.lineUnitAfter,t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"spaceAfterAuto",{get:function(){return this._propBag.get(e.ParaPropKey.spaceAfterAuto,ot.paragraph.spaceAfterAuto)},set:function(t){this._propBag.set(e.ParaPropKey.spaceAfterAuto,t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"spaceAfterConfig",{get:function(){return{space:this.spaceAfter,lineUnit:this.lineUnitAfter,spaceAuto:this.spaceAfterAuto}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"disableLineHeightGrid",{get:function(){return this._propBag.get(e.ParaPropKey.disableLineHeightGrid,ot.paragraph.disableLineHeightGrid)},set:function(t){this._propBag.set(e.ParaPropKey.disableLineHeightGrid,t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"keepWithNext",{get:function(){return this._propBag.get(e.ParaPropKey.keepWithNext,ot.paragraph.keepWithNext)},set:function(t){this._propBag.set(e.ParaPropKey.keepWithNext,t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"keepTogether",{get:function(){return this._propBag.get(e.ParaPropKey.keepTogether,ot.paragraph.keepTogether)},set:function(t){this._propBag.set(e.ParaPropKey.keepTogether,t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"pageBreakBefore",{get:function(){return this._propBag.get(e.ParaPropKey.pageBreakBefore,ot.paragraph.pageBreakBefore)},set:function(t){this._propBag.set(e.ParaPropKey.pageBreakBefore,t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"widowControl",{get:function(){return this._propBag.get(e.ParaPropKey.widowControl,ot.paragraph.widowControl)},set:function(t){this._propBag.set(e.ParaPropKey.widowControl,t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"suppressLineNumbers",{get:function(){return this._propBag.get(e.ParaPropKey.suppressLineNumbers,ot.paragraph.suppressLineNumbers)},set:function(t){this._propBag.set(e.ParaPropKey.suppressLineNumbers,t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"suppressAutoHyphens",{get:function(){return this._propBag.get(e.ParaPropKey.suppressAutoHyphens,ot.paragraph.suppressAutoHyphens)},set:function(t){this._propBag.set(e.ParaPropKey.suppressAutoHyphens,t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"farEastLineBreakControl",{get:function(){return this._propBag.get(e.ParaPropKey.farEastLineBreakControl,ot.paragraph.farEastLineBreakControl)},set:function(t){this._propBag.set(e.ParaPropKey.farEastLineBreakControl,t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"wordBreak",{get:function(){return this._propBag.get(e.ParaPropKey.wordBreak,ot.paragraph.wordBreak)},set:function(t){this._propBag.set(e.ParaPropKey.wordBreak,t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"hangingPunctuation",{get:function(){return this._propBag.get(e.ParaPropKey.hangingPunctuation,ot.paragraph.hangingPunctuation)},set:function(t){this._propBag.set(e.ParaPropKey.hangingPunctuation,t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"halfWidthPunctuationOnTopOfLine",{get:function(){return this._propBag.get(e.ParaPropKey.halfWidthPunctuationOnTopOfLine,ot.paragraph.halfWidthPunctuationOnTopOfLine)},set:function(t){this._propBag.set(e.ParaPropKey.halfWidthPunctuationOnTopOfLine,t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"addSpaceBetweenFarEastAndAlpha",{get:function(){return this._propBag.get(e.ParaPropKey.addSpaceBetweenFarEastAndAlpha,ot.paragraph.addSpaceBetweenFarEastAndAlpha)},set:function(t){this._propBag.set(e.ParaPropKey.addSpaceBetweenFarEastAndAlpha,t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"addSpaceBetweenFarEastAndDigit",{get:function(){return this._propBag.get(e.ParaPropKey.addSpaceBetweenFarEastAndDigit,ot.paragraph.addSpaceBetweenFarEastAndDigit)},set:function(t){this._propBag.set(e.ParaPropKey.addSpaceBetweenFarEastAndDigit,t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"baseLineAlignment",{get:function(){return this._propBag.get(e.ParaPropKey.baseLineAlignment,ot.paragraph.baseLineAlignment)},set:function(t){this._propBag.set(e.ParaPropKey.baseLineAlignment,t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"styleName",{get:function(){return this._propBag.get(e.ParaPropKey.styleName,ot.paragraph.styleName)},set:function(t){this._propBag.set(e.ParaPropKey.styleName,t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"tableDepth",{get:function(){return this._propBag.get(e.ParaPropKey.tableDepth,ot.paragraph.tableDepth)},set:function(t){this._propBag.set(e.ParaPropKey.tableDepth,t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"listId",{get:function(){return this._propBag.get(e.ParaPropKey.listId,ot.paragraph.listId)},set:function(t){this._propBag.set(e.ParaPropKey.listId,t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"listTemplateId",{get:function(){return this._propBag.get(e.ParaPropKey.listTemplateId,ot.paragraph.listTemplateId)},set:function(t){this._propBag.set(e.ParaPropKey.listTemplateId,t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"listLevel",{get:function(){return this._propBag.get(e.ParaPropKey.listLevel,ot.paragraph.listLevel)},set:function(t){this._propBag.set(e.ParaPropKey.listLevel,t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"taskState",{get:function(){return this._propBag.get(e.ParaPropKey.taskState,ot.paragraph.taskState)},set:function(t){this._propBag.set(e.ParaPropKey.taskState,t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"borderType",{get:function(){return this._propBag.get(e.ParaPropKey.borderType,ot.paragraph.borderType)},set:function(t){this._propBag.set(e.ParaPropKey.borderType,t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"paraId",{get:function(){return this._propBag.get(e.ParaPropKey.paraId,"")},set:function(t){this._propBag.set(e.ParaPropKey.paraId,t)},enumerable:!0,configurable:!0}),n.prototype.genNewParaId=function(){return this.paraId=r.StringUtil.generateRandomId(),this},n}(Ke);(ct=e.CommentSpanPropKey||(e.CommentSpanPropKey={})).comments="span_comments",ct.commentsConnection=",",ct.quotes="span_quotes",ct.quotesConnection=",";var yt,mt=[e.CommentSpanPropKey.comments],bt=[],Pt=[],vt=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return k(r,t),r.prototype.propKeyList=function(){return{propList:mt,notAllowedCopyProps:bt,notCompareProps:Pt}},Object.defineProperty(r.prototype,"comments",{get:function(){var t=this._propBag.get(e.CommentSpanPropKey.comments,"");return t.length>0?t.split(e.CommentSpanPropKey.commentsConnection):[]},set:function(t){var r="";t.length>0&&(r=t.join(e.CommentSpanPropKey.commentsConnection)),this._propBag.set(e.CommentSpanPropKey.comments,r)},enumerable:!0,configurable:!0}),r.prototype.addComment=function(e){if(e.length<=0)return!1;var t=this.comments;return t.indexOf(e)<0&&(t.push(e),this._setComments(t),!0)},r.prototype.deleteComment=function(e){if(e.length<=0)return!1;var t=this.comments,r=t.indexOf(e);return r>=0&&(t.splice(r,1),this._setComments(t),!0)},r.prototype._setComments=function(e){this.comments=e},Object.defineProperty(r.prototype,"quotes",{get:function(){var t=this._propBag.get(e.CommentSpanPropKey.quotes,"");return t.length>0?t.split(e.CommentSpanPropKey.quotesConnection):[]},set:function(t){var r="";t.length>0&&(r=t.join(e.CommentSpanPropKey.quotesConnection)),this._propBag.set(e.CommentSpanPropKey.quotes,r)},enumerable:!0,configurable:!0}),r.prototype.addQuote=function(e){if(e.length<=0)return!1;var t=this.quotes;return t.indexOf(e)<0&&(t.push(e),this._setQuotes(t),!0)},r.prototype.deleteQuote=function(e){if(e.length<=0)return!1;var t=this.quotes,r=t.indexOf(e);return r>=0&&(t.splice(r,1),this._setQuotes(t),!0)},r.prototype._setQuotes=function(e){this.quotes=e},r}(Ke);(yt=e.SpanPropKey||(e.SpanPropKey={})).author="span_author",yt.fontWeight="span_fontWeight",yt.fontSize="span_fontSize",yt.fontFamily="span_fontFamily",yt.underline="span_underline",yt.strike="span_strike",yt.italic="span_italic",yt.textColor="span_textColor",yt.textBackground="span_textBackground",yt.link="span_link",yt.letterSpacing="span_letterSpacing",yt.superScript="span_superScript",yt.subScript="span_subScript",yt.styleName="span_styleName",yt.delFirst="del_first",yt.diff="span_diff",yt.pinyin="span_pinyin";var xt=[e.SpanPropKey.author,e.SpanPropKey.fontWeight,e.SpanPropKey.fontSize,e.SpanPropKey.fontFamily,e.SpanPropKey.underline,e.SpanPropKey.strike,e.SpanPropKey.italic,e.SpanPropKey.textColor,e.SpanPropKey.textBackground,e.SpanPropKey.link,e.SpanPropKey.letterSpacing,e.SpanPropKey.superScript,e.SpanPropKey.subScript,e.SpanPropKey.styleName,e.SpanPropKey.delFirst,e.SpanPropKey.diff,e.SpanPropKey.pinyin],Tt=[],_t=[],St=[e.SpanPropKey.fontWeight,e.SpanPropKey.fontSize,e.SpanPropKey.fontFamily,e.SpanPropKey.underline,e.SpanPropKey.strike,e.SpanPropKey.italic,e.SpanPropKey.textColor,e.SpanPropKey.textBackground,e.SpanPropKey.letterSpacing,e.SpanPropKey.superScript,e.SpanPropKey.subScript,e.SpanPropKey.styleName],Ct=[e.SpanPropKey.fontWeight,e.SpanPropKey.fontSize,e.SpanPropKey.underline,e.SpanPropKey.strike,e.SpanPropKey.italic,e.SpanPropKey.textBackground,e.SpanPropKey.letterSpacing,e.SpanPropKey.superScript,e.SpanPropKey.subScript,e.SpanPropKey.styleName];function Bt(t){var r=!1;switch(t){case e.PropertyType.StoryBreakSpan:case e.PropertyType.SectBreakSpan:case e.PropertyType.PageBreakSpan:case e.PropertyType.ParaBreakSpan:case e.PropertyType.TableRowBreakSpan:case e.PropertyType.TableCellBreakSpan:case e.PropertyType.TableStartBreakSpan:case e.PropertyType.TableEndBreakSpan:case e.PropertyType.TableCellStartSpan:case e.PropertyType.TableRowStartSpan:case e.PropertyType.DefaultContainerProperty:case e.PropertyType.DefaultPluginProperty:case e.PropertyType.DefaultDrawingProperty:case e.PropertyType.ImageProperty:case e.PropertyType.SplitlineProperty:case e.PropertyType.TextframeProperty:case e.PropertyType.CodeblockProperty:case e.PropertyType.EmbedCommentProperty:r=!0}return r}var Rt=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return k(r,t),Object.defineProperty(r.prototype,"propertyType",{get:function(){throw new Error("Method not implemented.")},enumerable:!0,configurable:!0}),r.prototype.propKeyList=function(){return{propList:xt,notAllowedCopyProps:Tt,notCompareProps:_t}},Object.defineProperty(r.prototype,"isStoryPlaceholder",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"storyId",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isSpecialChar",{get:function(){return Bt(this.propertyType)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"author",{get:function(){return this._propBag.get(e.SpanPropKey.author,"")},set:function(t){this._propBag.set(e.SpanPropKey.author,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"fontWeight",{get:function(){return this._propBag.get(e.SpanPropKey.fontWeight,ot.font.fontWeight)},set:function(t){this._propBag.set(e.SpanPropKey.fontWeight,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"fontSize",{get:function(){var t=this._propBag.get(e.SpanPropKey.fontSize,ot.font.fontSize);return Number.isNaN(t)?ot.font.fontSize:t},set:function(t){this._propBag.set(e.SpanPropKey.fontSize,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"fontFamily",{get:function(){return this._propBag.get(e.SpanPropKey.fontFamily,ot.font.fontFamily)},set:function(t){this._propBag.set(e.SpanPropKey.fontFamily,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"underline",{get:function(){return this._propBag.get(e.SpanPropKey.underline,ot.font.underline)},set:function(t){this._propBag.set(e.SpanPropKey.underline,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"strike",{get:function(){return this._propBag.get(e.SpanPropKey.strike,ot.font.strike)},set:function(t){this._propBag.set(e.SpanPropKey.strike,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"italic",{get:function(){return this._propBag.get(e.SpanPropKey.italic,ot.font.italic)},set:function(t){this._propBag.set(e.SpanPropKey.italic,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"textColor",{get:function(){var t=this._propBag.get(e.SpanPropKey.textColor,ot.font.textColor);return t.length<=0&&(t=ot.font.textColor),t},set:function(t){this._propBag.set(e.SpanPropKey.textColor,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"textBackground",{get:function(){var t=this._propBag.get(e.SpanPropKey.textBackground,ot.font.textBackground);return t.length<=0&&(t=ot.font.textBackground),t},set:function(t){this._propBag.set(e.SpanPropKey.textBackground,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"link",{get:function(){return this._propBag.get(e.SpanPropKey.link,ot.font.link)},set:function(t){this._propBag.set(e.SpanPropKey.link,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"letterSpacing",{get:function(){return this._propBag.get(e.SpanPropKey.letterSpacing,ot.font.letterSpacing)},set:function(t){this._propBag.set(e.SpanPropKey.letterSpacing,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"superScript",{get:function(){return this._propBag.get(e.SpanPropKey.superScript,ot.font.superScript)},set:function(t){this._propBag.set(e.SpanPropKey.superScript,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"subScript",{get:function(){return this._propBag.get(e.SpanPropKey.subScript,ot.font.subScript)},set:function(t){this._propBag.set(e.SpanPropKey.subScript,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"styleName",{get:function(){return this._propBag.get(e.SpanPropKey.styleName,"")},set:function(t){this._propBag.set(e.SpanPropKey.styleName,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"deleteFirst",{get:function(){return this._propBag.get(e.SpanPropKey.delFirst,!1)},set:function(t){this._propBag.set(e.SpanPropKey.delFirst,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"diff",{get:function(){var t=this._propBag.get(e.SpanPropKey.diff,e.DiffType.None);return t!==e.DiffType.None?t:void 0},set:function(t){this._propBag.set(e.SpanPropKey.diff,t||e.DiffType.None)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"pinyin",{get:function(){return this._propBag.get(e.SpanPropKey.pinyin,!1)},set:function(t){this._propBag.set(e.SpanPropKey.pinyin,t)},enumerable:!0,configurable:!0}),r}(vt),wt=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return k(r,t),Object.defineProperty(r.prototype,"propertyType",{get:function(){return e.PropertyType.TextSpan},enumerable:!0,configurable:!0}),r}(Rt),It=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return k(t,e),t}(wt),Et=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return k(r,t),Object.defineProperty(r.prototype,"propertyType",{get:function(){return e.PropertyType.StoryBreakSpan},enumerable:!0,configurable:!0}),r}(It),Lt=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return k(r,t),Object.defineProperty(r.prototype,"propertyType",{get:function(){return e.PropertyType.SectBreakSpan},enumerable:!0,configurable:!0}),r}(It),Ot=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return k(r,t),Object.defineProperty(r.prototype,"propertyType",{get:function(){return e.PropertyType.PageBreakSpan},enumerable:!0,configurable:!0}),r}(It),Nt=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return k(r,t),Object.defineProperty(r.prototype,"propertyType",{get:function(){return e.PropertyType.ParaBreakSpan},enumerable:!0,configurable:!0}),r}(It),kt=function(t){function r(e){var r=t.call(this,e)||this;return r.deleteFirst=!0,r}return k(r,t),Object.defineProperty(r.prototype,"propertyType",{get:function(){return e.PropertyType.TableRowBreakSpan},enumerable:!0,configurable:!0}),r}(Nt),Mt=function(t){function r(e){var r=t.call(this,e)||this;return r.deleteFirst=!0,r}return k(r,t),Object.defineProperty(r.prototype,"propertyType",{get:function(){return e.PropertyType.TableRowStartSpan},enumerable:!0,configurable:!0}),r}(Nt),Dt=function(t){function r(e){var r=t.call(this,e)||this;return r.deleteFirst=!0,r}return k(r,t),Object.defineProperty(r.prototype,"propertyType",{get:function(){return e.PropertyType.TableCellBreakSpan},enumerable:!0,configurable:!0}),r}(Nt),Ft=function(t){function r(e){var r=t.call(this,e)||this;return r.deleteFirst=!0,r}return k(r,t),Object.defineProperty(r.prototype,"propertyType",{get:function(){return e.PropertyType.TableCellStartSpan},enumerable:!0,configurable:!0}),r}(Nt),At=function(t){function r(e){var r=t.call(this,e)||this;return r.deleteFirst=!0,r}return k(r,t),Object.defineProperty(r.prototype,"propertyType",{get:function(){return e.PropertyType.TableStartBreakSpan},enumerable:!0,configurable:!0}),r}(Nt),Kt=function(t){function r(e){var r=t.call(this,e)||this;return r.deleteFirst=!0,r}return k(r,t),Object.defineProperty(r.prototype,"propertyType",{get:function(){return e.PropertyType.TableEndBreakSpan},enumerable:!0,configurable:!0}),r}(Nt);(e.FieldCharSpanPropKey||(e.FieldCharSpanPropKey={})).fieldCharType="fieldCharType";var Gt,Ht=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return k(r,t),r.prototype.propKeyList=function(){return{propList:[e.FieldCharSpanPropKey.fieldCharType],notAllowedCopyProps:[],notCompareProps:[]}},Object.defineProperty(r.prototype,"propertyType",{get:function(){return e.PropertyType.FieldCharSpan},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"fieldCharType",{get:function(){return this._propBag.get(e.FieldCharSpanPropKey.fieldCharType,e.FieldCharType.None)},set:function(t){this._propBag.set(e.FieldCharSpanPropKey.fieldCharType,t)},enumerable:!0,configurable:!0}),r}(It);(Gt=e.StoryPropKey||(e.StoryPropKey={})).storyType="story_storyType",Gt.storyId="story_storyId",Gt.isStoryEnd="story_isStoryEnd",Gt.shadingType="global_shadingType",Gt.shadingValue="global_shadingValue";var jt,Ut=[e.StoryPropKey.storyType,e.StoryPropKey.storyId,e.StoryPropKey.isStoryEnd,e.StoryPropKey.shadingType,e.StoryPropKey.shadingValue],zt=[e.StoryPropKey.storyId],Wt=[],Vt=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return k(r,t),r.prototype.propKeyList=function(){return{propList:Ut,notAllowedCopyProps:zt,notCompareProps:Wt}},Object.defineProperty(r.prototype,"propertyType",{get:function(){return e.PropertyType.StoryProperty},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"storyType",{get:function(){return this._propBag.get(e.StoryPropKey.storyType,e.StoryType.MainTextStory)},set:function(t){this._propBag.set(e.StoryPropKey.storyType,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"storyId",{get:function(){return this._propBag.get(e.StoryPropKey.storyId,e.StoryID.MainDocId)},set:function(t){this._propBag.set(e.StoryPropKey.storyId,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isStoryEnd",{get:function(){return this._propBag.get(e.StoryPropKey.isStoryEnd,!1)},set:function(t){this._propBag.set(e.StoryPropKey.isStoryEnd,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"shadingType",{get:function(){return this._propBag.get(e.StoryPropKey.shadingType,e.ShadingType.ShadingNone)},set:function(t){this._propBag.set(e.StoryPropKey.shadingType,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"shadingValue",{get:function(){return this._propBag.get(e.StoryPropKey.shadingValue,"")},set:function(t){this._propBag.set(e.StoryPropKey.shadingValue,t)},enumerable:!0,configurable:!0}),r}(Ke);(jt=e.NumberingPropKey||(e.NumberingPropKey={})).start="numbering_start",jt.lvlText="numbering_lvlText",jt.listFmt="numbering_format";var Yt,qt=[e.NumberingPropKey.start,e.NumberingPropKey.lvlText,e.NumberingPropKey.listFmt],Xt=[],Jt=[],Zt=function(t){function r(){var e=null!==t&&t.apply(this,arguments)||this;return e.styleName="",e}return k(r,t),r.prototype.propKeyList=function(){return{propList:qt,notAllowedCopyProps:Xt,notCompareProps:Jt}},Object.defineProperty(r.prototype,"propertyType",{get:function(){return e.PropertyType.NumberingProperty},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"start",{get:function(){return this._propBag.get(e.NumberingPropKey.start,0)},set:function(t){this._propBag.set(e.NumberingPropKey.start,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"lvlText",{get:function(){return this._propBag.get(e.NumberingPropKey.lvlText,"")},set:function(t){this._propBag.set(e.NumberingPropKey.lvlText,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"listFmt",{get:function(){return this._propBag.get(e.NumberingPropKey.listFmt,"")},set:function(t){this._propBag.set(e.NumberingPropKey.listFmt,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isBullet",{get:function(){return this.listFmt===tt.Bullet},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isNumbered",{get:function(){return!this.isBullet&&!this.isTask},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isTask",{get:function(){return this.listFmt===tt.Task},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"listType",{get:function(){return this.isBullet?e.ListType.Bullet:this.isNumbered?e.ListType.Numbered:this.isTask?e.ListType.Task:e.ListType.None},enumerable:!0,configurable:!0}),r}(gt);(Yt=e.BaseContainerPropKey||(e.BaseContainerPropKey={})).anchorId="base_container_anchorId",Yt.containerType="base_container_type",Yt.posH="base_container_posH",Yt.posV="base_container_posV",Yt.width="base_container_width",Yt.height="base_container_height",Yt.wrapType="base_container_wrapType",Yt.fitToParentWidth="base_container_fitToParentWidth",Yt.lockAspectRatio="base_container_lockAspectRatio",Yt.isPlaceHolder="base_container_placeHolder",Yt.marginTop="base_container_marginTop",Yt.marginRight="base_container_marginRight",Yt.marginBottom="base_container_marginBottom",Yt.marginLeft="base_container_marginLeft";var Qt,$t=[e.BaseContainerPropKey.anchorId,e.BaseContainerPropKey.containerType,e.BaseContainerPropKey.posH,e.BaseContainerPropKey.posV,e.BaseContainerPropKey.width,e.BaseContainerPropKey.height,e.BaseContainerPropKey.wrapType,e.BaseContainerPropKey.fitToParentWidth,e.BaseContainerPropKey.lockAspectRatio,e.BaseContainerPropKey.isPlaceHolder,e.BaseContainerPropKey.marginTop,e.BaseContainerPropKey.marginRight,e.BaseContainerPropKey.marginBottom,e.BaseContainerPropKey.marginLeft],er=[e.BaseContainerPropKey.anchorId,e.BaseContainerPropKey.containerType],tr=[],rr=new Map,nr=function(t){function r(e){var r=t.call(this,e)||this;return r._extraKeyList=[],r._initExtraKeyList(),r}return k(r,t),r.prototype._initExtraKeyList=function(){var e=rr.get(this.propertyType);e?this._extraKeyList=e:(this._prepareExtraKeyList(),rr.set(this.propertyType,this._extraKeyList))},r.prototype._prepareExtraKeyList=function(){for(var t=Object.getPrototypeOf(this);Object.getPrototypeOf(t)!==r.prototype&&t instanceof r;){if(t.hasOwnProperty("propKeyList")){var n=!1;if(t.hasOwnProperty("propertyType"))for(var o in e.PropertyType)Object.prototype.hasOwnProperty.call(e.PropertyType,o)&&t.propertyType===e.PropertyType[o]&&(n=!0);n||this._appendExtraKeyList(t.propKeyList().propList)}t=Object.getPrototypeOf(t)}},r.prototype._appendExtraKeyList=function(e){var t;(t=this._extraKeyList).push.apply(t,K(e))},r.prototype.propKeyList=function(){return{propList:$t,notAllowedCopyProps:er,notCompareProps:tr}},r.prototype.forEachExtraKey=function(e){this._extraKeyList.forEach(e)},r.prototype.getExtra=function(e){return this._propBag.get(e,"")},r.prototype.setExtra=function(e,t){this._propBag.set(e,t)},Object.defineProperty(r.prototype,"anchorId",{get:function(){return this._propBag.get(e.BaseContainerPropKey.anchorId,"")},set:function(t){this._propBag.set(e.BaseContainerPropKey.anchorId,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"containerType",{get:function(){return this._propBag.get(e.BaseContainerPropKey.containerType,e.ContainerType.Drawing)},set:function(t){this._propBag.set(e.BaseContainerPropKey.containerType,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"posH",{get:function(){return this._propBag.get(e.BaseContainerPropKey.posH,0)},set:function(t){this._propBag.set(e.BaseContainerPropKey.posH,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"posV",{get:function(){return this._propBag.get(e.BaseContainerPropKey.posV,0)},set:function(t){this._propBag.set(e.BaseContainerPropKey.posV,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"width",{get:function(){return this._propBag.get(e.BaseContainerPropKey.width,0)},set:function(t){this._propBag.set(e.BaseContainerPropKey.width,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return this._propBag.get(e.BaseContainerPropKey.height,0)},set:function(t){this._propBag.set(e.BaseContainerPropKey.height,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"wrapType",{get:function(){return this._propBag.get(e.BaseContainerPropKey.wrapType,e.WrapType.Inline)},set:function(t){this._propBag.set(e.BaseContainerPropKey.wrapType,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"fitToParentWidth",{get:function(){return this._propBag.get(e.BaseContainerPropKey.fitToParentWidth,!1)},set:function(t){this._propBag.set(e.BaseContainerPropKey.fitToParentWidth,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"lockAspectRatio",{get:function(){return this._propBag.get(e.BaseContainerPropKey.lockAspectRatio,!0)},set:function(t){this._propBag.set(e.BaseContainerPropKey.lockAspectRatio,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isPlaceHolder",{get:function(){return this._propBag.get(e.BaseContainerPropKey.isPlaceHolder,!1)},set:function(t){this._propBag.set(e.BaseContainerPropKey.isPlaceHolder,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"marginTop",{get:function(){return this._propBag.get(e.BaseContainerPropKey.marginTop,ot.containerMargin.top)},set:function(t){this._propBag.set(e.BaseContainerPropKey.marginTop,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"marginRight",{get:function(){return this._propBag.get(e.BaseContainerPropKey.marginRight,ot.containerMargin.right)},set:function(t){this._propBag.set(e.BaseContainerPropKey.marginRight,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"marginBottom",{get:function(){return this._propBag.get(e.BaseContainerPropKey.marginBottom,ot.containerMargin.bottom)},set:function(t){this._propBag.set(e.BaseContainerPropKey.marginBottom,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"marginLeft",{get:function(){return this._propBag.get(e.BaseContainerPropKey.marginLeft,ot.containerMargin.left)},set:function(t){this._propBag.set(e.BaseContainerPropKey.marginLeft,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"margin",{get:function(){return{top:this.marginTop,right:this.marginRight,bottom:this.marginBottom,left:this.marginLeft}},enumerable:!0,configurable:!0}),r}(Rt),or=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return k(r,t),Object.defineProperty(r.prototype,"propertyType",{get:function(){return e.PropertyType.DefaultContainerProperty},enumerable:!0,configurable:!0}),r}(nr);(Qt=e.DrawingContainerPropKey||(e.DrawingContainerPropKey={})).drawingType="drawing_container_type",Qt.fillColor="drawing_container_fillColor";var ir,ar=[e.DrawingContainerPropKey.drawingType,e.DrawingContainerPropKey.fillColor],sr=[e.DrawingContainerPropKey.drawingType],pr=[],lr=function(t){function r(r){var n=t.call(this,r)||this;return n.containerType=e.ContainerType.Drawing,n.drawingType=n.getDrawingType(),n}return k(r,t),r.prototype.propKeyList=function(){return{propList:ar,notAllowedCopyProps:sr,notCompareProps:pr}},Object.defineProperty(r.prototype,"drawingType",{get:function(){return this._propBag.get(e.DrawingContainerPropKey.drawingType,e.DrawingType.Default)},set:function(t){this._propBag.set(e.DrawingContainerPropKey.drawingType,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"fillColor",{get:function(){return this._propBag.get(e.DrawingContainerPropKey.fillColor,"")},set:function(t){this._propBag.set(e.DrawingContainerPropKey.fillColor,t)},enumerable:!0,configurable:!0}),r}(nr),cr=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return k(r,t),r.prototype.getDrawingType=function(){return e.DrawingType.Default},Object.defineProperty(r.prototype,"propertyType",{get:function(){return e.PropertyType.DefaultDrawingProperty},enumerable:!0,configurable:!0}),r}(lr);(ir=e.SplitlinePropKey||(e.SplitlinePropKey={})).type="split_type",ir.marginLeft="split_margin_left",ir.marginRight="split_margin_right";var ur,hr=[e.SplitlinePropKey.type,e.SplitlinePropKey.marginLeft,e.SplitlinePropKey.marginRight],fr=[],dr=[],gr=function(t){function r(){var e=null!==t&&t.apply(this,arguments)||this;return e.fitToParentWidth=!0,e.lockAspectRatio=!1,e}return k(r,t),r.prototype.getDrawingType=function(){return e.DrawingType.Splitline},r.prototype.propKeyList=function(){return{propList:hr,notAllowedCopyProps:fr,notCompareProps:dr}},Object.defineProperty(r.prototype,"propertyType",{get:function(){return e.PropertyType.SplitlineProperty},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"type",{get:function(){return this._propBag.get(e.SplitlinePropKey.type,e.SplitlineStyle.Normal)},set:function(t){this._propBag.set(e.SplitlinePropKey.type,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"marginLeft",{get:function(){return this._propBag.get(e.SplitlinePropKey.marginLeft,0)},set:function(t){this._propBag.set(e.SplitlinePropKey.marginLeft,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"marginRight",{get:function(){return this._propBag.get(e.SplitlinePropKey.marginRight,0)},set:function(t){this._propBag.set(e.SplitlinePropKey.marginRight,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"marginTop",{get:function(){return this._propBag.get(e.BaseContainerPropKey.marginTop,0)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"marginBottom",{get:function(){return this._propBag.get(e.BaseContainerPropKey.marginBottom,0)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return 300},set:function(e){},enumerable:!0,configurable:!0}),r}(lr);(ur=e.ImagePropKey||(e.ImagePropKey={})).imgSrc="img_imgSrc",ur.originWidth="img_originWidth",ur.originHeight="img_originHeight",ur.scaleWidth="img_scaleWidth",ur.scaleHeight="img_scaleHeight",ur.cropBottom="img_cropBottom",ur.cropLeft="img_cropLeft",ur.cropRight="img_cropRight",ur.cropTop="img_cropTop",ur.isFromInitLoad="img_isFromInitLoad",ur.progress="img_progress",ur.placeHolderSrc="img_placeHoderSrc";var yr,mr=[e.ImagePropKey.imgSrc,e.ImagePropKey.originWidth,e.ImagePropKey.originHeight,e.ImagePropKey.scaleWidth,e.ImagePropKey.scaleHeight,e.ImagePropKey.cropBottom,e.ImagePropKey.cropLeft,e.ImagePropKey.cropRight,e.ImagePropKey.cropTop,e.ImagePropKey.isFromInitLoad,e.ImagePropKey.progress],br=[],Pr=[],vr=function(t){function r(){var e=null!==t&&t.apply(this,arguments)||this;return e.fitToParentWidth=!1,e}return k(r,t),r.prototype.getDrawingType=function(){return e.DrawingType.Image},r.prototype.propKeyList=function(){return{propList:mr,notAllowedCopyProps:br,notCompareProps:Pr}},Object.defineProperty(r.prototype,"propertyType",{get:function(){return e.PropertyType.ImageProperty},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imgSrc",{get:function(){return this._propBag.get(e.ImagePropKey.imgSrc,"")},set:function(t){this._propBag.set(e.ImagePropKey.imgSrc,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"originWidth",{get:function(){return this._propBag.get(e.ImagePropKey.originWidth,0)},set:function(t){this._propBag.set(e.ImagePropKey.originWidth,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"originHeight",{get:function(){return this._propBag.get(e.ImagePropKey.originHeight,0)},set:function(t){this._propBag.set(e.ImagePropKey.originHeight,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scaleWidth",{get:function(){return this._propBag.get(e.ImagePropKey.scaleWidth,0)},set:function(t){this._propBag.set(e.ImagePropKey.scaleWidth,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scaleHeight",{get:function(){return this._propBag.get(e.ImagePropKey.scaleHeight,0)},set:function(t){this._propBag.set(e.ImagePropKey.scaleHeight,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cropBottom",{get:function(){return this._propBag.get(e.ImagePropKey.cropBottom,0)},set:function(t){this._propBag.set(e.ImagePropKey.cropBottom,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cropTop",{get:function(){return this._propBag.get(e.ImagePropKey.cropTop,0)},set:function(t){this._propBag.set(e.ImagePropKey.cropTop,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cropLeft",{get:function(){return this._propBag.get(e.ImagePropKey.cropLeft,0)},set:function(t){this._propBag.set(e.ImagePropKey.cropLeft,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cropRight",{get:function(){return this._propBag.get(e.ImagePropKey.cropRight,0)},set:function(t){this._propBag.set(e.ImagePropKey.cropRight,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"width",{get:function(){return this.originWidth*(1-this.cropLeft/1e5-this.cropRight/1e5)},set:function(e){this.originWidth=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return this.originHeight*(1-this.cropTop/1e5-this.cropBottom/1e5)},set:function(e){this.originHeight=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isFromInitLoad",{get:function(){return this._propBag.get(e.ImagePropKey.isFromInitLoad,!1)},set:function(t){this._propBag.set(e.ImagePropKey.isFromInitLoad,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"progress",{get:function(){return this._propBag.get(e.ImagePropKey.progress,0)},set:function(t){this._propBag.set(e.ImagePropKey.progress,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"placeHolderSrc",{get:function(){return this._propBag.get(e.ImagePropKey.placeHolderSrc,"")},set:function(t){this._propBag.set(e.ImagePropKey.placeHolderSrc,t)},enumerable:!0,configurable:!0}),r}(lr);(yr=e.TextframePropKey||(e.TextframePropKey={})).whiteSpaceType="white-space",yr.paddingTop="padding-top",yr.paddingLeft="padding-left",yr.paddingRight="padding-right",yr.paddingBottom="padding-bottom",yr.textframeType="textframe-type";var xr,Tr=[e.TextframePropKey.whiteSpaceType,e.TextframePropKey.paddingTop,e.TextframePropKey.paddingLeft,e.TextframePropKey.paddingRight,e.TextframePropKey.paddingBottom,e.TextframePropKey.textframeType],_r=[],Sr=[],Cr=function(t){function r(r){var n=t.call(this,r)||this;return n.drawingType=e.DrawingType.Textframe,n.textframeType=n.getTextframeType(),n}return k(r,t),r.prototype.getTextframeType=function(){return e.TextframeType.Normal},r.prototype.getDrawingType=function(){return e.DrawingType.Textframe},r.prototype.propKeyList=function(){return{propList:Tr,notAllowedCopyProps:_r,notCompareProps:Sr}},Object.defineProperty(r.prototype,"propertyType",{get:function(){return e.PropertyType.TextframeProperty},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isStoryPlaceholder",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"storyId",{get:function(){return this.anchorId},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"whiteSpaceType",{get:function(){return this._propBag.get(e.TextframePropKey.whiteSpaceType,e.WhiteSpaceType.Normal)},set:function(t){this._propBag.set(e.TextframePropKey.whiteSpaceType,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"textframeType",{get:function(){return this._propBag.get(e.TextframePropKey.textframeType,e.TextframeType.Normal)},set:function(t){this._propBag.set(e.TextframePropKey.textframeType,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"paddingTop",{get:function(){return this._propBag.get(e.TextframePropKey.paddingTop,0)},set:function(t){this._propBag.set(e.TextframePropKey.paddingTop,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"paddingLeft",{get:function(){return this._propBag.get(e.TextframePropKey.paddingLeft,0)},set:function(t){this._propBag.set(e.TextframePropKey.paddingLeft,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"paddingRight",{get:function(){return this._propBag.get(e.TextframePropKey.paddingRight,0)},set:function(t){this._propBag.set(e.TextframePropKey.paddingRight,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"paddingBottom",{get:function(){return this._propBag.get(e.TextframePropKey.paddingBottom,0)},set:function(t){this._propBag.set(e.TextframePropKey.paddingBottom,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"marginTop",{get:function(){return this._propBag.get(e.BaseContainerPropKey.marginTop,0)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"marginRight",{get:function(){return this._propBag.get(e.BaseContainerPropKey.marginRight,0)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"marginBottom",{get:function(){return this._propBag.get(e.BaseContainerPropKey.marginBottom,0)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"marginLeft",{get:function(){return this._propBag.get(e.BaseContainerPropKey.marginLeft,0)},enumerable:!0,configurable:!0}),r}(lr);(xr=e.CodeblockPropKey||(e.CodeblockPropKey={})).language="codeblock-language",xr.theme="codeblock-theme";var Br,Rr=[e.CodeblockPropKey.language,e.CodeblockPropKey.theme],wr=[],Ir=[],Er=function(t){function n(e){var r=t.call(this,e)||this;return r.isFitToParentWidth=!0,r.isLockAspectRatio=!1,r}return k(n,t),n.prototype.getTextframeType=function(){return e.TextframeType.Codeblock},n.prototype.propKeyList=function(){return{propList:Rr,notAllowedCopyProps:wr,notCompareProps:Ir}},Object.defineProperty(n.prototype,"propertyType",{get:function(){return e.PropertyType.CodeblockProperty},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"fitToParentWidth",{get:function(){return this.isFitToParentWidth},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"lockAspectRatio",{get:function(){return this.isLockAspectRatio},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"whiteSpaceType",{get:function(){return e.WhiteSpaceType.Normal},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"language",{get:function(){return this._propBag.get(e.CodeblockPropKey.language,"plain text")},set:function(t){this._propBag.set(e.CodeblockPropKey.language,t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"theme",{get:function(){return this._propBag.get(e.CodeblockPropKey.theme,"normal")},set:function(t){this._propBag.set(e.CodeblockPropKey.theme,t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"paddingTop",{get:function(){return this._propBag.get(e.TextframePropKey.paddingTop,Math.max(r.pxToTwips(12),T()))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"paddingLeft",{get:function(){return this._propBag.get(e.TextframePropKey.paddingLeft,r.pxToTwips(42))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"paddingRight",{get:function(){return this._propBag.get(e.TextframePropKey.paddingRight,x())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"paddingBottom",{get:function(){return this._propBag.get(e.TextframePropKey.paddingBottom,Math.max(r.pxToTwips(12),T()))},enumerable:!0,configurable:!0}),n}(Cr),Lr=function(){function t(){}return Object.defineProperty(t,"defaultGetter",{get:function(){return this._defaultGetter},enumerable:!0,configurable:!0}),t.prototype.width=function(){return 0},t.prototype.height=function(){return 0},t.prototype.wrapType=function(){return e.WrapType.Inline},t.prototype.fitToParentWidth=function(){return!1},t.prototype.marginTop=function(){return 0},t.prototype.marginRight=function(){return 0},t.prototype.marginBottom=function(){return 0},t.prototype.marginLeft=function(){return 0},t._defaultGetter=new t,t}(),Or=function(){function e(){this._getters=new Map}return e.getInstance=function(){return this._instance},e.prototype.add=function(e,t){this._getters.set(e,t)},e.prototype.remove=function(e){this._getters.delete(e)},e.prototype.get=function(e){return this._getters.get(e)||Lr.defaultGetter},e._instance=new e,e}();(Br=e.EmbedCommentPropKey||(e.EmbedCommentPropKey={})).type="custom_box_type",Br.data="custom_box_data";var Nr,kr=[e.EmbedCommentPropKey.type,e.EmbedCommentPropKey.data],Mr=[],Dr=[],Fr=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return k(r,t),r.prototype.getDrawingType=function(){return e.DrawingType.EmbedComment},r.prototype.propKeyList=function(){return{propList:kr,notAllowedCopyProps:Mr,notCompareProps:Dr}},Object.defineProperty(r.prototype,"propertyType",{get:function(){return e.PropertyType.EmbedCommentProperty},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"type",{get:function(){return this._propBag.get(e.EmbedCommentPropKey.type,"")},set:function(t){this._propBag.set(e.EmbedCommentPropKey.type,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"data",{get:function(){return this._propBag.get(e.EmbedCommentPropKey.data,"")},set:function(t){this._propBag.set(e.EmbedCommentPropKey.data,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"generator",{get:function(){return Or.getInstance().get(this.type)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"width",{get:function(){return this.generator.width(this.data)},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return this.generator.height(this.data)},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"wrapType",{get:function(){return this.generator.wrapType(this.data)},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"fitToParentWidth",{get:function(){return this.generator.fitToParentWidth(this.data)},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"marginTop",{get:function(){return this.generator.marginTop(this.data)},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"marginRight",{get:function(){return this.generator.marginRight(this.data)},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"marginBottom",{get:function(){return this.generator.marginBottom(this.data)},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"marginLeft",{get:function(){return this.generator.marginLeft(this.data)},set:function(e){},enumerable:!0,configurable:!0}),r}(lr);(Nr=e.PluginContainerPropKey||(e.PluginContainerPropKey={})).pluginType="plugin_container_type",Nr.pluginSrc="plugin_container_src",Nr.extraData="plugin_container_extraData";var Ar,Kr=[e.PluginContainerPropKey.pluginType,e.PluginContainerPropKey.pluginSrc,e.PluginContainerPropKey.extraData],Gr=[],Hr=[],jr=function(t){function r(r){var n=t.call(this,r)||this;return n.containerType=e.ContainerType.Plugin,n.pluginType=n.getPluginType(),n}return k(r,t),r.prototype.propKeyList=function(){return{propList:Kr,notAllowedCopyProps:Gr,notCompareProps:Hr}},Object.defineProperty(r.prototype,"pluginType",{get:function(){return this._propBag.get(e.PluginContainerPropKey.pluginType,e.PluginType.Default)},set:function(t){this._propBag.set(e.PluginContainerPropKey.pluginType,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"pluginSrc",{get:function(){return this._propBag.get(e.PluginContainerPropKey.pluginSrc,"")},set:function(t){this._propBag.set(e.PluginContainerPropKey.pluginSrc,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"extraData",{get:function(){return this._propBag.get(e.PluginContainerPropKey.extraData,"")},set:function(t){this._propBag.set(e.PluginContainerPropKey.extraData,t)},enumerable:!0,configurable:!0}),r}(nr),Ur=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return k(r,t),r.prototype.getPluginType=function(){return this.pluginType},Object.defineProperty(r.prototype,"propertyType",{get:function(){return e.PropertyType.DefaultPluginProperty},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"lockAspectRatio",{get:function(){return this._propBag.get(e.BaseContainerPropKey.lockAspectRatio,!1)},set:function(t){this._propBag.set(e.BaseContainerPropKey.lockAspectRatio,t)},enumerable:!0,configurable:!0}),r}(jr);(Ar=e.TablePropKey||(e.TablePropKey={})).tableId="table_tableId",Ar.subId="table_subId",Ar.colWidths="table_colWidths",Ar.rowHeights="table_rowHeights",Ar.paddingLeft="table_paddingLeft",Ar.paddingRight="table_paddingRight";var zr,Wr=[e.TablePropKey.tableId,e.TablePropKey.colWidths,e.TablePropKey.rowHeights,e.TablePropKey.paddingLeft,e.TablePropKey.paddingRight],Vr=[e.TablePropKey.tableId],Yr=[],qr=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return k(r,t),r.prototype.propKeyList=function(){return{propList:Wr,notAllowedCopyProps:Vr,notCompareProps:Yr}},Object.defineProperty(r.prototype,"propertyType",{get:function(){return e.PropertyType.TableProperty},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"tableId",{get:function(){return this._propBag.get(e.TablePropKey.tableId,"")},set:function(t){this._propBag.set(e.TablePropKey.tableId,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"subId",{get:function(){return this._propBag.get(e.TablePropKey.subId,"")||this.tableId},set:function(t){this._propBag.set(e.TablePropKey.subId,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isStreamMerged",{get:function(){return this.subId!==this.tableId},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"colWidths",{get:function(){if(this._propBag.has(e.TablePropKey.colWidths)){var t=this._propBag.get(e.TablePropKey.colWidths,"");try{return JSON.parse(t)}catch(e){return[]}}return[]},set:function(t){this._propBag.set(e.TablePropKey.colWidths,JSON.stringify(t))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"rowHeights",{get:function(){if(this._propBag.has(e.TablePropKey.rowHeights)){var t=this._propBag.get(e.TablePropKey.rowHeights,"");try{return JSON.parse(t)}catch(e){return[]}}return[]},set:function(t){this._propBag.set(e.TablePropKey.rowHeights,JSON.stringify(t))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"paddingLeft",{get:function(){return this._propBag.get(e.TablePropKey.paddingLeft,0)},set:function(t){this._propBag.set(e.TablePropKey.paddingLeft,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"paddingRight",{get:function(){return this._propBag.get(e.TablePropKey.paddingRight,0)},set:function(t){this._propBag.set(e.TablePropKey.paddingRight,t)},enumerable:!0,configurable:!0}),r}(gt);(zr=e.TableRowPropKey||(e.TableRowPropKey={})).rowHeight="table_row_rowHeight",zr.isRowStart="table_row_isStart";var Xr,Jr=[e.TableRowPropKey.rowHeight],Zr=[],Qr=[],$r=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return k(r,t),Object.defineProperty(r.prototype,"isRowStart",{get:function(){return this._propBag.get(e.TableRowPropKey.isRowStart,!1)},set:function(t){this._propBag.set(e.TableRowPropKey.isRowStart,t)},enumerable:!0,configurable:!0}),r.prototype.propKeyList=function(){return{propList:Jr,notAllowedCopyProps:Zr,notCompareProps:Qr}},Object.defineProperty(r.prototype,"propertyType",{get:function(){return e.PropertyType.TableRowProperty},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"rowHeight",{get:function(){return this._propBag.get(e.TableRowPropKey.rowHeight,0)||ot.tableRow.rowHeight},set:function(t){this._propBag.set(e.TableRowPropKey.rowHeight,t)},enumerable:!0,configurable:!0}),r}(gt);(Xr=e.TableCellPropKey||(e.TableCellPropKey={})).cellcolor="table_cell_cellcolor",Xr.borderTopWidth="table_cell_borderTopWidth",Xr.borderTopStyle="table_cell_borderTopStyle",Xr.borderTopColor="table_cell_borderTopColor",Xr.borderRightWidth="table_cell_borderRightWidth",Xr.borderRightStyle="table_cell_borderRightStyle",Xr.borderRightColor="table_cell_borderRightColor",Xr.borderBottomWidth="table_cell_borderBottomWidth",Xr.borderBottomStyle="table_cell_borderBottomStyle",Xr.borderBottomColor="table_cell_borderBottomColor",Xr.borderLeftWidth="table_cell_borderLeftWidth",Xr.borderLeftStyle="table_cell_borderLeftStyle",Xr.borderLeftColor="table_cell_borderLeftColor",Xr.paddingTop="table_cell_paddingTop",Xr.paddingRight="table_cell_paddingRight",Xr.paddingBottom="table_cell_paddingBottom",Xr.paddingLeft="table_cell_paddingLeft",Xr.rowSpan="table_cell_rowSpan",Xr.colSpan="table_cell_colSpan",Xr.isMerged="table_cell_isMerged",Xr.vAlign="table_cell_v_align",Xr.hAlign="table_cell_h_align",Xr.isCellStart="table_cell_isStart";var en,tn,rn=[e.TableCellPropKey.cellcolor,e.TableCellPropKey.borderTopWidth,e.TableCellPropKey.borderTopStyle,e.TableCellPropKey.borderTopColor,e.TableCellPropKey.borderRightWidth,e.TableCellPropKey.borderRightStyle,e.TableCellPropKey.borderRightColor,e.TableCellPropKey.borderBottomWidth,e.TableCellPropKey.borderBottomStyle,e.TableCellPropKey.borderBottomColor,e.TableCellPropKey.borderLeftWidth,e.TableCellPropKey.borderLeftStyle,e.TableCellPropKey.borderLeftColor,e.TableCellPropKey.paddingTop,e.TableCellPropKey.paddingRight,e.TableCellPropKey.paddingBottom,e.TableCellPropKey.paddingLeft,e.TableCellPropKey.rowSpan,e.TableCellPropKey.colSpan,e.TableCellPropKey.isMerged,e.TableCellPropKey.vAlign,e.TableCellPropKey.hAlign,e.TableCellPropKey.isCellStart],nn=[],on=[],an=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return k(r,t),r.prototype.propKeyList=function(){return{propList:rn,notAllowedCopyProps:nn,notCompareProps:on}},Object.defineProperty(r.prototype,"propertyType",{get:function(){return e.PropertyType.TableCellProperty},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cellcolor",{get:function(){return this._propBag.get(e.TableCellPropKey.cellcolor,ot.tableCell.cellcolor)},set:function(t){this._propBag.set(e.TableCellPropKey.cellcolor,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"borderTopWidth",{get:function(){return this._propBag.get(e.TableCellPropKey.borderTopWidth,ot.tableCell.borderTop.borderWidth)},set:function(t){this._propBag.set(e.TableCellPropKey.borderTopWidth,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"borderTopStyle",{get:function(){return this._propBag.get(e.TableCellPropKey.borderTopStyle,ot.tableCell.borderTop.borderStyle)},set:function(t){this._propBag.set(e.TableCellPropKey.borderTopStyle,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"borderTopColor",{get:function(){return this._propBag.get(e.TableCellPropKey.borderTopColor,ot.tableCell.borderTop.borderColor)},set:function(t){this._propBag.set(e.TableCellPropKey.borderTopColor,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"borderTop",{get:function(){return{borderWidth:this.borderTopWidth,borderStyle:this.borderTopStyle,borderColor:this.borderTopColor}},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"borderRightWidth",{get:function(){return this._propBag.get(e.TableCellPropKey.borderRightWidth,ot.tableCell.borderRight.borderWidth)},set:function(t){this._propBag.set(e.TableCellPropKey.borderRightWidth,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"borderRightStyle",{get:function(){return this._propBag.get(e.TableCellPropKey.borderRightStyle,ot.tableCell.borderRight.borderStyle)},set:function(t){this._propBag.set(e.TableCellPropKey.borderRightStyle,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"borderRightColor",{get:function(){return this._propBag.get(e.TableCellPropKey.borderRightColor,ot.tableCell.borderRight.borderColor)},set:function(t){this._propBag.set(e.TableCellPropKey.borderRightColor,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"borderRight",{get:function(){return{borderWidth:this.borderRightWidth,borderStyle:this.borderRightStyle,borderColor:this.borderRightColor}},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"borderBottomWidth",{get:function(){return this._propBag.get(e.TableCellPropKey.borderBottomWidth,ot.tableCell.borderBottom.borderWidth)},set:function(t){this._propBag.set(e.TableCellPropKey.borderBottomWidth,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"borderBottomStyle",{get:function(){return this._propBag.get(e.TableCellPropKey.borderBottomStyle,ot.tableCell.borderBottom.borderStyle)},set:function(t){this._propBag.set(e.TableCellPropKey.borderBottomStyle,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"borderBottomColor",{get:function(){return this._propBag.get(e.TableCellPropKey.borderBottomColor,ot.tableCell.borderBottom.borderColor)},set:function(t){this._propBag.set(e.TableCellPropKey.borderBottomColor,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"borderBottom",{get:function(){return{borderWidth:this.borderBottomWidth,borderStyle:this.borderBottomStyle,borderColor:this.borderBottomColor}},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"borderLeftWidth",{get:function(){return this._propBag.get(e.TableCellPropKey.borderLeftWidth,ot.tableCell.borderLeft.borderWidth)},set:function(t){this._propBag.set(e.TableCellPropKey.borderLeftWidth,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"borderLeftStyle",{get:function(){return this._propBag.get(e.TableCellPropKey.borderLeftStyle,ot.tableCell.borderLeft.borderStyle)},set:function(t){this._propBag.set(e.TableCellPropKey.borderLeftStyle,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"borderLeftColor",{get:function(){return this._propBag.get(e.TableCellPropKey.borderLeftColor,ot.tableCell.borderLeft.borderColor)},set:function(t){this._propBag.set(e.TableCellPropKey.borderLeftColor,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"borderLeft",{get:function(){return{borderWidth:this.borderLeftWidth,borderStyle:this.borderLeftStyle,borderColor:this.borderLeftColor}},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"paddingTop",{get:function(){return this._propBag.get(e.TableCellPropKey.paddingTop,ot.tableCell.padding.top)},set:function(t){this._propBag.set(e.TableCellPropKey.paddingTop,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"paddingRight",{get:function(){return this._propBag.get(e.TableCellPropKey.paddingRight,ot.tableCell.padding.right)},set:function(t){this._propBag.set(e.TableCellPropKey.paddingRight,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"paddingBottom",{get:function(){return this._propBag.get(e.TableCellPropKey.paddingBottom,ot.tableCell.padding.bottom)},set:function(t){this._propBag.set(e.TableCellPropKey.paddingBottom,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"paddingLeft",{get:function(){return this._propBag.get(e.TableCellPropKey.paddingLeft,ot.tableCell.padding.left)},set:function(t){this._propBag.set(e.TableCellPropKey.paddingLeft,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"padding",{get:function(){return{top:this.paddingTop,right:this.paddingRight,bottom:this.paddingBottom,left:this.paddingLeft}},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"rowSpan",{get:function(){return this._propBag.get(e.TableCellPropKey.rowSpan,ot.tableCell.rowSpan)||ot.tableCell.rowSpan},set:function(t){this._propBag.set(e.TableCellPropKey.rowSpan,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"colSpan",{get:function(){return this._propBag.get(e.TableCellPropKey.colSpan,ot.tableCell.colSpan)||ot.tableCell.colSpan},set:function(t){this._propBag.set(e.TableCellPropKey.colSpan,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isMerged",{get:function(){return this.colSpan<0||this.rowSpan<0},set:function(e){e?(this.rowSpan=-1,this.colSpan=-1):(this.rowSpan<0&&(this.rowSpan=1),this.colSpan<0&&(this.colSpan=1))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"vAlign",{get:function(){return this._propBag.get(e.TableCellPropKey.vAlign,"")},set:function(t){this._propBag.set(e.TableCellPropKey.vAlign,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"hAlign",{get:function(){return this._propBag.get(e.TableCellPropKey.hAlign,"")},set:function(t){this._propBag.set(e.TableCellPropKey.hAlign,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isCellStart",{get:function(){return this._propBag.get(e.TableCellPropKey.isCellStart,!1)},set:function(t){this._propBag.set(e.TableCellPropKey.isCellStart,t)},enumerable:!0,configurable:!0}),Object.defineProperty(r,"default",{get:function(){var e=new r;return e.cellcolor="",e.vAlign="",e.hAlign="",e.borderTopWidth=ot.tableCell.borderTop.borderWidth,e.borderTopStyle=ot.tableCell.borderTop.borderStyle,e.borderTopColor=ot.tableCell.borderTop.borderColor,e.borderRightWidth=ot.tableCell.borderRight.borderWidth,e.borderRightStyle=ot.tableCell.borderRight.borderStyle,e.borderRightColor=ot.tableCell.borderRight.borderColor,e.borderBottomWidth=ot.tableCell.borderBottom.borderWidth,e.borderBottomStyle=ot.tableCell.borderBottom.borderStyle,e.borderBottomColor=ot.tableCell.borderBottom.borderColor,e.borderLeftWidth=ot.tableCell.borderLeft.borderWidth,e.borderLeftStyle=ot.tableCell.borderLeft.borderStyle,e.borderLeftColor=ot.tableCell.borderLeft.borderColor,e},enumerable:!0,configurable:!0}),r}(gt),sn=function(t){function r(r){var n=t.call(this,r)||this;return n.cellcolor="",n.borderTopWidth=0,n.borderTopStyle=e.BorderStyleType.none,n.borderTopColor="",n.borderRightWidth=0,n.borderRightStyle=e.BorderStyleType.none,n.borderRightColor="",n.borderBottomWidth=0,n.borderBottomStyle=e.BorderStyleType.none,n.borderBottomColor="",n.borderLeftWidth=0,n.borderLeftStyle=e.BorderStyleType.none,n.borderLeftColor="",n}return k(r,t),Object.defineProperty(r.prototype,"propertyType",{get:function(){return e.PropertyType.TableRowBreakCell},enumerable:!0,configurable:!0}),r}(an),pn=function(){function t(e){this._nextLayer=e}return t.prototype.createDataIterator=function(e){return this._nextLayer.createDataIterator(e)},t.prototype.createStoryIterator=function(e){return this._nextLayer.createStoryIterator(e)},t.prototype.createSectionIterator=function(e){return this._nextLayer.createSectionIterator(e)},t.prototype.createParagraphIterator=function(e){return this._nextLayer.createParagraphIterator(e)},t.prototype.createSpanIterator=function(e){return this._nextLayer.createSpanIterator(e)},t.prototype.getIndexFromGCP=function(e){return this._nextLayer.getIndexFromGCP(e)},t.prototype.getGCPFromIndex=function(e){return this._nextLayer.getGCPFromIndex(e)},t.prototype.getRangeFromIndex=function(e,t){return this._nextLayer.getRangeFromIndex(e,t)},t.prototype.getLength=function(){return this._nextLayer.getLength()},t.prototype.charAt=function(e){return this._nextLayer.charAt(e)},t.prototype.charCodeAt=function(e){return this._nextLayer.charCodeAt(e)},t.prototype.readText=function(e,t){return this._nextLayer.readText(e,t)},t.prototype.getNotificationCenter=function(){return this._nextLayer.getNotificationCenter()},Object.defineProperty(t.prototype,"tableStream",{get:function(){return this._nextLayer.tableStream},enumerable:!0,configurable:!0}),t.prototype.getMainStoryInfo=function(){return this._nextLayer.findStoryInfoFromId(e.StoryID.MainDocId)},t.prototype.findStoryInfoFromId=function(e){return this._nextLayer.findStoryInfoFromId(e)},t.prototype.findStoryInfoFromGcp=function(e){return this._nextLayer.findStoryInfoFromGcp(e)},t}();(en=e.TextStreamNotiyType||(e.TextStreamNotiyType={})).DataInsert="DataInsert",en.DataDelete="DataDelete",en.StoryChange="StoryChange",en.SectChange="SectChange",en.ParaChange="ParaChange",en.SpanChange="SpanChange",en.InsertContainer="InsertContainer",en.DeleteContainer="DeleteContainer",en.ModifyContainer="ModifyContainer",(tn=e.DataInsertType||(e.DataInsertType={}))[tn.StoryBegin=0]="StoryBegin",tn[tn.StoryEnd=1]="StoryEnd",tn[tn.Section=2]="Section",tn[tn.Paragraph=3]="Paragraph",tn[tn.Text=4]="Text";var ln,cn=function(t){function r(r,n,o,i){var a=t.call(this,e.TextStreamNotiyType.DataInsert)||this;return a.range=r,a.insertType=n,a.property=o,a.text=i,a}return k(r,t),r}(r.Notification),un=function(t){function r(r){var n=t.call(this,e.TextStreamNotiyType.DataDelete)||this;return n.range=r,n}return k(r,t),r}(r.Notification),hn=function(t){function r(r,n,o){var i=t.call(this,e.TextStreamNotiyType.StoryChange)||this;return i.range=r,i.storyProp=n,i.modifiedResult=o,i}return k(r,t),r}(r.Notification),fn=function(t){function r(r,n,o){var i=t.call(this,e.TextStreamNotiyType.SectChange)||this;return i.range=r,i.sectProp=n,i.modifiedResult=o,i}return k(r,t),r}(r.Notification),dn=function(t){function r(r,n,o){var i=t.call(this,e.TextStreamNotiyType.ParaChange)||this;return i.range=r,i.paraProp=n,i.modifiedResult=o,i}return k(r,t),r}(r.Notification),gn=function(t){function r(r,n,o){var i=t.call(this,e.TextStreamNotiyType.SpanChange)||this;return i.range=r,i.spanProp=n,i.modifiedResult=o,i}return k(r,t),r}(r.Notification),yn=function(t){function r(r){var n=t.call(this,e.TextStreamNotiyType.InsertContainer)||this;return n.anchorInfos=r,n}return k(r,t),r}(r.Notification),mn=function(t){function r(r){var n=t.call(this,e.TextStreamNotiyType.DeleteContainer)||this;return n.anchorInfos=r,n}return k(r,t),r}(r.Notification),bn=function(t){function r(r){var n=t.call(this,e.TextStreamNotiyType.ModifyContainer)||this;return n.anchorInfos=r,n}return k(r,t),r}(r.Notification),Pn=function(){function e(){this._asyncEmitters=new Map,this._syncEmitters=new Map}return e.prototype.getAsyncEmitter=function(e){var t=this._asyncEmitters.get(e);return t||(t=new r.Emitter,this._asyncEmitters.set(e,t)),t},e.prototype.getSyncEmitter=function(e){var t=this._syncEmitters.get(e);return t||(t=new r.Emitter,this._syncEmitters.set(e,t)),t},e.prototype.removeEmitter=function(e){this._asyncEmitters&&this._asyncEmitters.delete(e),this._syncEmitters&&this._syncEmitters.delete(e)},e.prototype.on=function(e,t,r,n,o){void 0===r&&(r=!0),(r?this.getAsyncEmitter(e):this.getSyncEmitter(e)).addListener(t,n,o)},e.prototype.fire=function(e){this.getAsyncEmitter(e.type).fire(e,!0),this.getSyncEmitter(e.type).fire(e,!1)},e.prototype.removeCallBack=function(e,t){var r=this.getAsyncEmitter(e);r.removeCallBack(t),(r=this.getSyncEmitter(e)).removeCallBack(t)},e.prototype.removeListener=function(e,t){var r=this.getAsyncEmitter(e);r.removeListener(t),(r=this.getSyncEmitter(e)).removeListener(t)},e.prototype.once=function(e,t,r,n){void 0===r&&(r=!0);(r?this.getAsyncEmitter(e):this.getSyncEmitter(e)).addListener((function(e){t(e),e.callOnce()}),n)},e}(),vn=function(){function t(t,r,n,o){void 0===r&&(r=!1),void 0===n&&(n=!0),void 0===o&&(o=e.PosPolicy.Outer),this._async=!0,this._posPolicy=e.PosPolicy.Outer,this._keySet=new Set,this._floatTree=new re(o),this._notificationCenter=t,this._needReservedWhenEraseSpace=r,this._async=n,this._posPolicy=o,this._addListener()}return t.prototype.destroy=function(){this._notificationCenter&&(this._notificationCenter.removeListener(e.TextStreamNotiyType.DataInsert,this),this._notificationCenter.removeListener(e.TextStreamNotiyType.DataDelete,this))},t.prototype.removeAll=function(){this._floatTree=new re(this._posPolicy),this._keySet.clear()},t.prototype._addListener=function(){var t=this;this._notificationCenter&&(this._notificationCenter.on(e.TextStreamNotiyType.DataInsert,(function(e){t._floatTree.insertSpace(e.range.begin(),e.range.length())}),this._async,this),this._notificationCenter.on(e.TextStreamNotiyType.DataDelete,(function(e){t._eraseSpace(e.range)}),this._async,this))},t.prototype.getFTTreeIterator=function(t){return this._posPolicy===e.PosPolicy.Inner?this._floatTree.findOuter(t):this._floatTree.findInner(t)},t}(),xn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return k(t,e),t.prototype._eraseSpace=function(e){var t=this;this._floatTree.eraseSpace(e.begin(),e.length(),(function(r){if(t._needReservedWhenEraseSpace||t._eraseList){var n=[];r.forEach((function(r){r.data.forEach((function(r){t._needReservedWhenEraseSpace?t.insertGCP(r,e.begin()):n.push(r)}))})),t._eraseList&&t._eraseList(n)}}))},t.prototype.onEraseList=function(e){this._eraseList=e},t.prototype.containRange=function(e){return this._keySet.has(e)},t.prototype.insertGCP=function(e,t){if(t<0)return!1;if(this.getGCP(e))return!1;var r=e,n=[r],o=this.getFTTreeIterator(t),i=o.data();return i&&this._floatTree.position(o).val===t?i.push(r):this._floatTree.insertFloat(t,n),this._keySet.add(e),!0},t.prototype.getGCP=function(e){var t;return this.containRange(e)&&this.forEachGCP((function(r){return r.key===e&&(t=r.gcp,!0)})),t},t.prototype.deleteGCP=function(e){var t=this.getGCP(e);if(void 0===t)return!1;var r=!1,n=this.getFTTreeIterator(t),o=n.data();if(o)for(var i=0;i<o.length;i++){if(o[i]===e){o.splice(i,1),0===o.length&&this._floatTree.eraseFloat(n),this._keySet.delete(e),r=!0;break}}return r},t.prototype.findGCPs=function(){var e=[];return this.forEachGCP((function(t){return e.push(t),!1})),e},t.prototype.forEachGCP=function(e){for(var t=this._floatTree.begin();!t.equal(this._floatTree.end());t.next()){var r=this._floatTree.position(t).val,n=t.data();if(n)for(var o=0;o<n.length;o++){if(e({gcp:r,key:n[o]}))return}}},t}(vn);!function(e){e[e.Begin=0]="Begin",e[e.End=1]="End"}(ln||(ln={}));var Tn,_n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return k(t,e),t.prototype._eraseSpace=function(e){var t=this;this._floatTree.eraseSpace(e.begin(),e.length(),(function(r){var n=new Map,o=[],i=[];r.forEach((function(e){for(var r=e.data,a=0;a<r.length;a++){var s=r[a],p=s.key,l=n.get(p);l?(n.delete(p),t._needReservedWhenEraseSpace?o.push(l,s):t._eraseList&&i.push(p)):n.set(p,s)}})),n.forEach((function(e){o.push(e)}));var a=t._floatTree.findInner(e.begin()),s=a.data();s&&t._floatTree.position(a).val===e.begin()?s.push.apply(s,K(o)):t._floatTree.insertFloat(e.begin(),o),t._eraseList&&t._eraseList(i)}))},t.prototype.onEraseList=function(e){this._eraseList=e},t.prototype.containRange=function(e){return this._keySet.has(e)},t.prototype.insertRange=function(e,t){if(!t.isValid())return!1;if(this.getRange(e))return!1;var r={pointType:ln.Begin,key:e},n=[r],o=this._floatTree.findInner(t.begin()),i=o.data();i&&this._floatTree.position(o).val===t.begin()?i.push(r):this._floatTree.insertFloat(t.begin(),n);var a={pointType:ln.End,key:e};n=[a];var s=this._floatTree.findInner(t.end()),p=s.data();return p&&this._floatTree.position(s).val===t.end()?p.push(a):this._floatTree.insertFloat(t.end(),n),this._keySet.add(e),!0},t.prototype.getRange=function(e){var t;return this.containRange(e)&&this.forEachRange((function(r){return r.key[0]===e&&(t=r.range,!0)})),t},t.prototype.deleteRange=function(e){var t=this.getRange(e);return!!t&&(this._deletePoint(e,t.begin(),ln.Begin),this._deletePoint(e,t.end(),ln.End),this._keySet.delete(e),!0)},t.prototype.findRanges=function(e){void 0===e&&(e=!1);var t=[];return this.forEachRange((function(e){return t.push(e),!1}),e),t},t.prototype.forEachRange=function(e,t){void 0===t&&(t=!1);var r=this._floatTree.findInner(0);r.equal(this._floatTree.end())&&(r=this._floatTree.findOuter(0));var n,o=new Map,i=null,a=[];do{var s=r.data(),p=this._floatTree.position(r).val;if(s){for(var l=0;l<s.length;l++){var c=s[l],u={pointType:(n=c).pointType,key:n.key,pos:n.pos};u.pos=p;var h=u.key,f=o.get(h);if(f){var d=-1,g=-1;if(f.pointType===ln.Begin&&u.pointType===ln.End&&void 0!==f.pos?(d=f.pos,g=u.pos):u.pointType===ln.Begin&&f.pointType===ln.End&&void 0!==f.pos&&(d=u.pos,g=f.pos),d>=0&&g>=0){var y=new ne(d,g-d);if(t)i=i?i.unionRange(y):y,a.push(u.key);else if(e({range:y,key:[u.key]}))return}o.delete(h)}else o.set(h,u)}if(t&&0===o.size&&i){if(e({range:i,key:a}))return;i=null,a=[]}}r.next()}while(!r.equal(this._floatTree.end()))},t.prototype._deletePoint=function(e,t,r){var n=!1,o=this._floatTree.findInner(t),i=o.data();if(i)for(var a=0;a<i.length;a++){var s=i[a];if(s.key===e&&s.pointType===r){i.splice(a,1),0===i.length&&this._floatTree.eraseFloat(o),n=!0;break}}return n},t}(vn),Sn=function(){function e(){this._nextLayerTextStream=this}return Object.defineProperty(e.prototype,"_nextLayer",{get:function(){return this._nextLayerTextStream},enumerable:!0,configurable:!0}),e.prototype.insertLayerAfter=function(e){this._nextLayer!==e&&(this._nextLayerTextStream=e)},e.prototype.copyFrom=function(e){this._assertLayerError(this._nextLayer!==this),this._nextLayer.copyFrom(e._nextLayer)},e.prototype.garbageCollection=function(){this._assertLayerError(this._nextLayer!==this),this._nextLayer.garbageCollection()},e.prototype.createDataIterator=function(e){return this._assertLayerError(this._nextLayer!==this),this._nextLayer.createDataIterator(e)},e.prototype.createStoryIterator=function(e){return this._assertLayerError(this._nextLayer!==this),this._nextLayer.createStoryIterator(e)},e.prototype.createSectionIterator=function(e){return this._assertLayerError(this._nextLayer!==this),this._nextLayer.createSectionIterator(e)},e.prototype.createParagraphIterator=function(e){return this._assertLayerError(this._nextLayer!==this),this._nextLayer.createParagraphIterator(e)},e.prototype.createSpanIterator=function(e){return this._assertLayerError(this._nextLayer!==this),this._nextLayer.createSpanIterator(e)},e.prototype.getIndexFromGCP=function(e){return this._assertLayerError(this._nextLayer!==this),this._nextLayer.getIndexFromGCP(e)},e.prototype.getGCPFromIndex=function(e){return this._assertLayerError(this._nextLayer!==this),this._nextLayer.getGCPFromIndex(e)},e.prototype.getRangeFromIndex=function(e,t){return this._assertLayerError(this._nextLayer!==this),this._nextLayer.getRangeFromIndex(e,t)},e.prototype.getLength=function(){return this._assertLayerError(this._nextLayer!==this),this._nextLayer.getLength()},e.prototype.charAt=function(e){return this._assertLayerError(this._nextLayer!==this),this._nextLayer.charAt(e)},e.prototype.charCodeAt=function(e){return this._assertLayerError(this._nextLayer!==this),this._nextLayer.charCodeAt(e)},e.prototype.readText=function(e,t){return this._assertLayerError(this._nextLayer!==this),this._nextLayer.readText(e,t)},e.prototype.setStoryProp=function(e,t,r,n,o){return this._assertLayerError(this._nextLayer!==this),this._nextLayer.setStoryProp(e,t,r,n,o)},e.prototype.clearStoryProp=function(e,t,r,n){return this._assertLayerError(this._nextLayer!==this),this._nextLayer.clearStoryProp(e,t,r,n)},e.prototype.setSectionProp=function(e,t,r,n,o){return this._assertLayerError(this._nextLayer!==this),this._nextLayer.setSectionProp(e,t,r,n,o)},e.prototype.clearSectionProp=function(e,t,r,n){return this._assertLayerError(this._nextLayer!==this),this._nextLayer.clearSectionProp(e,t,r,n)},e.prototype.setParaProp=function(e,t,r,n,o){return this._assertLayerError(this._nextLayer!==this),this._nextLayer.setParaProp(e,t,r,n,o)},e.prototype.clearParaProp=function(e,t,r,n){return this._assertLayerError(this._nextLayer!==this),this._nextLayer.clearParaProp(e,t,r,n)},e.prototype.setTextProp=function(e,t,r,n,o){return this._assertLayerError(this._nextLayer!==this),this._nextLayer.setTextProp(e,t,r,n,o)},e.prototype.clearTextProp=function(e,t,r,n){return this._assertLayerError(this._nextLayer!==this),this._nextLayer.clearTextProp(e,t,r,n)},e.prototype.insertStoryBegin=function(e,t,r){return this._assertLayerError(this._nextLayer!==this),this._nextLayer.insertStoryBegin(e,t,r)},e.prototype.insertStoryEnd=function(e,t,r){return this._assertLayerError(this._nextLayer!==this),this._nextLayer.insertStoryEnd(e,t,r)},e.prototype.insertSection=function(e,t,r,n){return this._assertLayerError(this._nextLayer!==this),this._nextLayer.insertSection(e,t,r,n)},e.prototype.insertParagraph=function(e,t,r,n){return this._assertLayerError(this._nextLayer!==this),this._nextLayer.insertParagraph(e,t,r,n)},e.prototype.insertText=function(e,t,r,n){return this._assertLayerError(this._nextLayer!==this),this._nextLayer.insertText(e,t,r,n)},e.prototype.replaceText=function(e,t,r,n){return this._assertLayerError(this._nextLayer!==this),this._nextLayer.replaceText(e,t,r,n)},e.prototype.deleteText=function(e,t){return this._assertLayerError(this._nextLayer!==this),this._nextLayer.deleteText(e,t)},e.prototype.getNotificationCenter=function(){return this._assertLayerError(this._nextLayer!==this),this._nextLayer.getNotificationCenter()},Object.defineProperty(e.prototype,"tableStream",{get:function(){return this._assertLayerError(this._nextLayer!==this),this._nextLayer.tableStream},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rwTableStream",{get:function(){return this._assertLayerError(this._nextLayer!==this),this._nextLayer.rwTableStream},enumerable:!0,configurable:!0}),e.prototype.findStoryInfoFromId=function(e){return this._assertLayerError(this._nextLayer!==this),this._nextLayer.findStoryInfoFromId(e)},e.prototype.findStoryInfoFromGcp=function(e){return this._assertLayerError(this._nextLayer!==this),this._nextLayer.findStoryInfoFromGcp(e)},e.prototype._assertLayerError=function(e){if(!e)throw new Error("TextStream layer error")},e}(),Cn=function(){function e(e){void 0===e&&(e=""),this._lastIdx=0,this._endIdx=2048,this._originStr=e,this._poolPages=[],this._strPool=new Uint16Array(2048),this._poolPages.push(this._strPool)}return e.prototype.append=function(e){for(var t=this.size(),r=0;r<e.length;r++){var n=e.charCodeAt(r);this._strPool[this._lastIdx]=n,this._lastIdx+=1,this._lastIdx===this._endIdx&&this._appendPage()}return t},e.prototype.charAt=function(e){return e<0||e>=this.size()?"":String.fromCharCode(this.charCodeAt(e))},e.prototype.charCodeAt=function(e){if(e<0||e>=this.size())return-1;if(e<this._originStr.length)return this._originStr.charCodeAt(e);var t=e-this._originStr.length,r=Math.floor(t/2048),n=t%2048;return this._poolPages[r][n]},e.prototype.subText=function(e,t){if(t<1)return"";if(1===t)return this.charAt(e);var r="";if(e<0||e>=this.size())return r;var n=e,o=Math.min(t,this.size()-e);if(n<this._originStr.length){if(n+o<=this._originStr.length)return r=this._originStr.substr(n,o);var i=this._originStr.length-n;r=this._originStr.substr(n,i),o-=i,n=0}else n-=this._originStr.length;for(var a=Math.floor(n/2048),s=n%2048,p=this._poolPages[a];;){if(!(o>p.length-s)){l=p.subarray(s,s+o);r=r.concat(String.fromCharCode.apply(String,K(Array.from?Array.from(l):[].slice.call(l))));break}var l=p.subarray(s,p.length);r=r.concat(String.fromCharCode.apply(String,K(Array.from?Array.from(l):[].slice.call(l)))),o-=p.length-s,s=0,a+=1,p=this._poolPages[a]}return r},e.prototype.size=function(){return this._originStr.length+2048*(this._poolPages.length-1)+this._lastIdx},e.prototype.empty=function(){return this._originStr.length<=0&&this._poolPages.length<=1&&this._lastIdx<=0},e.prototype._appendPage=function(){this._strPool=new Uint16Array(2048),this._lastIdx=0,this._poolPages.push(this._strPool)},e}(),Bn=function(e){function t(t,r,n){var o=e.call(this)||this;if(o._textBuffer=t,o._mirrorTree=r,void 0!==n&&n>=0){var i=q(n),a=i.copy();if(o._node=o._mirrorTree.policy1().find(o._mirrorTree.header(),i,a),o._node){var s=o._mirrorTree.policy2().position(o._node);o._bp=Y.add(s,a),o._maxBP=Y.add(s,o._mirrorTree.policy2().len(o._node)),o._minBP=s}else o._node=o._mirrorTree.header(),o._bp=Z,o._maxBP=Z,o._minBP=Z}else o._node=o._mirrorTree.header(),o._bp=Z,o._maxBP=Z,o._minBP=Z;return o}return k(t,e),t.prototype.getCP=function(){return this._mirrorTree.backwardMapping(this._bp,Z).val},t.prototype.getBP=function(){return this._bp.val},t.prototype.copy=function(){return new t(this._textBuffer,this._mirrorTree,this.getCP())},t.prototype.data=function(){return this._textBuffer.charAt(this._bp.val)},t.prototype.next=function(){return this._bp.val+=1,Y.equal(this._bp,this._maxBP)&&(this._node=this._mirrorTree.policy1().next(this._node),this._node!==this._mirrorTree.header()?(this._bp=this._mirrorTree.policy2().position(this._node),this._maxBP=Y.add(this._bp,this._mirrorTree.policy2().len(this._node)),this._minBP=this._bp):(this._bp=Z,this._maxBP=Z,this._minBP=Z)),this},t.prototype.prev=function(){return Y.equal(this._bp,this._minBP)?(this._node=this._mirrorTree.policy1().prev(this._node),this._node!==this._mirrorTree.header()?(this._minBP=this._mirrorTree.policy2().position(this._node),this._maxBP=Y.add(this._minBP,this._mirrorTree.policy2().len(this._node)),this._bp=Y.minus(this._maxBP,q(1))):(this._bp=Z,this._maxBP=Z,this._minBP=Z)):this._bp.val-=1,this},t.prototype.equal=function(e){return this._node===e._node&&this._bp===e._bp},t}(H),Rn=function(){function e(e){void 0===e&&(e=""),this._textBuffer=new Cn(e),this._mirrorTree=new pe,this._mirrorTree.mapping(0,0,e.length),this._size=e.length}return e.prototype.append=function(e){var t=this._textBuffer.append(e),r=this.size();this._mirrorTree.mapping(r,t,e.length),this._setSize(this.size()+e.length)},e.prototype.insert=function(e,t){if(!(e>this.size())){var r=this._textBuffer.append(t);this._mirrorTree.insertSpace1(e,t.length),this._mirrorTree.mapping(e,r,t.length),this._setSize(this.size()+t.length)}},e.prototype.erase=function(e,t){if(!(e>this.size())){var r=t;e+t>this.size()&&(r=this.size()-e),this._mirrorTree.eraseSpace1(e,r),this._setSize(this.size()-r)}},e.prototype.size=function(){return this._size},e.prototype.empty=function(){return this._size<=0},e.prototype.charAt=function(e){return this._textBuffer.charAt(this.cp2bp(e))},e.prototype.charCodeAt=function(e){return this._textBuffer.charCodeAt(this.cp2bp(e))},e.prototype.subText=function(e,t){var r=this;if(t<1)return"";if(1===t)return this.charAt(e);var n=this._mirrorTree.forwardSpace(e,t,Z),o=[];return n.forEach((function(e){o.push(r._textBuffer.subText(e.begin(),e.length()))})),o.join("")},e.prototype.seek=function(e){return new Bn(this._textBuffer,this._mirrorTree,e)},e.prototype.end=function(){return new Bn(this._textBuffer,this._mirrorTree)},e.prototype.garbageCollection=function(){var e=this.subText(0,this.size());this._textBuffer=new Cn(e),this._mirrorTree=new pe,this._mirrorTree.mapping(0,0,e.length),this._size=e.length},e.prototype.cp2bp=function(e){return this._mirrorTree.forwardMapping(e,Z).val},e.prototype.bp2cp=function(e){return this._mirrorTree.backwardMapping(e,Z).val},e.prototype.iter2cp=function(e){return e.getCP()},e.prototype.iter2bp=function(e){return e.getBP()},e.prototype._setSize=function(e){return this._size=e,this._size},e}(),wn=function(){function e(){}return e.isEqualProp=function(e,t){return e&&t?e.equalTo(t):null===e&&null===t},e.isEqualPropBag=function(e,t){if(null===e&&null===t)return!0;if(e&&t&&e.propertyType&&e.propertyType===t.propertyType){var r=ue.getPropKeyList(e.propertyType);if(r)return e.equalTo(t,r.notCompareProps)}return!1},e.canMergeProp=function(t,r){return!(t instanceof Rt&&t.isSpecialChar)&&(!(r instanceof Rt&&r.isSpecialChar)&&e.isEqualProp(t,r))},e.canMergePropBag=function(t,r){return!(!(t&&t.propertyType&&r&&r.propertyType)||Bt(t.propertyType)||Bt(r.propertyType))&&e.isEqualPropBag(t,r)},e.isEqualStyleProperty=function(t,r){return t.styleType===r.styleType&&t.styleName===r.styleName&&t.baseOnStyle===r.baseOnStyle&&t.nextParaStyle===r.nextParaStyle&&e.isEqualProp(t.paraProperty,r.paraProperty)&&e.isEqualProp(t.spanProperty,r.spanProperty)&&t.builtinStyleType===r.builtinStyleType&&t.styleShowName===r.styleShowName},e}(),In=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return k(t,e),t.prototype.seek=function(t){return e.prototype.findOuter.call(this,t)},t.prototype.insertProp=function(e,t,r){return void 0===r&&(r=!1),t?this.split(e,t.getPropBag(r)):this.end()},t.prototype.split=function(t,r){return r?e.prototype.insertFloat.call(this,t,r):this.end()},t.prototype.merge=function(t){var r=t.copy();return e.prototype.eraseFloat.call(this,r.postNext()),r},t.prototype.extend=function(t,r){e.prototype.insertSpace.call(this,t,r)},t.prototype.shrink=function(t,r,n){var o=[];e.prototype.eraseSpace.call(this,t,r,(function(e){n&&e.forEach((function(e){var t=he.createProperty(e.data);t&&o.push({data:t})}))})),n&&n(o)},t.prototype.begin=function(){return e.prototype.begin.call(this)},t.prototype.end=function(){return e.prototype.end.call(this)},t.prototype.rbegin=function(){return e.prototype.rbegin.call(this)},t.prototype.range=function(t){var r=t.copy(),n=e.prototype.position.call(this,r).val,o=e.prototype.position.call(this,r.prev()).val;return new ne(o,n-o)},t.prototype.rangeBegin=function(t){var r=t.copy();return e.prototype.position.call(this,r.prev()).val},t.prototype.rangeEnd=function(t){return e.prototype.position.call(this,t).val},t.prototype.modifyProp=function(e,t,r){for(var n=this.seek(e);n.notEqual(this.end());){var o=this.range(n),i=r.execute(n.data());if(i&&!wn.isEqualPropBag(i,n.data())&&n.setData(i),o.end()>=e+t)break;n.next()}},t}(re),En=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return k(t,e),t}(In),Ln=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return k(t,e),t}(In),On=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return k(t,e),t}(In),Nn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return k(t,e),t.prototype.insertSpan=function(t,r,n){var o=this.seek(t);if(e.prototype.rangeBegin.call(this,o)===t){if(wn.canMergePropBag(n.getPropBag(!0),o.data()))return this.extend(t,r),o;var i=o.copy();return i.prev(),i.notEqual(this.end())&&wn.canMergePropBag(n.getPropBag(!0),i.data())?(this.extend(t-1,r),i):(this.extend(t,r),e.prototype.split.call(this,t+r,n.getPropBag()))}return wn.canMergePropBag(n.getPropBag(!0),o.data())?(this.extend(t,r),o):(e.prototype.split.call(this,t,o.data()),this.extend(t,r),e.prototype.split.call(this,t+r,n.getPropBag()))},t.prototype.modifyProp=function(t,r,n){for(var o=this.seek(t);o.notEqual(this.end());){var i=e.prototype.range.call(this,o),a=n.execute(o.data());if(a&&!wn.isEqualPropBag(a,o.data())&&(i.begin()<t&&e.prototype.split.call(this,t,o.data()),i.end()>t+r&&(o=e.prototype.split.call(this,t+r,o.data())),o.setData(a),t<=i.begin()&&0!==t)){var s=o.copy();s.prev(),wn.canMergePropBag(a,s.data())&&e.prototype.merge.call(this,s)}if(i.end()>=t+r){if(i.end()===t+r){var p=o.copy();p.next(),p.notEqual(this.end())&&wn.canMergePropBag(a,p.data())&&e.prototype.merge.call(this,o)}break}o.next()}},t.prototype.shrink=function(t,r){var n=this.seek(t);if(e.prototype.rangeBegin.call(this,n)!==t?n=e.prototype.split.call(this,t,n.data()):n.prev(),e.prototype.shrink.call(this,t,r),n.notEqual(this.end())){var o=n.copy();o.next(),o.notEqual(this.end())&&wn.canMergePropBag(n.data(),o.data())&&e.prototype.merge.call(this,n)}},t}(In);(Tn=e.IterPosFlag||(e.IterPosFlag={}))[Tn.Normal=0]="Normal",Tn[Tn.BOF=1]="BOF",Tn[Tn.EOF=2]="EOF";var kn,Mn=function(){function t(t,r){this._basePropList=t,this._limitRange=r,this._propIter=this._basePropList.seek(this._limitRange.begin()),this._gcpTick=this._limitRange.begin(),this._posFlag=e.IterPosFlag.Normal}return t.prototype.getCurrentGCP=function(){return this._gcpTick},t.prototype.seek=function(t){return this._gcpTick=Math.max(t,this._limitRange.begin()),this._gcpTick=Math.min(this._gcpTick,this._limitRange.end()),this._propIter=this._basePropList.seek(this._gcpTick),this._posFlag=e.IterPosFlag.Normal,!0},t.prototype.hasNext=function(){if(this._posFlag&e.IterPosFlag.EOF)return!1;var t=this._basePropList.range(this._propIter);return!!(t.isValid()&&t.begin()<this._limitRange.end()&&this._propIter.notEqual(this._basePropList.end()))},t.prototype.next=function(){var t=!0;if(this._posFlag&e.IterPosFlag.EOF)throw new Error(this.constructor+" next out of bounds.");this._propIter.next();var r=this._basePropList.range(this._propIter);return r.isValid()&&r.begin()<this._limitRange.end()&&this._propIter.notEqual(this._basePropList.end())&&(this._gcpTick=r.begin(),t=!1),t&&(this._posFlag|=e.IterPosFlag.EOF),!t},t.prototype.hasPrev=function(){if(this._posFlag&e.IterPosFlag.BOF)return!1;var t=this._basePropList.range(this._propIter);return!!(t.isValid()&&t.end()>this._limitRange.begin()&&this._propIter.notEqual(this._basePropList.end()))},t.prototype.prev=function(){var t=!0;if(this._posFlag&e.IterPosFlag.BOF)throw new Error(this.constructor+" prev out of bounds.");this._propIter.prev();var r=this._basePropList.range(this._propIter);return r.isValid()&&r.end()>this._limitRange.begin()&&this._propIter.notEqual(this._basePropList.end())&&(this._gcpTick=r.begin(),t=!1),t&&(this._posFlag|=e.IterPosFlag.BOF),!t},t.prototype.getContentRange=function(e){return void 0===e&&(e=!1),this.getRange(e)},t.prototype.getRange=function(t){if(void 0===t&&(t=!1),this._posFlag&e.IterPosFlag.EOF)return ne.emptyRange();var r=this._basePropList.range(this._propIter);return t&&(r=r.intersectRange(this._limitRange)),r},t.prototype.getProperty=function(e){void 0===e&&(e=!1);var t=this._propIter.data();return t&&!e&&(t=t.clone()),he.createProperty(t)},t.prototype.getLimitRange=function(){return this._limitRange.clone()},t.prototype.setLimitRange=function(e){this._limitRange.copyFrom(e),this.seek(e.begin())},t}();(kn=e.IterType||(e.IterType={}))[kn.Span=0]="Span",kn[kn.Paragraph=1]="Paragraph",kn[kn.Section=2]="Section";var Dn,Fn,An=function(){function t(t,r,n,o,i){this._sectPosFlag=e.IterPosFlag.Normal,this._paraPosFlag=e.IterPosFlag.Normal,this._spanPosFlag=e.IterPosFlag.Normal,this._textStream=t,this._sectTable=r,this._paraTable=n,this._spanTable=o,this._limitRange=i,this._paraIter=this._paraTable.seek(this._limitRange.begin()),this._spanIter=this._spanTable.seek(this._limitRange.begin()),this._sectIter=this._sectTable.seek(this._limitRange.begin()),this._gcpTick=this._limitRange.begin()}return t.prototype.seek=function(t){return this._gcpTick=Math.max(t,this._limitRange.begin()),this._gcpTick=Math.min(this._gcpTick,this._limitRange.end()),this._paraIter=this._paraTable.seek(this._gcpTick),this._spanIter=this._spanTable.seek(this._gcpTick),this._sectIter=this._sectTable.seek(this._gcpTick),this._sectPosFlag=e.IterPosFlag.Normal,this._paraPosFlag=e.IterPosFlag.Normal,this._spanPosFlag=e.IterPosFlag.Normal,!0},t.prototype.getCurrentGCP=function(){return this._gcpTick},t.prototype.getCurrentIndex=function(){return this._textStream.getIndexFromGCP(this._gcpTick)},t.prototype.hasNext=function(t){void 0===t&&(t=e.IterType.Span);var r=!1;switch(t){case e.IterType.Span:if(this._spanPosFlag&e.IterPosFlag.EOF)break;var n=this._spanTable.rangeBegin(this._spanIter);n>=0&&n<this._limitRange.end()&&this._spanIter.notEqual(this._spanTable.end())&&(r=!0);break;case e.IterType.Paragraph:if(this._paraPosFlag&e.IterPosFlag.EOF)break;var o=this._paraTable.rangeBegin(this._paraIter);o>=0&&o<this._limitRange.end()&&this._paraIter.notEqual(this._paraTable.end())&&(r=!0);break;case e.IterType.Section:if(this._sectPosFlag&e.IterPosFlag.EOF)break;var i=this._sectTable.rangeBegin(this._sectIter);i>=0&&i<this._limitRange.end()&&this._sectIter.notEqual(this._sectTable.end())&&(r=!0)}return r},t.prototype.next=function(t){void 0===t&&(t=e.IterType.Span);var r=!1;switch(t){case e.IterType.Span:if(this._spanPosFlag&e.IterPosFlag.EOF)throw new Error("DataIterator next span out of bounds.");var n=this._spanTable.rangeEnd(this._spanIter);if(n<this._limitRange.end()){if(this._spanIter.next(),this._spanIter.equal(this._spanTable.end())){this._spanPosFlag|=e.IterPosFlag.EOF,r=!0;break}n===this._paraTable.rangeEnd(this._paraIter)&&this._paraIter.next(),n===this._sectTable.rangeEnd(this._sectIter)&&this._sectIter.next(),this._gcpTick=n}else this._spanPosFlag|=e.IterPosFlag.EOF,r=!0;break;case e.IterType.Paragraph:if(this._paraPosFlag&e.IterPosFlag.EOF)throw new Error("DataIterator next paragraph out of bounds.");var o=this._paraTable.rangeEnd(this._paraIter);if(o<this._limitRange.end()){if(this._paraIter.next(),this._paraIter.equal(this._paraTable.end())){this._paraPosFlag|=e.IterPosFlag.EOF,r=!0;break}this._spanIter=this._spanTable.seek(o),o===this._sectTable.rangeEnd(this._sectIter)&&this._sectIter.next(),this._gcpTick=o}else this._paraPosFlag|=e.IterPosFlag.EOF,r=!0;break;case e.IterType.Section:if(this._sectPosFlag&e.IterPosFlag.EOF)throw new Error("DataIterator next section out of bounds.");var i=this._sectTable.rangeEnd(this._sectIter);if(i<this._limitRange.end()){if(this._sectIter.next(),this._sectIter.equal(this._sectTable.end())){this._sectPosFlag|=e.IterPosFlag.EOF,r=!0;break}this._paraIter=this._paraTable.seek(this._gcpTick),this._spanIter=this._spanTable.seek(this._gcpTick),this._gcpTick=i}else this._sectPosFlag|=e.IterPosFlag.EOF,r=!0}return!r},t.prototype.hasPrev=function(t){void 0===t&&(t=e.IterType.Span);var r=!1;switch(t){case e.IterType.Span:if(this._spanPosFlag&e.IterPosFlag.BOF)break;var n=this._spanTable.rangeEnd(this._spanIter);n>=0&&n>=this._limitRange.begin()&&this._spanIter.notEqual(this._spanTable.end())&&(r=!0);break;case e.IterType.Paragraph:if(this._paraPosFlag&e.IterPosFlag.BOF)break;var o=this._paraTable.rangeEnd(this._paraIter);o>=0&&o>=this._limitRange.begin()&&this._paraIter.notEqual(this._paraTable.end())&&(r=!0);break;case e.IterType.Section:if(this._sectPosFlag&e.IterPosFlag.BOF)break;var i=this._sectTable.rangeEnd(this._sectIter);i>=0&&i>=this._limitRange.begin()&&this._sectIter.notEqual(this._sectTable.end())&&(r=!0)}return r},t.prototype.prev=function(t){void 0===t&&(t=e.IterType.Span);var r=!1;switch(t){case e.IterType.Span:if(this._spanPosFlag&e.IterPosFlag.BOF)throw new Error("DataIterator prev span out of bounds.");var n=this._spanTable.rangeBegin(this._spanIter);if(n>this._limitRange.begin()){if(this._spanIter.prev(),this._spanIter.equal(this._spanTable.end())){this._spanPosFlag|=e.IterPosFlag.BOF,r=!0;break}n===this._paraTable.rangeBegin(this._paraIter)&&this._paraIter.prev(),n===this._sectTable.rangeBegin(this._sectIter)&&this._sectIter.prev(),this._gcpTick=this._spanTable.rangeBegin(this._spanIter)}else this._spanPosFlag|=e.IterPosFlag.BOF,r=!0;break;case e.IterType.Paragraph:if(this._paraPosFlag&e.IterPosFlag.BOF)throw new Error("DataIterator prev paragraph out of bounds.");var o=this._paraTable.rangeBegin(this._paraIter);if(o>this._limitRange.begin()){if(this._paraIter.prev(),this._paraIter.equal(this._paraTable.end())){this._paraPosFlag|=e.IterPosFlag.BOF,r=!0;break}o===this._sectTable.rangeBegin(this._sectIter)&&this._sectIter.prev(),this._gcpTick=this._paraTable.rangeBegin(this._paraIter),this._spanIter=this._spanTable.seek(this._gcpTick)}else this._paraPosFlag|=e.IterPosFlag.BOF,r=!0;break;case e.IterType.Section:if(this._sectPosFlag&e.IterPosFlag.BOF)throw new Error("DataIterator prev section out of bounds.");if(this._sectTable.rangeBegin(this._sectIter)>this._limitRange.begin()){if(this._sectIter.prev(),this._sectIter.equal(this._sectTable.end())){this._sectPosFlag|=e.IterPosFlag.BOF,r=!0;break}this._gcpTick=this._sectTable.rangeBegin(this._sectIter),this._paraIter=this._paraTable.seek(this._gcpTick),this._spanIter=this._spanTable.seek(this._gcpTick)}else this._sectPosFlag|=e.IterPosFlag.BOF,r=!0}return!r},t.prototype.getRange=function(t,r){void 0===t&&(t=e.IterType.Span),void 0===r&&(r=!1);var n=new ne(0,0);switch(t){case e.IterType.Span:if(this._spanPosFlag&e.IterPosFlag.EOF)break;n=this._spanTable.range(this._spanIter),r&&(n=n.intersectRange(this._limitRange));break;case e.IterType.Paragraph:if(this._paraPosFlag&e.IterPosFlag.EOF)break;n=this._paraTable.range(this._paraIter),r&&(n=n.intersectRange(this._limitRange));break;case e.IterType.Section:if(this._sectPosFlag&e.IterPosFlag.EOF)break;n=this._sectTable.range(this._sectIter),r&&(n=n.intersectRange(this._limitRange))}return n},t.prototype.getSpanProp=function(e){void 0===e&&(e=!1);var t=this._spanIter.data();return t&&!e&&(t=t.clone()),he.createProperty(t)},t.prototype.getParaProp=function(e){void 0===e&&(e=!1);var t=this._paraIter.data();return t&&!e&&(t=t.clone()),he.createProperty(t)},t.prototype.getSectProp=function(e){void 0===e&&(e=!1);var t=this._sectIter.data();return t&&!e&&(t=t.clone()),he.createProperty(t)},t.prototype.getLimitRange=function(){return this._limitRange.clone()},t.prototype.setLimitRange=function(t){if(t.contains(this._limitRange)){this._limitRange.copyFrom(t);var r=this._spanTable.range(this._spanIter);r.end()>t.end()&&(this._spanPosFlag&=~e.IterPosFlag.EOF),r.begin()<t.begin()&&(this._spanPosFlag&=~e.IterPosFlag.BOF);var n=this._paraTable.range(this._paraIter);n.end()>t.end()&&(this._paraPosFlag&=~e.IterPosFlag.EOF),n.begin()<t.begin()&&(this._paraPosFlag&=~e.IterPosFlag.BOF);var o=this._sectTable.range(this._sectIter);o.end()>t.end()&&(this._sectPosFlag&=~e.IterPosFlag.EOF),o.begin()<t.begin()&&(this._sectPosFlag&=~e.IterPosFlag.BOF)}else this._limitRange.copyFrom(t),this.seek(t.begin())},t}(),Kn=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n._moveToValidPos(),n}return k(t,e),t.prototype.seek=function(t){return e.prototype.seek.call(this,t),this._moveToValidPos(),!0},t.prototype.next=function(){var t=e.prototype.next.call(this);return t&&(t=this._moveToValidPos(t)),t},t.prototype.getContentRange=function(t){void 0===t&&(t=!1);var r=e.prototype.getRange.call(this);return r.len-=1,t&&(r=r.intersectRange(this._limitRange)),r},t.prototype.getRange=function(t){void 0===t&&(t=!1);var r=e.prototype.getRange.call(this);return r.begin()>0&&(r.gcpBegin-=1,r.len+=1),t&&(r=r.intersectRange(this._limitRange)),r},t.prototype._moveToValidPos=function(t){void 0===t&&(t=!1);var r=this.getProperty();return r&&!r.isStoryEnd?e.prototype.next.call(this):t},t.prototype.getLastStoryEndPos=function(){return this._basePropList.rangeEnd(this._basePropList.rbegin())},t}(Mn),Gn=function(){function e(e,t){this.row=e,this.col=t}return e.prototype.isEqual=function(e){return e===this||this.row===e.row&&this.col===e.col},e.prototype.isSouthEastOf=function(e){return this.row>=e.row&&this.col>=e.col},e.prototype.isNorthWestOf=function(e){return this.row<=e.row&&this.col<=e.col},e.prototype.isSouthWestOf=function(e){return this.row>=e.row&&this.col<=e.col},e.prototype.isNorthEastOf=function(e){return this.row<=e.row&&this.col>=e.col},e.prototype.toObject=function(){return{row:this.row,col:this.col}},e.prototype.clone=function(){var t=this.toObject();return new e(t.row,t.col)},e}();function Hn(e,t,r){var n=!0;if(t){for(var o=e.to.row;o>=e.from.row;o--)for(var i=e.to.col;i>=e.from.col;i--)if(!1===r(o,i,n=o===e.from.row&&i===e.from.col))return}else for(o=e.from.row;o<=e.to.row;o++)for(i=e.from.col;i<=e.to.col;i++){if(!1===r(o,i,n))return;n=!1}}function jn(e,t){for(var r=[],n=e.from,o=n.row,i=n.col,a=e.to,s=a.row,p=a.col,l=o;l<=s;l++){for(var c=[],u=i;u<=p;u++)c.push(t(l,u));r.push(c)}return r}function Un(e){return{from:e.from.clone(),to:e.to.clone()}}function zn(e,t){var r=e.from,n=r.row,o=r.col,i=e.to,a=i.row,s=i.col,p=t.from,l=p.row,c=p.col,u=t.to,h=u.row,f=u.col;return n===l&&o===c&&a===h&&s===f}function Wn(t,r){if(zn(t,r))return e.RangeRelation.Equal;var n=t.from,o=n.row,i=n.col,a=t.to,s=a.row,p=a.col,l=r.from,c=l.row,u=l.col,h=r.to,f=h.row,d=h.col;p+=1,d+=1,s+=1,f+=1;var g=Math.abs((o+s)/2-(c+f)/2),y=Math.abs((i+p)/2-(u+d)/2),m=Math.abs(o-s),b=Math.abs(c-f),P=Math.abs(i-p),v=Math.abs(u-d);return g<(m+b)/2&&y<(P+v)/2?g<=Math.abs(m-b)/2&&y<=Math.abs(P-v)/2&&(m>=b&&P>=v||m<=b&&P<=v)?e.RangeRelation.Contain:e.RangeRelation.Join:e.RangeRelation.Apart}function Vn(e,t){var r=e.from,n=r.row,o=r.col,i=e.to,a=i.row,s=i.col,p=t.from,l=p.row,c=p.col,u=t.to,h=u.row,f=u.col,d=Math.min(n,l),g=Math.max(a,h),y=Math.min(o,c),m=Math.max(s,f);return{from:new Gn(d,y),to:new Gn(g,m)}}function Yn(e,t,r){return t>=e.from.row&&t<=e.to.row&&r>=e.from.col&&r<=e.to.col}function qn(t,r,n){var o=r.clone(),i=[],a=n.getTableFullInfoFromTableInfo(t,r.begin()),s=n.getTableFullInfoFromTableInfo(t,r.end()-1);if(null===a||null===s)return{newRange:r};if(a.rowIndex===s.rowIndex&&a.cellIndex===s.cellIndex&&a.tableCellRange&&a.tableCellRange.notEqual(o))return o.begin()<a.tableCellRange.begin()+1&&(o.len-=a.tableCellRange.begin()+1-o.begin(),o.gcpBegin=a.tableCellRange.begin()+1),{newRange:o};var p=new Gn(a.rowIndex,Math.min(a.cellIndex,s.cellIndex)),l=new Gn(s.rowIndex,Math.min(Math.max(a.cellIndex,s.cellIndex),s.colCount-1)),c=a.tableProp.tableId,u=function(t,r){var n=t;return r.forEach((function(t){Wn(t,n)!==e.RangeRelation.Apart&&(n=Vn(t,n))})),n}({from:p,to:l},n.getMergeCellRanges(c)),h={tableId:c,cellRange:u},f=n.getTableCellInfo(c,u.from.row,u.from.col),d=n.getTableCellInfo(c,u.to.row,u.to.col),g=-1,y=-1;f&&d&&(g=f.range.begin(),y=d.range.end()),o.gcpBegin=g,o.len=y-g;var m=n.createTableRowIter(o);do{var b=m.getRange(),P=[],v=n.createTableCellIter(b,!0),x=0;do{if(x>=u.from.col&&x<=u.to.col){var T=v.getRange();P.push(T)}x+=1}while(v.hasNext()&&v.next());i.push(P)}while(m.hasNext()&&m.next());return{newRange:o,tableCellGCPRanges:i,tableCellRange:h}}(Dn=e.RangeNearType||(e.RangeNearType={}))[Dn.Top=0]="Top",Dn[Dn.Right=1]="Right",Dn[Dn.Bottom=2]="Bottom",Dn[Dn.Left=3]="Left",(Fn=e.RangeRelation||(e.RangeRelation={}))[Fn.Apart=0]="Apart",Fn[Fn.Join=1]="Join",Fn[Fn.Contain=2]="Contain",Fn[Fn.Equal=3]="Equal";var Xn=function(){function e(e){this._rwTableStream=e}return e.prototype.createTableIter=function(e){return this._rwTableStream.createTableIter(e)},e.prototype.createTableRowIter=function(e){return this._rwTableStream.createTableRowIter(e)},e.prototype.createTableCellIter=function(e,t){return this._rwTableStream.createTableCellIter(e,t)},e.prototype.createDataIterator=function(e){return this._rwTableStream.createDataIterator(e)},e.prototype.getTableInfo=function(e){return this._rwTableStream.getTableInfo(e)},e.prototype.getTableInfoFromGcp=function(e){return this._rwTableStream.getTableInfoFromGcp(e)},e.prototype.fixPlaceholderGCP=function(e){return this._rwTableStream.fixPlaceholderGCP(e)},e.prototype.getTableRowInfo=function(e,t){return this._rwTableStream.getTableRowInfo(e,t)},e.prototype.getTableRowInfoFromGcp=function(e){return this._rwTableStream.getTableRowInfoFromGcp(e)},e.prototype.getTableRowCountFromRange=function(e){return this._rwTableStream.getTableRowCountFromRange(e)},e.prototype.getTableCellInfo=function(e,t,r){return this._rwTableStream.getTableCellInfo(e,t,r)},e.prototype.getTableCellCountFromRange=function(e){return this._rwTableStream.getTableCellCountFromRange(e)},e.prototype.getTableCellInfoFromGcp=function(e){return this._rwTableStream.getTableCellInfoFromGcp(e)},e.prototype.getTableCellIndexFromGCP=function(e){return this._rwTableStream.getTableCellIndexFromGCP(e)},e.prototype.getTableRowColIndexFromGCP=function(e){return this._rwTableStream.getTableRowColIndexFromGCP(e)},e.prototype.getTableRowIndexFromGCP=function(e){return this._rwTableStream.getTableRowIndexFromGCP(e)},e.prototype.getValidCellInfoAtIndex=function(e,t){return this._rwTableStream.getValidCellInfoAtIndex(e,t)},e.prototype.getValidCellInfoInverseAtIndex=function(e,t){return this._rwTableStream.getValidCellInfoInverseAtIndex(e,t)},e.prototype.getTableFullInfoFromGcp=function(e){return this._rwTableStream.getTableFullInfoFromGcp(e)},e.prototype.getMergeCellRanges=function(e){return this._rwTableStream.getMergeCellRanges(e)},e.prototype.isSingleRange=function(e,t){return this._rwTableStream.isSingleRange(e,t)},e.prototype.isInSingleTable=function(e){return this._rwTableStream.isInSingle(e)},e.prototype.isCellMerged=function(e,t,r){return this._rwTableStream.isCellMerged(e,t,r)},e.prototype.isCellMergedFromGcp=function(e){return this._rwTableStream.isCellMergedFromGcp(e)},e.prototype.isCellRowSpanEndFromGcp=function(e){return this._rwTableStream.isCellRowSpanEndFromGcp(e)},e.prototype.isCelRowSpanEnd=function(e,t,r){return this._rwTableStream.isCelRowSpanEnd(e,t,r)},e.prototype.getTableFullInfoFromTableInfo=function(e,t){return this._rwTableStream.getTableFullInfoFromTableInfo(e,t)},e}();function Jn(e,t){var r=function(e,t){for(var r=t.createTableIter(),n=null,o=null;r.hasNext();){var i,a=r.getRange();if(a.contains(e.begin())||a.end()===e.begin())(i=r.getProperty(!0))&&i.tableId&&(n={property:i,range:a});if(a.contains(e.end()))(i=r.getProperty(!0))&&i.tableId&&(o={property:i,range:a});if(n&&o)break;r.next()}return{begin:n,end:o}}(t,e);if(0===t.length()){if(r.begin){var n=e.getTableCellInfoFromGcp(t.begin());return n&&n.deleteRange.begin()<=t.begin()&&n.deleteRange.end()>=t.begin()?{newRange:t}:{newRange:new ne(r.begin.range.begin()+2,0)}}return{newRange:t}}if(r.begin&&r.end&&r.begin.property.tableId===r.end.property.tableId)return qn(r.begin,t,e);var o=t.clone();if(r.begin){var i=r.begin.range.begin()-1;o.len+=o.begin()-i,o.gcpBegin=i}if(r.end){var a=r.end.range.end()+1;o.len+=a-o.end()}return{newRange:o}}var Zn,Qn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return k(t,e),t}(In),$n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return k(t,e),t}(In),eo=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return k(t,e),t}(In),to=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n._moveToValidPos(),n}return k(t,e),t.prototype.seek=function(t){return e.prototype.seek.call(this,t),this._moveToValidPos(),!0},t.prototype.next=function(){var t=e.prototype.next.call(this);return t&&(t=this._moveToValidPos(t)),t},t.prototype._moveToValidPos=function(t){void 0===t&&(t=!1);var r=this.getProperty(!0);return r&&r instanceof gt&&r.tableDepth<=0?e.prototype.next.call(this):t},t}(Mn),ro=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return k(t,e),t.prototype._moveToValidPos=function(t){void 0===t&&(t=!1);var r=this.getProperty(!0);return r&&0===r.tableId.length?e.prototype.next.call(this):t},t}(to),no=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return k(t,e),t.prototype.seek=function(t){return e.prototype.seek.call(this,t),this._moveToValidPos(),!0},t.prototype.getRange=function(t){void 0===t&&(t=!1);var r=e.prototype.getRange.call(this);return r.begin()>0&&(r.gcpBegin-=1,r.len+=1),t&&(r=r.intersectRange(this._limitRange)),r},t.prototype.next=function(){var t=e.prototype.next.call(this);return t&&(t=this._moveToValidPos(t)),t},t.prototype._moveToValidPos=function(t){void 0===t&&(t=!1);var r=this.getProperty(!0);return r&&r.isRowStart?e.prototype.next.call(this):t},t}(to),oo=function(e){function t(t,r,n){var o=e.call(this,t,r)||this;return o.filterRow=!1,o.filterRow=n,o._moveToValidPos(),o}return k(t,e),t.prototype.getRange=function(t){void 0===t&&(t=!1);var r=e.prototype.getRange.call(this,t),n=this.getProperty(!0);return!n||n instanceof sn||n.isCellStart||(r=ne.insetBoth(r,-1,0)),t&&(r=r.intersectRange(this._limitRange)),r},t.prototype.getContentRange=function(e){void 0===e&&(e=!1);var t=this.getRange();return t=ne.insetBoth(t,1,0),e&&(t=t.intersectRange(this._limitRange)),t},t.prototype.getDeleteRange=function(e){void 0===e&&(e=!1);var t=this.getRange();return t=ne.inset(t,1),e&&(t=t.intersectRange(this._limitRange)),t},t.prototype.seek=function(t){return e.prototype.seek.call(this,t),this._moveToValidPos(),!0},t.prototype.next=function(){var t=e.prototype.next.call(this);return t&&(t=this._moveToValidPos(t,!1)),t},t.prototype.prev=function(){var t=e.prototype.prev.call(this);return t&&(t=this._moveToValidPos(t,!0)),t},t.prototype._moveToValidPos=function(e,t){void 0===e&&(e=!1),void 0===t&&(t=!1);var r=this.getProperty(!0);return r&&r.isCellStart||this.filterRow&&r instanceof sn?t?this.prev():this.next():e},t}(to),io=function(){function t(e){this.mode=e}return t.prototype.execute=function(t){var r=this;if(!t)return null;var n=null,o=t.clone();if(this.mode===e.TDSetPropMode.Clear&&this.clearProps)n={clearedProps:o.clear(this.clearProps),modifiedProps:[]};else if(this.srcProp&&o.propertyType){var i=ue.getPropKeyList(o.propertyType);if(i){var a=this.srcProp.getPropBag(!0),s=i.propList;switch(this.mode){case e.TDSetPropMode.Merge:n={modifiedProps:o.merge(a,i.propList,i.notAllowedCopyProps),clearedProps:[]};break;case e.TDSetPropMode.Cover:if(a.propertyType){var p=ue.getPropKeyList(a.propertyType);p&&(s=i.propList.filter((function(e){return p.propList.includes(e)})))}n=o.cover(a,i.propList,i.notAllowedCopyProps,s);break;case e.TDSetPropMode.Clear:n={clearedProps:o.clear(a),modifiedProps:[]}}}}return n&&this.modifiedResult&&(n.modifiedProps.forEach((function(e){r.modifiedResult.modifiedProps.indexOf(e)<0&&r.modifiedResult.modifiedProps.push(e)})),n.clearedProps.forEach((function(e){r.modifiedResult.clearedProps.indexOf(e)<0&&r.modifiedResult.clearedProps.push(e)}))),o},t}(),ao=function(){function t(e){this._textStream=e,this._tablePropList=new Qn,this._tableRowPropList=new $n,this._tableCellPropList=new eo,this._mergeCells=new Map}return t.prototype.copyFrom=function(e){e instanceof t&&(this._textStream=e._textStream,this._tablePropList=e._tablePropList,this._tableRowPropList=e._tableRowPropList,this._tableCellPropList=e._tableCellPropList,this._mergeCells=e._mergeCells)},t.prototype.createTableIter=function(e){return new ro(this._tablePropList,this._validRange(e))},t.prototype.createTableRowIter=function(e){return new no(this._tableRowPropList,this._validRange(e))},t.prototype.createTableCellIter=function(e,t){return new oo(this._tableCellPropList,this._validRange(e),!!t)},t.prototype.createDataIterator=function(e){return this._textStream.createDataIterator(e)},t.prototype.startCreateTable=function(e){return this._tablePropList.insertProp(e,new qr,!0),this._tableRowPropList.insertProp(e,new $r,!0),this._tableCellPropList.insertProp(e,new an,!0),!0},t.prototype.endCreateTable=function(e,t){return this._tablePropList.insertProp(e,t),!0},t.prototype.insertRow=function(e,t){this._tableRowPropList.insertProp(e,t);var r=new sn;return r.tableDepth=1,this._tableCellPropList.insertProp(e,r,!0),this.clearMergeCellsForPos(e),!0},t.prototype.insertCell=function(e,t){return this._tableCellPropList.insertProp(e,t),this.clearMergeCellsForPos(e),!0},t.prototype.setTablePropFromGcp=function(e,t,r,n,o){var i=new io(n);return i.srcProp=r,i.modifiedResult=o,this._tablePropList.modifyProp(e,t,i),!0},t.prototype.setTableProp=function(e,t,r,n){var o=this.getTableInfo(e);return!!o&&(this.setTablePropFromGcp(o.range.begin(),o.range.length(),t,r,n),!0)},t.prototype.setTableRowPropFromGcp=function(e,t,r,n,o){var i=new io(n);return i.srcProp=r,i.modifiedResult=o,this._tableRowPropList.modifyProp(e,t,i),!0},t.prototype.setTableRowProp=function(e,t,r,n,o){var i=this.getTableRowInfo(e,t);return!!i&&(this.setTableRowPropFromGcp(i.range.begin(),i.range.length(),r,n,o),!0)},t.prototype.setTableCellPropFromGcp=function(e,t,r,n,o){var i=new io(n);return i.srcProp=r,i.modifiedResult=o,this._tableCellPropList.modifyProp(e,t,i),this.clearMergeCellsIfNeeded(e,r),!0},t.prototype.setTableCellProp=function(e,t,r,n,o,i){var a=this.getTableCellInfo(e,t,r);return!!a&&(this.setTableCellPropFromGcp(a.range.begin(),a.range.length(),n,o,i),!0)},t.prototype.extendRange=function(e,t){return this._tablePropList.extend(e,t),this._tableRowPropList.extend(e,t),this._tableCellPropList.extend(e,t),!0},t.prototype.shrinkRange=function(e,t){var r=this,n=this.getIntersectTableList(e,t);return this._tablePropList.shrink(e,t),this._tableRowPropList.shrink(e,t),this._tableCellPropList.shrink(e,t,(function(e){r.onEaraseCellNodeList(n,e)})),!0},t.prototype.onEaraseCellNodeList=function(e,t){var r=this;this.hasMergeInProps(t)&&e.forEach((function(e){r._mergeCells.delete(e)}))},t.prototype.getIntersectTableList=function(e,t){for(var r=new ro(this._tablePropList,new ne(0,Number.MAX_SAFE_INTEGER)),n=new ne(e,t),o=[];r.hasNext();){var i=r.getRange();if(i.isEmpty())break;if(i.intersect(n)){var a=r.getProperty(!0);a&&o.push(a.tableId)}r.next()}return o},t.prototype.hasMergeInProps=function(t){for(var r=0;r<t.length;r++)if(t[r].data.has(e.TableCellPropKey.rowSpan)||t[r].data.has(e.TableCellPropKey.colSpan))return!0;return!1},t.prototype.getMergeCellRanges=function(e){var t=this._mergeCells.get(e);if(t)return t;var r=this.getTableInfo(e),n=[];if(!r)return[];for(var o=this.createTableRowIter(r.range),i=this.getTableRowCountFromRange(r.range),a=0,s=0;o.hasNext();){var p=0,l=o.getRange();a=a||this.getTableCellCountFromRange(l);for(var c=this.createTableCellIter(l,!0);c.hasNext();){var u=c.getProperty(!0);u&&(u.rowSpan>1||u.colSpan>1)&&n.push({from:new Gn(s,p),to:new Gn(Math.min(i-1,s+u.rowSpan-1),Math.min(a-1,p+u.colSpan-1))}),p+=1,c.next()}s+=1,o.next()}return this._mergeCells.set(e,n),n},t.prototype.isSingleRange=function(e,t){var r=t.from,n=r.row,o=r.col,i=t.to,a=i.row,s=i.col;return n===a&&o===s||this.getMergeCellRanges(e).reduce((function(e,r){return e||zn(r,t)}),!1)},t.prototype.getTableInfo=function(e){for(var t=this.createTableIter();t.hasNext();){var r=t.getProperty(!0),n=t.getRange();if(n.isEmpty())return null;if(r&&r.tableId===e)return{property:r,range:n};t.next()}return null},t.prototype.getTableInfoFromGcp=function(e){var t=this.createTableIter();t.seek(e);var r=t.getRange();if(r.contains(e)){var n=t.getProperty(!0);if(n&&n.tableId)return{property:n,range:r}}return null},t.prototype.fixPlaceholderGCP=function(e){var t=this._textStream.createSpanIterator();t.seek(e);var r=t.getProperty(!0);return r instanceof At?e+1:r instanceof Kt?e-1:e},t.prototype.getTableRowInfo=function(e,t){var r=this.getTableInfo(e);if(r)for(var n=0,o=this.createTableRowIter(r.range);o.hasNext();){var i=o.getProperty(!0),a=o.getRange();if(i&&i.tableDepth&&n===t)return{property:i,range:a};n+=1,o.next()}return null},t.prototype.getTableRowInfoFromGcp=function(e){var t=this.createTableRowIter();t.seek(e);var r=t.getRange();if(r.contains(e)){var n=t.getProperty(!0);if(n&&n.tableDepth)return{property:n,range:r}}return null},t.prototype.getTableCellInfo=function(e,t,r){var n=this.getTableRowInfo(e,t);if(n)for(var o=0,i=this.createTableCellIter(n.range,!0);i.hasNext();){var a=i.getProperty(!0);if(a&&a.tableDepth&&o===r)return{property:a,range:i.getRange(),deleteRange:i.getDeleteRange()};o+=1,i.next()}return null},t.prototype.getTableCellInfoFromGcp=function(e){var t=this.createTableCellIter();t.seek(e);var r=t.getRange();if(r.contains(e)){var n=t.getProperty(!0);if(n&&n.tableDepth)return{property:n,range:r,deleteRange:t.getDeleteRange()}}return null},t.prototype.getTableFullInfoFromGcp=function(e){var t=this.getTableInfoFromGcp(e);return t?this._getTableFullInfoFromTableInfo(t,e):null},t.prototype.getTableFullInfoFromTableInfo=function(e,t){return this._getTableFullInfoFromTableInfo(e,t)},t.prototype._getTableFullInfoFromTableInfo=function(e,t){for(var r=0,n=-1,o=null,i=null,a=Math.max(Math.min(t,e.range.end()-1),e.range.begin()),s=this.createTableRowIter(e.range);s.hasNext();){var p=s.getProperty(!0),l=s.getRange();if(l.isEmpty())break;p&&p.tableDepth&&(r+=1,l.begin()<=a&&(n+=1,o=l,i=p)),s.next()}if(i&&o){for(var c=Math.max(Math.min(t,o.end()-1),o.begin()+1),u=0,h=-1,f=null,d=null,g=this.createTableCellIter(o,!0);g.hasNext();){var y=g.getProperty(!0),m=g.getRange();y&&y.tableDepth&&(u+=1,m.begin()<=c&&(h+=1,f=m,d=y)),g.next()}return{rowCount:r,colCount:u,tableProp:e.property,tableRange:e.range,tableRowProp:i,tableRowRange:o,tableCellProp:d,tableCellRange:f,rowIndex:n,cellIndex:h}}return null},t.prototype.getTableRowCountFromRange=function(e){for(var t=0,r=this.createTableRowIter(e);r.hasNext();){var n=r.getProperty(!0);if(n&&n.tableDepth&&(t+=1),r.getRange().isEmpty())return t;r.next()}return t},t.prototype.getTableCellCountFromRange=function(e){for(var t=0,r=this.createTableCellIter(e,!0);r.hasNext();){var n=r.getProperty(!0);n&&n.tableDepth&&(t+=1),r.next()}return t},t.prototype.getTableCellIndexFromGCP=function(e){var t=new ne(e,0),r=this.createTableRowIter(t).getRange();if(r.contains(e))for(var n=this.createTableCellIter(r,!0),o=0;n.hasNext();){if(n.getRange().contains(e))return o;o+=1,n.next()}return-1},t.prototype.getTableRowIndexFromGCP=function(e){var t=new ne(e,0),r=this.createTableIter(t).getRange();if(r.contains(e))for(var n=this.createTableRowIter(r),o=0;n.hasNext();){if(n.getRange().contains(e))return o;o+=1,n.next()}return-1},t.prototype.getTableRowColIndexFromGCP=function(e){var t=new ne(e,0),r=this.createTableIter(t),n=r.getProperty(!0),o=r.getRange();if(n&&o.contains(e))for(var i=this.createTableRowIter(o),a=0;i.hasNext();){if(i.getRange().contains(e))for(var s=this.createTableCellIter(i.getRange(),!0),p=0;s.hasNext();){if(s.getRange().contains(e))return{row:a,col:p,tableId:n.tableId};p+=1,s.next()}a+=1,i.next()}return{row:-1,col:-1,tableId:""}},t.prototype._validRange=function(e){var t=new ne(0,this._textStream.getLength());return e&&(t=e.intersectRange(t)),t},t.prototype._isValidCell=function(e){return!(e.isMerged||e instanceof sn||e.isCellStart)},t.prototype.getValidCellInfoAtIndex=function(e,t){var r=this.createTableCellIter(e);e&&r.seek(e.begin());for(var n=t||0,o=0;r.hasNext();){var i=r.getProperty(!0),a=r.getRange();if(!a.isEmpty()&&i&&this._isValidCell(i)){if(o===n)return{property:i,range:a,deleteRange:r.getDeleteRange()};o+=1}r.next()}return null},t.prototype.getValidCellInfoInverseAtIndex=function(e,t){var r=this.createTableCellIter(e);e&&r.seek(e.end());for(var n=t||0,o=0;r.hasPrev();){var i=r.getProperty(!0),a=r.getRange();if(!a.isEmpty()&&i&&this._isValidCell(i)){if(n===o)return{property:i,range:a,deleteRange:r.getDeleteRange()};o+=1}r.prev()}return null},t.prototype.isInSingle=function(e){var t=this.getTableInfoFromGcp(e.begin()),r=this.getTableInfoFromGcp(e.end());return!(!t||!r||t.property.tableId!==r.property.tableId)},t.prototype.clearMergeCellsIfNeeded=function(t,r){(r.has(e.TableCellPropKey.rowSpan)||r.has(e.TableCellPropKey.colSpan))&&this.clearMergeCellsForPos(t)},t.prototype.clearMergeCellsForPos=function(e){var t=this.getTableInfoFromGcp(e);t&&this._mergeCells.delete(t.property.tableId)},t.prototype.isCellMerged=function(e,t,r){for(var n=this.getMergeCellRanges(e),o=0;o<n.length;o++){var i=n[o];if(i.from.row===t&&i.from.col===r)return!1;if(Yn(i,t,r))return!0}return!1},t.prototype.isCelRowSpanEnd=function(e,t,r){for(var n=this.getMergeCellRanges(e),o=0;o<n.length;o++){var i=n[o];if(i.from.row===t&&i.from.col===r)return!1;if(Yn(i,t,r)&&i.to.row===t)return!0}return!1},t.prototype.isCellMergedFromGcp=function(e){var t=this.getTableRowColIndexFromGCP(e),r=t.row,n=t.col,o=t.tableId;return!!o&&this.isCellMerged(o,r,n)},t.prototype.isCellRowSpanEndFromGcp=function(e){var t=this.getTableRowColIndexFromGCP(e),r=t.row,n=t.col,o=t.tableId;return!!o&&this.isCelRowSpanEnd(o,r,n)},t}(),so=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return k(t,e),t.prototype.getContentRange=function(t){void 0===t&&(t=!1);var r=e.prototype.getRange.call(this);return r.len-=1,t&&(r=r.intersectRange(this._limitRange)),r},t}(Mn),po=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return k(t,e),t.prototype.getContentRange=function(t){void 0===t&&(t=!1);var r=e.prototype.getRange.call(this);return r.len-=1,t&&(r=r.intersectRange(this._limitRange)),r},t}(Mn),lo=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return k(t,e),t}(Mn),co=function(t){function r(e){var r=t.call(this)||this;return r._textPool=new Rn(e),r._storyPropList=new En,r._sectPropList=new Ln,r._paraPropList=new On,r._spanPropList=new Nn,r._rwTableStream=new ao(r),r._tableStream=new Xn(r._rwTableStream),r}return k(r,t),Object.defineProperty(r.prototype,"_nextLayer",{get:function(){return this},enumerable:!0,configurable:!0}),r.prototype.copyFrom=function(e){e instanceof r&&(this._textPool=e._textPool,this._storyPropList=e._storyPropList,this._sectPropList=e._sectPropList,this._paraPropList=e._paraPropList,this._spanPropList=e._spanPropList,this._rwTableStream.copyFrom(e._rwTableStream),this._tableStream=new Xn(this._rwTableStream))},r.prototype.garbageCollection=function(){this._textPool.garbageCollection()},r.prototype.createDataIterator=function(e){return new An(this,this._sectPropList,this._paraPropList,this._spanPropList,this._validRange(e))},r.prototype.createStoryIterator=function(e){return new Kn(this._storyPropList,this._validRange(e))},r.prototype.createSectionIterator=function(e){return new so(this._sectPropList,this._validRange(e))},r.prototype.createParagraphIterator=function(e){return new po(this._paraPropList,this._validRange(e))},r.prototype.createSpanIterator=function(e){return new lo(this._spanPropList,this._validRange(e))},r.prototype.getIndexFromGCP=function(e){return this._textPool.cp2bp(e)},r.prototype.getGCPFromIndex=function(e){return this._textPool.bp2cp(e)},r.prototype.getRangeFromIndex=function(e,t){var r=this._textPool.bp2cp(e),n=this._textPool.bp2cp(t)+1;return new ne(r,n-r)},r.prototype.getLength=function(){return this._textPool.size()-1},r.prototype.charAt=function(e){return this._textPool.charAt(e)},r.prototype.charCodeAt=function(e){return this._textPool.charCodeAt(e)},r.prototype.readText=function(e,t){return this._textPool.subText(e,t)},r.prototype.setStoryProp=function(e,t,r,n,o){var i=new io(n);return i.srcProp=r,i.modifiedResult=o,this._storyPropList.modifyProp(e,t,i),!0},r.prototype.clearStoryProp=function(t,r,n,o){var i=new io(e.TDSetPropMode.Clear);return i.clearProps=n,i.modifiedResult=o,this._storyPropList.modifyProp(t,r,i),!0},r.prototype.setSectionProp=function(e,t,r,n,o){var i=new io(n);return i.srcProp=r,i.modifiedResult=o,this._sectPropList.modifyProp(e,t,i),!0},r.prototype.clearSectionProp=function(t,r,n,o){var i=new io(e.TDSetPropMode.Clear);return i.clearProps=n,i.modifiedResult=o,this._sectPropList.modifyProp(t,r,i),!0},r.prototype.setParaProp=function(e,t,r,n,o){var i=new io(n);if(i.srcProp=r,i.modifiedResult=o,this._paraPropList.modifyProp(e,t,i),r instanceof an&&this._rwTableStream.setTableCellPropFromGcp(e,t,r,n,o),r instanceof qr){var a=this._rwTableStream.fixPlaceholderGCP(e);this._rwTableStream.setTablePropFromGcp(a,t,r,n,o)}return!0},r.prototype.clearParaProp=function(t,r,n,o){var i=new io(e.TDSetPropMode.Clear);return i.clearProps=n,i.modifiedResult=o,this._paraPropList.modifyProp(t,r,i),!0},r.prototype.setTextProp=function(e,t,r,n,o){var i=new io(n);return i.srcProp=r,i.modifiedResult=o,this._spanPropList.modifyProp(e,t,i),!0},r.prototype.clearTextProp=function(t,r,n,o){var i=new io(e.TDSetPropMode.Clear);return i.clearProps=n,i.modifiedResult=o,this._spanPropList.modifyProp(t,r,i),!0},r.prototype.insertStoryBegin=function(e,t,r){var n=0;r&&(this.insertText(e,1,r,new Et),this._sectPropList.insertProp(e+1,new lt,!0),this._paraPropList.insertProp(e+1,new gt,!0),n=1);var o=t.clone();return o.isStoryEnd=!1,this._storyPropList.insertProp(e+n,o),!0},r.prototype.insertStoryEnd=function(e,t,r){this.insertText(e,1,r,new Et);var n=t.clone();return n.isStoryEnd=!0,this._storyPropList.insertProp(e+1,n),this._sectPropList.insertProp(e+1,new lt,!0),this._paraPropList.insertProp(e+1,new gt,!0),!0},r.prototype.insertSection=function(e,t,r,n){return this.insertText(e,1,t,r),this._spanPropList.insertProp(e+1,r),this._paraPropList.insertProp(e+1,new gt,!0),this._sectPropList.insertProp(e+1,n),!0},r.prototype.insertParagraph=function(e,t,r,n){return this.insertText(e,1,t,r),this._spanPropList.insertProp(e+1,r),this._paraPropList.insertProp(e+1,n),r instanceof kt&&this._rwTableStream.insertRow(e+1,n),r instanceof Mt&&this._rwTableStream.insertRow(e+1,n),r instanceof Dt&&this._rwTableStream.insertCell(e+1,n),r instanceof Ft&&this._rwTableStream.insertCell(e+1,n),!0},r.prototype.insertText=function(e,t,r,n){return this._textPool.insert(e,r.substr(0,t)),this._spanPropList.insertSpan(e,t,n),this._paraPropList.extend(e,t),this._sectPropList.extend(e,t),this._storyPropList.extend(e,t),this._rwTableStream.extendRange(e,t),!0},r.prototype.replaceText=function(e,t,r,n){if(t&&this._textPool.erase(e,t),n&&this._textPool.insert(e,r.substr(0,n)),n<t){var o=e+n,i=t-n;this._paraPropList.shrink(o,i),this._spanPropList.shrink(o,i),this._sectPropList.shrink(o,i),this._storyPropList.shrink(o,i),this._rwTableStream.shrinkRange(o,i)}else if(t<n){o=e+t-1,i=n-t;this._paraPropList.extend(o,i),this._spanPropList.extend(o,i),this._sectPropList.extend(o,i),this._storyPropList.extend(o,i),this._rwTableStream.extendRange(o,i)}return!0},r.prototype.deleteText=function(e,t){return this._textPool.erase(e,t),this._paraPropList.shrink(e,t),this._spanPropList.shrink(e,t),this._sectPropList.shrink(e,t),this._storyPropList.shrink(e,t),this._rwTableStream.shrinkRange(e,t),!0},r.prototype.getNotificationCenter=function(){return null},Object.defineProperty(r.prototype,"tableStream",{get:function(){return this._tableStream},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"rwTableStream",{get:function(){return this._rwTableStream},enumerable:!0,configurable:!0}),r.prototype.findStoryInfoFromId=function(e){if(e.length<=0)return null;var t=this.createStoryIterator();do{var r=t.getProperty();if(r&&r.storyId===e)return{storyProp:r,range:t.getContentRange()}}while(t.next());return null},r.prototype.findStoryInfoFromGcp=function(e){var t=this.createStoryIterator();t.seek(e);var r=t.getProperty();return r?{storyProp:r,range:t.getContentRange()}:null},r.prototype._validRange=function(e){var t=new ne(0,this.getLength());return e&&(t=e.intersectRange(t)),t},r}(Sn);(Zn=e.PlaceholderCharCode||(e.PlaceholderCharCode={}))[Zn.Null=0]="Null",Zn[Zn.StoryBegin=2]="StoryBegin",Zn[Zn.StoryEnd=3]="StoryEnd",Zn[Zn.SectionBreak=15]="SectionBreak",Zn[Zn.ParagraphBreak=10]="ParagraphBreak",Zn[Zn.ParagraphReturn=13]="ParagraphReturn",Zn[Zn.LineBreak=11]="LineBreak",Zn[Zn.ColumnBreak=14]="ColumnBreak",Zn[Zn.PageBreak=12]="PageBreak",Zn[Zn.TableCellStart=28]="TableCellStart",Zn[Zn.TableCellBreak=7]="TableCellBreak",Zn[Zn.TableRowStart=18]="TableRowStart",Zn[Zn.TableRowBreak=6]="TableRowBreak",Zn[Zn.TableStart=16]="TableStart",Zn[Zn.TableEnd=17]="TableEnd",Zn[Zn.InlineAnchor=1]="InlineAnchor",Zn[Zn.FloatingAnchor=8]="FloatingAnchor",Zn[Zn.FieldBegin=19]="FieldBegin",Zn[Zn.FieldSep=20]="FieldSep",Zn[Zn.FieldEnd=21]="FieldEnd",Zn[Zn.Tab=9]="Tab",Zn[Zn.Space=32]="Space",Zn[Zn.FullWidthSpace=12288]="FullWidthSpace",Zn[Zn.ZeroSpace=0]="ZeroSpace",Zn[Zn.NonBreakSpace=160]="NonBreakSpace",Zn[Zn.NoWidthOptionalBreak=8204]="NoWidthOptionalBreak",Zn[Zn.NoWidthNoBreak=8205]="NoWidthNoBreak",Zn[Zn.OptionalHyphen=31]="OptionalHyphen",Zn[Zn.Image=42]="Image",Zn[Zn.Table=42]="Table",Zn[Zn.Splitline=42]="Splitline";var uo=function(){function t(){}return Object.defineProperty(t,"Null",{get:function(){return String.fromCharCode(e.PlaceholderCharCode.Null)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"StoryBegin",{get:function(){return String.fromCharCode(e.PlaceholderCharCode.StoryBegin)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"StoryEnd",{get:function(){return String.fromCharCode(e.PlaceholderCharCode.StoryEnd)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"SectionBreak",{get:function(){return String.fromCharCode(e.PlaceholderCharCode.SectionBreak)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ParagraphBreak",{get:function(){return String.fromCharCode(e.PlaceholderCharCode.ParagraphBreak)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ParagraphReturn",{get:function(){return String.fromCharCode(e.PlaceholderCharCode.ParagraphReturn)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"LineBreak",{get:function(){return String.fromCharCode(e.PlaceholderCharCode.LineBreak)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ColumnBreak",{get:function(){return String.fromCharCode(e.PlaceholderCharCode.ColumnBreak)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"PageBreak",{get:function(){return String.fromCharCode(e.PlaceholderCharCode.PageBreak)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"TableCellBreak",{get:function(){return String.fromCharCode(e.PlaceholderCharCode.TableCellBreak)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"TableCellStart",{get:function(){return String.fromCharCode(e.PlaceholderCharCode.TableCellStart)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"TableRowBreak",{get:function(){return String.fromCharCode(e.PlaceholderCharCode.TableRowBreak)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"TableRowStart",{get:function(){return String.fromCharCode(e.PlaceholderCharCode.TableRowStart)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"TableStart",{get:function(){return String.fromCharCode(e.PlaceholderCharCode.TableStart)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"TableEnd",{get:function(){return String.fromCharCode(e.PlaceholderCharCode.TableEnd)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"InlineAnchor",{get:function(){return String.fromCharCode(e.PlaceholderCharCode.InlineAnchor)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"FloatingAnchor",{get:function(){return String.fromCharCode(e.PlaceholderCharCode.FloatingAnchor)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"FieldBegin",{get:function(){return String.fromCharCode(e.PlaceholderCharCode.FieldBegin)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"FieldSep",{get:function(){return String.fromCharCode(e.PlaceholderCharCode.FieldSep)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"FieldEnd",{get:function(){return String.fromCharCode(e.PlaceholderCharCode.FieldEnd)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"Tab",{get:function(){return String.fromCharCode(e.PlaceholderCharCode.Tab)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"Space",{get:function(){return String.fromCharCode(e.PlaceholderCharCode.Space)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"FullWidthSpace",{get:function(){return String.fromCharCode(e.PlaceholderCharCode.FullWidthSpace)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ZeroSpace",{get:function(){return String.fromCharCode(e.PlaceholderCharCode.ZeroSpace)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"NonBreakSpace",{get:function(){return String.fromCharCode(e.PlaceholderCharCode.NonBreakSpace)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"NoWidthOptionalBreak",{get:function(){return String.fromCharCode(e.PlaceholderCharCode.NoWidthOptionalBreak)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"NoWidthNoBreak",{get:function(){return String.fromCharCode(e.PlaceholderCharCode.NoWidthNoBreak)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OptionalHyphen",{get:function(){return String.fromCharCode(e.PlaceholderCharCode.OptionalHyphen)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"Image",{get:function(){return String.fromCharCode(e.PlaceholderCharCode.Image)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"Table",{get:function(){return String.fromCharCode(e.PlaceholderCharCode.Table)},enumerable:!0,configurable:!0}),Object.defineProperty(t,"Splitline",{get:function(){return String.fromCharCode(e.PlaceholderCharCode.Splitline)},enumerable:!0,configurable:!0}),t}();function ho(t){return t===e.PlaceholderCharCode.ParagraphBreak||t===e.PlaceholderCharCode.LineBreak||t===e.PlaceholderCharCode.TableCellBreak}function fo(e){return go(e)||yo(e)}function go(t){return t===e.PlaceholderCharCode.SectionBreak}function yo(t){return t===e.PlaceholderCharCode.PageBreak}function mo(t){return t===e.PlaceholderCharCode.Tab}var bo,Po=function(t){function r(){var e=t.call(this)||this;return e._notificationCenter=new Pn,e}return k(r,t),r.prototype.setStoryProp=function(e,t,r,n,o){var i=this._nextLayer.setStoryProp(e,t,r,n,o);return this._notificationCenter.fire(new hn(new ne(e,t),r,o)),i},r.prototype.clearStoryProp=function(e,t,r,n){var o=this._nextLayer.clearStoryProp(e,t,r,n);return this._notificationCenter.fire(new hn(new ne(e,t),null,n)),o},r.prototype.setSectionProp=function(e,t,r,n,o){var i=this._nextLayer.setSectionProp(e,t,r,n,o);return this._notificationCenter.fire(new fn(new ne(e,t),r,o)),i},r.prototype.clearSectionProp=function(e,t,r,n){var o=this._nextLayer.clearSectionProp(e,t,r,n);return this._notificationCenter.fire(new fn(new ne(e,t),null,n)),o},r.prototype.setParaProp=function(e,t,r,n,o){var i=this._nextLayer.setParaProp(e,t,r,n,o);return this._notificationCenter.fire(new dn(new ne(e,t),r,o)),i},r.prototype.clearParaProp=function(e,t,r,n){var o=this._nextLayer.clearParaProp(e,t,r,n);return this._notificationCenter.fire(new dn(new ne(e,t),null,n)),o},r.prototype.setTextProp=function(e,t,r,n,o){var i=this._nextLayer.setTextProp(e,t,r,n,o);return this._notificationCenter.fire(new gn(new ne(e,t),r,o)),i},r.prototype.clearTextProp=function(e,t,r,n){var o=this._nextLayer.clearTextProp(e,t,r,n);return this._notificationCenter.fire(new gn(new ne(e,t),null,n)),o},r.prototype.insertStoryBegin=function(t,r,n){var o=this._nextLayer.insertStoryBegin(t,r,n);return n&&this._notificationCenter.fire(new cn(new ne(t,1),e.DataInsertType.StoryBegin,r,n)),o},r.prototype.insertStoryEnd=function(t,r,n){var o=this._nextLayer.insertStoryEnd(t,r,n);return this._notificationCenter.fire(new cn(new ne(t,1),e.DataInsertType.StoryEnd,r,n)),o},r.prototype.insertSection=function(t,r,n,o){var i=this._nextLayer.insertSection(t,r,n,o);return this._notificationCenter.fire(new cn(new ne(t,1),e.DataInsertType.Section,o,r)),i},r.prototype.insertParagraph=function(t,r,n,o){var i=this._nextLayer.insertParagraph(t,r,n,o);return this._notificationCenter.fire(new cn(new ne(t,1),e.DataInsertType.Paragraph,o,r)),i},r.prototype.insertText=function(t,r,n,o){var i=this._nextLayer.insertText(t,r,n,o);return this._notificationCenter.fire(new cn(new ne(t,r),e.DataInsertType.Text,o,n)),i},r.prototype.deleteText=function(e,t){var r=this._nextLayer.deleteText(e,t);return this._notificationCenter.fire(new un(new ne(e,t))),r},r.prototype.getNotificationCenter=function(){return this._notificationCenter},r}(Sn);(bo=e.TextStreamLayerFlags||(e.TextStreamLayerFlags={}))[bo.None=0]="None",bo[bo.Notify=1]="Notify",bo[bo.Max=4294967295]="Max";var vo,xo,To=function(t){function r(r){void 0===r&&(r=e.TextStreamLayerFlags.None);var n=t.call(this)||this;return n._insertLayerAfter(new co(uo.Null)),r&e.TextStreamLayerFlags.Notify&&n._insertLayerAfter(new Po),n}return k(r,t),r.prototype.charAt=function(e){return this._checkValidityGCP(e)?this._nextLayer.charAt(e):""},r.prototype.charCodeAt=function(e){return this._checkValidityGCP(e)?this._nextLayer.charCodeAt(e):0},r.prototype.readText=function(e,t){if(!this._checkValidityGCP(e))return"";var r=this._constraintToValidityLength(e,t);return this._nextLayer.readText(e,r)},r.prototype.setStoryProp=function(e,t,r,n,o){if(!this._checkValidityGCP(e))return!1;this._assertPropTypeError(r instanceof Vt);var i=this._constraintToValidityLength(e,t);return this._nextLayer.setStoryProp(e,i,r,n,o)},r.prototype.clearStoryProp=function(e,t,r,n){if(!this._checkValidityGCP(e))return!1;var o=this._constraintToValidityLength(e,t);return this._nextLayer.clearStoryProp(e,o,r,n)},r.prototype.setSectionProp=function(e,t,r,n,o){if(!this._checkValidityGCP(e))return!1;this._assertPropTypeError(r instanceof lt);var i=this._constraintToValidityLength(e,t);return this._nextLayer.setSectionProp(e,i,r,n,o)},r.prototype.clearSectionProp=function(e,t,r,n){if(!this._checkValidityGCP(e))return!1;var o=this._constraintToValidityLength(e,t);return this._nextLayer.clearSectionProp(e,o,r,n)},r.prototype.setParaProp=function(e,t,r,n,o){if(!this._checkValidityGCP(e))return!1;this._assertPropTypeError(r instanceof gt);var i=this._constraintToValidityLength(e,t);return this._nextLayer.setParaProp(e,i,r,n,o)},r.prototype.clearParaProp=function(e,t,r,n){if(!this._checkValidityGCP(e))return!1;var o=this._constraintToValidityLength(e,t);return this._nextLayer.clearParaProp(e,o,r,n)},r.prototype.setTextProp=function(e,t,r,n,o){if(!this._checkValidityGCP(e))return!1;this._assertPropTypeError(r instanceof Rt);var i=this._constraintToValidityLength(e,t);return this._nextLayer.setTextProp(e,i,r,n,o)},r.prototype.clearTextProp=function(e,t,r,n){if(!this._checkValidityGCP(e))return!1;var o=this._constraintToValidityLength(e,t);return this._nextLayer.clearTextProp(e,o,r,n)},r.prototype.insertStoryBegin=function(e,t,r){return!!this._checkValidityGCP(e)&&(this._assertPropTypeError(t instanceof Vt),this._nextLayer.insertStoryBegin(e,t,r))},r.prototype.insertStoryEnd=function(e,t,r){return!!this._checkValidityGCP(e)&&(this._assertPropTypeError(t instanceof Vt),this._nextLayer.insertStoryEnd(e,t,r))},r.prototype.insertSection=function(e,t,r,n){return!!this._checkValidityGCP(e)&&(this._assertPropTypeError(r instanceof Lt),this._assertPropTypeError(n instanceof lt),this._nextLayer.insertSection(e,t,r,n))},r.prototype.insertParagraph=function(e,t,r,n){return!!this._checkValidityGCP(e)&&(this._assertPropTypeError(r instanceof Nt),this._assertPropTypeError(n instanceof gt),this._nextLayer.insertParagraph(e,t,r,n))},r.prototype.insertText=function(e,t,r,n){return!!this._checkValidityGCP(e)&&(this._assertPropTypeError(n instanceof Rt),this._nextLayer.insertText(e,t,r,n))},r.prototype.deleteText=function(e,t){if(!this._checkValidityGCP(e))return!1;var r=this._constraintToValidityLength(e,t);return this._nextLayer.deleteText(e,r)},r.prototype.getNotificationCenter=function(){return this._nextLayer.getNotificationCenter()},Object.defineProperty(r.prototype,"tableStream",{get:function(){return this._nextLayer.tableStream},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"rwTableStream",{get:function(){return this._nextLayer.rwTableStream},enumerable:!0,configurable:!0}),r.prototype.getMainStoryInfo=function(){return this._nextLayer.findStoryInfoFromId(e.StoryID.MainDocId)},r.prototype.findStoryInfoFromId=function(e){return this._nextLayer.findStoryInfoFromId(e)},r.prototype.findStoryInfoFromGcp=function(e){return this._nextLayer.findStoryInfoFromGcp(e)},r.prototype._insertLayerAfter=function(e){e&&e.insertLayerAfter(this._nextLayer),this._nextLayerTextStream=e},r.prototype._checkValidityGCP=function(e){return e>=0&&e<=this.getLength()},r.prototype._constraintToValidityLength=function(e,t){return Math.min(t,this.getLength()-e)},r.prototype._assertPropTypeError=function(e){if(!e)throw new Error("property type error")},r}(Sn),_o=function(){function t(){this._lastVersionLimit=7,this._defatultStyleSheet=[{styleType:e.StyleType.Paragraph,styleName:e.BuiltinStyleName.Normal,baseOnStyle:"",nextParaStyle:"",paraProperty:this.getParaProp(e.BuiltinStyleType.Normal),spanProperty:this.getSpanProp(e.BuiltinStyleType.Normal),builtinStyleType:e.BuiltinStyleType.Normal,styleShowName:""},{styleType:e.StyleType.Paragraph,styleName:e.BuiltinStyleName.Heading1,baseOnStyle:e.BuiltinStyleName.Normal,nextParaStyle:e.BuiltinStyleName.Normal,paraProperty:this.getParaProp(e.BuiltinStyleType.Heading1),spanProperty:this.getSpanProp(e.BuiltinStyleType.Heading1),builtinStyleType:e.BuiltinStyleType.Heading1,styleShowName:" 1"},{styleType:e.StyleType.Paragraph,styleName:e.BuiltinStyleName.Heading2,baseOnStyle:e.BuiltinStyleName.Normal,nextParaStyle:e.BuiltinStyleName.Normal,paraProperty:this.getParaProp(e.BuiltinStyleType.Heading2),spanProperty:this.getSpanProp(e.BuiltinStyleType.Heading2),builtinStyleType:e.BuiltinStyleType.Heading2,styleShowName:" 2"},{styleType:e.StyleType.Paragraph,styleName:e.BuiltinStyleName.Heading3,baseOnStyle:e.BuiltinStyleName.Normal,nextParaStyle:e.BuiltinStyleName.Normal,paraProperty:this.getParaProp(e.BuiltinStyleType.Heading3),spanProperty:this.getSpanProp(e.BuiltinStyleType.Heading3),builtinStyleType:e.BuiltinStyleType.Heading3,styleShowName:" 3"},{styleType:e.StyleType.Paragraph,styleName:e.BuiltinStyleName.Heading4,baseOnStyle:e.BuiltinStyleName.Normal,nextParaStyle:e.BuiltinStyleName.Normal,paraProperty:this.getParaProp(e.BuiltinStyleType.Heading4),spanProperty:this.getSpanProp(e.BuiltinStyleType.Heading4),builtinStyleType:e.BuiltinStyleType.Heading4,styleShowName:" 4"},{styleType:e.StyleType.Paragraph,styleName:e.BuiltinStyleName.Heading5,baseOnStyle:e.BuiltinStyleName.Normal,nextParaStyle:e.BuiltinStyleName.Normal,paraProperty:this.getParaProp(e.BuiltinStyleType.Heading5),spanProperty:this.getSpanProp(e.BuiltinStyleType.Heading5),builtinStyleType:e.BuiltinStyleType.Heading5,styleShowName:" 5"},{styleType:e.StyleType.Paragraph,styleName:e.BuiltinStyleName.Heading6,baseOnStyle:e.BuiltinStyleName.Normal,nextParaStyle:e.BuiltinStyleName.Normal,paraProperty:this.getParaProp(e.BuiltinStyleType.Heading6),spanProperty:this.getSpanProp(e.BuiltinStyleType.Heading6),builtinStyleType:e.BuiltinStyleType.Heading6,styleShowName:" 6"},{styleType:e.StyleType.Paragraph,styleName:e.BuiltinStyleName.Heading7,baseOnStyle:e.BuiltinStyleName.Normal,nextParaStyle:e.BuiltinStyleName.Normal,paraProperty:this.getParaProp(e.BuiltinStyleType.Heading7),spanProperty:this.getSpanProp(e.BuiltinStyleType.Heading7),builtinStyleType:e.BuiltinStyleType.Heading7,styleShowName:" 7"},{styleType:e.StyleType.Paragraph,styleName:e.BuiltinStyleName.Heading8,baseOnStyle:e.BuiltinStyleName.Normal,nextParaStyle:e.BuiltinStyleName.Normal,paraProperty:this.getParaProp(e.BuiltinStyleType.Heading8),spanProperty:this.getSpanProp(e.BuiltinStyleType.Heading8),builtinStyleType:e.BuiltinStyleType.Heading8,styleShowName:" 8"},{styleType:e.StyleType.Paragraph,styleName:e.BuiltinStyleName.Heading9,baseOnStyle:e.BuiltinStyleName.Normal,nextParaStyle:e.BuiltinStyleName.Normal,paraProperty:this.getParaProp(e.BuiltinStyleType.Heading9),spanProperty:this.getSpanProp(e.BuiltinStyleType.Heading9),builtinStyleType:e.BuiltinStyleType.Heading9,styleShowName:" 9"},{styleType:e.StyleType.Paragraph,styleName:e.BuiltinStyleName.Title,baseOnStyle:e.BuiltinStyleName.Normal,nextParaStyle:e.BuiltinStyleName.Normal,paraProperty:this.getParaProp(e.BuiltinStyleType.Title),spanProperty:this.getSpanProp(e.BuiltinStyleType.Title),builtinStyleType:e.BuiltinStyleType.Title,styleShowName:""},{styleType:e.StyleType.Paragraph,styleName:e.BuiltinStyleName.Subtitle,baseOnStyle:e.BuiltinStyleName.Normal,nextParaStyle:e.BuiltinStyleName.Normal,paraProperty:this.getParaProp(e.BuiltinStyleType.Subtitle),spanProperty:this.getSpanProp(e.BuiltinStyleType.Subtitle),builtinStyleType:e.BuiltinStyleType.Subtitle,styleShowName:""},{styleType:e.StyleType.Paragraph,styleName:e.BuiltinStyleName.Comments,baseOnStyle:e.BuiltinStyleName.Normal,nextParaStyle:e.BuiltinStyleName.Comments,paraProperty:this.getParaProp(e.BuiltinStyleType.Comments),spanProperty:this.getSpanProp(e.BuiltinStyleType.Comments),builtinStyleType:e.BuiltinStyleType.Comments,styleShowName:""}]}return t.prototype.getDefaultStyleSheet=function(){return this._defatultStyleSheet||[]},t.prototype.getParaProp=function(e){var t=ot.curDocDataVersion,r=ot.newDefaultStyleVersion;return t<this._lastVersionLimit?this.getParaPropBeforeVer7(e):t<r?this.getParaPropNew(e):this.getParaPropVer8(e)},t.prototype.getParaPropVer8=function(t){var n=new gt;switch(t!==e.BuiltinStyleType.Normal&&(n.lineSpacing=1.7,n.spaceBefore=r.ptToTwips(0),n.spaceAfter=r.ptToTwips(0)),t){case e.BuiltinStyleType.Normal:break;case e.BuiltinStyleType.Heading1:n.outlineLevel=e.OutlineLevel.Level1;break;case e.BuiltinStyleType.Heading2:n.outlineLevel=e.OutlineLevel.Level2;break;case e.BuiltinStyleType.Heading3:n.outlineLevel=e.OutlineLevel.Level3;break;case e.BuiltinStyleType.Heading4:n.outlineLevel=e.OutlineLevel.Level4;break;case e.BuiltinStyleType.Heading5:n.outlineLevel=e.OutlineLevel.Level5;break;case e.BuiltinStyleType.Heading6:n.outlineLevel=e.OutlineLevel.Level6;break;case e.BuiltinStyleType.Heading7:n.outlineLevel=e.OutlineLevel.Level7,n.lineSpacing=1.33,n.spaceBefore=r.ptToTwips(12),n.spaceAfter=r.ptToTwips(3.2);break;case e.BuiltinStyleType.Heading8:n.outlineLevel=e.OutlineLevel.Level8,n.lineSpacing=1.33,n.spaceBefore=r.ptToTwips(12),n.spaceAfter=r.ptToTwips(3.2);break;case e.BuiltinStyleType.Heading9:n.outlineLevel=e.OutlineLevel.Level9,n.lineSpacing=1.33,n.spaceBefore=r.ptToTwips(12),n.spaceAfter=r.ptToTwips(3.2);break;case e.BuiltinStyleType.Title:n.outlineLevel=e.OutlineLevel.Level1,n.textAlignment=e.TextAlignmentType.Center;break;case e.BuiltinStyleType.Subtitle:n.outlineLevel=e.OutlineLevel.Level2,n.textAlignment=e.TextAlignmentType.Center;break;case e.BuiltinStyleType.Comments:}return n},t.prototype.getParaPropNew=function(t){var n=new gt;switch(t!==e.BuiltinStyleType.Normal&&(n.lineSpacing=1.7,n.spaceBefore=r.ptToTwips(20),n.spaceAfter=r.ptToTwips(4)),t){case e.BuiltinStyleType.Normal:break;case e.BuiltinStyleType.Heading1:n.outlineLevel=e.OutlineLevel.Level1;break;case e.BuiltinStyleType.Heading2:n.outlineLevel=e.OutlineLevel.Level2;break;case e.BuiltinStyleType.Heading3:n.outlineLevel=e.OutlineLevel.Level3;break;case e.BuiltinStyleType.Heading4:n.outlineLevel=e.OutlineLevel.Level4;break;case e.BuiltinStyleType.Heading5:n.outlineLevel=e.OutlineLevel.Level5;break;case e.BuiltinStyleType.Heading6:n.outlineLevel=e.OutlineLevel.Level6;break;case e.BuiltinStyleType.Heading7:n.outlineLevel=e.OutlineLevel.Level7,n.lineSpacing=1.33,n.spaceBefore=r.ptToTwips(12),n.spaceAfter=r.ptToTwips(3.2);break;case e.BuiltinStyleType.Heading8:n.outlineLevel=e.OutlineLevel.Level8,n.lineSpacing=1.33,n.spaceBefore=r.ptToTwips(12),n.spaceAfter=r.ptToTwips(3.2);break;case e.BuiltinStyleType.Heading9:n.outlineLevel=e.OutlineLevel.Level9,n.lineSpacing=1.33,n.spaceBefore=r.ptToTwips(12),n.spaceAfter=r.ptToTwips(3.2);break;case e.BuiltinStyleType.Title:n.outlineLevel=e.OutlineLevel.Level1,n.textAlignment=e.TextAlignmentType.Center,n.spaceBefore=r.ptToTwips(16),n.spaceAfter=r.ptToTwips(4);break;case e.BuiltinStyleType.Subtitle:n.outlineLevel=e.OutlineLevel.Level2,n.textAlignment=e.TextAlignmentType.Center,n.spaceBefore=r.ptToTwips(16),n.spaceAfter=r.ptToTwips(2);break;case e.BuiltinStyleType.Comments:}return n},t.prototype.getParaPropBeforeVer7=function(t){var n=new gt;switch(t){case e.BuiltinStyleType.Normal:break;case e.BuiltinStyleType.Heading1:n.outlineLevel=e.OutlineLevel.Level1,n.lineSpacing=1.7,n.spaceBefore=r.ptToTwips(12),n.spaceAfter=r.ptToTwips(12);break;case e.BuiltinStyleType.Heading2:n.outlineLevel=e.OutlineLevel.Level2,n.lineSpacing=1.7,n.spaceBefore=r.ptToTwips(12),n.spaceAfter=r.ptToTwips(12);break;case e.BuiltinStyleType.Heading3:n.outlineLevel=e.OutlineLevel.Level3,n.lineSpacing=1.5,n.spaceBefore=r.ptToTwips(10),n.spaceAfter=r.ptToTwips(10);break;case e.BuiltinStyleType.Heading4:n.outlineLevel=e.OutlineLevel.Level4,n.lineSpacing=1.5,n.spaceBefore=r.ptToTwips(10),n.spaceAfter=r.ptToTwips(10);break;case e.BuiltinStyleType.Heading5:n.outlineLevel=e.OutlineLevel.Level5,n.lineSpacing=1.5,n.spaceBefore=r.ptToTwips(10),n.spaceAfter=r.ptToTwips(10);break;case e.BuiltinStyleType.Heading6:n.outlineLevel=e.OutlineLevel.Level6,n.lineSpacing=1.33,n.spaceBefore=r.ptToTwips(12),n.spaceAfter=r.ptToTwips(3.2);break;case e.BuiltinStyleType.Heading7:n.outlineLevel=e.OutlineLevel.Level7,n.lineSpacing=1.33,n.spaceBefore=r.ptToTwips(12),n.spaceAfter=r.ptToTwips(3.2);break;case e.BuiltinStyleType.Heading8:n.outlineLevel=e.OutlineLevel.Level8,n.lineSpacing=1.33,n.spaceBefore=r.ptToTwips(12),n.spaceAfter=r.ptToTwips(3.2);break;case e.BuiltinStyleType.Heading9:n.outlineLevel=e.OutlineLevel.Level9,n.lineSpacing=1.33,n.spaceBefore=r.ptToTwips(12),n.spaceAfter=r.ptToTwips(3.2);break;case e.BuiltinStyleType.Title:n.outlineLevel=e.OutlineLevel.Level1,n.textAlignment=e.TextAlignmentType.Center,n.spaceBefore=r.ptToTwips(12),n.spaceAfter=r.ptToTwips(3);break;case e.BuiltinStyleType.Subtitle:n.outlineLevel=e.OutlineLevel.Level2,n.textAlignment=e.TextAlignmentType.Center,n.lineSpacing=1.3,n.spaceBefore=r.ptToTwips(12),n.spaceAfter=r.ptToTwips(3);break;case e.BuiltinStyleType.Comments:}return n},t.prototype.getSpanProp=function(e){var t=ot.curDocDataVersion,r=ot.newDefaultStyleVersion;return t<this._lastVersionLimit?this.getSpanPropBeforeVer7(e):t<r?this.getSpanPropNew(e):this.getSpanPropVer8(e)},t.prototype.getSpanPropVer8=function(t){var n=new wt;switch(t){case e.BuiltinStyleType.Normal:break;case e.BuiltinStyleType.Heading1:n.fontWeight=700,n.fontSize=r.ptToTwips(18),n.textColor="#1A1A1A";break;case e.BuiltinStyleType.Heading2:n.fontWeight=700,n.fontSize=r.ptToTwips(16),n.textColor="#1A1A1A";break;case e.BuiltinStyleType.Heading3:n.fontWeight=700,n.fontSize=r.ptToTwips(14),n.textColor="#1A1A1A";break;case e.BuiltinStyleType.Heading4:n.fontWeight=700,n.fontSize=r.ptToTwips(12),n.textColor="#1A1A1A";break;case e.BuiltinStyleType.Heading5:n.fontWeight=700,n.fontSize=r.ptToTwips(11),n.textColor="#1A1A1A";break;case e.BuiltinStyleType.Heading6:n.fontWeight=700,n.fontSize=r.ptToTwips(10),n.textColor="#1A1A1A";break;case e.BuiltinStyleType.Heading7:case e.BuiltinStyleType.Heading8:n.fontWeight=700,n.fontSize=r.ptToTwips(12);break;case e.BuiltinStyleType.Heading9:n.fontWeight=700,n.fontSize=r.ptToTwips(10.5);break;case e.BuiltinStyleType.Title:n.fontWeight=700,n.fontSize=r.ptToTwips(24),n.textColor="#1A1A1A";break;case e.BuiltinStyleType.Subtitle:n.fontWeight=700,n.fontSize=r.ptToTwips(18),n.textColor="#5C5C5C";break;case e.BuiltinStyleType.Comments:n.fontSize=r.ptToTwips(10.5),n.textColor="#7E7E7E"}return n},t.prototype.getSpanPropNew=function(t){var n=new wt;switch(t){case e.BuiltinStyleType.Normal:break;case e.BuiltinStyleType.Heading1:n.fontWeight=700,n.fontSize=r.ptToTwips(22);break;case e.BuiltinStyleType.Heading2:n.fontWeight=700,n.fontSize=r.ptToTwips(18);break;case e.BuiltinStyleType.Heading3:n.fontWeight=700,n.fontSize=r.ptToTwips(16);break;case e.BuiltinStyleType.Heading4:n.fontWeight=700,n.fontSize=r.ptToTwips(15);break;case e.BuiltinStyleType.Heading5:n.fontWeight=700,n.fontSize=r.ptToTwips(14);break;case e.BuiltinStyleType.Heading6:case e.BuiltinStyleType.Heading7:case e.BuiltinStyleType.Heading8:n.fontWeight=700,n.fontSize=r.ptToTwips(12);break;case e.BuiltinStyleType.Heading9:n.fontWeight=700,n.fontSize=r.ptToTwips(10.5);break;case e.BuiltinStyleType.Title:n.fontWeight=700,n.fontSize=r.ptToTwips(22);break;case e.BuiltinStyleType.Subtitle:n.fontWeight=700,n.fontSize=r.ptToTwips(16),n.textColor="#848484";break;case e.BuiltinStyleType.Comments:n.fontSize=r.ptToTwips(10.5),n.textColor="#7E7E7E"}return n},t.prototype.getSpanPropBeforeVer7=function(t){var n=new wt;switch(t){case e.BuiltinStyleType.Normal:break;case e.BuiltinStyleType.Heading1:n.fontWeight=700,n.fontSize=r.ptToTwips(22);break;case e.BuiltinStyleType.Heading2:case e.BuiltinStyleType.Heading3:n.fontWeight=700,n.fontSize=r.ptToTwips(16);break;case e.BuiltinStyleType.Heading4:case e.BuiltinStyleType.Heading5:n.fontWeight=700,n.fontSize=r.ptToTwips(14);break;case e.BuiltinStyleType.Heading6:case e.BuiltinStyleType.Heading7:case e.BuiltinStyleType.Heading8:n.fontWeight=700,n.fontSize=r.ptToTwips(12);break;case e.BuiltinStyleType.Heading9:n.fontWeight=700,n.fontSize=r.ptToTwips(10.5);break;case e.BuiltinStyleType.Title:n.fontWeight=700,n.fontSize=r.ptToTwips(16);break;case e.BuiltinStyleType.Subtitle:n.fontWeight=700,n.fontSize=r.ptToTwips(16),n.textColor="#848484";break;case e.BuiltinStyleType.Comments:n.fontSize=r.ptToTwips(10.5),n.textColor="#7E7E7E"}return n},t}(),So=function(){function t(){this._styleSheetMap=new Map,this._builtinStyleTypeMap=new Map,this._builtinStyleSheet=new _o,this._initData()}return t.prototype._initData=function(){var e=this;this._builtinStyleSheet.getDefaultStyleSheet().forEach((function(t){e._styleSheetMap.set(t.styleName,t),e._builtinStyleTypeMap.set(t.builtinStyleType,t.styleName)}))},t.prototype.getStylePropertyFromName=function(e){if(e.length>0)return this._styleSheetMap.get(e)},t.prototype.setStylePropertyFromName=function(e,t){e.length<=0?r.Logger.warn("[styleEngine] styleName not allowed to be empty!"):this._styleSheetMap.get(e)||this._styleSheetMap.set(e,t)},t.prototype.getStylePropertyFromType=function(e){var t=this._builtinStyleTypeMap.get(e);if(t)return this.getStylePropertyFromName(t)},t.prototype.mergeStyleParaProperty=function(t){if(!t.has(e.ParaPropKey.styleName))return t;var r=t,n=this._styleSheetMap.get(t.styleName);if(!n)return r;for(;;){if(n.paraProperty){var o=r;(r=n.paraProperty.clone()).merge(o)}if(n.styleName===n.baseOnStyle)break;if(!(n=this._styleSheetMap.get(n.baseOnStyle)))break}return t.has(e.ParaPropKey.paraId)&&(r.paraId=t.paraId),r},t.prototype.mergeStyleSpanProperty=function(t,r){if(!t.has(e.SpanPropKey.styleName)&&!r.has(e.ParaPropKey.styleName))return t;var n=t,o=this._styleSheetMap.get(t.styleName);if(o)for(;;){if(o.spanProperty){var i=n;(n=o.spanProperty.clone()).merge(i)}if(o.styleName===o.baseOnStyle)break;if(!(o=this._styleSheetMap.get(o.baseOnStyle)))break}var a=this._styleSheetMap.get(r.styleName);if(a)for(;;){if(a.spanProperty){i=n;(n=a.spanProperty.clone()).merge(i)}if(a.styleName===a.baseOnStyle)break;if(!(a=this._styleSheetMap.get(a.baseOnStyle)))break}return n},t}(),Co=new Set(Object.values(e.NumberListFormat)),Bo=function(){function t(){}return t.getListStyle=function(e){var r={listFormat:e.listFmt,listText:e.lvlText};return t.isBulletFormat(r.listFormat)&&(r.listText=t.getCompatiableBulletText(r.listText)),r},t.getPeriodListStyleset=function(e){var t=e[0];if(e.length>0&&!this.isTaskFormat(t.listFormat)&&e.length<3){var r=e.slice();if(this.isBulletFormat(e[0].listFormat))for(var n=e.length;n<3;++n)r[n]={listFormat:tt.Bullet,listText:this.getDefaultBulletListText(n)};else for(n=e.length;n<3;++n)r[n]=this.getDefaultNumberListStyle(n);return r}return e},t.fintParagraphPeriod=function(e){if(e.length<3)return 3;for(var t=3;t<e.length;++t){var r=e[t];if(!r||r.listFmt===e[0].listFmt&&r.lvlText===e[0].lvlText)return t}return e.length},t.completeListTemplateParagraphs=function(n,o,i){var a=Math.min(i||ot.listLevelLimit,ot.maxSupportListLevelLimit);if(n.listFmt===tt.Task){n.characterUnitSpecialIndent=ot.listDefaultHanging,o.splice(1)}else{var s=this.fintParagraphPeriod(o),p=o;p.splice(0).forEach((function(e){p[e.listLevel]=e})),p[0]?p[0].equalTo(n)||(p[0]=n,r.Logger.error("rootParaProp")):p[0]=n;for(var l=1;l<a;++l){var c=p[l];if(!c){if((c=new Zt).listLevel=l,c.start=0,l>=s){var u=p[l%s];c.lvlText=u.lvlText,c.listFmt=u.listFmt,c.characterUnitSpecialIndent=u.characterUnitSpecialIndent}else if(n.isBullet){var h=t.getDefaultBulletListText(l);c.lvlText=h,c.listFmt=tt.Bullet,c.characterUnitSpecialIndent=ot.listDefaultHanging}else if(n.isNumbered){var f=t.getDefaultNumberListStyle(l),d=f.listFormat;h=f.listText;c.listFmt=d,c.lvlText=h,c.characterUnitSpecialIndent=ot.listDefaultHanging}p[l]=c}if(c.listTemplateId=n.listTemplateId,!c.has(e.ParaPropKey.characterUnitLeftIndent)&&!c.has(e.ParaPropKey.leftIndent)){var g=p[l-1];g.has(e.ParaPropKey.leftIndent)?c.leftIndent=2*ot.fontSize+g.leftIndent:c.characterUnitLeftIndent=2+g.characterUnitLeftIndent}}}},t.getDefaultNumberListStyle=function(t){var r;switch(t%3){case 0:r={listFormat:e.NumberListFormat.Number,listText:"%1."};break;case 1:r={listFormat:e.NumberListFormat.LowerLetter,listText:"%1."};break;case 2:r={listFormat:e.NumberListFormat.LowerRoman,listText:"%1."};break;default:r={listFormat:e.NumberListFormat.Number,listText:"%1."}}return r},t.getDefaultBulletListText=function(t){var r;switch(t%3){case 0:r=e.BulletText.Circle;break;case 1:r=e.BulletText.HollowCircle;break;case 2:r=e.BulletText.Square;break;default:r=e.BulletText.Circle}return r},t.createId=function(){return r.StringUtil.generateRandomId()},t.isNumberedFormat=function(e){return Co.has(e)},t.isBulletFormat=function(e){return tt.Bullet===e},t.isTaskFormat=function(e){return tt.Task===e},t.getCompatiableBulletText=function(t){var r=t;if(Object.values(e.BulletText).includes(t))return r;switch(t){case"":case"f06c":r="";break;case"":case"f06e":r="";break;case"":case"f075":r="";break;case"":case"f0fc":r="";break;case"":case"f0d8":r="";break;case"":case"f0b2":r="";break;case"":case"f0a1":r="";break;default:r=""}return r},t}(),Ro=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.actualText="",t.dirty=!0,t.order=-1,t.gcp=-1,t.isVirtual=!1,t.virtualChildCount=0,t}return k(t,e),t}(Zt),wo=function(){function e(){}return e.hasValue=function(e){return!!e.getNode()&&!!e.getNode().data},e.forEach=function(e,t,r){for(void 0===r&&(r=function(){return!0});this.hasValue(e)&&r(e.getNode().data);)t(e.getNode().data,e.getNode()),e.next()},e.get=function(e,t){void 0===t&&(t=function(){return!0});for(var r=[];this.hasValue(e)&&t(e.getNode().data);)r.push(e.getNode().data),e.next();return r},e.isEmpty=function(e){return!e.root()||!e.root().data},e.delete=function(e,t){t.forEach((function(t){e.erase(t)}))},e.insert=function(e,t){t.forEach((function(t){var r=t.data;r&&e.insertFloat(r.gcp,r)}))},e}(),Io=function(){function t(){}return t.numeric2ListText=function(t,r){switch(r){case e.NumberListFormat.Number:return t.toString();case e.NumberListFormat.LowerLetter:return this.number2Letter(t,!1);case e.NumberListFormat.LowerRoman:return this.number2Roman(t,!1);case e.NumberListFormat.ChineseCountingThousand:return this.number2Chinese(t);case e.NumberListFormat.UpperLetter:return this.number2Letter(t,!0);case e.NumberListFormat.UpperRoman:return this.number2Roman(t,!0);default:return t.toString()}},t.getNumberListText=function(e){var t=this,r=[e];return e.lvlText.replace(/%([1-9])/g,(function(n,o){var i=parseInt(o,10)-1;if(i>0&&1===r.length)for(var a=e.parent;a;a=a.parent)r.push(a);return r[i]?t.numeric2ListText(r[i].order+r[i].start+1,r[i].listFmt):""}))},t.getNumberListMeasureText=function(e){var t=e.replace(/\d/g,"0");return t!==e?t:void 0},t.number2Chinese=function(e){var t=["","","","","","","","","",""],r=["","","","",""],n=["","","",""],o=e,i=0,a="",s="",p=!1;if(0===o)return t[0];for(var l=o;o>0;){var c=o%1e4;p&&(s=t[0]+s),a=this.sectionToChinese(c,t,n),s=(a+=0!==c?r[i]:r[0])+s,p=c<1e3&&c>0,o=Math.floor(o/1e4),i+=1}return l>=10&&l<20&&(s=s.substring(1)),s},t.sectionToChinese=function(e,t,r){for(var n="",o="",i=0,a=!0,s=e;s>0;){var p=s%10;0===p?a||(a=!0,o=t[p]+o):(a=!1,n=t[p],o=(n+=r[i])+o),i+=1,s=Math.floor(s/10)}return o},t.number2Roman=function(e,t){var r=e,n={M:1e3,CM:900,D:500,CD:400,C:100,XC:90,L:50,XL:40,X:10,IX:9,V:5,IV:4,I:1};t||(n={m:1e3,cm:900,d:500,cd:400,c:100,xc:90,l:50,xl:40,x:10,ix:9,v:5,iv:4,i:1});var o="";return Object.keys(n).forEach((function(e){for(;r>=n[e];)o+=e,r-=n[e]})),o},t.number2Letter=function(e,t){for(var r=[],n=e;n;){var o=n%26;o||(o=26,n-=1),r.push(String.fromCharCode(o+(t?64:96))),n=~~(n/26)}return r.reverse().join("")},t}(),Eo=function(){function t(e){this._listLevels=new Map,this._listTemplateMap=new Map,this._listTemplateReverseMap=new Map,this._dirtyLists=new Set,this._lastUpdateGcp=-1,this._dataEngine=e,this._gcpClass=this._dataEngine.createGCPClass(!1,!1),this._dataEngine.getRWTextStream().getNotificationCenter()&&(this._notificationCenter=this._dataEngine.getRWTextStream().getNotificationCenter(),this.initListManager())}return t.isListTemplateStory=function(t){return t===e.StoryID.ListTemplateId||t===e.StoryID.ListTemplateIdCompt},t.prototype.resetListManager=function(){this._lastUpdateGcp=-1,this._gcpClass.removeAll(),this._listLevels=new Map,this._listTemplateMap=new Map;var e=this.getUpdates(new ne(0,this._dataEngine.getRWTextStream().getLength()));e.reorderLevels&&e.reorderLevels.length>0&&this.reorderLevels(e.reorderLevels),e.dirtyLists&&e.dirtyLists.length>0&&(this.markDirty(e.dirtyLists),this._dirtyLists.clear())},Object.defineProperty(t.prototype,"lastUpdateGcp",{get:function(){return this._lastUpdateGcp},enumerable:!0,configurable:!0}),t.prototype.initListManager=function(){var t=this;this._notificationCenter&&(this.resetListManager(),this._notificationCenter.on(e.TextStreamNotiyType.DataInsert,(function(e){e instanceof cn&&t.onDataInsert(e)}),!1),this._notificationCenter.on(e.TextStreamNotiyType.DataDelete,(function(){t.onDataDelete()}),!1),this._notificationCenter.on(e.TextStreamNotiyType.SpanChange,(function(e){e instanceof gn&&t.onSpanChange(e)}),!1),this._notificationCenter.on(e.TextStreamNotiyType.ParaChange,(function(e){e instanceof dn&&t.onParaPropChange(e)}),!1))},t.prototype.isListParagraph=function(e){return!!this.isListParaProp(e)&&this._listLevels.has(this.getLevelKey(e.listId,e.listLevel))},t.prototype.getListInfoFromGcpRange=function(e){var t=this._dataEngine.getRWTextStream().createParagraphIterator(e),r=t.getProperty(!0);if(r&&this.isListParaProp(r)){var n=this.getListInfoBy(r.listId,r.listLevel,t.getRange().end());return(null==n?void 0:n.dirty)&&this.combineList(n),n}return null},t.prototype.getWholeListByListId=function(e){var t=this,r=[];if(e){var n=new RegExp(e+"+(?=_\\d+$)");this._listLevels.forEach((function(e,o){var i=o.match(n);(null==i?void 0:i[0])&&wo.forEach(e.begin(),(function(e){e.dirty&&t.combineList(e),r.push(e)}))}))}return r},t.prototype.getListTypeByListId=function(t){for(var r,n=0;n<ot.maxSupportListLevelLimit;++n){var o=this.getLevelKey(t,n),i=this._listLevels.get(o),a=null===(r=null==i?void 0:i.root())||void 0===r?void 0:r.data;if(a)return a.listType}return e.ListType.None},t.prototype.getExistsListLevels=function(e){for(var t=[],r=0;r<ot.maxSupportListLevelLimit;++r){var n=this.getLevelKey(e,r);this._listLevels.has(n)&&t.push(r)}return t},t.prototype.getListTemplateId=function(e){return this._listTemplateReverseMap.get(e)},t.prototype.exists=function(e){return!!this.getListTemplateId(e)},t.prototype.getListsByListTemplateId=function(e){var t=this,r=[];return this._gcpClass.forEachGCP((function(n){return n.key.listTemplateId===e&&(n.key.dirty&&t.combineList(n.key),r.push(n.key)),!1})),r},t.prototype.modifyRenderRange=function(e){var t=this._dataEngine.getTextStream().createParagraphIterator();this._dirtyLists.forEach((function(r){t.seek(r.gcp-1),e(new ne(t.getRange().gcpBegin,1))})),this._dirtyLists.clear()},t.prototype.hasTemplate=function(e){return this._listTemplateMap.has(e)},t.prototype.getLevelKey=function(e,t){return e+"_"+String(t)},t.prototype.isListParaProp=function(e){return!!e.listId&&!!e.listTemplateId},t.prototype.getListInfoBy=function(e,t,r){var n=this._listLevels.get(this.getLevelKey(e,t));if(n){var o=n.findInner(r).getNode();if((null==o?void 0:o.data)&&o.data.gcp===r)return o.data}return null},t.prototype.markDirty=function(e,t){var r=this;void 0===t&&(t=!1),this._notificationCenter&&e.forEach((function(e){!e.isNumbered&&!t||e.isVirtual||r._dirtyLists.add(e),e.dirty=!0}))},t.prototype.reorderLevels=function(e){e.forEach((function(e){e.forEach((function(e,t){e.order=e.start+t}))}))},t.prototype.updateLevelRange=function(e,t){var r=[],n=[];return wo.forEach(e.begin(),(function(e,o){if(t.has(e)){var i=t.get(e);if(e.gcp!==i)e.gcp=i,r.push(o)}else{e.deleted=!0,n.push(o)}})),wo.delete(e,n),wo.delete(e,r),wo.insert(e,r),n.length>0?{list:n[0].data,level:e}:null},t.prototype.correctListLevel=function(e,t,r){var n=this;if(e.listLevel<ot.maxSupportListLevelLimit-1){var o=this._listLevels.get(this.getLevelKey(e.listId,e.listLevel+1));o&&wo.forEach(o.begin(),(function(e){e.parent&&e.parent.deleted&&(n.attachParent(e),r.push(e))}))}wo.forEach(t.begin(),(function(e){r.push(e)}))},t.prototype.updateRanges=function(){var e=this,t=new Map;this._gcpClass.forEachGCP((function(e){return t.set(e.key,e.gcp),!1}));var r=[];this._listLevels.forEach((function(n){var o=e.updateLevelRange(n,t);o&&r.push(o)})),r.sort((function(e,t){return e.list.listId>t.list.listId?1:e.list.listId===t.list.listId?t.list.listLevel-e.list.listLevel:-1}));var n=[];return r.forEach((function(t){e.correctListLevel(t.list,t.level,n)})),this.getReorderLevels(new Set(n))},t.prototype.removeListIdRelation=function(e){if(0===this.getExistsListLevels(e).length){var t=this._listTemplateReverseMap.get(e);if(t){this._listTemplateReverseMap.delete(e);var r=this._listTemplateMap.get(t);if(r){var n=r.indexOf(e);n>-1&&(1===r.length?this._listTemplateMap.delete(t):r.splice(n,1))}}}},t.prototype.removeEmptyLevels=function(){var e=this,t=[];this._listLevels.forEach((function(e,r){wo.isEmpty(e)&&t.push(r)}));var r=new Set;t.forEach((function(t){e._listLevels.delete(t),r.add(t.split("_")[0])})),r.forEach((function(t){e.removeListIdRelation(t)}))},t.prototype.getUpdates=function(e){var t=this._dataEngine.getRWTextStream().createParagraphIterator(e),r=new Set,n=new Set,o=this._gcpClass.findGCPs(),i=function(){var e=t.getProperty(!0);if(!e)return"continue";var i=t.getRange(),s=o.find((function(e){return e.gcp===i.end()}));if(!s&&""===e.listId)return"continue";if(!s)return(l=a.insertList(e,i.end()))&&r.add(l),a._lastUpdateGcp=i.end(),"continue";var p=s.key.listId===e.listId&&s.key.listLevel===e.listLevel;if(s&&!p){var l,c=a.deleteList(s.key,s.gcp);return c&&r.add(c),(l=a.insertList(e,i.end()))&&r.add(l),a._lastUpdateGcp=i.end(),"continue"}if(s&&p){var u=a.getListInfoBy(e.listId,e.listLevel,i.end());u&&n.add(u)}},a=this;do{i()}while(t.next());var s=this.getReorderLevels(r);return s.forEach((function(e){e.forEach((function(e){n.add(e)}))})),{reorderLevels:K(s),dirtyLists:K(n)}},t.prototype.getReorderRefParent=function(e,t){if(e.parent&&e.deleted){var r=t.findOuter(e.gcp).getNode();return(null==r?void 0:r.data)&&r.data.parent&&r.data.parent.gcp>=e.parent.gcp?r.data.parent:void 0}return e.parent},t.prototype.expandDescendantLists=function(e,t){if(e.listLevel<ot.maxSupportListLevelLimit-1)for(var r=e.listLevel;r<ot.maxSupportListLevelLimit;++r){var n=this._listLevels.get(this.getLevelKey(e.listId,r));if(n){var o=n.findOuter(e.gcp);if(wo.hasValue(o)){var i=o.data();/[0-9].*[0-9]/.test(i.lvlText)?wo.get(o).forEach((function(e){return t.add(e)})):r===e.listLevel+1&&t.add(i)}}}},t.prototype.expandVirtualParentLists=function(e,t){var r;if(e.listLevel>0)for(var n=e.parent;(null==n?void 0:n.isVirtual)&&-1===n.order&&!n.deleted;n=(r=n).parent,r)t.add(n)},t.prototype.getMinimalReorderMap=function(e){var t=this,r=new Set(e);e.forEach((function(e){t.expandVirtualParentLists(e,r),t.expandDescendantLists(e,r)}));var n=new Map;return r.forEach((function(e){if(e.isNumbered){var r=t.getLevelKey(e.listId,e.listLevel);if(t._listLevels.has(r)){var o=n.get(r);if(o){var i=o.get(e.parent);(!i||i.deleted&&!e.deleted)&&o.set(e.parent,e)}else n.set(r,new Map([[e.parent,e]]))}}})),n},t.prototype.getReorderLevels=function(e){var t=this,r=this.getMinimalReorderMap(e),n=[];return r.size>0&&r.forEach((function(e,r){e.forEach((function(e){var o=null,i=t._listLevels.get(r),a=t.getReorderRefParent(e,i);if(a){var s=t._listLevels.get(t.getLevelKey(a.listId,a.listLevel));if(s){var p=s.findOuter(a.gcp);if(wo.hasValue(p)){var l=p.getNode().data.gcp;o=wo.get(i.findOuter(a.gcp-.25),(function(e){return e.gcp<l}))}else o=wo.get(i.findOuter(a.gcp-.25))}}o||0!==e.listLevel||(o=wo.get(i.begin())),o&&o.length>0&&n.push(o)}))})),n},t.prototype.getNearestAncestor=function(e){for(var t=null,r=Number.MAX_SAFE_INTEGER,n=e.listLevel-1;n>=0;--n){var o=this._listLevels.get(this.getLevelKey(e.listId,n));if(o){var i=o.findInner(e.gcp).getNode();if(null==i?void 0:i.data){var a=e.gcp-i.data.gcp;a<r&&(t=i.data,r=a)}}}return t},t.prototype.insertListData=function(e,t){var r=this.getLevelKey(e.listId,e.listLevel),n=this._listLevels.get(r);n||(n=new re,this._listLevels.set(r,n)),n.insertFloat(t,e),this._gcpClass.insertGCP(e,t)},t.prototype.deleteListData=function(e,t,r){var n=this.getLevelKey(e,t),o=this._listLevels.get(n);if(o){var i=o.findInner(r).getNode();if((null==i?void 0:i.data)&&i.data.gcp===r)return o.erase(i),this._gcpClass.deleteGCP(i.data),i.data}return null},t.prototype.createVirtualList=function(e,t,r,n){var o=new Ro(e);return o.listLevel=t,o.gcp=r,o.parent=n,o.isVirtual=!0,o.virtualChildCount=1,o},t.prototype.attachParent=function(e){if(e.listLevel>0){var t=this.getNearestAncestor(e),r=e;if(!t||e.listLevel-t.listLevel>1){for(var n=void 0,o=t,i=e.gcp-.5,a=t?t.listLevel+1:0;a<e.listLevel;++a)n=this.createVirtualList(e,a,i,o||void 0),this.insertListData(n,n.gcp),o=n;r.parent=n}else r.parent=t,t.isVirtual&&(t.virtualChildCount=(t.virtualChildCount||0)+1)}},t.prototype.replaceParent=function(e,t,r){var n=this,o=new Set;wo.forEach(e,(function(e){if(e.parent&&e.parent!==t){var r=e.parent;r.isVirtual&&(void 0!==r.virtualChildCount&&(r.virtualChildCount-=1),o.add(e.parent)),e.parent=t}}),r),o.forEach((function(e){e.gcp>=t.gcp-.5&&n.deleteListData(e.listId,e.listLevel,e.gcp)}))},t.prototype.attachSiblings=function(e){if(e.listLevel>0){var t=this._listLevels.get(this.getLevelKey(e.listId,e.listLevel));t&&this.replaceParent(t.findOuter(e.gcp),e.parent,(function(t){return!!t.parent&&t.parent!==e.parent&&t.parent.isVirtual}))}},t.prototype.attachChildren=function(e){if(e.listLevel<ot.maxSupportListLevelLimit-1){var t=e.listLevel+1,r=this._dataEngine.getRWTextStream().createParagraphIterator();r.seek(Math.ceil(e.gcp));var n=-1;do{var o=r.getProperty(!0);if(!(o&&o.listId===e.listId&&o.listLevel>e.listLevel))break;n=r.getRange().end()}while(r.next());if(n>-1){var i=this._listLevels.get(this.getLevelKey(e.listId,t));i&&this.replaceParent(i.findOuter(e.gcp),e,(function(e){return e.gcp<=n}))}}},t.prototype.registerTemplate=function(e){var t=this._listTemplateMap.get(e.listTemplateId);t&&!t.includes(e.listId)?t.push(e.listId):this._listTemplateMap.set(e.listTemplateId,[e.listId]),this._listTemplateReverseMap.set(e.listId,e.listTemplateId)},t.prototype.insertList=function(e,t){if(this.isListParaProp(e)){var r=new Ro(e);return r.gcp=t,this.attachParent(r),this.attachSiblings(r),this.attachChildren(r),this.insertListData(r,t),this.registerTemplate(r),r}return null},t.prototype.detachChildren=function(e){if(e.listLevel<ot.maxSupportListLevelLimit-1){var t=this._listLevels.get(this.getLevelKey(e.listId,e.listLevel+1)),r=t?wo.get(t.findOuter(e.gcp),(function(t){return t.parent===e})):[];if(r.length>0){this.attachParent(r[0]);for(var n=1;n<r.length;++n)r[n].parent=r[0].parent}}},t.prototype.detachParent=function(e){for(var t=e.parent;null==t?void 0:t.isVirtual;)void 0!==t.virtualChildCount&&(t.virtualChildCount-=1),t.virtualChildCount||this.deleteListData(t.listId,t.listLevel,t.gcp),t=t.parent},t.prototype.deleteList=function(e,t){if(this.isListParaProp(e)){var r=this.deleteListData(e.listId,e.listLevel,t);return r&&(this.detachChildren(r),this.detachParent(r),r.deleted=!0),r}return null},t.prototype.getListStoryInfo=function(){var r=this._dataEngine.getRWTextStream().findStoryInfoFromId(e.StoryID.ListTemplateId)||this._dataEngine.getRWTextStream().findStoryInfoFromId(e.StoryID.ListTemplateIdCompt);return r&&t.isListTemplateStory(r.storyProp.storyId)?r:void 0},t.prototype.combineParaProp=function(t,r,n){var o=t;o.cover(n),r.styleName!==ot.paragraph.styleName&&o.clear([e.ParaPropKey.characterUnitLeftIndent]),o.merge(this._dataEngine.getStyleSheetEngine().mergeStyleParaProperty(r)),o.paragraphStyle=r.styleName},t.prototype.combineSpanProp=function(e,t,r,n){var o=e;if(o.listMarkerSpanProp=this._dataEngine.getStyleSheetEngine().mergeStyleSpanProperty(t.clone(),r),n&&o.listMarkerSpanProp.merge(n),o.isBullet){var i=n||ot.font;i.fontFamily===ot.font.fontFamily&&(o.listMarkerSpanProp.fontFamily=""),o.listMarkerSpanProp.fontWeight=i.fontWeight,o.listMarkerSpanProp.italic=i.italic,o.listMarkerSpanProp.underline=i.underline}else o.isTask&&(o.listMarkerSpanProp.fontFamily="",o.listMarkerSpanProp.fontWeight=ot.font.fontWeight,o.listMarkerSpanProp.textColor=ot.font.textColor,o.listMarkerSpanProp.italic=ot.font.italic,o.listMarkerSpanProp.underline=!1,o.listMarkerSpanProp.strike=!1)},t.prototype.generateListText=function(e){var t=e;e.isNumbered?(t.actualText=Io.getNumberListText(e),t.measureText=Io.getNumberListMeasureText(e.actualText)):e.isBullet?t.actualText=Bo.getCompatiableBulletText(e.lvlText):t.actualText=e.lvlText},t.prototype.getTemplateProps=function(t,r){var n=this.getListStoryInfo();if(n){var o=this._dataEngine.getRWTextStream().createDataIterator(n.range);do{var i=o.getParaProp(!0);if(i instanceof Zt&&i.listTemplateId===t&&i.listLevel===r)return{paraBreakSpan:o.getSpanProp(!0),paraProp:i}}while(o.next(e.IterType.Paragraph))}},t.prototype.combineList=function(e){if(e.listId&&e.listTemplateId){var t=e;if(!e.isVirtual){var n=this._dataEngine.getRWTextStream().createDataIterator();n.seek(e.gcp-1);var o=n.getParaProp(!0),i=n.getSpanProp(!0);if(!o||!i)return void r.Logger.error("applyTemplate cannot find paraProp or paraBreakSpan");var a=this.getTemplateProps(e.listTemplateId,e.listLevel);a&&(this.combineParaProp(t,o,a.paraProp),this.combineSpanProp(t,i,o,a.paraBreakSpan),t.start=a.paraProp.start,t.listFmt=a.paraProp.listFmt,t.lvlText=e.isTask?e.taskState:a.paraProp.lvlText),this.generateListText(t)}t.dirty=!1}else r.Logger.error("list|recompose| invalid list info, listId="+e.listId+", listTemplateId="+e.listTemplateId)},t.prototype.isTemplateChange=function(e){var t=this.getListStoryInfo();return!!t&&t.range.contains(e)},t.prototype.onDataInsert=function(t){if(t.insertType===e.DataInsertType.Paragraph){var r=[],n=[];if(this.updateRanges(),this.isTemplateChange(t.range))n=this.onTemplateSpanChange(t);else{var o=this.getUpdates(t.range);r=o.reorderLevels,n=o.dirtyLists}r.length>0&&this.reorderLevels(r),n.length>0&&this.markDirty(n)}else this.updateRanges()},t.prototype.onParaPropChange=function(e){var t=[],r=[],n=this.isTemplateChange(e.range);if(n)r=this.onTemplateSpanChange(e);else{var o=this.getUpdates(e.range);t=o.reorderLevels,r=o.dirtyLists}this.removeEmptyLevels(),t.length>0&&this.reorderLevels(t),r.length>0&&this.markDirty(r,n)},t.prototype.onDataDelete=function(){var e,t=this.updateRanges();this.removeEmptyLevels(),t.length>0&&(this.reorderLevels(t),this.markDirty((e=[]).concat.apply(e,K(t))))},t.prototype.onSpanChange=function(e){var t=this.isTemplateChange(e.range),r=t?this.onTemplateSpanChange(e):this.onNormalSpanChange(e);r.length>0&&this.markDirty(r,t)},t.prototype.onTemplateSpanChange=function(e){var t=this,r=new Set,n=this._dataEngine.getRWTextStream().createParagraphIterator(e.range),o=function(){var e=n.getProperty(!0);if(e instanceof Zt){var o=i._listTemplateMap.get(e.listTemplateId);o&&o.forEach((function(n){var o=t._listLevels.get(t.getLevelKey(n,e.listLevel));o&&wo.forEach(o.begin(),(function(e){r.add(e)}))}))}},i=this;do{o()}while(n.next());return K(r)},t.prototype.onNormalSpanChange=function(e){var t=[],r=this._dataEngine.getRWTextStream().createParagraphIterator(e.range);do{var n=r.getProperty(!0);if(n){var o=this.getListInfoBy(n.listId,n.listLevel,r.getRange().end());o&&t.push(o)}}while(r.next());return t},t}(),Lo=function(){function t(e){this._dataEngine=e,this._notificationCenter=this._dataEngine.getTextStream().getNotificationCenter(),this._gcpClass=this._dataEngine.createGCPClass(!1,!1),this.initContainerManager()}return t.prototype.resetContainerManager=function(){this._gcpClass.removeAll();var e=this._dataEngine.getRWTextStream().createSpanIterator();do{var t=e.getProperty(!0);if(t&&t instanceof nr){var r=e.getRange(!0);this._gcpClass.insertGCP(t.anchorId+":"+(t.isPlaceHolder?1:0),r.end())}}while(e.next())},t.prototype.initContainerManager=function(){var t=this;this._notificationCenter&&(this.resetContainerManager(),this._notificationCenter.on(e.TextStreamNotiyType.DataInsert,(function(e){if(e.property instanceof nr){var r=e.property;t._gcpClass.insertGCP(r.anchorId+":"+(r.isPlaceHolder?1:0),e.range.end());var n=new Map;n.set(r.anchorId,r.isPlaceHolder),t._notificationCenter.fire(new yn(n))}}),!1),this._gcpClass.onEraseList((function(e){if(e.length>0){var r=new Map;e.forEach((function(e){var t=e.split(":");t.length>=2&&r.set(t[0],"0"!==t[1])})),t._notificationCenter.fire(new mn(r))}})),this._notificationCenter.on(e.TextStreamNotiyType.SpanChange,(function(e){if(e.spanProp instanceof nr){var r=null,n=t._dataEngine.getRWTextStream().createSpanIterator(e.range);n.seek(e.range.end()-1);var o=n.getProperty();if(o&&o instanceof nr&&(r=o),r){var i=new Map;i.set(r.anchorId,r.isPlaceHolder),t._notificationCenter.fire(new bn(i))}}}),!1))},t.prototype.getAnchorRange=function(e,t){if(void 0===t&&(t=!1),this._gcpClass){var r=this._gcpClass.getGCP(e+":"+(t?1:0));if(void 0!==r)return new ne(r-1,1)}return null},t}(),Oo=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return k(t,e),t}(In),No=function(t){function r(e,r){var n=t.call(this,e,r)||this;return n._moveToValidPos(),n}return k(r,t),r.prototype.seek=function(e){return t.prototype.seek.call(this,e),this._moveToValidPos(),!0},r.prototype.next=function(){var e=t.prototype.next.call(this);return e&&(e=this._moveToValidPos(e)),e},r.prototype._moveToValidPos=function(t){void 0===t&&(t=!1);var r=this.getProperty();return r&&r.fieldCharType!==e.FieldCharType.End?this.next():t},r}(Mn);function ko(e){var t={};return t.page=e.page,t.section=e.section,t.pageCount=e.pageCount,t}(vo=e.FieldcodeLayoutContextKey||(e.FieldcodeLayoutContextKey={})).SECTION="section",vo.PAGE="page",vo.PAGE_COUNT="pageCount",vo.PAGE_START="pageStart",(xo=e.FieldType||(e.FieldType={})).PAGE="PAGE",xo.MENTION_QQ="MENTION_QQ",xo.MENTION_WXWORK="MENTION_WXWORK",xo.DOC_LINK="DOC_LINK";var Mo,Do=function(){function e(){this.isAutoUpdate=!1,this.isInlineBlock=!0,this.isShowDropdowns=!0,this.isShowHover=!0}return e.prototype.requiredContext=function(e){return[]},e.prototype.getPrefab=function(e){return null},e.prototype.getDropdownItems=function(e,t){return[]},e.prototype.handleFieldClick=function(e,t){},e.prototype.afterShowDropdown=function(){},e}(),Fo=function(){function e(){if(e.instance)return e.instance;this.supportedFieldNames=new Map,e.instance=this}return e.getInstance=function(){return new e},e.prototype.getFieldcodeInfo=function(e){var t=e.match(/(\w+)\s?(.*)/);if(t){var r=t[1],n=t[2].match(/\\?.|^$/g);if(n){var o=0,i=n.reduce((function(e,t){return'"'===t?o^=1:o||" "!==t?e[e.length-1]+=t:e.push(""),e}),[""]).filter((function(e){return""!==e})),a=[],s={},p=!1;return i.forEach((function(e,t,r){if(0===e.indexOf("\\")){p=!0;var n=r[t+1],o=e.replace("\\","");n&&0!==n.indexOf("\\")?s[o]=n:s[o]=!0}else p||a.push(e)})),{isValid:!0,fieldName:r,instructions:a,switches:s,fieldcode:e}}}return{isValid:!1,fieldName:"",fieldcode:e}},e.prototype.getInfo=function(e){var t=this.getFieldcodeInfo(e);if(t.isValid&&this.isSupported(t.fieldName)){var r=this.getProcessor(t.fieldName),n=r.isAutoUpdate,o=r.isInlineBlock,i=r.requiredContext(t),a=r.getPrefab(t);return{isValid:!0,fieldType:t.fieldName,isAutoUpdate:n,isInlineBlock:o,requiredContext:i,prefab:a}}return{isValid:!1,isAutoUpdate:!1,isInlineBlock:!0,requiredContext:[],prefab:null,fieldType:""}},e.prototype.parse=function(e,t){var r=this.getFieldcodeInfo(e);if(r.isValid&&this.isSupported(r.fieldName)){var n=this.getProcessor(r.fieldName),o=n.isAutoUpdate,i=n.isInlineBlock,a=n.requiredContext(r),s=n.parse(r,t);return{isValid:!0,prefab:null,fieldType:r.fieldName,isAutoUpdate:o,isInlineBlock:i,requiredContext:a,result:s}}return{isValid:!0,result:"",requiredContext:[],isAutoUpdate:!1,isInlineBlock:!0,prefab:null,fieldType:""}},e.prototype.isSupported=function(e){return this.supportedFieldNames.has(e)},e.prototype.getProcessor=function(e){return this.isSupported(e)?this.supportedFieldNames.get(e):null},e.prototype.addProcessor=function(e,t){this.isSupported(e)?r.Logger.warn("Fieldcode "+e+" already has a processor."):this.supportedFieldNames.set(e,t)},e.prototype.removeProcessor=function(e){this.supportedFieldNames.delete(e)},e}();(Mo=e.FieldNotification||(e.FieldNotification={})).PageNumChanged="PageNumChanged",Mo.FieldInsert="FieldInsert",Mo.FieldDelete="FieldDelete",Mo.DataFieldInsert="DataFieldInsert",Mo.DataFieldDelete="DataFieldDelete";var Ao,Ko=function(t){function r(){return t.call(this,e.FieldNotification.PageNumChanged)||this}return k(r,t),r}(r.Notification),Go=function(t){function r(r){var n=t.call(this,e.FieldNotification.FieldInsert)||this;return n.fieldCodes=r,n}return k(r,t),r}(r.Notification),Ho=function(t){function r(r){var n=t.call(this,e.FieldNotification.FieldDelete)||this;return n.fieldCodes=r,n}return k(r,t),r}(r.Notification),jo=function(t){function r(r){var n=t.call(this,e.FieldNotification.DataFieldInsert)||this;return n.fieldCodes=r,n}return k(r,t),r}(r.Notification),Uo=function(t){function r(r){var n=t.call(this,e.FieldNotification.DataFieldDelete)||this;return n.fieldCodes=r,n}return k(r,t),r}(r.Notification),zo=function(){function t(e){this._dataEngine=e,this._notificationCenter=this._dataEngine.getTextStream().getNotificationCenter(),this._fieldPropList=new Oo,this._fieldManager=new Fo,this._gcpClass=this._dataEngine.createGCPClass(!1,!1),this.initFieldEngine()}return t.prototype.resetFieldEngine=function(){this._gcpClass.removeAll(),this._fieldPropList=new Oo;var t=this._dataEngine.getRWTextStream().createSpanIterator();do{var r=t.getProperty(!0);if(r&&r instanceof Ht){var n=t.getRange(!0);if(this._fieldPropList.insertProp(n.end(),r.clone()),r.fieldCharType===e.FieldCharType.End){var o=this.getFieldCode(n.begin());o&&this._gcpClass.insertGCP(o,n.end())}}}while(t.next())},t.prototype.initFieldEngine=function(){var t=this;this._notificationCenter&&(this.resetFieldEngine(),this._notificationCenter.on(e.TextStreamNotiyType.DataInsert,(function(e){if(t._fieldPropList.extend(e.range.begin(),e.range.length()),(e.text===uo.FieldBegin||e.text===uo.FieldSep||e.text===uo.FieldEnd)&&e.property instanceof Ht&&t._fieldPropList.insertProp(e.range.end(),e.property),e.text===uo.FieldEnd){var r=t.getFieldCode(e.range.begin());if(r)t._gcpClass.insertGCP(r,e.range.end())&&t._notificationCenter&&t._notificationCenter.fire(new jo([r]))}}),!1),this._notificationCenter.on(e.TextStreamNotiyType.DataDelete,(function(e){t._fieldPropList.shrink(e.range.begin(),e.range.length())}),!1),this._gcpClass.onEraseList((function(e){e.length>0&&t._notificationCenter.fire(new Uo(e))})))},t.prototype.createFieldIter=function(e){return new No(this._fieldPropList,this._validRange(e))},t.prototype.getFieldRangeByGcp=function(t){var r=this.createFieldIter();r.seek(t);var n=r.getProperty();if(n&&n.fieldCharType===e.FieldCharType.End){var o=r.getRange(),i=o.end();o.len-=1,r.prev();var a=r.getProperty();if(a&&a.fieldCharType===e.FieldCharType.Separate){var s=r.getRange();s.len-=1,r.prev();var p=r.getProperty();if(p&&p.fieldCharType===e.FieldCharType.Begin){var l=new ne(s.begin()-1,i-(s.begin()-1));if(l.contains(t))return{fRange:l,fCodeRange:s,fResultRange:o}}}}return null},t.prototype.getFieldCode=function(e){var t=this.getFieldRangeByGcp(e);if(t){var r=t.fCodeRange;if(r)return this._dataEngine.getTextStream().readText(r.begin(),r.length())}return null},t.prototype.getFieldInfo=function(e){var t=this.getFieldRangeByGcp(e);if(t){var r=this.parserCodeForInfo(t.fCodeRange);return{fieldRange:t.fRange,fieldCodeRange:t.fCodeRange,fieldResultRange:t.fResultRange,fieldCode:r.fieldCode,isAutoUpdate:r.isAutoUpdate,isInlineBlock:r.isInlineBlock,requiredContext:r.requiredContext,prefab:r.prefab}}return null},t.prototype.parserCodeForInfo=function(e){var t=this._dataEngine.getTextStream().readText(e.begin(),e.length()),r=this._fieldManager.getInfo(t);return{fieldCode:t,isAutoUpdate:r.isAutoUpdate,isInlineBlock:r.isInlineBlock,requiredContext:r.requiredContext,prefab:r.prefab}},t.prototype.parserCodeForResult=function(e,t){return this._fieldManager.parse(e,t)},t.prototype._validRange=function(e){var t=new ne(0,this._dataEngine.getTextStream().getLength());return e&&(t=e.intersectRange(t)),t},t.prototype.isRangeInFieldCode=function(e){var t=e.begin(),r=e.end(),n=this.getFieldRangeByGcp(t),o=this.getFieldRangeByGcp(r);return!!(n&&o&&n.fRange&&o.fRange&&n.fRange.begin()===o.fRange.begin()&&n.fRange.length()===o.fRange.length())},t.prototype.isFieldCodeRange=function(e){var t=this.getFieldRangeByGcp(e.begin());if(t){var r=t.fCodeRange;if(r&&r.begin()===e.begin()&&r.length()===e.length())return!0}return!1},t.prototype.isFieldResultRange=function(e){var t=this.getFieldRangeByGcp(e.begin());if(t){var r=t.fResultRange;if(r&&r.begin()===e.begin()&&r.length()===e.length())return!0}return!1},t}(),Wo=function(){function t(t){void 0===t&&(t=e.TextStreamLayerFlags.None),this._rwTextStream=new To(t),this._textStream=new pn(this._rwTextStream),this._styleSheetEngine=new So,this._rwTextStream.getNotificationCenter()&&(this._listManager=new Eo(this),this._fieldEngine=new zo(this),this._containerManager=new Lo(this))}return t.prototype._resetEngines=function(){this._listManager&&this._listManager.resetListManager(),this._containerManager&&this._containerManager.resetContainerManager(),this._fieldEngine&&this._fieldEngine.resetFieldEngine()},t.createCoreDataEngine=function(){return new t(e.TextStreamLayerFlags.Notify)},t.createTempDataEngine=function(){return new t},t.prototype.getTextStream=function(){return this._textStream},t.prototype.getRWTextStream=function(){return this._rwTextStream},t.prototype.getStyleSheetEngine=function(){return this._styleSheetEngine},t.prototype.getListManager=function(){return this._listManager},t.prototype.getContainerManager=function(){return this._containerManager},t.prototype.getFieldEngine=function(){return this._fieldEngine},t.prototype.copyFrom=function(e){return this._rwTextStream.copyFrom(e._rwTextStream),this._resetEngines(),this},t.prototype.garbageCollection=function(){this._rwTextStream.garbageCollection()},t.prototype.createRangeClass=function(t,r){return void 0===t&&(t=!1),void 0===r&&(r=!0),new _n(this._textStream.getNotificationCenter(),t,r,e.PosPolicy.Outer)},t.prototype.createGCPClass=function(t,r,n){return void 0===t&&(t=!1),void 0===r&&(r=!0),void 0===n&&(n=e.PosPolicy.Outer),new xn(this._textStream.getNotificationCenter(),t,r,n)},t}();(Ao=e.LayoutType||(e.LayoutType={}))[Ao.Paged=0]="Paged",Ao[Ao.Scroll=1]="Scroll";var Vo,Yo,qo=new function(){this.layoutType=e.LayoutType.Scroll,this.uniqueId="",this.editable=!0,this.copyable=!0,this.isPresentationState=!1};(Vo=e.BORDER_STYLE||(e.BORDER_STYLE={}))[Vo.BORDER_NONE=0]="BORDER_NONE",Vo[Vo.BORDER_INNER_HOR=1]="BORDER_INNER_HOR",Vo[Vo.BORDER_INNER_VER=2]="BORDER_INNER_VER",Vo[Vo.BORDER_INNER_ALL=3]="BORDER_INNER_ALL",Vo[Vo.BORDER_LEFT=4]="BORDER_LEFT",Vo[Vo.BORDER_TOP=8]="BORDER_TOP",Vo[Vo.BORDER_RIGHT=16]="BORDER_RIGHT",Vo[Vo.BORDER_BOTTOM=32]="BORDER_BOTTOM",Vo[Vo.BORDER_OUTER=60]="BORDER_OUTER",Vo[Vo.BORDER_ALL=63]="BORDER_ALL",Vo[Vo.BORDER_COLOR=1e3]="BORDER_COLOR",(Yo=e.POS_IN_RANGE||(e.POS_IN_RANGE={}))[Yo.POS_NONE=-1]="POS_NONE",Yo[Yo.POS_INNER=0]="POS_INNER",Yo[Yo.POS_L=1]="POS_L",Yo[Yo.POS_T=2]="POS_T",Yo[Yo.POS_R=4]="POS_R",Yo[Yo.POS_B=8]="POS_B";var Xo=function(){function e(){}return e.getFilterFieldCodeText=function(e){var t=e;if(t.indexOf(uo.FieldBegin)>=0&&t.indexOf(uo.FieldSep)>=0){t=t.replace(/([\u0013](.*?)[\u0014]+|\u0015+|[\u0013](.*))/g,"")}return t},e}(),Jo=function(e,t){return(Jo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)};
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function Zo(e,t){function r(){this.constructor=e}Jo(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var Qo=function(){return(Qo=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function $o(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function ei(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a}function ti(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(ei(arguments[t]));return e}var ri=function(e,t,r){void 0===t&&(t=[]),void 0===r&&(r=!0),this.ctor=e,this.args=t,this.singleton=r},ni=function(e,t){var n=r.getClass(e);n["di:target"]===e?n[t.kind].push(t):(n[t.kind]=[t],n["di:target"]=e)};function oi(e){var t;return null!==(t=r.getClass(e)["di:param"])&&void 0!==t?t:[]}function ii(e){var t;return null!==(t=r.getClass(e)["di:props"])&&void 0!==t?t:[]}function ai(e){var t=oi(e),r=ii(e),n=[];return Array.isArray(t)&&n.push.apply(n,ti(t)),Array.isArray(r)&&n.push.apply(n,ti(r)),n}var si,pi=function(){function e(){this.entries=new Map,this.graph=new r.Graph((function(e){return e.toString()}))}return e.prototype.set=function(e,t){var n=this.entries.get(e);return!n||n instanceof ri||r.Logger.warn("override exist service:"+e),this.entries.set(e,t),this.setDPs(e,t),n},e.prototype.has=function(e){return this.entries.has(e)},e.prototype.get=function(e){return this.entries.get(e)},e.prototype.forEach=function(e){this.entries.forEach((function(t,r){e(r,t)}))},Object.defineProperty(e.prototype,"dpGraph",{get:function(){return this.graph},enumerable:!0,configurable:!0}),e.prototype.setDPs=function(e,t){var n=this,o=ai(t instanceof ri?t.ctor:r.getClass(t));!o||o.length<1||o.forEach((function(t){n.graph.insertEdge(e,t.id,{dp:t})}))},e}(),li=function(e){function t(t){var r=e.call(this,"cyclic dependency between services")||this;return r.message=t.toString(),r}return Zo(t,e),t}(Error),ci=function(){function e(e){void 0===e&&(e=new pi),this.services=e}return Object.defineProperty(e.prototype,"dpString",{get:function(){return this.services.dpGraph.toString()},enumerable:!0,configurable:!0}),e.prototype.inject=function(e,t){var r=this;this.services.set(e,t);var n=this.getOrCreateInstance(e),o=this.services.dpGraph.lookup(e);return!n||!o||o.incoming.size<1||o.incoming.forEach((function(t){var o=ei(t,2),i=o[0].data,a=o[1];if(a){var s=a.dp;if(s.id===e&&"di:props"===s.kind){var p=r.services.get(i);!p||p instanceof ri||Object.defineProperty(p,s.key,{get:function(){return n},configurable:!0})}}})),n},e.prototype.set=function(e,t){return this.services.set(e,t)},e.prototype.get=function(e){return this.getOrCreateInstance(e)},e.prototype.create=function(e){for(var t,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];return t=e instanceof ri?e:new ri(e,r),this.createNewInstance(t)},e.prototype.getOrCreateInstance=function(e){var t=this,n=this.services.get(e);if(n){if(!(n instanceof ri))return n;for(var o=new r.Graph((function(e){return e.id.toString()})),i=0,a=[{id:e,desc:n}],s=function(){var n=a.pop();if(o.lookupOrInsertNode(n),(i+=1)>1e3)throw new li(o);var s=ai(n.desc.ctor);if(!s||s.length<1)return"continue";s.forEach((function(i){var s=t.services.get(i.id);if(s||r.Logger.warn(e.toString()+" depends on "+i.id.toString()+" which is not injected."),s instanceof ri){var p={id:i.id,desc:s};o.insertEdge(n,p),a.push(p)}}))};a.length;)s();for(;;){var p=o.roots();if(0===p.length){if(!o.isEmpty())throw new li(o);break}p.forEach((function(e){var r=e.data,n=t.createNewInstance(r.desc);t.services.set(r.id,n),o.removeNode(r)}))}return this.get(e)}},e.prototype.createNewInstance=function(e){var t,r=this,n=[],o=oi(e.ctor);(null==o?void 0:o.length)>0&&(o.sort((function(e,t){return e.index-t.index})),o.forEach((function(e){var t=r.getOrCreateInstance(e.id);if(!t)throw new Error(e.id.toString()+" is not injected!");n.push(t)}))),n.push.apply(n,ti(e.args));var i=new((t=e.ctor).bind.apply(t,ti([void 0],n))),a=ii(e.ctor);return(null==a?void 0:a.length)>0&&a.forEach((function(e){var t=r.getOrCreateInstance(e.id);t&&Object.defineProperty(i,e.key,{get:function(){return t},configurable:!0})})),i},e}(),ui=function(){function e(){this.notificationCenter=new r.NotificationCenter,this.plugins={},this.uuid=r.StringUtil.generateRandomId(),this.factory=new ci}return e.prototype.on=function(e,t,r,n){this.notificationCenter.on(e,t,r,n)},e.prototype.fire=function(e,t){void 0===t&&(t=!0),this.notificationCenter.fire(e,t)},e.prototype.removeCallBack=function(e,t){this.notificationCenter.removeCallBack(e,t)},e.prototype.removeListener=function(e,t){this.notificationCenter.removeListener(e,t)},e.prototype.once=function(e,t,r){this.notificationCenter.once(e,t,r)},e.prototype.registerPlugin=function(e){var t=this;Array.isArray(e)?e.forEach((function(e){t.registerPlugin(e)})):e&&Object.keys(e).forEach((function(r){var n=e[r];t.plugins[r]=t.plugins[r]||[],t.plugins[r].unshift(n)}))},e.prototype.unRegisterPlugin=function(e){var t=this;Array.isArray(e)?e.forEach((function(e){t.unRegisterPlugin(e)})):e&&Object.keys(e).forEach((function(r){var n=e[r];t.plugins[r]=t.plugins[r]||[];var o=t.plugins[r],i=o.indexOf(n);i>=0&&o.splice(i,1)}))},e.prototype.run=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var n=this,o=this.plugins[e]||[],i=0;function a(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var s=o[i];if(i+=1,s)return e.length&&(t=e),s.apply(void 0,ti([n,a],t))}return a()},e.prototype.reset=function(){this.notificationCenter.reset(),this.plugins={}},e}(),hi=new ui;(si=e.OperationType||(e.OperationType={}))[si.None=0]="None",si[si.InsertText=1]="InsertText",si[si.InsertParagraph=2]="InsertParagraph",si[si.InsertSection=3]="InsertSection",si[si.InsertTableCellPara=4]="InsertTableCellPara",si[si.InsertTableCellStart=5]="InsertTableCellStart",si[si.InsertTableRowPara=6]="InsertTableRowPara",si[si.InsertTableRowStart=7]="InsertTableRowStart",si[si.InsertTableStartPara=8]="InsertTableStartPara",si[si.InsertTableEndPara=9]="InsertTableEndPara",si[si.ModifyText=10]="ModifyText",si[si.ModifyParagraph=11]="ModifyParagraph",si[si.ModifySection=12]="ModifySection",si[si.ModifyStory=13]="ModifyStory",si[si.ClearText=14]="ClearText",si[si.ClearParagraph=15]="ClearParagraph",si[si.ClearSection=16]="ClearSection",si[si.ClearStory=17]="ClearStory",si[si.DeleteText=18]="DeleteText",si[si.InsertStoryBegin=19]="InsertStoryBegin",si[si.InsertStoryEnd=20]="InsertStoryEnd",si[si.CreateTableStart=21]="CreateTableStart",si[si.CreateTableEnd=22]="CreateTableEnd",si[si.InsertTableRow=23]="InsertTableRow",si[si.InsertTableColumn=24]="InsertTableColumn",si[si.RemoveTableRow=25]="RemoveTableRow",si[si.RemoveTableColumn=26]="RemoveTableColumn",si[si.ModifyCellProp=27]="ModifyCellProp",si[si.MergeCell=28]="MergeCell",si[si.ModifyTableDimension=29]="ModifyTableDimension";var fi,di,gi,yi=function(){function e(e){this.opNeedInverse=!0,this._param=e,this._dirtyRange=null,this.replaceOpArray=[],this.inverseOpArray=[]}return Object.defineProperty(e.prototype,"param",{get:function(){return this._param},enumerable:!0,configurable:!0}),e.prototype.doInverseIfNeed=function(e,t){return this.opNeedInverse?this.doInverse(e,t):[]},e.prototype.apply=function(e,t,r,n,o){r||this.startApply(e,t,o,n),this.doApply(e),r||this.updateDirtyRange(e),r||this.finishApply(e,t,o)},Object.defineProperty(e.prototype,"dirtyRange",{get:function(){return this._dirtyRange?this._dirtyRange.clone():null},enumerable:!0,configurable:!0}),e.prototype.isValid=function(){return!0},e}(),mi=function(e){function t(t){var r=e.call(this,t)||this;return r._oldLen=void 0!==r.param.oldLen?r.param.oldLen:-1,r._finishRange=r.range,r}return Zo(t,e),Object.defineProperty(t.prototype,"param",{get:function(){return this._param},enumerable:!0,configurable:!0}),t.prototype.startApply=function(e,t,r,n){if(t||n)this.param.range=this._fixRangeToHasExceptionRange(this.param.range,r);else{if(this.param.storyId&&this.param.storyId.length>0){var o=e.findStoryInfoFromId(this.param.storyId);o&&(this.param.range.gcpBegin+=o.range.begin())}this._finishRange=this._fixRangeToNoExceptionRange(this.range,r)}},t.prototype.finishApply=function(e,t,r){t||(this.param.range=this._finishRange)},Object.defineProperty(t.prototype,"range",{get:function(){return this.param.range.clone()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"oldLen",{get:function(){return this._oldLen},enumerable:!0,configurable:!0}),t.prototype._fixRangeToHasExceptionRange=function(e,t){var r,n;if(t){var o={rgBegin:e.begin(),rgEnd:e.end()};try{for(var i=$o(t),a=i.next();!a.done;a=i.next()){var s=a.value;o.rgBegin>=s.begin()?(o.rgBegin+=s.length(),o.rgEnd+=s.length()):o.rgEnd>s.begin()&&(o.rgEnd+=s.length())}}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return new ne(o.rgBegin,o.rgEnd-o.rgBegin)}return e},t.prototype._fixRangeToNoExceptionRange=function(e,t){var r,n;if(t){var o={rgBegin:e.begin(),rgEnd:e.end()};try{for(var i=$o(t),a=i.next();!a.done;a=i.next()){var s=a.value;e.begin()>=s.end()?(o.rgBegin-=s.length(),o.rgEnd-=s.length()):e.end()>=s.end()&&(o.rgEnd-=s.length())}}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return new ne(o.rgBegin,o.rgEnd-o.rgBegin)}return e},t.prototype.addReplaceOp=function(e,t,r){if(t){t.doInverseIfNeed(e,t.range).forEach((function(e){t.inverseOpArray.push(e)}));var n=t.param;n.range=this._fixRangeToNoExceptionRange(n.range,r),this.replaceOpArray.push(t)}},t.prototype.addReplaceTableOp=function(e,t,r){t&&(t.doInverseIfNeed(e,r).forEach((function(e){t.inverseOpArray.push(e)})),this.replaceOpArray.push(t))},t}(yi),bi=function(e){function t(t){var r=e.call(this,t)||this;return r.changeLen=0,r.param.modifiedResult||(r.param.modifiedResult={modifiedProps:[],clearedProps:[]}),r}return Zo(t,e),Object.defineProperty(t.prototype,"param",{get:function(){return this._param},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"afterRange",{get:function(){return this.param.range.clone()},enumerable:!0,configurable:!0}),t.prototype._genNormalOp=function(e){throw new Error("_genNormalOp not impelement")},t}(mi),Pi=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return Zo(r,t),r.prototype.startApply=function(r,n,o,i){var a=this;n||i||this.operationType!==e.OperationType.ModifyText&&this.operationType!==e.OperationType.ClearText||this.doInverseIfNeed(r,this.range).forEach((function(e){return a.inverseOpArray.push(e)}));t.prototype.startApply.call(this,r,n,o,i)},r.prototype.updateDirtyRange=function(e){this._dirtyRange=this.param.range.clone()},r.prototype.isValid=function(){return t.prototype.isValid.call(this)&&this.param.range.len>0},r}(bi),vi=function(t){function r(e){return t.call(this,e)||this}return Zo(r,t),Object.defineProperty(r.prototype,"param",{get:function(){return this._param},enumerable:!0,configurable:!0}),r.prototype.doInverse=function(t,r){var n=t.createSpanIterator(this.param.range),o=[];do{var i=n.getRange(!0),a=n.getProperty();if(a){var s=a.clone(),p=a.clone();this.param.propertySetMode===e.TDSetPropMode.Cover?s.cover(this.param.spanProperty):s.merge(this.param.spanProperty);var l=s.cover(p),c={range:i,spanProperty:a,propertySetMode:e.TDSetPropMode.Cover,modifiedResult:l},u=ki.getOp(e.OperationType.ModifyText,c);u&&o.push(u)}}while(n.next());return o},r.prototype.doApply=function(e){e.setTextProp(this.param.range.gcpBegin,this.param.range.len,this.param.spanProperty,this.param.propertySetMode,this.param.modifiedResult)},Object.defineProperty(r.prototype,"operationType",{get:function(){return e.OperationType.ModifyText},enumerable:!0,configurable:!0}),r.prototype._genNormalOp=function(e){return new r({range:e,spanProperty:this.param.spanProperty,propertySetMode:this.param.propertySetMode,modifiedResult:this.param.modifiedResult})},r.prototype.clone=function(){return new r({range:this.param.range.clone(),spanProperty:this.param.spanProperty.clone(),propertySetMode:this.param.propertySetMode,storyId:this.param.storyId})},r}(Pi),xi=function(t){function r(e){return t.call(this,e)||this}return Zo(r,t),Object.defineProperty(r.prototype,"param",{get:function(){return this._param},enumerable:!0,configurable:!0}),r.prototype.doApply=function(e){e.clearTextProp(this.param.range.gcpBegin,this.param.range.len,this.param.clearSpanProps,this.param.modifiedResult)},Object.defineProperty(r.prototype,"operationType",{get:function(){return e.OperationType.ClearText},enumerable:!0,configurable:!0}),r.prototype._genNormalOp=function(t){return new r({range:t,propertySetMode:e.TDSetPropMode.Clear,clearSpanProps:this.param.clearSpanProps,modifiedResult:this.param.modifiedResult})},r.prototype.doInverse=function(t,r){var n=t.createSpanIterator(this.param.range),o=[];do{var i=n.getRange(!0),a=n.getProperty();if(a){var s=a.clone(),p=a.clone();this.param.propertySetMode===e.TDSetPropMode.Clear&&s.clear(this.param.clearSpanProps);var l=s.cover(p),c={range:i,spanProperty:a,propertySetMode:e.TDSetPropMode.Cover,modifiedResult:l},u=ki.getOp(e.OperationType.ModifyText,c);u&&o.push(u)}}while(n.next());return o},r.prototype.clone=function(){return new r({range:this.param.range.clone(),propertySetMode:e.TDSetPropMode.Clear,clearSpanProps:this.param.clearSpanProps,storyId:this.param.storyId})},r}(Pi),Ti=function(){function e(e,t,r,n,o,i){this.originRange=e,this.updateSelection=t,this.needCollab=r,this.fromServer=n,this.isInputDoc=o,this.undoOption=i}return e.createLocalDeltaOption=function(t,r,n){void 0===r&&(r=!0),void 0===n&&(n=!0);return new e(t,r,n,!1,!1,{needInverse:!0,needMergeUndoStackTop:!1,fromUndo:!1})},e.createServerDeltaOption=function(t){return new e(t,!1,!1,!0,!1,{needInverse:!1,needMergeUndoStackTop:!1,fromUndo:!1})},e.prototype.copy=function(){return new e(this.originRange.clone(),this.updateSelection,this.needCollab,this.fromServer,this.isInputDoc,this.undoOption)},e.prototype.buildDelta=function(){return new la(this.copy())},e}();(di=e.OpsType||(e.OpsType={}))[di.Text=0]="Text",di[di.Table=1]="Table",di[di.Mix=2]="Mix",(gi=e.FilterOpType||(e.FilterOpType={}))[gi.None=0]="None",gi[gi.Table=1]="Table",gi[gi.TitleStyle=2]="TitleStyle",gi[gi.Plugin=4]="Plugin";var _i,Si,Ci,Bi=function(){function t(){}return t.moveOffset=function(e,t){var n=e.operationType;return e.param.range?(e.param.range.gcpBegin+=t,e):(r.Logger.info("opertaion "+n+" do not has range!!!!"),null)},t.getFixPos=function(e,t){var r=t;return e.forEach((function(e){var t=e.operationType;Ri[t]&&(r=Ri[t].apply(void 0,[e.param,r]))})),r},t.getFixedGcpRange=function(e,t){var r=this.getFixPos(e,t.begin()),n=this.getFixPos(e,t.end());return t.gcpBegin=r,t.len=n-r,t},t.getOffset=function(e){var t=e.operationType,r=0;return Ri[t]&&(r=Ri[t].apply(void 0,[e.param,16777215])-16777215),r},t.splitCellRange=function(e,t,r){var n=Jn(e.tableStream,t),o=n.tableCellRange,i=n.tableCellGCPRanges;return o&&i?(i.forEach((function(e){e.forEach((function(t,n){r(t,{isLastInRow:n===e.length-1,isFirstInRow:0===n})}))})),o.cellRange):(r(t),null)},t.getOpsType=function(t){var r=this,n=0,o=0,i=!1,a=!1;return t.forEach((function(t){t.operationType===e.OperationType.CreateTableStart||t instanceof Fi?(i=!0,n+=1):t.operationType===e.OperationType.CreateTableEnd||t instanceof Ai?i=!1:t instanceof Li?a=!0:t instanceof Oi?a=!1:a||r.isNumberingOp(t)||i||t.operationType===e.OperationType.MergeCell||(o+=1)})),1===n&&0===o?e.OpsType.Table:0!==n&&0!==o?e.OpsType.Mix:e.OpsType.Text},t.isStartTable=function(t){if(t)for(var r=0;r<t.length;r++){if(t[r].operationType===e.OperationType.InsertTableStartPara)return!0;if(this.getOffset(t[r])){if(this.isNumberingOp(t[r]))continue;return!1}}return!1},t.getNearestOp=function(e,t,r){if(!e)return null;for(var n=r?e.slice(0).reverse():e,o=0;o<n.length;o++)if(n[o].operationType===t)return n[o];return null},t.isNumberingOp=function(t){return t.operationType===e.OperationType.InsertParagraph&&t.param.paraProperty instanceof Zt},t.spliceOpsInCell=function(e){for(var t=0,r=0,n=[],o=[],i=[],a=!1,s=[],p=ne.emptyRange(),l=0;l<e.length;l++){var c=e[l];c instanceof Fi?(a=!0,p.gcpBegin=c.param.range.begin()):c instanceof Ai?(p.len=c.param.range.end()-p.gcpBegin,a=!1):a?c instanceof Di?c.param.spanProperty instanceof Dt?(t+=1,o.push(c),i.push(o),o=[]):c.param.spanProperty instanceof kt?(r+=1,n.push(i),i=[]):c.param.spanProperty instanceof Mt||c&&o.push(c):o.push(c):s.push(c)}return{tableOps:n,cellCount:t,rowCount:r,colCount:t/r,range:p,otherOps:s}},t.getTableCount=function(t){return t?t.filter((function(t){return t.operationType===e.OperationType.CreateTableStart})).length:0},t.checkOpsValid=function(e){for(var t=[{start:Fi,end:Ai,stack:[]},{start:Li,end:Oi,stack:[]}],r=0;r<e.length;r++)for(var n=e[r],o=0;o<t.length;o++){var i=t[o],a=i.start,s=i.end,p=i.stack;if(n instanceof a&&p.push(n),n instanceof s)if(!p.pop())return!1}return t.reduce((function(e,t){return e&&0===t.stack.length}),!0)},t.filterSpecialOps=function(t,r){if(r&e.FilterOpType.Table){var n=!1;t.opFilter((function(e){return e instanceof Fi?(n=!0,!1):e instanceof Ai?(n=!1,!1):!n}))}t.opFilter((function(t){if(t instanceof Mi)if(r&e.FilterOpType.TitleStyle&&t instanceof Di)t.param.paraProperty.styleName="";else if(r&e.FilterOpType.Plugin&&t.param.spanProperty instanceof Ur)return!1;return!0}))},t}(),Ri=((fi={})[e.OperationType.InsertText]=function(e,t){var r=e;return t>=r.range.gcpBegin?t+r.text.length:t},fi[e.OperationType.DeleteText]=function(e,t){var r=e;return t>r.range.gcpBegin?t>r.range.end()?t-r.range.length():r.range.gcpBegin:t},fi[e.OperationType.InsertParagraph]=function(e,t){var r=e;return t>=r.range.gcpBegin?t+r.text.length:t},fi[e.OperationType.InsertTableCellPara]=function(e,t){var r=e;return t>=r.range.gcpBegin?t+r.text.length:t},fi[e.OperationType.InsertTableCellStart]=function(e,t){var r=e;return t>=r.range.gcpBegin?t+r.text.length:t},fi[e.OperationType.InsertTableRowPara]=function(e,t){var r=e;return t>=r.range.gcpBegin?t+r.text.length:t},fi[e.OperationType.InsertTableRowStart]=function(e,t){var r=e;return t>=r.range.gcpBegin?t+r.text.length:t},fi[e.OperationType.InsertTableStartPara]=function(e,t){var r=e;return t>=r.range.gcpBegin?t+r.text.length:t},fi[e.OperationType.InsertTableEndPara]=function(e,t){var r=e;return t>=r.range.gcpBegin?t+r.text.length:t},fi[e.OperationType.InsertSection]=function(e,t){var r=e;return t>=r.range.gcpBegin?t+r.text.length:t},fi[e.OperationType.InsertStoryBegin]=function(e,t){var r=e;return t>=r.range.gcpBegin?t+(r.placeholder?r.placeholder.length:0):t},fi[e.OperationType.InsertStoryEnd]=function(e,t){var r=e;return t>=r.range.gcpBegin?t+(r.placeholder?r.placeholder.length:0):t},fi),wi=function(){function t(){}return t.collectDataToDelta=function(t,n,o,i){void 0===i&&(i=!0);var a=t.createDataIterator(o),s=n.currentRange().begin(),p=Ti.createLocalDeltaOption(ne.emptyRange()).buildDelta(),l=this.recursiveCollectDataToDelta(t,a,n,p,o,s,i);return-1!==l.findIndex((function(t){return t.storyId===e.StoryID.ListTemplateId}))?r.Logger.warn("StoryDeltas should not have list templateDelta at this point"):p.operations.length>0&&l.push({storyId:e.StoryID.ListTemplateId,delta:p}),l},t.collectDataForCopy=function(t,n,o,i){var a=this;void 0===i&&(i=!0);var s=t.tableStream.getTableInfoFromGcp(o.begin()),p=t.tableStream.getTableCellInfoFromGcp(o.begin());if(s&&p){if(p.range.length()<=o.length()){var l=[],c=Ti.createLocalDeltaOption(ne.emptyRange()).buildDelta(),u=s.range.intersectRange(o),h=new $r;h.tableDepth=1;var f=new kt,d=new Mt,g=s.property.clone();g.tableId=r.StringUtil.generateRandomId(),n.startCreateTable(n.currentRange().end(),g);var y=Bi.splitCellRange(t,u,(function(e,r){var o=t.createDataIterator(e);return r&&r.isFirstInRow&&n.insertTableRowStart(n.currentRange().end(),d),l=l.concat(a.recursiveCollectDataToDelta(t,o,n,c,e,n.currentRange().end(),i)),r&&r.isLastInRow&&n.insertTableRowPara(n.currentRange().end(),f,h),!0}));return y&&g.colWidths.length&&(g.colWidths=s.property.colWidths.slice(y.from.col,y.to.col+1)),y&&g.rowHeights.length&&(g.rowHeights=s.property.rowHeights.slice(y.from.row,y.to.row+1)),n.endCreateTable(n.currentRange().end(),g),-1!==l.findIndex((function(t){return t.storyId===e.StoryID.ListTemplateId}))?r.Logger.warn("StoryDeltas should not have list templateDelta at this point"):c.operations.length>0&&l.push({storyId:e.StoryID.ListTemplateId,delta:c}),l}return this.collectDataToDelta(t,n,new ne(o.begin(),Math.min(p.range.end()-1,o.end())-o.begin()),i)}return this.collectDataToDelta(t,n,o,i)},t.collectDataToOps=function(e,t,r){void 0===r&&(r=!0);var n=Ti.createLocalDeltaOption(ne.emptyRange()).buildDelta();return n.moveTo(new ne(t.begin(),0)),this.collectDataToDelta(e,n,t,r),n.operations},t.recursiveCollectDataToDelta=function(t,r,n,o,i,a,s){void 0===s&&(s=!0);var p=[];do{var l=r.getSpanProp(),c=r.getRange(e.IterType.Span,!0);if(c.isEmpty())break;var u=t.readText(c.begin(),c.length());if(s&&l&&l.isStoryPlaceholder){var h=l.storyId;if(h){var f=n.currentRange().end();this.collectSpanPropertyToDelta(t,r,n,o,l,u,f,p);var d=t.findStoryInfoFromId(h);if(d){var g=new ne(d.range.begin()-1,d.range.length()+2),y=t.createDataIterator(g),m=Ti.createLocalDeltaOption(ne.emptyRange()).buildDelta(),b={storyId:h,delta:m};p=p.concat(b,this.recursiveCollectDataToDelta(t,y,m,o,g,0,s))}}}else{f=n.currentRange().end();this.collectSpanPropertyToDelta(t,r,n,o,l,u,f,p)}}while(r.next(e.IterType.Span));return p},t.collectSpanPropertyToDelta=function(e,t,r,n,o,i,a,s){Ii[o.propertyType]?Ii[o.propertyType].apply(void 0,[e,t,r,n,o,i,a,s]):o&&r.insertSpan(a,i,o)},t.addListTemplateToDelta=function(t,r,n,o){if(n.listId&&n.listTemplateId){var i=r,a=t.findStoryInfoFromId(e.StoryID.ListTemplateId)||t.findStoryInfoFromId(e.StoryID.ListTemplateIdCompt);if(!a)return;var s=t.createDataIterator(a.range),p=i.currentRange().end(),l=function(){if(!(s.getParaProp()instanceof Zt))return"continue";var t=s.getParaProp();i.operations.find((function(e){return e instanceof Di&&e.param.paraProperty instanceof Zt&&e.param.paraProperty.listTemplateId===t.listTemplateId&&e.param.paraProperty.listLevel===t.listLevel}))||n.listTemplateId!==t.listTemplateId||(i.insertParagraph(p,o,t,e.StoryID.ListTemplateId),p+=1)};do{l()}while(s.next(e.IterType.Paragraph))}},t.getStoryPropFromDataIterator=function(t,r){var n=r.getRange(e.IterType.Span,!0);return t.createStoryIterator(n).getProperty()},t.getAfterGCPFromAtext=function(e){try{return JSON.parse(e).atext.text.length}catch(e){return 0}},t}(),Ii=((_i={})[e.PropertyType.TableCellBreakSpan]=function(e,t,r,n,o,i,a){var s=t.getParaProp();if(!(s&&s instanceof an&&o instanceof Dt))throw Error("data collector cellinfo is null");r.insertTableCellPara(a,o,s),wi.addListTemplateToDelta(e,n,s,o)},_i[e.PropertyType.TableCellStartSpan]=function(e,t,r,n,o,i,a){if(!(o instanceof Ft))throw Error("data collector cellinfo is null");r.insertTableCellStart(a,o)},_i[e.PropertyType.TableRowBreakSpan]=function(e,t,r,n,o,i,a){var s=t.getParaProp();if(!(s&&s instanceof $r&&o instanceof kt))throw Error("data collector rowinfo is null");r.insertTableRowPara(a,o,s)},_i[e.PropertyType.TableRowStartSpan]=function(e,t,r,n,o,i,a){if(!(o instanceof Mt))throw Error("data collector rowinfo is null");r.insertTableRowStart(a,o)},_i[e.PropertyType.TableStartBreakSpan]=function(e,t,n){var o=e.tableStream.getTableInfoFromGcp(t.getCurrentGCP()+1);if(!o)throw Error("data collector tableinfo is null");var i=o.property.clone();i.tableId=r.StringUtil.generateRandomId(),n.startCreateTable(n.currentRange().end(),i)},_i[e.PropertyType.TableEndBreakSpan]=function(t,r,n){var o=Bi.getNearestOp(n.operations,e.OperationType.InsertTableStartPara,!0);if(!(o instanceof Fi&&o.param.paraProperty instanceof qr))throw Error("data collector, cannot find start table op");n.endCreateTable(n.currentRange().end(),o.param.paraProperty)},_i[e.PropertyType.SectBreakSpan]=function(e,t,r,n,o,i,a){var s=t.getSectProp();s&&o instanceof Lt&&r.insertSection(a,o,s)},_i[e.PropertyType.ParaBreakSpan]=function(e,t,r,n,o,i,a){var s=t.getParaProp();s&&o instanceof Nt&&(r.insertParagraph(a,o,s),wi.addListTemplateToDelta(e,n,s,o))},_i[e.PropertyType.StoryBreakSpan]=function(e,t,r,n,o,i,a){var s=wi.getStoryPropFromDataIterator(e,t);s&&s instanceof Vt&&(uo.StoryBegin===i?r.insertStoryBegin(a,s,uo.StoryBegin):uo.StoryEnd===i&&r.insertStoryEnd(a,s,uo.StoryEnd))},_i),Ei=function(t){function r(){var e=null!==t&&t.apply(this,arguments)||this;return e.checkException=!1,e.exceptionDirtyLen=0,e}return Zo(r,t),r.prototype.startApply=function(e,r,n,o){var i;if(r||o)this.checkException=!0,this.exceptionRanges=n;else{var a=this.doInverseIfNeed(e,this.range);(i=this.inverseOpArray).push.apply(i,ti(a))}t.prototype.startApply.call(this,e,r,n,o)},r.prototype.doInverse=function(e,t){return wi.collectDataToOps(e,t,!1).reverse()},r.prototype.doApply=function(e){var t=this;if(this.checkException&&this.exceptionRanges&&0!==this.exceptionRanges.length){var r=this.param.range.clone(),n=[];this.exceptionRanges.some((function(e){return e.len>0&&r.contains(e)&&(e.gcpBegin>r.gcpBegin&&n.push(new ne(r.gcpBegin,e.gcpBegin-r.gcpBegin)),r=new ne(e.end(),r.end()-e.end()),t.exceptionDirtyLen+=e.len),e.gcpBegin>=r.end()})),n.push(r);var o=0;n.forEach((function(t){e.deleteText(t.gcpBegin-o,t.len),o+=t.len}))}else e.deleteText(this.param.range.gcpBegin,this.param.range.len)},Object.defineProperty(r.prototype,"afterRange",{get:function(){return new ne(this.param.range.gcpBegin,0)},enumerable:!0,configurable:!0}),r.prototype.updateDirtyRange=function(e){this._dirtyRange=new ne(this.param.range.gcpBegin,this.exceptionDirtyLen+1)},Object.defineProperty(r.prototype,"changeLen",{get:function(){return-this.range.length()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"operationType",{get:function(){return e.OperationType.DeleteText},enumerable:!0,configurable:!0}),r.prototype.isValid=function(){return t.prototype.isValid.call(this)&&this.param.range.len>0},r.prototype.clone=function(){return new r({range:this.param.range.clone(),storyId:this.param.storyId})},r}(mi),Li=function(t){function r(e){return t.call(this,e)||this}return Zo(r,t),r.prototype.doInverse=function(e,t){var r=new ne(this.param.range.gcpBegin,this.param.placeholder?this.param.placeholder.length:0);return[new Ei({range:r})]},Object.defineProperty(r.prototype,"param",{get:function(){return this._param},enumerable:!0,configurable:!0}),r.prototype.startApply=function(r,n,o,i){var a,s;if(!n&&!i&&this.operationType===e.OperationType.InsertStoryBegin){var p=this.doInverseIfNeed(r);try{for(var l=$o(p),c=l.next();!c.done;c=l.next()){var u=c.value;this.inverseOpArray.push(u)}}catch(e){a={error:e}}finally{try{c&&!c.done&&(s=l.return)&&s.call(l)}finally{if(a)throw a.error}}}t.prototype.startApply.call(this,r,n,o,i)},r.prototype.doApply=function(e){e.insertStoryBegin(this.param.range.begin(),this.param.storyProp,this.param.placeholder)},Object.defineProperty(r.prototype,"afterRange",{get:function(){return new ne(this.param.range.gcpBegin+(this.param.placeholder?this.param.placeholder.length:0),0)},enumerable:!0,configurable:!0}),r.prototype.updateDirtyRange=function(e){this._dirtyRange=new ne(this.param.range.gcpBegin,this.param.placeholder?this.param.placeholder.length:0)},Object.defineProperty(r.prototype,"changeLen",{get:function(){return this.param.placeholder?this.param.placeholder.length:0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"operationType",{get:function(){return e.OperationType.InsertStoryBegin},enumerable:!0,configurable:!0}),r.prototype.clone=function(){return new r({range:this.param.range.clone(),storyProp:this.param.storyProp,placeholder:this.param.placeholder})},r}(mi),Oi=function(t){function r(e){return t.call(this,e)||this}return Zo(r,t),r.prototype.doInverse=function(e,t){var r=new ne(this.param.range.gcpBegin,this.param.placeholder?this.param.placeholder.length:0);return[new Ei({range:r})]},Object.defineProperty(r.prototype,"param",{get:function(){return this._param},enumerable:!0,configurable:!0}),r.prototype.startApply=function(r,n,o,i){var a,s;if(!n&&!i&&this.operationType===e.OperationType.InsertStoryEnd){var p=this.doInverseIfNeed(r);try{for(var l=$o(p),c=l.next();!c.done;c=l.next()){var u=c.value;this.inverseOpArray.push(u)}}catch(e){a={error:e}}finally{try{c&&!c.done&&(s=l.return)&&s.call(l)}finally{if(a)throw a.error}}}t.prototype.startApply.call(this,r,n,o,i)},r.prototype.doApply=function(e){e.insertStoryEnd(this.param.range.begin(),this.param.storyProp,this.param.placeholder)},Object.defineProperty(r.prototype,"afterRange",{get:function(){return new ne(this.param.range.gcpBegin+this.param.placeholder.length,0)},enumerable:!0,configurable:!0}),r.prototype.updateDirtyRange=function(e){this._dirtyRange=new ne(this.param.range.gcpBegin,this.param.placeholder.length)},Object.defineProperty(r.prototype,"changeLen",{get:function(){return this.param.placeholder.length},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"operationType",{get:function(){return e.OperationType.InsertStoryEnd},enumerable:!0,configurable:!0}),r.prototype.clone=function(){return new r({range:this.param.range.clone(),storyProp:this.param.storyProp,placeholder:this.param.placeholder})},r}(mi),Ni=((Si={})[e.OperationType.InsertTableStartPara]=function(e){return{op:new Fi(e)}},Si[e.OperationType.InsertTableEndPara]=function(e){return{op:new Ai(e)}},Si[e.OperationType.InsertText]=function(e){return{op:new Mi(e)}},Si[e.OperationType.ModifyParagraph]=function(e){return{op:new Wi(e)}},Si[e.OperationType.ClearParagraph]=function(e){return{op:new Yi(e)}},Si[e.OperationType.DeleteText]=function(e){return{op:new Ei(e)}},Si[e.OperationType.ModifyText]=function(e){return{op:new vi(e)}},Si[e.OperationType.ClearText]=function(e){return{op:new xi(e)}},Si[e.OperationType.ModifySection]=function(e){return{op:new Xi(e)}},Si[e.OperationType.ModifyStory]=function(e){return{op:new sa(e)}},Si[e.OperationType.InsertParagraph]=function(e){return{op:new Di(e)}},Si[e.OperationType.InsertTableCellPara]=function(e){return{op:new Ki(e)}},Si[e.OperationType.InsertTableCellStart]=function(e){return{op:new Gi(e)}},Si[e.OperationType.InsertTableRowPara]=function(e){return{op:new Hi(e)}},Si[e.OperationType.InsertTableRowStart]=function(e){return{op:new ji(e)}},Si[e.OperationType.InsertStoryBegin]=function(e){return{op:new Li(e)}},Si[e.OperationType.InsertStoryEnd]=function(e){return{op:new Oi(e)}},Si),ki=function(){function e(){}return e.getOp=function(e,t){return Ni[e]?Ni[e].apply(void 0,[t]).op:null},e}(),Mi=function(t){function r(e){return e.range.len=0,t.call(this,e)||this}return Zo(r,t),Object.defineProperty(r.prototype,"param",{get:function(){return this._param},enumerable:!0,configurable:!0}),r.prototype.startApply=function(r,n,o,i){var a;if(!n&&!i&&this.operationType===e.OperationType.InsertText){var s=this.doInverseIfNeed(r,this.range);(a=this.inverseOpArray).push.apply(a,ti(s))}t.prototype.startApply.call(this,r,n,o,i)},r.prototype.doInverse=function(t,r){var n=[],o=this.range;o.len=this.param.text.length;var i={range:o},a=ki.getOp(e.OperationType.DeleteText,i);return a&&n.push(a),n},r.prototype.doApply=function(e){e.insertText(this.param.range.gcpBegin,this.param.text.length,this.param.text,this.param.spanProperty)},Object.defineProperty(r.prototype,"afterRange",{get:function(){return new ne(this.param.range.gcpBegin+this.param.text.length,0)},enumerable:!0,configurable:!0}),r.prototype.updateDirtyRange=function(e){this._dirtyRange=new ne(this.param.range.gcpBegin,this.param.text.length)},Object.defineProperty(r.prototype,"changeLen",{get:function(){return this.param.text.length},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"operationType",{get:function(){return e.OperationType.InsertText},enumerable:!0,configurable:!0}),r.prototype.isValid=function(){return t.prototype.isValid.call(this)&&this.param.text.length>0},r.prototype.clone=function(){return new r({range:this.param.range.clone(),text:this.param.text,spanProperty:this.param.spanProperty.clone(),storyId:this.param.storyId})},r}(mi),Di=function(t){function r(e){return t.call(this,e)||this}return Zo(r,t),Object.defineProperty(r.prototype,"param",{get:function(){return this._param},enumerable:!0,configurable:!0}),r.prototype.startApply=function(e,r,n,o){var i,a;if(!r&&!o){var s=this.doInverseIfNeed(e,this.range);try{for(var p=$o(s),l=p.next();!l.done;l=p.next()){var c=l.value;this.inverseOpArray.push(c)}}catch(e){i={error:e}}finally{try{l&&!l.done&&(a=p.return)&&a.call(p)}finally{if(i)throw i.error}}}t.prototype.startApply.call(this,e,r,n,o)},r.prototype.doApply=function(e){e.insertParagraph(this.param.range.gcpBegin,this.param.text,this.param.spanProperty,this.param.paraProperty)},Object.defineProperty(r.prototype,"operationType",{get:function(){return e.OperationType.InsertParagraph},enumerable:!0,configurable:!0}),r.prototype.clone=function(){return new r({range:this.param.range.clone(),text:this.param.text,spanProperty:this.param.spanProperty.clone(),paraProperty:this.param.paraProperty.clone().genNewParaId(),storyId:this.param.storyId})},r}(Mi),Fi=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return Zo(r,t),Object.defineProperty(r.prototype,"operationType",{get:function(){return e.OperationType.InsertTableStartPara},enumerable:!0,configurable:!0}),r.prototype.doApply=function(e){t.prototype.doApply.call(this,e),e.rwTableStream.startCreateTable(this.param.range.begin()+1)},r.prototype.clone=function(){return new r({range:this.param.range.clone(),text:this.param.text,spanProperty:this.param.spanProperty.clone(),paraProperty:this.param.paraProperty.clone().genNewParaId(),storyId:this.param.storyId})},r}(Di),Ai=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return Zo(r,t),Object.defineProperty(r.prototype,"operationType",{get:function(){return e.OperationType.InsertTableEndPara},enumerable:!0,configurable:!0}),r.prototype.doApply=function(e){t.prototype.doApply.call(this,e),e.rwTableStream.endCreateTable(this.param.range.begin(),this.param.paraProperty)},r.prototype.updateDirtyRange=function(e){var t=e.tableStream.getTableInfoFromGcp(this.range.begin()-1);t&&(this._dirtyRange=ne.inset(t.range,-1))},r.prototype.clone=function(){return new r({range:this.param.range.clone(),text:this.param.text,spanProperty:this.param.spanProperty.clone(),paraProperty:this.param.paraProperty.clone().genNewParaId(),storyId:this.param.storyId})},r}(Di),Ki=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return Zo(r,t),Object.defineProperty(r.prototype,"operationType",{get:function(){return e.OperationType.InsertTableCellPara},enumerable:!0,configurable:!0}),r.prototype.clone=function(){return new r({range:this.param.range.clone(),text:this.param.text,spanProperty:this.param.spanProperty.clone(),paraProperty:this.param.paraProperty.clone().genNewParaId(),storyId:this.param.storyId})},r}(Di),Gi=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return Zo(r,t),Object.defineProperty(r.prototype,"operationType",{get:function(){return e.OperationType.InsertTableCellStart},enumerable:!0,configurable:!0}),r.prototype.clone=function(){return new r({range:this.param.range.clone(),text:this.param.text,spanProperty:this.param.spanProperty.clone(),paraProperty:this.param.paraProperty.clone().genNewParaId(),storyId:this.param.storyId})},r}(Di),Hi=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return Zo(r,t),Object.defineProperty(r.prototype,"operationType",{get:function(){return e.OperationType.InsertTableRowPara},enumerable:!0,configurable:!0}),r.prototype.clone=function(){return new r({range:this.param.range.clone(),text:this.param.text,spanProperty:this.param.spanProperty.clone(),paraProperty:this.param.paraProperty.clone().genNewParaId(),storyId:this.param.storyId})},r}(Di),ji=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return Zo(r,t),Object.defineProperty(r.prototype,"operationType",{get:function(){return e.OperationType.InsertTableRowStart},enumerable:!0,configurable:!0}),r.prototype.clone=function(){return new r({range:this.param.range.clone(),text:this.param.text,spanProperty:this.param.spanProperty.clone(),paraProperty:this.param.paraProperty.clone().genNewParaId(),storyId:this.param.storyId})},r}(Di),Ui=function(t){function r(e){return t.call(this,e)||this}return Zo(r,t),Object.defineProperty(r.prototype,"param",{get:function(){return this._param},enumerable:!0,configurable:!0}),r.prototype.doApply=function(e){e.insertSection(this.param.range.gcpBegin,this.param.text,this.param.spanProperty,this.param.sectionProperty)},Object.defineProperty(r.prototype,"operationType",{get:function(){return e.OperationType.InsertSection},enumerable:!0,configurable:!0}),r}(Mi),zi=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return Zo(r,t),r.prototype.startApply=function(r,n,o,i){n||i||this.operationType!==e.OperationType.ModifyParagraph&&this.operationType!==e.OperationType.ClearParagraph||this._handleMix(r,n,o),t.prototype.startApply.call(this,r,n,o,i)},r.prototype.updateDirtyRange=function(e){var t=e.createParagraphIterator();t.seek(this.param.range.begin());var r=t.getRange();if(r.end()<this.param.range.end()){t.seek(this.param.range.end()-1);var n=t.getRange().end();r.len=n-r.begin()}this._dirtyRange=r},r.prototype.isValid=function(){return!0},r.prototype._handleMix=function(e,t,r){var n=e.createParagraphIterator(this.param.range);do{if(n.getProperty()){var o=n.getRange(),i=new ne(o.end()-1,1),a=this._genNormalOp(i);this.addReplaceOp(e,a,r)}}while(n.next())},r}(bi),Wi=function(t){function r(e){return t.call(this,e)||this}return Zo(r,t),r.prototype.doInverse=function(t,r){var n=t.createParagraphIterator(r),o=[];do{var i=n.getRange(!0),a=n.getProperty();if(a){var s=a.clone(),p=a.clone();this.param.propertySetMode===e.TDSetPropMode.Cover?s.cover(this.param.paraProperty):s.merge(this.param.paraProperty);var l=s.cover(p),c={range:i,paraProperty:a,propertySetMode:e.TDSetPropMode.Cover,modifiedResult:l},u=ki.getOp(e.OperationType.ModifyParagraph,c);u&&o.push(u)}}while(n.next());return o},Object.defineProperty(r.prototype,"param",{get:function(){return this._param},enumerable:!0,configurable:!0}),r.prototype.doApply=function(e){e.setParaProp(this.param.range.begin(),this.param.range.length(),this.param.paraProperty,this.param.propertySetMode,this.param.modifiedResult)},Object.defineProperty(r.prototype,"operationType",{get:function(){return e.OperationType.ModifyParagraph},enumerable:!0,configurable:!0}),r.prototype._genNormalOp=function(e){return new r({range:e,paraProperty:this.param.paraProperty,propertySetMode:this.param.propertySetMode,modifiedResult:this.param.modifiedResult})},r.prototype.clone=function(){return new r({range:this.param.range.clone(),paraProperty:this.param.paraProperty.clone(),propertySetMode:this.param.propertySetMode,storyId:this.param.storyId})},r}(zi),Vi=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Zo(t,e),t.prototype.updateDirtyRange=function(e){var t=e.tableStream.getTableInfoFromGcp(this.range.begin()-1);t&&(this._dirtyRange=t.range)},t}(Wi),Yi=function(t){function r(e){return t.call(this,e)||this}return Zo(r,t),r.prototype.doInverse=function(t,r){var n=t.createParagraphIterator(r),o=[];do{var i=n.getRange(!0),a=n.getProperty();if(a){var s=a.clone(),p=a.clone();this.param.propertySetMode===e.TDSetPropMode.Clear&&s.clear(this.param.clearParaProps);var l=s.cover(p),c={range:i,paraProperty:a,propertySetMode:e.TDSetPropMode.Cover,modifiedResult:l},u=ki.getOp(e.OperationType.ModifyParagraph,c);u&&o.push(u)}}while(n.next());return o},Object.defineProperty(r.prototype,"param",{get:function(){return this._param},enumerable:!0,configurable:!0}),r.prototype.doApply=function(e){e.clearParaProp(this.param.range.begin(),this.param.range.length(),this.param.clearParaProps,this.param.modifiedResult)},Object.defineProperty(r.prototype,"operationType",{get:function(){return e.OperationType.ClearParagraph},enumerable:!0,configurable:!0}),r.prototype._genNormalOp=function(e){return new r({range:e,propertySetMode:this.param.propertySetMode,clearParaProps:this.param.clearParaProps,modifiedResult:this.param.modifiedResult})},r.prototype.clone=function(){return new r({range:this.param.range.clone(),propertySetMode:e.TDSetPropMode.Clear,clearParaProps:this.param.clearParaProps,storyId:this.param.storyId})},r}(zi),qi=function(t){function r(e){var r=t.call(this,e)||this;return r._allSectDirty=!1,r}return Zo(r,t),r.prototype.startApply=function(r,n,o,i){var a,s;if(!(n||i||this.operationType!==e.OperationType.ModifySection&&this.operationType!==e.OperationType.ClearSection)){var p=r.createSectionIterator(this.range);do{if(p.getProperty()){var l=p.getRange(),c=new ne(l.end()-1,1),u=this._genNormalOp(c);if(u){var h=u.doInverseIfNeed(r,c);try{for(var f=(a=void 0,$o(h)),d=f.next();!d.done;d=f.next()){var g=d.value;u.inverseOpArray.push(g)}}catch(e){a={error:e}}finally{try{d&&!d.done&&(s=f.return)&&s.call(f)}finally{if(a)throw a.error}}this.replaceOpArray.push(u)}}}while(p.next())}t.prototype.startApply.call(this,r,n,o,i)},r.prototype.isValid=function(){return!0},r.prototype.updateDirtyRange=function(t){if(this.param.modifiedResult){var r=this.param.modifiedResult.modifiedProps,n=this.param.modifiedResult.clearedProps,o=t.createSectionIterator();o.seek(this.param.range.end()-1);var i=o.getRange().end();if(r.indexOf(e.SectPropKey.pageWidth)>=0||r.indexOf(e.SectPropKey.marginLeft)>=0||r.indexOf(e.SectPropKey.marginRight)>=0||r.indexOf(e.SectPropKey.marginTop)>=0||r.indexOf(e.SectPropKey.marginBottom)>=0||n.indexOf(e.SectPropKey.pageWidth)>=0||n.indexOf(e.SectPropKey.marginLeft)>=0||n.indexOf(e.SectPropKey.marginRight)>=0||n.indexOf(e.SectPropKey.marginTop)>=0||n.indexOf(e.SectPropKey.marginBottom)>=0){this._allSectDirty=!0,o.seek(this.param.range.begin());var a=o.getRange().begin();this._dirtyRange=new ne(a,i-a)}else this._dirtyRange=new ne(i-1,1)}},r.prototype.isAllSectDirty=function(){return this._allSectDirty},r}(bi),Xi=function(t){function r(e){return t.call(this,e)||this}return Zo(r,t),r.prototype.doInverse=function(t,r){var n=t.createSectionIterator(r),o=[];do{var i=n.getRange(!0),a=n.getProperty();if(a){var s=a.clone(),p=a.clone();this.param.propertySetMode===e.TDSetPropMode.Cover?s.cover(this.param.sectionProperty):s.merge(this.param.sectionProperty);var l=s.cover(p),c={range:i,sectionProperty:a,propertySetMode:e.TDSetPropMode.Cover,modifiedResult:l},u=ki.getOp(e.OperationType.ModifySection,c);u&&o.push(u)}}while(n.next());return o},Object.defineProperty(r.prototype,"param",{get:function(){return this._param},enumerable:!0,configurable:!0}),r.prototype._genNormalOp=function(e){return new r({range:e,sectionProperty:this.param.sectionProperty,propertySetMode:this.param.propertySetMode,modifiedResult:this.param.modifiedResult})},r.prototype.doApply=function(e){e.setSectionProp(this.param.range.begin(),this.param.range.length(),this.param.sectionProperty,this.param.propertySetMode,this.param.modifiedResult)},Object.defineProperty(r.prototype,"operationType",{get:function(){return e.OperationType.ModifySection},enumerable:!0,configurable:!0}),r.prototype.clone=function(){return new r({range:this.range.clone(),sectionProperty:this.param.sectionProperty.clone(),propertySetMode:this.param.propertySetMode,storyId:this.param.storyId})},r}(qi),Ji=function(t){function r(e){return t.call(this,e)||this}return Zo(r,t),r.prototype.doInverse=function(t,r){var n=t.createSectionIterator(r),o=[];do{var i=n.getRange(!0),a=n.getProperty();if(a){var s=a.clone(),p=a.clone();this.param.propertySetMode===e.TDSetPropMode.Clear&&s.clear(this.param.clearSectionProps);var l=s.cover(p),c={range:i,sectionProperty:a,propertySetMode:e.TDSetPropMode.Cover,modifiedResult:l},u=ki.getOp(e.OperationType.ModifySection,c);u&&o.push(u)}}while(n.next());return o},Object.defineProperty(r.prototype,"param",{get:function(){return this._param},enumerable:!0,configurable:!0}),r.prototype.doApply=function(e){e.clearSectionProp(this.param.range.begin(),this.param.range.length(),this.param.clearSectionProps,this.param.modifiedResult)},Object.defineProperty(r.prototype,"operationType",{get:function(){return e.OperationType.ClearSection},enumerable:!0,configurable:!0}),r.prototype._genNormalOp=function(e){return new r({range:e,propertySetMode:this.param.propertySetMode,clearSectionProps:this.param.clearSectionProps,modifiedResult:this.param.modifiedResult})},r.prototype.clone=function(){return new r({range:this.param.range.clone(),propertySetMode:e.TDSetPropMode.Clear,clearSectionProps:this.param.clearSectionProps,storyId:this.param.storyId})},r}(qi),Zi=function(e){function t(t){return e.call(this,t)||this}return Zo(t,e),Object.defineProperty(t.prototype,"param",{get:function(){return this._param},enumerable:!0,configurable:!0}),t.prototype.startApply=function(e,t,r){},t.prototype.finishApply=function(e,t,r){},t.prototype.updateDirtyRange=function(e){},t.prototype.seriesGCPRange=function(e){if(e.length>0){var t=e[0].begin(),r=e[e.length-1].end();return new ne(t,r-t)}return ne.emptyRange()},t.prototype._fixRangeToNoExceptionRange=function(e,t){var r,n;if(t){var o={rgBegin:e.begin(),rgEnd:e.end()};try{for(var i=$o(t),a=i.next();!a.done;a=i.next()){var s=a.value;e.begin()>=s.end()?(o.rgBegin-=s.length(),o.rgEnd-=s.length()):e.end()>=s.end()&&(o.rgEnd-=s.length())}}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return new ne(o.rgBegin,o.rgEnd-o.rgBegin)}return e},t.prototype.addReplaceOp=function(e,t,r){t.inverseOpArray=t.doInverseIfNeed(e,t.range),t.param.range=this._fixRangeToNoExceptionRange(t.param.range,r),this.replaceOpArray.push(t)},Object.defineProperty(t.prototype,"range",{get:function(){return ne.emptyRange()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"afterRange",{get:function(){return ne.invalidRange()},enumerable:!0,configurable:!0}),t}(yi),Qi=function(t){function r(e){return t.call(this,e)||this}return Zo(r,t),r.prototype.doInverse=function(e,t){return[]},Object.defineProperty(r.prototype,"param",{get:function(){return this._param},enumerable:!0,configurable:!0}),r.prototype.startApply=function(r,n,o){var i=this;this.cellRangeEach(r,(function(t,n){var a=new ne(t.end()-1,1),s=new Wi({range:a,paraProperty:n.clone(),propertySetMode:e.TDSetPropMode.Merge});i.addReplaceOp(r,s,o)})),t.prototype.startApply.call(this,r,n,o)},r.prototype.doApply=function(t){var r=[];this.cellRangeEach(t,(function(n,o){t.setParaProp(n.begin(),n.length(),o,e.TDSetPropMode.Merge),r.push(n)})),this._dirtyRange=this.seriesGCPRange(r)},r.prototype.cellRangeEach=function(e,t){var r=this.param,n=r.cellRange,o=r.tableProp,i=r.cellProps,a=r.cellProp,s=o.tableId,p=n.from,l=p.row,c=p.col;Hn(n,!1,(function(r,n){if(i){var o=r-l,p=n-c;if(o<i.length&&p<i[o].length){var u=i[o][p];if(!(h=e.rwTableStream.getTableCellInfo(s,r,n)))return!0;t(new ne(h.range.end()-1,1),u)}}else if(a){var h;if(!(h=e.rwTableStream.getTableCellInfo(s,r,n)))return!0;t(new ne(h.range.end()-1,1),a)}return!0}))},Object.defineProperty(r.prototype,"operationType",{get:function(){return e.OperationType.ModifyCellProp},enumerable:!0,configurable:!0}),r.prototype.clone=function(){return new r(Qo({},this.param))},r}(Zi);(Ci=e.TableDimensionType||(e.TableDimensionType={}))[Ci.RowHeight=0]="RowHeight",Ci[Ci.ColWidth=1]="ColWidth",Ci[Ci.PaddingLeft=2]="PaddingLeft",Ci[Ci.PaddingRight=3]="PaddingRight";var $i,ea=function(t){function r(e){var r=t.call(this,e)||this;return r._calResult=null,r}return Zo(r,t),r.prototype.doInverse=function(e,t){return[]},Object.defineProperty(r.prototype,"param",{get:function(){return this._param},enumerable:!0,configurable:!0}),r.prototype.startApply=function(t,r,n){var o=this.getNewTableProp(t);if(this._calResult=o,o){var i=o.tableProp,a=t.rwTableStream.getTableInfo(this.param.tableProp.tableId);if(!a)return;var s=new ne(a.range.end(),1);this._range=s;var p=new qr,l=this.param.dimensionType;l===e.TableDimensionType.RowHeight?p.rowHeights=i.rowHeights:l===e.TableDimensionType.ColWidth?p.colWidths=i.colWidths:l===e.TableDimensionType.PaddingLeft?p.paddingLeft=i.paddingLeft:l===e.TableDimensionType.PaddingRight&&(p.paddingRight=i.paddingRight);var c=new Wi({range:s,paraProperty:p,propertySetMode:e.TDSetPropMode.Merge});this.addReplaceOp(t,c,n)}},r.prototype.doApply=function(t){var r=this._calResult;if(r&&this._range){var n=r.tableProp,o=r.dirtyRange;n&&t.setParaProp(this._range.begin(),this._range.length(),r.tableProp,e.TDSetPropMode.Merge),o&&(this._dirtyRange=o)}},r.prototype.getNewTableProp=function(t){var r=this.param,n=r.dimensionType,o=r.tableProp,i=r.props,a=o.tableId,s=this.param.index||0,p=t.rwTableStream.getTableInfo(a);if(!p)return null;var l=p.property.clone();if(n===e.TableDimensionType.RowHeight){var c=l.rowHeights.slice();this.param.propsBefore=c[s],c[s]=i,l.rowHeights=c;var u=t.tableStream.getTableRowInfo(a,s);if(u)return{tableProp:l,dirtyRange:u.range}}else{if(n===e.TableDimensionType.ColWidth){var h=l.colWidths.slice();return this.param.propsBefore=h[s],h[s]=i,l.colWidths=h,{tableProp:l,dirtyRange:p.range}}if(n===e.TableDimensionType.PaddingLeft||n===e.TableDimensionType.PaddingRight)return n===e.TableDimensionType.PaddingLeft?(this.param.propsBefore=l.paddingLeft,l.paddingLeft=i):(this.param.propsBefore=l.paddingRight,l.paddingRight=i),{tableProp:l,dirtyRange:p.range}}return null},Object.defineProperty(r.prototype,"operationType",{get:function(){return e.OperationType.ModifyTableDimension},enumerable:!0,configurable:!0}),r.prototype.clone=function(){return new r(Qo({},this.param))},r}(Zi),ta=function(t){function r(e){return t.call(this,e)||this}return Zo(r,t),r.prototype.doInverse=function(e,t){return[]},Object.defineProperty(r.prototype,"param",{get:function(){return this._param},enumerable:!0,configurable:!0}),r.prototype.startApply=function(r,n,o){var i=this;this.cellRangeEach(r,(function(t,n){var a=new ne(t.end()-1,1),s=new Wi({range:a,paraProperty:n.clone(),propertySetMode:e.TDSetPropMode.Merge});i.addReplaceOp(r,s,o)})),t.prototype.startApply.call(this,r,n,o)},r.prototype.doApply=function(e){var t=this.param,r=t.tableProp,n=t.cellRange,o=t.isUnMerge,i=r.tableId;this.mergeCell(e,i,n,o);var a=[];Hn(n,!1,(function(t,r){var n=e.tableStream.getTableCellInfo(i,t,r);return n&&a.push(n.range),!0})),this._dirtyRange=this.seriesGCPRange(a)},r.prototype.mergeCell=function(t,r,n,o){return this.cellRangeEach(t,(function(r,n){t.setParaProp(r.begin(),r.length(),n,e.TDSetPropMode.Merge)})),!0},r.prototype.cellRangeEach=function(e,t){var r=this.param,n=r.tableProp,o=r.cellRange,i=r.isUnMerge,a=n.tableId,s=e.rwTableStream.getTableCellInfo(a,o.from.row,o.from.col);if(!s)return!1;var p=s.property.clone();return p.rowSpan=i?1:o.to.row-o.from.row+1,p.colSpan=i?1:o.to.col-o.from.col+1,p.isMerged=!1,t(new ne(s.range.end()-1,1),p),Hn(o,!1,(function(r,n,o){if(!o){var s=e.rwTableStream.getTableCellInfo(a,r,n);if(!s)return!1;var p=s.property.clone();p.isMerged=!i,p.rowSpan=i?1:-1,p.colSpan=i?1:-1,t(new ne(s.range.end()-1,1),p)}return!0})),!0},Object.defineProperty(r.prototype,"operationType",{get:function(){return e.OperationType.MergeCell},enumerable:!0,configurable:!0}),r.prototype.clone=function(){return new r(Qo({},this.param))},r}(Zi),ra=function(t){function r(e){var r=t.call(this,e)||this;return r._newProp=null,r}return Zo(r,t),r.prototype.doInverse=function(e){return[]},Object.defineProperty(r.prototype,"param",{get:function(){return this._param},enumerable:!0,configurable:!0}),r.prototype.startApply=function(r,n,o){var i=this.getNewTableProp(r);this._newProp=i;var a=r.tableStream.getTableInfo(this.param.tableProp.tableId);if(a&&i){var s=new ne(a.range.end(),1),p=new Vi({range:s,paraProperty:i.clone(),propertySetMode:e.TDSetPropMode.Merge});this._range=s,this.addReplaceOp(r,p,o)}t.prototype.startApply.call(this,r,n,o)},r.prototype.doApply=function(t){this._range&&t.setParaProp(this._range.begin(),this._range.length(),this._newProp,e.TDSetPropMode.Merge)},r.prototype.getNewTableProp=function(e){var t=this.param,r=t.tableProp,n=t.index,o=t.amount,i=e.tableStream.getTableInfo(r.tableId);if(i){var a=i.property.clone(),s=a.rowHeights.slice();return s.splice.apply(s,ti([n,0],new Array(o).fill(void 0))),a.rowHeights=s,a}return null},Object.defineProperty(r.prototype,"operationType",{get:function(){return e.OperationType.InsertTableRow},enumerable:!0,configurable:!0}),r.prototype.clone=function(){return new r(Qo({},this.param))},r}(Zi),na=function(t){function r(e){var r=t.call(this,e)||this;return r._newProp=null,r}return Zo(r,t),r.prototype.doInverse=function(e){return[]},Object.defineProperty(r.prototype,"param",{get:function(){return this._param},enumerable:!0,configurable:!0}),r.prototype.startApply=function(r,n,o){var i=this.getNewTableProp(r);this._newProp=i;var a=r.tableStream.getTableInfo(this.param.tableProp.tableId);if(a&&i){var s=new ne(a.range.end(),1),p=new Vi({range:s,paraProperty:i.clone(),propertySetMode:e.TDSetPropMode.Merge});this._range=s,this.addReplaceOp(r,p,o)}t.prototype.startApply.call(this,r,n,o)},r.prototype.doApply=function(t){this._range&&this._newProp&&t.setParaProp(this._range.begin(),this._range.length(),this._newProp,e.TDSetPropMode.Merge)},r.prototype.getNewTableProp=function(e){var t=this.param,r=t.index,n=t.tableProp,o=t.amount,i=e.tableStream.getTableInfo(n.tableId);if(i){var a=i.property.clone(),s=a.colWidths.slice();return s.splice.apply(s,ti([r,0],new Array(o).fill(void 0))),a.colWidths=s,a}return null},Object.defineProperty(r.prototype,"operationType",{get:function(){return e.OperationType.InsertTableColumn},enumerable:!0,configurable:!0}),r.prototype.clone=function(){return new r(Qo({},this.param))},r}(Zi),oa=function(t){function r(e){var r=t.call(this,e)||this;return r._newProp=null,r}return Zo(r,t),r.prototype.doInverse=function(e){return[]},Object.defineProperty(r.prototype,"param",{get:function(){return this._param},enumerable:!0,configurable:!0}),r.prototype.startApply=function(r,n,o){var i=this.getNewTableProp(r);if(this._newProp=i,i){var a=r.tableStream.getTableInfo(this.param.tableProp.tableId);if(a){var s=new ne(a.range.end(),1);this._range=s;var p=new Wi({range:s,paraProperty:i.clone(),propertySetMode:e.TDSetPropMode.Merge});this.addReplaceOp(r,p,o)}}t.prototype.startApply.call(this,r,n,o)},r.prototype.doApply=function(t){var r=this._newProp;t.setParaProp(this._range.begin(),this._range.length(),r,e.TDSetPropMode.Merge)},r.prototype.getNewTableProp=function(e){var t=this.param,r=t.tableProp,n=t.index,o=t.amount,i=r.tableId,a=e.tableStream.getTableInfo(i);if(a){var s=a.property.clone(),p=s.rowHeights.slice();return p.splice(n,o),s.rowHeights=p,s}return null},Object.defineProperty(r.prototype,"operationType",{get:function(){return e.OperationType.RemoveTableRow},enumerable:!0,configurable:!0}),r.prototype.clone=function(){return new r(Qo({},this.param))},r}(Zi),ia=function(t){function r(e){return t.call(this,e)||this}return Zo(r,t),r.prototype.doInverse=function(e){return[]},Object.defineProperty(r.prototype,"param",{get:function(){return this._param},enumerable:!0,configurable:!0}),r.prototype.startApply=function(r,n,o){var i=this.getNewTableProp(r);if(this._newProp=i,i){var a=r.tableStream.getTableInfo(this.param.tableProp.tableId);if(a){var s=new ne(a.range.end(),1),p=new Wi({range:s,paraProperty:i.clone(),propertySetMode:e.TDSetPropMode.Merge});this._range=s,this.addReplaceOp(r,p,o)}}t.prototype.startApply.call(this,r,n,o)},r.prototype.doApply=function(t){var r=this._newProp;t.setParaProp(this._range.begin(),this._range.length(),r,e.TDSetPropMode.Merge)},r.prototype.getNewTableProp=function(e){var t=this.param,r=t.tableProp,n=t.index,o=t.amount,i=r.tableId,a=e.tableStream.getTableInfo(i);if(a){var s=a.property.clone(),p=s.colWidths.slice();return p.splice(n,o),s.colWidths=p,s}},Object.defineProperty(r.prototype,"operationType",{get:function(){return e.OperationType.RemoveTableColumn},enumerable:!0,configurable:!0}),r.prototype.clone=function(){return new r(Qo({},this.param))},r}(Zi),aa=function(t){function r(e){return t.call(this,e)||this}return Zo(r,t),r.prototype.startApply=function(r,n,o,i){var a,s;if(!(n||i||this.operationType!==e.OperationType.ModifyStory&&this.operationType!==e.OperationType.ClearStory)){var p=this.doInverseIfNeed(r,this.range);try{for(var l=$o(p),c=l.next();!c.done;c=l.next()){var u=c.value;this.inverseOpArray.push(u)}}catch(e){a={error:e}}finally{try{c&&!c.done&&(s=l.return)&&s.call(l)}finally{if(a)throw a.error}}}t.prototype.startApply.call(this,r,n,o,i)},r.prototype.updateDirtyRange=function(e){this._dirtyRange=this.param.range.clone()},r}(bi),sa=function(t){function r(e){return t.call(this,e)||this}return Zo(r,t),Object.defineProperty(r.prototype,"param",{get:function(){return this._param},enumerable:!0,configurable:!0}),r.prototype.doInverse=function(t,r){var n=this.param.range.clone(),o=t.findStoryInfoFromGcp(n.begin());if(!o||!o.range||!o.storyProp)return[];var i=[],a=o.storyProp;if(a){var s=a.clone(),p=a.clone();this.param.propertySetMode===e.TDSetPropMode.Cover?s.cover(this.param.storyProperty):s.merge(this.param.storyProperty);var l=s.cover(p),c={range:n,storyProperty:a,propertySetMode:e.TDSetPropMode.Cover,modifiedResult:l},u=ki.getOp(e.OperationType.ModifyStory,c);u&&i.push(u)}return i},r.prototype.doApply=function(e){e.setStoryProp(this.param.range.begin(),this.param.range.length(),this.param.storyProperty,this.param.propertySetMode,this.param.modifiedResult)},Object.defineProperty(r.prototype,"operationType",{get:function(){return e.OperationType.ModifyStory},enumerable:!0,configurable:!0}),r.prototype.clone=function(){return new r({range:this.param.range.clone(),storyProperty:this.param.storyProperty.clone(),propertySetMode:this.param.propertySetMode})},r}(aa),pa=function(t){function r(e){return t.call(this,e)||this}return Zo(r,t),Object.defineProperty(r.prototype,"param",{get:function(){return this._param},enumerable:!0,configurable:!0}),r.prototype.doInverse=function(t,r){var n=this.param.range,o=t.findStoryInfoFromGcp(n.begin());if(!o||!o.range||!o.storyProp)return[];var i=[],a=o.storyProp;if(a){var s=a.clone(),p=a.clone();this.param.propertySetMode===e.TDSetPropMode.Clear&&s.clear(this.param.clearStoryProps);var l=s.cover(p),c={range:n,storyProperty:a,propertySetMode:e.TDSetPropMode.Cover,modifiedResult:l},u=ki.getOp(e.OperationType.ModifyStory,c);u&&i.push(u)}return i},r.prototype.doApply=function(e){e.clearStoryProp(this.param.range.begin(),this.param.range.length(),this.param.clearStoryProps,this.param.modifiedResult)},Object.defineProperty(r.prototype,"operationType",{get:function(){return e.OperationType.ClearStory},enumerable:!0,configurable:!0}),r.prototype.clone=function(){return new r({range:this.param.range.clone(),propertySetMode:e.TDSetPropMode.Clear,clearStoryProps:this.param.clearStoryProps})},r}(aa),la=function(){function t(e){this.operations=[],this.globalOpts=e,this._currentRange=this.globalOpts.originRange}return t.prototype.setUpdateSelection=function(e){return this.globalOpts.updateSelection=e,this},t.prototype.setNeedCollab=function(e){return this.globalOpts.needCollab=e,this},t.prototype.moveTo=function(e){return this._currentRange=e,this},t.prototype._addOperation=function(e){return e.isValid()&&(this.globalOpts.undoOption.needInverse||(e.opNeedInverse=!1),this.operations.push(e),e.afterRange.isValid()&&(this._currentRange=e.afterRange)),this},t.prototype.applyOperations=function(e,t,r){var n=void 0;t&&(n=t()),this.opInfo=JSON.stringify({len:e.getLength(),exs:n,ops:this.getOpInfo()});var o=this.globalOpts.fromServer,i=this.globalOpts.undoOption.fromUndo,a=this.globalOpts.isInputDoc;this.operations.forEach((function(s){t&&(n=t()),s.apply(e,o,a,i,n),r&&r(s)}))},t.prototype.forEachOp=function(e){this.operations.forEach((function(t,r,n){e(t,r,n)}))},t.prototype.currentRange=function(){return this._currentRange},t.prototype.insertSpan=function(e,t,n,o){if(void 0===o&&(o=""),t.length<=0)return this;var i=t;(i.indexOf(uo.SectionBreak)>=0||i.indexOf(uo.ParagraphBreak)>=0)&&(r.Logger.error("insertNormalText shouldnt has EndSection or EndParagraph, please check:"+JSON.stringify(t)),i=i.replace(new RegExp(uo.SectionBreak+"|"+uo.ParagraphBreak,"g"),""));var a=this.globalOpts.isInputDoc?n:n.clone();this.globalOpts.fromServer||(a.author=ot.author);var s=new Mi({range:new ne(e,0),text:i,spanProperty:a,storyId:o});return this._addOperation(s)},t.prototype.insertText=function(e,t,r){return this.insertSpan(e,t,r)},t.prototype.insertImage=function(e,t){return this.insertSpan(e,uo.Image,t)},t.prototype.insertSplitline=function(e,t){return this.insertSpan(e,uo.Splitline,t)},t.prototype.insertDrawing=function(e,t){return this.insertSpan(e,uo.FloatingAnchor,t)},t.prototype.insertPlugin=function(e,t){return this.insertSpan(e,uo.InlineAnchor,t)},t.prototype.insertPageBreak=function(e,t){return this.insertSpan(e,uo.PageBreak,t)},t.prototype.insertFieldChar=function(t,r){var n="";switch(r.fieldCharType){case e.FieldCharType.Begin:n=uo.FieldBegin;break;case e.FieldCharType.Separate:n=uo.FieldSep;break;case e.FieldCharType.End:n=uo.FieldEnd}return n.length>0?this.insertSpan(t,n,r):this},t.prototype.setSpanProperty=function(t,r,n,o){void 0===n&&(n=e.TDSetPropMode.Merge),void 0===o&&(o="");var i=r.clone();this.globalOpts.fromServer||(i.author=ot.author);var a=new vi({range:t.clone(),spanProperty:i,propertySetMode:n,storyId:o});return this._addOperation(a)},t.prototype.clearSpanProperty=function(t,r,n){void 0===n&&(n="");var o=new xi({range:t.clone(),propertySetMode:e.TDSetPropMode.Clear,clearSpanProps:r,storyId:n});return this._addOperation(o)},t.prototype.insertParagraph=function(e,t,r,n,o){void 0===n&&(n=""),void 0===o&&(o="");var i=this.globalOpts.isInputDoc?t:t.clone();this.globalOpts.fromServer||(i.author=ot.author);var a=this.globalOpts.isInputDoc?r:r.clone();n.length>0?a.paraId=n:a.genNewParaId();var s=new Di({range:new ne(e,0),text:uo.ParagraphBreak,spanProperty:i,paraProperty:a,storyId:o});return this._addOperation(s)},t.prototype.setParagraphProperty=function(t,r,n,o){void 0===n&&(n=e.TDSetPropMode.Merge),void 0===o&&(o="");var i=new Wi({range:t.clone(),paraProperty:r.clone(),propertySetMode:n,storyId:o});return this._addOperation(i)},t.prototype.clearParaProperty=function(t,r,n){void 0===n&&(n="");var o=new Yi({range:t.clone(),propertySetMode:e.TDSetPropMode.Clear,clearParaProps:r,storyId:n});return this._addOperation(o)},t.prototype.clearSectionProperty=function(t,r,n){void 0===n&&(n="");var o=new Ji({range:t.clone(),propertySetMode:e.TDSetPropMode.Clear,clearSectionProps:r,storyId:n});return this._addOperation(o)},t.prototype.clearStoryProperty=function(t,r){var n=new pa({range:t.clone(),propertySetMode:e.TDSetPropMode.Clear,clearStoryProps:r});return this._addOperation(n)},t.prototype.insertSection=function(e,t,r,n){void 0===n&&(n="");var o=this.globalOpts.isInputDoc?t:t.clone();this.globalOpts.fromServer||(o.author=ot.author);var i=this.globalOpts.isInputDoc?r:r.clone(),a=new Ui({range:new ne(e,0),text:uo.SectionBreak,spanProperty:o,sectionProperty:i,storyId:n});return this._addOperation(a)},t.prototype.setSectionProperty=function(t,r,n,o){void 0===n&&(n=e.TDSetPropMode.Merge),void 0===o&&(o="");var i=new Xi({range:t.clone(),sectionProperty:r.clone(),propertySetMode:n,storyId:o});return this._addOperation(i)},t.prototype.setGlobalProperty=function(t,r){var n=new sa({range:t.clone(),storyProperty:r.clone(),propertySetMode:e.TDSetPropMode.Merge});return this._addOperation(n)},t.prototype.deleteText=function(e,t){if(void 0===t&&(t=""),e.isEmpty())return this;var r=new Ei({range:e.clone(),storyId:t});return this._addOperation(r)},t.prototype.insertStoryBegin=function(e,t,r){var n=new Li({range:new ne(e,0),storyProp:t.clone(),placeholder:r});return this._addOperation(n)},t.prototype.insertStoryEnd=function(e,t,r){var n=new Oi({range:new ne(e,0),storyProp:t.clone(),placeholder:r});return this._addOperation(n)},t.prototype.insertTableCellPara=function(e,t,r,n,o){void 0===n&&(n=""),void 0===o&&(o="");var i=t.clone();this.globalOpts.fromServer||(i.author=ot.author);var a=r.clone();n.length>0?a.paraId=n:a.genNewParaId();var s=new Ki({range:new ne(e,0),text:uo.TableCellBreak,spanProperty:i,paraProperty:a,storyId:o});return this._addOperation(s)},t.prototype.insertTableCellStart=function(e,t,r,n){void 0===r&&(r=""),void 0===n&&(n="");var o=t.clone();this.globalOpts.fromServer||(o.author=ot.author);var i=new an;r.length>0?i.paraId=r:i.genNewParaId(),i.isCellStart=!0;var a=new Gi({range:new ne(e,0),text:uo.TableCellStart,spanProperty:o,paraProperty:i,storyId:n});return this._addOperation(a)},t.prototype.insertTableRowPara=function(e,t,r,n,o){void 0===n&&(n=""),void 0===o&&(o="");var i=t.clone();this.globalOpts.fromServer||(i.author=ot.author);var a=r.clone();n.length>0?a.paraId=n:a.genNewParaId();var s=new Hi({range:new ne(e,0),text:uo.TableRowBreak,spanProperty:i,paraProperty:a,storyId:o});return this._addOperation(s)},t.prototype.insertTableRowStart=function(e,t,r,n){void 0===r&&(r=""),void 0===n&&(n="");var o=t.clone();this.globalOpts.fromServer||(o.author=ot.author);var i=new $r;r.length>0?i.paraId=r:i.genNewParaId(),i.isRowStart=!0;var a=new ji({range:new ne(e,0),text:uo.TableRowStart,spanProperty:o,paraProperty:i,storyId:n});return this._addOperation(a)},t.prototype.splitValidRange=function(e,t){var r=this.currentRange().clone();Bi.splitCellRange(e,this.currentRange(),(function(e,r){return t(e,r),!0})),this.moveTo(r)},t.prototype.startCreateTable=function(e,t,r){void 0===r&&(r="");var n=t.clone();r.length>0?n.paraId=r:n.genNewParaId();var o=new Fi({range:new ne(e,0),text:uo.TableStart,spanProperty:new At,paraProperty:n});return this._addOperation(o)},t.prototype.endCreateTable=function(e,t,r){void 0===r&&(r="");var n=t.clone();r.length>0?n.paraId=r:n.genNewParaId();var o=new Ai({range:new ne(e,0),text:uo.TableEnd,spanProperty:new Kt,paraProperty:n});return this._addOperation(o)},t.prototype.setTableProperty=function(t,r,n){void 0===n&&(n=e.TDSetPropMode.Merge);var o=new Vi({range:t.clone(),paraProperty:r.clone(),propertySetMode:n});return this._addOperation(o)},t.prototype.setTableCellProperty=function(e,t,r,n){var o=new Qi({tableProp:e,cellRange:t,cellProps:r,cellProp:n?n.clone():n});return this._addOperation(o)},t.prototype.mergeCell=function(e,t){var r=new ta({tableProp:e,cellRange:t,isUnMerge:!1});return this._addOperation(r)},t.prototype.unMergeCell=function(e,t){var r=new ta({tableProp:e,cellRange:t,isUnMerge:!0});return this._addOperation(r)},t.prototype.setRowHeight=function(t,r,n){var o=new ea({tableProp:t.tableProp,dimensionType:e.TableDimensionType.RowHeight,index:r,props:n});return this._addOperation(o)},t.prototype.setColWidth=function(t,r,n){var o=new ea({tableProp:t.tableProp,dimensionType:e.TableDimensionType.ColWidth,index:r,props:n});return this._addOperation(o)},t.prototype.setTablePaddingLeft=function(t,r){var n=new ea({tableProp:t.tableProp,dimensionType:e.TableDimensionType.PaddingLeft,props:r});return this._addOperation(n)},t.prototype.setTablePaddingRight=function(t,r){var n=new ea({tableProp:t.tableProp,dimensionType:e.TableDimensionType.PaddingRight,props:r});return this._addOperation(n)},t.prototype.createRow=function(e,t,r){var n=new ra(Qo({index:t,amount:r},e));return this._addOperation(n)},t.prototype.createCol=function(e,t,r){var n=new na(Qo({index:t,amount:r},e));return this._addOperation(n)},t.prototype.removeRow=function(e,t,r){var n=new oa(Qo({index:t,amount:r},e));return this._addOperation(n)},t.prototype.removeCol=function(e,t,r){var n=new ia(Qo({index:t,amount:r},e));return this._addOperation(n)},t.prototype.opMap=function(e){this.operations=this.operations.map(e)},t.prototype.opMapList=function(e){var t=[];this.operations.forEach((function(r,n,o){t.push.apply(t,ti(e(r,n,o)))})),this.operations=t},t.prototype.opFilter=function(e){var t=this.operations.slice(0);this.operations=this.operations.filter((function(r,n,o){var i=e(r,n,o);if(!i)for(var a=-Bi.getOffset(r),s=n+1;s<t.length;s++)Bi.moveOffset(t[s],a);return i}));var r=this.operations[this.operations.length-1].afterRange;this.moveTo(r)},t.prototype.opFilterWithoutMovingOffset=function(e){this.operations=this.operations.filter(e)},t.prototype.addOperation=function(e){return this._addOperation(e)},t.prototype.insertOperation=function(e,t,r){if(void 0===r&&(r=!0),this.operations.splice(t,0,e),r)for(var n=Bi.getOffset(e),o=t+1;o<this.operations.length;o++)Bi.moveOffset(this.operations[o],n);e instanceof mi&&(this._currentRange.gcpBegin+=e.changeLen)},t.prototype.getOpInfo=function(){var e=[];return this.operations.forEach((function(t){t instanceof mi&&e.push({type:t.operationType,range:t.param.range})})),e},t}();($i=e.StateNotification||(e.StateNotification={})).ModelChange="ModelChange",$i.CoreSelectionChange="CoreSelectionChange",$i.CollabToServer="CollabToServer",$i.ListModelShouldChange="ListModelChange",$i.InsertContainer="InsertContainer",$i.DeleteContainer="DeleteContainer",$i.ModifyContainer="ModifyContainer",$i.CusorPropChange="CusorPropChange",$i.InsertTablePlaceHolder="InsertTablePlaceHolder",$i.GlobalPropChange="GlobalPropChange",$i.NewDocument="new_document",$i.EfficientModelChange="EfficientModelChange",$i.ApplyDeltaCheck="ApplyDeltaCheck";var ca,ua,ha,fa=function(){function e(e){this.dirtyRanges=e}return Object.defineProperty(e.prototype,"first",{get:function(){return this.dirtyRanges.length>0?this.dirtyRanges[0]:ne.invalidRange()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"last",{get:function(){var e=this.dirtyRanges.length;return e>0?this.dirtyRanges[e-1]:ne.invalidRange()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"values",{get:function(){return this.dirtyRanges},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"unionValue",{get:function(){var e;return this.dirtyRanges.forEach((function(t){e=e?e.unionRange(t):t.clone()})),e||(e=ne.invalidRange()),e},enumerable:!0,configurable:!0}),e.prototype.contains=function(e){return 0!==this.dirtyRanges.length&&this.dirtyRanges.some((function(t){return t.contains(e)}))},e.prototype.isInvalid=function(){return 0===this.dirtyRanges.length||this.dirtyRanges.every((function(e){return!e.isValid()}))},e.prototype.intersect=function(e){return 0!==this.dirtyRanges.length&&this.dirtyRanges.some((function(t){return t.intersect(e)}))},e.invalidRange=function(){return new e([])},e}(),da=function(t){function r(r,n){var o=t.call(this,e.StateNotification.ModelChange)||this;return o.changeData=r,o.fromServer=n,o}return Zo(r,t),r}(r.Notification),ga=function(t){function r(r){var n=t.call(this,e.StateNotification.EfficientModelChange)||this;return n.changeData=r,n}return Zo(r,t),r}(r.Notification);(ca=e.ScrollViewType||(e.ScrollViewType={}))[ca.None=1]="None",ca[ca.Near=2]="Near",ca[ca.Top=3]="Top",(ua=e.MobileSelectionDragType||(e.MobileSelectionDragType={}))[ua.Show=1]="Show",ua[ua.Hide=2]="Hide",ua[ua.Keep=3]="Keep",(ha=e.MobileContextMenuType||(e.MobileContextMenuType={}))[ha.Show=1]="Show",ha[ha.Hide=2]="Hide",ha[ha.Keep=3]="Keep";var ya=function(t){function r(r,n,o){var i=t.call(this,e.StateNotification.CoreSelectionChange)||this;return i.range=r,i.tableCellRange=n,i.option=o,i}return Zo(r,t),r}(r.Notification),ma=function(t){function r(r){var n=t.call(this,e.StateNotification.ListModelShouldChange)||this;return n.listMarkerSpanProperty=r,n}return Zo(r,t),r}(r.Notification),ba=function(t){function r(r){var n=t.call(this,e.StateNotification.CollabToServer)||this;return n.delta=r,n}return Zo(r,t),r}(r.Notification),Pa=function(t){function r(r,n){var o=t.call(this,e.StateNotification.InsertContainer)||this;return o.anchorInfos=r,o.fromServer=n,o}return Zo(r,t),r}(r.Notification),va=function(t){function r(r,n){var o=t.call(this,e.StateNotification.DeleteContainer)||this;return o.anchorInfos=r,o.fromServer=n,o}return Zo(r,t),r}(r.Notification),xa=function(t){function r(r,n){var o=t.call(this,e.StateNotification.ModifyContainer)||this;return o.anchorInfos=r,o.fromServer=n,o}return Zo(r,t),r}(r.Notification),Ta=function(t){function r(){return t.call(this,e.StateNotification.CusorPropChange)||this}return Zo(r,t),r}(r.Notification),_a=function(t){function r(){return t.call(this,e.StateNotification.GlobalPropChange)||this}return Zo(r,t),r}(r.Notification),Sa=function(t){function r(){return t.call(this,e.StateNotification.NewDocument)||this}return Zo(r,t),r}(r.Notification),Ca=function(t){function r(r){var n=t.call(this,e.StateNotification.ApplyDeltaCheck)||this;return n.delta=r,n}return Zo(r,t),r}(r.Notification),Ba=new Map;function Ra(e){if(Ba.has(e))return Ba.get(e);var t=function(e,n,o){if(void 0===o){if(arguments.length>1)return ni(e,{kind:"di:props",key:n,id:t}),{get:function(){r.Logger.warn(n+" has not injected")}};throw new Error("inject decorator can only be used to decorate a parameter & property")}ni(e,{kind:"di:param",index:o,id:t})};return t.toString=function(){return e},Ba.set(e,t),t}var wa,Ia=Ra,Ea=function(e,t){return(Ea=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)};
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function La(e,t){function r(){this.constructor=e}Ea(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(wa=e.EditMetric||(e.EditMetric={}))[wa.ApplyDelta=0]="ApplyDelta",wa[wa.Collab=1]="Collab",wa[wa.Layout=2]="Layout",wa[wa.Reflow=3]="Reflow",wa[wa.Render=4]="Render",wa[wa.Overlay=5]="Overlay",wa[wa.COUNT=6]="COUNT";var Oa,Na,ka,Ma,Da,Fa,Aa,Ka,Ga,Ha,ja=Ia("editor"),Ua=function(t){function r(){var r=null!==t&&t.apply(this,arguments)||this;return r.docEnv=qo,r.root=null,r.perfHandler={lastTime:0,costTime:new Float32Array(e.EditMetric.COUNT)},r.service=r.empty(),r.surface=r.empty(),r.view=r.empty(),r.statisticInfo=r.empty(),r.perfInfo=r.empty(),r.zoom=1,r.emptyContent=function(){},r.setContent=function(){},r.applyDelta=function(){},r.setRangeTo=function(){},r.isEditable=function(){return r.docEnv.editable},r.isCopyable=function(){return r.docEnv.copyable},r.updateDocEnv=function(e){r.docEnv=e},r.setLayoutType=function(e){r.docEnv.layoutType=e},r.setEditable=function(e){r.docEnv.editable=e},r.setCopyable=function(e){r.docEnv.copyable=e},r.isCaret=function(){return!1},r.isCompositing=function(){return!1},r.attachEditor=function(e){r.root=e},r.detach=function(){r.root&&r.root.remove()},r}return La(r,t),r.prototype.empty=function(){return{}},r}(ui),za=Ia("service");(Oa=e.MarkdownParserType||(e.MarkdownParserType={})).Headline="heading",Oa.BulletList="bulletList",Oa.TaskList="taskList",Oa.Codeblock="codeblock",Oa.Horizontal="horizontal",Oa.Italic="italic",Oa.Emphasis="emphasis",Oa.ItalicAndEmphasis="italicAndEmphasis",Oa.Underline="underline",Oa.Strike="strike",Oa.UnderlineAndStrike="underlineAndStrike",(Na=e.ListFindDirection||(e.ListFindDirection={}))[Na.Prev=0]="Prev",Na[Na.Next=1]="Next",(ka=e.ListLevelRuleType||(e.ListLevelRuleType={}))[ka.absolute=0]="absolute",ka[ka.relative=1]="relative",ka[ka.auto=2]="auto",(e.ContainerOption||(e.ContainerOption={})).FitToParent="fitToParent",(Ma=e.TDConstants||(e.TDConstants={}))[Ma.Undefined=9999999]="Undefined",Ma[Ma.Toggle=9999998]="Toggle",(Da=e.TDStoryType||(e.TDStoryType={}))[Da.MainTextStory=0]="MainTextStory",Da[Da.PrimaryHeaderStory=1]="PrimaryHeaderStory",Da[Da.PrimaryFooterStory=2]="PrimaryFooterStory",Da[Da.TextFrameStory=3]="TextFrameStory",Da[Da.CodeblockStory=4]="CodeblockStory",(Fa=e.TDCollapseDirection||(e.TDCollapseDirection={}))[Fa.CollapseEnd=0]="CollapseEnd",Fa[Fa.CollapseStart=1]="CollapseStart",(Aa=e.TDBreakType||(e.TDBreakType={}))[Aa.ColumnBreak=8]="ColumnBreak",Aa[Aa.LineBreak=6]="LineBreak",Aa[Aa.LineBreakClearLeft=9]="LineBreakClearLeft",Aa[Aa.LineBreakClearRight=10]="LineBreakClearRight",Aa[Aa.PageBreak=7]="PageBreak",Aa[Aa.SectionBreakContinuous=3]="SectionBreakContinuous",Aa[Aa.SectionBreakEvenPage=4]="SectionBreakEvenPage",Aa[Aa.SectionBreakNextPage=2]="SectionBreakNextPage",Aa[Aa.SectionBreakOddPage=5]="SectionBreakOddPage",Aa[Aa.TextWrappingBreak=11]="TextWrappingBreak",(Ka=e.TDFieldType||(e.TDFieldType={})).fieldEmpty="",Ka.fieldDate="DATE",Ka.fieldTime="TIME",Ka.fieldAuthor="AUTHOR",Ka.fieldNumWords="NUMWORDS",Ka.fieldPage="PAGE",Ka.fieldSectionPages="SECTIONPAGES",Ka.fieldSequence="SEQ",Ka.fieldTOC="TOC",Ka.fieldTOCEntry="TC",Ka.fieldPageRef="PAGEREF",Ka.fieldRef="REF",Ka.fieldHyperlink="HYPERLINK",Ka.fieldEmbed="EMBED",Ka.fieldNumPages="NUMPAGES",Ka.fieldIncludePicture="INCLUDEPICTURE",Ka.fieldMergeField="MERGEFIELD",Ka.fieldNext="Next",Ka.fieldFormula="EQ",Ka.fieldDocVariable="DOCVARIABLE",Ka.fieldFormTextInput="FORMTEXT",Ka.fieldFormCheckBox="FORMCHECKBOX",Ka.fieldFormDropDown="FORMDROPDOWN",Ka.fieldAddin="ADDIN",Ka.fieldExpression="=",Ka.fieldNoteRef="NOTEREF",Ka.fieldStyleRef="STYLEREF",Ka.fieldMacroButton="MACROBUTTON",Ka.fieldSaveDate="SAVEDATE",Ka.fieldPrintDate="PRINTDATE",Ka.fieldDocProperty="DOCPROPERTY",Ka.fieldIncludeText="INCLUDETEXT",Ka.fieldIndexEntry="XE",Ka.fieldIndex="INDEX",Ka.fieldAutoNum="AUTONUM",Ka.fieldListNum="LISTNUM",Ka.fieldShape="SHAPE",Ka.fieldIf="IF",Ka.fieldFileName="FILENAME",(Ga=e.TDSpanType||(e.TDSpanType={}))[Ga.StoryBreak=0]="StoryBreak",Ga[Ga.SectBreak=1]="SectBreak",Ga[Ga.PageBreak=2]="PageBreak",Ga[Ga.ParaBreak=3]="ParaBreak",Ga[Ga.TableRowBreak=4]="TableRowBreak",Ga[Ga.TableRowStart=5]="TableRowStart",Ga[Ga.TableCellBreak=6]="TableCellBreak",Ga[Ga.TableCellStart=7]="TableCellStart",Ga[Ga.TableStartBreak=8]="TableStartBreak",Ga[Ga.TableEndBreak=9]="TableEndBreak",Ga[Ga.FieldChar=10]="FieldChar",Ga[Ga.DefaultContainer=11]="DefaultContainer",Ga[Ga.DefaultPlugin=12]="DefaultPlugin",Ga[Ga.DefaultDrawing=13]="DefaultDrawing",Ga[Ga.Image=14]="Image",Ga[Ga.Splitline=15]="Splitline",Ga[Ga.Textframe=16]="Textframe",Ga[Ga.Codeblock=17]="Codeblock",Ga[Ga.EmbedComment=18]="EmbedComment",Ga[Ga.Comment=19]="Comment",Ga[Ga.Text=20]="Text",(Ha=e.InsertTableDirection||(e.InsertTableDirection={})).left="left",Ha.right="right",Ha.above="above",Ha.below="below";var Wa,Va=Ia("surface");(Wa=e.LayoutDisplay||(e.LayoutDisplay={})).Inline="inline",Wa.Block="block",Wa.InlineBlock="inline-block";var Ya,qa=function(){function e(e){this.top=e.top,this.left=e.left,this.bottom=e.bottom,this.right=e.right}return e.prototype.reset=function(e){this.top=e,this.left=e,this.bottom=e,this.right=e},e.getNone=function(t){return new e({top:t,left:t,bottom:t,right:t})},e}(),Xa=function(){function t(e){this.width=e.width,this.style=e.style,this.color=e.color}return t.prototype.reset=function(){this.width.reset(0),this.style.reset(e.BorderStyleType.none),this.color.reset("")},Object.defineProperty(t,"none",{get:function(){return new t({width:qa.getNone(0),style:qa.getNone(e.BorderStyleType.none),color:qa.getNone("")})},enumerable:!0,configurable:!0}),t}(),Ja=function(e){function t(t){var r=e.call(this)||this;return r.margin=t.margin,r.padding=t.padding,r.border=t.border,r}return La(t,e),Object.defineProperty(t.prototype,"left",{get:function(){return this.margin.left+this.border.width.left+this.padding.left},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this.margin.right+this.border.width.right+this.padding.right},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this.margin.top+this.border.width.top+this.padding.top},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{get:function(){return this.margin.bottom+this.border.width.bottom+this.padding.bottom},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this.left+this.right},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.top+this.bottom},enumerable:!0,configurable:!0}),t.prototype.recycle=function(){this.margin.reset(0),this.padding.reset(0),this.border.reset(),t.sPool.recycle(this)},t.obtain=function(){return t.sPool.obtain()||t.none},Object.defineProperty(t,"none",{get:function(){return new t({margin:qa.getNone(0),padding:qa.getNone(0),border:Xa.none})},enumerable:!0,configurable:!0}),t.sPool=new r.ObjectPool(5),t}(r.PoolNode);(Ya=e.PositionValue||(e.PositionValue={})).Static="static",Ya.Absolute="absolute",Ya.Relative="relative";var Za,Qa,$a,es,ts,rs=function(){function t(t){this.value=t||e.PositionValue.Static}return t.prototype.isAbsolute=function(){return this.value===e.PositionValue.Absolute},t.prototype.isRelative=function(){return this.value===e.PositionValue.Relative},t.prototype.isStatic=function(){return this.value===e.PositionValue.Static},t}();function ns(t){return!!t&&[e.BoxKind.Container,e.BoxKind.TextFrame].includes(t.kind)}function os(t){return!!t&&[e.BoxKind.Text,e.BoxKind.Container,e.BoxKind.TextFrame,e.BoxKind.Empty].includes(t.kind)}function is(t){return!!t&&[e.BoxKind.Document,e.BoxKind.LogicPage,e.BoxKind.ContainerPage,e.BoxKind.Section,e.BoxKind.TextPage,e.BoxKind.Paragraph,e.BoxKind.Table,e.BoxKind.TableRow,e.BoxKind.TableCell,e.BoxKind.TextLine,e.BoxKind.TextLineFragment,e.BoxKind.TextFrame].includes(t.kind)}function as(e){return!!e&&(os(e)||is(e))}function ss(t){return!!t&&t.kind===e.BoxKind.Document}function ps(t){return!!t&&t.kind===e.BoxKind.LogicPage}function ls(t){return!!t&&t.kind===e.BoxKind.ContainerPage}function cs(t){return ls(t)&&t.type===e.ContainerPageType.Header}function us(t){return ls(t)&&t.type===e.ContainerPageType.Footer}function hs(t){return!!t&&t.kind===e.BoxKind.Section}function fs(t){return!!t&&t.kind===e.BoxKind.TextPage}function ds(t){return!!t&&t.kind===e.BoxKind.Paragraph}function gs(t){return!!t&&t.kind===e.BoxKind.TextLine}function ys(t){return!!t&&t.kind===e.BoxKind.TextLineFragment}function ms(t){return!!t&&t.kind===e.BoxKind.TextFrame}function bs(t){return!!t&&t.kind===e.BoxKind.Text}function Ps(t){return!!t&&t.kind===e.BoxKind.Container}function vs(t){return!!t&&t.kind===e.BoxKind.Table}function xs(t){return!!t&&t.kind===e.BoxKind.TableCell}function Ts(t){return t&&[e.BoxKind.TextLite,e.BoxKind.ContainerLite].includes(t.kind)}function _s(t){return t&&[e.BoxKind.DocumentLite,e.BoxKind.SectionLite,e.BoxKind.ParagraphLite].includes(t.kind)}(Za=e.BoxKind||(e.BoxKind={}))[Za.Document=0]="Document",Za[Za.DocumentLite=1]="DocumentLite",Za[Za.LogicPage=2]="LogicPage",Za[Za.ContainerPage=3]="ContainerPage",Za[Za.Section=4]="Section",Za[Za.SectionLite=5]="SectionLite",Za[Za.TextPage=6]="TextPage",Za[Za.Paragraph=7]="Paragraph",Za[Za.ParagraphLite=8]="ParagraphLite",Za[Za.TextLine=9]="TextLine",Za[Za.TextLineLite=10]="TextLineLite",Za[Za.TextLineFragment=11]="TextLineFragment",Za[Za.Table=12]="Table",Za[Za.TableRow=13]="TableRow",Za[Za.TableCell=14]="TableCell",Za[Za.Text=15]="Text",Za[Za.TextLite=16]="TextLite",Za[Za.Container=17]="Container",Za[Za.ContainerLite=18]="ContainerLite",Za[Za.TextFrame=19]="TextFrame",Za[Za.Empty=20]="Empty",(Qa=e.ContainerPageType||(e.ContainerPageType={}))[Qa.Main=0]="Main",Qa[Qa.Header=1]="Header",Qa[Qa.Footer=2]="Footer",($a=e.LineFragmentType||(e.LineFragmentType={}))[$a.Field=0]="Field",(es=e.LineFragmentSubType||(e.LineFragmentSubType={}))[es.Default=0]="Default",es[es.Mention=1]="Mention",(ts=e.TextType||(e.TextType={}))[ts.Normal=0]="Normal",ts[ts.TailGlue=1]="TailGlue";var Ss,Cs=Ia("layoutController");(Ss=e.HiddenEditorNotificationType||(e.HiddenEditorNotificationType={})).ON_INPUT="on_input",Ss.ON_COMPOSITION_START="on_composition_start",Ss.ON_COMPOSITION_END="on_composition_end",Ss.ON_POS_UPDATE="on_pos_update";var Bs,Rs,ws=function(e){function t(t,r){var n=e.call(this,t)||this;return n.data=r,n}return La(t,e),t}(r.Notification);(Bs=e.KeyboardNotificationType||(e.KeyboardNotificationType={})).MOBILE_KEYBOARD_SHOW="mobileKeyboardShow",Bs.MOBILE_KEYBOARD_HIDE="mobileKeyboardHide",Bs.MOBILE_KEYBOARD_REFRESH_POSITION="mobileKeyboardRefreshPosition",(Rs=e.KeyboardNotificationFrom||(e.KeyboardNotificationFrom={}))[Rs.EDITOR=0]="EDITOR",Rs[Rs.VIEWPORT_RESIZE=1]="VIEWPORT_RESIZE",Rs[Rs.STYLE_PANEL_SHOW=2]="STYLE_PANEL_SHOW",Rs[Rs.OTHER=3]="OTHER";var Is=function(e){function t(t,r){var n=e.call(this,t)||this;return n.from=r,n}return La(t,e),t}(r.Notification);(e.MobileSelectionDragNotificationType||(e.MobileSelectionDragNotificationType={})).ON_DRAG="on_drag";var Es,Ls=function(t){function r(r){var n=t.call(this,e.MobileSelectionDragNotificationType.ON_DRAG)||this;return n.event=r,n}return La(r,t),r}(r.Notification);(Es=e.PanelNotificationType||(e.PanelNotificationType={})).MOBILE_PANEL_SHOW="mobilePanelShow",Es.MOBILE_PANEL_HIDE="mobilePanelHide";var Os,Ns=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return La(t,e),t}(r.Notification);(Os=e.ToolbarNotificationType||(e.ToolbarNotificationType={})).MOBILE_TOOLBAR_SHOW="mobileToolbarShow",Os.MOBILE_TOOLBAR_HIDE="mobileToolbarHide";var ks,Ms,Ds=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return La(t,e),t}(r.Notification);(ks=e.MouseType||(e.MouseType={}))[ks.NONE=0]="NONE",ks[ks.DOWN=1]="DOWN",ks[ks.MOVE=2]="MOVE",ks[ks.UP=3]="UP",ks[ks.CONTEXTMENU=4]="CONTEXTMENU",(Ms=e.MouseAction||(e.MouseAction={}))[Ms.NONE=0]="NONE",Ms[Ms.DRAG=1]="DRAG",Ms[Ms.CLICK=2]="CLICK",Ms[Ms.DOUBLE_CLICK=3]="DOUBLE_CLICK",Ms[Ms.TRIPLE_CLICK=4]="TRIPLE_CLICK",Ms[Ms.LONG_CLICK=5]="LONG_CLICK",(e.MouseNotificationType||(e.MouseNotificationType={})).MOUSE_EVENT="mouse_event";var Fs,As=function(t){function r(r,n){var o=t.call(this,e.MouseNotificationType.MOUSE_EVENT)||this;return o.event=r,o.mouseAction=n,o}return La(r,t),r}(r.Notification);(e.TouchNotificationType||(e.TouchNotificationType={})).TOUCH_EVENT="touch_event",(Fs=e.TouchAction||(e.TouchAction={}))[Fs.NONE=0]="NONE",Fs[Fs.TOUCH=1]="TOUCH",Fs[Fs.DOUBLE_TOUCH=2]="DOUBLE_TOUCH",Fs[Fs.TRIPLE_TOUCH=3]="TRIPLE_TOUCH",Fs[Fs.LONG_TOUCH=4]="LONG_TOUCH";var Ks,Gs,Hs=function(t){function r(r,n){var o=t.call(this,e.TouchNotificationType.TOUCH_EVENT)||this;return o.event=r,o.touchAction=n,o}return La(r,t),r}(r.Notification);function js(t){switch(t){case e.LayoutInputNodeType.Document:case e.LayoutInputNodeType.Section:case e.LayoutInputNodeType.Paragraph:case e.LayoutInputNodeType.TextGroup:case e.LayoutInputNodeType.Table:case e.LayoutInputNodeType.TableRow:case e.LayoutInputNodeType.TableCell:return!1;case e.LayoutInputNodeType.Text:case e.LayoutInputNodeType.EmbedContainer:case e.LayoutInputNodeType.TextFrame:return!0;default:return!1}}function Us(t){switch(t){case e.LayoutInputNodeType.Document:return null;case e.LayoutInputNodeType.Section:return e.IterType.Section;case e.LayoutInputNodeType.Paragraph:case e.LayoutInputNodeType.Table:return e.IterType.Paragraph;case e.LayoutInputNodeType.TextGroup:case e.LayoutInputNodeType.TableRow:case e.LayoutInputNodeType.TableCell:case e.LayoutInputNodeType.Text:case e.LayoutInputNodeType.EmbedContainer:case e.LayoutInputNodeType.TextFrame:case e.LayoutInputNodeType.FieldCode:return e.IterType.Span;default:return null}}function zs(t){switch(t){case e.LayoutInputNodeType.Document:case e.LayoutInputNodeType.Section:case e.LayoutInputNodeType.Paragraph:case e.LayoutInputNodeType.Table:case e.LayoutInputNodeType.TableRow:case e.LayoutInputNodeType.TableCell:return e.NodeDisplayType.Block;case e.LayoutInputNodeType.TextGroup:case e.LayoutInputNodeType.Text:return e.NodeDisplayType.Inline;case e.LayoutInputNodeType.EmbedContainer:case e.LayoutInputNodeType.TextFrame:case e.LayoutInputNodeType.FieldCode:return e.NodeDisplayType.AtomicInline;default:return e.NodeDisplayType.Block}}function Ws(t){var r=zs(t);return r===e.NodeDisplayType.Inline||r===e.NodeDisplayType.AtomicInline}(Ks=e.LayoutInputNodeType||(e.LayoutInputNodeType={}))[Ks.Document=0]="Document",Ks[Ks.Section=1]="Section",Ks[Ks.Paragraph=2]="Paragraph",Ks[Ks.TextGroup=3]="TextGroup",Ks[Ks.Text=4]="Text",Ks[Ks.Table=5]="Table",Ks[Ks.TableRow=6]="TableRow",Ks[Ks.TableCell=7]="TableCell",Ks[Ks.EmbedContainer=8]="EmbedContainer",Ks[Ks.FloatContainer=9]="FloatContainer",Ks[Ks.List=10]="List",Ks[Ks.TextFrame=11]="TextFrame",Ks[Ks.FieldCode=12]="FieldCode",Ks[Ks.Empty=13]="Empty",(Gs=e.NodeDisplayType||(e.NodeDisplayType={}))[Gs.Block=0]="Block",Gs[Gs.Inline=1]="Inline",Gs[Gs.AtomicInline=2]="AtomicInline";var Vs=function(){function e(e,t,r,n,o){this.limitRanges=[],this.nodeProperty=null,this.dataEngine=e,this.textStream=e.getTextStream(),this.range=t,this.offsets=o&&o.length>0?o:[0],this.type=r,this.parentNode=n,this.rootNode=n?n.rootNode:this,n&&this.intersectLimitRange(n.limitRanges)}return e.prototype.intersectLimitRange=function(e){var t=this;!e||e.length<1||(this.limitRanges=[],e.forEach((function(e){e.intersect(t.range)&&t.limitRanges.push(e.intersectRange(t.range))})))},e.prototype.setParentNode=function(e){this.parentNode=e},e.prototype.getOffsets=function(){return this.offsets},e.prototype.seek=function(e){this.offsets=e},e.prototype.setLimit=function(e){this.limitRanges=e},e.prototype.isSameNode=function(e){return this.getGCPRange().equal(e.getGCPRange())},e.prototype.getType=function(){return this.type},e.prototype.getGCPRange=function(){return this.range},e.prototype.getLimitRanges=function(){return this.limitRanges},e.prototype.getLimitRange=function(){var e=this.limitRanges.length;if(e>0){var t=this.limitRanges[0].begin(),r=this.limitRanges[e-1].end();return new ne(t,r-t)}return this.range},e.prototype.getLimitContent=function(){var e;return e=this.limitRanges.length>0?this.limitRanges[0]:this.range,this.textStream.readText(e.begin(),e.length())},e.prototype.getBPFirstIndex=function(){return this.textStream.getIndexFromGCP(this.range.begin())},e.prototype.getBPLastIndex=function(){return this.textStream.getIndexFromGCP(this.range.end()-1)},e.prototype.getTextStream=function(){return this.textStream},e.prototype.getParentNode=function(){return this.parentNode||null},e.prototype.getRootNode=function(){return this.rootNode},e.prototype.getTextContent=function(){var e=this.getTextRange();return this.textStream.readText(e.gcpBegin,e.len)},e.prototype.getTextRange=function(){var e=this.offsets[0];return new ne(this.range.begin()+e,this.range.length()-e)},e.prototype.isReachEnd=function(){return this.offsets[0]>=this.range.length()},e.prototype.isHidden=function(){var e=this.getProperty();return!!e&&e.hidden},e.prototype.isLeafNode=function(){return js(this.getType())},e.prototype.isRootNode=function(){return!this.parentNode},e.prototype.isLastChild=function(){if(!this.parentNode)return!0;var e=this.parentNode.getGCPRange();return this.range.end()===e.end()},e.prototype.getDocumentEnv=function(){if(this.isRootNode())return this.docEnv||null;var e=this.getParentNode();return e?e.getDocumentEnv():null},e}(),Ys=function(e,t){return(Ys=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)};
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function qs(e,t){function r(){this.constructor=e}Ys(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var Xs=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return qs(n,t),n.prototype.generateBeginChild=function(e){if(this.range.isEmpty())return null;var t=this.getChildIterType(),r=this.createDataIterator(t,this.range),n=this.range.begin(),o=this.offsets.map((function(e){return n+e}));r.seek(o[0]);var i=r.getRange(!0);if(!i||i.isEmpty())return null;var a=i.begin();return e(i,o.map((function(e){return e-a})))},n.prototype.generateNextSibling=function(e){if(this.isRootNode())return null;var t=Us(this.getType()),r=this.getParentNode();if(null!==t&&r){var n=r.getLimitRange(),o=this.createDataIterator(t,n);if(o.seek(this.getGCPRange().end()-1),o.next())return e(o.getRange(!0))}return null},n.prototype.generatePrevSibling=function(e){if(this.isRootNode())return null;var t=Us(this.getType()),r=this.getParentNode();if(null!==t&&r){var n=r.getLimitRange(),o=this.createDataIterator(t,n);if(o.seek(this.getGCPRange().begin()),o.prev())return e(o.getRange(!0))}return null},n.prototype.createDataIterator=function(t,n){switch(t){case e.IterType.Section:return this.textStream.createSectionIterator(n);case e.IterType.Paragraph:return this.textStream.createParagraphIterator(n);case e.IterType.Span:return this.textStream.createSpanIterator(n);default:return r.Logger.error("unsupported IterType:"+t),this.textStream.createSpanIterator(n)}},n}(Vs),Js=function(e){function t(t,r,n,o){var i=this;if(r.length<=0)throw new Error("Group Node Must at least have one child node");var a=r[0].getGCPRange().begin(),s=0;r.forEach((function(e){e.setParentNode(i),o&&e.intersectLimitRange(o.getLimitRanges()),s+=e.getGCPRange().length()}));var p=r[0].getOffsets();return(i=e.call(this,t,new ne(a,s),n,o,p)||this).childNodes=r,i}return qs(t,e),t.prototype.getChildNodeNextSibling=function(e){var t=this.childNodes.indexOf(e);return t>=0&&t<this.childNodes.length-1?this.childNodes[t+1]:null},t.prototype.getChildNodePrevSibling=function(e){var t=this.childNodes.indexOf(e);return t>=1&&t<this.childNodes.length?this.childNodes[t-1]:null},t.prototype.getNextSibling=function(){var e=this.getParentNode();return e&&e instanceof t?e.getChildNodeNextSibling(this):null},t.prototype.getPrevSibling=function(){var e=this.getParentNode();return e&&e instanceof t?e.getChildNodePrevSibling(this):null},t.prototype.getBeginChild=function(){for(var e=0,t=0;t<this.childNodes.length;t++){var r=this.childNodes[t],n=r.getGCPRange(),o=this.offsets[0];if(e+n.length()>o)return r.seek([o-e]),r;e+=n.length()}return null},t}(Vs),Zs=function(t){function r(r,n,o){return t.call(this,r,n,e.LayoutInputNodeType.TextGroup,o)||this}return qs(r,t),r.prototype.getProperty=function(){return null},r.prototype.getPrevSibling=function(){var e=this.getParentNode();if(e){var t=e.getLimitRange(),r=this.range.begin()-1;return pp(e,this.dataEngine,t,r,!0)}return null},r.prototype.getNextSibling=function(){var e=this.getParentNode();if(e){var t=e.getLimitRange(),r=this.range.begin()+this.range.length();return pp(e,this.dataEngine,t,r,!1)}return null},r.prototype.isFirstChild=function(){var e=this.getParentNode();if(e){var t=e.getGCPRange().begin();return this.range.begin()+this.offsets[0]===t}return!1},r.prototype.getFirstChildBy=function(e){for(var t=this.getBeginChild();t&&!(t instanceof e);)t=this.getChildNodeNextSibling(t);return t},r}(Js),Qs=function(t){function r(r,n,o){return t.call(this,r,n,e.LayoutInputNodeType.List,o)||this}return qs(r,t),r.prototype.getProperty=function(){return null},r.prototype.getPrevSibling=function(){throw new Error("not implement yet")},r.prototype.getNextSibling=function(e){if(this.parentNode){var t=this.parentNode.getLimitRange(),r=this.getTextStream().createParagraphIterator(t);if(r.seek(this.getGCPRange().end()-1),r.next()){var n=r.getRange(!0);return dp(this.dataEngine,n,this.parentNode,e)}}return null},r.prototype.getListManager=function(){return this.dataEngine.getListManager()},r.create=function(e,t,n){for(var o="",i=[],a=t;a&&a instanceof lp;){var s=a.getProperty(),p=s&&s.listId;if(!p||o&&p!==o)break;o=p,i.push(a),a=a.getNextSibling()}return new r(e,i,n)},r}(Js),$s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return qs(t,e),t.prototype.generateProperty=function(){var e=this.textStream.createSpanIterator(this.range).getProperty(!0);return e||null},t.prototype.getBeginChild=function(){return null},t.prototype.getNextSibling=function(){var e=this.getParentNode();if(e instanceof Xs){var t=e.getLimitRange(),r=this.range.begin()+this.range.length();return pp(e,this.dataEngine,t,r,!1)}return e instanceof Js?e.getChildNodeNextSibling(this):null},t.prototype.getPrevSibling=function(){var e=this.getParentNode();if(e instanceof Xs){var t=e.getLimitRange(),r=this.range.begin()-1;return pp(e,this.dataEngine,t,r,!0)}return e instanceof Js?e.getChildNodePrevSibling(this):null},t}(Vs),ep=function(t){function r(r,n,o){return t.call(this,r,n,e.LayoutInputNodeType.Empty,o)||this}return qs(r,t),r.prototype.getProperty=function(){return this.nodeProperty||(this.nodeProperty=t.prototype.generateProperty.call(this)),this.nodeProperty},r}($s),tp=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return qs(t,e),t.prototype.getProperty=function(){return this.nodeProperty||(this.nodeProperty=e.prototype.generateProperty.call(this)),this.nodeProperty},t.prototype.getMargin=function(){return{top:0,left:0,bottom:0,right:0}},t}($s),rp=function(t){function n(n,o,i,a){var s=t.call(this,n,o,e.LayoutInputNodeType.EmbedContainer,i,a)||this;return s._fixedRatio=!1,s._size=r.MeloSize.zeroSize(),s.init(),s}return qs(n,t),n.prototype.init=function(){var e=this.getProperty();this._fixedRatio=e.lockAspectRatio,this._size.width=e.fitToParentWidth?-1:e.width,this._size.height=e.height,this._margin={top:e.marginTop,left:e.marginLeft,right:e.marginRight,bottom:e.marginBottom}},n.prototype.getProperty=function(){return t.prototype.getProperty.call(this)||new or},n.prototype.fixedRatio=function(){return this._fixedRatio},n.prototype.getSize=function(){return this._size},n.prototype.getMargin=function(){return this._margin||t.prototype.getMargin.call(this)},n}(tp),np=function(t){function r(r,n,o,i){return t.call(this,r,n,e.LayoutInputNodeType.Text,o,i)||this}return qs(r,t),r.prototype.getProperty=function(){if(this.replacedProp)return this.replacedProp;if(!this.nodeProperty){var e=t.prototype.generateProperty.call(this);if(e){var r=this.textStream.createParagraphIterator(this.range).getProperty(!0);r&&(e=this.dataEngine.getStyleSheetEngine().mergeStyleSpanProperty(e,r))}this.nodeProperty=e}return this.nodeProperty},r.prototype.getTextContent=function(){return this.replacedText?this.replacedText:t.prototype.getTextContent.call(this)},r}($s),op=function(t){function n(n,o,i,a){var s=t.call(this,n,o,e.LayoutInputNodeType.TextFrame,i,a)||this;s.storyId="",s.size=r.MeloSize.zeroSize();var p=s.getProperty();return s.storyId=p.anchorId,s.size.width=p.fitToParentWidth?-1:p.width,s.size.height=p.height>0?p.height:-2,s.padding={left:p.paddingLeft,top:p.paddingTop,right:p.paddingRight,bottom:p.paddingBottom},s.initStoryInfo(),s}return qs(n,t),n.prototype.getProperty=function(){return t.prototype.getProperty.call(this)||new Cr},n.prototype.initStoryInfo=function(){var e=this.textStream.findStoryInfoFromId(this.storyId);e&&e.range&&!e.range.isEmpty()?this.content=gp.create(this.dataEngine,e.range)||void 0:r.Logger.error("textFrame range is empty!")},n.prototype.resetContent=function(){this.content&&this.content.seek([0])},n.prototype.fixedRatio=function(){return!1},n.prototype.getSize=function(){return this.size},n}(tp);var ip=function(){function t(){}return t.creator=function(t,r){var n=function(t){return t instanceof wt?e.LayoutInputNodeType.Text:t instanceof Cr?e.LayoutInputNodeType.TextFrame:t instanceof nr?e.LayoutInputNodeType.EmbedContainer:void 0}(t);if(n&&r(n)){var o=function(t){switch(t){case e.LayoutInputNodeType.Text:return np;case e.LayoutInputNodeType.EmbedContainer:return rp;case e.LayoutInputNodeType.TextFrame:return op;default:return}}(n);if(o)return function(e,t,r,n){return new o(e,t,r,n)}}},t}(),ap=function(t){function n(r,n,o,i){return t.call(this,r,n,e.LayoutInputNodeType.FieldCode,o,i)||this}return qs(n,t),n.prototype.getChildIterType=function(){return e.IterType.Span},n.prototype.getProperty=function(){return null},n.prototype.getPrevSibling=function(){throw new Error("not implement yet")},n.prototype.getNextSibling=function(){var e=this.getParentNode();return e instanceof Js?e.getChildNodeNextSibling(this):null},n.prototype.getBeginChild=function(){var e=this;return t.prototype.generateBeginChild.call(this,(function(t,r){return pp(e,e.dataEngine,e.getLimitRange(),t.begin(),!1,r)}))},n.prototype.getResultNode=function(t){if(!this.fieldInfo)return null;var r=this.fieldInfo.fieldResultRange,n=this.dataEngine.getFieldEngine();if(!n)return null;var o=n.parserCodeForResult(this.fieldInfo.fieldCode,t);if(this.fieldInfo.isAutoUpdate)return(l=new np(this.dataEngine,r)).measuredText=this.fieldInfo.prefab||void 0,l.replacedText=o.result,new Zs(this.dataEngine,[l],this);if(o.fieldType===e.FieldType.MENTION_QQ){var i=Fo.getInstance().getFieldcodeInfo(this.fieldInfo.fieldCode),a=(l=new np(this.dataEngine,r)).getProperty();l.replacedProp=new wt,a&&(l.replacedProp.diff=a.diff),l.replacedProp.textColor=ot.mentionColor;var s=this.getDocumentEnv(),p=s&&s.uniqueId||"";return i.instructions[3]&&i.instructions[3]!==p||(l.replacedProp.textColor=ot.mentionColor),new Zs(this.dataEngine,[l],this)}if(o.fieldType===e.FieldType.DOC_LINK){var l;a=(l=new np(this.dataEngine,r)).getProperty();return l.replacedProp=null==a?void 0:a.clone(),l.replacedProp&&!l.replacedProp.getPropBag().has(e.SpanPropKey.textColor)&&(l.replacedProp.textColor=ot.docLinkColor),new Zs(this.dataEngine,[l],this)}return pp(this,this.dataEngine,r,r.begin(),!1)},n.prototype.getPadding=function(){if(this.fieldInfo){var t=Fo.getInstance().getFieldcodeInfo(this.fieldInfo.fieldCode);switch(t.fieldName){case e.FieldType.DOC_LINK:var n=this.getBeginChild(),o=r.pxToTwips(26);if(n&&n instanceof Zs){var i=n.getFirstChildBy(np),a=null==i?void 0:i.getProperty();o+=a?9*a.fontSize/8:0}return{top:0,left:o,bottom:0,right:0};case e.FieldType.MENTION_QQ:var s=28,p=this.getDocumentEnv(),l=p&&p.uniqueId||"";return t.instructions[3]&&t.instructions[3]!==l&&(s=16),{top:0,left:r.pxToTwips(2),bottom:0,right:r.pxToTwips(s)};default:return{top:0,left:0,bottom:0,right:0}}}return{top:0,left:0,bottom:0,right:0}},n}(Xs),sp=function(e,t){return t?e.prev()?e.getProperty(!0):null:e.next()?e.getProperty(!0):null};function pp(e,t,r,n,o,i){void 0===o&&(o=!1);var a=t.getTextStream().createSpanIterator(r);a.seek(n);var s=a.getProperty(!0);if(!s||a.getRange().isEmpty()||n>=r.end())return null;var p=function(r,n){var o=a.getRange();if(r instanceof Ht&&!(e instanceof ap)){var i=t.getFieldEngine(),s=i&&i.getFieldInfo(o.begin()),p=s&&s.fieldRange;if(p&&!p.isNull()){a.seek(p.end()-1);var l=new ap(t,p);return l.fieldInfo=s||void 0,l}}var c=ip.creator(r,Ws);if(c)return c(t,o,void 0,n)},l=p(s,i);if(l){var c=[l];do{if(!(s=sp(a,o)))break;if(!(l=p(s)))break;o?c.splice(0,0,l):c.push(l)}while(s);return new Zs(t,c,e)}return new ep(t,a.getRange(),e)}var lp=function(t){function r(r,n,o,i){return t.call(this,r,n,e.LayoutInputNodeType.Paragraph,o,i)||this}return qs(r,t),r.prototype.getChildIterType=function(){return e.IterType.Span},r.prototype.getProperty=function(){if(!this.nodeProperty){var e=this.textStream.createParagraphIterator(this.range).getProperty(!0);if(e){if(""!==(e=this.dataEngine.getStyleSheetEngine().mergeStyleParaProperty(e)).listId&&this.dataEngine.getListManager()){var t=this.dataEngine.getListManager().getListInfoFromGcpRange(this.range);t&&(e=t)}(e instanceof qr||e instanceof $r&&e.isRowStart||e instanceof an&&e.isCellStart)&&(e.hidden=!0)}this.nodeProperty=e}return this.nodeProperty},r.prototype.getNextSibling=function(e){var r=this;return t.prototype.generateNextSibling.call(this,(function(t){return dp(r.dataEngine,t,r.parentNode,e)}))},r.prototype.getPrevSibling=function(){var e=this;return t.prototype.generatePrevSibling.call(this,(function(t){return dp(e.dataEngine,t,e.parentNode)}))},r.prototype.getBeginChild=function(){var e=this;return t.prototype.generateBeginChild.call(this,(function(t,r){return pp(e,e.dataEngine,e.getLimitRange(),t.begin(),!1,r)}))},r.prototype.concat=function(e){var t=e.getGCPRange();this.range.end()===t.begin()&&(this.range.len+=t.len)},r}(Xs),cp=function(t){function r(r,n,o,i){return t.call(this,r,n,e.LayoutInputNodeType.TableCell,o,i)||this}return qs(r,t),r.prototype.getChildIterType=function(){return e.IterType.Paragraph},r.prototype.getProperty=function(){if(!this.nodeProperty){var e=this.textStream.tableStream.getTableCellInfoFromGcp(this.range.begin());e&&(this.nodeProperty=e.property)}return this.nodeProperty},r.prototype.getNextSibling=function(){var e=this.parentNode,t=this.textStream,n=this.range,o=this.dataEngine;if(e){var i=e.getLimitRange(),a=t.tableStream.createTableCellIter(i),s=n.end()-1;if(a.seek(s),a.next())return new r(o,a.getRange(),e)}return null},r.prototype.getPrevSibling=function(){var e=this.parentNode,t=this.textStream,n=this.range,o=this.dataEngine;if(e){var i=e.getLimitRange(),a=t.tableStream.createTableCellIter(i),s=n.begin();if(a.seek(s),a.prev())return new r(o,a.getRange(),e)}return null},r.prototype.getBeginChild=function(e){var r=this;return t.prototype.generateBeginChild.call(this,(function(t,n){return dp(r.dataEngine,t,r,e,n)}))},r.prototype.getCellIndex=function(){var e=this.parentNode,t=this.textStream,r=this.range;if(e){var n=e.getLimitRange(),o=t.tableStream.createTableCellIter(n,!0),i=r.end()-1;o.seek(i);for(var a=0;o.prev();)a+=1;return a}return-1},r.prototype.isMerged=function(){return this.textStream.tableStream.isCellMergedFromGcp(this.range.begin())},r}(Xs),up=function(t){function r(r,n,o,i){return t.call(this,r,n,e.LayoutInputNodeType.TableRow,o,i)||this}return qs(r,t),r.prototype.getChildIterType=function(){return e.IterType.Span},r.prototype.getProperty=function(){if(!this.nodeProperty){var e=this.textStream.tableStream.getTableRowInfoFromGcp(this.range.begin());e&&(this.nodeProperty=e.property)}return this.nodeProperty},r.prototype.getNextSibling=function(){var e=this.parentNode,t=this.textStream,n=this.range,o=this.dataEngine;if(e){var i=e.getLimitRange(),a=t.tableStream.createTableRowIter(i),s=n.end()-1;if(a.seek(s),a.next())return new r(o,a.getRange(),e)}return null},r.prototype.getPrevSibling=function(){var e=this.parentNode,t=this.textStream,n=this.range,o=this.dataEngine;if(e){var i=e.getLimitRange(),a=t.tableStream.createTableRowIter(i),s=n.begin();if(a.seek(s),a.prev())return new r(o,a.getRange(),e)}return null},r.prototype.getBeginChild=function(){var e=this.textStream.tableStream.createTableCellIter(this.range),t=this.range.begin()+this.offsets[0];e.seek(t);var r=e.getRange();return!r||r.isEmpty()?null:new cp(this.dataEngine,r,this,[t-r.begin()])},r}(Xs),hp=function(){function e(){}return e.getAdaptedSectionProperty=function(e){if(!e)return null;var t=e.clone();return r.PlatformUtil.isMobile()&&(t.pageWidth=ot.section.pageSize.width,t.pageHeight=ot.section.pageSize.height,t.marginTop=ot.section.pageMargins.top,t.marginRight=ot.section.pageMargins.right,t.marginBottom=ot.section.pageMargins.bottom,t.marginLeft=ot.section.pageMargins.left,t.defaultHeaderRefId="",t.defaultFooterRefId="",t.firstHeaderRefId="",t.firstFooterRefId="",t.evenHeaderRefId="",t.evenFooterRefId=""),t},e.getAdaptedTableProperty=function(e,t){if(!e)return null;var n=e.clone();return t&&(r.PlatformUtil.isMobile()&&!r.PlatformUtil.isIPad()||r.PlatformUtil.isMobile()&&r.PlatformUtil.isIPad())&&(n.paddingLeft=t.marginLeft,n.paddingRight=t.marginRight),n},e.getClientSize=function(){return{width:document.documentElement.clientWidth||ot.nativeScreenSize.width,height:document.documentElement.clientHeight||ot.nativeScreenSize.height}},e}(),fp=function(t){function r(r,n,o,i){return t.call(this,r,n,e.LayoutInputNodeType.Table,o,i)||this}return qs(r,t),r.prototype.getChildIterType=function(){return e.IterType.Span},r.prototype.getProperty=function(){if(!this.nodeProperty){var e=this.textStream.tableStream.getTableInfoFromGcp(this.range.begin());if(e){var t=this.parentNode&&this.parentNode.getProperty();if(t instanceof lt){var r=hp.getAdaptedTableProperty(e.property,t);r&&(this.nodeProperty=r)}else this.nodeProperty=e.property}}return this.nodeProperty},r.prototype.getNextSibling=function(e){var r=this;return t.prototype.generateNextSibling.call(this,(function(t){return dp(r.dataEngine,t,r.parentNode,e)}))},r.prototype.getPrevSibling=function(){var e=this;return t.prototype.generatePrevSibling.call(this,(function(t){return dp(e.dataEngine,t,e.parentNode)}))},r.prototype.getBeginChild=function(){var e=this.textStream.tableStream.createTableRowIter(this.range),t=this.range.begin()+this.offsets[0];e.seek(t);var r=e.getRange();return!r||r.isEmpty()?null:new up(this.dataEngine,r,this,[t-r.begin()])},r}(Xs);function dp(e,t,r,n,o){var i=t.begin(),a=e.getTextStream(),s=a.tableStream.getTableInfoFromGcp(i);if(s&&(0===function(e){for(var t=e,r=0;t;)t instanceof fp&&(r+=1),t=t.getParentNode()||void 0;return r}(r)&&r)){var p=s.range,l=o?o.map((function(e){return Math.max(0,t.begin()+e-p.begin())})):o;return new fp(e,p,r,l)}var c=new lp(e,t,r,o);if(function(){if(!r)return!1;var e=r.getGCPRange().end()-1;return t.end()===e&&go(a.charCodeAt(e))}()){var u=new lp(e,new ne(t.end(),1),r);c.concat(u)}if(n){var h=c.getProperty();if(h&&h.listId)return Qs.create(e,c,r)}return c}var gp=function(t){function r(r,n,o,i){var a=t.call(this,r,n,e.LayoutInputNodeType.Section,o,i)||this;return a.ignoreBreak=!1,a}return qs(r,t),r.prototype.ignoreSectionBreak=function(){go(this.textStream.charCodeAt(this.range.end()-1))&&(this.ignoreBreak=!0,this.range.len-=1)},r.prototype.isLastChild=function(){if(!this.ignoreBreak)return t.prototype.isLastChild.call(this);if(!this.parentNode)return!0;var e=this.parentNode.getGCPRange();return this.range.end()+1===e.end()},r.prototype.getProperty=function(){if(!this.nodeProperty){var e=this.textStream.createSectionIterator(this.range);if(!this.parentNode)return e.getProperty(!0);this.nodeProperty=hp.getAdaptedSectionProperty(e.getProperty(!0))}return this.nodeProperty},r.prototype.getChildIterType=function(){return e.IterType.Paragraph},r.prototype.getNextSibling=function(){var e=this;return t.prototype.generateNextSibling.call(this,(function(t){return r.create(e.dataEngine,t,e.parentNode)}))},r.prototype.getPrevSibling=function(){var e=this;return t.prototype.generatePrevSibling.call(this,(function(t){return r.create(e.dataEngine,t,e.parentNode)}))},r.prototype.getBeginChild=function(e){var r=this;return t.prototype.generateBeginChild.call(this,(function(t,n){return dp(r.dataEngine,t,r,e,n)}))},r.create=function(e,t,n,o){var i=new r(e,t,n,o);return i.isLastChild()&&i.ignoreSectionBreak(),i.getTextRange().isEmpty()?null:i},r}(Xs),yp=function(t){function r(r,n,o,i){var a=t.call(this,r,n,e.LayoutInputNodeType.Document,void 0,i)||this;return a.storyId="",a.docEnv=o,a}return qs(r,t),r.prototype.getProperty=function(){if(!this.nodeProperty){var e=this.textStream.createStoryIterator(this.range);this.nodeProperty=e.getProperty(!0)}return this.nodeProperty},r.prototype.getChildIterType=function(){return e.IterType.Section},r.prototype.getNextSibling=function(){return null},r.prototype.getPrevSibling=function(){return null},r.prototype.getBeginChild=function(){var e=this;return t.prototype.generateBeginChild.call(this,(function(t,r){return gp.create(e.dataEngine,t,e,r)}))},r.prototype.getTextRange=function(){var e=t.prototype.getTextRange.call(this);return go(this.textStream.charCodeAt(this.range.end()-1))&&(e.len-=1),e},r.prototype.getChildByOffset=function(e){if(this.range.isEmpty())return null;var t=this.textStream.createSectionIterator(this.range),r=this.range.begin()+e;t.seek(r);var n=t.getRange(!0);return!n||n.isEmpty()?null:gp.create(this.dataEngine,n,this,[r-n.begin()])},r}(Xs);function mp(t,n){var o=t.getTextStream().getMainStoryInfo(),i=o&&o.range||ne.emptyRange();i.isEmpty()&&r.Logger.error("main document range is empty!"),(i.isEmpty()||0!==i.begin())&&g.captureException(e.MonitorName.CHANGESET_ERROR_MAIN_RANGE,{},new Error(JSON.stringify(i)));var a=new yp(t,i,n);return a.storyId=e.StoryID.MainDocId,a}function bp(e,t,r){var n=e.getTextStream();if(t){var o=n.findStoryInfoFromId(t);if(o){var i=new yp(e,o.range,r);return i.storyId=t,i}}}
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
var Pp=function(e,t){return(Pp=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)};function vp(e,t){function r(){this.constructor=e}Pp(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var xp=function(){return(xp=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function Tp(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}function _p(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Sp(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a}function Cp(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(Sp(arguments[t]));return e}var Bp=function(e){function t(t){var r=e.call(this)||this;return r.measure=t.measure,r.extent=t.extent,r}return vp(t,e),t.obtain=function(e){var r=t.sPool.obtain();return e?(r?(r.measure=e.measure,r.extent=e.extent):r=new t(e),r):r||t.zero},t.prototype.recycle=function(){this.measure=0,this.extent=0,t.sPool.recycle(this)},Object.defineProperty(t,"zero",{get:function(){return new t({measure:0,extent:0})},enumerable:!0,configurable:!0}),t.prototype.equal=function(e){return this.measure===e.measure&&this.extent===e.extent},t.prototype.contain=function(e){return this.measure>=e.measure&&this.extent>=e.extent},t.prototype.isZero=function(){return 0===this.measure&&0===this.extent},t.prototype.toString=function(){return"(m="+this.measure+", e="+this.extent+")"},t.sPool=new r.ObjectPool(100),t}(r.PoolNode),Rp=function(){function e(e,t){this.start=e,this.before=t}return Object.defineProperty(e,"zero",{get:function(){return new e(0,0)},enumerable:!0,configurable:!0}),e.sZero=e.zero,e}(),wp=function(e){this.before=e.before,this.start=e.start,this.after=e.after,this.end=e.end},Ip=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return vp(t,e),Object.defineProperty(t,"zero",{get:function(){return new t({before:0,start:0,after:0,end:0})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"measure",{get:function(){return this.start+this.end},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"extent",{get:function(){return this.before+this.after},enumerable:!0,configurable:!0}),t.sZero=t.zero,t}(wp),Ep=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return vp(t,e),Object.defineProperty(t,"none",{get:function(){return new t({before:"",start:"",after:"",end:""})},enumerable:!0,configurable:!0}),t}(wp),Lp=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return vp(r,t),Object.defineProperty(r,"none",{get:function(){return new r({before:e.BorderStyleType.none,start:e.BorderStyleType.none,after:e.BorderStyleType.none,end:e.BorderStyleType.none})},enumerable:!0,configurable:!0}),Object.defineProperty(r,"solid",{get:function(){return new r({before:e.BorderStyleType.solid,start:e.BorderStyleType.solid,after:e.BorderStyleType.solid,end:e.BorderStyleType.solid})},enumerable:!0,configurable:!0}),r}(wp),Op=function(){function e(e){this.width=e.width,this.style=e.style,this.color=e.color}return Object.defineProperty(e,"none",{get:function(){return new e({width:Ip.zero,style:Lp.none,color:Ep.none})},enumerable:!0,configurable:!0}),e.sNone=e.none,e}(),Np=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return vp(t,e),Object.defineProperty(t.prototype,"rMargin",{get:function(){return this.margin||Ip.sZero},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rBorder",{get:function(){return this.border||Op.sNone},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rPadding",{get:function(){return this.padding||Ip.sZero},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"start",{get:function(){return(this.margin?this.margin.start:0)+(this.border?this.border.width.start:0)+(this.padding?this.padding.start:0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"end",{get:function(){return(this.margin?this.margin.end:0)+(this.border?this.border.width.end:0)+(this.padding?this.padding.end:0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"before",{get:function(){return(this.margin?this.margin.before:0)+(this.border?this.border.width.before:0)+(this.padding?this.padding.before:0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"after",{get:function(){return(this.margin?this.margin.after:0)+(this.border?this.border.width.after:0)+(this.padding?this.padding.after:0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"measure",{get:function(){return this.start+this.end},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"extent",{get:function(){return this.before+this.after},enumerable:!0,configurable:!0}),t.prototype.recycle=function(){this.margin=void 0,this.border=void 0,this.padding=void 0,t.sPool.recycle(this)},t.obtain=function(e){var r=t.sPool.obtain()||new t;return e&&(e.margin&&(r.margin=new Ip(e.margin)),e.border&&(r.border=new Op(e.border)),e.padding&&(r.padding=new Ip(e.padding))),r},t.sPool=new r.ObjectPool(50),t.sNone=new t,t}(r.PoolNode),kp=function(){function e(){this.measure=0,this.extent=Number.POSITIVE_INFINITY,this.edge=Np.obtain()}return Object.defineProperty(e.prototype,"size",{get:function(){return Bp.obtain({measure:this.measure,extent:this.extent})},enumerable:!0,configurable:!0}),e}(),Mp=function(){function e(){}return e.obtain=function(e){var t=Ja.obtain();if(!e)return t;var r=e.margin,n=e.border,o=e.padding;return r&&this._copy(t.margin,r),n&&this._copyBorder(t.border,n),o&&this._copy(t.padding,o),t},e._copyBorder=function(e,t){t.width&&this._copy(e.width,t.width),t.style&&this._copy(e.style,t.style),t.color&&this._copy(e.color,t.color)},e._copy=function(e,t){Object.assign(e,{top:t.before,left:t.start,bottom:t.after,right:t.end})},e}(),Dp=function(){function t(e){this._uuid="",this._siblingIndex=0,this._indexPairs=[],this._isDirty=!1,this._logicSize=Bp.obtain(e),this.refreshUUID()}return t.prototype.clone=function(e){var t=new(0,this.constructor);return t._siblingIndex=this._siblingIndex,t._firstIndex=this._firstIndex,t._lastIndex=this._lastIndex,t._indexPairs=this._indexPairs,t._logicSize=this._logicSize,t._logicPoint=this.logicPoint,t._logicEdge=this.logicEdge,t._position=this.position,t._layoutRegion=this.layoutRegion,t._isDirty=this._isDirty,t.isLast=this.isLast,t.isPageBreak=this.isPageBreak,t.hidden=this.hidden,t},t.prototype.refreshUUID=function(){this._uuid=""+t.UUID,t.UUID+=1},Object.defineProperty(t.prototype,"rect",{get:function(){return new r.MeloRect({x:this.logicPoint.start,y:this.logicPoint.before,width:this.measure,height:this.extent})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"edge",{get:function(){return Mp.obtain(this._logicEdge)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalWidth",{get:function(){return this.totalMeasure},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalHeight",{get:function(){return this.totalExtent},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalBoxSize",{get:function(){return new r.MeloSize({width:this.measure+(this.logicEdge?this.logicEdge.measure:0),height:this.extent+(this.logicEdge?this.logicEdge.extent:0)})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"borderBoxSize",{get:function(){var e=this.measure,t=this.extent;return this.logicEdge&&this.logicEdge.padding&&(e+=this.logicEdge.padding.measure,t+=this.logicEdge.padding.extent),this.logicEdge&&this.logicEdge.border&&(e+=this.logicEdge.border.width.measure,t+=this.logicEdge.border.width.extent),new r.MeloSize({width:e,height:t})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paddingBoxSize",{get:function(){var e=this.measure,t=this.extent;return this.logicEdge&&this.logicEdge.padding&&(e+=this.logicEdge.padding.measure,t+=this.logicEdge.padding.extent),new r.MeloSize({width:e,height:t})},enumerable:!0,configurable:!0}),t.prototype.getOuterPoint=function(){if(this.position.isAbsolute())return new r.MeloPoint({x:this.logicPoint.start,y:this.logicPoint.before});for(var t=new r.MeloPoint,n=this.prevSibling;n;)this.display===e.LayoutDisplay.Block?t.y+=n.totalExtent:t.x+=n.totalMeasure,n=n.prevSibling;if(this.parentBox&&!this.parentBox.isZero()){var o=this.parentBox.logicEdge;(null==o?void 0:o.padding)&&(t.x+=o.padding.start,t.y+=o.padding.before)}return t},t.prototype.getInnerPoint=function(){var e=this.getOuterPoint();return this.logicEdge&&e.offset(this.logicEdge.start,this.logicEdge.before),e},Object.defineProperty(t.prototype,"position",{get:function(){return this._position||(this._position=new rs),this._position},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"measure",{get:function(){return this._logicSize?this._logicSize.measure:0},enumerable:!0,configurable:!0}),t.prototype.setMeasure=function(e){this._logicSize||(this._logicSize=Bp.obtain()),this._logicSize.measure=e},Object.defineProperty(t.prototype,"extent",{get:function(){return this._logicSize?this._logicSize.extent:0},enumerable:!0,configurable:!0}),t.prototype.setExtent=function(e){this._logicSize||(this._logicSize=Bp.obtain()),this._logicSize.extent=e},Object.defineProperty(t.prototype,"totalMeasure",{get:function(){return this.measure+(this.logicEdge?this.logicEdge.measure:0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalExtent",{get:function(){return this.extent+(this.logicEdge?this.logicEdge.extent:0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"logicPoint",{get:function(){return this._logicPoint?this._logicPoint:Rp.sZero},set:function(e){this._logicPoint=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"logicEdge",{get:function(){return this._logicEdge},set:function(e){this._logicEdge=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalLogicSize",{get:function(){return Bp.obtain({measure:this.totalMeasure,extent:this.totalExtent})},enumerable:!0,configurable:!0}),t.prototype.isZero=function(){return 0===this.measure||0===this.extent},Object.defineProperty(t.prototype,"layoutRegion",{get:function(){return this._layoutRegion||(this._layoutRegion=new kp),this._layoutRegion},set:function(e){this._layoutRegion=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"uuid",{get:function(){return this._uuid},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstIndex",{get:function(){return this._firstIndex||Z.val},set:function(e){this._firstIndex=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastIndex",{get:function(){return this._lastIndex||Z.val},set:function(e){this._lastIndex=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"indexPairs",{get:function(){return this._indexPairs.length>0?this._indexPairs:[{first:this.firstIndex,last:this.lastIndex}]},enumerable:!0,configurable:!0}),t.prototype.needMergeIndex=function(){return!0},Object.defineProperty(t.prototype,"parentBox",{get:function(){return this._parentBox},set:function(e){this._parentBox=e},enumerable:!0,configurable:!0}),t.prototype.setSiblingIndex=function(e){this._siblingIndex=e},t.prototype.getSiblingIndex=function(){return this._siblingIndex},Object.defineProperty(t.prototype,"nextSibling",{get:function(){if(this._parentBox){var e=this._siblingIndex+1,t=this._parentBox.children;if(e<t.length)return t[e]}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"prevSibling",{get:function(){if(this._parentBox){var e=this._siblingIndex-1;if(e>=0)return this._parentBox.children[e]}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"display",{get:function(){return e.LayoutDisplay.Block},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){var e=this.constructor;return null==e?void 0:e.name},enumerable:!0,configurable:!0}),t.prototype.countNodes=function(e,t){return!e||e(this)?1:0},t.prototype.countWord=function(e){return 0},t.prototype.isSelfDirty=function(){return this._isDirty},t.prototype.isDirty=function(){return!!this._isDirty||!!this.parentBox&&this.parentBox.isDirty()},t.prototype.markDirty=function(e){this._isDirty=!0},t.prototype.markAllDirty=function(e){this.markDirty(e)},t.prototype.recycle=function(){this._logicEdge&&(this._logicEdge.recycle(),this._logicEdge=void 0),this._logicSize&&(this._logicSize.recycle(),this._logicSize=void 0)},t.UUID=0,t}();function Fp(e){var t=e;return void 0!==t&&(void 0!==t.firstChild&&void 0!==t.lastChild&&void 0!==t.children&&void 0!==t.getChildByPoint)}var Ap,Kp=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e._children=[],e}return vp(n,t),n.prototype.clone=function(e){var r=t.prototype.clone.call(this,e),n=[];return this._children.forEach((function(t){var o=t.clone(e);o.parentBox=r,n.push(o)})),r._children=n,r},Object.defineProperty(n.prototype,"firstChild",{get:function(){return this._children.length>0?this._children[0]:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"lastChild",{get:function(){var e=this._children.length;return e>0?this._children[e-1]:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"children",{get:function(){return this._children},enumerable:!0,configurable:!0}),n.prototype.getChildrenInY=function(e,t){var n=new r.MeloRect({x:0,y:e,width:0,height:t});return this.getChildrenByRect(n,(function(e,t){return t.y<=e.getBottom()&&e.y<=t.getBottom()}))},n.prototype.getChildrenByRect=function(t,n){if(this._children.length<1)return[];var o=n||function(e,t){return t.intersect(e)},i=this.edge.padding.top,a={x:this.edge.padding.left,y:i},s=[];return this._children.forEach((function(n){var i;if(n.position.isAbsolute())i=n.rect;else{var p=n.totalBoxSize;i=new r.MeloRect({x:a.x,y:a.y,width:p.width,height:p.height}),n.display===e.LayoutDisplay.Block?a.y+=p.height:a.x+=p.width}o(t,i)&&s.push(n)})),s},n.prototype.getChildByPoint=function(t,n){if(this._children.length<1)return[];var o,i=n||function(e,t){return t.contains(e)},a=this.edge.padding.top,s={x:this.edge.padding.left,y:a};return this._children.some((function(n){var a=n.rect;if(!n.position.isAbsolute()){var p=n.totalBoxSize;a=new r.MeloRect({x:s.x,y:s.y,width:p.width,height:p.height}),n.display===e.LayoutDisplay.Block?s.y+=p.height:s.x+=p.width}return!!i(t,a)&&(o=[n,{x:t.x-a.x,y:t.y-a.y}],!0)})),o||[]},n.prototype.clearChildren=function(){this._children=[],this._indexPairs=[]},n.prototype.append=function(e){for(var t=this,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];if(r&&!(r.length<1)){var o=this._children.length;r.forEach((function(e,r){t._children.push(e),t.onAppendChild(e,o+r)})),this.updateIndexPairs.apply(this,Cp([e],r))}},n.prototype.onAppendChild=function(e,t){e.parentBox=this,e.setSiblingIndex(t)},n.prototype.updateIndexPairs=function(e){for(var t=this,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];!r||r.length<1||this.needMergeIndex()&&r.forEach((function(r){e.boxHelper.mergeIndex(r.indexPairs,t._indexPairs)}))},n.prototype.countNodes=function(e,t){var r=0;return e&&!e(this)||(r+=1),(null==t?void 0:t(this))||this.children.forEach((function(n){r+=n.countNodes(e,t)})),r},n.prototype.countWord=function(e){if(void 0===this._wordCount){var t=0;this.children.forEach((function(r){t+=r.countWord(e)})),this._wordCount=t}return this._wordCount},Object.defineProperty(n.prototype,"firstIndex",{get:function(){if(this._firstIndex)return this._firstIndex;var e=this.firstChild;return e?e.firstIndex:Z.val},set:function(e){this._firstIndex=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"lastIndex",{get:function(){if(this._lastIndex)return this._lastIndex;var e=this.lastChild;return e?e.lastIndex:Z.val},set:function(e){this._lastIndex=e},enumerable:!0,configurable:!0}),n.prototype.markAllDirty=function(e){var r=this;this._children.forEach((function(t){t.parentBox===r&&t.markAllDirty(e)})),t.prototype.markAllDirty.call(this,e)},n.prototype.recycle=function(){var e=this;this._children.forEach((function(t){t.parentBox===e&&(t.parentBox=void 0,t.recycle())})),this._children=[],t.prototype.recycle.call(this)},n.create=function(e,t){return new e(t)},n}(Dp),Gp=function(t){function r(){var r=null!==t&&t.apply(this,arguments)||this;return r.kind=e.BoxKind.Document,r}return vp(r,t),r.prototype.clone=function(e){return t.prototype.clone.call(this,e)},r.prototype.append=function(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];t.prototype.append.apply(this,Cp([e],r)),this.refreshUUID(),this._wordCount=void 0},r.prototype.onAppendChild=function(e,r){t.prototype.onAppendChild.call(this,e,r),this.setMeasure(Math.max(this.measure,e.totalMeasure)),this.setExtent(this.extent+e.totalExtent)},Object.defineProperty(r.prototype,"parentBox",{get:function(){},enumerable:!0,configurable:!0}),r.prototype.needMergeIndex=function(){return!0},r}(Kp),Hp=function(){function e(e,t){this._text=e,this._options=void 0===t?{lineBreak:n.LineBreakOption.Strict,wordBreak:n.WordBreakOption.Normal}:t,this._breaker=new n.LineBreaker(this._text,this._options)}return Object.defineProperty(e.prototype,"text",{get:function(){return this._text},enumerable:!0,configurable:!0}),e.prototype.next=function(){return this._breaker.next()},e}(),jp=function(e){return e.logicEdge||Np.sNone},Up=function(t){function n(){var r=null!==t&&t.apply(this,arguments)||this;return r.kind=e.BoxKind.ContainerPage,r.type=e.ContainerPageType.Main,r.storyId="",r.logicIndex=0,r}return vp(n,t),n.prototype.clone=function(e){var r=t.prototype.clone.call(this,e);return r.storyId=this.storyId,r.logicIndex=this.logicIndex,r},n.prototype.getOuterPoint=function(){for(var e=new r.MeloPoint,t=this.prevPageBox;t;)e.y+=t.totalExtent,t=t.prevPageBox;if(this.parentBox){var n=jp(this.parentBox);e.x+=n.rPadding.start,e.y+=n.rPadding.before}return e},Object.defineProperty(n.prototype,"prevPageBox",{get:function(){if(this.parentBox)return this.parentBox.getPageBox(this.logicIndex-1)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"nextSibling",{get:function(){},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"prevSibling",{get:function(){},enumerable:!0,configurable:!0}),n.prototype.needMergeIndex=function(){return!0},n}(Kp),zp=function(t){function r(){var r=null!==t&&t.apply(this,arguments)||this;return r.type=e.ContainerPageType.Footer,r}return vp(r,t),r}(Up),Wp=function(t){function r(){var r=null!==t&&t.apply(this,arguments)||this;return r.type=e.ContainerPageType.Header,r}return vp(r,t),r}(Up),Vp=function(t){function n(){var r=null!==t&&t.apply(this,arguments)||this;return r.kind=e.BoxKind.LogicPage,r}return vp(n,t),n.prototype.clone=function(e){var r=t.prototype.clone.call(this,e);return r._headerPage=this._headerPage&&this._headerPage.clone(e),r._mainPage=this._mainPage&&this._mainPage.clone(e),r._footerPage=this._footerPage&&this._footerPage.clone(e),r._coreRect=this._coreRect,r},Object.defineProperty(n.prototype,"headerPage",{get:function(){return this._headerPage||new Wp},set:function(e){e.parentBox=this,e.logicIndex=0,this._headerPage=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"footerPage",{get:function(){return this._footerPage||new zp},set:function(e){e.parentBox=this,e.logicIndex=2,this._footerPage=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"mainPage",{get:function(){return this._mainPage||new Up},set:function(e){e.parentBox=this,e.logicIndex=1,this._indexPairs=e.indexPairs,this._mainPage=e,this._wordCount=void 0},enumerable:!0,configurable:!0}),n.prototype.getPageBox=function(e){switch(e){case 0:return this.headerPage;case 1:return this.mainPage;case 2:return this.footerPage;default:return}},Object.defineProperty(n.prototype,"coreRect",{get:function(){return this._coreRect||new r.MeloRect},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"firstIndex",{get:function(){return this.mainPage.firstIndex},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"lastIndex",{get:function(){return this.mainPage.lastIndex},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"firstChild",{get:function(){return this._mainPage},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"lastChild",{get:function(){return this._mainPage},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"children",{get:function(){return this._mainPage?[this._mainPage]:[]},enumerable:!0,configurable:!0}),n.prototype.countNodes=function(e,t){var r=0;return e&&!e(this)||(r+=1),(null==t?void 0:t(this))?r:(r+=this.headerPage.countNodes(e,t),r+=this.mainPage.countNodes(e,t),r+=this.footerPage.countNodes(e,t))},n.prototype.countWord=function(e){return void 0===this._wordCount&&(this._wordCount=this.mainPage.countWord(e)),this._wordCount},n.prototype.getChildrenInY=function(e,t){var r=e+t,n=[],o=[this.headerPage,this.mainPage,this.footerPage],i=this.edge.padding.top;return o.forEach((function(t){var o=t.totalHeight;i<=r&&e<=i+o&&n.push(t),i+=o})),n},n.prototype.getChildByPoint=function(e){var t,r=this.edge.padding.top,n={x:this.edge.padding.left,y:r};return[this.headerPage,this.mainPage,this.footerPage].some((function(r){var o=r.totalBoxSize;return n.y+o.height>=e.y?(t=[r,{x:e.x-n.x,y:e.y-n.y}],!0):(n.y+=o.height,!1)})),t||[]},n.prototype.markAllDirty=function(e){this._headerPage&&this._headerPage.parentBox===this&&this._headerPage.markAllDirty(e),this._mainPage&&this._mainPage.parentBox===this&&this._mainPage.markAllDirty(e),this._footerPage&&this._footerPage.parentBox===this&&this._footerPage.markAllDirty(e),t.prototype.markAllDirty.call(this,e)},n.prototype.recycle=function(){this._mainPage&&this._mainPage.parentBox===this&&(this._mainPage.parentBox=void 0,this._mainPage.recycle(),this._mainPage=void 0),t.prototype.recycle.call(this)},n}(Dp),Yp=function(t){function r(){var r=null!==t&&t.apply(this,arguments)||this;return r.kind=e.BoxKind.Section,r}return vp(r,t),r.prototype.clone=function(e){return t.prototype.clone.call(this,e)},r.prototype.needMergeIndex=function(){return!0},r}(Kp),qp=function(t){function r(){var r=null!==t&&t.apply(this,arguments)||this;return r.kind=e.BoxKind.TextPage,r}return vp(r,t),r.prototype.clone=function(e){return t.prototype.clone.call(this,e)},r.prototype.needMergeIndex=function(){return!0},r}(Kp),Xp=function(t){function n(){var r=null!==t&&t.apply(this,arguments)||this;return r.kind=e.BoxKind.Paragraph,r}return vp(n,t),n.prototype.clone=function(e){var r=t.prototype.clone.call(this,e);return r._paraProps=this._paraProps,r},Object.defineProperty(n.prototype,"paraProps",{get:function(){return this._paraProps||new gt},set:function(e){this._paraProps=e},enumerable:!0,configurable:!0}),n.prototype.countWord=function(e){if(void 0===this._wordCount){var t=0;e.boxHelper.getGCPRanges(this).forEach((function(n){var o=e.textStream.readText(n.begin(),n.length());t+=r.StringUtil.countWordReg(o)})),this._wordCount=t}return this._wordCount},n}(Kp),Jp=function(t){function r(){var r=null!==t&&t.apply(this,arguments)||this;return r.kind=e.BoxKind.TextLine,r._ascent=0,r._descent=0,r.sourceExtent=0,r.contentWidth=0,r}return vp(r,t),r.prototype.clone=function(e){var r=t.prototype.clone.call(this,e);return r._ascent=this._ascent,r._descent=this._descent,r.sourceExtent=this.sourceExtent,r.contentWidth=this.contentWidth,r.isFirst=this.isFirst,r},Object.defineProperty(r.prototype,"ascent",{get:function(){return this._ascent?this._ascent:this.extent},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"descent",{get:function(){return this._descent},enumerable:!0,configurable:!0}),r.prototype.setBaseline=function(e,t){this._ascent=e,this._descent=t},r}(Kp),Zp=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return vp(t,e),t.prototype.clone=function(t){var r=e.prototype.clone.call(this,t);if(this.listMark){var n=this.listMark.clone(t);n.lineBox=r,r.listMark=n}return r},t}(Jp),Qp=function(t){function r(r){var n=t.call(this,r)||this;return n.kind=e.BoxKind.TextLineFragment,n.type=e.LineFragmentType.Field,n.subType="",n._ascent=0,n._descent=0,n.needUpdate=!1,n._display=e.LayoutDisplay.InlineBlock,n}return vp(r,t),r.prototype.clone=function(e){var r=t.prototype.clone.call(this,e);return r.type=this.type,r.subType=this.subType,r._ascent=this._ascent,r._descent=this._descent,r._display=this._display,r.fieldInfo=this.fieldInfo,r.fieldContext=this.fieldContext?ko(this.fieldContext):void 0,e.fieldBoxMgr.addBox(r),r},Object.defineProperty(r.prototype,"ascent",{get:function(){return this._ascent?this._ascent:this.extent},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"descent",{get:function(){return this._descent},enumerable:!0,configurable:!0}),r.prototype.setBaseline=function(e,t){this._ascent=e,this._descent=t},Object.defineProperty(r.prototype,"display",{get:function(){return this._display},set:function(e){this._display=e},enumerable:!0,configurable:!0}),r}(Kp),$p=function(t){function n(r){var n=t.call(this,r)||this;return n._display=e.LayoutDisplay.Inline,n}return vp(n,t),n.prototype.clone=function(e){var r=t.prototype.clone.call(this,e);return r._display=this._display,r._textStyle=this._textStyle,r},Object.defineProperty(n.prototype,"textStyle",{get:function(){return this._textStyle||new wt},set:function(e){this._textStyle=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"display",{get:function(){return this._display},set:function(e){this._display=e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"ascent",{get:function(){return this.extent},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"descent",{get:function(){return 0},enumerable:!0,configurable:!0}),n.prototype.getOuterPoint=function(){for(var e=new r.MeloPoint,t=this.prevSibling;t;)e.x+=t.totalMeasure,t=t.prevSibling;if(this.parentBox){var n=this.parentBox,o=jp(n);e.x+=o.rPadding.start;var i=this.logicEdge?this.logicEdge.before:0;e.y=o.rPadding.before+n.ascent-this.ascent-i}return e},n}(Dp),el=function(t){function r(){var r=null!==t&&t.apply(this,arguments)||this;return r.kind=e.BoxKind.Table,r.colWidths=[],r.tableId="",r}return vp(r,t),r.prototype.clone=function(e){var r=t.prototype.clone.call(this,e);return r.colWidths=this.colWidths,r.tableId=this.tableId,r},r.prototype.needMergeIndex=function(){return!0},r}(Kp),tl=function(t){function r(){var r=null!==t&&t.apply(this,arguments)||this;return r.kind=e.BoxKind.TableCell,r._renderRowSpan=1,r._emptyIndex=Z.val,r.curBlockPos=0,r._isMerged=!1,r._isRowSpanEnd=!1,r}return vp(r,t),r.prototype.clone=function(e){var r=t.prototype.clone.call(this,e);return r.curBlockPos=this.curBlockPos,r._renderRowSpan=this._renderRowSpan,r._tableCellProps=this._tableCellProps,r._emptyIndex=this._emptyIndex,r._nextBreakSibling=this._nextBreakSibling,r._prevBreakSibling=this._prevBreakSibling,r},r.prototype.recycle=function(){t.prototype.recycle.call(this),this._prevBreakSibling=void 0,this._nextBreakSibling=void 0},Object.defineProperty(r.prototype,"display",{get:function(){return e.LayoutDisplay.InlineBlock},enumerable:!0,configurable:!0}),r.prototype.setEmptyIndex=function(e){e&&(this._emptyIndex=e)},Object.defineProperty(r.prototype,"firstIndex",{get:function(){var e=this.firstChild;return(null==e?void 0:e.firstChild)?e.firstIndex:this._emptyIndex},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"lastIndex",{get:function(){var e=this.lastChild;return(null==e?void 0:e.firstChild)?e.lastIndex:this._emptyIndex},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"nextBreakSibling",{get:function(){return this._nextBreakSibling},set:function(e){this._nextBreakSibling=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"prevBreakSibling",{get:function(){return this._prevBreakSibling},set:function(e){this._prevBreakSibling=e},enumerable:!0,configurable:!0}),r.prototype.getOuterPoint=function(){var e=t.prototype.getOuterPoint.call(this),r=this.parentBox.parentBox,n=this.logicIndex,o=r.colWidths.slice(0,n).reduce((function(e,t){return e+t}),0);return e.x=o,e.y+=this.verticalDiffY,e},Object.defineProperty(r.prototype,"verticalDiffY",{get:function(){var e=0;return this._prevBreakSibling||("bottom"===this.vAlign?e=this.renderCellHeight-this.totalBoxSize.height:"top"===this.vAlign||(e=(this.renderCellHeight-this.totalBoxSize.height)/2)),Math.max(0,e)},enumerable:!0,configurable:!0}),r.prototype.setTableCellProps=function(e){this._tableCellProps=e,this.isRowSpan&&(this._renderRowSpan=0)},Object.defineProperty(r.prototype,"colSpan",{get:function(){return this._tableCellProps?this._tableCellProps.colSpan:1},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isMerged",{get:function(){return void 0!==this.renderIsMerged?this.renderIsMerged:this._isMerged},set:function(e){this._isMerged=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bgColor",{get:function(){return this._tableCellProps?this._tableCellProps.cellcolor:"#000"},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"vAlign",{get:function(){return this._tableCellProps&&this._tableCellProps.vAlign?this._tableCellProps.vAlign:"middle"},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"hAlign",{get:function(){return this._tableCellProps?this._tableCellProps.hAlign:""},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"renderCellHeight",{get:function(){var e=this.renderRowSpan,t=this.parentBox,r=t.parentBox,n=r.children.indexOf(t);return r.children.slice(n,n+e).reduce((function(e,t){return e+t.totalBoxSize.height}),0)},enumerable:!0,configurable:!0}),r.prototype.isEmpty=function(){return!this.firstChild||0===this.firstChild.children.length},Object.defineProperty(r.prototype,"renderRowSpan",{get:function(){return this._renderRowSpan||this.rowSpan},enumerable:!0,configurable:!0}),r.prototype.resetRenderRowSpan=function(){this._renderRowSpan=0},r.prototype.increaseRenderRowSpan=function(){this.isRowSpan&&(this._renderRowSpan+=1)},Object.defineProperty(r.prototype,"rowSpan",{get:function(){return this._tableCellProps?this._tableCellProps.rowSpan:0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isRowSpan",{get:function(){return this.rowSpan>1},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"indexPairs",{get:function(){return!this.isEmpty()&&this._indexPairs.length>0?this._indexPairs:[{first:this.firstIndex,last:this.lastIndex}]},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"logicIndex",{get:function(){var e=this.parentBox;if(e){var t=e.children;return r.filterValidBoxes(t).indexOf(this)}return this.getSiblingIndex()},enumerable:!0,configurable:!0}),r.prototype.isValidBox=function(){return!this.isZero()},r.filterValidBoxes=function(e){return e.filter((function(e){return e.isValidBox()}))},r.prototype.isRowCell=function(){return this._tableCellProps&&this._tableCellProps instanceof sn},Object.defineProperty(r.prototype,"isRowSpanEnd",{get:function(){return this._isRowSpanEnd},set:function(e){this._isRowSpanEnd=e},enumerable:!0,configurable:!0}),r}(Kp),rl=function(t){function r(){var r=null!==t&&t.apply(this,arguments)||this;return r.kind=e.BoxKind.TableRow,r}return vp(r,t),r.prototype.clone=function(e){return t.prototype.clone.call(this,e)},r.prototype.needMergeIndex=function(){return!0},r.prototype.updateIndexPairs=function(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];var o=r.filter((function(e){return e instanceof tl&&(!e.isEmpty()||e.isRowCell()&&!e.prevBreakSibling)}));t.prototype.updateIndexPairs.apply(this,Cp([e],o))},Object.defineProperty(r.prototype,"logicChildren",{get:function(){return tl.filterValidBoxes(this.children)},enumerable:!0,configurable:!0}),r}(Kp),nl=function(t){function r(){var r=null!==t&&t.apply(this,arguments)||this;return r.kind=e.BoxKind.Text,r.type=e.TextType.Normal,r.text="",r}return vp(r,t),r.prototype.clone=function(e){var r=t.prototype.clone.call(this,e);return r.type=this.type,r.text=this.text,r.glyph=this.glyph,r},r.prototype.textString=function(){return this.text},Object.defineProperty(r.prototype,"ascent",{get:function(){return this.glyph?this.glyph.ascent:this.extent},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"descent",{get:function(){return this.glyph?this.glyph.descent:0},enumerable:!0,configurable:!0}),r}($p),ol=function(t){function r(r){var n=t.call(this,r)||this;return n.display=e.LayoutDisplay.InlineBlock,n}return vp(r,t),r}(nl),il=function(e){function t(t){return e.call(this,t)||this}return vp(t,e),t.prototype.textString=function(){return uo.NonBreakSpace},t}(nl),al=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return vp(t,e),t.prototype.textString=function(){return uo.NoWidthOptionalBreak},t}(nl),sl=function(t){function r(){var r=null!==t&&t.apply(this,arguments)||this;return r.charType=e.FieldCharType.None,r}return vp(r,t),r}(nl),pl=function(e){function t(){var t=e.call(this,Bp.zero)||this;return t.hidden=!0,t}return vp(t,e),Object.defineProperty(t.prototype,"glyph",{get:function(){},set:function(e){},enumerable:!0,configurable:!0}),t.prototype.textString=function(){return uo.NoWidthOptionalBreak},t}(nl),ll=function(t){function r(r){var n=t.call(this,r)||this;return n.display=e.LayoutDisplay.InlineBlock,n}return vp(r,t),r.prototype.clone=function(e){return t.prototype.clone.call(this,e)},r}(nl),cl=function(t){function r(r){var n=t.call(this,r)||this;return n.display=e.LayoutDisplay.InlineBlock,n}return vp(r,t),r.prototype.textString=function(){return uo.NoWidthOptionalBreak},r}(nl),ul=function(t,r){var n;if(1===t.length){var o=t.charCodeAt(0);ho(o)?n=new il(r):fo(o)?n=new al(r):o===e.PlaceholderCharCode.FieldBegin?(n=new sl(r)).charType=e.FieldCharType.Begin:o===e.PlaceholderCharCode.FieldSep?(n=new sl(r)).charType=e.FieldCharType.Separate:o===e.PlaceholderCharCode.FieldEnd?(n=new sl(r)).charType=e.FieldCharType.End:o===e.PlaceholderCharCode.TableStart||o===e.PlaceholderCharCode.TableEnd||o===e.PlaceholderCharCode.TableCellStart?n=new pl:mo(o)&&(n=new cl(r))}return n||(n=new nl(r)),n.text=t,n},hl=function(t){function r(r){var n=t.call(this,r)||this;return n.display=e.LayoutDisplay.InlineBlock,n}return vp(r,t),r.prototype.clone=function(e){var r=t.prototype.clone.call(this,e);return r._property=this._property,r.glyph=this.glyph,r},Object.defineProperty(r.prototype,"property",{get:function(){return this._property},set:function(e){this._property=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"ascent",{get:function(){return this.extent},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"descent",{get:function(){return this.glyph&&this.glyph.descent||0},enumerable:!0,configurable:!0}),r.create=function(e,t){return new e(t)},r}($p),fl=function(t){function r(){var r=null!==t&&t.apply(this,arguments)||this;return r.kind=e.BoxKind.Container,r}return vp(r,t),r}(hl),dl=function(t){function n(r){var n=t.call(this,r)||this;return n.kind=e.BoxKind.TextFrame,n.storyId="",n.content=new qp,n}return vp(n,t),n.prototype.clone=function(e){var r=t.prototype.clone.call(this,e);if(this.content){var n=this.content.clone(e);n.parentBox=r,r.content=n}return r},Object.defineProperty(n.prototype,"firstChild",{get:function(){return this.content},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"lastChild",{get:function(){return this.content},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"children",{get:function(){return this.content?[this.content]:[]},enumerable:!0,configurable:!0}),n.prototype.getChildrenInY=function(e,t){if(!this.content)return[];var r=e+t,n=this.edge.padding.top,o=n+this.content.totalHeight;return n<=r&&e<=o?[this.content]:[]},n.prototype.getChildByPoint=function(e,t){if(!this.content)return[];var n=t||function(e,t){return t.contains(e)},o=this.edge.padding.top,i=this.edge.padding.left,a=this.content.totalBoxSize,s=new r.MeloRect({x:i,y:o,width:a.width,height:a.height});return n(e,s)?[this.content,{x:e.x-s.x,y:e.y-s.y}]:[]},n.prototype.countNodes=function(e,t){var r=0;return e&&!e(this)||(r+=1),(null==t?void 0:t(this))||this.content&&(r+=this.content.countNodes(e,t)),r},n.prototype.markDirty=function(e){t.prototype.markDirty.call(this,e),e&&e(this)},n}(hl);!function(e){e[e.PageBreak=0]="PageBreak",e[e.SectionBreak=1]="SectionBreak",e[e.ColumnBreak=2]="ColumnBreak",e[e.BlockBreak=3]="BlockBreak",e[e.LineBreak=4]="LineBreak",e[e.Skip=5]="Skip",e[e.CellBreak=6]="CellBreak",e[e.RowBreak=7]="RowBreak",e[e.Pause=8]="Pause"}(Ap||(Ap={}));var gl,yl=function(){function e(e){this.value=e}return e.prototype.isPageBreak=function(){return this.value===Ap.PageBreak},e.prototype.isColumnBreak=function(){return this.value===Ap.ColumnBreak},e.prototype.isBlockBreak=function(){return this.value===Ap.BlockBreak},e.prototype.isLineBreak=function(){return this.value===Ap.LineBreak},e.prototype.isSkip=function(){return this.value===Ap.Skip},e.prototype.isCellBreak=function(){return this.value===Ap.CellBreak},e.prototype.isRowBreak=function(){return this.value===Ap.RowBreak},e.prototype.isPause=function(){return this.value===Ap.Pause},e.prototype.equals=function(e){return this.value===e.value},e}(),ml=function(e){function t(t,r){var n=e.call(this,t)||this;return n.box=r,n}return vp(t,e),t.prototype.increaseRowSpan=function(){this.box.increaseRenderRowSpan()},t.prototype.getBox=function(){return this.box},Object.defineProperty(t.prototype,"isMerged",{get:function(){return this.box.isMerged},enumerable:!0,configurable:!0}),t}(yl),bl=function(e){function t(t){var r=e.call(this,Ap.Pause)||this;return r.temp=t,r}return vp(t,e),t.prototype.getBlocks=function(){if(!this.temp)return[];var e=[];return this.temp.forEach((function(t){t.isBox()&&e.push(t.getAsBox())})),e},t}(yl),Pl=function(){return new yl(Ap.PageBreak)},vl=function(){return new yl(Ap.BlockBreak)},xl=function(e){return new ml(Ap.CellBreak,e)},Tl=function(e){return new bl(e)},_l=function(){function e(e){this.value=e}return e.prototype.isControl=function(){return this.value instanceof yl},e.prototype.isBox=function(){return this.value instanceof Dp},e.prototype.getAsControl=function(){return this.value},e.prototype.getAsBox=function(){return this.value},e}();!function(e){e.None="none",e.Contents="contents",e.Block="block",e.Inline="inline",e.InlineBlock="inline-block"}(gl||(gl={}));var Sl,Cl=function(){function e(e,t){this.inlinePos=0,this.blockPos=0,this.inlinePos=e,this.blockPos=t}return e.zero=function(){return new e(0,0)},e}(),Bl=function(){function t(e){this.measure=Number.POSITIVE_INFINITY,this.extent=Number.POSITIVE_INFINITY,this.globalPageNum=0,this.sectionPageNum=0,this.node=e,this.edge=Np.obtain(),this.typeareaSize=Bp.zero,this.typeareaPoint=Rp.zero}return t.prototype.loadPageStyles=function(){if(this.section){this._sectionProps=this.section.getProperty();var t=this._sectionProps.pageSize;t.orientation===e.PaperOrientation.Portrait?(this.measure=t.width,this.extent=t.height):(this.measure=t.height,this.extent=t.width),this.edge.margin=Ip.zero,this.edge.margin.after=ot.paperMarginBottom;var r=this._sectionProps.pageMargins;this.typeareaSize.measure=this.measure-r.left-r.right,this.typeareaSize.extent=this.extent-r.top-r.bottom,this.typeareaPoint=new Rp(r.left,r.top),this.maxHeaderExtent=this.extent*ot.headerMaxHeightRatio-ot.section.pageMargins.header,this.maxFooterExtent=this.extent*ot.footerMaxHeightRatio-ot.section.pageMargins.footer,this.minHeaderExtent=r.top-ot.section.pageMargins.header,this.minFooterExtent=r.bottom-ot.section.pageMargins.footer}},t.prototype.init=function(e){this.section=this.node.getChildByOffset(e)||void 0,this.loadPageStyles(),this.sectionPageNum=0},t.prototype.advanceToNextPage=function(e,t){var r=this.node.getGCPRange().begin()+e;this.section&&this.section.getGCPRange().contains(r)?this.sectionPageNum+=1:(this.section=this.node.getChildByOffset(e)||void 0,this.sectionPageNum=1,this.loadPageStyles()),t&&1===this.sectionPageNum&&t(this._sectionProps),this.globalPageNum+=1},Object.defineProperty(t.prototype,"pageMargins",{get:function(){return(this._sectionProps||ot.section).pageMargins},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"headerBoxRegion",{get:function(){var e=this.pageMargins,t=new kp;return t.measure=this.measure-e.left-e.right,t.extent=Number.POSITIVE_INFINITY,t.edge.padding=Ip.zero,t.edge.padding.start=e.left,t.edge.padding.end=e.right,t.edge.padding.before=e.header,t.maxExtent=this.maxHeaderExtent||0,t.minExtent=this.minHeaderExtent||0,t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"footerBoxRegion",{get:function(){var e=this.pageMargins,t=new kp;return t.measure=this.measure-e.left-e.right,t.extent=Number.POSITIVE_INFINITY,t.edge.padding=Ip.zero,t.edge.padding.start=e.left,t.edge.padding.end=e.right,t.edge.padding.after=e.footer,t.maxExtent=this.maxFooterExtent||0,t.minExtent=this.minFooterExtent||0,t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"headerRefId",{get:function(){var e=this._sectionProps||ot.section;return e.titlePg&&this.isFirstPage?e.firstHeaderRefId:e.defaultHeaderRefId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"footerRefId",{get:function(){var e=this._sectionProps||ot.section;return e.titlePg&&this.isFirstPage?e.firstFooterRefId:e.defaultFooterRefId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isOddPage",{get:function(){return 0!=(1&this.globalPageNum)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isFirstPage",{get:function(){return 1===this.sectionPageNum},enumerable:!0,configurable:!0}),t}(),Rl=function(){function e(e){this.engine=e,this.mainBox=new Up}return e.prototype.createMainPageRegion=function(){var e=new kp,t=this.engine.pageEnv.pageMargins,r=this.engine.pageEnv.measure;e.measure=r-t.left-t.right;var n=this.engine.pageEnv.extent,o=this.headerBox?this.headerBox.totalExtent||0:t.top,i=this.footerBox?this.footerBox.totalExtent||0:t.bottom;e.extent=n-o-i;var a=this.engine.pageEnv.minExtent;return e.minExtent=a&&a-o-i,e.edge.padding=Ip.zero,e.edge.padding.start=t.left,e.edge.padding.end=t.right,e},e.prototype.createLogicPageBox=function(){var e=this.createLogicPageSize(),t=new Vp(e);this.headerBox&&(t.headerPage=this.headerBox),this.footerBox&&(t.footerPage=this.footerBox),this.mainBox?t.mainPage=this.mainBox:r.Logger.error("layout|must set mainPage");var n=Np.obtain(this.engine.pageEnv.edge);n.padding||(n.padding=Ip.zero);var o=this.engine.pageEnv.pageMargins;return this.headerBox||(n.padding.before=o.top),this.footerBox||(n.padding.after=o.bottom),t.logicEdge=n,t},e.prototype.createLogicPageSize=function(){var e=this.engine.pageEnv,t=e.measure,r=e.minExtent,n=this.engine.pageEnv.extent;if(!Number.isFinite(n)){var o=(this.headerBox&&this.headerBox.totalExtent||0)+(this.footerBox&&this.footerBox.totalExtent||0)+(this.mainBox&&this.mainBox.totalExtent||0);n=r&&Math.max(r,o)||o}return Bp.obtain({measure:t,extent:n})},e.prototype.reset=function(){this.headerBox=void 0,this.footerBox=void 0,this.mainBox=void 0},e}(),wl=function(){function e(){}return e.getDefaultEngine=function(){return this.instance},e.prototype.setTextRunMeasureImp=function(e){this.textRunMeasureImp=e},e.prototype.measureAttributedText=function(e,t){return this.textRunMeasureImp.measureAttributedText(e,t)},e.prototype.measureChar=function(e,t,r,n){return this.textRunMeasureImp.measureChar(e,t,r,n)},e.prototype.setGlobalStyle=function(e){return r.Logger.info("textMeasure|setGlobalStyle="+e),this.textRunMeasureImp.setGlobalStyle(e)},e.prototype.clearCache=function(){r.Logger.info("textMeasure|clearCache"),this.textRunMeasureImp.clearCache()},e.instance=new e,e}(),Il=function(){function e(){}return e.getOffsetPoint=function(e,t){for(var r=0,n=0,o=e;o&&o.kind!==t;){var i=o.getOuterPoint();if(r+=i.x,n+=i.y,(o=o.parentBox)&&o.kind!==t){var a=o.edge;r+=a.border.width.left+a.margin.left,n+=a.border.width.top+a.margin.top,a.recycle()}}return{x:r,y:n}},e.getGrandsonByPoint=function(e,t,r){for(var n=r,o=e;;){var i=Sp(o.getChildByPoint(n),2),a=i[0],s=i[1];if(!a||!s)break;if(a.kind===t)return[a,s];if(!Fp(a))break;o=a,n=s}return[]},e.getLeastGrandsonByPoint=function(e,t){for(var r=t,n=e;;){var o=Sp(n.getChildByPoint(r),2),i=o[0],a=o[1];if(!i||!a)break;if(!Fp(i))break;n=i,r=a}return[n,r]},e.getPrevBox=function(e){if(e&&!(e instanceof Gp)){var t=this.getPrevSibling(e);if(!t){var r=this.getPrevBox(e.parentBox);r&&(t=r.lastChild)}return t}},e.getNextBox=function(e){if(e&&!(e instanceof Gp)){var t=this.getNextSibling(e);if(!t){var r=this.getNextBox(e.parentBox);r&&(t=r.firstChild)}return t}},e.getVerticalNextLineBox=function(e){if(e instanceof Jp){var t=this.getNextSibling(e);if(!t)for(var r=this.getVerticalNextBox(e.parentBox);r;){if(t=this.getVerticalLineBox(r,!0))return t;r=this.getVerticalNextBox(r)}return t}},e.getVerticalPrevLineBox=function(e){if(e instanceof Jp){var t=this.getPrevSibling(e);if(!t)for(var r=this.getVerticalPrevBox(e.parentBox);r;){if(t=this.getVerticalLineBox(r,!1))return t;r=this.getVerticalPrevBox(r)}return t}},e.getVerticalNextBox=function(e){if(e&&!(e instanceof Gp)){if(e instanceof tl&&e.parentBox&&!e.isMerged){for(var t=e.logicIndex,r=this.getNextBox(e.parentBox);r&&r instanceof rl;){for(var n=r.logicChildren[t];n;){if(!n.isMerged&&n.logicIndex+n.colSpan>t)return n;n=this.getPrevSibling(n)}r=this.getNextBox(r)}return this.getVerticalNextBox(e.parentBox)}var o=this.getNextSibling(e);return!o&&e.parentBox?this.getVerticalNextBox(e.parentBox):o}},e.getVerticalPrevBox=function(e){if(e&&!(e instanceof Gp)){if(e instanceof tl&&e.parentBox&&!e.isMerged){for(var t=e.logicIndex,r=this.getPrevBox(e.parentBox);r&&r instanceof rl;){for(var n=r.logicChildren[t];n;){if(!n.isMerged&&n.logicIndex+n.colSpan-1>=t)return n;n=this.getPrevSibling(n)}r=this.getPrevBox(r)}return this.getVerticalPrevBox(e.parentBox)}var o=this.getPrevSibling(e);return!o&&e.parentBox?this.getVerticalPrevBox(e.parentBox):o}},e.getVerticalLineBox=function(e,t){var r=t;e instanceof rl&&!t&&(r=!t);for(var n=r?e.firstChild:e.lastChild;n;){if(n instanceof Jp&&this.isValidLineBox(n))return n;var o=this.getVerticalLineBox(n,t);if(o)return o;n=r?this.getNextSibling(n):this.getPrevSibling(n)}},e.isValidLineBox=function(e){return e.firstChild&&!(e.firstChild instanceof pl)},e.getNextSibling=function(e){var t=e.nextSibling;return e instanceof tl&&e.nextBreakSibling&&(t=e.nextBreakSibling),t},e.getPrevSibling=function(e){var t=e.prevSibling;return e instanceof tl&&e.prevBreakSibling&&(t=e.prevBreakSibling),t},e.getOffsetByPosition=function(e,t){var r=e.textString();if(r){var o=new n.UString(r);return this.binarySearchPosition(o,e,t,0,o.graphemeCount(),r.length)}return{offset:0,offsetUString:0,offsetPx:0}},e.binarySearchPosition=function(e,t,r,n,o,i){if(o-n>1){var a=Math.floor((n+o)/2),s=wl.getDefaultEngine().measureChar(t.textString(),t.textStyle,e.graphemeIndex2CharCodeIndexRange(n).start,e.graphemeIndex2CharCodeIndexRange(a).end>i?i:e.graphemeIndex2CharCodeIndexRange(a).end),p=s.width;return r<=s.offsetLeft+p?this.binarySearchPosition(e,t,r,n,a,i):this.binarySearchPosition(e,t,r,a,o,i)}var l=wl.getDefaultEngine().measureChar(t.textString(),t.textStyle,e.graphemeIndex2CharCodeIndexRange(n).start,e.graphemeIndex2CharCodeIndexRange(n).end+1>i?i:e.graphemeIndex2CharCodeIndexRange(n).end+1),c=l.width,u=l.offsetLeft;return r<=u+c/2?{offset:n,offsetUString:e.graphemeIndex2CharCodeIndexRange(n).start,offsetPx:u}:{offset:o,offsetUString:e.graphemeIndex2CharCodeIndexRange(n).end+1,offsetPx:u+c}},e}(),El=function(){function e(){}return e.COST=!1,e.LOG=!1,e}();!function(e){e[e.isDirty=0]="isDirty",e[e.beforeDirty=1]="beforeDirty",e[e.afterDirty=2]="afterDirty",e[e.noDirty=3]="noDirty",e[e.non=4]="non"}(Sl||(Sl={}));var Ll,Ol=function(){function e(e,t,r,n){this.shouldFind=!0,this.nextReusable=!1,this.env=e,this.node=t,this.box=r.curBox,this.storyDirty=r.storyDirty,this.allDirty=r.allDirty,this.nodeBegin=t.getGCPRange().begin(),this.parent=n}return e.prototype.setCurrentRegion=function(e){this.curRegion=e},e.prototype.setFinityCheck=function(e){this.isFinite=e},e.prototype.setCurLayoutCPs=function(e){this._curLayoutCPs=e},Object.defineProperty(e.prototype,"curBox",{get:function(){return this.box},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reuseBox",{get:function(){return this.nextBox},enumerable:!0,configurable:!0}),e.prototype.isReachEnd=function(){var e=this;return this.curLayoutCPs.reduce((function(t,r){if(t)return!0;var n=r.first,o=r.last,i=e.node.getTextRange();return new ne(n,o-n+1).contains(i)}),!1)},e.prototype.getLastReuseBox=function(){return this._savedBox},e.prototype.resetFind=function(){this.shouldFind=!0},e.prototype.hasNext=function(){return this.shouldFind&&(this.findBox(),this.shouldFind=!1),!!this.nextBox},Object.defineProperty(e.prototype,"nextOffsets",{get:function(){var e=this,t=this.curLayoutCPs.map((function(t){return t.last-e.nodeBegin+1}));return t.length>0?t:[0]},enumerable:!0,configurable:!0}),e.prototype.getNext=function(){var e=this.nextBox;return this._savedBox=e,this.nextBox=void 0,e&&El.COST&&this.env.reflowState.addReuseBox(e),e},e.prototype.rollback=function(){this._savedBox&&(this.box=this._savedBox,El.COST&&this.env.reflowState.removeReuseBox(this._savedBox)),this.shouldFind=!0},e.prototype.findBox=function(){if(this.box&&this.curRegion&&this.seekBox())if(this.nextReusable)this.onReuse(this.box);else{var e=this.env.boxHelper.getGCPPairs(this.box),t=this.checkBoxDirty(this.box,e);t!==Sl.isDirty?this.checkReusable(this.box,e,t)&&(this.onReuse(this.box),t!==Sl.afterDirty&&t!==Sl.non||this.isFinite&&!this.isFinite()&&(this.nextReusable=!0)):this.markDirty(this.box)}},e.prototype.seekBox=function(){for(var e=this.curLayoutCPs,t=e.length>0?e[0].last+1:0,r=e.length>0?e[e.length-1].last+1:0;this.box;){var n=this.getBoxFirstCP(this.box);if(t===n)return!0;var o=this.getBoxLastCP(this.box);if(o>=0&&r<=o)return!1;if(o<0&&n>=0&&t<=n)return!1;this.box=this.getNextBox(this.box)}return!1},e.prototype.getBoxFirstCP=function(e){var t=e.indexPairs[0].first;return this.env.boxHelper.bp2cp(t)},e.prototype.getBoxLastCP=function(e){var t=e.indexPairs.length,r=e.indexPairs[t-1].last;return this.env.boxHelper.bp2cp(r)},e.prototype.checkReusable=function(e,t,r){if(r===Sl.beforeDirty)return!this.isNextLineDirty(e);if(this.canMerge(t)){var n=this.node.getTextRange();if(t.reduce((function(e,t){if(!e)return!1;var r=t.first,o=t.last,i=new ne(r,o-r+1);return n.contains(i)}),!0)){var o=this.curRegion(),i=e.layoutRegion,a=e.totalLogicSize;if(o.maxExtent&&e.extent>o.maxExtent||o.minExtent&&e.extent<o.minExtent)return!1;if(!e.isLast&&!i.size.contain(o.size))return!1;if(o.size.contain(a))return!0}}return!1},e.prototype.onReuse=function(e){this.nextBox=e,this.env.fieldBoxMgr.checkFieldBoxForUpdate(e.uuid),this.env.reflowState.markReuse(this.nextBox),this.box=this.getNextBox(e)},e.prototype.getNextBox=function(e){return Il.getNextBox(e)},e.prototype.getPrevBox=function(e){return Il.getPrevBox(e)},e.prototype.isNextLineDirty=function(e){if(this.storyDirty.isInvalid()||e.isLast)return!1;var t=this.getNextBox(e),r=t&&function(e,t){for(var r=e;r;){if(r instanceof t)return r;if(!Fp(r))return;r=r.firstChild}}(t,Jp);if(r&&!r.isFirst){var n=this.env.boxHelper.bp2cp(r.firstIndex);if(this.isDirty(n))return!0;var o=this.env.boxHelper.bp2cp(r.lastIndex);if(this.isDirty(o))return!0;var i=this.env.boxHelper.bp2cp(e.lastIndex),a=new ne(i,o-i+1);return this.storyDirty.intersect(a)}return!1},e.prototype.checkBoxDirty=function(e,t){if(this.storyDirty.isInvalid())return Sl.non;if(e.isSelfDirty())return Sl.isDirty;var r=t[0].first;if(r>=0&&r>=this.storyDirty.last.end())return Sl.afterDirty;var n=t[t.length-1].last;if(n>=0&&n<this.storyDirty.first.begin())return Sl.beforeDirty;for(var o=0;o<t.length;o++){var i=t[o],a=i.first,s=i.last;if(!this.isDirty(a)&&!this.isDirty(s)){var p=new ne(a,s-a+1);if(!this.storyDirty.intersect(p))continue}return Sl.isDirty}return Sl.noDirty},e.prototype.markDirty=function(e){e.markDirty()},e.prototype.isDirty=function(e){return e<0||this.storyDirty.contains(e)},Object.defineProperty(e.prototype,"curLayoutCPs",{get:function(){return this._curLayoutCPs||[]},enumerable:!0,configurable:!0}),e.prototype.canMerge=function(e){for(var t=this.curLayoutCPs,r=e.length,n=Math.max(r,t.length),o=0;o<n;o++){var i=t[o],a=e[o];if(i&&a){if(i.last+1===a.first){var s=Number.MAX_VALUE,p=t[o+1];if(p&&(s=p.first),a.last<s)continue}return!1}if(i&&!a)return!0;if(!i&&a)return!0}return!0},e}(),Nl=function(){function e(e){this.active=null,this.parent=e}return e.prototype.hasNext=function(){if(!this.active)return!1;if(this.active.hasNext())return!0;this.active.onDestroy();var e=this.active.node.getNextSibling(),t=this.parent.env.factory;return this.active=e&&t.createGenerator(this.parent,e),!!e},e.prototype.getNext=function(){return this.active&&this.active.hasNext()?this.active.getNext():{done:!0,value:[]}},e.prototype.hasActive=function(){return!!this.active},e.prototype.updateActive=function(e){this.active=e},e.prototype.updateModel=function(e){if(this.active&&this.active.onDestroy(),e){var t=this.parent.env.factory;this.active=t.createGenerator(this.parent,e)}else this.active=null},e.prototype.commit=function(){this.active&&this.active.commit()},e.prototype.abortActive=function(){this.active&&this.active.abort()},e.prototype.resume=function(){this.active&&this.active.resume()},e.prototype.rollback=function(){this.active&&this.active.rollback()},e.prototype.destroy=function(){this.active&&this.active.onDestroy()},e}();!function(e){e[e.Normal=0]="Normal",e[e.Pause=1]="Pause",e[e.Abort=2]="Abort"}(Ll||(Ll={}));var kl,Ml=function(){function e(e,t){this.node=e,this.env=t,this.status=Ll.Normal}return Object.defineProperty(e.prototype,"name",{get:function(){var e=this.constructor;return e&&e.name},enumerable:!0,configurable:!0}),e.prototype.hasNext=function(){return!1},e.prototype.getNext=function(){throw new Error("LayoutContext.getNext must be overrided.")},e.prototype.commit=function(){},e.prototype.rollback=function(){},e.prototype.pause=function(){this.status=Ll.Pause},e.prototype.abort=function(){this.status=Ll.Abort},e.prototype.resume=function(){this.status=Ll.Normal},e.prototype.onDestroy=function(){},e}(),Dl=function(){function t(t,r){this.measure=null,this.extent=null,this._whiteSpaceType=e.WhiteSpaceType.Normal,this.rowIndex=0,this.colIndex=0,this._isRowSpanEnd=!1,this._isMerged=!1,this.node=t,this.parent=r,r&&this.inheritStyles(r),this.loadStyles()}return t.prototype.loadStyles=function(){switch(this.node.getType()){case e.LayoutInputNodeType.Document:this.storyProps=this.node.getProperty();break;case e.LayoutInputNodeType.Section:this.loadSectionNode(this.node);break;case e.LayoutInputNodeType.Table:this.loadTableNode(this.node);break;case e.LayoutInputNodeType.TableRow:this.loadTableRowNode(this.node);break;case e.LayoutInputNodeType.TableCell:this.loadTableCellNode(this.node);break;case e.LayoutInputNodeType.Paragraph:this.loadParagraphNode(this.node);break;case e.LayoutInputNodeType.TextGroup:this.parent&&(this._paraProps=this.parent.paraStyle);break;case e.LayoutInputNodeType.TextFrame:this.loadTextFrameNode(this.node);break;case e.LayoutInputNodeType.FieldCode:this.loadFieldCodeNode(this.node);break;case e.LayoutInputNodeType.Text:case e.LayoutInputNodeType.EmbedContainer:this.loadLeafNode(this.node)}},t.prototype.loadSectionNode=function(t){this._sectionProps=t.getProperty();var r=this._sectionProps.pageMargins.left,n=this._sectionProps.pageMargins.right,o=this._sectionProps.pageSize,i=(o.orientation===e.PaperOrientation.Portrait?o.width:o.height)-r-n,a=this._sectionProps.pageColumns,s=a.num,p=a.equalWidth;if(s>1&&p){for(var l=a.space,c=(i-(s-1)*l)/s,u=[],h=0;h<s;h+=1)u.push({width:c,space:l});this._columnConfigs=u}else{(u=a.cols).length>0&&(this._columnConfigs=u)}},t.prototype.loadTableNode=function(e){var t=r.pxToTwips(1);if(this._tableProps=e.getProperty(),this.parent&&this.parent._sectionProps){var n=this.parent._sectionProps.pageMargins,o=n.left,i=n.right,a=this._tableProps,s=a.paddingLeft,p=0===s?0:s-o,l=a.paddingRight-i;this.edge=Np.obtain(),this.edge.margin=new Ip({before:ot.table.marginTop,start:p,after:ot.table.marginBottom,end:l}),this.edge.border=new Op({width:new Ip({before:t,start:t,after:0,end:0}),color:Ep.none,style:Lp.solid})}},t.prototype.loadTableRowNode=function(e){if(this._tableRowProps=e.getProperty(),this._tableProps=this.parent&&this.parent.tableProps,this.parent){var t=e.getTextStream().tableStream,r=e.getTextRange().begin();this.rowIndex=t.getTableRowIndexFromGCP(r)}},t.prototype.loadTableCellNode=function(e){var t=r.pxToTwips(1);if(this.parent){var n=e.getTextStream().tableStream,o=e.getGCPRange().begin(),i=n.getTableRowColIndexFromGCP(o),a=i.row,s=i.col;this.rowIndex=a,this.colIndex=s;var p=this.parent,l=null==p?void 0:p.parent,c=null==l?void 0:l.tableProps;c&&(this._isMerged=n.isCellMerged(c.tableId,this.rowIndex,this.colIndex),this._isRowSpanEnd=n.isCelRowSpanEnd(c.tableId,this.rowIndex,this.colIndex))}if(this._tableCellProps=this.node.getProperty(),this.node.getDocumentEnv()){if(this._tableCellProps){var u=this._tableCellProps,h=u.borderTop,f=u.borderLeft,d=u.borderBottom,g=u.borderRight,y=u.padding;this.edge=Np.obtain();var m=new Ep({before:h.borderColor,start:f.borderColor,after:d.borderColor,end:g.borderColor}),b=new Ip({before:0,start:0,after:t,end:t}),P=Lp.solid;this.edge.border=new Op({width:b,color:m,style:P}),y&&(this.edge.padding=new Ip({before:y.top,start:y.left,after:y.bottom,end:y.right}))}var v=this.edge?this.edge.measure:0;this.measure=this.colWidth?this.colWidth-v:0}},t.prototype.loadParagraphNode=function(t){var n=t.getProperty();if(this._paraProps=n instanceof gt?n:new gt,this._paraProps.borderType&e.BorderTypes.Bottom){var o=this.node.getGCPRange(),i=this.node.getTextStream().findStoryInfoFromGcp(o.begin());i&&Ge(i.storyProp.storyType)&&i.range.end()===o.end()&&(this.edge=Np.obtain(),this.edge.border=new Op({width:new Ip({before:0,start:0,after:r.pxToTwips(1),end:0}),color:Ep.none,style:Lp.solid}))}},t.prototype.loadTextFrameNode=function(e){var t=e.getProperty()||new Cr;this.edge=Np.obtain(),this.edge.padding=new Ip({before:t.paddingTop,start:t.paddingLeft,after:t.paddingBottom,end:t.paddingRight}),this._whiteSpaceType=t.whiteSpaceType,this._textframeProps=t},t.prototype.loadFieldCodeNode=function(t){if(t.fieldInfo){this.edge=Np.obtain();var r=t.getPadding();this.edge.padding=new Ip({before:r.top,after:r.bottom,start:r.left,end:r.right})}this._whiteSpaceType=e.WhiteSpaceType.Nowrap},t.prototype.loadLeafNode=function(e){var t=e.getProperty();this._spanStyle=t instanceof Rt?t:new wt},t.prototype.inheritStyles=function(e){this._whiteSpaceType=e._whiteSpaceType},Object.defineProperty(t.prototype,"paraStyle",{get:function(){return this._paraProps||new gt},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textStyle",{get:function(){return this._spanStyle||new wt},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"columnConfigs",{get:function(){return this._columnConfigs||[]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tableCellProps",{get:function(){return this._tableCellProps},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tableProps",{get:function(){return this._tableProps},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rowHeight",{get:function(){var e=this.parent;if(e){var t=this.rowIndex;return e.rowHeights[t]||0}return 0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"colWidth",{get:function(){var e=this.parent,t=null==e?void 0:e.parent,r=null==t?void 0:t.tableProps,n=this._tableCellProps;if(r&&n){var o=this.colIndex,i=n.colSpan>1?n.colSpan:1;return r.colWidths.slice(o,o+i).reduce((function(e,t){return e+t}),0)}return 0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"colWidths",{get:function(){return this._tableProps?this._tableProps.colWidths:[]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rowHeights",{get:function(){return this._tableProps?this._tableProps.rowHeights:[]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rowSpan",{get:function(){return this._tableCellProps?this._tableCellProps.rowSpan:1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isMerged",{get:function(){return this._isMerged},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isRowSpanEnd",{get:function(){return this._isRowSpanEnd},enumerable:!0,configurable:!0}),t.prototype.getWhiteSpaceType=function(){return this._whiteSpaceType},t}();!function(e){e[e.Over=0]="Over",e[e.Inside=1]="Inside",e[e.Limit=2]="Limit"}(kl||(kl={}));var Fl,Al=function(e){function t(t,r,n){var o=e.call(this,t,r)||this;return o._needFirstSeek=!0,o._lastReuse=!1,o.parentContext=n,o.rootContext=o.parentContext?o.parentContext.rootContext:o,o.boxEnv=o.createBoxEnv(o.node,n),o.container=o.createContainer(),o.flowChildGens=new Nl(o),o.curLayoutCPs=o.initLayoutCPs(),o.reflowContext=n&&o.createReflowContext(n.reflowContext),o}return vp(t,e),t.prototype.initLayoutCPs=function(){var e=this.node.getTextRange(),t=this.node.getGCPRange(),r=e.begin()-1;if(this.parentContext){var n=this.parentContext.curLayoutCPs.filter((function(e){var r=e.first,n=e.last;return new ne(r+1,n-r).intersect(t)}));if(n.length>0)return n.map((function(e){return xp({},e)}))}return[{first:r,last:r}]},t.prototype.setCurLayoutCPs=function(e){this.curLayoutCPs=e,this.reflowContext&&this.reflowContext.setCurLayoutCPs(e)},t.prototype.seek=function(e){e&&e.length>0&&this.node.seek(e);var t=this.node.getBeginChild();if(t){var r=this.env.factory.createGenerator(this,t);this.flowChildGens.updateActive(r)}else this.flowChildGens.updateActive(null)},Object.defineProperty(t.prototype,"nextOffsets",{get:function(){var e=this.node.getGCPRange().begin(),t=this.curLayoutCPs.map((function(t){return t.last-e+1}));return t.length>0?t:[0]},enumerable:!0,configurable:!0}),t.prototype.mergeBox=function(e){this._lastMergedBox=e,this.env.boxHelper.mergeBox(e,this.curLayoutCPs),this.reflowContext&&this.reflowContext.resetFind()},t.prototype.unmergeBox=function(e){this.env.boxHelper.unmergeBox(e,this.curLayoutCPs)},t.prototype.getLastBox=function(e){var t=e.value;if(!(e.done||t.length<1))for(var r=t.length-1;r>=0;r--)if(t[r].isBox())return t[r].getAsBox()},t.prototype.commit=function(){},t.prototype.hasNext=function(){if(this.status===Ll.Abort||this.status===Ll.Pause)return!1;if(this.reflowContext){if(this.reflowContext.isReachEnd())return!1;if(this.reflowContext.hasNext())return!0;if(this._lastReuse){var e=this.nextOffsets;Sp(this.node.getOffsets(),1)[0]!==e[0]&&(this.seek(e),this._needFirstSeek=!1)}}return this._needFirstSeek&&(this.seek(),this._needFirstSeek=!1),!!this.flowChildGens.hasNext()},t.prototype.getNext=function(){if(this.reflowContext){var e=this.reflowContext.getNext();if(e)return this._lastReuse=!0,this.mergeBox(e),{done:!1,value:this.createLayoutValue(e)}}this._lastReuse=!1;var t=this.flowChildGens.getNext(),n=this.getLastBox(t);return n&&(this.mergeBox(n),El.LOG&&this.reflowContext&&r.Logger.log("layout|noreuse "+n.name+" box:"+n.uuid)),t},t.prototype.createLayoutValue=function(e){var t=[new _l(e)];return this.env.isPageMode&&e.isPageBreak&&t.push(new _l(Pl())),t},t.prototype.rollback=function(){this.reflowContext&&this._lastReuse?this.reflowContext.rollback():this.flowChildGens.rollback(),this._lastMergedBox&&this.unmergeBox(this._lastMergedBox)},t.prototype.resume=function(){this.status=Ll.Normal,this.flowChildGens.resume()},t.prototype.onDestroy=function(){this.flowChildGens.destroy()},t.prototype.isEmpty=function(){return this.container.isInlineEmpty()&&this.container.isBlockEmpty()},t.prototype.isBlockEmpty=function(){return this.container.isBlockEmpty()},t.prototype.isInlineEmpty=function(){return this.container.isInlineEmpty()},t.prototype.isRoot=function(){return!this.parentContext&&this.node.isRootNode()},t.prototype.pushInlineLevel=function(e){return this.container.isInlineOver(e)&&!this.container.isInlineReseted()?(this.flowChildGens.rollback(),!0):(this.flowChildGens.commit(),this.container.addInline(e))},t.prototype.pushBlockLevel=function(e){return this.container.isBlockOver(e)&&!this.container.isBlockReseted(!0)?(this.rollback(),kl.Over):(this.flowChildGens.commit(),this.container.addBlock(e),!this.env.isReflow&&this.container.isBlockLimit()?kl.Limit:kl.Inside)},t.prototype.pushTempBlocks=function(e){var t=this;e.forEach((function(e){return t.container.addTempBlock(e)}))},t.prototype.reduceInlineBox=function(){var e=this.container.createLineBox(this.boxEnv,Jp);return this.container.clearInlines(),e},t.prototype.reduceBlockBox=function(e){void 0===e&&(e=!0);var t=this.container.createBlockBox(this.boxEnv,this.getParentBoxClass());return e&&this.container.clearBlocks(),this.container.clearTempBlocks(),t},t.prototype.createHiddenBox=function(){var e=this.container.createBlockBox(this.boxEnv,this.getParentBoxClass());e.hidden=!0;var t=this.node.getGCPRange(),r=this.env.textStream;return e.firstIndex=r.getIndexFromGCP(t.begin()),e.lastIndex=r.getIndexFromGCP(t.end()-1),e},t.prototype.createChildBoxEnv=function(e){return new Dl(e,this.boxEnv)},t.prototype.createBoxEnv=function(e,t){return t?t.createChildBoxEnv(e):new Dl(e)},t.prototype.createReflowContext=function(e){var t=this;if(e){var r=this.getFirstReflowChildBox(e);if(r){var n={curBox:r,storyDirty:e.storyDirty,allDirty:e.allDirty},o=this.createReflowInstance(this.env,this.node,n,e);return o.setFinityCheck((function(){return t.isCurrentFinite()})),o.setCurrentRegion((function(){return t.container.createChildLayoutRegion()})),o.setCurLayoutCPs(this.curLayoutCPs),o}}},t.prototype.isCurrentFinite=function(){return Number.isFinite(this.container.getRootExtent())},t.prototype.createReflowInstance=function(e,t,r,n){return new Ol(e,t,r,n)},t.prototype.getFirstReflowChildBox=function(e){var t=e.curBox;return t&&Fp(t)&&t.firstChild||void 0},t.prototype.isLastBox=function(e){var t=this.node.getGCPRange().end(),r=e.indexPairs;if(r.length>1)return!1;var n=r[r.length-1].last;return t===this.env.boxHelper.bp2cp(n)+1},t}(Ml),Kl=function(){function e(e){this.node=e.node,this.name=e.name,this.context=e,this.iterator=this.createIterator()}return e.prototype.pause=function(){this.context.pause()},e.prototype.abort=function(){this.context.abort()},e.prototype.resume=function(){this.context.resume()},e.prototype.commit=function(){this.context.commit()},e.prototype.rollback=function(){this.context.rollback()},e.prototype.hasNext=function(){return this.context.hasNext()},e.prototype.getNext=function(){return this.iterator.next()},e.prototype.onDestroy=function(){this.context.onDestroy()},e.prototype.createIterator=function(){return Tp(this,(function(e){throw new Error("LayoutGenerator.createIterator must be overrided.")}))},e}(),Gl=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return vp(n,t),n.prototype.onLayoutValue=function(e){return e.isBox()?this.onBox(e.getAsBox()):e.isControl()?this.onControl(e.getAsControl()):[]},n.prototype.onBox=function(t){switch(t.display){case e.LayoutDisplay.Block:return this.onBlockLevelBox(t);case e.LayoutDisplay.Inline:case e.LayoutDisplay.InlineBlock:return this.onInlineLevelBox(t);default:return[]}},n.prototype.onBlockLevelBox=function(e){var t=[];if(!this.context.isInlineEmpty()){var n=this.context.reduceInlineBox();t.push.apply(t,Cp(this.onBlockLevelBox(n)))}var o=this.context.pushBlockLevel(e);return o===kl.Over?t.push.apply(t,Cp(this.reduceLayout(!0))):o===kl.Limit&&(El.LOG&&r.Logger.log("layout|add Box("+e.uuid+") reach limit"),t.push(new _l(Tl()))),t},n.prototype.onInlineLevelBox=function(e){if(this.context.pushInlineLevel(e)){var t=this.context.reduceInlineBox();return this.onBlockLevelBox(t)}return[]},n.prototype.onControl=function(e){if(e instanceof bl)return this.onPause(e);var t=this.reduceLayout(!0).filter((function(t){return t.isBox()||!e.equals(t.getAsControl())}));return this.context.isRoot()?t:t.concat(new _l(e))},n.prototype.onPause=function(e){this.context.pushTempBlocks(e.getBlocks());var t=this.reduceLayout(!1).filter((function(t){return t.isBox()||!e.equals(t.getAsControl())}));return this.context.isRoot()?t:[new _l(Tl(t))]},n.prototype.createIterator=function(){var e,t,r=this;return Tp(this,(function(n){switch(n.label){case 0:e=function(){var e,n,o,i,a,s;return Tp(this,(function(p){switch(p.label){case 0:return t.node.isHidden()?(e=t.context.createHiddenBox(),t.abort(),[4,[new _l(e)]]):[3,2];case 1:return p.sent(),[2,"break"];case 2:return n=t.context.getNext(),o=[],n.done||!n.value?[2,"break"]:(n.value.forEach((function(e){o.push.apply(o,Cp(r.onLayoutValue(e)))})),(i=o.filter((function(e){return!function(e){return e.isControl()&&e.getAsControl().isPause()}(e)}))).length>0?[4,o]:[3,4]);case 3:return p.sent(),[2,"continue"];case 4:return a=o.length>0,t.context.hasNext()?a&&(s=t.reduceLayout(!1),i=[new _l(Tl(s))]):i=t.reduceLayout(!0),i.length>0?[4,i]:[3,6];case 5:p.sent(),p.label=6;case 6:return[2]}}))},t=this,n.label=1;case 1:return this.context.hasNext()?[5,e()]:[3,3];case 2:return"break"===n.sent()?[3,3]:[3,1];case 3:return[2]}}))},n}(Kl),Hl=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return vp(t,e),t.prototype.reduceLayout=function(e){if(this.context.isEmpty())return[];var t=this.context.reduceBlockBox(e);return this.context.env.boxHelper.printRanges(t),[new _l(t)]},t}(Gl),jl=function(){function e(){this.inlines=[],this.blocks=[],this.cursor=Cl.zero()}return Object.defineProperty(e.prototype,"blockPos",{get:function(){return this.cursor.blockPos},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inlinePos",{get:function(){return this.cursor.inlinePos},enumerable:!0,configurable:!0}),e.prototype.isInlineEmpty=function(){return 0===this.inlines.length},e.prototype.isBlockEmpty=function(){return 0===this.blocks.length},e.prototype.pushInline=function(e){this.inlines.push(e),this.cursor.inlinePos+=e.totalMeasure||0},e.prototype.pushBlock=function(e){this.blocks.push(e),this.cursor.blockPos+=e.totalExtent||0},e.prototype.getInlines=function(){return this.inlines},e.prototype.getBlocks=function(){return this.blocks},e.prototype.clearInlines=function(){this.inlines=[],this.cursor.inlinePos=0},e.prototype.clearBlocks=function(){this.blocks=[],this.cursor.blockPos=0},e.prototype.getLineExtent=function(){return this.inlines.reduce((function(e,t){var r=t.borderBoxSize.height;return Math.max(e,r)}),0)},e.prototype.getLineMeasure=function(){return this.inlines.reduce((function(e,t){return e+t.borderBoxSize.width}),0)},e}(),Ul=function(){function e(e,t){void 0===t&&(t=new jl),this.name=e.name,this.context=e,this.content=t,this.tempContent=new jl}return e.prototype.isBlockEmpty=function(){return this.content.isBlockEmpty()&&this.tempContent.isBlockEmpty()},e.prototype.isInlineEmpty=function(){return this.content.isInlineEmpty()},e.prototype.isBlockReseted=function(e){if(!e)return 0===this.content.blockPos;if(0!==this.content.blockPos)return!1;var t=this.context.parentContext;return!t||t.container.isBlockReseted(e)},e.prototype.isInlineReseted=function(e){if(!e)return 0===this.content.inlinePos;if(0!==this.content.inlinePos)return!1;var t=this.context.parentContext;return!t||t.container.isInlineReseted()},e.prototype.clearBlocks=function(){this.content.clearBlocks()},e.prototype.clearTempBlocks=function(){this.tempContent.clearBlocks()},e.prototype.clearInlines=function(){this.content.clearInlines()},e.prototype.getFixedExtent=function(){if(!this.context.parentContext)return this.getRootExtent();var e=this.context.boxEnv.extent;return null===e?null:e},e.prototype.getFixedMeasure=function(){if(!this.context.parentContext)return this.getRootMeasure();var e=this.context.boxEnv.measure;return null===e?null:e},e.prototype.getRestContextBoxMeasure=function(){return this.getMaxMeasure()-this.content.inlinePos},e.prototype.getRestContextBoxExtent=function(){return this.getMaxExtent()-this.content.blockPos},e.prototype.getTotalBlockPos=function(){var e=this.content.blockPos,t=this.context.parentContext;return t&&(e+=t.container.getTotalBlockPos()),e},e.prototype.getRootExtent=function(){return this.context.rootContext.boxEnv.extent||Number.POSITIVE_INFINITY},e.prototype.getRootMeasure=function(){return this.context.rootContext.boxEnv.measure||Number.POSITIVE_INFINITY},e.prototype.getContextEdgeMeasure=function(){var e=this.context.boxEnv.edge;return e?e.measure:0},e.prototype.getContextEdgeExtent=function(){var e=this.context.boxEnv.edge;return e?e.extent:0},e.prototype.createMaxLayoutRegion=function(){var e=new kp;return e.measure=this.getMaxTotalMeasure(),e.extent=this.getMaxTotalExtent(),e.maxExtent=this.context.boxEnv.maxExtent,e.minExtent=this.context.boxEnv.minExtent,e},e.prototype.getMaxTotalExtent=function(){var e=this.getFixedExtent();if(null!==e)return e+this.getContextEdgeExtent();var t=this.context.parentContext;return t?t.container.getRestContextBoxExtent():Number.POSITIVE_INFINITY},e.prototype.getMaxTotalMeasure=function(){var e=this.getFixedMeasure();if(null!==e)return e+this.getContextEdgeMeasure();var t=this.context.parentContext;return t?t.container.getRestContextBoxMeasure():Number.POSITIVE_INFINITY},e.prototype.createChildLayoutRegion=function(){var e=new kp;return e.measure=this.getRestContextBoxMeasure(),e.extent=this.getRestContextBoxExtent(),e.maxExtent=this.context.boxEnv.maxExtent,e.minExtent=this.context.boxEnv.minExtent,e},e.prototype.getMaxExtent=function(){var e=this.getFixedExtent();if(null!==e)return e;var t=this.context.parentContext;return t?t.container.getRestContextBoxExtent()-this.getContextEdgeExtent():Number.POSITIVE_INFINITY},e.prototype.getMaxMeasure=function(){var e=this.getFixedMeasure();if(null!==e)return e;var t=this.context.parentContext;if(!t)return Number.POSITIVE_INFINITY;var r=t.container.getRestContextBoxMeasure()-this.getContextEdgeMeasure();return Math.max(0,r)},e.prototype.isInlineOver=function(e){var t=this.getMaxMeasure();return this.content.inlinePos+e.totalMeasure>t},e.prototype.isBlockOver=function(e){var t=this.getMaxExtent();return this.content.blockPos+e.totalExtent>t},e.prototype.isBlockLimit=function(){return!1},e.prototype.getRestLimitExtent=function(e){var t=this.context.boxEnv.limitExtent,r=this.content.blockPos;if(e&&(r+=e),t)return t-r;var n=this.context.parentContext;return n?n.container.getRestLimitExtent(r):Number.POSITIVE_INFINITY},e.prototype.addInline=function(e){var t=this.getMaxMeasure();return this.content.pushInline(e),this.content.inlinePos>=t},e.prototype.addBlock=function(e){var t=this.getMaxExtent();return this.content.pushBlock(e),this.content.blockPos>=t},e.prototype.addTempBlock=function(e){this.tempContent.pushBlock(e)},e.prototype.createLineSize=function(){var e=this.getLineExtent();return Bp.obtain({measure:this.getMaxMeasure(),extent:e})},e.prototype.createBlockSize=function(){var e,t=this.getFixedMeasure(),r=null!==t?t:this.getMaxMeasure(),n=this.getFixedExtent(),o=this.context.boxEnv,i=o.minExtent,a=o.maxExtent;if(n&&Number.isFinite(n))e=n;else{var s=this.content.blockPos+this.tempContent.blockPos;e=i&&Math.max(i,s)||s,e=a&&Math.min(a,e)||e}return Bp.obtain({measure:r,extent:e})},e.prototype.getLineExtent=function(){return this.content.getLineExtent()},e.prototype.createLineBox=function(e,t){var r=this.content.getInlines(),n=this.createLineSize(),o=Kp.create(t,n);return o.append.apply(o,Cp([this.context.env],r)),o.layoutRegion=this.createMaxLayoutRegion(),this.context.isLastBox(o)&&(o.isLast=!0),o},e.prototype.createBlockBox=function(e,t){var r=this.content.getBlocks(),n=this.tempContent.getBlocks(),o=this.createBlockSize(),i=Kp.create(t,o);return i.append.apply(i,Cp([this.context.env],r,n)),i.logicEdge=Np.obtain(e.edge),i.layoutRegion=this.createMaxLayoutRegion(),this.context.isLastBox(i)&&(i.isLast=!0),i.lastChild&&i.lastChild.isPageBreak&&(i.isPageBreak=!0),i},e}(),zl=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return vp(t,e),t.prototype.createBlockBox=function(t,r){var n=e.prototype.createBlockBox.call(this,t,r);return n.storyId=t.storyProps?t.storyProps.storyId:"",n},t.prototype.isBlockLimit=function(){return this.getRestLimitExtent()<=0},t}(Ul),Wl=function(e){function t(t,r,n){var o=e.call(this,t,r)||this;return o.reflowContext=o.createReflowContext(n),o}return vp(t,e),t.prototype.createContainer=function(){return new zl(this)},t.prototype.getParentBoxClass=function(){return Up},t.prototype.updateLayoutRegion=function(e){e&&(this.boxEnv.measure=e.measure,this.boxEnv.extent=e.extent,this.boxEnv.edge=e.edge,this.boxEnv.maxExtent=e.maxExtent,this.boxEnv.minExtent=e.minExtent)},t}(Al),Vl=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return vp(r,t),r.prototype.checkReusable=function(r,n,o){return this.env.docEnv.layoutType!==e.LayoutType.Scroll&&t.prototype.checkReusable.call(this,r,n,o)},r}(Ol),Yl=function(){function e(e,t,r){this._needFirstSeek=!0,this._lastReuse=!1,this.node=e,this.env=t,this.curLayoutCPs=this.initLayoutCPs(),this.reflowContext=this.createReflowContext(r)}return e.prototype.initLayoutCPs=function(){var e=this.node.getTextRange().begin()-1;return[{first:e,last:e}]},e.prototype.seek=function(e){this.context||(this.context=this.createLayoutContext(),this.context.updateLayoutRegion(this.layoutRegion),this.context.setCurLayoutCPs(this.curLayoutCPs),this.context.boxEnv.limitExtent=this.limitExtent,this.generator=new Hl(this.context)),this.context.seek(e)},e.prototype.incLimitExtent=function(e){this.limitExtent?this.limitExtent+=e:this.limitExtent=e,this.context&&(this.context.boxEnv.limitExtent=this.limitExtent)},Object.defineProperty(e.prototype,"nextOffsets",{get:function(){var e=this.node.getGCPRange().begin(),t=this.curLayoutCPs.map((function(t){return t.last-e+1}));return t.length>0?t:[0]},enumerable:!0,configurable:!0}),e.prototype.mergeBox=function(e){this.env.boxHelper.mergeBox(e,this.curLayoutCPs),this.reflowContext&&this.reflowContext.resetFind()},e.prototype.getLastBox=function(e){var t=e.value;if(!(e.done||t.length<1))for(var r=t.length-1;r>=0;r--)if(t[r].isBox())return t[r].getAsBox()},e.prototype.createReflowContext=function(e){var t=this;if(e){var r=e.curBox,n=r&&Fp(r)&&r.firstChild;if(n){var o={curBox:n,storyDirty:e.storyDirty,allDirty:e.allDirty},i=new Vl(this.env,this.node,o,e);return i.setFinityCheck((function(){return!1})),i.setCurrentRegion((function(){return t.createChildLayoutRegion()})),i.setCurLayoutCPs(this.curLayoutCPs),i}}},e.prototype.createLayoutContext=function(){return new Wl(this.node,this.env,this.reflowContext)},e.prototype.updateLayoutRegion=function(e){this.layoutRegion=e,this.context&&this.context.updateLayoutRegion(this.layoutRegion)},e.prototype.createChildLayoutRegion=function(){var e=new kp,t=this.layoutRegion;return t&&(e.measure=t.measure+t.edge.measure,e.extent=t.extent+t.edge.extent,e.maxExtent=t.maxExtent,e.minExtent=t.minExtent),e},e.prototype.hasNext=function(){if(this.reflowContext){if(this.reflowContext.isReachEnd())return!1;if(this.reflowContext.hasNext())return!0;if(this._lastReuse){var e=this.nextOffsets;Sp(this.node.getOffsets(),1)[0]!==e[0]&&(this.seek(e),this._needFirstSeek=!1)}}return this._needFirstSeek&&(this.seek(),this._needFirstSeek=!1),!(!this.generator||!this.generator.hasNext())},e.prototype.getNext=function(){if(this.reflowContext){var e=this.reflowContext.getNext();if(e)return this._lastReuse=!0,this.mergeBox(e),{done:!1,value:[new _l(e)]}}if(this._lastReuse=!1,this.generator){var t=this.generator.getNext(),n=this.getLastBox(t);return n&&(this.mergeBox(n),El.LOG&&this.reflowContext&&r.Logger.log("layout|noreuse "+n.name+" box:"+n.uuid)),t}return{done:!0,value:[]}},e}(),ql=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return vp(t,e),t.prototype.createBlockBox=function(t,r){var n=e.prototype.createBlockBox.call(this,t,r);return this.adjustExtent(n,n.layoutRegion),n},t.prototype.adjustExtent=function(e,t){if(t.maxExtent&&e.extent>=t.maxExtent)try{for(var n=0,o=e.firstChild;o&&!(o.parentBox instanceof Jp);)n+o.extent>t.maxExtent&&Fp(o)?o=o.firstChild:(n+=o.extent,o=o.nextSibling);n>0&&e.setExtent(n)}catch(e){r.Logger.info("header footer adjust extent error: "+e.message)}},t}(zl),Xl=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return vp(t,e),t.prototype.getParentBoxClass=function(){return Wp},t.prototype.createContainer=function(){return new ql(this)},t}(Wl),Jl=function(e){function t(t,r,n,o){var i=e.call(this,t,r,n)||this;return i.isHeader=o,i}return vp(t,e),t.prototype.findBox=function(){if(e.prototype.findBox.call(this),!this.nextBox){var t=this.node.storyId;if(t){var r=this.env.storyCache.getBox(this.isHeader,t);r&&(this.nextBox=r.clone(this.env),this.env.fieldBoxMgr.updateMap(),this.env.fieldBoxMgr.checkFieldBoxForUpdate(this.nextBox.uuid))}}},t.prototype.getNextBox=function(e){},t.prototype.checkReusable=function(t,r){return!this.env.reflowState.checkReused(t)&&e.prototype.checkReusable.call(this,t,r)},t}(Ol),Zl=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return vp(t,e),t.prototype.getParentBoxClass=function(){return zp},t.prototype.createContainer=function(){return new ql(this)},t}(Wl),Ql=function(e){function t(t,r,n,o){var i=e.call(this,r,n)||this;return i.isHeader=t,i.reflowContext=i.createReflowContext(o),i}return vp(t,e),t.prototype.createReflowContext=function(e){var t=this;if(e){var r=this.getReflowValue(e);if(r){var n=new Jl(this.env,this.node,r,this.isHeader);return n.setFinityCheck((function(){return!1})),n.setCurrentRegion((function(){return t.createChildLayoutRegion()})),n.setCurLayoutCPs(this.curLayoutCPs),n}}},t.prototype.getReflowValue=function(e){if(e&&e.curBox instanceof Vp){var t=e.curBox,r=this.isHeader?t.headerPage:t.footerPage;if(r){var n=this.node.storyId;return{curBox:r,storyDirty:e.allDirty.get(n)||fa.invalidRange(),allDirty:e.allDirty}}}},t.prototype.createLayoutContext=function(){return this.isHeader?new Xl(this.node,this.env,this.reflowContext):new Zl(this.node,this.env,this.reflowContext)},t}(Yl),$l=function(){function e(){this.boxMap=new Map}return e.prototype.getBox=function(e,t){var r=this.createKey(e,t);return this.boxMap.get(r)},e.prototype.setBox=function(e,t,r){var n=this.createKey(e,t);this.boxMap.has(n)||this.boxMap.set(n,r)},e.prototype.clear=function(){this.boxMap.clear()},e.prototype.createKey=function(e,t){return(e?"header":"footer")+"|"+t},e}(),ec=function(){function e(e){this.env=e.globalEnv}return e.prototype.updateReflowContext=function(e){this.reflowContext=e},e.prototype.generate=function(e,t,n){if(!this.reflowContext){var o=this.env.storyCache.getBox(e,t);if(o){var i=o.clone(this.env);return this.env.fieldBoxMgr.updateMap(),this.env.fieldBoxMgr.checkFieldBoxForUpdate(i.uuid),i}}var a=bp(this.env.dataEngine,t,this.env.docEnv);if(a&&!this.env.isPresentation){var s=new Ql(e,a,this.env,this.reflowContext);if(s.updateLayoutRegion(n),s.hasNext()){var p=s.getNext(),l=p.value&&p.value[0];if(null==l?void 0:l.isBox()){var c=l.getAsBox();return c.storyId=t,this.env.storyCache.setBox(e,t,c),c}}}if(!r.PlatformUtil.isMobile())return this.createEmptyBox(e,t,n)},e.prototype.createEmptyBox=function(e,t,r){var n,o={measure:r.measure+r.edge.measure,extent:(r.minExtent||0)+r.edge.extent};return(n=e?new Wp(o):new zp(o)).storyId=t,n},e}(),tc=function(){function e(e,t){this.globalEnv=e,this.container=new Rl(this);var r=mp(this.globalEnv.dataEngine,e.docEnv);this.mainContext=new Yl(r,e,t),this.pageEnv=new Bl(r),this.headerFooterGenerator=new ec(this),this.iterator=this.createPageIterator(),this.initFirstPageRegion(t)}return e.prototype.initFirstPageRegion=function(e){var t=Sp(this.mainContext.nextOffsets,1)[0];this.pageEnv.init(t),this.typesetHeader(e),this.typesetFooter(e),this.updateMainPageRegion(),this.globalEnv.reflowState.reset()},e.prototype.onSectionChanged=function(e){if(this.globalEnv.fieldBoxMgr.counter.incSection(),e){this.globalEnv.fieldBoxMgr.counter.setPageStart(e.pageStartAt);var t=this.globalEnv.storyBoxMgr;e.defaultHeaderRefId&&t.addHeaderFooter(e.defaultHeaderRefId),e.defaultFooterRefId&&t.addHeaderFooter(e.defaultFooterRefId),e.firstHeaderRefId&&t.addHeaderFooter(e.firstHeaderRefId),e.firstFooterRefId&&t.addHeaderFooter(e.firstFooterRefId),e.evenHeaderRefId&&t.addHeaderFooter(e.evenHeaderRefId),e.evenFooterRefId&&t.addHeaderFooter(e.evenFooterRefId)}},e.prototype.typesetHeader=function(e){var t=this.pageEnv.headerRefId,r=this.pageEnv.headerBoxRegion;this.headerFooterGenerator.updateReflowContext(e);var n=this.headerFooterGenerator.generate(!0,t,r);this.container.headerBox=n},e.prototype.typesetFooter=function(e){var t=this.pageEnv.footerRefId,r=this.pageEnv.footerBoxRegion;this.headerFooterGenerator.updateReflowContext(e);var n=this.headerFooterGenerator.generate(!1,t,r);this.container.footerBox=n},e.prototype.updateMainPageRegion=function(){var e=this.container.createMainPageRegion();this.mainContext.updateLayoutRegion(e)},e.prototype.isLastBox=function(e){var t=this.mainContext.node.getTextRange().end();return this.globalEnv.boxHelper.isBoxInEnd(e,t)},e.prototype.reduceLayout=function(){var e=this.container.createLogicPageBox();return this.isLastBox(e)&&(e.isLast=!0),this.container.reset(),e},e.prototype.onBeforeNextPage=function(){},e.prototype.createPageIterator=function(){var e,t,r,n,o,i,a,s,p,l=this;return Tp(this,(function(c){switch(c.label){case 0:return this.mainContext.hasNext()?(e=Sp(this.mainContext.nextOffsets,1),t=e[0],this.pageEnv.advanceToNextPage(t,(function(e){l.onSectionChanged(e)})),this.globalEnv.fieldBoxMgr.counter.incPage(),r=this.mainContext.reflowContext,n=r&&(r.reuseBox||r.curBox),o=r&&n?{curBox:n.parentBox,storyDirty:r.storyDirty,allDirty:r.allDirty}:void 0,this.typesetHeader(o),this.typesetFooter(o),this.updateMainPageRegion(),this.onBeforeNextPage(),(i=this.mainContext.getNext()).done||!i.value?[3,3]:(a=i.value.length,(null==(s=a>0?i.value[0]:void 0)?void 0:s.isBox())?(p=s.getAsBox(),this.container.mainBox=p,[4,this.reduceLayout()]):[3,2])):[3,3];case 1:c.sent(),c.label=2;case 2:return[3,0];case 3:return[2]}}))},e.prototype.getNext=function(){return this.iterator.next()},e}(),rc=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return vp(t,e),t.prototype.onSectionChanged=function(t){e.prototype.onSectionChanged.call(this,t),this.globalEnv.isFinished||this.globalEnv.isReflow||(this.pageEnv.limitExtent=this.pageEnv.extent),this.pageEnv.minExtent=this.pageEnv.extent,this.pageEnv.extent=Number.POSITIVE_INFINITY},t.prototype.onBeforeNextPage=function(){this.pageEnv.limitExtent&&this.mainContext.incLimitExtent(this.pageEnv.limitExtent)},t}(tc),nc=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return vp(t,e),t.prototype.onControl=function(t){return e.prototype.onControl.call(this,t)},t.prototype.reduceLayout=function(e){if(void 0===e&&(e=!0),this.context.isEmpty())return[new _l(vl())];var t=this.context.reduceBlockBox(e);return[new _l(t)]},t}(Gl),oc=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return vp(t,e),t.prototype.createBlockBox=function(t,r){var n=e.prototype.createBlockBox.call(this,t,r);return n.paraProps=t.paraStyle,n},t.prototype.isBlockLimit=function(){return this.getRestLimitExtent()<=0},t}(Ul),ic=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return vp(t,e),t.prototype.checkReusable=function(e,t,r){if(r===Sl.beforeDirty)return!this.isNextLineDirty(e);if(this.canMerge(t)){var n=this.node.getTextRange();return t.reduce((function(e,t){if(!e)return!1;var r=t.first,o=t.last,i=new ne(r,o-r+1);return n.contains(i)}),!0)}return!1},t}(Ol),ac=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return vp(t,e),t.prototype.createContainer=function(){return new oc(this)},t.prototype.getParentBoxClass=function(){return Xp},t.prototype.createReflowInstance=function(e,t,r,n){return new ic(e,t,r,n)},t}(Al),sc=function(t){function r(e,r){void 0===r&&(r=new jl);var n=t.call(this,e,r)||this;return n.columnContents=[],n}return vp(r,t),r.prototype.updateColumnConfig=function(e){this.columnConfig=e},r.prototype.clearColumns=function(){this.columnContents=[]},r.prototype.isColumnEmpty=function(){return 0===this.columnContents.length},r.prototype.addColumnBox=function(t){var r=this.createColumnPos();t.logicPoint=new Rp(r.inlinePos,r.blockPos),t.position.value=e.PositionValue.Absolute,this.columnContents.push(t)},r.prototype.createColumnPos=function(){var e=this,t=0;return this.columnContents.forEach((function(r){t+=r.totalMeasure,t+=e.columnConfig?e.columnConfig.space:0})),new Cl(t,0)},r.prototype.createSectionBox=function(e){var t=this.createSectionSize(),r=new Yp(t),n=this.columnContents;return r.append.apply(r,Cp([this.context.env],n)),r.logicEdge=e.edge,r.layoutRegion=this.createMaxLayoutRegion(),r.lastChild&&r.lastChild.isPageBreak&&(r.isPageBreak=!0),r},r.prototype.createSectionSize=function(){var e=this,t=0,r=0;return this.columnContents.forEach((function(n,o){var i=n.totalExtent;i>t&&(t=i),r+=n.totalMeasure,e.columnConfig&&o!==e.columnContents.length-1&&(r+=e.columnConfig.space)})),Bp.obtain({measure:r,extent:t})},r.prototype.createMaxLayoutRegion=function(){var e=0,t=0,r=this.context.parentContext;r&&(e=r.container.getRestContextBoxMeasure(),t=r.container.getRestContextBoxExtent());var n=new kp;return n.measure=e,n.extent=t,n},r.prototype.getFixedMeasure=function(){return this.columnConfig?this.columnConfig.width:t.prototype.getFixedMeasure.call(this)},r.prototype.isBlockLimit=function(){return this.getRestLimitExtent()<=0},r}(Ul),pc=function(e){function t(t,r,n){var o=e.call(this,t,r,n)||this;o._currentColumnIndex=0;var i=o.getContainer(),a=o.getCurrentColumnConfig();return a&&i.updateColumnConfig(a),o}return vp(t,e),t.prototype.getContainer=function(){return this.container},t.prototype.createContainer=function(){return new sc(this)},t.prototype.getParentBoxClass=function(){return qp},t.prototype.getFirstReflowChildBox=function(e){var t=e.curBox,r=t&&Fp(t)&&t.firstChild;return r&&Fp(r)&&r.firstChild||void 0},t.prototype.advanceToNextColumn=function(){if(this.hasNextColumn()){this._currentColumnIndex+=1;var e=this.getCurrentColumnConfig();return e&&this.getContainer().updateColumnConfig(e),!0}return!1},t.prototype.resetColumn=function(){this._currentColumnIndex=0;var e=this.getCurrentColumnConfig();e&&this.getContainer().updateColumnConfig(e)},t.prototype.getCurrentColumnConfig=function(){var e=this.boxEnv.columnConfigs,t=e.length;return this._currentColumnIndex<t?e[this._currentColumnIndex]:null},t.prototype.hasNextColumn=function(){var e=this.boxEnv.columnConfigs.length;return this._currentColumnIndex<e-1},t.prototype.isEmpty=function(){return e.prototype.isEmpty.call(this)&&this.getContainer().isColumnEmpty()},t.prototype.isColumnEmpty=function(){return this.getContainer().isColumnEmpty()},t.prototype.pushColumnBox=function(e){return this.getContainer().addColumnBox(e),!this.advanceToNextColumn()},t.prototype.produceSectionBox=function(){var e=this.getContainer().createSectionBox(this.boxEnv);return this.getContainer().clearColumns(),this.resetColumn(),this.resume(),e},t}(Al),lc=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return vp(t,e),t.prototype.onControl=function(t){return t.isBlockBreak()?this.onBlockBreak():t.isColumnBreak()?this.onColumnBreak():e.prototype.onControl.call(this,t)},t.prototype.onColumnBreak=function(){var e=this.context.reduceBlockBox();return this.context.pushColumnBox(e)?this.reduceLayout():[]},t.prototype.onBlockBreak=function(){if(this.context.isEmpty())return this.reduceLayout();var e=this.context.reduceBlockBox();return this.context.pushColumnBox(e)?Cp(this.reduceLayout(),[new _l(Pl())]):[]},t.prototype.reduceLayout=function(e){if(void 0===e&&(e=!0),this.context.isEmpty())return[new _l(Pl())];if(!this.context.isBlockEmpty()){var t=this.context.reduceBlockBox(e);this.context.pushColumnBox(t)}var r=this.context.produceSectionBox();return[new _l(r)]},t}(Gl),cc=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return vp(t,e),t.prototype.getFixedMeasure=function(){return Number.MAX_SAFE_INTEGER},t.prototype.getLineExtent=function(){var e=this.context,t=e.getAdjustedRowHeight(),r=this.content.getInlines(),n=r.reduce((function(e,t){if(t.isRowSpan)return e;var r=t.borderBoxSize.height;return Math.max(e,r)}),0),o=e.getMergedHeight(tl.filterValidBoxes(r)),i=Math.max(t,n,o,540);return Math.min(i,this.getMaxExtent())},t.prototype.createLineSize=function(){var t=e.prototype.createLineSize.call(this),r=this.content.getLineMeasure();return t.measure=r,t},t.prototype.createChildLayoutRegion=function(){var t=e.prototype.createChildLayoutRegion.call(this),r=this.content.getInlines().length,n=this.context.boxEnv.colWidths[r-1];return t.measure=n||ot.tableCell.padding.left+ot.tableCell.padding.right+ot.defaultBorder.borderWidth,t},t}(Ul),uc=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return vp(t,e),t.prototype.onControl=function(e){var t=this.reduceLayout().filter((function(e){return!e.isControl()}));if(0===t.length)return[new _l(e)];var r=[];return t.forEach((function(e){var t=e.getAsBox();if(t instanceof tl){var n=new _l(xl(t));r.push(n)}})),Cp(t,r)},t.prototype.reduceLayout=function(){return this.context.isEmpty()?[new _l(vl())]:this.context.forceReduceLayout()},t.prototype.setLastBreakCell=function(e){this.context.lastBreakCell=e},t.prototype.markExtraBox=function(){this.context.markExtraBox()},t.prototype.forceGetNext=function(){return this.context.getNext()},t.prototype.getNext=function(){return this.node.getProperty()instanceof sn?{done:!1,value:this.context.forceReduceLayout()}:e.prototype.getNext.call(this)},t}(Gl),hc=function(e){function t(t,r){var n=e.call(this,t)||this;return n.generators=[],n._index=-1,n.delegate=r,n}return vp(t,e),Object.defineProperty(t.prototype,"index",{get:function(){return this._index},set:function(e){this._index=e,this.active=this.generators[e]},enumerable:!0,configurable:!0}),t.prototype.hasNext=function(){return!!this.active},t.prototype.getNext=function(){var t=e.prototype.getNext.call(this);if((!t.value||0===t.value.length)&&this.active instanceof uc){var r=this.active.forceGetNext();if(r)return r}return t},t.prototype.updateActive=function(e){e?(this.generators=[e],this.index=0):(this.generators=[],this.index=-1)},t.prototype.updateGenerator=function(e,t){t<this.generators.length?this.generators[t]=e:this.generators.push(e)},t.prototype.seekToBegin=function(){this.index=0},t.prototype.getGeneratorIndex=function(e){return this.generators.indexOf(e)},t.prototype.moveToNextGenerator=function(){if(!(this.index<this.generators.length-1)){var e=this.getNextSiblingModel();if(e){var t=this.delegate.generatorFactory(e);this.generators.push(t)}}this.index+=1},t.prototype.getNextSiblingModel=function(){return this.active?this.active.node.getNextSibling():null},t}(Nl),fc=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return vp(t,e),t.prototype.checkReusable=function(){return!1},t.prototype.isReachEnd=function(){return!1},t}(Ol),dc=function(e){function t(t,r,n){var o=e.call(this,t,r,n)||this;return o.flowChildGens=new hc(o,o),o}return vp(t,e),t.prototype.createContainer=function(){return new cc(this)},t.prototype.getParentBoxClass=function(){return rl},t.prototype.seek=function(t){t?e.prototype.seek.call(this,t):this.flowChildGens.hasActive()||e.prototype.seek.call(this,t)},t.prototype.getNext=function(){if(this.getAdjustedRowHeight()>this.container.getRestContextBoxExtent()&&!this.container.isBlockReseted(!0))return{done:!1,value:[new _l(vl())]};var t=e.prototype.getNext.call(this);return this.flowChildGens.moveToNextGenerator(),t},t.prototype.updateGenerator=function(e,t){this.flowChildGens.updateGenerator(e,t)},t.prototype.seekToBegin=function(){this.flowChildGens.seekToBegin()},t.prototype.reduceInlineBox=function(){var e=this.container.createLineBox(this.boxEnv,rl);return this.container.clearInlines(),e},t.prototype.getAdjustedRowHeight=function(){return this.boxEnv.rowHeight},t.prototype.getMergedHeight=function(e){var t=this.parentContext,r=this.node.getGCPRange().begin();return t.getCellMergedHeight(r,e)},t.prototype.generatorFactory=function(e){return this.env.factory.createGenerator(this,e)},t.prototype.createReflowInstance=function(e,t,r,n){return this.env.isPageMode?new fc(e,t,r,n):new Ol(e,t,r,n)},t.prototype.isCurrentFinite=function(){return!1},t}(Al),gc=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return vp(t,e),t.prototype.onControl=function(e){return e.isBlockBreak()&&(this.context.seekToBegin(),this.context.container.clearInlines()),[new _l(e)]},t.prototype.onBox=function(t){return e.prototype.onBox.call(this,t)},t.prototype.reduceLayout=function(){var e=this.context.reduceInlineBox();return this.context.env.boxHelper.printRanges(e),[new _l(e)]},t.prototype.updateGenerator=function(e,t){this.context.updateGenerator(e,t)},t.prototype.seekToBegin=function(){this.context.seekToBegin()},t.prototype.getContext=function(){return this.context},t}(Gl),yc=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return vp(t,e),t.prototype.createBlockBox=function(t,r){var n=e.prototype.createBlockBox.call(this,t,r);n.logicEdge=Np.obtain();var o=t.edge;return o&&(n.logicEdge.padding=o.padding,n.logicEdge.margin=o.margin),n},t.prototype.createTableCellBox=function(e,t){if(void 0===t&&(t=!1),t){var n=new tl(Bp.zero);return n.append(this.context.env,e),n}var o=e.totalLogicSize;o.measure=r.pxToTwips(Math.ceil(r.twipsToPx(o.measure))),o.extent=r.pxToTwips(Math.ceil(r.twipsToPx(o.extent)));var i=new tl(o),a=this.context.boxEnv.edge;return(null==a?void 0:a.border)&&(i.logicEdge=Np.obtain(),i.logicEdge.border=a.border),i.layoutRegion=e.layoutRegion,i.curBlockPos=this.getTotalBlockPos(),i.append(this.context.env,e),i},t.prototype.getRestLimitExtent=function(){return Number.POSITIVE_INFINITY},t.prototype.getMaxExtent=function(){return this.context.boxEnv.isMerged?Number.POSITIVE_INFINITY:e.prototype.getMaxExtent.call(this)},t}(Ul),mc=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.extraBox=!1,t}return vp(t,e),t.prototype.createContainer=function(){return new yc(this)},t.prototype.getContainer=function(){return this.container},t.prototype.getParentBoxClass=function(){return qp},t.prototype.getNext=function(){return this.hasNext()?e.prototype.getNext.call(this):{done:!1,value:this.forceReduceLayout()}},t.prototype.forceReduceLayout=function(){var e=this.isEmpty()?this.node.getBPLastIndex():void 0,t=this.reduceBlockBox(),r=this.getContainer().createTableCellBox(t,this.extraBox||this.node.getProperty()instanceof sn),n=[];return r.isMerged=this.boxEnv.isMerged,r.isRowSpanEnd=this.boxEnv.isRowSpanEnd,r.setTableCellProps(this.boxEnv.tableCellProps),r.setEmptyIndex(e),this.lastBreakCell&&(this.lastBreakCell.nextBreakSibling=r,r.prevBreakSibling=this.lastBreakCell),r.isRowSpan&&n.push(new _l(xl(r))),this.env.boxHelper.printRanges(r),Cp([new _l(r)],n)},t.prototype.getFirstReflowChildBox=function(e){var t=e.curBox,r=t&&Fp(t)&&t.firstChild;return r&&Fp(r)&&r.firstChild||void 0},t.prototype.markExtraBox=function(){this.extraBox=!0},t}(Al),bc=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return vp(t,e),t.prototype.getBlocks=function(){return this.content.getBlocks()},t.prototype.createChildLayoutRegion=function(){var t=e.prototype.createChildLayoutRegion.call(this);return t.measure=Number.MAX_SAFE_INTEGER,t},t.prototype.createBlockBox=function(t,r){var n=e.prototype.createBlockBox.call(this,t,r);return t.tableProps&&(n.tableId=t.tableProps.tableId),n},t}(Ul),Pc=function(e){function t(t,r,n,o,i){var a=e.call(this,r,n,o,i)||this;return a.context=t,a}return vp(t,e),t.prototype.isReachEnd=function(){return!!this.getLastReuseBox()&&e.prototype.isReachEnd.call(this)},t.prototype.checkReusable=function(t,r){if(t instanceof rl){if(!this.context.env.isPageMode)return!this.markRowSpanBoxDirty(t);for(var n=0;n<t.children.length;n+=1){var o=t.children[n];if(o.isRowSpan||o.isMerged)return!1}}return e.prototype.checkReusable.call(this,t,r)},t.prototype.markDirty=function(t){e.prototype.markDirty.call(this,t),this.markRowSpanBoxDirty(t)},t.prototype.markRowSpanBoxDirty=function(e){for(var t=e.parentBox&&e.parentBox.children||[],r=t.indexOf(e),n=e.children,o=0;o<n.length;o++){var i=n[o];if(i.isRowSpan){var a=this.env.boxHelper,s=t[r+i.renderRowSpan-1],p=a.getGCPPairs(s),l=a.getGCPPairs(e);if(p.length>0&&l.length>0){var c=[{first:l[0].first,last:p[p.length-1].last}];this.checkBoxDirty(s,c)===Sl.isDirty&&(e.markDirty(),s.markDirty())}}}return e.isSelfDirty()},t}(Ol),vc=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.cellBreakControls=new Set,t}return vp(t,e),t.prototype.createContainer=function(){return new bc(this)},t.prototype.getParentBoxClass=function(){return el},t.prototype.getBlocks=function(){return this.container.getBlocks()},t.prototype.seek=function(t){if(t)return e.prototype.seek.call(this,t);var r=this.getSeekBoxes(),n=this.getLastRow();return this.fixBoxExtent(r,n),n&&r.length>0?(this.fixBoxExtent(r,n),this.seekToMutiBoxes(r,n)):e.prototype.seek.call(this,t)},t.prototype.handleCellBreak=function(e){this.cellBreakControls.add(e)},t.prototype.handleRowBreak=function(e){var t=this,r=!1,n=this.cellBreakControls,o=this.getTableRowIndex(e);return n.forEach((function(e){var n=e.getBox();if(n)if(n.isRowSpan){var i=t.isRowSpanEndAtRowIndex(o,n);n.increaseRenderRowSpan(),i&&t.cellBreakControls.delete(e)}else r=!0})),r&&this.cellBreakControls.clear(),r},t.prototype.handlePageBreak=function(e){return this.latestTableBox=e,this.cellBreakControls.clear(),this.seek()},t.prototype.fixBoxExtent=function(e,t){if(t){var r=t.borderBoxSize.height,n=t.layoutRegion.extent;if(n!==1/0){var o=e.reduce((function(e,t){if(!t.isRowSpan)return e;var r=t.borderBoxSize.height-(t.layoutRegion.extent-n||0);return Math.max(r,e)}),0);r<o&&(t.setExtent(o),t.parentBox&&t.parentBox.setExtent(t.parentBox.extent+o-r))}}},t.prototype.getRowsBefore=function(e){if(e.parentBox){var t=e.parentBox.children,r=t.indexOf(e);return t.slice(0,r)}return[]},t.prototype.isRowSpanEndAtRowIndex=function(e,t){var r=t.rowSpan;return!(r>0)||e-this.getTableRowIndex(t)+1===r},t.prototype.getTableRowIndex=function(e){var t=-1;if(e instanceof Dp)if(e instanceof rl){for(var r=void 0,n=0;n<e.children.length;n+=1){var o=e.children[n];if(!o.isRowSpan){r=o;break}}if(r)t=this.env.boxHelper.getGCPPair(r.indexPairs[0]).last}else{t=this.env.boxHelper.getGCPPair(e.indexPairs[0]).last}else t=e;return this.node.getTextStream().tableStream.getTableRowIndexFromGCP(t)},t.prototype.seekToMutiBoxes=function(e,t){var r=this,n=this.node.getOffsets(),o=this.node.getGCPRange().begin(),i={},a={};this.node.seek([this.env.boxHelper.getGCPPair(t.indexPairs[t.indexPairs.length-1]).first-o]);var s=this.node.getBeginChild(),p=s&&s instanceof up?s:void 0,l=!0,c=!1,u=tl.filterValidBoxes(e),h=this.getTableRowIndex(t);if(u.forEach((function(e,t){var n=r.env.boxHelper.getGCPPair(e.indexPairs[e.indexPairs.length-1]).last-o+1;r.node.seek([n]);var s=r.node.getBeginChild();if(s&&s instanceof up){var u=s.getBeginChild();if(u){var f=u.getOffsets()[0]<=0,d=r.isRowSpanEndAtRowIndex(h,e);f?(u=u.getPrevSibling())&&(u.seek([u.getGCPRange().len]),i[t]=u,d||(a[t]=u)):(i[t]=u,a[t]=u),d&&!f&&(l=!1),d&&f||(c=!0)}}else r.node.seek([n-1]),p=r.node.getBeginChild()})),this.node.seek(n),!p)return this.flowChildGens.updateActive(null),!1;if(!c){var f=p.getNextSibling();if(f){var d=this.env.factory.createGenerator(this,f);return this.flowChildGens.updateActive(d),!0}return this.flowChildGens.updateActive(null),!1}return l?!!(p=p.getNextSibling()||void 0)&&(this.recoverRowGen(t,e,p,a,l),!0):(this.recoverRowGen(t,e,p,i,l),!0)},t.prototype.recoverRowGen=function(e,t,r,n,o){this.reflowContext&&this.reflowContext.resetFind(),r.seek([0]);for(var i=this.env.factory.createGenerator(this,r),a=i.getContext(),s=r.getBeginChild(),p=0,l=0;s;){var c=n[p-1],u=void 0;if(c){var h=t[p-1];if((u=this.env.factory.createGenerator(a,c)).setLastBreakCell(h),h.parentBox&&(h.parentBox.isLast=!1),o){var f=this.env.factory.createGenerator(a,s);i.updateGenerator(u,l),(u=f).markExtraBox(),l+=1}}else o||s.seek([s.getGCPRange().len]),u=this.env.factory.createGenerator(a,s),o||u.setLastBreakCell(e.children[p]);i.updateGenerator(u,l),s=s.getNextSibling(),l+=1,p+=1}i.seekToBegin(),this.flowChildGens.updateActive(i)},t.prototype.findReuseParentBox=function(){for(var e=this.reflowContext;e instanceof Ol;){var t=e.getLastReuseBox();if(t)return t;e=e.parent}},t.prototype.getLastRow=function(){var e=this.getBlocks();if(e.length>0)return e[e.length-1];for(var t=this.latestTableBox||this.findReuseParentBox();t;){if(t instanceof el)return t.lastChild;t=Fp(t)&&t.lastChild||void 0}},t.prototype.getSeekBoxes=function(){var e,t,n=this.getLastRow();if(null==n?void 0:n.parentBox){n instanceof rl||(r.Logger.error("box type error!!!!"),r.Logger.error(n.constructor));var o=n.logicChildren.slice(0),i=this.getRowsBefore(n),a=this.createRowSpanBoxIter(i,o);try{for(var s=_p(a),p=s.next();!p.done;p=s.next()){var l=p.value,c=l.index,u=l.cell;o[c]=u}}catch(t){e={error:t}}finally{try{p&&!p.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}return o}return[]},t.prototype.createRowSpanBoxIter=function(e,t){var r,n,o,i,a;return Tp(this,(function(s){switch(s.label){case 0:r=0,s.label=1;case 1:if(!(r<t.length))return[3,10];if(!(n=t[r]).isMerged)return[3,6];o=e.length-1,s.label=2;case 2:return o>=0?(i=e[o],(null==(a=i.logicChildren[r])?void 0:a.isRowSpan)?[4,{index:r,cell:a}]:[3,4]):[3,5];case 3:return s.sent(),[3,5];case 4:return o-=1,[3,2];case 5:return[3,8];case 6:return n.isRowSpan?[4,{index:r,cell:n}]:[3,8];case 7:s.sent(),s.label=8;case 8:r+=Math.max(1,t[r].colSpan),s.label=9;case 9:return[3,1];case 10:return[2]}}))},t.prototype.getCellMergedHeight=function(e,t){var r,n,o=this.getBlocks(),i=this.createRowSpanBoxIter(o,t),a=this.container.getTotalBlockPos(),s=0,p=this.getTableRowIndex(e);try{for(var l=_p(i),c=l.next();!c.done;c=l.next()){var u=c.value.cell;if(this.isRowSpanEndAtRowIndex(p,u)){var h=u.curBlockPos,f=u.totalExtent-(a-h);s=Math.max(f,s)}}}catch(e){r={error:e}}finally{try{c&&!c.done&&(n=l.return)&&n.call(l)}finally{if(r)throw r.error}}return s},t.prototype.isCurrentFinite=function(){return!0},t.prototype.createReflowInstance=function(e,t,r,n){return new Pc(this,e,t,r,n)},t.prototype.hasNext=function(){return e.prototype.hasNext.call(this)},t.prototype.reduceBlockBox=function(t){return void 0===t&&(t=!0),e.prototype.reduceBlockBox.call(this,t)},t.prototype.checkMergeIsOver=function(e){var t,r,n=this.createRowSpanBoxIter(this.getBlocks(),e.logicChildren),o=this.getTableRowIndex(e);try{for(var i=_p(n),a=i.next();!a.done;a=i.next()){var s=a.value.cell,p=this.env.boxHelper.getGCPRanges(s.indexPairs),l=p[p.length-1].end();if(this.isRowSpanEndAtRowIndex(o,s)){var c=this.node.getTextStream().tableStream.getTableCellInfoFromGcp(l-1);if(c&&c.range.end()>l)return!0}}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return!1},t.prototype.pushBlockLevel=function(t){var r=e.prototype.pushBlockLevel.call(this,t);return this.env.isPageMode&&r===kl.Inside&&(this.handleRowBreak(t)||this.checkMergeIsOver(t))?kl.Over:r},t}(Al),xc=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return vp(t,e),t.prototype.onControl=function(e){if(e instanceof ml)this.context.handleCellBreak(e);else if(e.isBlockBreak())return this.reduceLayout();return[]},t.prototype.onBox=function(t){return e.prototype.onBox.call(this,t)},t.prototype.reduceLayout=function(){if(this.context.isEmpty())return[new _l(vl())];var e=this.context.reduceBlockBox(),t=[];return this.context.handlePageBreak(e)&&(t=[new _l(vl())]),this.setTableProps(e),this.context.env.boxHelper.printRanges(e),Cp([new _l(e)],t)},t.prototype.setTableProps=function(e){e.colWidths=this.context.boxEnv.colWidths},t}(Gl),Tc=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return vp(t,e),t.prototype.createIterator=function(){return Tp(this,(function(e){switch(e.label){case 0:return this.context.hasNext()?[4,this.context.getValues()]:[3,2];case 1:return e.sent(),[3,0];case 2:return[2]}}))},t}(Kl),_c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return vp(t,e),t}(Tc),Sc=function(e){function t(t,r,n){var o=e.call(this,t,r)||this;return o.layoutDone=!1,o.parent=n,o}return vp(t,e),t.prototype.hasNext=function(){return!this.layoutDone},t.prototype.getNext=function(){throw new Error("ConstantContext can't call getNext.")},t.prototype.commit=function(){this.layoutDone=!0},t.prototype.rollback=function(){this.layoutDone=!1},t}(Ml),Cc=function(t){function r(){var r=null!==t&&t.apply(this,arguments)||this;return r.kind=e.BoxKind.Empty,r}return vp(r,t),r}($p),Bc=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return vp(t,e),t.prototype.getValues=function(){var e=new Cc,t=this.env.textStream,r=this.node.getGCPRange();return e.firstIndex=t.getIndexFromGCP(r.begin()),e.lastIndex=t.getIndexFromGCP(r.end()-1),[new _l(e)]},t}(Sc),Rc=function(){function t(e){this.leftIndent=0,this.rightIndent=0,this.specialIndent=0,this.firstCharFont=0,this.marginStart=0,this.maxContentMeasure=0,this.context=e,this.content=[],this.init()}return t.prototype.init=function(){this.leftIndent=this.getLeftIndent(),this.rightIndent=this.getRightIndent(),this.firstCharFont=this.getFirstCharacterFontSize(),this.specialIndent=this.getSpecialIndent(this.firstCharFont)},t.prototype.getLeftIndent=function(){var e=this.context.boxEnv.paraStyle.leftIndentConfig,t=e.valueIndent;return 0!==e.characterUnitIndent&&(t=e.characterUnitIndent*ot.fontSize),t},t.prototype.getRightIndent=function(){var e=this.context.boxEnv.paraStyle.rightIndentConfig,t=e.valueIndent;return 0!==e.characterUnitIndent&&(t=e.characterUnitIndent*ot.fontSize),t},t.prototype.getFirstCharacterFontSize=function(){var e=ot.fontSize,t=this.context.node.getFirstChildBy(np),r=null==t?void 0:t.getProperty();return r&&(e=r.fontSize),e},t.prototype.getSpecialIndent=function(e){var t=this.context.boxEnv.paraStyle.specialIndentConfig,r=t.valueIndent;return 0!==t.characterUnitIndent&&(r=e*t.characterUnitIndent),r},t.prototype.getReservedIndent=function(e,t){return e?t>0?t:0:t>0?0:Math.abs(t)},t.prototype.updateForNewLine=function(e){this.marginStart=this.leftIndent+this.getReservedIndent(e,this.specialIndent),this.maxContentMeasure=this.maxLineMeasure-this.marginStart-this.rightIndent},Object.defineProperty(t.prototype,"maxLineMeasure",{get:function(){return this.context.parent.container.getRestContextBoxMeasure()},enumerable:!0,configurable:!0}),t.prototype.getRootExtent=function(){return this.context.parent.container.getRootExtent()},t.prototype.pushBox=function(e){var t;(t=this.content).push.apply(t,Cp(e))},t.prototype.clearContent=function(){this.content=[]},t.prototype.computeMetric=function(e){var t=e||{fontAscent:0,fontDescent:0,lineAscent:0,lineDescent:0};return this.content.reduce((function(e,t){return t instanceof hl?(e.fontAscent=Math.max(e.fontAscent,t.glyph&&t.glyph.ascent||0),e.fontDescent=Math.max(e.fontDescent,t.glyph&&t.glyph.descent||0)):(e.fontAscent=Math.max(e.fontAscent,t.ascent),e.fontDescent=Math.max(e.fontDescent,t.descent)),e.lineAscent=Math.max(e.lineAscent,t.ascent+jp(t).before),e.lineDescent=Math.max(e.lineDescent,t.descent+jp(t).after),e}),t)},t.prototype.computeLineExtent=function(t,r,n){var o=r+n,i=t-o,a=this.context.boxEnv.paraStyle.lineSpacingConfig;switch(a.rule){case e.LineSpacingType.Multiple:if(this.context.boxEnv.paraStyle.disableLineHeightGrid)i+=o*=a.value;else{i=240*Math.max(Math.ceil(t/240),a.value)}break;case e.LineSpacingType.Exactly:i+=o=a.value;break;case e.LineSpacingType.AtLeast:i+=o=o>a.value?o:a.value}return i},t.prototype.computeLinePadding=function(t,n){var o;switch(this.context.boxEnv.paraStyle.textAlignment){case e.TextAlignmentType.Right:o=n-t;break;case e.TextAlignmentType.Center:o=(n-t)/2;break;default:o=0}return o<0&&(r.Logger.error("Error linePadding="+o),o=0),o},t.prototype.newLineBox=function(e){return new Jp(e)},t.prototype.createLineBox=function(e,t,r){var n=e.measure,o=n-e.tailGlueWidth,i=this.computeMetric(),a=i.lineAscent+i.lineDescent,s=this.computeLineExtent(a,i.fontAscent,i.fontDescent),p=this.computeLinePadding(o,this.maxContentMeasure),l=this.newLineBox({measure:n,extent:s});l.isPageBreak=e.isPageBreak,l.sourceExtent=a,l.contentWidth=o,l.setBaseline(i.lineAscent,i.lineDescent),l.logicEdge=Np.obtain(),l.logicEdge.margin=Ip.zero,l.logicEdge.margin.start=this.marginStart,l.logicEdge.padding=Ip.zero,l.logicEdge.padding.start=p,t&&(l.isFirst=!0,l.logicEdge.padding.before=this.context.boxEnv.paraStyle.spaceBefore),r&&(l.logicEdge.padding.after=this.context.boxEnv.paraStyle.spaceAfter);var c=new kp;c.measure=this.maxLineMeasure;var u=this.context.parent.container;return c.extent=u.getRestContextBoxExtent(),l.layoutRegion=c,l.append.apply(l,Cp([this.context.env],this.content)),l},t}();!function(e){e[e.Box=0]="Box",e[e.Glue=1]="Glue",e[e.Penalty=2]="Penalty"}(Fl||(Fl={}));var wc,Ic=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.kind=Fl.Glue,t.width=0,t.widthAdj=0,t}return vp(t,e),t.prototype.recycle=function(){this.range=void 0,this.text=void 0,this.glyph=void 0,this.width=0,t.sPool.recycle(this)},t.prototype.adjustWidth=function(e){this.widthAdj=e,this.width+=e},t.obtain=function(e,r){var n=t.sPool.obtain();return n||(n=new t),n.range=r,n.width=e,n},t.sPool=new r.ObjectPool(100),t}(r.PoolNode);!function(e){e[e.Start=0]="Start",e[e.Default=1]="Default",e[e.PlaceHolder=2]="PlaceHolder",e[e.Whitespace=3]="Whitespace",e[e.PageBreak=4]="PageBreak",e[e.LineBreak=5]="LineBreak",e[e.SectionBreak=6]="SectionBreak",e[e.Tabstop=7]="Tabstop"}(wc||(wc={}));var Ec=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.kind=Fl.Box,t.type=wc.Default,t.hanging=!1,t.width=0,t.height=0,t.widthAdj=0,t}return vp(t,e),t.prototype.setSize=function(e){this.width=e.measure,this.height=e.extent},t.prototype.adjustWidth=function(e){this.widthAdj=e,this.width+=e},t.prototype.setBox=function(e){this.box=e},t.prototype.recycle=function(){this.type=wc.Default,this.range=void 0,this.text=void 0,this.glyph=void 0,this.hanging=!1,this.width=0,this.widthAdj=0,this.height=0,this.box=void 0,t.sPool.recycle(this)},t.obtain=function(e,r){var n=t.sPool.obtain();return n||(n=new t),n.range=r,n.width=e,n},t.sPool=new r.ObjectPool(600),t}(r.PoolNode),Lc=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.kind=Fl.Penalty,t.width=0,t.penalty=0,t}return vp(t,e),t.prototype.recycle=function(){t.sPool.recycle(this)},t.obtain=function(e,r){var n=t.sPool.obtain();return n||(n=new t),n.width=e,n.penalty=r,n},t.sPool=new r.ObjectPool(300),t}(r.PoolNode),Oc=function(){function e(){}return e.makeBox=function(e,t){return Ec.obtain(e,t)},e.makeGlue=function(e,t){return Ic.obtain(e,t)},e.makePenalty=function(e,t){return void 0===e&&(e=!1),void 0===t&&(t=0),Lc.obtain(t,e?-1e5:0)},e}();function Nc(e){return e.kind===Fl.Box&&e.type===wc.Tabstop}function kc(e){return e.kind===Fl.Glue||e.kind===Fl.Penalty||function(e){if(e.kind!==Fl.Box)return!1;switch(e.type){case wc.Whitespace:case wc.PageBreak:case wc.SectionBreak:case wc.LineBreak:return!0}return!1}(e)}var Mc,Dc=function(){function e(e,t){this.textStream=e,this.shaper=t}return e.prototype.shapeCurrentToken=function(e,t){var r=this.processBeforeMeasure(t),n=e.model.getProperty()||void 0,o=this.shaper.shapeToken(r.toString(),n);return o=this.processAfterMeasure(o)},e.prototype.processBeforeMeasure=function(e){switch(this.state.curTokenType){case wc.LineBreak:return uo.NonBreakSpace;case wc.PageBreak:return uo.NoWidthOptionalBreak;default:return e}},e.prototype.processAfterMeasure=function(e){if(this.state.curTokenType===wc.Tabstop){var t=this.shaper.shapeToken(uo.Space);return xp(xp({},e),{width:t.width*ot.tabSize})}return e},e.prototype.pushCurrentTokenAsGlue=function(){var e=this.state,t=e.curTokenStartIndex,r=e.curTokenEndIndex-t+1,n=this.textStream.readText(t,r),o=this.shapeCurrentToken(e,n),i=Oc.makeGlue(o.width,new ne(t,r));i.glyph=o,i.text=n,e.nodes.push(i)},e.prototype.pushCurrentTokenAsBox=function(){var e=this.state,t=e.curTokenStartIndex,r=e.curTokenEndIndex-t+1,n=this.textStream.readText(t,r),o=this.shapeCurrentToken(e,n),i=Oc.makeBox(o.width,new ne(t,r));i.text=n,i.glyph=o,i.type=e.curTokenType,i.hanging=e.hanging,e.nodes.push(i)},e.prototype.pushCurrentToken=function(e,t){if(this.state.curTokenType===wc.Whitespace){if(this.pushCurrentTokenAsGlue(),t){var r=Oc.makePenalty(!0);this.state.nodes.push(r)}}else if(this.pushCurrentTokenAsBox(),e||this.state.curTokenType===wc.Tabstop){r=Oc.makePenalty(t);this.state.nodes.push(r)}this.state.curTokenStartIndex=this.state.curPos,this.state.curTokenType=this.state.curPosTokenType},e.prototype.isTokenEnd=function(e){if(e!==this.state.curTokenType)return!0;switch(e){case wc.PageBreak:case wc.SectionBreak:case wc.LineBreak:case wc.Tabstop:return!0;default:return!1}},e.prototype.process=function(e,t){for(var r=e.getTextRange(),o=r.begin(),i=o+r.length()-1,a=0,s=0;s<t.length;s++){if(t[s].position>=o){a=s;break}}var p,l={model:e,nodes:[],lineBreakPoints:t,nextLineBreakPointIndex:a,curTokenType:wc.Start,curTokenStartIndex:o,curTokenEndIndex:o,curPos:o,curPosTokenType:wc.Start,hanging:!1};this.state=l;for(s=o;s<=i;s++){l.curPos=s;var c=this.textStream.charCodeAt(s);if(n.isHighSurrogate(c)&&s<=i-1){var u=this.textStream.charCodeAt(s+1);n.isLowSurrogate(u)&&(s+=1,c=((1023&c)<<10)+(1023&u)+65536)}var h=(p=c,n.isWhiteSpace(p)?wc.Whitespace:yo(p)?wc.PageBreak:go(p)?wc.SectionBreak:ho(p)?wc.LineBreak:mo(p)?wc.Tabstop:wc.Default);l.curTokenType===wc.Start&&(l.curTokenType=h),l.curPosTokenType=h;var f=l.nextLineBreakPointIndex,d=l.lineBreakPoints[f],g=l.curPos===d.position,y=g&&d.required;l.curPos>o&&(g||this.isTokenEnd(h))&&this.pushCurrentToken(g,y),g&&f<l.lineBreakPoints.length-1&&(l.nextLineBreakPointIndex=f+1),l.curTokenEndIndex=s,h===wc.LineBreak&&(l.hanging=!0)}var m=l.nextLineBreakPointIndex,b=l.lineBreakPoints[m],P=i+1===b.position,v=P&&b.required;return this.pushCurrentToken(P,v),l.nodes},e}(),Fc=function(){function e(e){this.shaper=e}return e.prototype.processBeforeMeasure=function(e){if(e&&1===e.length){var t=e.charCodeAt(0);if(ho(t))return uo.NonBreakSpace;if(yo(t))return uo.NoWidthOptionalBreak}return e},e.prototype.process=function(e){var t=e.getTextRange(),r=e.getTextContent(),n=e.measuredText||r,o=this.processBeforeMeasure(n),i=e.getProperty()||void 0,a=this.shaper.shapeToken(o.toString(),i),s=Oc.makeBox(a.width,t);return s.text=r,s.glyph=a,[s]},e}(),Ac=function(){function e(e){this.shaper=e}return e.prototype.process=function(e){var t=[];if(t.push(Oc.makePenalty()),e instanceof tp){var r=e.getTextContent(),n=e.getProperty()||void 0,o=this.shaper.shapeToken(r,n),i=e.getSize(),a=e.getGCPRange();(s=Oc.makeBox(0,a)).glyph=o,s.type=wc.PlaceHolder,s.setSize({measure:i.width,extent:i.height}),t.push(s)}else if(e instanceof ap){var s;a=e.getGCPRange();(s=Oc.makeBox(0,a)).type=wc.PlaceHolder,t.push(s)}return t.push(Oc.makePenalty()),t},e}(),Kc=function(){function e(e,t){this._textStream=e,this._shaper=t}return Object.defineProperty(e.prototype,"normalProcessor",{get:function(){return this._normalProcessor||(this._normalProcessor=new Dc(this._textStream,this._shaper)),this._normalProcessor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nowrapProcessor",{get:function(){return this._nowrapProcessor||(this._nowrapProcessor=new Fc(this._shaper)),this._nowrapProcessor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"objectProcessor",{get:function(){return this._objectProcessor||(this._objectProcessor=new Ac(this._shaper)),this._objectProcessor},enumerable:!0,configurable:!0}),e.prototype.process=function(e,t){return e instanceof np?t?this.normalProcessor.process(e,t):this.nowrapProcessor.process(e):e instanceof tp||e instanceof ap?this.objectProcessor.process(e):[]},e}(),Gc=function(){function e(e){this._shaper=e}return e.prototype.breakWord=function(e,t,r){if(!(e instanceof Ec&&t instanceof np&&e.text))return[e];var o=new n.UString(e.text),i=0,a=o.graphemeCount()-1;if(0===a)return[e];for(var s=t.getProperty()||void 0,p=a;;){var l=Math.floor((a-i)/2+i);if(l<=i){p=i;break}var c=o.sliceByGrapheme(0,l+1),u=this._shaper.shapeToken(c.toString(),s);if(u.width>r)a=l;else{if(!(u.width<r)){p=l;break}i=l}}var h=o.graphemeIndex2CharCodeIndexRange(p).end+1,f=e.range;if(!f||h===f.len)return[e];var d=o.sliceByGrapheme(0,p+1).toString(),g=this._shaper.shapeToken(d,s),y=new ne(f.gcpBegin,h),m=Oc.makeBox(g.width,y);m.type=e.type,m.glyph=g,m.text=d,y=new ne(y.end(),f.len-h);var b=e.text.slice(h),P=this._shaper.shapeToken(b,s),v=Oc.makeBox(P.width,y);return v.type=e.type,v.glyph=P,v.text=b,[m,v]},e.prototype.split=function(e,t){if(t<=0)return r.Logger.warn("layout|typeset split measure:"+t),[e,[]];for(var n=[],o=[],i=0,a=0;a<e.length;a++){var s=e[a];if(!(i+s[0].width<=t)){var p=t-i;if(p<=0){o=e.slice(a);break}var l=Sp(this.breakWord(s[0],s[1],p),2),c=l[0],u=l[1],h=void 0;0===i||i+c.width<=t?(n.push([c,s[1]]),u&&o.push([u,s[1]]),h=a+1):h=a,o.push.apply(o,Cp(e.slice(h)));break}n.push(s),i+=s[0].width}return[n,o]},e}(),Hc=function(){function t(){}return t.create=function(e,t){return new(this.getBoxClassByProperty(e))(t)},t.getBoxClassByProperty=function(t){switch(t.propertyType){case e.PropertyType.TextframeProperty:return dl;default:return fl}},t}(),jc=function(e,t,r,n){var o=r.getMargin(),i=o.top,a=o.left,s=o.right,p=r.getSize(),l=Math.max(n.measure-a-s,0),c=Math.max(n.extent-i,0),u={measure:p.width,extent:p.height};if(-1===p.width)u={measure:l,extent:Math.min(c,p.height)};else if(p.width>l||p.height>c){if(r.fixedRatio())if(p.width/l>p.height/c)u={measure:l,extent:l*(p.height/p.width)};else u={measure:c*(p.width/p.height),extent:c};else u={measure:Math.min(l,p.width),extent:Math.min(c,p.height)}}var h=Hc.create(r.getProperty(),u);h.logicEdge=Np.obtain(),h.logicEdge.margin=new Ip({before:i,start:a,end:s,after:0}),t.setSize(h.totalLogicSize),t.setBox(h)},Uc=function(t){function n(e,r,n){var o=t.call(this,e,r,n)||this;return o.isJustify=!1,o.isNowrap=!0,o.ellipsize=Mc.end,o.boxEnv=new Dl(o.node),o}return vp(n,t),Object.defineProperty(n.prototype,"maxMeasure",{get:function(){var e=this.boxEnv.maxMeasure||Number.POSITIVE_INFINITY;return this.boxEnv.edge?e-this.boxEnv.edge.measure:e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"maxExtent",{get:function(){return this.boxEnv.maxExtent||Number.POSITIVE_INFINITY},enumerable:!0,configurable:!0}),n.prototype.createBreakLine=function(e){var t=new nu(e,this.env,this).getNext();return!t.done&&t.value[0]||null},n.prototype.createEmptyBox=function(e){var t=new Cc;return t.firstIndex=e.getBPFirstIndex(),t.lastIndex=e.getBPLastIndex(),t.indexPairs.push({first:t.firstIndex,last:t.lastIndex}),t},n.prototype.getValues=function(){var e=this,t=[],r=this.getFieldCodeBeginBox();t.push.apply(t,Cp(r));var n=Sp([0,0],2),o=n[0],i=n[1],a=Sp([0,0],2),s=a[0],p=a[1],l=this.createFieldContext(),c=this.node.getResultNode(l);if(c instanceof Zs){var u=this.createBreakLine(c);((null==u?void 0:u.textRuns)||[]).forEach((function(r){var n=r.model,a=r.bgps,l=e.convertToLeafBox(n,a);l&&(o+=l.totalMeasure,i=Math.max(i,l.totalExtent),s=Math.max(s,l.ascent),p=Math.max(p,l.descent),t.push(l))}))}else c instanceof $s&&t.push(this.createEmptyBox(c));var h=this.getFieldCodeEndBox();t.push.apply(t,Cp(h));var f=new Qp({measure:o,extent:i});if(f.setBaseline(s,p),f.append.apply(f,Cp([this.env],t)),f.logicEdge=this.boxEnv.edge,f.fieldInfo=this.node.fieldInfo,f.fieldContext=l,f.fieldInfo){var d=Fo.getInstance().getFieldcodeInfo(f.fieldInfo.fieldCode);f.subType=d.fieldName}return[new _l(f)]},n.prototype.getFieldCodeBeginBox=function(){var e=this.node.fieldInfo;if(!e)return[];var t=e.fieldRange.begin(),r=e.fieldResultRange.begin(),n=ul(uo.FieldBegin,{measure:0,extent:0}),o=this.env.textStream;return n.firstIndex=o.getIndexFromGCP(t),n.lastIndex=o.getIndexFromGCP(r-1),n.hidden=!0,n.indexPairs.push({first:n.firstIndex,last:n.lastIndex}),[n]},n.prototype.getFieldCodeEndBox=function(){var e=this.node.fieldInfo;if(!e)return[];var t=e.fieldResultRange.end(),r=e.fieldRange.end(),n=ul(uo.FieldEnd,{measure:0,extent:0}),o=this.env.textStream;return n.firstIndex=o.getIndexFromGCP(t),n.lastIndex=o.getIndexFromGCP(r-1),n.hidden=!0,n.indexPairs.push({first:n.firstIndex,last:n.lastIndex}),[n]},n.prototype.createFieldContext=function(){var t=this,r=this.node.fieldInfo;if(!r)return{};var n={};return r.requiredContext.forEach((function(r){switch(r){case e.FieldcodeLayoutContextKey.PAGE:n.page=t.env.fieldBoxMgr.counter.pageNum;break;case e.FieldcodeLayoutContextKey.SECTION:n.section=t.env.fieldBoxMgr.counter.sectionNum;break;case e.FieldcodeLayoutContextKey.PAGE_START:n.pageStart=t.env.fieldBoxMgr.counter.pageStart}})),n},n.prototype.convertToLeafBox=function(e,t){var n,o=new Dl(e,this.boxEnv),i=this.env.textStream;if(t.forEach((function(e){if(e.kind===Fl.Box)if(e.range)if(n){n.text+=e.text||"",n.width+=e.width,n.range=n.range.unionRange(e.range);var t=n.glyph?n.glyph.height:0;(e.glyph?e.glyph.height:0)>t&&(n.glyph=e.glyph)}else n={text:e.text||"",width:e.width,range:e.range,glyph:e.glyph};else r.Logger.error("typeset range empty!")})),n){var a={measure:n.width,extent:n.glyph&&n.glyph.height||0},s=ul(n.text,a);return s.textStyle=o.textStyle,s.glyph=n.glyph,s.firstIndex=i.getIndexFromGCP(n.range.begin()),s.lastIndex=i.getIndexFromGCP(n.range.end()-1),s.indexPairs.push({first:s.firstIndex,last:s.lastIndex}),s}},n.prototype.updateLayoutRegion=function(e){this.boxEnv.measure=e.measure,this.boxEnv.extent=e.extent,this.boxEnv.maxMeasure=e.maxMeasure,this.boxEnv.maxExtent=e.maxExtent},n}(Sc),zc=function(e,t,r,n){var o=new Uc(r,e.env,e),i=new kp;i.measure=Number.POSITIVE_INFINITY,i.maxMeasure=n.measure,o.updateLayoutRegion(i);var a=Sp(o.getValues(),1)[0];if(null==a?void 0:a.isBox()){var s=a.getAsBox();t.setSize(s.totalLogicSize),t.setBox(s),s.fieldInfo&&s.fieldInfo.isAutoUpdate&&e.env.fieldBoxMgr.addBox(s)}},Wc=function(e){function t(t,r,n){var o=e.call(this,t,r)||this;return o.parent=n,o.boxEnv=new Dl(t,n.boxEnv),o.reflowContext=o.createReflowContext(n.reflowContext),o}return vp(t,e),t.prototype.createContainer=function(){return new Ul(this)},t.prototype.getParentBoxClass=function(){return qp},t.prototype.updateLayoutRegion=function(e){this.boxEnv.measure=e.measure,this.boxEnv.extent=e.extent,this.boxEnv.maxExtent=e.maxExtent,this.boxEnv.minExtent=e.minExtent},t}(Al),Vc=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return vp(t,e),t.prototype.reduceLayout=function(){if(this.context.isEmpty())return[new _l(vl())];var e=this.context.reduceBlockBox();return[new _l(e)]},t}(Gl),Yc=function(e){function t(t,r,n){var o=e.call(this,t,r,n)||this;return o.boxEnv=new Dl(t),o.reflowContext=o.createReflowContext(n.reflowContext),o}return vp(t,e),t.prototype.updateLayoutRegion=function(e){this.boxEnv.measure=e.measure,this.boxEnv.extent=e.extent,this.boxEnv.maxExtent=e.maxExtent,this.boxEnv.minExtent=e.minExtent},t.prototype.getValues=function(){var e;this.node.content&&((e=this.findReusableBox())||(El.LOG&&r.Logger.log("layout|unreuse TextFrame id:"+this.node.storyId),e=this.typesetContent(this.node.content)));var t=this.createBlockSize(null==e?void 0:e.totalLogicSize),n=new dl(t);return e&&(e.parentBox=n),n.storyId=this.node.storyId,n.content=e,n.logicEdge=this.boxEnv.edge,[new _l(n)]},t.prototype.createBlockSize=function(e){var t,r=this.boxEnv.measure||0,n=this.boxEnv.extent,o=this.boxEnv,i=o.minExtent,a=o.maxExtent;if(n&&Number.isFinite(n))t=n;else{var s=(null==e?void 0:e.extent)||0;t=i&&Math.max(i,s)||s,t=a&&Math.min(a,t)||t}return Bp.obtain({measure:r,extent:t})},t.prototype.typesetContent=function(e){var t=new Wc(e,this.env,this),r=new kp;r.extent=Number.POSITIVE_INFINITY,r.measure=this.boxEnv.measure||0,t.updateLayoutRegion(r);var n=new Vc(t).getNext(),o=n.value&&n.value[0];if(null==o?void 0:o.isBox())return o.getAsBox()},t.prototype.findReusableBox=function(){if(this.reflowContext){var e=this.reflowContext.curBox;if(e&&!e.isSelfDirty()&&e.measure===this.boxEnv.measure){var t=this.env.boxHelper.bp2cp(e.firstIndex),r=this.env.boxHelper.bp2cp(e.lastIndex);if(!(t<0||r<0)){var n=new ne(t,r-t+1),o=this.reflowContext.storyDirty;if(o.isInvalid()||!o.intersect(n)){var i=this.node.content;if(i){var a=i.getGCPRange();if(n.equal(a))return e}}}}}},t.prototype.createReflowContext=function(e){if(e){var t=this.node.getGCPRange().begin(),r=e.seekBox(t);if(r instanceof dl){var n=e.allDirty.get(this.node.storyId)||fa.invalidRange();return{allDirty:e.allDirty,storyDirty:n,curBox:r.content}}}},t}(Sc),qc=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return vp(t,e),t}(Tc),Xc=function(e,t,r,n){var o=new kp,i=r.padding,a=i.left,s=i.right,p=i.top,l=i.bottom,c=r.getSize();if(-1===c.width?o.measure=n.measure-a-s:o.measure=c.width,-2===c.height){var u=Number.isFinite(n.extent)?n.extent:void 0;o.maxExtent=u&&u-p-l,o.extent=Number.POSITIVE_INFINITY}else o.extent=c.height;r.resetContent();var h=new Yc(r,e.env,e);h.updateLayoutRegion(o);var f=new qc(h).getNext(),d=null==f?void 0:f.value[0];if(null==d?void 0:d.isBox()){var g=d.getAsBox();e.env.storyBoxMgr.setBox(g.storyId,g),t.setSize(g.totalLogicSize),t.setBox(g)}},Jc=function(){function t(t){this.map=new Map,this.context=t,this.add(e.LayoutInputNodeType.EmbedContainer,jc),this.add(e.LayoutInputNodeType.FieldCode,zc),this.add(e.LayoutInputNodeType.TextFrame,Xc)}return t.prototype.add=function(e,t){this.map.set(e,t)},t.prototype.doMeasure=function(e,t,r){var n=this.map.get(t.getType());n&&n(this.context,e,t,r)},t}(),Zc=function(){function e(e,t){this.curPos=0,this.context=e,this.lineEnv=t,this.content=[]}return e.prototype.isEmpty=function(){return this.content.length<1},e.prototype.clearContent=function(){this.content=[],this.curPos=0},Object.defineProperty(e.prototype,"lastNode",{get:function(){var e=this.content.length;if(e>0)return this.content[e-1][0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"restMeasure",{get:function(){return this.lineEnv.maxMeasure-this.curPos},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isLastLine",{get:function(){return!this.context.hasNext()},enumerable:!0,configurable:!0}),e.prototype.isOver=function(e){return this.restMeasure<e},e.prototype.computeTabstop=function(e,t){var r=this.curPos+t,n=this.lineEnv.maxMeasure-r;if(n>0){var o=e.width,i=void 0;i=o<n?o-r%o:n,e.adjustWidth(i-o)}},e.prototype.addBGPs=function(e,t){var r;return(r=this.content).push.apply(r,Cp(e)),this.curPos+=t,!1},e.prototype.typesetBGPs=function(e){if(e.length<=0)return!1;var t=Sp(e,1),r=Sp(t[0],1)[0];return r.kind===Fl.Box?this.handleBox(e):r.kind===Fl.Glue?this.handleGlue(e):r.kind===Fl.Penalty&&this.handlePenalty(e)},e.prototype.handleBox=function(e){var t=this,r=0;e.forEach((function(e){var n=Sp(e,2),o=n[0],i=n[1];o.type===wc.PlaceHolder?t.context.measureObject(o,i):o.type===wc.Tabstop&&t.computeTabstop(o,r),r+=o.width}));var n=Sp(e[e.length-1],1)[0],o=n.hanging?n.width:0;if(!this.isOver(r-o))return this.addBGPs(e,r),!1;if(this.isEmpty()){var i=Sp(this.context.splitBGPs(e),2),a=i[0],s=i[1],p=a.reduce((function(e,t){return e+t[0].width}),0);if(this.addBGPs(a,p),!(s&&s.length>0))return!1;this.context.backOverBGPs(s)}else this.context.backOverBGPs(e);return!0},e.prototype.handleGlue=function(e){var t=e.reduce((function(e,t){return e+t[0].width}),0);return this.addBGPs(e,t),!1},e.prototype.handlePenalty=function(e){if(this.isEmpty())return!1;var t,r,n=Sp(e,1),o=Sp(n[0],1)[0],i=this.lastNode;if(i&&(r=o,(t=i).kind===Fl.Penalty&&r.kind===Fl.Penalty&&t.penalty===r.penalty))return!1;var a=o.penalty<=-1e5;return this.addBGPs(e,0),a},e.prototype.justifyAlign=function(){for(var e=0,t=0,r=this.content.length-1;r>0;r-=1){if((s=Sp(this.content[r],1)[0]).kind===Fl.Box){e=r;break}t+=s.width}var n=this.lineEnv.maxMeasure,o=this.curPos-t;if(!(o>=n)){var i=[],a=n-o;for(r=1;r<e;r+=1){var s;if((s=Sp(this.content[r],1)[0]).kind===Fl.Glue)i.push(s);else if(s.kind===Fl.Penalty){var p=Sp(this.content[r-1],1)[0];Nc(p)||i.push(p)}else Nc(s)&&(i=[])}var l=a/i.length;i.forEach((function(e){(e instanceof Ec||e instanceof Ic)&&e.adjustWidth(l)})),this.curPos=n+t}},e.prototype.createTextRuns=function(e){for(var t,r=[],n=[],o=0;o<e.length;o+=1){var i=Sp(e[o],2),a=i[0],s=i[1];s!==t&&(t=s,n=[],r.push({model:t,bgps:n})),n.push(a)}return r},e.prototype.getTailGlueInfo=function(e){for(var t={tailGlueCount:0,tailGlueWidth:0},r=e.length-1;r>=0;r-=1){var n=Sp(e[r],1)[0];if(!kc(n))return t;t.tailGlueCount+=1,t.tailGlueWidth+=n.width}return t},e.prototype.createBreakLine=function(){var e=this.lineEnv,t=e.isJustify,r=e.isNowrap;!t||r||this.isLastLine||this.justifyAlign();var n,o=this.content.filter((function(e){return!(e[0].kind===Fl.Penalty)})),i=o.length,a=this.getTailGlueInfo(o),s=a.tailGlueCount,p=a.tailGlueWidth,l=this.createTextRuns(o),c=i-s,u=i>0&&o[i-1][0],h=u&&((n=u).kind===Fl.Box&&n.type===wc.PageBreak);return{content:o,textRuns:l,measure:this.curPos,tailGlueStart:c,tailGlueWidth:p,isPageBreak:h}},e}(),Qc=function(){function e(){this.defaultTextStyle=new wt}return e.prototype.setDefaultTextStyle=function(e){this.defaultTextStyle=e},e.prototype.shapeToken=function(e,t){return this.measureToken(e,t)},e}(),$c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return vp(t,e),t.prototype.measureToken=function(e,t){var r=t||this.defaultTextStyle,n=wl.getDefaultEngine().measureAttributedText(e,r);return{width:n.width,height:n.height,ascent:.8*n.height,descent:n.height*(1-.8)}},t}(Qc),eu=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}vp(t,e),t.prototype.measureToken=function(e,t){var o=1.2*r.twipsToPt(t.fontSize||ot.fontSize),i=new n.UString(e);return{width:r.twipsToPt(t.fontSize||ot.fontSize)*i.graphemeCount(),height:o,ascent:.8*o,descent:o*(1-.8)}}}(Qc),function(){function e(e,t,r,n){this.env=e,this.node=t,this.box=r.curBox,this.storyDirty=r.storyDirty,this.allDirty=r.allDirty,this.parent=n,this.nodeEnd=t.getGCPRange().end()}return Object.defineProperty(e.prototype,"curBox",{get:function(){return this.box},enumerable:!0,configurable:!0}),e.prototype.seekBox=function(e){if(!(e>=this.nodeEnd))for(;this.box;){var t=this.env.boxHelper.bp2cp(this.box.firstIndex);if(e===t)return this.box;var r=this.env.boxHelper.bp2cp(this.box.lastIndex);if(r>=0&&e<=r)return this.box;if(r<0&&t>=0&&e<=t)return this.box;this.box=Il.getNextBox(this.box)}},e}()),tu=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return vp(t,e),t.prototype.clearContent=function(){e.prototype.clearContent.call(this),this._ellipsisBox=void 0},t.prototype.typesetBGPs=function(e){return this.lineEnv.ellipsize===Mc.end?this.handleEllipsisEnd(e):this.handleEllipsisNone(e)},t.prototype.handleEllipsisEnd=function(e){var t=Sp(e[e.length-1],2),r=t[0],n=t[1];if(this._ellipsisBox){var o=this._ellipsisBox.range;return this._ellipsisBox.range=o.unionRange(n.getGCPRange()),!1}var i=e.reduce((function(e,t){return e+t[0].width}),0);if(!this.isOver(i))return this.addBGPs(e,i),!1;if(r.kind===Fl.Penalty)return!1;var a=n.getProperty()||new wt,s=this.context.shaper.shapeToken(ot.ellipsis,a),p=this.restMeasure-s.width,l=Sp(this.context.splitBGPs(e,p),2),c=l[0],u=l[1],h=c.reduce((function(e,t){return e+t[0].width}),0);if(this.addBGPs(c,h),u.length>0){o=this.getRange(u);var f=Oc.makeBox(s.width,o);f.text=ot.ellipsis,f.glyph=s,this._ellipsisBox=f,this.addBGPs([[f,n]],s.width)}return!1},t.prototype.handleEllipsisNone=function(e){var t=e.reduce((function(e,t){return e+t[0].width}),0);return this.addBGPs(e,t),!1},t.prototype.getRange=function(e){var t,r,n=null===(t=e[0][0].range)||void 0===t?void 0:t.begin(),o=null===(r=e[e.length-1][0].range)||void 0===r?void 0:r.end();return void 0!==n&&void 0!==o?new ne(n,o-n):new ne},t}(Zc),ru=function(){function e(e){this.allBGPs=[],this.curIndex=0,this.commitIndex=0,this.savedIndex=0,this._iterator=e}return e.prototype.setLastBGPs=function(e){this.lastOverBGPs=e},e.prototype.commit=function(){this.commitIndex=this.curIndex,this.commitOverBGPs=this.lastOverBGPs},e.prototype.rollback=function(){this.savedIndex=this.curIndex,this.savedOverBGPs=this.lastOverBGPs,this.curIndex=this.commitIndex,this.lastOverBGPs=this.commitOverBGPs},e.prototype.fastForward=function(){this.curIndex=this.savedIndex,this.lastOverBGPs=this.savedOverBGPs},e.prototype.hasNext=function(){return!!this.lastOverBGPs||this.curIndex<this.allBGPs.length},e.prototype.nextBGP=function(){if(this.curIndex>=this.allBGPs.length)for(var e=this._iterator.next(),t=(null==e?void 0:e.value)||[],r=0;r<t.length;r++)this.allBGPs.push(t[r]);if(this.curIndex<this.allBGPs.length){var n=this.allBGPs[this.curIndex];return this.curIndex+=1,n}},e.prototype.getNext=function(){if(this.lastOverBGPs){var e=this.lastOverBGPs;return this.lastOverBGPs=void 0,e}var t=this.nextBGP();if(!t)return[];var r=[t],n=Sp(t,1)[0];if(n.kind!==Fl.Penalty)for(var o=this.nextBGP();o;){if(o[0].kind!==n.kind){this.curIndex-=1;break}r.push(o),o=this.nextBGP()}return r},e.prototype.recycle=function(){this.hasNext()||this.allBGPs.forEach((function(e){Sp(e,1)[0].recycle()}))},e}(),nu=function(e){function t(t,r,n){var o=e.call(this,t,r)||this;return o._curLineCount=0,o._savedLineCount=0,o.lineEnv=n,o.boxEnv=n.boxEnv,o.reflowContext=o.createReflowContext(n.reflowContext),o.measurerMgr=new Jc(o),o._shaper=new $c,o._processor=new Kc(r.textStream,o._shaper),o._splitter=new Gc(o._shaper),o.store=new ru(o.createIterator()),o._breakOpportunity=o.initBreakOpportunity(),o.container=o.createContainer(),o.seek(),o}return vp(t,e),t.prototype.initBreakOpportunity=function(){if(!this.lineEnv.isNowrap)return function(e){for(var t=[],r=e.getTextContent(),o=e.getTextRange().begin(),i={lineBreak:n.LineBreakOption.Normal,wordBreak:n.WordBreakOption.Normal,forbidClasses:[n.LineBreakClass.Ex,n.LineBreakClass.Sy]},a=new Hp(r,i),s=a.next();null!==s;)s.position+=o,t.push(s),s=a.next();return t}(this.node)},t.prototype.createContainer=function(){return this.lineEnv.isNowrap?new tu(this,this.lineEnv):new Zc(this,this.lineEnv)},t.prototype.seek=function(){this.nextNode=this.node.getBeginChild()||void 0},t.prototype.createReflowContext=function(e){if(e&&e&&e.curBox instanceof Jp){var t={curBox:e.curBox.firstChild,storyDirty:e.storyDirty,allDirty:e.allDirty};return new eu(this.env,this.node,t,e)}},t.prototype.backOverBGPs=function(e){this.store.setLastBGPs(e)},t.prototype.measureObject=function(e,t){var r={measure:this.lineEnv.maxMeasure,extent:this.lineEnv.maxExtent};this.measurerMgr.doMeasure(e,t,r)},t.prototype.splitBGPs=function(e,t){var r=t||this.lineEnv.maxMeasure;return this._splitter.split(e,r)},t.prototype.pushBGPs=function(e){return this.container.typesetBGPs(e)},t.prototype.hasNext=function(){return this.status!==Ll.Abort&&this.status!==Ll.Pause&&(!!this.nextNode||this.store.hasNext())},t.prototype.getNext=function(){for(var e=[];this.hasNext();){var t=this.store.getNext();if(!t||t.length<1)break;if(this.pushBGPs(t)){e=this.reduceBreakLine();break}}return e.length<1&&(e=this.reduceBreakLine()),e.length>0?{done:!1,value:e}:{done:!0,value:[]}},t.prototype.createIterator=function(){var e,t;return Tp(this,(function(r){switch(r.label){case 0:e=function(){var e,r;return Tp(this,(function(n){switch(n.label){case 0:return e=t.nextNode,r=t._processor.process(e,t._breakOpportunity),t.nextNode=e.getNextSibling()||void 0,[4,r.map((function(t){return[t,e]}))];case 1:return n.sent(),[2]}}))},t=this,r.label=1;case 1:return this.nextNode?[5,e()]:[3,3];case 2:return r.sent(),[3,1];case 3:return[2]}}))},t.prototype.commit=function(){this.store.commit(),this._savedLineCount=this._curLineCount},t.prototype.rollback=function(){this.store.rollback(),this._curLineCount=this._savedLineCount},t.prototype.fastForward=function(){this.store.fastForward(),this._curLineCount+=1},t.prototype.reduceBreakLine=function(){if(this.container.isEmpty())return[];var e=this.container.createBreakLine();return this.container.clearContent(),this._curLineCount+=1,[e]},t.prototype.isFirstLine=function(){return 0===this._curLineCount},Object.defineProperty(t.prototype,"shaper",{get:function(){return this._shaper},enumerable:!0,configurable:!0}),t.prototype.onDestroy=function(){this.store.recycle()},t}(Ml);!function(e){e[e.none=0]="none",e[e.end=1]="end"}(Mc||(Mc={}));var ou,iu=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return vp(t,e),t.prototype.isSpacedEnding=function(e){var t=e.codePointAt(e.length-1);if(void 0!==t&&"Common"===n.getScript(t)){var r=n.getEastAsianWidth(t);return"W"===r||"F"===r||"A"===r}return!1},t.prototype.calcMarkWidth=function(e,t,r){var n=t-r;if(n>(this.isSpacedEnding(e)?this.firstCharFont/4:-this.firstCharFont/4)){var o=this.firstCharFont/2;return n>0?r+Math.ceil((t-r)/o)*o:r+o}return r},t.prototype.checkNumbering=function(e){var t=this.context.boxEnv.paraStyle;if(e&&t instanceof Ro){var r=t.measureText||t.actualText,n=t.listMarkerSpanProp||new wt,o=this.context.shaper.shapeToken(r,n);t.isNumbered||n.fontFamily||(o.width=n.fontSize);var i=0!==this.specialIndent?Math.abs(this.specialIndent):Math.abs(ot.listDefaultHanging*this.firstCharFont);return{width:this.calcMarkWidth(r,o.width,i),text:t.actualText,textSpan:n,textGlyph:o}}},t.prototype.createListMark=function(e){var t=e.textGlyph.width,r=e.textGlyph.height,n=new ll({measure:t,extent:r});return n.text=e.text,n.glyph=e.textGlyph,n.textStyle=e.textSpan,n.logicEdge=Np.obtain(),n.logicEdge.padding=new Ip({before:0,after:0,start:0,end:e.width-t}),n},t.prototype.updateForNewLine=function(t){e.prototype.updateForNewLine.call(this,t);var r=this.checkNumbering(t);r?(this.maxContentMeasure=this.maxContentMeasure-r.width,this.listMarkBox=this.createListMark(r)):this.listMarkBox=void 0},t.prototype.computeMetric=function(){var t;if(this.listMarkBox){var r=this.listMarkBox,n=r.ascent,o=r.descent,i=jp(this.listMarkBox);t={fontAscent:n,fontDescent:o,lineAscent:n+i.before,lineDescent:o+i.after}}return e.prototype.computeMetric.call(this,t)},t.prototype.computeLinePadding=function(t,r){var n=e.prototype.computeLinePadding.call(this,t,r);return this.listMarkBox&&(n+=this.listMarkBox.totalMeasure),n},t.prototype.newLineBox=function(t){if(this.listMarkBox){var r=new Zp(t);return r.listMark=this.listMarkBox,this.listMarkBox.lineBox=r,r}return e.prototype.newLineBox.call(this,t)},t}(Rc),au=function(t){function n(e,r,n){var o=t.call(this,e,r)||this;return o._typesetted=!1,o._firstValidCharGcp=-1,o.defineChar=[uo.PageBreak],o.parent=n,o.reflowContext=n.reflowContext,o.boxEnv=new Dl(e,n.boxEnv),o.nodeBegin=e.getGCPRange().begin(),o.nodeEnd=e.getGCPRange().end(),o._curLayoutCPs=o.initCurLayoutCPs(),o._textContext=new nu(o.node,o.env,o),o.shaper=o._textContext.shaper,o._lineIterator=o.createLineIterator(),o.container=o.createContainer(),o}return vp(n,t),Object.defineProperty(n.prototype,"isJustify",{get:function(){return this.boxEnv.paraStyle.textAlignment===e.TextAlignmentType.Justify},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isNowrap",{get:function(){return this.boxEnv.getWhiteSpaceType()===e.WhiteSpaceType.Nowrap},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"maxMeasure",{get:function(){return this.container.maxContentMeasure},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"maxExtent",{get:function(){return this.container.getRootExtent()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"nextOffsets",{get:function(){var e=this,t=this._curLayoutCPs.map((function(t){return t.last-e.nodeBegin+1}));return t.length>0?t:[0]},enumerable:!0,configurable:!0}),n.prototype.isNextFirstLine=function(){return this._textContext.isFirstLine()&&this.node.isFirstChild()},n.prototype.createContainer=function(){return this.boxEnv.paraStyle instanceof Ro?new iu(this):new Rc(this)},n.prototype.initCurLayoutCPs=function(){var e=this.node.getTextRange().begin();return[{first:e,last:e-1}]},n.prototype.typesetText=function(){this._typesetted||(this._typesetted=!0,this.parent.reflowContext=void 0)},n.prototype.mergeBox=function(e){this._lastMergedBox=e,this.env.boxHelper.mergeBox(e,this._curLayoutCPs),El.LOG&&r.Logger.log("layout|noreuse "+e.name+" box: "+e.uuid)},n.prototype.canReuse=function(){return!!this._lastSavedBox},n.prototype.reuseLine=function(){if(this.canReuse()){var e=this._lastSavedBox;return this._lastSavedBox=void 0,e}},n.prototype.hasNext=function(){return this.status!==Ll.Abort&&this.status!==Ll.Pause&&(this.typesetText(),!!this.canReuse()||this._textContext.hasNext())},n.prototype.getNext=function(){var e=this.reuseLine();if(!e){var t=this._lineIterator.next();e=null==t?void 0:t.value}if(!e)return{done:!0,value:[]};this.mergeBox(e);var r=[new _l(e)];return e.isPageBreak&&this.env.isPageMode&&r.push(new _l(Pl())),{done:!1,value:r}},n.prototype.createEmptyBox=function(e){var t=this.env.textStream,r=new Cc;return r.firstIndex=t.getIndexFromGCP(e.begin()),r.lastIndex=t.getIndexFromGCP(e.end()-1),r},n.prototype.getfirstValidCharGcp=function(){var e,t;if(this.boxEnv.paraStyle instanceof Ro&&-1===this._firstValidCharGcp){var r=this.parent.node.getGCPRange(),n=this.parent.node.getTextContent(),o=0;try{for(var i=_p(n),a=i.next();!a.done;a=i.next()){var s=a.value;if(!this.defineChar.includes(s)){this._firstValidCharGcp=r.begin()+o;break}o+=1}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}}},n.prototype.createFieldBox=function(e,t){return t.box?t.box:(r.Logger.error("Field BGP.box empty!"),this.createEmptyBox(e.getGCPRange()))},n.prototype.createEmbedBox=function(e,t){var n=this.env.textStream;if(!t.range)return r.Logger.error("Embed BGP.range empty"),this.createEmptyBox(e.getGCPRange());var o,i=new Dl(e,this.parent.boxEnv);if(t.box)o=t.box;else{var a={measure:t.width,extent:t.height};o=Hc.create(e.getProperty(),a)}return o.glyph=t.glyph,o.textStyle=i.textStyle,o.property=e.getProperty()||void 0,o.firstIndex=n.getIndexFromGCP(t.range.begin()),o.lastIndex=n.getIndexFromGCP(t.range.end()-1),o.indexPairs.push({first:o.firstIndex,last:o.lastIndex}),o},n.prototype.createTextBoxes=function(t,n,o){for(var i,a=new Dl(t,this.parent.boxEnv),s=this.env.textStream,p=[],l=function(t){var r=t||i;if(r&&r.range){var n,o=r.width,l=r.glyph&&r.glyph.height||0;r instanceof Ic?(n=new ol({measure:o,extent:l})).text=r.text||"":r instanceof Ec?(n=ul(r.text||"",{measure:o,extent:l}),0!==r.widthAdj&&(n.display=e.LayoutDisplay.InlineBlock)):(n=ul(r.text,{measure:o,extent:l}),i=void 0),n.glyph=r.glyph,n.textStyle=a.textStyle,n.firstIndex=s.getIndexFromGCP(r.range.begin()),n.lastIndex=s.getIndexFromGCP(r.range.end()-1),n.indexPairs.push({first:n.firstIndex,last:n.lastIndex}),p.push(n)}},c=function(t,n){if(t.range)if(i){i.text+=t.text||"",i.width+=t.width,i.range=i.range.unionRange(t.range);var o=i.glyph?i.glyph.height:0;(t.glyph?t.glyph.height:0)>o&&(i.glyph=t.glyph)}else i={type:n?e.TextType.Normal:e.TextType.TailGlue,text:t.text||"",width:t.width,range:t.range,glyph:t.glyph};else r.Logger.error("typeset range empty")},u=0;u<n.length;u++){var h=n[u];if(h.kind===Fl.Box)h.type===wc.Tabstop||0!==h.widthAdj?(l(),l(h)):c(h);else if(h.kind===Fl.Glue){if(u<o&&0!==h.widthAdj)l(),l(h);else c(h,u>=o)}}return l(),p},n.prototype.createLineChild=function(e,t,r){return t.length<=0?[]:e instanceof rp||e instanceof op?[this.createEmbedBox(e,t[0])]:e instanceof ap?[this.createFieldBox(e,t[0])]:e instanceof np?this.createTextBoxes(e,t,r):[]},n.prototype.isListLine=function(){return this._firstValidCharGcp===this._curLayoutCPs[0].last+1},n.prototype.createLineIterator=function(){var e,t,r,n=this;return Tp(this,(function(o){switch(o.label){case 0:this.getfirstValidCharGcp(),e=function(){var e,r,o,i,a,s,p;return Tp(this,(function(l){switch(l.label){case 0:return e=t.isNextFirstLine(),t.container.updateForNewLine(e),(r=t._textContext.getNext()).done||r.value.length<1?[2,{value:void 0}]:(o=!t._textContext.hasNext(),i=Sp(r.value,1),a=i[0],s=0,a.textRuns.forEach((function(e){var t=e.model,r=e.bgps,o=Math.max(a.tailGlueStart-s,0),i=n.createLineChild(t,r,o);n.container.pushBox(i),s+=r.length})),p=t.container.createLineBox(a,e,o),t.container.clearContent(),[4,p]);case 1:return l.sent(),[2]}}))},t=this,o.label=1;case 1:return this._textContext.hasNext()?[5,e()]:[3,3];case 2:return"object"==typeof(r=o.sent())?[2,r.value]:[3,1];case 3:return[2]}}))},n.prototype.commit=function(){},n.prototype.rollback=function(){this._lastMergedBox&&(this.env.boxHelper.unmergeBox(this._lastMergedBox,this._curLayoutCPs),this._lastSavedBox=this._lastMergedBox)},n.prototype.onDestroy=function(){this._textContext.onDestroy()},n}(Ml),su=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return vp(t,e),t.prototype.createIterator=function(){var e;return Tp(this,(function(t){switch(t.label){case 0:return this.context.hasNext()?(e=this.context.getNext()).value&&e.value.length>0?[4,e.value]:[3,2]:[3,3];case 1:t.sent(),t.label=2;case 2:return[3,0];case 3:return[2]}}))},t}(Kl),pu=function(){function t(){}return t.prototype.createGenerator=function(t,r){switch(r.getType()){case e.LayoutInputNodeType.Section:var n=new pc(r,t.env,t);return new lc(n);case e.LayoutInputNodeType.Paragraph:n=new ac(r,t.env,t);return new nc(n);case e.LayoutInputNodeType.TextGroup:n=new au(r,t.env,t);return new su(n);case e.LayoutInputNodeType.Table:n=new vc(r,t.env,t);return new xc(n);case e.LayoutInputNodeType.TableRow:n=new dc(r,t.env,t);return new gc(n);case e.LayoutInputNodeType.TableCell:n=new mc(r,t.env,t);return new uc(n);default:n=new Bc(r,t.env,t);return new _c(n)}},t}(),lu=function(){function e(e){this.textStream=e,this._bp2cpCache=new Map}return e.prototype.evictCache=function(){this._bp2cpCache.clear()},e.prototype.bp2cp=function(e){var t=this._bp2cpCache.get(e);return void 0===t&&(t=this.textStream.getGCPFromIndex(e),this._bp2cpCache.set(e,t)),t},e.prototype.getGCPTuple=function(e){return[this.bp2cp(e.first),this.bp2cp(e.last)]},e.prototype.getGCPPair=function(e){return{first:this.bp2cp(e.first),last:this.bp2cp(e.last)}},e.prototype.getGCPPairs=function(e){var t,r=this;return(t=e instanceof Dp?e.indexPairs:e)&&0!==t.length?t.map((function(e){return r.getGCPPair(e)})):[]},e.prototype.getGCPRanges=function(e){var t,r=this;t=e instanceof Dp?e.indexPairs:e;var n=[];return t&&0!==t.length?(t.forEach((function(e){var t=r.bp2cp(e.first),o=r.bp2cp(e.last)+1;n.push(new ne(t,o-t))})),n):n},e.prototype.mergeBox=function(e,t){var r=this.getGCPPairs(e.indexPairs);this.mergeGCP(r,t)},e.prototype.unmergeBox=function(e,t){var r=this.getGCPPairs(e.indexPairs);this.unmergeGCP(t,r)},e.prototype.unmergeGCP=function(e,t){if(!(!e||e.length<=0||!t||t.length<=0)){var r,n=0;t.forEach((function(t){do{if(!((r=e[n]).last+1<t.first))break;n++}while(n<e.length);if(t.first<=r.first&&t.last>=r.last)e.splice(n,1);else if(t.first===r.first)r.first=t.last+1;else if(t.last===r.last)r.last=t.first-1;else if(t.first>r.first&&t.last<r.last){var o={first:t.last+1,last:r.last};r.last=t.first-1,e.splice(++n,0,o)}}))}},e.prototype.mergeGCP=function(e,t){if(e&&!(e.length<=0))if(0!==t.length)for(var r=0,n=0;r<e.length;){var o=e[r++],i=void 0;do{if(!((i=t[n]).last+1<o.first))break;n++}while(n<t.length);if(n>=t.length)t.push(o);else if(i.first<=o.last+1&&o.first<=i.last+1){i.first=Math.min(o.first,i.first),i.last=Math.max(o.last,i.last);for(var a=0,s=n+1;s<t.length;s++){var p=t[s];if(!(i.last+1>=p.first))break;i.last=Math.max(i.last,p.last),a+=1}a>0&&t.splice(n+1,a)}else o.last+1<i.first?t.splice(n++,0,o):i.last+1<o.first&&t.splice(++n,0,o)}else t.push.apply(t,Cp(e))},e.prototype.mergeIndex=function(e,t){if(e&&!(e.length<=0)){var n=e.map((function(e){return xp({},e)}));if(0!==t.length)for(var o=0,i=0;o<n.length;){var a=n[o++],s=this.getGCPPair(a),p=void 0,l=void 0;do{if(p=t[i],!((l=this.getGCPPair(p)).last+1<s.first))break;i++}while(i<t.length);if(i>=t.length)t.push(a);else if(l.first<=s.last+1&&s.first<=l.last+1){s.first<l.first&&(l.first=s.first,p.first=a.first),s.last>l.last&&(l.last=s.last,p.last=a.last);for(var c=0,u=i+1;u<t.length;u++){var h=t[u],f=this.getGCPPair(h);if(!(l.last+1>=f.first))break;f.last>l.last?(l.last=f.last,p.last=h.last):r.Logger.warn("layout|merge["+l.first+","+l.last+"]["+f.first+","+f.last+"]"),c+=1}c>0&&t.splice(i+1,c)}else s.last+1<l.first?t.splice(i++,0,a):l.last+1<s.first&&t.splice(++i,0,a)}else t.push.apply(t,Cp(n))}},e.prototype.isBoxInEnd=function(e,t){var r=e.indexPairs,n=r[r.length-1].last;return t===this.bp2cp(n)+1},e.prototype.printRanges=function(e){if(El.LOG){var t=this.getGCPPairs(e.indexPairs),n="layout|"+e.name+":";t.forEach((function(e){n+="["+e.first+","+e.last+"]"})),r.Logger.log(n)}},e}(),cu=function(){function e(){this._reuseIdMap=new Map,this._totalReuseTextLine=0}return e.prototype.reset=function(){this._reuseIdMap.clear(),this._totalReuseTextLine=0},e.prototype.markReuse=function(e){this._reuseIdMap.set(e.uuid,!0)},e.prototype.addReuseBox=function(e){this._totalReuseTextLine+=this.countTextLine(e)},e.prototype.removeReuseBox=function(e){this._totalReuseTextLine-=this.countTextLine(e)},e.prototype.getTotalReuseTextLine=function(){return this._totalReuseTextLine},e.prototype.countTextLine=function(e){var t=this;if(e instanceof Jp)return 1;if(e instanceof Xp)return e.children.length;if(Fp(e)){var r=e.children.reduce((function(e,r){return e+t.countTextLine(r)}),0);return e instanceof Vp&&(r+=this.countTextLine(e.headerPage),r+=this.countTextLine(e.footerPage)),r}return 0},e.prototype.checkReused=function(e){return!!this._reuseIdMap.get(e.uuid)},e}(),uu=function(){function t(e){this.map=new Map,this.hfArray=[],this.textStream=e}return t.prototype.clear=function(){this.map.clear(),this.hfArray.splice(0,this.hfArray.length)},t.prototype.setBox=function(e,t){this.map.set(e,t)},t.prototype.removeBox=function(e){this.map.delete(e)},t.prototype.getBoxById=function(e){return this.map.get(e)},t.prototype.getBoxByRange=function(t){if(t&&!t.isNull()){var r=this.textStream.findStoryInfoFromGcp(t.begin());if(r&&r.storyProp){var n=r.storyProp;return n.storyId===e.StoryID.MainDocId||Eo.isListTemplateStory(n.storyId)?void 0:this.getBoxById(n.storyId)}}},t.prototype.addHeaderFooter=function(e){this.hfArray.push(e)},t.prototype.getHeaderFooterIds=function(){return this.hfArray},Object.defineProperty(t.prototype,"storyNumber",{get:function(){return this.map.size},enumerable:!0,configurable:!0}),t.prototype.readStoryBox=function(e){this.map.forEach(e)},t}(),hu=function(){function e(e){this.pageNum=0,this.sectionNum=0,this.pageStart=ot.section.pageStartAt,this.env=e}return e.prototype.incPage=function(){this.env.isPageMode?this.pageNum+=1:this.pageNum=1},e.prototype.incSection=function(){this.env.isPageMode?this.sectionNum+=1:this.sectionNum=1},e.prototype.setPageStart=function(e){this.pageStart=e},e.prototype.reset=function(){this.pageNum=0,this.sectionNum=0},e}(),fu=function(){function t(e){this._fieldTypeMap=new Map,this._boxMap=new Map,this._boxArray=[],this._env=e,this._counter=new hu(e),this._fieldTypeMap.set("PAGE",Up)}return Object.defineProperty(t.prototype,"counter",{get:function(){return this._counter},enumerable:!0,configurable:!0}),t.prototype.addBox=function(e){this._boxArray.push(e)},t.prototype.clearDirty=function(){var e=new Map;this._boxMap.forEach((function(t,r){if(t&&t.length>0){var n=[];t.forEach((function(e){for(var t=e;t&&!t.isSelfDirty();)t=t.parentBox;t||n.push(e)})),n.length>0&&e.set(r,n)}})),this._boxMap=e},t.prototype.updateMap=function(){var e=this;this._boxArray.length>0&&(this._boxArray.forEach((function(t){var r=t.fieldInfo.fieldCode,n=Fo.getInstance().getFieldcodeInfo(r).fieldName,o=e._fieldTypeMap.get(n);if(o){for(var i=t.parentBox;i&&!(i instanceof o);)i=i.parentBox;if(i){var a=e._boxMap.get(i.uuid);a||(a=[]),a.push(t),e._boxMap.set(i.uuid,a)}}})),this._boxArray.splice(0,this._boxArray.length))},t.prototype.checkFieldBoxForUpdate=function(e){var t=this,r=this._boxMap.get(e);r&&r.length>0&&r.forEach((function(e){t.checkContextDiff(e)}))},t.prototype.updateFieldBoxWithPageCount=function(t){var r=!1;return this._boxMap.forEach((function(n){n&&n.length>0&&n.forEach((function(n){if(n.fieldInfo&&n.fieldContext&&(n.fieldInfo.requiredContext.indexOf(e.FieldcodeLayoutContextKey.PAGE_COUNT)>=0&&n.fieldContext.pageCount!==t&&(n.needUpdate=!0,n.fieldContext.pageCount=t),n.needUpdate)){var o=Fo.getInstance().parse(n.fieldInfo.fieldCode,n.fieldContext).result,i=-1,a=n.children.find((function(e,t){return!(e instanceof sl)&&e instanceof nl&&(i=t,!0)}));a instanceof nl&&i>=0&&(a.text=o),r=!0}}))})),r},t.prototype.checkContextDiff=function(t){var r=this;t.fieldInfo&&t.fieldContext&&t.fieldInfo.requiredContext.forEach((function(n){switch(n){case e.FieldcodeLayoutContextKey.PAGE:t.fieldContext.page!==r._counter.pageNum&&(t.needUpdate=!0,t.fieldContext.page=r._counter.pageNum);break;case e.FieldcodeLayoutContextKey.SECTION:t.fieldContext.section!==r._counter.sectionNum&&(t.needUpdate=!0,t.fieldContext.section=r._counter.sectionNum);break;case e.FieldcodeLayoutContextKey.PAGE_START:t.fieldContext.pageStart!==r._counter.pageStart&&(t.needUpdate=!0,t.fieldContext.pageStart=r._counter.pageStart)}}))},t}(),du=function(){function t(e,t){this.isFinished=!0,this.isReflow=!1,this.context=e,this.dataEngine=t,this.factory=new pu,this.boxHelper=new lu(this.textStream),this.reflowState=new cu,this.storyCache=new $l,this.storyBoxMgr=new uu(this.textStream),this.fieldBoxMgr=new fu(this)}return Object.defineProperty(t.prototype,"docEnv",{get:function(){return this.context.docEnv},enumerable:!0,configurable:!0}),t.prototype.onModelChanged=function(t){this.context.on(e.StateNotification.ModelChange,(function(e){t(e)}))},t.prototype.reset=function(){this.clearOnReflow(),this.storyBoxMgr.clear(),this.isFinished=!1},t.prototype.clearOnReflow=function(){this.boxHelper.evictCache(),this.reflowState.reset(),this.storyCache.clear(),this.fieldBoxMgr.counter.reset()},Object.defineProperty(t.prototype,"isPageMode",{get:function(){return this.docEnv.layoutType===e.LayoutType.Paged},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isPresentation",{get:function(){return this.docEnv.isPresentationState},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textStream",{get:function(){return this.dataEngine.getTextStream()},enumerable:!0,configurable:!0}),t.emptyEnv=function(){var r=new Ua;return r.docEnv.layoutType=e.LayoutType.Paged,new t(r,Wo.createCoreDataEngine())},t}();(ou=e.LayoutNotification||(e.LayoutNotification={})).LayoutChanged="layoutChanged",ou.LayoutFinished="layoutFinished";var gu=function(t){function r(){return t.call(this,e.LayoutNotification.LayoutChanged)||this}return vp(r,t),r}(r.Notification),yu=function(t){function r(){return t.call(this,e.LayoutNotification.LayoutFinished)||this}return vp(r,t),r}(r.Notification),mu=function(){function t(t,r){var n=this;this._isReflowing=!1,this._docBox=new Gp,this.env=new du(t,r),this.env.onModelChanged((function(t){var r=t.changeData.dirtyRangeMap;if(r&&r.size>0&&!n.env.isPresentation){var o=r.get(e.StoryID.MainDocId);o||(o=new fa([ne.invalidRange()])),El.LOG&&n.logDirtyRange(r),n.reflow(o,r)}}))}return t.prototype.logDirtyRange=function(e){var t="";e.forEach((function(e,r){t+=r,e.values.forEach((function(e){t+="["+e.begin()+","+e.end()+")"}))})),r.Logger.debug("layout|onModelChanged "+t)},t.prototype.reflow=function(t,n){var o;r.PerfUtil.mark("beforeReflow"),this.env.clearOnReflow(),this._docBox&&this._docBox.firstChild&&(o={curBox:this._docBox.firstChild,storyDirty:t,allDirty:n}),this._layoutEngine=this.createLayoutEngine(o),this._isReflowing=!0,this.realLayout(0,!0),r.PerfUtil.mark("afterReflow");var i=r.PerfUtil.measure("beforeReflow","afterReflow")-r.PerfUtil.measure("beforeRender","afterRender"),a="perf|layout reflow:"+i+"ms";if(i>1e3?r.Logger.warn(a):(El.COST||i>30)&&r.Logger.log(a),this.env.context.perfHandler.costTime[e.EditMetric.Reflow]=i,El.COST){var s=this.env.reflowState,p=s.getTotalReuseTextLine(),l=s.countTextLine(this._docBox);r.Logger.log("layout|reflow total reuse line: "+p+", total line: "+l+", reuse rate: "+p/l*100+"%")}},t.prototype.createLayoutEngine=function(e){return this.env.isPageMode?new tc(this.env,e):new rc(this.env,e)},t.prototype.onLayoutChanged=function(){this.onLayoutCallback&&this.onLayoutCallback(),this.env.context.fire(new gu)},t.prototype.onLayoutFinished=function(){this.env.boxHelper.printRanges(this.getLayoutBox()),this.env.context.fire(new yu)},t.prototype.onBoxDirty=function(e){if(e instanceof dl){var t=this.env.storyBoxMgr,r=t.getBoxById(e.storyId);r&&r.uuid===e.uuid&&t.removeBox(e.storyId)}},t.prototype.realLayout=function(e,t){var n=this;if(!this._layoutEngine)return!0;var o,i=t?new Gp:void 0,a=function(){if(!t)return!1;var e=n._docBox.indexPairs,r=n.env.boxHelper.getGCPPair(e[e.length-1]),o=i.indexPairs;return n.env.boxHelper.getGCPPair(o[o.length-1]).last>r.last},s=e&&e>0?e:Number.MAX_SAFE_INTEGER,p=this._docBox.uuid;this.env.isReflow=!!t;do{var l=r.PerfUtil.now();if((o=this._layoutEngine.getNext()).done)break;El.COST&&r.Logger.log("layout|logicPage:"+(r.PerfUtil.now()-l)+" ms");var c=o.value,u=t?i:this._docBox;this.env.isPageMode||u.clearChildren(),u.append(this.env,c),s-=1}while(!o.done&&s>0&&!a());t&&(this._docBox.markAllDirty((function(e){n.onBoxDirty(e)})),this._docBox.recycle(),this._docBox=i,this._isReflowing=!1),r.PerfUtil.mark("beforeRender"),p!==this._docBox.uuid&&this.onLayoutChanged(),r.PerfUtil.mark("afterRender"),this.env.fieldBoxMgr.clearDirty(),this.env.fieldBoxMgr.updateMap(),this.env.fieldBoxMgr.updateFieldBoxWithPageCount(this.env.fieldBoxMgr.counter.pageNum)&&this.env.context.fire(new Ko);var h=!!o.done;return this.env.isFinished=h,h&&this.onLayoutFinished(),h},t.prototype.reset=function(){r.Logger.info("layout|reset paged="+this.env.isPageMode),this._layoutEngine=this.createLayoutEngine(),this._docBox.markDirty(),this._docBox=new Gp,this.env.reset()},t.prototype.doLayout=function(t){r.PerfUtil.mark("beforeLayout"),this.boxHelper.evictCache();var n=this.realLayout(t,!1);r.PerfUtil.mark("afterLayout");var o=r.PerfUtil.measure("beforeLayout","afterLayout")-r.PerfUtil.measure("beforeRender","afterRender");if(r.Logger.log("perf|layout page:"+t+",cost:"+o+"ms"),!n){var i=this.env.context.perfHandler,a=i.costTime[e.EditMetric.Layout];i.costTime[e.EditMetric.Layout]=Math.max(o,a)}return n},t.prototype.onLayoutChange=function(e){this.onLayoutCallback=e},t.prototype.getLayoutBox=function(){return this._docBox},t.prototype.getLayoutState=function(){return{pageCount:this._docBox.children.length,isFinished:this.env.isFinished,isReflowing:this._isReflowing}},Object.defineProperty(t.prototype,"layoutFinished",{get:function(){return this.env.isFinished},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"boxHelper",{get:function(){return this.env.boxHelper},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"storyBoxMgr",{get:function(){return this.env.storyBoxMgr},enumerable:!0,configurable:!0}),t}(),bu=new(function(){function e(){}return e.prototype.measureAttributedText=function(e,t){for(var r=new n.UString(e),o=0,i=0;i<r.graphemeCount();i++){var a=r.graphemeAt(i);"Han"===n.getScript(a.codePoints[0])?o+=t.fontSize:o+=.5*t.fontSize}return{width:o,height:1.3*t.fontSize}},e.prototype.measureChar=function(e,t,n,o){return xp(xp({},this.measureAttributedText(e.substring(n,o),t)),{offsetLeft:r.twipsToPt(t.fontSize||ot.fontSize)*n})},e.prototype.setGlobalStyle=function(e){return!1},e.prototype.clearCache=function(){},e}());function Pu(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a}function vu(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(Pu(arguments[t]));return e}var xu,Tu,_u,Su=function(){function t(e,t,n,o){void 0===n&&(n=!1),void 0===o&&(o=!0),this._gcpRange=null,this._rangeClass=null,this._tableCellGCPRanges=[],this._textStream=e.getTextStream(),this._updateSelection=n,this._updateSelection?this._rangeClass=e.createRangeClass(!0,!1):this._gcpRange=ne.emptyRange(),this._fixRange=o,this._rangeKey=r.StringUtil.generateRandomId(),this._tableCellRange=null,this._setGCPRange(t)}return t.prototype.reset=function(){this._updateSelection?this._rangeClass.removeAll():this._gcpRange=ne.emptyRange(),this._tableCellRange=null},Object.defineProperty(t.prototype,"_range",{get:function(){if(!this._updateSelection)return this._gcpRange.clone();var e=this._rangeClass.getRange(this._rangeKey);return e||ne.emptyRange()},enumerable:!0,configurable:!0}),t.prototype._setGCPRange=function(e){var t=this._fixRange?this.fixToValidRange(e):e;return!(!t.isValid()||!t.notEqual(this._range))&&(this._updateSelection?(this._rangeClass.deleteRange(this._rangeKey),this._rangeClass.insertRange(this._rangeKey,t)):this._gcpRange=t,!0)},Object.defineProperty(t.prototype,"storyInfo",{get:function(){var e=this._textStream.findStoryInfoFromGcp(this._range.begin());return e||{storyProp:new Vt,range:ne.emptyRange()}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gcpRange",{get:function(){return this._range.clone()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"backWard",{get:function(){return!(!this._option||!this._option.backward)&&this._option.backward},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tableCellRange",{get:function(){return this._tableCellRange},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tableCellGCPRanges",{get:function(){return this._tableCellGCPRanges},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tableCellRangeAll",{get:function(){var e=this.tableCellRange;if(e)return e;var t=this.gcpRange,r=this._textStream.tableStream.getTableFullInfoFromGcp(t.begin());if(r&&r.tableCellProp){var n=r.rowIndex,o=r.cellIndex,i=r.tableCellProp;return{tableId:r.tableProp.tableId,cellRange:{from:new Gn(n,o),to:new Gn(n+i.rowSpan-1,o+i.colSpan-1)}}}return null},enumerable:!0,configurable:!0}),t.prototype.setRangeTo=function(e,t){return this._option=t,this._setGCPRange(e)},t.prototype.storyValidRange=function(){return this._storyValidRange(this._range)},t.prototype.fixToValidRange=function(e){var t=e.clone(),r=this._storyValidRange(t);if(0===(t=t.intersectRange(r)).length()&&t.begin()===r.end()&&(t.gcpBegin-=1),0===t.length()){var n=t.begin(),o=this._textStream.tableStream.fixPlaceholderGCP(n);if(o!==n){var i=n>this._range.begin(),a=o>n;t=new ne(i?a?o:n+1:0===n?a?3:o:a?n-1:o,0)}}var s=Jn(this._textStream.tableStream,t),p=s.newRange,l=s.tableCellRange,c=s.tableCellGCPRanges;return this._tableCellRange=l||null,this._tableCellGCPRanges=c?c.reduce((function(e,t){return vu(e,t)}),[]):[],p},t.prototype.fixToValidDeleteRange=function(e){var t=this.fixToValidRange(e),r=this._storyValidRange(t);return t.end()===r.end()&&(t.len-=1),t=this._fixToValidDelCellRange(t)},t.prototype.fixToValidReplaceRange=function(e){if(this._tableCellRange&&this._tableCellGCPRanges.length){var t=this._tableCellGCPRanges[0];return this.fixToValidDeleteRange(ne.inset(t,1))}return this.fixToValidDeleteRange(e)},t.prototype.isCollapse=function(){return 0===this._range.length()},t.prototype.isParaEnd=function(e){var t=this._textStream.createParagraphIterator();t.seek(e);var r=t.getRange();return r.length()>0&&r.end()-1===e},t.prototype._storyValidRange=function(t){var r=this._textStream.findStoryInfoFromGcp(t.begin());if(!r)return ne.emptyRange();var n=r.range;return r.storyProp.storyType===e.StoryType.MainTextStory&&(n.len-=1),n},t.prototype._fixToValidDelCellRange=function(e){if(0===e.length())return e;var t=this._textStream.tableStream.getTableCellInfoFromGcp(e.begin()),r=this._textStream.tableStream.getTableCellInfoFromGcp(e.end()-1),n=this._textStream.tableStream.getTableInfoFromGcp(e.end()+1);return t&&r&&t.range.begin()===r.range.begin()?e.intersectRange(t.deleteRange):n&&n.range.begin()===e.end()+1?new ne(e.begin(),e.length()-1):e},t}(),Cu=function(){function e(e,t){this._context=e,this._textStream=t.getTextStream(),this._coreRange=new Su(t,ne.emptyRange(),!0)}return e.prototype.reset=function(){this._coreRange.reset()},Object.defineProperty(e.prototype,"storyInfo",{get:function(){return this._coreRange.storyInfo},enumerable:!0,configurable:!0}),e.prototype.getCoreRange=function(){return this._coreRange},Object.defineProperty(e.prototype,"gcpRange",{get:function(){return this._coreRange.gcpRange},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"backWard",{get:function(){return this._coreRange.backWard},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tableCellRange",{get:function(){return this._coreRange.tableCellRange},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tableCellRangeAll",{get:function(){return this._coreRange.tableCellRangeAll},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gcpRanges",{get:function(){var e=this._coreRange.tableCellGCPRanges;return e.length>0?e:[this.gcpRange]},enumerable:!0,configurable:!0}),e.prototype.setRangeTo=function(e,t){return this._coreRange.setRangeTo(e,t)},e.prototype.validDeleteRange=function(){return this._coreRange.fixToValidDeleteRange(this._coreRange.gcpRange)},e.prototype.validCompositionDeleteRange=function(){return this._coreRange.fixToValidReplaceRange(this._coreRange.gcpRange)},e.prototype.isCollapse=function(){return this._coreRange.isCollapse()},e}(),Bu=function(){function e(){}return e.validate=function(e){var t=0;return e.operations.every((function(e){return e instanceof Mi?t+=e.param.text.length:(e instanceof Li||e instanceof Oi)&&(t+=e.param.placeholder?e.param.placeholder.length:0),t<8e4})),t<8e4},e}(),Ru=Ia("state"),wu=function(){function t(t){this._fromServer=!1,this._waitingForReflow=!1,this._compositionId="",this._compositionText="",this.context=t,this._dataEngine=Wo.createCoreDataEngine(),this._notificationCenter=this.getTextStream().getNotificationCenter(),this._selection=new Cu(this.context,this._dataEngine),this._compositionGcpClass=this._dataEngine.createGCPClass(!0,!1,e.PosPolicy.Inner),this._compositionLenMap=new Map,this._cusorSpanProp=null,this._listMarkerSpanProp=null,this._containerNeedUpdateCaret=null,this._dirtyRangeClassMap=new Map,this._monitorDataNotification()}return t.prototype._monitorDataNotification=function(){var t=this;this._notificationCenter&&(this._notificationCenter.on(e.TextStreamNotiyType.InsertContainer,(function(e){t.context.fire(new Pa(e.anchorInfos,t._fromServer))})),this._notificationCenter.on(e.TextStreamNotiyType.DeleteContainer,(function(e){t.context.fire(new va(e.anchorInfos,t._fromServer)),e.anchorInfos&&!t._fromServer&&e.anchorInfos.forEach((function(e,r){t._compositionGcpClass.deleteGCP(r)}))})),this._notificationCenter.on(e.TextStreamNotiyType.ModifyContainer,(function(e){t.context.fire(new xa(e.anchorInfos,t._fromServer))})),this._notificationCenter.on(e.FieldNotification.DataFieldInsert,(function(e){t.context.fire(new Go(e.fieldCodes))})),this._notificationCenter.on(e.FieldNotification.DataFieldDelete,(function(e){t.context.fire(new Ho(e.fieldCodes))})),this._notificationCenter.on(e.TextStreamNotiyType.StoryChange,(function(r){var n=t.getTextStream().findStoryInfoFromGcp(r.range.begin());(null==n?void 0:n.storyProp)&&n.storyProp.storyType===e.StoryType.MainTextStory&&t.context.fire(new _a)})))},t.emptyState=function(e){return new t(e)},t.prototype.importDocData=function(e){this._dataEngine.copyFrom(e),this._selection.reset(),this._compositionGcpClass.removeAll(),this._compositionLenMap=new Map,this._cusorSpanProp=null,this._listMarkerSpanProp=null,this._containerNeedUpdateCaret=null},t.prototype.getTextStream=function(){return this._dataEngine.getTextStream()},t.prototype.getRWTextStream=function(){return this._dataEngine.getRWTextStream()},Object.defineProperty(t.prototype,"dataEngine",{get:function(){return this._dataEngine},enumerable:!0,configurable:!0}),t.prototype.delta=function(){return Ti.createLocalDeltaOption(this.selection.gcpRange).buildDelta()},t.prototype.__insertDirtyRange=function(e,t){this._dirtyRangeClass(e).insertRange(r.StringUtil.generateRandomId(),t)},t.prototype._updateDirtyRange=function(t){var r=t.dirtyRange;if(r){var n=this.getTextStream().findStoryInfoFromGcp(r.begin());if(n){if(this.__insertDirtyRange(n.storyProp.storyId,r),n.storyProp.storyType===e.StoryType.TextFrameStory||n.storyProp.storyType===e.StoryType.CodeblockStory){var o=this.dataEngine.getContainerManager();if(o){var i=o.getAnchorRange(n.storyProp.storyId);if(i){var a=this.getTextStream().findStoryInfoFromGcp(i.begin());a&&this.__insertDirtyRange(a.storyProp.storyId,i)}}}if(t&&t instanceof qi&&t.isAllSectDirty()){var s=this.getTextStream().createSectionIterator(r);do{var p=s.getProperty(!0);if(p){var l=p.defaultHeaderRefId&&this.getTextStream().findStoryInfoFromId(p.defaultHeaderRefId);l&&this.__insertDirtyRange(l.storyProp.storyId,l.range);var c=p.defaultFooterRefId&&this.getTextStream().findStoryInfoFromId(p.defaultFooterRefId);c&&this.__insertDirtyRange(c.storyProp.storyId,c.range)}}while(s.next())}}}},t.prototype._dirtyRangeClass=function(e){var t=this._dirtyRangeClassMap.get(e);return t||(t=this._dataEngine.createRangeClass(!0,!1),this._dirtyRangeClassMap.set(e,t)),t},t.prototype._genDirtyRangeMap=function(){var e=new Map;return this._dirtyRangeClassMap.forEach((function(t,r){t.forEachRange((function(t){var n=e.get(r);return n?n.values.push(t.range):n=new fa([t.range]),e.set(r,n),!1}),!0)})),e},t.prototype._newCusorSpan=function(t){var r=null;if(t.operations[0].operationType===e.OperationType.DeleteText&&!t.globalOpts.fromServer&&!t.globalOpts.undoOption.fromUndo&&t.globalOpts.needCollab&&t.globalOpts.updateSelection){var n=t.operations[0],o=this.followSpanProp(n.range.begin(),!0),i=this.currentSpanProp(n.range.begin());o.equalTo(i)||(r=i)}return r},t.prototype._compositingStopApply=function(e){var t,r;if(this.isCompositing()&&!e.globalOpts.fromServer&&!e.globalOpts.undoOption.fromUndo&&e.globalOpts.needCollab){var n=this._compositionGcpClass.getGCP(this._compositionId),o=this._compositionLenMap.get(this._compositionId);if(void 0!==n&&void 0!==o){var i=new ne(n,o);try{for(var a=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e.operations),s=a.next();!s.done;s=a.next()){var p=s.value;if(p instanceof mi&&p.range.intersect(i))return!0}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}}}return!1},t.prototype.applyDelta=function(t){var n=this,o=[r.PerfUtil.now(),0,0,0];if(!(t.operations.length<=0||this._compositingStopApply(t)))if(Bu.validate(t)){t.msg&&r.Logger.info("applyDelta:"+t.msg);var i=this._newCusorSpan(t),a=this._selection.gcpRange;try{t.applyOperations(this._dataEngine.getRWTextStream(),(function(){return n.getExceptionRanges()}),(function(e){n._updateDirtyRange(e)}))}catch(r){g.captureChangesetException(e.MonitorName.CHANGESET_ERROR_APPLY_DELTA,{option:{changesetDataType:t.globalOpts.fromServer?e.ChangesetDataType.APPLY_SERVER_DATA:e.ChangesetDataType.EDIT_DATA}},r)}this._fromServer=t.globalOpts.fromServer,this.dataEngine.getListManager()&&this.dataEngine.getListManager().modifyRenderRange((function(e){var t=n.getTextStream().findStoryInfoFromGcp(e.begin());t&&n.__insertDirtyRange(t.storyProp.storyId,e)}));var s=this._genDirtyRangeMap();if(!t.globalOpts.fromServer&&t.globalOpts.needCollab){var p=this.context.run("modelDidChangeAction",t,s);if(Number.isInteger(p)&&p>0)throw this.revertDelta(t,{msg:"revertforfix"}),r.Logger.error("after apply delta error:"+p),new Error("after apply delta error:"+p)}if(this.sendModelChangeNotification(t.globalOpts.fromServer),this._waitingForReflow=!0,t.globalOpts.updateSelection)t.globalOpts.fromServer?this.setRangeTo(t.currentRange(),{scrollToView:e.ScrollViewType.None,forceNotify:!0,forceFocus:!1,mobileSelectionDrag:e.MobileSelectionDragType.Keep,mobileContextMenu:e.MobileContextMenuType.Keep}):this.setRangeTo(t.currentRange(),{forceNotify:!0});else{var l=this._selection.gcpRange;if(a.notEqual(l)){var c=t.globalOpts.fromServer;this.context.fire(new ya(l,this._selection.tableCellRange,{scrollToView:e.ScrollViewType.None,forceFocus:!c,mobileSelectionDrag:c?e.MobileSelectionDragType.Keep:e.MobileSelectionDragType.Show,mobileContextMenu:c?e.MobileContextMenuType.Keep:e.MobileContextMenuType.Show}))}}o[1]=r.PerfUtil.now(),!t.globalOpts.fromServer&&t.globalOpts.needCollab&&this.context.fire(new ba(t),!1),o[2]=r.PerfUtil.now(),!t.globalOpts.fromServer&&a.notEqual(this._selection.gcpRange)&&(this.cusorSpanProp=null),i&&(this.cusorSpanProp=i),o[3]=r.PerfUtil.now(),this.logCostTime(o,t.operations.length)}else this.context.fire(new Ca(t),!1)},t.prototype.logCostTime=function(t,n){var o=t[3]-t[0],i=t[2]-t[1],a=this.context.perfHandler;a.costTime[e.EditMetric.ApplyDelta]=o,a.costTime[e.EditMetric.Collab]=i,o>1e3?r.Logger.warn("perf|applyDelta total="+o+"ms,collab="+i+"ms,opCount="+n):o>30&&r.Logger.log("perf|applyDelta total="+o+"ms,collab="+i+"ms,opCount="+n)},t.prototype.sendModelChangeNotification=function(e){var t=this;this._mergeDeltaTimeout||(this._mergeDeltaTimeout=setTimeout((function(){var r=t._genDirtyRangeMap();r&&r.size>0&&t.context.fire(new da({dirtyRangeMap:r},e),!1),t._dirtyRangeClassMap.forEach((function(e){e.destroy()})),t._dirtyRangeClassMap.clear(),t._mergeDeltaTimeout=null})))},t.prototype.compositionStart=function(e,t){var r=this.delta(),n=this.selection.validCompositionDeleteRange(),o=this.getTextStream().createParagraphIterator(n).getRange();(n.equal(o)||n.end()===o.end()&&1===n.length())&&(n.len-=1),this.deleteText(n,r),this.applyDelta(r),this._compositionId=e,this._compositionGcpClass.insertGCP(e,n.begin()),this._compositionLenMap.set(e,0)},t.prototype.compositionUpdate=function(e,t,r){void 0===r&&(r=!1),this._compositionId=e,this._compositionText=t;var n=this._compositionGcpClass.getGCP(e),o=this._compositionLenMap.get(e);if(void 0!==n&&void 0!==o){var i=new ne(n,o),a=this.cusorSpanProp,s=this.delta();s.setNeedCollab(!1),s.deleteText(i),this.cusorSpanProp=a;var p=this.followSpanProp(i.begin());this.cusorSpanProp&&p.merge(this.cusorSpanProp),r&&(p.pinyin=!0),s.insertText(n,t,p),this.applyDelta(s),this.cusorSpanProp=a,this._compositionGcpClass.deleteGCP(e),this._compositionGcpClass.insertGCP(e,n),this._compositionLenMap.set(e,t.length)}},t.prototype.compositionEnd=function(e,t,r){var n=this._compositionGcpClass.getGCP(e),o=this._compositionLenMap.get(e);if(void 0!==n&&void 0!==o){var i=new ne(n,o),a=this.cusorSpanProp,s=this.delta();s.setNeedCollab(!1),s.deleteText(i),this.applyDelta(s),this._compositionId="",this.cusorSpanProp=a,this._compositionGcpClass.deleteGCP(e),this._compositionLenMap.delete(e),i.len=0,s=this.delta(),this._selection.gcpRange.notEqual(i)&&s.setUpdateSelection(!1);var p=this.followSpanProp(i.begin());s.insertText(n,t,p),this.applyDelta(s)}this._compositionId=""},t.prototype.insertCopyImageFinish=function(e,t,n,o){var i=this.dataEngine.getContainerManager();if(i){var a=i.getAnchorRange(e);if(a){var s=this.getTextStream().createSpanIterator(a).getProperty(!0);if(s instanceof vr&&s instanceof nr&&e===s.anchorId){var p=new vr;if(p.imgSrc=t,n&&o){var l=r.pxToTwips(n),c=r.pxToTwips(o);p.width=l,p.height=c}var u=Ti.createLocalDeltaOption(ne.emptyRange(),!1,!0).buildDelta();u.globalOpts.undoOption.needInverse=!1,u.setSpanProperty(a,p),u.setUpdateSelection(!1),this.applyDelta(u)}}}},t.prototype.insertResourceStart=function(e,t,r){var n=t.buildDelta(),o=new Su(this.dataEngine,n.currentRange()),i=o.fixToValidReplaceRange(o.gcpRange);this.deleteText(i,n),this.applyDelta(n);var a=i.begin();(n=t.buildDelta()).setNeedCollab(!1),r(n,a,this.followSpanProp(a)),this.applyDelta(n),this._compositionGcpClass.insertGCP(e,a),this._containerNeedUpdateCaret=[e,!0]},t.prototype.insertResourceProgress=function(e,t,r){var n=this._compositionGcpClass.getGCP(e);if(void 0!==n){var o=this.getTextStream().createSpanIterator(new ne(n,1)).getProperty();if(o&&o instanceof nr&&e===o.anchorId){var i=t.buildDelta();i.setUpdateSelection(!1),i.setNeedCollab(!1),i.globalOpts.undoOption.needInverse=!1,r(i,n,o),this.applyDelta(i)}}},t.prototype.insertResourceFinish=function(e,t,r){var n=this._compositionGcpClass.getGCP(e);if(void 0!==n){var o=this.getTextStream().createSpanIterator(new ne(n,1)).getProperty();if(o&&o instanceof nr&&e===o.anchorId){var i=!1;this._containerNeedUpdateCaret&&this._containerNeedUpdateCaret[0]===e&&(i=this._containerNeedUpdateCaret[1]);var a=t.buildDelta();a.setUpdateSelection(i),a.setNeedCollab(!1),a.deleteText(new ne(n,1)),this.applyDelta(a),this._compositionGcpClass.deleteGCP(e),(a=t.buildDelta()).setUpdateSelection(i),r(a,n,o),this.applyDelta(a)}}},t.prototype.insertResourceCancel=function(e,t){var r=this._compositionGcpClass.getGCP(e);if(void 0!==r){var n=t?t.buildDelta():this.delta();n.setNeedCollab(!1),n.deleteText(new ne(r,1)),this.applyDelta(n),this._compositionGcpClass.deleteGCP(e)}},t.prototype.deleteText=function(t,r){if(!(t.length()<=0)){r.deleteText(t);var n=this.getTextStream().createDataIterator(t),o=n.getParaProp(),i=n.getRange(e.IterType.Paragraph);n.seek(i.end()-1);var a=n.getSpanProp();if(o&&t.end()>=i.end()){var s=i.intersectRange(t);if(s.notEqual(i))if(s.length()>1)a&&r.insertParagraph(t.begin(),a,o);else{r.setParagraphProperty(new ne(t.begin(),0),o,e.TDSetPropMode.Cover),n.seek(t.end());var p=n.getRange(e.IterType.Paragraph);p&&p.end()-t.end()==1&&a&&r.setSpanProperty(new ne(t.begin(),1),a,e.TDSetPropMode.Cover)}}r.moveTo(new ne(t.begin(),0));var l=this._newCusorSpan(r);l&&(l.delete(e.CommentSpanPropKey.comments),this.cusorSpanProp=l)}},Object.defineProperty(t.prototype,"selection",{get:function(){return this._selection},enumerable:!0,configurable:!0}),t.prototype.setRangeTo=function(e,t){var r=this._selection.setRangeTo(e,t);return(r||(null==t?void 0:t.forceNotify))&&(r&&(this.cusorSpanProp=null,this.listMarkerSpanProp=null,this._containerNeedUpdateCaret&&(this._containerNeedUpdateCaret[1]=!1)),this.context.fire(new ya(this._selection.gcpRange,this._selection.tableCellRange,t))),r},t.prototype.moveTo=function(e,t){this.setRangeTo(new ne(e,t))},t.prototype.currentSpanProp=function(e){var t=this.getTextStream().createSpanIterator();t.seek(e);var r=t.getProperty();return r||new wt},t.prototype.followSpanProp=function(t,r){var n,o;void 0===r&&(r=!1);var i=this.getTextStream().createDataIterator();i.seek(t);var a=i.getRange(e.IterType.Paragraph),s=i.getRange(e.IterType.Span);return t===a.begin()||t>s.begin()&&t<s.end()||i.prev(e.IterType.Span),o=(n=i.getSpanProp())?new wt(n):new wt,!r&&t===this.selection.gcpRange.begin()&&this.cusorSpanProp&&o.merge(this.cusorSpanProp),(t>=s.end()||t<=s.begin())&&(o.delete(e.SpanPropKey.link),o.delete(e.CommentSpanPropKey.comments)),o.delete(e.SpanPropKey.delFirst),o},t.prototype.currentParaProp=function(e){var t=this.getTextStream().createParagraphIterator();t.seek(e);var r=t.getProperty();return r||new gt},t.prototype.followParaProp=function(t){var r={paraProp:new gt,paraBreakSpan:new Nt},n=this.getTextStream().createParagraphIterator();n.seek(t);var o=n.getProperty(),i=n.getRange();if(!o||i.length()<1)return r;o.genNewParaId();var a=this.followSpanProp(t);if(t===i.end()-1){var s=this.dataEngine.getStyleSheetEngine().getStylePropertyFromName(o.styleName);if(null==s?void 0:s.nextParaStyle){var p=this.dataEngine.getStyleSheetEngine().getStylePropertyFromName(s.nextParaStyle);p&&p.styleName===s.styleName||(o.clear(dt),p&&(o.styleName=p.styleName))}o.taskState===e.TaskState.Done&&(o.taskState=e.TaskState.Todo)}return{paraProp:new gt(o),paraBreakSpan:new Nt(a)}},t.prototype.followSectProp=function(e){var t=this.getTextStream().createSectionIterator();t.seek(e);var r=t.getProperty();return r||new lt},Object.defineProperty(t.prototype,"cusorSpanProp",{get:function(){return this._cusorSpanProp},set:function(t){var r=!0;this._cusorSpanProp&&t?this._cusorSpanProp.merge(t):this._cusorSpanProp||t?this._cusorSpanProp=t:r=!1,r&&(this._cusorSpanProp&&this._cusorSpanProp.delete(e.CommentSpanPropKey.comments),this.context.fire(new Ta))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"listMarkerSpanProp",{get:function(){return this._listMarkerSpanProp},set:function(e){this._listMarkerSpanProp=e},enumerable:!0,configurable:!0}),t.prototype.isRangeBeginAtParaStart=function(e){if(0!==e.length())return!1;var t=this.dataEngine.getTextStream().createParagraphIterator();return t.seek(e.begin()),t.getRange().gcpBegin===e.begin()},t.prototype.isCompositing=function(){return this._compositionId.length>0},t.prototype.getCompositionId=function(){return this._compositionId},t.prototype.getCompositionText=function(){return this._compositionText},t.prototype.getExceptionRanges=function(){var e=this,t=[],r=this._compositionGcpClass.findGCPs(),n=this.getTextStream().createSpanIterator();return r.forEach((function(r){var o=e._compositionLenMap.get(r.key);if(void 0===o&&(o=1),r.key.indexOf("input_")>=0)t.push(new ne(r.gcp,o));else{n.seek(r.gcp);var i=n.getProperty();i instanceof nr&&r.key===i.anchorId?t.push(new ne(r.gcp,o)):e._compositionGcpClass.deleteGCP(r.key)}})),t},Object.defineProperty(t.prototype,"waitingForReflow",{get:function(){return this._waitingForReflow},set:function(e){this._waitingForReflow=e},enumerable:!0,configurable:!0}),t.prototype.revertDelta=function(e,t){var r=[];e.operations.forEach((function(e){e.replaceOpArray.length>0?e.replaceOpArray.forEach((function(e){r.push.apply(r,vu(e.inverseOpArray))})):r.push.apply(r,vu(e.inverseOpArray))})),r.reverse();var n=Ti.createLocalDeltaOption(ne.emptyRange(),!1,!1).buildDelta();n.msg=t.msg,n.globalOpts.undoOption.needInverse=!1,n.globalOpts.undoOption.fromUndo=!0,r.forEach((function(e){n.addOperation(e)})),this.applyDelta(n)},t}(),Iu=function(){function e(){}return e.nextTextBreak=function(e,t){if(t<0||t>=e.getLength()-1)return t;var r=this._findTextRange(e,t);return this._textBreak(e,r,t,!0)},e.previousTextBreak=function(e,t){if(t<=0||t>e.getLength()-1)return t;var r=this._findTextRange(e,t);return this._textBreak(e,r,t,!1)},e._textBreak=function(e,t,r,o){var i=r-t.begin();if(i>=0){var a=e.readText(t.begin(),t.end()),s=o?n.nextBreak(a,i):n.previousBreak(a,i);return t.begin()+s}return r},e._findTextRange=function(e,t){var r=e.createParagraphIterator();r.seek(t);var n=r.getRange();return r.prev()&&(n=n.unionRange(r.getRange())),n},e}(),Eu=Ia("copyParserManager"),Lu=Ia("copy"),Ou=Ia("cut"),Nu=Ia("paste");(xu=e.PasteDstType||(e.PasteDstType={}))[xu.Doc=0]="Doc",xu[xu.Cell=1]="Cell",xu[xu.Table=2]="Table",xu[xu.SubStory=3]="SubStory",xu[xu.Codeblock=4]="Codeblock",xu[xu.HeaderFooter=5]="HeaderFooter",(Tu=e.PasteSrcType||(e.PasteSrcType={}))[Tu.Text=0]="Text",Tu[Tu.Table=1]="Table",Tu[Tu.Mix=2]="Mix",(_u=e.PasteNodeProcessorPriority||(e.PasteNodeProcessorPriority={}))[_u.low=0]="low",_u[_u.normal=1]="normal",_u[_u.high=2]="high";var ku,Mu=Ia("pasteProcessorManager"),Du=Ia("customClipboard"),Fu=function(){function e(){this.data=""}return e.prototype.setData=function(e){this.data=e},e.prototype.getData=function(){return this.data},e.prototype.isEmpty=function(){return 0===this.data.length},e.prototype.writeToSysytemClipboard=function(){var e=document.createElement("textarea");e.readOnly=!0,e.style.zIndex="0",e.style.opacity="0",e.style.top="-9999px",e.style.left="-9999px",e.style.position="fixed",document.body.appendChild(e),e.value=this.data;var t=document.createRange();t.selectNode(e);var r=window.getSelection();r&&r.addRange(t),e.select(),document.execCommand("SelectAll"),document.execCommand("copy"),document.body.removeChild(e)},e}(),Au=function(e,t){return(Au=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)};function Ku(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a}function Gu(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}(ku=e.ClipboardNotificationType||(e.ClipboardNotificationType={})).ON_COPY="on_copy",ku.ON_CUT="on_cut",ku.ON_PASTE="on_paste";var Hu=function(e){function t(t,r){var n=e.call(this,t)||this;return n.pasteData=r,n}return function(e,t){function r(){this.constructor=e}Au(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(t,e),t}(r.Notification),ju=Ia("clipboardManager"),Uu=function(){function t(e){this.context=e,this.customClipboard=new Fu,e.factory.set(Du,this.customClipboard)}return t.prototype.attach=function(){this.copyInterface&&this.copyInterface.attach(),this.cutInterface&&this.cutInterface.attach(),this.pasteInterface&&this.pasteInterface.attach()},t.prototype.detach=function(){this.copyInterface&&this.copyInterface.detach(),this.cutInterface&&this.cutInterface.detach(),this.pasteInterface&&this.pasteInterface.detach()},t.prototype.copy=function(e){this.context.isCopyable()&&(this.copyInterface?this.copyInterface.copy(e):r.Logger.warn("clipboard|copy not loaded"))},t.prototype.cut=function(){this.context.isEditable()&&(this.cutInterface?this.cutInterface.cut():r.Logger.warn("clipboard|cut not loaded"))},t.prototype.paste=function(){this.context.isEditable()&&(this.pasteInterface?this.pasteInterface.paste():r.Logger.warn("clipboard|paste not loaded"))},t.prototype.writeToClipboard=function(e){this.customClipboard.setData(e),this.customClipboard.writeToSysytemClipboard()},t.prototype.isCustomClipboardEmpty=function(){return this.customClipboard.isEmpty()},t.prototype.addCopyModelParser=function(e,t){this.copyParserMgr&&this.copyParserMgr.addCopyModelParser(e,t)},t.prototype.addCopyContainerParser=function(e,t,r){this.copyParserMgr&&this.copyParserMgr.addCopyContainerParser(e,t,r)},t.prototype.addPasteNodeProcessor=function(t,r){void 0===r&&(r=e.PasteNodeProcessorPriority.normal),this.pasteProcessorMgr&&this.pasteProcessorMgr.addPasteNodeProcessor(t,r)},t.prototype.addPasteDstProcessor=function(e,t){this.pasteProcessorMgr&&this.pasteProcessorMgr.addPasteDstProcessor(e,t)},t.prototype.addPasteDeltaProcessor=function(e){this.pasteProcessorMgr&&this.pasteProcessorMgr.addPasteDeltaProcessor(e)},Ku([Lu,Gu("design:type",Object)],t.prototype,"copyInterface",void 0),Ku([Eu,Gu("design:type",Object)],t.prototype,"copyParserMgr",void 0),Ku([Ou,Gu("design:type",Object)],t.prototype,"cutInterface",void 0),Ku([Nu,Gu("design:type",Object)],t.prototype,"pasteInterface",void 0),Ku([Mu,Gu("design:type",Object)],t.prototype,"pasteProcessorMgr",void 0),t}(),zu=function(e,t){return(zu=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)};function Wu(e,t){function r(){this.constructor=e}zu(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var Vu=function(){return(Vu=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function Yu(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]])}return r}function qu(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Xu(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a}function Ju(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(Xu(arguments[t]));return e}var Zu=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.rootRef=u.default.createRef(),t}return Wu(t,e),t.prototype.componentDidMount=function(){this.attachBox(),this.lastBoxId=this.props.layoutBox.uuid},t.prototype.componentWillUnmount=function(){this.detachBox()},t.prototype.componentDidUpdate=function(){this.attachBox(),this.lastBoxId=this.props.layoutBox.uuid},t.prototype.attachBox=function(){var e=this.rootRef.current;if(e){var t=this.props.layoutBox;t.__node__&&(t.__node__.__vm__=null),e.__vm__&&(e.__vm__.__node__=null),e.__vm__=t,e.__type__=t.constructor.name,t.__node__=e}},t.prototype.detachBox=function(){var e=this.rootRef.current;if(e){var t=this.props.layoutBox;e.__vm__=null,e.__type__=null,t.__node__=null}},t}(u.default.Component),Qu=function(){function e(e){this.uuid=e,this.colored=!1}return Object.defineProperty(e.prototype,"size",{get:function(){return this.children?this.children.length:0},enumerable:!0,configurable:!0}),e.prototype.childAt=function(e){return this.children?this.children[e]:void 0},e.prototype.append=function(e){this.children||(this.children=[]),this.children.push(e)},e}(),$u=new(function(e){function t(){return e.call(this,"")||this}return Wu(t,e),t.prototype.childAt=function(){return this},t}(Qu)),eh=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Wu(t,e),t.prototype.childAt=function(t){return e.prototype.childAt.call(this,t)||$u},t}(Qu),th={verticalAlign:"vertical-align",textDecoration:"text-decoration",whiteSpace:"white-space",fontFamily:"font-family",fontSize:"font-size",fontStyle:"font-style",fontWeight:"font-weight",color:"color",backgroundColor:"background",letterSpacing:"letter-spacing",writingMode:"writing-mode",border:"border"},rh={fontFamily:ot.fontFamily,fontSize:r.twipsToPt(ot.fontSize)+"pt",color:ot.font.textColor,letterSpacing:r.twipsToPt(ot.font.letterSpacing)+"pt",linkColor:ot.font.linkColor,fontWeight:ot.font.fontWeight,fontStyle:"normal",textDecoration:"",writingMode:"horizontal-tb",whiteSpace:"pre",verticalAlign:"baseline"},nh=function(){function e(e){this.styles=e||{}}return e.prototype.setProperty=function(e){e&&(this.styles=e)},e.prototype.mergeTo=function(e){var t=this;return Object.keys(this.styles).forEach((function(r){e.styles[r]=t.styles[r]})),e},Object.defineProperty(e.prototype,"cssProperties",{get:function(){return this.styles},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cssText",{get:function(){var e=this,t=[];return Object.keys(this.styles).forEach((function(n){var o=th[n];o||(o=r.StringUtil.camelToChain(n)),t.push(o+":"+e.styles[n])})),t.join(";")},enumerable:!0,configurable:!0}),e}(),oh=function(){function t(){}return t.computeStyles=function(e){return e instanceof fe?this.computeStylesFromProps(e):as(e)?this.computeStylesFromBox(e):new nh},t.computeTextSpanFullStyles=function(e){var t=new nh,r=this.parseTextSpan(e,["whiteSpace"]);return t.setProperty(r),t},t.computeStylesFromBox=function(t){var r={};if(os(t)){var n=t instanceof il||bs(t)&&t.type===e.TextType.TailGlue?["backgroundColor","textDecoration"]:["backgroundColor"];r=this.parseTextSpan(t.textStyle,n)}else xs(t)&&(r=this.parseTableCell(t));var o=new nh;return o.setProperty(r),o},t.computeStylesFromProps=function(e){var t=new nh;if(e instanceof wt){var r=this.parseTextSpan(e,["backgroundColor"]);t.setProperty(r)}else if(e instanceof an){r=this.parseTableCellProps(e);t.setProperty(r)}return t},t.parseTableCellProps=function(e){var t=e.cellcolor,n=e.borderTop,o=e.borderLeft,i=e.borderBottom,a=e.borderRight,s=e.padding,p=(e.vAlign,e.hAlign,{borderTop:r.twipsToPx(n.borderWidth)+"px "+n.borderStyle+" "+n.borderColor,borderLeft:r.twipsToPx(o.borderWidth)+"px "+o.borderStyle+" "+n.borderColor,borderRight:r.twipsToPx(a.borderWidth)+"px "+a.borderStyle+" "+a.borderColor,borderBottom:r.twipsToPx(i.borderWidth)+"px "+i.borderStyle+" "+i.borderColor}),l={paddingTop:r.twipsToPx(s.top)+"px",paddingLeft:r.twipsToPx(s.left)+"px",paddingBottom:r.twipsToPx(s.bottom)+"px",paddingRight:r.twipsToPx(s.right)+"px"};return Vu(Vu({backgroundColor:t},p),l)},t.parseTextSpan=function(t,n){var o=[];t.strike&&o.push("line-through");var i=r.isLinkValid(t.link);(t.underline||!t.has(e.SpanPropKey.underline)&&i||t.pinyin)&&o.push("underline");var a=t.textColor;!t.has(e.SpanPropKey.textColor)&&i&&(a=rh.linkColor);var s=rh.verticalAlign;!0===t.superScript?s="super":!0===t.subScript&&(s="sub");var p=t.fontFamily;if(t.has(e.SpanPropKey.fontFamily)&&p!==rh.fontFamily){var l=p.split(",").filter((function(e){return"sans-serif"!==e}));p=l.join(",")+","+rh.fontFamily}var c={fontSize:r.twipsToPt(t.fontSize)+"pt",fontFamily:p,fontWeight:t.fontWeight,fontStyle:t.italic?"italic":rh.fontStyle,textDecoration:o.length>0?o.join(" "):rh.textDecoration,color:a,backgroundColor:t.textBackground,letterSpacing:r.twipsToPt(t.letterSpacing)+"pt",verticalAlign:s,whiteSpace:rh.whiteSpace};return n&&n.forEach((function(e){Object.prototype.hasOwnProperty.call(c,e)&&delete c[e]})),c},t.isDefaultCss=function(e,t){return"backgroundColor"===e?"transparent"===t:e&&rh[e]&&rh[e]===t},t.parseTableCell=function(e){return Vu({backgroundColor:e.bgColor,verticalAlign:e.prevBreakSibling?"top":e.vAlign},this.boxBorder(e))},t.boxSize=function(e){var t={},n=e.rect;return n.width&&(t.width=r.twipsToPx(n.width)+"px"),n.height&&(t.height=r.twipsToPx(n.height)+"px"),t},t.boxBorder=function(e){var t=e.edge,n=t.border,o={borderTop:r.twipsToPx(n.width.top)+"px "+n.style.top+" "+n.color.top,borderLeft:r.twipsToPx(n.width.left)+"px "+n.style.left+" "+n.color.left,borderRight:r.twipsToPx(n.width.right)+"px "+n.style.right+" "+n.color.right,borderBottom:r.twipsToPx(n.width.bottom)+"px "+n.style.bottom+" "+n.color.bottom};return t.recycle(),o},t.boxMargin=function(e){var t=e.edge,n=t.margin,o={margin:r.twipsToPx(n.top)+"px "+r.twipsToPx(n.right)+"px "+r.twipsToPx(n.bottom)+"px "+r.twipsToPx(n.left)+"px"};return t.recycle(),o},t.boxPadding=function(e){var t=e.edge,n=t.padding,o={padding:r.twipsToPx(n.top)+"px "+r.twipsToPx(n.right)+"px "+r.twipsToPx(n.bottom)+"px "+r.twipsToPx(n.left)+"px"};return t.recycle(),o},t.getCursorType=function(e){if(r.PlatformUtil.isTencentDocsIPadApp()&&!e)return"auto"},t}(),ih=function(e,t){return e-t};function ah(e){for(var t=0,r=0;r<e.length;r++)t=10*t+e.charCodeAt(r)-48;return t}var sh=function(){function e(){this.key=1,this.keymap=new Map,this.boxKey=new Map}return e.prototype.build=function(e,t){var r=this;if(e.uuid!==this.hostId){this.hostId=e.uuid;var n=e.children;t&&(n=n.filter(t));var o=new Map,i=new Map,a=new Map,s=[];n.forEach((function(e){var t=ah(e.uuid);if(r.boxKey.has(t)){var n=r.boxKey.get(t),p=r.keymap.get(n);r.keymap.delete(n),i.set(n,p),a.set(t,n)}else{p=function e(t){var r=[];return ds(t)?r.push(ah(t.uuid)):is(t)&&t.children.length>0&&t.children.forEach((function(t){e(t).forEach((function(e){r.push(e)}))})),r}(e).sort(ih);o.set(t,p),s.push(t)}}));var p=[];s.forEach((function(e){var t=o.get(e),n=r.findClosestKey(t,r.keymap);n>0?(a.set(e,n),i.set(n,t),r.keymap.delete(n)):p.push(e)})),s=[],p.forEach((function(e){var t=o.get(e),n=0;r.keymap.forEach((function(e,r){n||e.length!==t.length||(n=r)})),n?(a.set(e,n),i.set(n,t),r.keymap.delete(n)):s.push(e)})),s.forEach((function(e){var t=o.get(e),n=r.key;r.key+=1,a.set(e,n),i.set(n,t)})),this.keymap=i,this.boxKey=a}},e.prototype.findClosestKey=function(e,t){var r=this,n=0,o=0;return t.forEach((function(t,i){var a=r.findMatch(e,t);a>n&&(n=a,o=i)})),o},e.prototype.findMatch=function(e,t){return y(e,t,ih)},e.prototype.reset=function(){this.boxKey.clear(),this.keymap.clear(),this.key=1},e.prototype.getKey=function(e){return this.boxKey.get(ah(e.uuid))||ah(e.uuid)},e}();function ph(e,t,r){return e.getTextStream().getRangeFromIndex(t,r)}var lh,ch=function(){function e(){}return e.getLeastGrandsonByPoint=function(e,t){for(var n=t,o=e;;){var i=o.__node__;i&&i.scrollLeft>0&&(n.x+=r.pxToTwips(i.scrollLeft));var a=Xu(o.getChildByPoint(n),2),s=a[0],p=a[1];if(!s||!p)break;if(!is(s))break;o=s,n=p}return[o,n]},e.isFirstParaOfDoc=function(e,t){return 0===t.boxHelper.bp2cp(e.firstIndex)},e}(),uh=function(){function e(){this.decorators=[]}return e.prototype.addDecorator=function(e){this.decorators.push(e)},e.prototype.removeDecorators=function(){this.decorators=[]},e}(),hh=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Wu(t,e),t.prototype.decorate=function(e,t){var r=e,n=new nh;return this.decorators.forEach((function(e){var o=e(r,t);r=o.component,n.setProperty(o.overrideStyle)})),{component:r,overrideStyle:n.cssProperties}},t}(uh),fh=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Wu(t,e),t.prototype.decorate=function(e,t){var r=e;return this.decorators.forEach((function(e){r=e(r,t)})),r},t}(uh),dh=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Wu(t,e),t.prototype.decorate=function(e){var t=[];return this.decorators.forEach((function(r,n){var o=r(e,n);o&&t.push(o)})),t},t}(uh),gh=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Wu(t,e),t.prototype.decorate=function(e){var t=new nh;return this.decorators.forEach((function(r){var n=r(e);t.setProperty(n)})),t.cssProperties},t}(uh);(lh=e.PageOrderType||(e.PageOrderType={}))[lh.Front=0]="Front",lh[lh.Back=1]="Back",lh[lh.Bottom=2]="Bottom";var yh,mh=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Wu(t,e),t.prototype.decorate=function(e){var t=[];return this.decorators.forEach((function(r){var n=r(e);n&&t.push(n)})),t},t}(uh),bh=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Wu(t,e),t.prototype.decorate=function(e){var t=[],r=new nh;return this.decorators.forEach((function(n){var o=n(e);o&&(o.component&&t.push(o.component),r.setProperty(o.overrideStyle))})),{components:t,overrideStyle:r.cssProperties}},t}(uh),Ph=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Wu(t,e),t.prototype.decorate=function(e,t){var r=e,n=new nh;return this.decorators.forEach((function(o){var i=o(e,t);r=i.component,n.setProperty(i.overrideStyle)})),{component:r,overrideStyle:n.cssProperties}},t}(uh),vh=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Wu(t,e),t.prototype.decorate=function(e){return this.decorators.map((function(t){return new nh(t(e))})).reduce((function(e,t){return e.mergeTo(t)}),new nh).cssProperties},t}(uh),xh=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Wu(t,e),t.prototype.decorate=function(e,t){var r=e;return this.decorators.forEach((function(e){var n=e(r,t);r=n})),r},t}(uh),Th=function(){function e(){this.styleDecorators=new vh,this.regionDecorators=new Map([["start",new xh],["center",new xh],["end",new xh],["content",new xh]])}return e.prototype.addStyle=function(e){this.styleDecorators.addDecorator(e)},e.prototype.addRegion=function(e,t){var r;null===(r=this.regionDecorators.get(e))||void 0===r||r.addDecorator(t)},e.prototype.decorateStyle=function(e){return this.styleDecorators.decorate(e)},e.prototype.decorateRegion=function(e,t,r){var n=this.regionDecorators.get(e);return n?n.decorate(t,r):t},e.prototype.removeDecorators=function(){this.styleDecorators.removeDecorators(),this.regionDecorators.forEach((function(e){return e.removeDecorators()}))},e}(),_h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Wu(t,e),t.prototype.decorate=function(e,t){var r=[];return this.decorators.forEach((function(n,o){var i=n(e,t,o);i&&r.push(i)})),r},t}(uh);(yh=e.DecoratorTypes||(e.DecoratorTypes={}))[yh.Text=0]="Text",yh[yh.LinePaddingLeft=1]="LinePaddingLeft",yh[yh.Paragraph=2]="Paragraph",yh[yh.HeaderFooter=3]="HeaderFooter",yh[yh.Page=4]="Page",yh[yh.Textframe=5]="Textframe",yh[yh.LineFragment=6]="LineFragment",yh[yh.LinePlaceholder=7]="LinePlaceholder";var Sh=function(){function t(t){var r=this;this.map=new Map,this.boxMap=new Map,this.map.set(e.DecoratorTypes.Text,new hh),this.map.set(e.DecoratorTypes.LinePaddingLeft,new dh),this.map.set(e.DecoratorTypes.Paragraph,new gh),this.map.set(e.DecoratorTypes.HeaderFooter,new bh),this.map.set(e.DecoratorTypes.Page,new mh),this.map.set(e.DecoratorTypes.Textframe,new fh),this.map.set(e.DecoratorTypes.LineFragment,new Ph),this.map.set(e.DecoratorTypes.LinePlaceholder,new _h),null==t||t.forEach((function(e){return r.boxMap.set(e,new Th)}))}return t.prototype.addDecorator=function(e,t){var r=this.map.get(e);r&&r.addDecorator(t)},t.prototype.addStyleDecorator=function(e,t){var r=this.boxMap.get(e);null==r||r.addStyle(t)},t.prototype.addContentDecorator=function(e,t,r){var n=this.boxMap.get(e);null==n||n.addRegion(t,r)},t.prototype.getDecorator=function(e){return this.map.get(e)},t.prototype.getBoxDecorators=function(e){return this.boxMap.get(e)},t.prototype.removeAllDecorators=function(){this.map.get(e.DecoratorTypes.Text).removeDecorators(),this.map.get(e.DecoratorTypes.LinePaddingLeft).removeDecorators(),this.map.get(e.DecoratorTypes.Paragraph).removeDecorators(),this.map.get(e.DecoratorTypes.HeaderFooter).removeDecorators(),this.map.get(e.DecoratorTypes.Page).removeDecorators(),this.map.get(e.DecoratorTypes.Textframe).removeDecorators(),this.map.get(e.DecoratorTypes.LineFragment).removeDecorators(),this.map.get(e.DecoratorTypes.LinePlaceholder).removeDecorators(),this.boxMap.forEach((function(e){return e.removeDecorators()}))},t}(),Ch=function(t){function r(e){var r=t.call(this,e)||this;return r.overlays=r.props.shares.overlays,r.state={overlayNode:r.getOverlayNode()},r.overlayWatcher=function(){r.setState({overlayNode:r.getOverlayNode()})},r}return Wu(r,t),r.prototype.getOverlayNode=function(){var e=this.props.layoutBox;return this.overlays.getOverlayNode(e.storyId)},r.prototype.componentDidMount=function(){this.overlays.addWatcher(this.overlayWatcher)},r.prototype.componentWillUnmount=function(){this.overlays.removeWatcher(this.overlayWatcher)},r.prototype.render=function(){var t=this.props,r=t.layoutBox,n=t.lazyRenderInfo,o=Yu(t,["layoutBox","lazyRenderInfo"]),i=this.state.overlayNode,a=r.content;o.overlayNode=i;var s=u.default.createElement(pd,Vu({layoutBox:a,lazyRenderInfo:n.childAt(0)},o));return this.props.shares.decoratorManager.getDecorator(e.DecoratorTypes.Textframe).decorate(s,r)},r}(u.default.Component),Bh=function(t){function r(){return null!==t&&t.apply(this,arguments)||this}return Wu(r,t),r.prototype.shouldComponentUpdate=function(e){return e.layoutBox.uuid!==this.props.layoutBox.uuid||ys(this.props.layoutBox.parentBox)||!this.props.lazyRenderInfo.equal(e.lazyRenderInfo)||this.props.force!==e.force},r.prototype.componentDidMount=function(){bs(this.props.layoutBox)&&this.attachBox(),this.lastBoxId=this.props.layoutBox.uuid},r.prototype.componentDidUpdate=function(){bs(this.props.layoutBox)&&this.attachBox(),this.lastBoxId=this.props.layoutBox.uuid},r.prototype.render=function(){var t=this.props,r=t.layoutBox,n=t.overrideStyle,o=oh.computeStyles(r).cssProperties,i=this.getContent(),a=this.props.shares.decoratorManager.getDecorator(e.DecoratorTypes.Text).decorate(i,r),s=a.component,p=a.overrideStyle,l=[];if(n&&n.textDecoration&&l.push(n.textDecoration),o.textDecoration&&l.push(o.textDecoration),p.textDecoration&&l.push(p.textDecoration),l.length>1){var c=l.join(" ");p.textDecoration=Ju(new Set(c.split(" "))).join(" ")}else p.textDecoration=l[0];r.display===e.LayoutDisplay.InlineBlock&&(o.display="inline-block",o.width=oh.boxSize(r).width);var h={};return ns(r)&&(h=oh.boxMargin(r),o.lineHeight="normal"),r instanceof ol&&(o.lineHeight="normal"),u.default.createElement("span",{className:"melo-leaf",style:Vu(Vu(Vu(Vu({},n),o),h),p),ref:this.rootRef},s)},r.prototype.getContent=function(){var e=this.props,t=e.layoutBox,r=Yu(e,["layoutBox"]),n=this.props.shares,o=n.containerFocus,i=n.containerRenderManager;return bs(t)?t.textString():ms(t)?t.content?u.default.createElement(Ch,Vu({key:t.property.anchorId,layoutBox:t},r)):"Textframe render error":Ps(t)&&i.renderContainerBox(t,o)||""},r}(Zu);var Rh="melo-section",wh="melo-logic-page",Ih="melo-page-view",Eh="melo-paragraph",Lh="melo-line",Oh="melo-line-fragment",Nh="melo-table-wrapper",kh="melo-table-container",Mh="melo-table",Dh="melo-td",Fh="table-row-border-dragger",Ah="table-row-border-guide",Kh="table-col-border-dragger",Gh="table-col-border-guide",Hh="table-icon",jh="table-icon-svg";!function(e,t){void 0===t&&(t={});var r=t.insertAt;if(e&&"undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css","top"===r&&n.firstChild?n.insertBefore(o,n.firstChild):n.appendChild(o),o.styleSheet?o.styleSheet.cssText=e:o.appendChild(document.createTextNode(e))}}(".melo-section {\n  position: relative; }\n\n.melo-logic-page {\n  cursor: text;\n  overflow: hidden; }\n\n.melo-page-view {\n  -webkit-user-select: none;\n  -webkit-touch-callout: none;\n  -khtml-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n  margin: 0 auto;\n  position: relative;\n  z-index: 0;\n  transition: opacity 0.3s cubic-bezier(0.22, 0.61, 0.35, 1); }\n\n.melo-paragraph {\n  position: relative; }\n\n.melo-line {\n  position: relative; }\n\n.melo-line-fragment {\n  display: inline-block; }\n\n.melo-table-wrapper {\n  width: 100%;\n  overflow: visible;\n  position: relative; }\n\n.melo-table-container {\n  position: relative;\n  overflow: auto;\n  overflow-y: hidden;\n  box-sizing: content-box;\n  cursor: auto; }\n\n.melo-table {\n  border-collapse: collapse;\n  border: none;\n  table-layout: fixed;\n  width: 0;\n  cursor: text; }\n\n.melo-table th.melo-td,\n.melo-table td.melo-td {\n  border: 1px solid #000;\n  padding: 0;\n  vertical-align: top;\n  border-width: 1px !important;\n  overflow: hidden; }\n  .melo-table th.melo-td .melo-selection-overlay,\n  .melo-table td.melo-td .melo-selection-overlay {\n    z-index: 100; }\n\n.table-row-border-dragger {\n  background-color: rgba(0, 0, 0, 0);\n  position: absolute;\n  cursor: row-resize;\n  width: 100%;\n  height: 7px;\n  z-index: 13;\n  left: 0; }\n\n.table-row-border-guide {\n  position: absolute;\n  width: 100%;\n  height: 1px;\n  background: #6688ee;\n  left: 0; }\n\n.table-col-border-dragger {\n  background-color: rgba(0, 0, 0, 0);\n  position: absolute;\n  cursor: col-resize;\n  height: 100%;\n  width: 7px;\n  z-index: 13;\n  top: 0; }\n\n.table-col-border-guide {\n  position: absolute;\n  height: 100%;\n  width: 1px;\n  background: #6688ee;\n  top: 0; }\n\n.table-icon {\n  position: absolute;\n  display: none;\n  width: 27px;\n  height: 27px;\n  left: -13px;\n  top: -15px;\n  border: 1px solid #e3e3e3;\n  border-radius: 27px;\n  box-shadow: 0 2px 6px 0 rgba(0, 0, 0, 0.1);\n  background-color: #FFFFFF;\n  background-repeat: no-repeat;\n  -webkit-background-size: 27px 27px;\n  background-size: 27px 27px;\n  z-index: 2000;\n  pointer-events: auto;\n  -webkit-user-select: none;\n  user-select: none; }\n  .table-icon:hover {\n    background-color: #f5f5f5;\n    cursor: move; }\n  .table-icon .table-icon-svg {\n    touch-action: none;\n    pointer-events: none; }\n");var Uh=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return Wu(n,t),n.prototype.shouldComponentUpdate=function(e){return this.props.layoutBox.uuid!==e.layoutBox.uuid||this.props.overlayNode!==e.overlayNode||!this.props.lazyRenderInfo.equal(e.lazyRenderInfo)||this.props.force!==e.force},n.prototype.componentDidMount=function(){var r=this;t.prototype.componentDidMount.call(this),this.props.context.on(e.FieldNotification.PageNumChanged,(function(){r.props.layoutBox.needUpdate&&(r.forceUpdate(),r.props.layoutBox.needUpdate=!1)}),this)},n.prototype.componentWillUnmount=function(){t.prototype.componentWillUnmount.call(this),this.props.context.removeListener(e.FieldNotification.PageNumChanged,this)},n.prototype.render=function(){var t=this.props,n=t.layoutBox,o=t.overlayNode,i=t.lazyRenderInfo,a=Yu(t,["layoutBox","overlayNode","lazyRenderInfo"]),s=this.props.layoutBox.edge,p={paddingLeft:r.twipsToPx(s.padding.left),paddingRight:r.twipsToPx(s.padding.right)};s.recycle(),this.lastBoxId!==n.uuid&&(this.cssStyle=Vu({},oh.boxSize(n)));var l=n.children.map((function(e,t){return e.hidden?null:u.default.createElement(Bh,Vu({key:t,layoutBox:e,overlayNode:o.childAt(t),lazyRenderInfo:i.childAt(t)},a))})),c=this.props.shares.decoratorManager.getDecorator(e.DecoratorTypes.LineFragment).decorate(l,n),h=c.component,f=c.overrideStyle;return u.default.createElement("span",{className:Oh,style:Vu(Vu(Vu({textAlign:"center"},this.cssStyle),p),f),ref:this.rootRef},h)},n}(Zu);var zh,Wh=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return Wu(n,t),n.prototype.shouldComponentUpdate=function(e){return this.props.layoutBox.uuid!==e.layoutBox.uuid||this.props.overlayNode!==e.overlayNode||!this.props.lazyRenderInfo.equal(e.lazyRenderInfo)||this.props.force!==e.force||!0===e.updateLinePlaceholder},n.prototype.shouldDecoratePlaceholder=function(e){var t=this.props.layoutController,r=e.parentBox;if(!r)return{shouldDecorate:!1};if(ds(r)&&e.isFirst&&ch.isFirstParaOfDoc(r,t))return{shouldDecorate:!0,isFirstPara:!0};var n=r.prevSibling;if(ds(n)&&e.isFirst&&ch.isFirstParaOfDoc(n,t))return{shouldDecorate:!0,isFirstPara:!1};return{shouldDecorate:!1}},n.prototype.render=function(){var t=this.props,n=t.layoutBox,o=t.overlayNode,i=t.lazyRenderInfo,a=Yu(t,["layoutBox","overlayNode","lazyRenderInfo"]),s=n.rect,p=n.edge;if(0===s.height)return null;var l,c=r.twipsToPx(s.width),h=r.twipsToPx(n.totalHeight),f=r.twipsToPx(n.sourceExtent);o.colored&&(l=this.props.shares.overlays.buildLineOverlay(n,c,h,f));var d,g=p.padding.left,y=n instanceof Zp&&n.listMark;y&&(g-=y.totalWidth,d=this.props.shares.decoratorManager.getDecorator(e.DecoratorTypes.LinePaddingLeft).decorate(n));if(this.lastBoxId!==n.uuid){this.lineCssStyle={height:r.twipsToPx(s.height)+"px",paddingTop:r.twipsToPx(p.padding.top)+"px",paddingBottom:r.twipsToPx(p.padding.bottom)+"px",whiteSpace:"nowrap"};var m=15,b=gs(n)&&n.firstChild;b&&ms(b)&&b.property instanceof Er&&(m=16),this.contentStyle={position:"relative",width:r.twipsToPx(n.contentWidth)+"px",marginLeft:r.twipsToPx(p.margin.left)+"px",paddingLeft:r.twipsToPx(g)+"px",zIndex:m,lineHeight:r.twipsToPx(s.height)+"px",height:r.twipsToPx(s.height)+"px"}}var P=r.twipsToPx(p.left);p.recycle();var v=null,x=this.shouldDecoratePlaceholder(n);x.shouldDecorate&&(v=this.props.shares.decoratorManager.getDecorator(e.DecoratorTypes.LinePlaceholder).decorate(n,!!x.isFirstPara));return u.default.createElement("div",{className:Lh,style:Vu({},this.lineCssStyle),ref:this.rootRef},function(t,n,o){var i=o,a=t.rect,s=r.twipsToPx(a.height),p=[];return t.children.forEach((function(t,o){var a=r.twipsToPx(t.borderBoxSize.width),l=s-n>0?s-n>>1:0;if(ys(t));else if(bs(t)&&!(t instanceof il)&&t.type!==e.TextType.TailGlue){var c=t.textStyle;if(c.textBackground!==ot.font.textBackground){var h={position:"absolute",left:i,top:l,width:a,height:n,backgroundColor:c.textBackground};p.push(u.default.createElement("div",{key:o,style:Vu({},h)}))}}i+=a})),p.length?u.default.createElement("div",{className:"melo-line-background",style:{position:"absolute",left:"0px"}},p):null}(n,f,P),l,v,u.default.createElement("div",{className:"melo-line-content",style:Vu({},this.contentStyle)},d,n.children.map((function(e,t){return os(e)?u.default.createElement(Bh,Vu({key:t,layoutBox:e,overlayNode:$u,lazyRenderInfo:i.childAt(t)},a)):u.default.createElement(Uh,Vu({key:t,layoutBox:e,overlayNode:$u,lazyRenderInfo:i.childAt(t)},a))}))))},n}(Zu),Vh=function(){function e(e){this.lazyRenderInfo=e,this.firstUnloadTotalHeight=0}return e.prototype.getUnloadBoxNode=function(e,t,n){return t<this.lazyRenderInfo.firstChildIndex?(this.firstUnloadTotalHeight+=e.totalHeight,t+1===this.lazyRenderInfo.firstChildIndex?u.default.createElement("div",{className:n,key:"pre-"+t,style:{height:r.twipsToPx(this.firstUnloadTotalHeight)}}):null):t>this.lazyRenderInfo.lastChildIndex?null:void 0},e}(),Yh=function(t){function r(e){var r=t.call(this,e)||this,n=e.layoutController;return r.oldParaBoxIsFirst=ch.isFirstParaOfDoc(e.layoutBox,n),r.oldPrevParaBoxIsFirst=ds(e.layoutBox.prevSibling)&&ch.isFirstParaOfDoc(e.layoutBox.prevSibling,n),r.oldPrevParaBoxIsFirst&&ds(e.layoutBox.prevSibling)&&(r.oldPrevParaProps=e.layoutBox.prevSibling.paraProps),r}return Wu(r,t),r.prototype.shouldComponentUpdate=function(e){return this.props.layoutBox.uuid!==e.layoutBox.uuid||this.props.overlayNode!==e.overlayNode||!this.props.lazyRenderInfo.equal(e.lazyRenderInfo)||this.props.force!==e.force||this.shouldUpdatePlaceholder(e.layoutBox)},r.prototype.shouldUpdatePlaceholder=function(e){this.updateLinePlaceholder=!1;var t=e.prevSibling,r=this.props.layoutController,n=ch.isFirstParaOfDoc(e,r),o=ds(t)&&ch.isFirstParaOfDoc(t,r);return n===this.oldParaBoxIsFirst&&o===this.oldPrevParaBoxIsFirst||(this.oldParaBoxIsFirst=n,this.oldPrevParaBoxIsFirst=o,this.updateLinePlaceholder=!0),o&&ds(t)&&this.oldPrevParaProps&&!t.paraProps.equalTo(this.oldPrevParaProps)&&(this.oldPrevParaProps=t.paraProps,this.updateLinePlaceholder=!0),this.updateLinePlaceholder},r.prototype.render=function(){var t=this,r=this.props,n=r.layoutBox,o=r.overlayNode,i=r.lazyRenderInfo,a=Yu(r,["layoutBox","overlayNode","lazyRenderInfo"]);this.lastBoxId!==n.uuid&&(this.cssStyle=Vu(Vu({},oh.boxSize(n)),oh.boxBorder(n)));var s=this.props.shares.decoratorManager.getBoxDecorators(e.BoxKind.Paragraph),p=null==s?void 0:s.decorateStyle(n),l=new Vh(i);return u.default.createElement("div",{className:Eh,style:Vu({},this.cssStyle),ref:this.rootRef},i.isLoaded&&n.children.map((function(e,r){var n=l.getUnloadBoxNode(e,r,"melo-line-placeholder");return void 0!==n?n:u.default.createElement(Wh,Vu({key:r,layoutBox:e,overlayNode:o.childAt(r),lazyRenderInfo:i.childAt(r),overrideStyle:p},a,{updateLinePlaceholder:t.updateLinePlaceholder}))})))},r}(Zu),qh=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={offsetX:0,rowGuiderShow:!1,rowGuiderY:0,colGuiderShow:!1,colGuiderX:0,mouseStart:0},t.removeHanlder=null,t.onRowDraggerMouseDown=function(e){e.stopPropagation(),t.setState({rowGuiderShow:!0,rowGuiderY:t.props.clientY,mouseStart:e.clientY}),t.attachMouseMoveAndUpEvent(t.onRowDraggerMouseMove,t.onRowDraggerMouseUp)},t.onRowDraggerMouseMove=function(e){if(t.state.rowGuiderShow){e.stopPropagation();var r=e.clientY-t.state.mouseStart;r+t.valueRangeStart>20&&t.setState({rowGuiderY:t.props.clientY+r})}},t.onRowDraggerMouseUp=function(e){e.stopPropagation();var r=t.state.rowGuiderY-t.props.clientY;t.props.onFinish&&t.props.onFinish(r/t.zoom,e.clientY/t.zoom),t.setState({rowGuiderShow:!1})},t.onColDraggerMouseDown=function(e){var r=e.clientX;if(t.props.box){var n=t.props.box.__node__;if(n&&n.getBoundingClientRect&&0===n.cellIndex){var o=n.getBoundingClientRect();r-o.left<o.right-r&&(r=o.left)}}e.stopPropagation(),t.setState({colGuiderShow:!0,colGuiderX:t.props.clientX,mouseStart:r}),t.attachMouseMoveAndUpEvent(t.onColDraggerMouseMove,t.onColDraggerMouseUp)},t.onColDraggerMouseMove=function(e){if(t.state.colGuiderShow){e.stopPropagation();var r=e.clientX-t.state.mouseStart-1;r+t.valueRangeStart>20&&(!t.valueRangeEnd||r+t.valueRangeStart<t.valueRangeEnd)&&t.setState({colGuiderX:t.props.clientX+r})}},t.onColDraggerMouseUp=function(e){e.stopPropagation();var r=t.state.colGuiderX-t.props.clientX;t.props.onFinish&&t.props.onFinish(r/t.zoom,e.clientX/t.zoom),t.setState({colGuiderShow:!1})},t}return Wu(t,e),t.prototype.componentWillUnmount=function(){this.removeMouseHandler()},Object.defineProperty(t.prototype,"zoom",{get:function(){return this.props.zoom||1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rowDraggerStyle",{get:function(){var e=this.props,t=e.edge,r=e.clientY;if("none"!==t&&(("top"===t||"bottom"===t)&&(this.state.rowGuiderShow?this.state.rowGuiderY:r)/this.zoom>0))return{top:((this.state.rowGuiderShow?this.state.rowGuiderY:r)-3.5)/this.zoom};return{display:"none"}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"colDraggerStyle",{get:function(){var e=this.props,t=e.edge,r=e.clientX;return!("none"!==t)||"left"!==t&&"right"!==t?{display:"none"}:{left:(r-3.5+(this.props.marginLeft||0))/this.zoom}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rowGuiderStyle",{get:function(){return{display:this.state.rowGuiderShow?"block":"none",top:this.state.rowGuiderY/this.zoom}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"colGuiderStyle",{get:function(){return{display:this.state.colGuiderShow?"block":"none",left:(this.state.colGuiderX+(this.props.marginLeft||0))/this.zoom}},enumerable:!0,configurable:!0}),t.prototype.attachMouseMoveAndUpEvent=function(e,t){var r=this,n=document.body,o=function(e,t,r){return e.addEventListener(t,r),function(){e.removeEventListener(t,r)}},i=o(n,"mousemove",(function(t){t.clientX<100||t.clientX>n.clientWidth-100?(r.removeMouseHandler(),r.setState({rowGuiderShow:!1,colGuiderShow:!1})):e(t)})),a=o(n,"mouseup",(function(e){t(e),r.removeMouseHandler()}));this.removeHanlder=function(){i(),a()}},t.prototype.removeMouseHandler=function(){this.removeHanlder&&(this.removeHanlder(),this.removeHanlder=null)},Object.defineProperty(t.prototype,"valueRangeStart",{get:function(){return this.props.valueRange&&this.props.valueRange.length>0&&this.props.valueRange[0]||0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"valueRangeEnd",{get:function(){return this.props.valueRange&&this.props.valueRange.length>1&&this.props.valueRange[1]||0},enumerable:!0,configurable:!0}),t.prototype.render=function(){var e="",t="";return this.props.rect&&(e=this.props.rect.width+"px",t=this.props.rect.height+"px"),u.default.createElement("div",null,u.default.createElement("div",null,u.default.createElement("div",{className:Fh,style:Vu(Vu({},this.rowDraggerStyle),{width:e}),onMouseDown:this.onRowDraggerMouseDown}),u.default.createElement("div",{className:Ah,style:Vu(Vu({},this.rowGuiderStyle),{width:e})})),u.default.createElement("div",null,u.default.createElement("div",{className:Kh,style:Vu(Vu({},this.colDraggerStyle),{height:t}),onMouseDown:this.onColDraggerMouseDown}),u.default.createElement("div",{className:Gh,style:Vu(Vu({},this.colGuiderStyle),{height:t})})))},t}(u.default.Component);(zh=e.RenderNotificationTypes||(e.RenderNotificationTypes={})).CARET_CHANGE="caret_change",zh.CONTAINER_FOCUS="container_foucus",zh.CONTEXT_MENU_EVENT="context_menu",zh.CONTEXT_MENU_MOBILE_EVENT="context_menu_mobile",zh.FIRST_RENDER="first_render",zh.HEADERFOOTER_DBCLICK="headerfooter_dbclick",zh.IMAGE_LAZY_LOAD="image_lazy_load",zh.IMAGE_RESIZE="image_resize",zh.IMAGE_SIZE_INIT="image_size_init",zh.PAGEGAP_DBCLICK="pagegap_dbclick",zh.RENDER_FINISH="render_finish",zh.RENDER_FINISH_TABLE="render_finish_table",zh.RENDER_LAYOUT_CHANGE="render_layout_change",zh.RENDER_RANGE="render_range",zh.SCROLLABLE_RESIZE="scrollable_resize",zh.SELECTION_CHANGE="selection_change",zh.SELECTION_END="selection_end",zh.SEL_TABLE="sel_table",zh.SHOW_TABLE_ICON="show_table_icon",zh.SPLITLINE_CLICK="splitline_click",zh.TABLE_ROW_COL_CHANGE="table_row_col_change",zh.UPDATE_COVERED_PANEL="udpate_covered_panel",zh.UPDATE_KEYBOARD_HEIGHT="update_keyboard_height",zh.PLUGIN_CONTAINER_WILL_FOCUS="plugin_container_will_focus",zh.LOCATION_CLICK="location_click",zh.FULL_RENDER="full_render",zh.FULL_RENDER_FINISH="full_render_finish",zh.TABLE_DID_SCROLL="table_did_scroll",zh.SEARCH_DIALOG="search_dialog",zh.PAGE_MOUSE_EVENT="page_mouse_event",zh.PAGE_TOUCH_EVENT="page_touch_event";var Xh,Jh,Zh=function(t){function r(r,n,o,i,a){var s=t.call(this,e.RenderNotificationTypes.TABLE_ROW_COL_CHANGE)||this;return s.firstIndex=r,s.twips=n,s.edge=o,s.diffLeft=i,s.diffRight=a,s}return Wu(r,t),r}(r.Notification),Qh=function(t){function r(r){var n=t.call(this,e.RenderNotificationTypes.SEL_TABLE)||this;return n.firstIndex=r,n}return Wu(r,t),r}(r.Notification),$h=function(t){function r(r,n,o){var i=t.call(this,e.RenderNotificationTypes.SHOW_TABLE_ICON)||this;return i.firstIndex=r,i.show=n,i.isSelected=o,i}return Wu(r,t),r}(r.Notification),ef=function(t){function r(r){var n=t.call(this,e.RenderNotificationTypes.TABLE_DID_SCROLL)||this;return n.firstIndex=r,n}return Wu(r,t),r}(r.Notification),tf=function(t){function r(){return t.call(this,e.RenderNotificationTypes.RENDER_FINISH)||this}return Wu(r,t),r}(r.Notification),rf=function(t){function r(){return t.call(this,e.RenderNotificationTypes.FIRST_RENDER)||this}return Wu(r,t),r}(r.Notification),nf=function(t){function r(){return t.call(this,e.RenderNotificationTypes.RENDER_LAYOUT_CHANGE)||this}return Wu(r,t),r}(r.Notification),of=function(t){function r(){return t.call(this,e.RenderNotificationTypes.FULL_RENDER)||this}return Wu(r,t),r}(r.Notification),af=function(t){function r(){return t.call(this,e.RenderNotificationTypes.FULL_RENDER_FINISH)||this}return Wu(r,t),r}(r.Notification),sf=function(t){function r(r,n,o){var i=t.call(this,e.RenderNotificationTypes.SELECTION_CHANGE)||this;return i.viewRange=r,i.zoom=n,i.option=o,i}return Wu(r,t),r}(r.Notification),pf=function(t){function r(r){var n=t.call(this,e.RenderNotificationTypes.SELECTION_END)||this;return n.viewRange=r,n}return Wu(r,t),r}(r.Notification),lf=function(t){function r(r,n){var o=t.call(this,e.RenderNotificationTypes.CARET_CHANGE)||this;return o.viewRange=r,o.option=n,o}return Wu(r,t),r}(r.Notification),cf=function(t){function r(r,n,o,i){var a=t.call(this,e.RenderNotificationTypes.CONTAINER_FOCUS)||this;return a.focus=r,a.doubleClick=n,a.focusedContainer=o,a.currentContainer=o,a.isDoubleClick=n,a.isLeftMouse=i,a}return Wu(r,t),r}(r.Notification),uf=function(t){function r(r,n,o,i){var a=t.call(this,e.RenderNotificationTypes.IMAGE_SIZE_INIT)||this;return a.height=r,a.width=n,a.first=o,a.last=i,a.imageHeight=0,a.imageWidth=0,a.imageHeight=r,a.imageWidth=n,a.firstIndex=o,a.lastIndex=i,a}return Wu(r,t),r}(r.Notification);(Xh=e.FocusBlurNotificationType||(e.FocusBlurNotificationType={})).ON_FOCUS="on_focus",Xh.ON_BLUR="on_blur",Xh.REQUEST_FOCUS="request_focus",Xh.REQUEST_BLUR="request_blur",(Jh=e.From||(e.From={}))[Jh.KEYBOARD_BUTTON=0]="KEYBOARD_BUTTON",Jh[Jh.STYLE_PANEL_BUTTON=1]="STYLE_PANEL_BUTTON",Jh[Jh.EDITOR=2]="EDITOR",Jh[Jh.TABLE_SCROLL=3]="TABLE_SCROLL",Jh[Jh.CONTAINER=4]="CONTAINER",Jh[Jh.LIST_STYLE_BUTTON=5]="LIST_STYLE_BUTTON",Jh[Jh.ALIGN_STYLE_BUTTON=6]="ALIGN_STYLE_BUTTON",Jh[Jh.MOBILE_HEADER_CONTROL=7]="MOBILE_HEADER_CONTROL";var hf,ff=function(e){function t(t,r){var n=e.call(this,t)||this;return n.data=r,n}return Wu(t,e),t}(r.Notification),df=function(t){function r(){return t.call(this,e.RenderNotificationTypes.SCROLLABLE_RESIZE)||this}return Wu(r,t),r}(r.Notification),gf=function(t){function r(r){var n=t.call(this,e.RenderNotificationTypes.SEARCH_DIALOG)||this;return n.searchDialogShow=r,n}return Wu(r,t),r}(r.Notification),yf=function(t){function r(r){var n=t.call(this,e.RenderNotificationTypes.CONTEXT_MENU_EVENT)||this;return n.event=r,n}return Wu(r,t),r}(r.Notification),mf=function(t){function r(r){var n=t.call(this,e.RenderNotificationTypes.CONTEXT_MENU_MOBILE_EVENT)||this;return n.viewRange=r,n}return Wu(r,t),r}(r.Notification),bf=function(t){function r(r,n,o,i){var a=t.call(this,e.RenderNotificationTypes.HEADERFOOTER_DBCLICK)||this;return a.isHeader=r,a.shouldInsert=n,a.lastRange=o,a.range=i,a}return Wu(r,t),r}(r.Notification),Pf=function(t){function r(r){var n=t.call(this,e.RenderNotificationTypes.UPDATE_KEYBOARD_HEIGHT)||this;return n.keyboardHeight=r,n}return Wu(r,t),r}(r.Notification),vf=function(t){function r(r){var n=t.call(this,e.RenderNotificationTypes.UPDATE_COVERED_PANEL)||this;return n._coverState=r||n.hiddenState,n}return Wu(r,t),Object.defineProperty(r.prototype,"hiddenState",{get:function(){return{height:-1,withToolbar:!0}},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"coverState",{get:function(){return this._coverState},enumerable:!0,configurable:!0}),r}(r.Notification),xf=function(t){function r(){return t.call(this,e.RenderNotificationTypes.PLUGIN_CONTAINER_WILL_FOCUS)||this}return Wu(r,t),r}(r.Notification);(hf=e.ZoomNotificationType||(e.ZoomNotificationType={})).ZOOM_START="ZOOM_START",hf.ZOOM_FINISH="ZOOM_FINISH";var Tf=function(e){function t(t,r,n){var o=e.call(this,t)||this;return o.prev=r,o.next=n,o}return Wu(t,e),t}(r.Notification),_f=function(t){function r(r){var n=t.call(this,e.RenderNotificationTypes.PAGE_TOUCH_EVENT)||this;return n.event=r,n}return Wu(r,t),r}(r.Notification),Sf=function(t){function r(r){var n=t.call(this,e.RenderNotificationTypes.PAGE_MOUSE_EVENT)||this;return n.event=r,n}return Wu(r,t),r}(r.Notification),Cf=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onMouseUp=function(){t.props.selTable()},t.onTouchEnd=function(){t.props.selTable()},t}return Wu(t,e),t.prototype.render=function(){return u.default.createElement("div",{className:Hh,style:{display:this.props.show?"block":"none",marginLeft:r.twipsToPx(this.props.marginLeft)},onMouseUp:this.onMouseUp,onTouchEnd:this.onTouchEnd},u.default.createElement("svg",{className:jh,width:"27px",height:"27px",viewBox:"0 0 27 27",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},u.default.createElement("g",{id:"-13",stroke:"none",strokeWidth:"1",fill:"none",fillRule:"evenodd"},u.default.createElement("g",null,u.default.createElement("circle",{id:"-copy-2",cx:"13.5",cy:"13.5",r:"13.5"}),u.default.createElement("g",{id:"-5",transform:"translate(4.000000, 4.000000)",fill:"#5C5C5C"},u.default.createElement("g",{id:"move_icon"},u.default.createElement("g",{id:"-5-copy-3",transform:"translate(0.000000, 6.000000)"},u.default.createElement("rect",{id:"",x:"1",y:"3",width:"17",height:"1"}),u.default.createElement("polygon",{id:"",fillRule:"nonzero",points:"4 6.22222222 3.27272727 7 0 3.5 3.27272727 0 4 0.777777778 1.45454545 3.5"}),u.default.createElement("polygon",{id:"-copy",fillRule:"nonzero",transform:"translate(17.000000, 3.500000) scale(-1, 1) translate(-17.000000, -3.500000) ",points:"19 6.22222222 18.2727273 7 15 3.5 18.2727273 0 19 0.777777778 16.4545455 3.5"})),u.default.createElement("g",{id:"-5-copy-4",transform:"translate(9.500000, 9.500000) rotate(-270.000000) translate(-9.500000, -9.500000) translate(0.000000, 6.000000)"},u.default.createElement("rect",{id:"",x:"1",y:"3",width:"17",height:"1"}),u.default.createElement("polygon",{id:"",fillRule:"nonzero",points:"4 6.22222222 3.27272727 7 0 3.5 3.27272727 0 4 0.777777778 1.45454545 3.5"}),u.default.createElement("polygon",{id:"-copy",fillRule:"nonzero",transform:"translate(17.000000, 3.500000) scale(-1, 1) translate(-17.000000, -3.500000) ",points:"19 6.22222222 18.2727273 7 15 3.5 18.2727273 1.8369702e-16 19 0.777777778 16.4545455 3.5"}))))))))},t}(u.default.PureComponent),Bf=function(e){function t(t,r,n,o){var i=e.call(this,t,r,n)||this;return i.rootBox=t,i.orderRanges=r,i.indexPairToCPPair=n,i.storyId=o,i}return Wu(t,e),t.prototype.getRanges=function(){return this.orderRanges.getRanges(this.storyId)},t.prototype.diffFrom=function(e){return this.orderRanges.diffWithStoryId(e,this.storyId)},t}(function(){function e(e,t,r){this.rootBox=e,this.orderRanges=t,this.indexPairToCPPair=r,this.root=$u,this.map=new Map;var n=this.getRanges();n.length&&(this.root=this.buildTree(e,n))}return e.prototype.getRanges=function(){return this.orderRanges.ranges},e.prototype.getRoot=function(){return this.root},e.prototype.reset=function(e){this.rootBox=e,this.root=$u,this.orderRanges.reset(),this.map.clear()},e.prototype.buildTree=function(e,t){var r=this,n=t.filter((function(t){return r.hitRange(e,t)}));if(!n.length)return $u;var o=this.map.get(e.uuid);if(o)return o;if(o=new eh(e.uuid),this.map.set(e.uuid,o),o.colored=!0,gs(e))return o;var i=e.children;return ps(e)&&(i=[e.mainPage,e.headerPage,e.footerPage]),i.forEach((function(e){var t=r.buildTree(e,n);o.append(t)})),o},e.prototype.boxUpdate=function(e){var t=this;this.root=this.buildTree(e,this.getRanges());var r=new Map,n=function(e){var o=e.uuid,i=t.map.get(o);r.set(o,i),e.size&&e.children.forEach((function(e){e!==$u&&n(e)}))};this.root!==$u&&n(this.root),this.map=r,this.rootBox=e},e.prototype.rangesUpdate=function(e){var t=this,r=function(e,n,o){var i=o.local.filter((function(r){return t.hitRange(e,r)})),a=o.income.filter((function(r){return t.hitRange(e,r)})),s=o.share.filter((function(r){return t.hitRange(e,r)}));if(!i.length&&!a.length)return n;if(!a.length&&!s.length)return t.map.delete(e.uuid),$u;if(i.length===a.length){var p=i.filter((function(r){return t.inRange(e,r)})),l=a.filter((function(r){return t.inRange(e,r)}));if(p.length&&l.length&&p.length===l.length)return n}var c=new eh(e.uuid);if(c.colored=!0,t.map.set(e.uuid,c),gs(e))return c;var u=e.children;return ps(e)&&(u=[e.mainPage,e.headerPage,e.footerPage]),u.forEach((function(e,t){var o=r(e,n.childAt(t)||$u,{local:i,income:a,share:s});c.append(o)})),c},n=this.diffFrom(e);this.root=r(this.rootBox,this.root,n),this.orderRanges=e},e.prototype.diffFrom=function(e){return this.orderRanges.diff(e)},e.prototype.hitRange=function(e,t){var r=this,n=!1;return!!ss(e)||(ps(e)?n=(n=(n=n||this.hitRange(e.mainPage,t))||this.hitRange(e.headerPage,t))||this.hitRange(e.footerPage,t):e.indexPairs.some((function(e){var n=r.indexPairToCPPair(e);return n.first>=t.first&&n.first<=t.last||t.first>=n.first&&t.first<=n.last})))},e.prototype.inRange=function(e,t){var r=this,n=!1;return n=!ss(e)&&(ps(e)?(n=(n=n||this.inRange(e.mainPage,t))||this.inRange(e.headerPage,t))||this.inRange(e.footerPage,t):e.indexPairs.every((function(e){var n=r.indexPairToCPPair(e);return n.first>=t.first&&n.last<=t.last})))},e}()),Rf=function(e,t){return e.first<t.first||e.first===t.first&&e.last<t.last?-1:e.first===t.first&&e.last===t.last?0:1},wf=function(e){function t(t,r){var n=e.call(this,r)||this;return n.findStoryRange=t,n}return Wu(t,e),t.prototype.getRanges=function(e){return e&&this.length?this.findStoryRange(e,this._ranges):this._ranges},t.prototype.makeOrderRanges=function(e){return new t(this.findStoryRange,e)},t.prototype.diffWithStoryId=function(e,t){return m(this.findStoryRange(t,this.ranges),this.findStoryRange(t,e.ranges),this.comparator)},t}(function(){function e(e){this.comparator=Rf,this._ranges=e||[]}return Object.defineProperty(e.prototype,"ranges",{get:function(){return this._ranges},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this._ranges.length},enumerable:!0,configurable:!0}),e.prototype.init=function(e){this._ranges=Ju(e)},e.prototype.safeInit=function(e){for(var t,r=e.length-1;r>=0;r--){for(var n=!1,o=0;o<r;o++)e[o].first>e[o+1].first&&(t=Xu([e[o+1],e[o]],2),e[o]=t[0],e[o+1]=t[1],n=!0);if(!n)break}this._ranges=Ju(e)},e.prototype.reset=function(){this._ranges=[]},e.prototype.makeOrderRanges=function(t){return new e(t)},e.prototype.concat=function(e){var t=P(this.ranges,e.ranges,this.comparator);return this.makeOrderRanges(t)},e.prototype.diff=function(e){return m(this.ranges,e.ranges,this.comparator)},e.prototype.remove=function(e){for(var t=this._ranges,r=Ju(e._ranges),n=0;r.length&&n<t.length;)for(var o=r.shift();n<t.length;n++)0===this.comparator(t[n],o)&&t.splice(n,1)},e}());var If=function(){function t(t,r,n){var o=this;this.context=t,this.state=r,this.layoutController=n,this.overlays=[],this.overlayCallback=function(){return!!o.layoutNotChange()&&(o.onUpdate(),!0)},this.overlayTrees=new Map,this.watcheres=[],this.indexToPair=function(e){return o.layoutController.boxHelper.getGCPPair(e)},this.storyRangeFinder=function(t,r){if(!r.length)return r;var n,i,a=function(e,t){return e.first>=t.first&&e.last<=t.last};if(t===e.StoryID.MainDocId){var s=o.layoutController.storyBoxMgr;if(0===s.storyNumber)return r;var p=o.state.getTextStream().findStoryInfoFromId(t),l={first:p.range.begin(),last:p.range.end()-1};if(r[0].first>=l.first&&r[r.length-1].last<=l.last)return r;var c=s.getHeaderFooterIds(),u=[];return c.forEach((function(e){var t=o.state.getTextStream().findStoryInfoFromId(e);if(t){var r={first:t.range.begin(),last:t.range.end()-1};u.push(r)}})),(n=l,(i=u).length?function(e){return e.filter((function(e){return a(e,n)||i.some((function(t){return a(e,t)}))}))}:function(e){return e.filter((function(e){return a(e,n)}))})(r)}var h=o.state.getTextStream().findStoryInfoFromId(t);if(!h)return[];var f={first:h.range.begin(),last:h.range.end()-1};return r[r.length-1].last<f.first||r[0].first>f.last?[]:r.filter((function(e){return a(e,f)}))},this.onCoreSelectionChange=function(e){o.overlays.forEach((function(t){t.onCoreSelectionChagne(e)})),o.layoutNotChange()&&o.onUpdate()};var i=n.getLayoutBox(),a=e.StoryID.MainDocId,s=new Bf(i,new wf(this.storyRangeFinder),this.indexToPair,a);this.overlayTrees.set(a,s),this.rootBoxId=i.uuid,t.on(e.StateNotification.CoreSelectionChange,this.onCoreSelectionChange)}return t.prototype.layoutNotChange=function(){return this.rootBoxId===this.layoutController.getLayoutBox().uuid},t.prototype.addOverlay=function(e){e.setCallback(this.overlayCallback),this.overlays.push(e)},t.prototype.onUpdate=function(){var t=this,n=r.PerfUtil.now(),o=new wf(this.storyRangeFinder);this.overlays.forEach((function(e){var r,n;o=o.concat(new wf(t.storyRangeFinder,(r=e.getRanges(),n=[],r.forEach((function(e){e.len>0&&n.push({first:e.begin(),last:e.end()-1})})),n)))})),this.overlayTrees.forEach((function(e){e.rangesUpdate(o)})),this.watcheres.forEach((function(e){e()})),this.overlays.forEach((function(e){e.afterDocumentRender()})),(n=r.PerfUtil.now()-n)>30&&r.Logger.log("perf|overlay update "+n+"ms"),this.context.perfHandler.costTime[e.EditMetric.Overlay]=n},t.prototype.onNewDocument=function(){this.overlays.forEach((function(e){e.reset()}));var t=e.StoryID.MainDocId,r=this.overlayTrees.get(t);r.reset(this.layoutController.getLayoutBox()),this.overlayTrees.clear(),this.overlayTrees.set(t,r)},t.prototype.getOverlayNode=function(e){var t=this.overlayTrees.get(e);return t?t.getRoot():$u},t.prototype.addWatcher=function(e){this.watcheres.push(e)},t.prototype.removeWatcher=function(e){var t=this.watcheres.indexOf(e);t&&this.watcheres.splice(t,1)},t.prototype.onLayoutChanged=function(){var t=this;this.rootBoxId=this.layoutController.getLayoutBox().uuid;var r=this.layoutController.storyBoxMgr,n=new Map;r.readStoryBox((function(e,r){if(ms(e)&&e.content){var o=t.overlayTrees.get(r);o?o.boxUpdate(e.content):o=new Bf(e.content,new wf(t.storyRangeFinder),t.indexToPair,r),n.set(r,o)}}));var o=e.StoryID.MainDocId,i=this.overlayTrees.get(o);i.boxUpdate(this.layoutController.getLayoutBox()),n.set(o,i),this.overlayTrees=n,this.overlays.forEach((function(e){e.onLayoutChanged()})),this.onUpdate()},t.prototype.buildLineOverlay=function(e,t,r,n){var o=[];return this.overlays.forEach((function(i,a){var s=i.renderOverlay(e,t,r,n,a);s&&o.push(s)})),o},t.prototype.zoom=function(e){this.overlays.forEach((function(t){return t.zoom=e}))},t}();function Ef(e,t){return e.gcp===t.gcp?e.charsOffset<t.charsOffset:e.gcp>t.gcp}var Lf=function(){function e(){}return Object.defineProperty(e.prototype,"archorPoint",{get:function(){return this.archor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"forcusPoint",{get:function(){return this.focus},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"backward",{get:function(){return!(!this.archor||!this.focus)&&Ef(this.archor,this.focus)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gcpRange",{get:function(){if(!this.archor||!this.focus)return ne.emptyRange();var e=Math.min(this.archor.gcp,this.focus.gcp),t=Math.abs(this.archor.gcp-this.focus.gcp);return new ne(e,t)},enumerable:!0,configurable:!0}),e.prototype.getViewRange=function(){if(this.archor&&this.focus)return this.backward?new kf(this.focus,this.archor):new kf(this.archor,this.focus)},e.prototype.setViewRange=function(e){this.setBaseAndExtent(e.start,e.end)},e.prototype.setBaseAndExtent=function(e,t){this.archor=e,this.focus=t},e.prototype.removeAll=function(){this.archor=void 0,this.focus=void 0},e}();function Of(e,t){function r(e){for(var t=e;t;){if(xs(t))return t;t=t.parentBox}}function n(e){for(var t=e;t&&t.prevBreakSibling;)t=t.prevBreakSibling;return t}var o=r(e.leafBox),i=r(t.leafBox);if(o&&i){var a=n(o),s=n(i);return a!==s?[a,s]:[a]}return[]}function Nf(e,t,r){if(e instanceof Element)return e.getBoundingClientRect();var n=document.createRange();return n.setStart(e,t),n.setEnd(e,r>e.length?e.length:r),n.getBoundingClientRect()}var kf=function(){function e(e,t){this.start=e,this.end=e.gcp<t.gcp?t:e}return e.prototype.isCaret=function(){return!(!this.start||!this.end)&&this.start.equals(this.end)},e.prototype.getGCPRange=function(){if(this.start&&this.end){var e=this.end.gcp,t=this.start.gcp,r=Xu(Of(this.start,this.end),2),n=r[0],o=r[1];return n&&o&&this.end.leafBox.lastIndex<=o.lastIndex&&(this.end.leafBox instanceof il&&1===this.end.charsOffset||(e+=1),this.start.leafBox instanceof il&&0===this.start.charsOffset||(t-=1)),new ne(t,e-t)}return ne.emptyRange()},Object.defineProperty(e.prototype,"documentRange",{get:function(){var e=document.createRange(),t=this.start.leafBox.__node__,r=this.end.leafBox.__node__;return t&&r?(t.firstChild&&t.firstChild.nodeType===Node.TEXT_NODE&&(t=t.firstChild),r.firstChild&&r.firstChild.nodeType===Node.TEXT_NODE&&(r=r.firstChild),e.setStart(t,this.start.charsOffset),e.setEnd(r,this.end.charsOffset),e):null},enumerable:!0,configurable:!0}),e.prototype.isValid=function(){return this.start.isValid()&&this.end.isValid()},e.prototype.equals=function(e){return e&&this.start.equals(e.start)&&this.end.equals(e.end)},e}(),Mf=function(){function t(e,t,r,n){this.leafBox=e,this.charsOffset=t,this.gcp=r,this.pos=n,this._cacheZoomLevel=0}return t.prototype.isValid=function(){return!this.leafBox.isDirty()},t.prototype.getDocumentOffset=function(t){if(void 0===t&&(t=1),this._cacheZoomLevel===t&&this._cacheDocumentOffset)return this._cacheDocumentOffset;this._cacheZoomLevel=t;var n,o=0,i=0,a=this.documentBox;if(a&&a.__node__&&(n=a.__node__),!n)return r.Logger.error("find melo-page-view failed"),{x:0,y:0,docLeft:0,docTop:0,docRight:0,docBottom:0};var s=n.getBoundingClientRect(),p=this.getLeafDomForLineBase();if(p){var l=p.getBoundingClientRect(),c=this.leafBox&&Ps(this.leafBox)?p.offsetHeight-this.caretHeight():0;this.leafBox&&this.leafBox.parentBox&&ys(this.leafBox.parentBox)&&(c=(p.offsetHeight-this.caretHeight())/2),o=(l.left-s.left)/t,i=(l.top-s.top)/t+c}else{var u=Il.getOffsetPoint(this.leafBox,e.BoxKind.Document),f=u.x,d=u.y;o=r.twipsToPx(f),i=r.twipsToPx(d);var g=h.getScrollOffset(this.leafBox.__node__,n);o-=g.scrollX,i-=g.scrollY}var y=this.posOffset(t);return void 0!==y&&(o+=y),o+=n.offsetLeft,i+=n.offsetTop,o=Math.round(o),i=Math.round(i),this._cacheDocumentOffset={x:o,y:i,docLeft:n.offsetLeft,docTop:n.offsetTop,docRight:n.offsetLeft+n.offsetWidth,docBottom:n.offsetTop+n.offsetHeight},this._cacheDocumentOffset},t.prototype.getLeafDomForLineBase=function(){if(ys(this.leafBox.parentBox)||this.leafBox.__node__)return ys(this.leafBox.parentBox)?this.leafBox.parentBox.__node__:this.leafBox.__node__},t.prototype.getLineDocumentOffset=function(t){void 0===t&&(t=1);var n=this.lineBox;if(!gs(n))return this.getDocumentOffset(t);if(this._cacheZoomLevel===t&&this._cacheLineDocumentOffset)return this._cacheLineDocumentOffset;this._cacheZoomLevel=t;var o,i=0,a=0,s=this.documentBox;if(s&&s.__node__&&(o=s.__node__),!o)return r.Logger.error("find melo-page-view failed"),{x:0,y:0,docLeft:0,docTop:0,docRight:0,docBottom:0};var p=o.getBoundingClientRect(),l=n.__node__;if(gs(n)&&l){var c=l.getBoundingClientRect();i=(c.left-p.left)/t,a=(c.top-p.top)/t}else{var u=Il.getOffsetPoint(n,e.BoxKind.Document),f=u.x,d=u.y;i=r.twipsToPx(f),a=r.twipsToPx(d);var g=h.getScrollOffset(l,o);i-=g.scrollX,a-=g.scrollY}var y=this.posOffset(t);return void 0!==y&&(i+=y),i+=o.offsetLeft,a+=o.offsetTop,this._cacheLineDocumentOffset={x:i,y:a,docLeft:o.offsetLeft,docTop:o.offsetTop,docRight:o.offsetLeft+o.offsetWidth,docBottom:o.offsetTop+o.offsetHeight},this._cacheLineDocumentOffset},t.prototype.getWindowOffset=function(){var e=this.leafBox.__node__;if(e){var t;if(0===this.charsOffset)return{x:(t=e.getBoundingClientRect()).left,y:t.top};if(this.endOfBox())return{x:(t=e.getBoundingClientRect()).right,y:t.top};var n=Nf(e.firstChild,0,this.charsOffset);return{x:n.right,y:n.top}}r.Logger.warn("view range cannot find leaf node")},t.prototype.posOffset=function(e){if(void 0===e&&(e=1),!this.pos)if(this.leafBox.parentBox&&ys(this.leafBox.parentBox))this.pos=this.leafBox===this.leafBox.parentBox.lastChild?r.twipsToPx(this.leafBox.parentBox.borderBoxSize.width):0;else if(0===this.charsOffset)this.pos=0;else if(this.endOfBox())this.pos=r.twipsToPx(this.leafBox.borderBoxSize.width);else{var t=this.leafBox.__node__;if(t){var n=Nf(t.firstChild,0,this.charsOffset);this.pos=n.width/e}else r.Logger.warn("view range cannot find leaf node")}return this.pos},t.prototype.endOfBox=function(){return bs(this.leafBox)&&this.charsOffset===new n.UString(this.leafBox.text).graphemeCount()||!bs(this.leafBox)&&1===this.charsOffset},t.prototype.caretHeight=function(){var t=r.twipsToPx(330);if(this.leafBox&&Ps(this.leafBox))return this.leafBox.glyph&&this.leafBox.glyph.height?r.twipsToPx(this.leafBox.glyph.height):t;if(this.leafBox&&this.leafBox.parentBox&&this.leafBox instanceof sl&&this.leafBox.charType===e.FieldCharType.End&&this.leafBox.prevSibling&&this.leafBox.prevSibling instanceof nl)return this.leafBox.prevSibling.glyph&&this.leafBox.prevSibling.glyph.height?r.twipsToPx(this.leafBox.prevSibling.glyph.height):t;var n=this.getLeafDomForLineBase();if(n)return n.offsetHeight;var o=this.leafBox.rect.height;return!o&&this.leafBox.parentBox&&(o=this.leafBox.parentBox.rect.height),o?r.twipsToPx(o):t},Object.defineProperty(t.prototype,"documentBox",{get:function(){for(var e=this.leafBox.parentBox;e&&!ss(e);)e=e.parentBox;return e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lineBox",{get:function(){for(var e=this.leafBox.parentBox;e&&!gs(e);)e=e.parentBox;return e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lineHeight",{get:function(){return this.lineBox?r.twipsToPx(this.lineBox.totalHeight):0},enumerable:!0,configurable:!0}),t.prototype.linePosOffset=function(e){if(void 0===e&&(e=1),this._cacheZoomLevel===e&&this._cachedLinePosOffset)return this._cachedLinePosOffset;this._cacheZoomLevel=e;var t=this.posOffset(e);return this._cachedLinePosOffset=void 0!==t?t+this.calcLineOffset(this.leafBox):void 0,this._cachedLinePosOffset},t.prototype.equals=function(e){return this.leafBox===e.leafBox&&this.charsOffset===e.charsOffset},t.prototype.clone=function(){return new t(this.leafBox,this.charsOffset,this.gcp,this.pos)},t.prototype.clearCache=function(){this._cacheZoomLevel=0,this._cachedLinePosOffset=void 0,this._cacheDocumentOffset=void 0,this._cacheLineDocumentOffset=void 0},t.prototype.calcLineOffset=function(t){if(!this.lineBox)return 0;var n=Il.getOffsetPoint(t,e.BoxKind.TextLine),o=this.lineBox.edge,i=n.x+o.border.width.left+o.margin.left;return o.recycle(),r.twipsToPx(i)},t}();function Df(e,t){var n=e.storyBoxMgr;if(!n.storyNumber)return e.getLayoutBox();var o=n.getBoxByRange(t);return o?ms(o)&&o.content?o.content:void r.Logger.error("Find story box which has no content, story id="+o.storyId+"."):e.getLayoutBox()}function Ff(e,t,r,n){var o=!1;if(ss(e))o=!0;else if(ps(e))for(var i=[e.mainPage,e.headerPage,e.footerPage],a=0;a<i.length;a++){if(p=Ff(i[a],t,r,n))return p}else o=function(e,t,r){return e.indexPairs.some((function(e){var n=t(e);return r>=n.first&&r<=n.last}))}(e,t,r);if(o){if(os(e))return e;if(is(e)){if(n&&(cs(e)||us(e))){var s=e.parentBox&&e.parentBox.parentBox&&e.parentBox.parentBox.children[n];if(p=s&&Ff(cs(e)?s.headerPage:s.footerPage,t,r))return p}for(a=0;a<e.children.length;a++){var p;if(p=Ff(e.children[a],t,r,n))return p}}}}function Af(e,t,r,n){var o=Df(e,r);if(!o)return null;var i={first:r.begin(),last:r.end()},a=Ff(o,t,i.first,n);if(a){var s=t(a.indexPairs[0]),p=new Mf(a,i.first-s.first,i.first);if(p){var l=void 0;if(s.last>=i.last?l=a:(l=Ff(o,t,i.last>i.first?i.last-1:i.last,n))&&(s=t(l.indexPairs[0])),l){var c=new Mf(l,i.last-s.first,i.last);return new kf(p,c)}}}return null}function Kf(e,t){if(t.length()>1)return!1;if(bs(e)){var r=e.text.charCodeAt(0);return ho(r)||fo(r)}return!1}function Gf(e,t){function n(e){for(var t=e;t&&!os(t);)t=t.firstChild;return t}var o=e.content,i=n(o)||e;if(o)for(var a=e.__node__.getBoundingClientRect().top+r.twipsToPx(e.property.paddingTop),s=0;s<o.children.length;s++){var p=o.children[s],l=r.twipsToPx(p.rect.height);if(a+l>=t){i=n(p);break}a+=l}return i}var Hf=function(){function e(e,t){void 0===t&&(t=function(e){return e}),this.state=e,this.domPosToBoxPos=t}return e.prototype.findViewPoint=function(e,t,n,o,i){var a;if(void 0===o&&(o=!1),void 0===i&&(i=!1),n){for("melo-text-page"===n.className&&n.parentElement&&"melo-td"===n.parentElement.className&&(n=n.parentElement);!n.__vm__&&"melo-page-view"!==n.className&&n.parentElement;)n=n.parentElement;if(n.__vm__){var s=n.__vm__;if(o&&(ls(s)||fs(s)))return;a=this.findViewPointInBox(n,n.__vm__,e,t,i)}else a=this.findCloestViewPoint(n,e,t,i);return a}r.Logger.error("updatePosFromDomEvent element is null")},e.prototype.findViewPointInBox=function(e,t,r,n,o){var i;if(os(t))i=this.findViewPointInLeaf(t,r,n,o);else if(xs(t)&&t.isEmpty())for(var a=t.prevBreakSibling;a;){if(!a.isEmpty())for(var s=a;s;){if(gs(s))return this.viewPointInLine(s,r,n,o);s=is(s)&&s.lastChild||void 0}a=a.prevBreakSibling}else if(gs(t))i=this.viewPointInLine(t,r,n,o);else if(ys(t)){var p=t.children.find((function(e){return!e.hidden}));i=this.findViewPointInLeaf(p,r,n,o)}else i=this.findCloestViewPoint(e,r,n,o);return i},e.prototype.findViewPointInLeaf=function(e,t,r,n){void 0===r&&(r=0),void 0===n&&(n=!0);var o=e.__node__;if(o){var i=ph(this.state,e.firstIndex,e.lastIndex),a=o.getBoundingClientRect().left,s=h.getOffsetByPosition(o.firstChild,a,t-a),p=s.offsetUString,l=i.begin()+s.offsetUString,c=this.domPosToBoxPos(s.offsetPx);if(!n&&e instanceof il&&(p=0,l=i.begin(),c=0),this.isTextframeBox(e)){var u=Gf(e,r),f=u.__node__;if(!f)return;var d=f.getBoundingClientRect().left;return this.findViewPointInLeaf(u,d)}if(this.isTextLineFragmentBoxChild(e)){var g=e.parentBox.__node__.getBoundingClientRect(),y=g.left,m=g.right,b=m-t>t-y;return p=b?0:i.length(),c=b?0:m-y,new Mf(e,p,this.findNearestValidGcp(e,b),c)}return new Mf(e,p,l,c)}},e.prototype.findNearestValidGcp=function(e,t){var r=e.parentBox,n=r.firstIndex,o=r.lastIndex,i=ph(this.state,n,o);return t?i.begin():i.end()},e.prototype.isTextframeBox=function(e){return e&&ms(e)},e.prototype.isTextLineFragmentBoxChild=function(e){return e&&ys(e.parentBox)},e.prototype.viewPointInLine=function(e,t,r,n){for(var o=0;o<e.children.length;o++){var i=e.children[o];if(this.hit(i,t)){var a=void 0;if(ys(i)){for(var s=0;s<i.children.length;s++){var p=i.children[s];if(this.hit(p,t)){a=p;break}}if(!a)return}else i instanceof il||(a=i);if(a)return this.findViewPointInLeaf(a,t,r,n)}}var l=e.children[0].__node__;if(l){var c=l.getBoundingClientRect();return this.viewPointOfLine(e,t<c.left,n)}},e.prototype.hit=function(e,t){var r=e.__node__;if(!r)return!1;var n=r.getBoundingClientRect();return n.left<t&&n.right>t},e.prototype.findCloestViewPoint=function(e,t,r,n){var o=e.querySelectorAll(".melo-line");if(0!==o.length){var i=o[0].getBoundingClientRect().top,a=o[o.length-1].getBoundingClientRect().bottom;if(r<i)for(var s=0;s<o.length;s++){var p=this.viewPointOfLine(o[s].__vm__,!0,n);if(p)return p}else{if(r>a)return this.viewPointOfLine(o[o.length-1].__vm__,!1,n);for(var l=0;l<o.length;l++){var c=o[l],u=c.getBoundingClientRect();if(r<u.bottom){var h=c.__vm__;if(h&&h.totalHeight>0)return this.viewPointOfLine(h,t<u.left,n)}}}}},e.prototype.viewPointOfLine=function(e,t,n){var o=this;if(e){var i,a=t?e.children.slice(0).find((function(e){return!o.isHiddenLeafBox(e)})):e.children.slice(0).reverse().find((function(e){return!o.isHiddenLeafBox(e)}));if(ys(a)){if(i=(t?a.children:Ju(a.children).reverse()).find((function(e){return!e.hidden}))){var s=ph(this.state,i.firstIndex,i.lastIndex),p=i.parentBox.__node__.getBoundingClientRect(),l=p.left,c=p.right,u=t?0:s.length(),h=t?0:c-l;return new Mf(i,u,this.findNearestValidGcp(i,t),h)}}else i=a;if(i){s=ph(this.state,i.firstIndex,i.lastIndex);var f=t?0:s.length(),d=t?s.begin():s.begin()+s.length();return n||t||!Kf(i,s)||(f=0,d=s.begin()),new Mf(i,f,d)}}else r.Logger.warn("viewPointOfLine undefined lineBox")},e.prototype.isHiddenLeafBox=function(e){return!(!os(e)||!e.hidden)},e.prototype.getTableStream=function(){return this.state.getTextStream().tableStream},e.prototype.getSelection=function(){return this.state.selection},e}(),jf=function(){function e(e){this.finder=e,this.isMoving=!1,this.forceFocus=!0,this.lastRange=ne.emptyRange()}return e.prototype.updateBoth=function(e,t,r){var n=this.findViewPoint(e,t,r,!0,!1);n&&(this.start=n,this.end=n)},e.prototype.updateStart=function(e,t,r){var n=this.findViewPoint(e,t,r,!1,!1);n&&(this.start=n)},e.prototype.updateEnd=function(e,t,r){var n=!this.start||!this.end||!Ef(this.start,this.end),o=this.findViewPoint(e,t,r,!1,n);if(o&&(!this.end||!this.end.equals(o))){var i=this.finder.state.getTextStream().findStoryInfoFromGcp(this.start.gcp),a=this.finder.state.getTextStream().findStoryInfoFromGcp(o.gcp);i&&a&&i.storyProp.storyId===a.storyProp.storyId&&(this.end=o)}},e.prototype.updateRange=function(e,t){t?(this.start=e.end,this.end=e.start):(this.start=e.start,this.end=e.end),this.lastRange=new ne(e.start.gcp,e.end.gcp-e.start.gcp)},e.prototype.getSelection=function(){var e;if(this.start&&this.end){var t=Ef(this.start,this.end),r=Xu([this.start,this.end],2),n=r[0],o=r[1];return t&&(n=(e=Xu([o,n],2))[0],o=e[1]),{backward:t,viewRange:new kf(n,o)}}},e.prototype.findViewPoint=function(e,t,n,o,i){void 0===o&&(o=!1),void 0===i&&(i=!1);var a=this.hasPointInTable(),s=!o&&a,p=this.finder.findViewPoint(e,t,n,s,i);if(p)return p;r.Logger.error("selection cant find viewpoint, node: "+n.className)},e.prototype.hasPointInTable=function(){var e=this;return[this.start,this.end].reduce((function(t,r){if(t)return!0;if(r){var n=r.gcp;if(e.finder.getTableStream().getTableCellInfoFromGcp(n))return!0}return!1}),!1)},e.prototype.isPointInSelectionRange=function(e,t,r){var n,o,i=this.findViewPoint(e,t,r),a=this.finder.getSelection();if(i){var s=i.gcp,p=a.gcpRanges;try{for(var l=qu(p),c=l.next();!c.done;c=l.next()){var u=c.value;if(s>=u.begin()&&s<=u.end())return!0}}catch(e){n={error:e}}finally{try{c&&!c.done&&(o=l.return)&&o.call(l)}finally{if(n)throw n.error}}}return!1},e.prototype.checkExpanding=function(){if(this.start&&this.end){var e=Ef(this.start,this.end),t=Xu(e?[this.end,this.start]:[this.start,this.end],2),r=t[0],n=t[1],o=new ne(r.gcp,n.gcp-r.gcp),i=this.lastRange;if(this.lastRange=o,!(o.length()<=i.length())){var a=this.finder.state.getTextStream(),s=r.gcp>0?a.readText(r.gcp-1,1):uo.LineBreak,p=a.readText(n.gcp-1,1),l=a.readText(n.gcp,1);if(ho(s.charCodeAt(0))&&ho(l.charCodeAt(0))&&!ho(p.charCodeAt(0))){var c=void 0;if(n.leafBox instanceof il)c=n.leafBox;else{if(!n.leafBox.nextSibling)return;c=n.leafBox.nextSibling}n=new Mf(c,1,n.gcp+1),e?this.start=n:this.end=n,this.lastRange.len+=1}}}},e.prototype.moveToLinePoint=function(e,t){var r=this.finder.viewPointOfLine(e,t,!1);return r?(this.start=r,this.end=r,this.afterChange(),r.gcp):null},e.prototype.afterChange=function(){this.selectionCallback&&this.selectionCallback(this)},e}(),Uf=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e.isWrongEventTarget=function(e){if(!r.PlatformUtil.isTencentDocsIPadApp())return!1;var t=Array.from(e.classList);return!!(t.includes("melo-mobile-selection-caret")||t.includes("melo-mobile-selection-drag-left")||t.includes("melo-mobile-selection-drag-right"))},e}return Wu(n,t),n.prototype.onMouseEvent=function(t,r){if(!t)return!1;if(r===e.MouseType.DOWN)return this.isMoving=!0,t.shiftKey?this.updateEnd(t.clientX,t.clientY,t.target):this.updateBoth(t.clientX,t.clientY,t.target),this.afterChange(),!0;if(r===e.MouseType.MOVE){this.isMoving=!0;var n=this.end;return!this.isWrongEventTarget(t.target)&&(this.updateEnd(t.clientX,t.clientY,t.target),this.checkExpanding(),this.end&&n&&this.end.equals(n)||this.afterChange(),!0)}if(r===e.MouseType.UP)this.isMoving=!1,this.afterChange();else if(r===e.MouseType.CONTEXTMENU)return this.isMoving=!1,this.isPointInSelectionRange(t.clientX,t.clientY,t.target)||(this.updateBoth(t.clientX,t.clientY,t.target),this.afterChange()),!0;return!1},n}(jf),zf=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Wu(t,e),t.prototype.onTouchEvent=function(e){var t=e.changedTouches[0];return"touchstart"===e.type&&(this.forceFocus=!1),this.updateBoth(t.clientX,t.clientY,t.target),this.afterChange(),!0},t.prototype.moveBoth=function(e,t,r){this.updateBoth(e,t,r),this.forceFocus=!1,this.afterChange()},t.prototype.moveStart=function(e,t,r){this.updateStart(e,t,r),this.checkExpanding(),this.afterChange()},t.prototype.moveEnd=function(e,t,r){this.updateEnd(e,t,r),this.forceFocus=!1,this.checkExpanding(),this.afterChange()},t.prototype.updateStart=function(e,t,r){var n=this.findViewPoint(e,t,r,!1,!1);n&&this.end&&n.gcp<this.end.gcp&&(this.start=n)},t.prototype.updateEnd=function(e,t,r){var n=!this.start||!this.end||!Ef(this.start,this.end),o=this.findViewPoint(e,t,r,!1,n);o&&this.start&&o.gcp>this.start.gcp&&(this.end=o)},t.prototype.keepMoving=function(){this.isMoving=!0},t.prototype.finishMoving=function(){this.isMoving=!1,this.afterChange()},t}(jf),Wf=function(){function e(e,t,r){this.left=e,this.width=t,this.height=r}return e.prototype.equals=function(e){return this===e||this.left===e.left&&this.width===e.width&&this.height===e.height},e.empty=function(){return Vf},Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this.equals(Vf)},enumerable:!0,configurable:!0}),e.prototype.style=function(){return{left:this.left,width:this.width,height:this.height}},e}(),Vf=new Wf("0","0","0"),Yf=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Wu(t,e),t.prototype.style=function(){return Vu(Vu({},e.prototype.style.call(this)),{position:"absolute",top:"0",backgroundColor:"#1e6fff",opacity:.3,zIndex:12})},t}(Wf),qf=function(e){function t(t,r){var n=e.call(this,"0",t,r)||this;return n.width=t,n.height=r,n}return Wu(t,e),t.empty=function(){return Xf},t.prototype.style=function(){return Vu(Vu({},e.prototype.style.call(this)),{position:"absolute",top:"0",backgroundColor:"#1e6fff",opacity:.3})},t}(Yf),Xf=new qf("0","0"),Jf=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Wu(t,e),t.prototype.render=function(){var e=this.props,t=e.style,r=e.classNames;return u.default.createElement("div",{className:r,style:Vu({},t.style())})},t}(u.default.Component),Zf=function(){function e(){this.zoom=1}return e.prototype.setCallback=function(e){this.callback=e},e.prototype.notifyUpdate=function(){return!!this.callback&&this.callback()},e.prototype.onCoreSelectionChagne=function(e){},e.prototype.afterDocumentRender=function(){},e.prototype.getClassName=function(){},e.prototype.renderOverlay=function(e,t,r,n,o){var i=this,a=this.checkOverlay(e,t,r,n);return 0===a.length?null:1===a.length?u.default.createElement(Jf,{key:o,classNames:this.getClassName(),style:a[0]}):u.default.createElement("div",{key:o},a.map((function(e,t){return u.default.createElement(Jf,{key:t,classNames:i.getClassName(),style:e})})))},e}(),Qf=function(){this.on=!0},$f=function(t){function n(e,r,n){var o=t.call(this)||this;return o.context=e,o.state=r,o.layoutController=n,o.gcpRange=ne.emptyRange(),o.switcher=new Qf,o.indexToPair=function(e){return o.layoutController.boxHelper.getGCPPair(e)},o.tableStream=o.state.getTextStream().tableStream,o.notifyDelay=!1,o.viewSelection=new Lf,o.finder=new Hf(r,(function(e){return e/o.zoom})),o.mouseSelector=new Uf(o.finder),o.touchSelector=new zf(o.finder),o.currentSelector=o.mouseSelector,o.listenChange(),o}return Wu(n,t),n.prototype.getRanges=function(){return this.state.selection.tableCellRange?this.state.selection.gcpRanges:this.gcpRange.len?[this.gcpRange]:[]},n.prototype.reset=function(){this.gcpRange=ne.emptyRange(),this.viewRange=void 0,this.viewSelection.removeAll()},n.prototype.onLayoutChanged=function(){this.updateFromCoreRange(this.gcpRange,{scrollToView:e.ScrollViewType.None,forceFocus:!1,mobileSelectionDrag:e.MobileSelectionDragType.Keep,mobileContextMenu:e.MobileContextMenuType.Keep}),this.updateSelector(!1),this.notifyDelay=!0},n.prototype.getClassName=function(){return"melo-selection-overlay"},n.prototype.onCoreSelectionChagne=function(e){if(!(this.viewRange&&e.range.equal(this.gcpRange)&&this.viewRange.isValid()||this.currentSelector.isMoving)){this.updateFromCoreRange(e.range,e.option),this.notifySelectionOption=e.option;var t=!(!e.option||!e.option.backward)&&e.option.backward;this.updateSelector(t),this.notifyDelay=!0}},n.prototype.listenChange=function(){var e=this,t=function(t){e.currentSelector=t,e.updateSelection(t.getSelection(),t.forceFocus)};this.mouseSelector.selectionCallback=t,this.touchSelector.selectionCallback=t},n.prototype.updateSelection=function(e,t){if(e&&!e.viewRange.equals(this.viewRange)){this.updatePageNum(e.viewRange);var r=e.viewRange.getGCPRange();r=this.fixToTableRange(e.viewRange)||r;var n={backward:e.backward};n.forceFocus=t,this.state.setRangeTo(r,n);var o=this.state.selection.gcpRange;return o.equal(r)?this.updateRange(e.viewRange,o,n):this.updateFromCoreRange(o,n),o.equal(this.gcpRange)?this.notifySelection(this.viewRange,n):(this.notifyDelay=!0,this.notifySelectionOption=n),!0}return!1},n.prototype.updatePageNum=function(e){for(var t=e.start.leafBox.parentBox;t&&!ps(t);)t=t.parentBox;t&&(this.pageNum=t.getSiblingIndex())},n.prototype.updateFromCoreRange=function(e,t){var r=Af(this.layoutController,this.indexToPair,e,this.pageNum);r&&this.updateRange(r,e,t)},n.prototype.updateRange=function(e,t,r){this.viewRange=e,this.gcpRange=t;var n=Xu(!(!r||!r.backward)&&r.backward?[e.end,e.start]:[e.start,e.end],2),o=n[0],i=n[1];this.viewSelection.setBaseAndExtent(o,i)},n.prototype.notifySelection=function(e,t){this.context.fire(new sf(e,this.zoom,t)),this.context.fire(new lf(e,t),!1),this.notifySelectionEnd(e),this.notifyDelay=!1,this.notifySelectionOption=void 0},n.prototype.notifySelectionEnd=function(e){var t=this;this.notifyEndTaskId&&window.clearTimeout(this.notifyEndTaskId),this.notifyEndTaskId=window.setTimeout((function(){t.currentSelector.isMoving?t.notifySelectionEnd(e):t.context.fire(new pf(e))}),200)},n.prototype.updateSelector=function(e){this.viewRange&&(this.mouseSelector.updateRange(this.viewRange,e),this.touchSelector.updateRange(this.viewRange,e))},n.prototype.afterDocumentRender=function(){this.viewRange&&this.notifyDelay&&(this.notifySelectionOption||(this.notifySelectionOption={scrollToView:e.ScrollViewType.None,forceFocus:!1,mobileSelectionDrag:e.MobileSelectionDragType.Keep,mobileContextMenu:e.MobileContextMenuType.Keep}),this.notifySelection(this.viewRange,this.notifySelectionOption))},n.prototype.checkOverlay=function(e,t,n){if(!this.viewRange||this.viewRange.isCaret()||!this.switcher.on)return[];var o=this.viewRange,i=o.start,a=o.end,s=this.gcpRange.begin(),p=this.gcpRange.end(),l=this.indexToPair(e.indexPairs[0]),c=e.edge,u=r.twipsToPx(c.left);c.recycle();var h=u,f=0;if(s>l.last||p<=l.first)return[];if(s>=l.first){if(s>l.first&&(h=i.linePosOffset(this.zoom)),h>=t+u)return[];f=p<=l.last?a.linePosOffset(this.zoom)-h:t+u-h}else f=p<=l.last?a.linePosOffset(this.zoom)-h:t;return f>0?[new Yf(h+"px",f+"px",n+"px")]:[]},n.prototype.checkCellOverlay=function(e,t,r){var n=this.state.selection.tableCellRange;if(n){var o=n.cellRange.from.col,i=n.cellRange.to.col,a=e.logicIndex;if(a>=o&&a<=i)return new qf(t+"px",r+"px")}else{for(var s=e,p=e;s.prevBreakSibling;)s=s.prevBreakSibling;for(;p.nextBreakSibling;)p=p.nextBreakSibling;var l=this.indexToPair(s.indexPairs[0]).first,c=this.indexToPair(p.indexPairs[0]).last,u=new ne(l,c-l+1);if(this.gcpRange.contains(u))return new qf(t+"px",r+"px")}return qf.empty()},n.prototype.checkIfTable=function(e){var t=this.indexToPair(e.indexPairs[0]).first,r=this.tableStream.getTableInfoFromGcp(t);return!(!r||!r.range.contains(this.gcpRange.begin()))},n.prototype.fixToTableRange=function(e){var t=Xu(Of(e.start,e.end),2),r=t[0],n=t[1];if(r&&n&&r!==n){var o=this.indexToPair(r.indexPairs[0]).first,i=this.indexToPair(n.indexPairs[0]).last;return new ne(o,i-o+1)}return null},n.prototype.clearCache=function(){var e,t,r,n;null===(e=this.viewRange)||void 0===e||e.start.clearCache(),null===(t=this.viewRange)||void 0===t||t.end.clearCache(),null===(r=this.viewSelection.archorPoint)||void 0===r||r.clearCache(),null===(n=this.viewSelection.forcusPoint)||void 0===n||n.clearCache()},n}(Zf),ed=function(){function e(t,r){void 0===r&&(r=""),this.children=[],this.firstChildIndex=0,this.lastChildIndex=e.MAX_LOAD_INDEX,this.isLoaded=t,this.tag=r}return e.prototype.clone=function(){var t=new e(this.isLoaded,this.tag);return t.children=this.children,t.firstChildIndex=this.firstChildIndex,t.lastChildIndex=this.lastChildIndex,t},Object.defineProperty(e.prototype,"size",{get:function(){return this.children.length},enumerable:!0,configurable:!0}),e.prototype.setSize=function(e){this.children.length=e},e.prototype.setChildIndexRange=function(e,t){this.firstChildIndex=e,this.lastChildIndex=t,this.fill(rd,0,e),this.setSize(t+1)},e.prototype.childAt=function(e){return this.children[e]||rd},e.prototype.insert=function(e,t){this.children[e]=t},e.prototype.delete=function(e){delete this.children[e]},e.prototype.fill=function(e,t,r){this.children.length<r&&(this.children.length=r),this.children.fill(e,t,r)},e.prototype.equal=function(e){return this===e},e.prototype.isEmpty=function(){for(var e=0;e<this.size;e++)if(this.childAt(e)!==rd)return!1;return!0},e.MAX_LOAD_INDEX=Number.MAX_SAFE_INTEGER,e}(),td=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Wu(t,e),t.prototype.childAt=function(){return this},t}(ed),rd=new td(!1),nd=new td(!0),od=function(e){function t(t){var r=e.call(this,t)||this;return r.needDelayRender=!1,r.checkLazyRender=function(){if(r.needDelayRender){var e=r.getTableId();e&&r.props.addLazyTask(r.lazyRenderTask(e))}},r.getTableId=function(){var e=r.props.layoutBox;return e.parentBox&&e.parentBox.parentBox&&vs(e.parentBox.parentBox)?e.parentBox.parentBox.tableId:null},r.lazyRenderTask=function(e){return{key:e,isValid:function(){return void 0!==r.props.layoutBox.parentBox}.bind(r),update:function(e){r.setState({lazyRenderInfo:e})}.bind(r)}},r.onMouseMove=function(e){if(r.props.layoutBox.isValidBox()){var t=r.rootRef.current.getBoundingClientRect(),n=r.props.layoutBox.firstIndex,o=e.clientX,i=e.clientY,a="none";o-t.left<4?(a="left",o=t.left):t.right-o<4?(a="right",o=t.right):i-t.top<4?(a="top",i=t.top):t.bottom-i<4&&(a="bottom",i=t.bottom),r.props.mouseMoveOnCellEdge({firstIndex:n,edge:a,clientX:o,clientY:i,box:r.props.layoutBox})}},r.state={lazyRenderInfo:rd},r}return Wu(t,e),t.prototype.shouldComponentUpdate=function(e,t){return this.props.layoutBox.uuid!==e.layoutBox.uuid||this.props.overlayNode!==e.overlayNode||!this.state.lazyRenderInfo.equal(t.lazyRenderInfo)||!this.props.lazyRenderInfo.equal(e.lazyRenderInfo)||this.props.force!==e.force},t.prototype.componentDidUpdate=function(){e.prototype.componentDidUpdate.call(this),this.checkLazyRender()},t.prototype.componentDidMount=function(){e.prototype.componentDidMount.call(this),this.checkLazyRender()},t.prototype.render=function(){var e=this.props.layoutBox.children&&this.props.layoutBox.children[0],t=e&&e.borderBoxSize,n=t&&Math.ceil(r.twipsToPx(t.width))||0,o=t&&Math.ceil(r.twipsToPx(t.height))||0,i=this.props.shares.selectionOverlay,a=this.props,s=a.layoutBox,p=a.overlayNode,l=a.lazyRenderInfo,c=Yu(a,["layoutBox","overlayNode","lazyRenderInfo"]),h=qf.empty(),f=p.childAt(0);p.colored&&((h=i.checkCellOverlay(this.props.layoutBox,n,o)).isEmpty||(f=new eh(s.firstChild.uuid)));var d=oh.computeStyles(s),g=s.children[0];return this.needDelayRender=!!l.childAt(0).isLazyRender&&!this.state.lazyRenderInfo.isLoaded,u.default.createElement("td",{className:Dh,style:Vu(Vu(Vu({},oh.boxSize(s)),d.cssProperties),{display:s.isMerged?"none":""}),colSpan:s.colSpan,rowSpan:s.renderRowSpan,onMouseMove:this.onMouseMove,ref:this.rootRef},!this.needDelayRender&&g&&u.default.createElement("div",{style:{position:"relative"}},!h.isEmpty&&g.children.length>0&&u.default.createElement("div",{className:"melo-selection-overlay",style:Vu({},h.style())}),u.default.createElement(pd,Vu({layoutBox:g,overlayNode:f,lazyRenderInfo:l.childAt(0)},c))))},t}(Zu),id=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Wu(t,e),t.prototype.shouldComponentUpdate=function(e){return this.props.layoutBox.uuid!==e.layoutBox.uuid||this.props.overlayNode!==e.overlayNode||!this.props.lazyRenderInfo.equal(e.lazyRenderInfo)||this.props.force!==e.force},t.prototype.render=function(){var e=this.props,t=e.layoutBox,n=e.overlayNode,o=e.lazyRenderInfo,i=Yu(e,["layoutBox","overlayNode","lazyRenderInfo"]);return u.default.createElement("tr",{className:"melo-tr",style:{height:r.twipsToPx(t.rect.height)+"px"}},o.isLoaded&&t.children.slice(1,t.children.length).map((function(e,t){return u.default.createElement(od,Vu({key:t,layoutBox:e,overlayNode:n.childAt(t+1),lazyRenderInfo:o.childAt(t+1)},i))})))},t}(u.default.Component),ad=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e.refTable=u.default.createRef(),e.refTableScroller=u.default.createRef(),e.onScroll=function(){e.props.onScroll(),e.props.context.fire(new ef(e.props.layoutBox.firstIndex))},e}return Wu(n,t),n.prototype.shouldComponentUpdate=function(e){return this.props.overlayNode!==e.overlayNode||this.props.layoutBox.uuid!==e.layoutBox.uuid||!this.props.lazyRenderInfo.equal(e.lazyRenderInfo)||this.props.force!==e.force},n.prototype.attachTableScroller=function(){this.refTableScroller&&this.refTableScroller.current&&(this.props.layoutBox.__node__=this.refTableScroller.current)},n.prototype.detachTableScroller=function(){this.props.layoutBox.__node__=null},n.prototype.componentDidUpdate=function(){this.attachTableScroller()},n.prototype.componentDidMount=function(){this.props.updateRefTable(this.refTable),this.attachTableScroller(),this.props.context.on(e.RenderNotificationTypes.SELECTION_END,this.onCoreSelectionChanged,this)},n.prototype.componentWillUnmount=function(){this.props.updateRefTable(u.default.createRef()),this.detachTableScroller(),this.props.context.removeCallBack(e.RenderNotificationTypes.SELECTION_END,this.onCoreSelectionChanged)},n.prototype.onCoreSelectionChanged=function(e){var t=e.viewRange,r=t.start,n=t.end;if(r.gcp===n.gcp){var o=this.getCellBoxFromLeafBox(r.leafBox);if(o&&o.parentBox&&o.parentBox.parentBox===this.props.layoutBox&&this.refTableScroller.current&&o.__node__){var i=this.refTableScroller.current.getBoundingClientRect(),a=o.__node__.getBoundingClientRect();if(a.left<=i.left||a.right<=i.right)return;var s=this.refTableScroller.current.scrollLeft+Math.min(a.left-i.left,a.right-i.right);this.refTableScroller.current.scrollLeft=s}}},n.prototype.getCellBoxFromLeafBox=function(e){for(var t=e;t;){if(xs(t))return t;if(hs(t))return null;t=t.parentBox}return null},n.prototype.render=function(){var e=this,t=this.props,n=t.layoutBox,o=t.overlayNode,i=t.lazyRenderInfo,a=Yu(t,["layoutBox","overlayNode","lazyRenderInfo"]),s=n.colWidths,p=n.edge,l=p.margin,c=l.left,h=l.top,f=l.right,d=n.totalBoxSize;return p.recycle(),u.default.createElement("div",{className:kh,style:{marginTop:r.twipsToPx(h),marginLeft:r.twipsToPx(c),marginBottom:0,marginRight:r.twipsToPx(f),width:r.twipsToPx(d.width-c-f)+"px",height:r.twipsToPx(d.height-h)+"px"},onScroll:this.onScroll,ref:this.refTableScroller},u.default.createElement("table",{className:Mh,ref:this.refTable,style:{width:r.twipsToPx(s.reduce((function(e,t){return e+t}),0))+2+"px",cursor:oh.getCursorType(this.props.shares.isEditable())}},u.default.createElement("colgroup",null,s.map((function(e,t){return u.default.createElement("col",{key:t,style:{width:r.twipsToPx(e)+"px"}})}))),u.default.createElement("tbody",null,i.isLoaded&&n.children.map((function(t,r){return u.default.createElement(id,Vu({key:r,layoutBox:t,overlayNode:o.childAt(r),lazyRenderInfo:i.childAt(r),mouseMoveOnCellEdge:e.props.mouseMoveOnCellEdge},a))})))))},n}(u.default.Component),sd=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.refTable=u.default.createRef(),n.selTableIndex=-1,n.state={draggerInfo:{marginLeft:0,firstIndex:0,edge:"none",clientX:0,clientY:0},showIcon:!1},n.selectionEnd=function(){n.props.shares.selectionOverlay.checkIfTable(n.props.layoutBox)?n.showIcon(n.getFirstTableBox(n.props.layoutBox),!0):n.state.showIcon&&n.hideIcon(n.getFirstTableBox(n.props.layoutBox))},n.onShowTableIcon=function(e){e.show?(e.isSelected&&(n.selTableIndex=e.firstIndex),n.props.layoutBox.firstIndex===e.firstIndex?n.setState({showIcon:!0}):n.setState({showIcon:!1})):e.show||n.selTableIndex!==e.firstIndex?e.show||n.props.layoutBox.firstIndex!==e.firstIndex||n.setState({showIcon:!1}):(n.selTableIndex=-1,n.setState({showIcon:!1}))},n.mouseMoveOnCellEdge=function(e){if("none"!==e.edge){var t=n.refTable.current.getBoundingClientRect();if(e.clientX-=t.left,e.clientY-=t.top,e.box){var r=e.box,o=e.edge;e.valueRange=n.getValueRange(r,o),e.rowHeight=n.getRenderRowHeightOfBox(r,o),e.colWidth=n.getRenderColWidthOfBox(r,o)}}n.setState({draggerInfo:e})},n.onFinishDrag=function(t,o){var i=n.state.draggerInfo,a=i.firstIndex,s=i.edge,p=i.box,l=i.rowHeight,c=i.colWidth;if(n.props.context.fire(new ff(e.FocusBlurNotificationType.REQUEST_FOCUS),!1),p&&l&&c&&p){var u=r.pxToTwips(t),h=0;if("top"===s||"bottom"===s)h=l+u,n.props.context.fire(new Zh(a,h,s));else if("left"===s||"right"===s){var f=c;if(h="left"===s&&1===p.getSiblingIndex()?f-u:f+u,n.refTable.current&&n.refTable.current.parentElement&&n.refTable.current.parentElement.parentElement){var d=n.refTable.current.parentElement.parentElement.getBoundingClientRect(),g=r.pxToTwips(o-d.left/n.zoom),y=r.pxToTwips(o-d.right/n.zoom+4);return n.props.context.fire(new Zh(a,h,s,g,y)),void("left"===s&&t<0&&n.setState({draggerInfo:{edge:"none"}}))}n.props.context.fire(new Zh(a,h,s))}}},n.onMouseEnter=function(){-1===n.selTableIndex&&n.showIcon(n.getFirstTableBox(n.props.layoutBox))},n.onMouseLeave=function(){-1===n.selTableIndex&&n.hideIcon(n.getFirstTableBox(n.props.layoutBox))},n.onTouchEnd=function(){-1===n.selTableIndex&&n.showIcon(n.getFirstTableBox(n.props.layoutBox))},n.updateRefTable=function(e){n.refTable=e},n.onScroll=function(){n.setState({draggerInfo:{marginLeft:n.marginLeft}})},n}return Wu(n,t),n.prototype.componentDidMount=function(){var t=Il.getPrevBox(this.props.layoutBox);t&&!vs(t)||this.props.context.on(e.RenderNotificationTypes.SELECTION_END,this.selectionEnd,this),this.props.context.on(e.RenderNotificationTypes.SHOW_TABLE_ICON,this.onShowTableIcon,this)},n.prototype.componentWillUnmount=function(){this.props.context.removeCallBack(e.RenderNotificationTypes.SELECTION_END,this.selectionEnd),this.props.context.removeCallBack(e.RenderNotificationTypes.SHOW_TABLE_ICON,this.onShowTableIcon),this.props.removeLazyTask(this.props.layoutBox.tableId)},n.prototype.getFirstTableBox=function(e){for(var t=e,r=Il.getPrevBox(e);r&&vs(r);)t=r,r=Il.getPrevBox(t);return t},n.prototype.showIcon=function(e,t){r.PlatformUtil.isMobile()||this.props.context.fire(new $h(e.firstIndex,!0,t))},n.prototype.hideIcon=function(e){r.PlatformUtil.isMobile()||this.props.context.fire(new $h(e.firstIndex,!1))},n.prototype.advanceToBreakingTailBox=function(e){for(var t=0,r=e;r.prevBreakSibling;)r=r.prevBreakSibling;for(var n=r;n;){var o=n.parentBox;t+=o?o.rect.height:0,r=n,n=n.nextBreakSibling}return{box:r,sumRowHeight:t}},n.prototype.getValueRange=function(t,n){var o=0;if("top"===n||"bottom"===n)o=this.getRenderRowHeightOfBox(t,n);else if("left"===n||"right"===n){var i=this.getRenderColWidthOfBox(t,n);if("left"===n&&1===t.getSiblingIndex()){var a=Il.getOffsetPoint(this.props.layoutBox.firstChild,e.BoxKind.ContainerPage).x;return[r.twipsToPx(a)+20,r.twipsToPx(a+i)]}o=i}return[r.twipsToPx(o)]},n.prototype.getRenderRowHeightOfBox=function(e,t){if("top"===t){var r=e.parentBox,n=e.logicIndex,o=r.prevSibling;o&&(e=o.logicChildren[n]||e)}var i=this.advanceToBreakingTailBox(e),a=i.box,s=i.sumRowHeight;if(a.renderRowSpan>1){var p=(r=a.parentBox).parentBox,l=p.children.indexOf(r);s=p.children[l+a.renderRowSpan-1].rect.height}return s},n.prototype.getRenderColWidthOfBox=function(e,t){var r=e.parentBox,n=e.logicIndex-1;return"right"===t&&(n+=Math.max(e.colSpan,0)),(r.logicChildren[Math.max(n,0)]||e).rect.width},Object.defineProperty(n.prototype,"marginLeft",{get:function(){var e=0;this.refTable.current&&(e=this.refTable.current.parentElement.scrollLeft);var t=this.props.layoutBox.edge,n=r.twipsToPx(t.margin.left);return t.recycle(),n-e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"zoom",{get:function(){return this.props.shares.scrollHandler.zoom()},enumerable:!0,configurable:!0}),n.prototype.shouldComponentUpdate=function(e,t){return this.props!==e||t.draggerInfo.firstIndex!==this.state.draggerInfo.firstIndex||t.draggerInfo.edge!==this.state.draggerInfo.edge||t.showIcon!==this.state.showIcon||this.props.force!==e.force},n.prototype.selTable=function(){this.props.context.fire(new Qh(this.props.layoutBox.firstIndex))},n.prototype.render=function(){var e=this.props,t=e.layoutBox,r=e.shares,n=t.edge,o=n.margin.left;return n.recycle(),u.default.createElement("div",{className:Nh,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onTouchEnd:this.onTouchEnd},r.isEditable()?u.default.createElement(Cf,{marginLeft:o,show:this.state.showIcon,selTable:this.selTable.bind(this)}):"",u.default.createElement(ad,Vu({},Vu({onScroll:this.onScroll,updateRefTable:this.updateRefTable,mouseMoveOnCellEdge:this.mouseMoveOnCellEdge},this.props))),r.isEditable()?u.default.createElement(qh,Vu({},Vu(Vu({},this.state.draggerInfo),{rect:this.refTable.current?this.refTable.current.getBoundingClientRect():{width:0,height:0},marginLeft:this.marginLeft,onFinish:this.onFinishDrag,zoom:this.zoom}))):"")},n}(u.default.Component),pd=function(e){function t(t){var r=e.call(this,t)||this;return r.keyGenerator=new sh,r}return Wu(t,e),t.prototype.shouldComponentUpdate=function(e){return this.props.layoutBox.uuid!==e.layoutBox.uuid||this.props.overlayNode!==e.overlayNode||this.props.storyInfo.storyProp.storyId!==e.storyInfo.storyProp.storyId||!this.props.lazyRenderInfo.equal(e.lazyRenderInfo)||this.props.force!==e.force},t.prototype.render=function(){var e=this,t=this.props,n=t.layoutBox,o=t.overlayNode,i=t.lazyRenderInfo,a=Yu(t,["layoutBox","overlayNode","lazyRenderInfo"]),s=xs(n.parentBox);if(this.keyGenerator.build(n,(function(e){return ds(e)})),this.lastBoxId!==n.uuid){var p=n.rect;this.cssStyle=Vu(Vu({position:s?"relative":"absolute",left:r.twipsToPx(p.x)},oh.boxSize(n)),oh.boxPadding(n))}var l=0,c=new Vh(i);return u.default.createElement("div",{className:"melo-text-page",style:Vu({},this.cssStyle),ref:this.rootRef},i.isLoaded&&n.children.map((function(t,r){var n=c.getUnloadBoxNode(t,r,"melo-paragraph-placeholder");return void 0!==n?n:ds(t)?u.default.createElement(Yh,Vu({key:e.keyGenerator.getKey(t),layoutBox:t,overlayNode:o.childAt(r),lazyRenderInfo:i.childAt(r)},a)):vs(t)?(l+=1,u.default.createElement(sd,Vu({key:"table_"+(t.tableId||l),layoutBox:t,overlayNode:o.childAt(r),lazyRenderInfo:i.childAt(r)},a))):null})))},t}(Zu),ld=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Wu(t,e),t.prototype.shouldComponentUpdate=function(e){return this.props.layoutBox.uuid!==e.layoutBox.uuid||this.props.overlayNode!==e.overlayNode||this.props.storyInfo.storyProp.storyId!==e.storyInfo.storyProp.storyId||!this.props.lazyRenderInfo.equal(e.lazyRenderInfo)||this.props.force!==e.force},t.prototype.render=function(){var e=this.props,t=e.layoutBox,r=e.overlayNode,n=e.lazyRenderInfo,o=Yu(e,["layoutBox","overlayNode","lazyRenderInfo"]);return this.lastBoxId!==t.uuid&&(this.cssStyle=Vu({},oh.boxSize(t))),u.default.createElement("div",{className:Rh,style:Vu({},oh.boxSize(t)),ref:this.rootRef},n.isLoaded&&t.children.map((function(e,t){return u.default.createElement(pd,Vu({key:t,layoutBox:e,overlayNode:r.childAt(t),lazyRenderInfo:n.childAt(t)},o))})))},t}(Zu),cd=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onMouseEvent=function(e,t){t||r.PlatformUtil.isTencentDocsIPadApp()||e.stopPropagation()},t}return Wu(t,e),t.prototype.shouldComponentUpdate=function(e){return this.props.layoutBox.uuid!==e.layoutBox.uuid||this.props.overlayNode!==e.overlayNode||this.props.storyInfo.storyProp.storyId!==e.storyInfo.storyProp.storyId||!this.props.lazyRenderInfo.equal(e.lazyRenderInfo)||this.props.force!==e.force},t.prototype.render=function(){var e=this,t=this.props,r=t.layoutBox,n=t.overlayNode,o=t.lazyRenderInfo,i=Yu(t,["layoutBox","overlayNode","lazyRenderInfo"]),a=!Ge(this.props.storyInfo.storyProp.storyType)&&!He(this.props.storyInfo.storyProp.storyType);this.lastBoxId!==r.uuid&&(this.cssStyle=Vu(Vu({},oh.boxSize(r)),oh.boxPadding(r)));var s=new Vh(o);return u.default.createElement("div",{className:"melo-container-page",style:Vu(Vu({},this.cssStyle),{opacity:a?1:.3}),onMouseDown:function(t){e.onMouseEvent(t,a)},onMouseMove:function(t){e.onMouseEvent(t,a)},onMouseUp:function(t){e.onMouseEvent(t,a)},onContextMenu:function(e){a||e.stopPropagation()},onDoubleClick:function(t){if(!a){var r=e.props.shares.selectionOverlay.mouseSelector;r.updateBoth(t.clientX,t.clientY,t.target),r.selectionCallback&&r.selectionCallback(r)}},ref:this.rootRef},o.isLoaded&&r.children.map((function(e,t){var r=s.getUnloadBoxNode(e,t,"melo-section-placeholder");return void 0!==r?r:u.default.createElement(ld,Vu({key:t,layoutBox:e,overlayNode:n.childAt(t),lazyRenderInfo:o.childAt(t)},i))})))},t}(Zu),ud=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e.onMouseEvent=function(e,t){t||r.PlatformUtil.isTencentDocsIPadApp()||e.stopPropagation()},e}return Wu(n,t),n.prototype.shouldComponentUpdate=function(e){return this.props.layoutBox.uuid!==e.layoutBox.uuid||this.props.overlayNode!==e.overlayNode||this.props.storyInfo.storyProp.storyId!==e.storyInfo.storyProp.storyId||this.props.force!==e.force},n.prototype.render=function(){var t=this,n=this.props,o=n.layoutBox,i=n.overlayNode,a=Yu(n,["layoutBox","overlayNode"]),s=Ge(this.props.storyInfo.storyProp.storyType)||He(this.props.storyInfo.storyProp.storyType),p=o.type===e.ContainerPageType.Header;this.lastBoxId!==o.uuid&&(this.cssStyle=Vu(Vu({},oh.boxPadding(o)),oh.boxSize(o)));var l=this.props.shares.decoratorManager.getDecorator(e.DecoratorTypes.HeaderFooter).decorate(o);return u.default.createElement("div",{onMouseDown:function(e){t.onMouseEvent(e,s)},onMouseMove:function(e){t.onMouseEvent(e,s)},onMouseUp:function(e){t.onMouseEvent(e,s)},onContextMenu:function(e){s||e.stopPropagation()},onDoubleClick:function(e){if(!s&&!r.PlatformUtil.isMobile()&&t.props.shares.isEditable()){var n=t.props.shares.selectionOverlay.mouseSelector,i=-1===o.firstIndex,a=null;if(!i){var l=n.findViewPoint(e.clientX,e.clientY,e.target,!0,!1);l&&(a=new ne(l.gcp,0))}t.props.context.fire(new bf(p,i,n.getSelection().viewRange.getGCPRange(),a))}},style:{position:"relative"}},l.components,u.default.createElement("div",{className:"melo-headerfooter",style:Vu(Vu(Vu({},this.cssStyle),l.overrideStyle),{opacity:s?1:.3}),ref:this.rootRef},u.default.createElement("div",{className:"melo-container-page",style:{maxHeight:oh.boxSize(o).height,overflow:"hidden"}},o.children.map((function(e,t){return u.default.createElement(ld,Vu({key:t,layoutBox:e,overlayNode:i.childAt(t)},a))})))))},n}(Zu),hd=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return Wu(n,t),n.prototype.shouldComponentUpdate=function(e){return this.props.layoutBox.uuid!==e.layoutBox.uuid||this.props.overlayNode!==e.overlayNode||this.props.storyInfo.storyProp.storyId!==e.storyInfo.storyProp.storyId||!this.props.lazyRenderInfo.equal(e.lazyRenderInfo)||this.props.force!==e.force},n.prototype.render=function(){var t=this.props,n=t.layoutBox,o=t.overlayNode,i=t.lazyRenderInfo,a=Yu(t,["layoutBox","overlayNode","lazyRenderInfo"]);if(this.lastBoxId!==n.uuid){var s=n.edge;this.cssStyle=Vu(Vu(Vu({},oh.boxSize(n)),oh.boxPadding(n)),{marginTop:r.twipsToPx(s.margin.top)+"px",marginLeft:r.twipsToPx(s.margin.left)+"px",marginRight:r.twipsToPx(s.margin.right)+"px",background:"#fff",position:"relative",boxShadow:ot.pageBoxShawdow,cursor:oh.getCursorType(this.props.shares.isEditable())}),s.recycle()}var p=this.props.shares.decoratorManager.getDecorator(e.DecoratorTypes.Page).decorate(n),l=[],c=[];return p.forEach((function(t){t[1].order===e.PageOrderType.Front?l.push(t[0]):c.push(t[0])})),i.isLoaded?u.default.createElement("div",{className:wh,style:Vu({},this.cssStyle),ref:this.rootRef},c,u.default.createElement(ud,Vu({layoutBox:n.headerPage,overlayNode:o.childAt(1),lazyRenderInfo:i.childAt(1)},a)),u.default.createElement(cd,Vu({layoutBox:n.mainPage,overlayNode:o.childAt(0),lazyRenderInfo:i.childAt(0)},a)),u.default.createElement(ud,Vu({layoutBox:n.footerPage,overlayNode:o.childAt(2),lazyRenderInfo:i.childAt(2)},a)),l):u.default.createElement("div",{className:wh,style:Vu({},this.cssStyle),ref:this.rootRef})},n}(Zu),fd=function(t){function r(){return t.call(this,e.RenderNotificationTypes.PAGEGAP_DBCLICK)||this}return Wu(r,t),r}(r.Notification),dd=function(e){function t(t){var r=e.call(this,t)||this;return r.pageKeyGenerator=new sh,r}return Wu(t,e),t.prototype.componentDidMount=function(){var e=this;this.attachBox(),this.lastBoxId=this.props.layoutBox.uuid,window.setTimeout((function(){e.rootRef.current&&(e.rootRef.current.style.opacity="1")}))},t.prototype.onMouseDown=function(e){this.props.context.fire(new Sf(e),!1)},t.prototype.onContextMenu=function(e){this.props.context.fire(new Sf(e),!1)},t.prototype.onTouchStart=function(e){this.props.context.fire(new _f(e),!1)},t.prototype.onTouchMove=function(e){this.props.context.fire(new _f(e),!1)},t.prototype.onTouchEnd=function(e){this.props.context.fire(new _f(e),!1)},t.prototype.render=function(){var e=this,t=this.props,n=t.layoutBox,o=t.overlayNode,i=t.lazyRenderInfo,a=Yu(t,["layoutBox","overlayNode","lazyRenderInfo"]);this.pageKeyGenerator.build(n);var s=n.children[n.children.length-1],p=this.props.layoutController.env.isPresentation;return u.default.createElement("div",{className:Ih,onMouseDown:function(t){e.onMouseDown(t)},onContextMenu:function(t){e.onContextMenu(t)},onTouchStart:function(t){e.onTouchStart(t)},onTouchMove:function(t){e.onTouchMove(t)},onTouchEnd:function(t){e.onTouchEnd(t)},style:{opacity:0,background:"#f9fafb",marginBottom:r.twipsToPx(s&&!p?s.edge.margin.bottom:0)+"px"},ref:this.rootRef},n.children.map((function(t,s){var p=t.edge,l=p.margin.bottom;return p.recycle(),[u.default.createElement(hd,Vu({key:e.pageKeyGenerator.getKey(t),layoutBox:t,overlayNode:o.childAt(s),lazyRenderInfo:i.childAt(s)},a)),s===n.children.length-1?null:u.default.createElement("div",{key:"gap-"+s,className:"melo-page-gap",style:{width:"100%",height:r.twipsToPx(l)+"px"},onMouseDown:function(e){e.stopPropagation()},onMouseMove:function(e){e.stopPropagation()},onMouseUp:function(e){e.stopPropagation()},onDoubleClick:function(){e.props.context.fire(new fd)}})]})))},t}(Zu),gd=function(){function t(e){this.LAZY_RENDER_EXCEED_HEIGHT=r.pxToTwips(1e3),this.LAZY_RENDER_MAX_HEIGHT=r.pxToTwips(5e3),this.LAZY_RENDER_EXTEND_HEIGHT=r.pxToTwips(100),this.LAZY_RENDER_BOX_HEIGHT=r.pxToTwips(2e3),this._renderedTop=0,this._renderedBottom=0,this.needFullRender=!1,this._osDelayRender=!1,this._lazyRenderInfo=new ed(!0,"DocumentBox"),this._toUpdateQueue=[],this._osDelayRender=e}return t.prototype.updateConfigValue=function(e,t){var n=r.pxToTwips(e/t);this.LAZY_RENDER_EXCEED_HEIGHT=.5*n,this.LAZY_RENDER_MAX_HEIGHT=3*n},Object.defineProperty(t.prototype,"lazyRenderInfo",{get:function(){return this.needFullRender?nd:this._lazyRenderInfo},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fullRenderInfo",{get:function(){return nd},enumerable:!0,configurable:!0}),t.prototype.updateLazyRenderInfo=function(e,t,n,o,i,a){!i&&this._osDelayRender&&(nd.isLazyRender=o);var s=e.getScrollTop(),p=e.getOffsetHeight();this.updateConfigValue(p,n);var l=r.pxToTwips(s/n),c=r.pxToTwips((s+p)/n),u=Math.max(a?l-this.LAZY_RENDER_EXCEED_HEIGHT:l-this.LAZY_RENDER_EXTEND_HEIGHT,0),h=a?c+this.LAZY_RENDER_EXCEED_HEIGHT:c+this.LAZY_RENDER_EXTEND_HEIGHT;if(o&&u>=this._renderedTop&&h<=this._renderedBottom)return!1;u<this._renderedTop&&(this._renderedTop=Math.max(u-this.LAZY_RENDER_EXCEED_HEIGHT,0));var f=!1;h>this._renderedBottom&&(this._renderedBottom=h+this.LAZY_RENDER_EXCEED_HEIGHT,f=!0),this._renderedBottom-this._renderedTop>this.LAZY_RENDER_MAX_HEIGHT&&(f?this._renderedTop=this._renderedBottom-this.LAZY_RENDER_MAX_HEIGHT:this._renderedBottom=this._renderedTop+this.LAZY_RENDER_MAX_HEIGHT);var d=this._updateLazyRenderInfo(t,this._lazyRenderInfo,this._renderedTop,this._renderedBottom-this._renderedTop);return d&&(this._lazyRenderInfo=this._lazyRenderInfo.clone()),d},t.prototype._updateChildInfo=function(e,t){var r,n=!1;return e instanceof td?(r=new ed(!0,t),n=!0):r=e.clone(),{newChildInfo:r,needUpdate:n}},t.prototype._updateChildLazy=function(e,t,r,n,o,i){var a=this._updateChildInfo(t.childAt(o),n.constructor.name),s=a.newChildInfo;return t.insert(o,s),e.push({parentBox:n,parentLazyInfo:s,grandparentType:r,topForParent:i,loadFirstIndex:-1,loadLastIndex:-1}),a.needUpdate},t.prototype._updateLazyRenderInfoLogicPage=function(e){var t=e.parentLazyInfo,r=e.parentBox,n=e.needUpdate,o=e.lazyStack,i=e.topForParent;t.insert(1,nd),t.insert(2,nd);var a=t.childAt(0);return r.mainPage.totalHeight<=this.LAZY_RENDER_BOX_HEIGHT?a!==nd?(t.insert(0,nd),n=n||!0):n=n||!1:n=this._updateChildLazy(o,t,r.kind,r.mainPage,0,i)||n},t.prototype._updateLazyRenderInfoTable=function(e){for(var t=e.parentLazyInfo,r=e.parentBox,n=e.needUpdate,o=e.firstIndex,i=e.lastIndex,a=o;a<=i;a++)t.childAt(a)!==nd&&(t.insert(a,nd),n=!0);for(var s=0;s<o;s++){for(var p=r.children[s],l=t.childAt(s),c=this._updateChildInfo(l,p.constructor.name),u=c.newChildInfo,h=!1,f=0;f<p.children.length;f++){var d=p.children[f];d.rowSpan>=1&&s+d.rowSpan>o?(u.insert(f,nd),h=!0):u.insert(f,new ed(!1,d.constructor.name))}n=c.needUpdate||n,h?(u.isLoaded=!0,l.isLoaded||(n=!0)):(u=new ed(!1,p.constructor.name),l.isLoaded&&(n=!0)),t.insert(s,u)}return t.setSize(i+1),n},t.prototype._isFirstBoxTooLarge=function(e){return e&&!xs(e.parentBox)&&e.totalHeight>this.LAZY_RENDER_BOX_HEIGHT},t.prototype._isLastBoxTooLarge=function(e,t){return e&&e!==t&&!xs(t.parentBox)&&e.totalHeight>this.LAZY_RENDER_BOX_HEIGHT},t.prototype._checkNeedUpdate=function(e,t){var r=t.firstBox,n=t.lastBox,o=t.lazyStack,i=t.parentLazyInfo,a=t.parentBox,s=t.firstIndex,p=t.lastIndex,l=t.topForParent,c=!1,u=!1,h=e;this._isFirstBoxTooLarge(r)&&(h=this._updateChildLazy(o,i,a.kind,r,s,l)||h,c=!0),this._isLastBoxTooLarge(n,r)&&(h=this._updateChildLazy(o,i,a.kind,n,p,l)||h,u=!0);for(var f=c?s+1:s;f<=(u?p-1:p);f++)i.childAt(f)!==nd&&(i.insert(f,nd),h=!0);return h},t.prototype._updateLazyRenderInfo=function(t,r,n,o){for(var i=[{parentBox:t,parentLazyInfo:r,grandparentType:e.BoxKind.Document,topForParent:n,loadFirstIndex:-1,loadLastIndex:-1}],a=!1;;){var s=i.shift();if(!s)break;var p=s.parentLazyInfo,l=s.parentBox;if(is(l)){var c=Il.getOffsetPoint(l,s.grandparentType),u=s.topForParent-c.y;if(l.kind!==e.BoxKind.LogicPage){var h=l.getChildrenInY(u,o);if(0!==h.length){var f=h[0],d=h[h.length-1],g=f?f.getSiblingIndex():0,y=d?d.getSiblingIndex():l.children.length-1;l.kind!==e.BoxKind.Table?(p.setChildIndexRange(g,y),a=this._checkNeedUpdate(a,{firstBox:f,lastBox:d,lazyStack:i,firstIndex:g,lastIndex:y,parentBox:l,parentLazyInfo:p,topForParent:u})):a=this._updateLazyRenderInfoTable({parentLazyInfo:p,parentBox:l,needUpdate:a,firstIndex:g,lastIndex:y})}else{if(!p.isEmpty()){p.setChildIndexRange(-1,-1),a=a||!0;continue}a=a||!1}}else a=this._updateLazyRenderInfoLogicPage({parentLazyInfo:p,parentBox:l,needUpdate:a,lazyStack:i,topForParent:u})}}return a},t.prototype.filterInvaldTask=function(){this._toUpdateQueue=this._toUpdateQueue.filter((function(e){return e.isValid()}))},t.prototype.addTask=function(e){0===this._toUpdateQueue.length&&this.delayCommitTask(),this._toUpdateQueue.push(e)},t.prototype.removeTaskForKey=function(e){this._toUpdateQueue=this._toUpdateQueue.filter((function(t){return t.key!==e}))},t.prototype.delayCommitTask=function(){var e=this;"requestIdleCallback"in window?window.requestIdleCallback((function(){e.commitTask(50)}),{timeout:3e3}):requestAnimationFrame((function(){e.commitTask(10)}))},t.prototype.commitTask=function(e){this.filterInvaldTask();for(var t=window.performance.now();this._toUpdateQueue.length>0;){var r=this._toUpdateQueue.shift();if((null==r?void 0:r.isValid())&&r.update(nd),window.performance.now()-t>e)break}this._toUpdateQueue.length>0&&this.delayCommitTask()},t.prototype.flushLazyTask=function(){this.commitTask(Number.MAX_SAFE_INTEGER)},t.prototype.clearLazyTask=function(){this._toUpdateQueue=[]},t}(),yd=function(t){function n(n){var o=t.call(this,n)||this;o.needUpdateLazyInfo=!0,o.lazyRenderScrollTicking=!1,o.trigger=!1,o.firstRender=!0,o._zoom=1,o.onZoomableResizeHandler=function(e){e.next!==e.prev&&o.lazyRenderHandler(!0,e.next)},o.onEditorScrollHandler=function(){o.lazyRenderScrollTicking||(requestAnimationFrame((function(){o.lazyRenderHandler(!0)})),o.lazyRenderScrollTicking=!0)},o.lazyRenderHandler=function(e,t,r){if(o.lazyRenderManager.needFullRender||!e&&!o.needUpdateLazyInfo)o.lazyRenderScrollTicking=!1;else{var n=t||o._zoom,i=o.lazyRenderManager.updateLazyRenderInfo(o.props.scrollHandler,o.props.layoutController.getLayoutBox(),n,e,o.props.shares.isEditable(),r);e&&i?(o.needUpdateLazyInfo=!1,o.setState({lazyRenderInfo:o.lazyRenderManager.lazyRenderInfo},(function(){o.needUpdateLazyInfo=!0,o.lazyRenderScrollTicking=!1}))):o.lazyRenderScrollTicking=!1}},o.fullRenderHandler=function(){var e=r.PerfUtil.now();o.setState({lazyRenderInfo:o.lazyRenderManager.fullRenderInfo},(function(){o.props.context.fire(new af);var t=r.PerfUtil.now()-e;t>30?r.Logger.warn("full perf|render "+t+"ms"):r.Logger.log("full perf|render "+t+"ms")}))},o.searchDialogChange=function(e){o.lazyRenderManager.needFullRender=e.searchDialogShow,setTimeout((function(){o.lazyRenderManager.needFullRender?o.fullRenderHandler():o.lazyRenderHandler(!1)}),1)},o.onModelChange=function(e){void 0!==o.timerId&&window.clearTimeout(o.timerId),o.waitingNotification?(o.readyNotification=o.waitingNotification,o.waitingNotification=new ga(e.changeData)):o.waitingNotification=new ga(e.changeData);o.sendNotification(500)};var i=o.props,a=i.layoutController,s=i.shares;o.overlays=s.overlays;var p=o.props.state.selection.storyInfo;if(!p){var l=new Vt;l.storyType=e.StoryType.MainTextStory,l.storyId=e.StoryID.MainDocId,p={storyProp:l,range:new ne(0,0)}}return o.lazyRenderManager=new gd(r.PlatformUtil.isAndroid()),o.state={uuid:a.getLayoutBox().uuid,overlayNode:o.overlays.getOverlayNode(e.StoryID.MainDocId),storyInfo:p,lazyRenderInfo:o.lazyRenderManager.lazyRenderInfo,force:0},o.layoutChangeCallback=function(){var t=r.PerfUtil.now();o.props.state.waitingForReflow=!1,o.props.shares.lifeCycle.willUpdate();var n=a.getLayoutBox().uuid,i=o.overlays.getOverlayNode(e.StoryID.MainDocId);o.lazyRenderHandler(!1),o.setState({uuid:n,overlayNode:i,lazyRenderInfo:o.lazyRenderManager.lazyRenderInfo},(function(){var n=r.PerfUtil.now()-t;n>1e3?r.Logger.warn("perf|render "+n+"ms"):n>30&&r.Logger.log("perf|render "+n+"ms"),o.props.context.perfHandler.costTime[e.EditMetric.Render]=n,o.props.shares.isFirstRender()||o.props.context.fire(new rf,!1),requestAnimationFrame((function(){o.overlays.onLayoutChanged()})),o.props.context.fire(new nf)}))},o.newDocumentCallback=function(){r.Logger.log("RenderDocumentWrapper","newDocumentCallback"),o.smoothLayout(),o.overlays.onNewDocument()},o.overlayWatcher=function(){o.setState({overlayNode:o.overlays.getOverlayNode(e.StoryID.MainDocId)})},o.selectionChangeCallback=function(){o.setState({storyInfo:o.props.state.selection.storyInfo})},requestAnimationFrame((function(){return o.smoothLayout()})),o}return Wu(n,t),n.prototype.shouldComponentUpdate=function(e,t){return this.state.uuid!==t.uuid||this.state.overlayNode!==t.overlayNode||this.state.storyInfo.storyProp.storyId!==t.storyInfo.storyProp.storyId||!this.state.lazyRenderInfo.equal(t.lazyRenderInfo)||this.state.force!==t.force},n.prototype.smoothLayout=function(){var e=this;this.firstRender&&r.PerfUtil.mark("firstLayoutStart"),this.props.layoutController.doLayout(1)||r.getUrlParameter("prerender")?this.props.context.fire(new tf):"requestIdleCallback"in window?window.requestIdleCallback((function(){e.smoothLayout()})):document.hidden?this.smoothLayout():requestAnimationFrame((function(){e.smoothLayout()}))},n.prototype.zoom=function(e){this._zoom=e},n.prototype.forceRerender=function(){this.setState({force:this.state.force+1})},n.prototype.componentDidMount=function(){this.props.layoutController.onLayoutChange(this.layoutChangeCallback),this.props.context.on(e.StateNotification.NewDocument,this.newDocumentCallback),this.props.context.on(e.StateNotification.CoreSelectionChange,this.selectionChangeCallback),this.props.context.on(e.StateNotification.ModelChange,this.onModelChange),this.props.context.on(e.RenderNotificationTypes.FULL_RENDER,this.fullRenderHandler),this.props.context.on(e.RenderNotificationTypes.SEARCH_DIALOG,this.searchDialogChange),this.overlays.addWatcher(this.overlayWatcher),this.props.context.on(e.ZoomNotificationType.ZOOM_START,this.onZoomableResizeHandler),this.props.scrollHandler.addScrollListener(this.onEditorScrollHandler)},n.prototype.componentWillUnmount=function(){this.props.context.removeCallBack(e.LayoutNotification.LayoutChanged,this.layoutChangeCallback),this.props.context.removeCallBack(e.StateNotification.NewDocument,this.newDocumentCallback),this.props.context.removeCallBack(e.StateNotification.CoreSelectionChange,this.selectionChangeCallback),this.props.context.removeCallBack(e.StateNotification.ModelChange,this.onModelChange),this.props.context.removeCallBack(e.ZoomNotificationType.ZOOM_START,this.onZoomableResizeHandler),this.props.context.removeCallBack(e.RenderNotificationTypes.FULL_RENDER,this.fullRenderHandler),this.props.context.removeCallBack(e.RenderNotificationTypes.SEARCH_DIALOG,this.searchDialogChange),this.overlays.removeWatcher(this.overlayWatcher),this.props.scrollHandler.removeScrollListener(this.onEditorScrollHandler)},n.prototype.componentDidUpdate=function(){this.props.shares.lifeCycle.afterUpdate(),this.trigger&&this.readyNotification&&(this.props.context.fire(this.readyNotification),this.trigger=!1,this.waitingNotification===this.readyNotification&&(this.waitingNotification=void 0),this.readyNotification=void 0)},n.prototype.render=function(){var e=this.props,t=e.context,r=e.layoutController,n=e.shares,o=this.state.overlayNode,i=r.getLayoutBox();return u.default.createElement(dd,{context:t,layoutController:r,layoutBox:i,shares:n,overlayNode:o,storyInfo:this.state.storyInfo,lazyRenderInfo:this.state.lazyRenderInfo,force:this.state.force,addLazyTask:this.lazyRenderManager.addTask.bind(this.lazyRenderManager),removeLazyTask:this.lazyRenderManager.removeTaskForKey.bind(this.lazyRenderManager)})},n.prototype.sendNotification=function(e){var t=this;this.timerId=window.setTimeout((function(){t.props.shares.lifeCycle.isUpdating?(t.readyNotification=t.waitingNotification,t.trigger=!0):t.readyNotification?(t.props.context.fire(t.readyNotification),t.readyNotification=void 0,t.waitingNotification&&t.sendNotification(e)):t.waitingNotification&&(t.props.context.fire(t.waitingNotification),t.waitingNotification=void 0)}),e)},n}(u.default.Component),md=function(e,t,r,n,o,i,a,s,p){this.overlays=e,this.selectionOverlay=t,this.containerFocus=r,this.scrollHandler=n,this.containerRenderManager=o,this.decoratorManager=i,this.lifeCycle=a,this.isEditable=s,this.isFirstRender=p},bd=function(){function e(){this.map=new Map}return e.prototype.addRender=function(e,t){this.map.set(e,t)},e.prototype.getRender=function(e){return this.map.get(e)},e}(),Pd=function(){function t(t){this.context=t,this.map=new Map,this.map.set(e.ContainerType.Drawing,new bd),this.map.set(e.ContainerType.Plugin,new bd)}return t.prototype.addRender=function(e,t,r){var n=this.getRenderCollection(e);n&&n.addRender(t,r)},t.prototype.getRender=function(e,t){var r=this.getRenderCollection(e);if(r)return r.getRender(t)},t.prototype.renderContainerBox=function(e,t){var r=this.getDetailType(e.property);if(!r)return null;var n=this.getRender(e.property.containerType,r);return n?n(e,t,this.context):null},t.prototype.getRenderCollection=function(e){return this.map.get(e)},t.prototype.getDetailType=function(e){return e instanceof lr?e.drawingType:e instanceof jr?e.pluginType:void 0},t}(),vd=function(){function t(t,r,n){var o=this;this.context=t,this.state=r,this.selectionSwitch=n,this.selectionChangeCallback=function(e){if(o.focusedContainer){var t=e.range,r=ph(o.state,o.focusedContainer.firstIndex,o.focusedContainer.lastIndex);t.equal(r)||o.clearFocus()}},t.on(e.StateNotification.CoreSelectionChange,this.selectionChangeCallback)}return t.prototype.onFocus=function(t,r,n){void 0===n&&(n=!0),this.focusedContainer=t;var o=this.state.getTextStream().getRangeFromIndex(this.focusedContainer.firstIndex,this.focusedContainer.lastIndex);this.state.setRangeTo(o,{mobileSelectionDrag:e.MobileSelectionDragType.Hide,forceFocus:!1,scrollToView:e.ScrollViewType.None}),this.context.fire(new cf(!0,r,this.focusedContainer,n)),this.selectionSwitch.on=!1},t.prototype.clearFocus=function(){this.focusedContainer=void 0,this.context.fire(new cf(!1)),this.selectionSwitch.on=!0},t.prototype.getFocusedContainer=function(){return this.focusedContainer},t}(),xd=function(){function e(){this.scrollContainerHandlers=[]}return e.prototype.addScrollContainerHandler=function(e){this.scrollContainerHandlers.push(e)},e.prototype.scrollByIfNeed=function(e,t,r){for(var n=0;n<this.scrollContainerHandlers.length;n++){if(this.scrollContainerHandlers[n].scrollByIfNeed(e,t,r))return!0}return!1},e}(),Td=function(){function e(e,t,n,o,i){this.zoom=n,this.scrollContainerGetFunc=o,this.scrollConfig=i,this.context=e,this.state=t,i||(r.PlatformUtil.isMobile()||r.PlatformUtil.isIPad()?this.scrollConfig={feet:30,marginX:15,marginY:15}:this.scrollConfig={feet:60,marginX:30,marginY:30})}return e.prototype.scrollByIfNeed=function(e,t,r){var n=this.getScrollContainer(r);if(n){var o=this.calcScrollPositionIfNeed(e,t,n),i=o.scrollX,a=o.scrollY;if(0!==i||0!==a)return this.scrollBy(i,a,n),!0}return!1},e.prototype.scrollBy=function(e,t,r){if(r)if(r.scrollBy)r.scrollBy(e,t);else{var n=r.scrollLeft+e,o=r.scrollTop+t;this.scrollTo(n,o,r)}},e.prototype.scrollTo=function(e,t,r){r&&(r.scrollTo?r.scrollTo(e,t):(r.scrollLeft=e,r.scrollTop=t))},e.prototype.getScrollContainer=function(e){var t=e.leafBox;return t?this.scrollContainerGetFunc(t):null},e.prototype.getScrollContainerSize=function(e){var t=e.getBoundingClientRect();return{left:t.left,top:t.top,right:t.right,bottom:t.bottom}},e.prototype.calcScrollPositionIfNeed=function(e,t,r){var n=this.getScrollContainerSize(r),o=n.left,i=n.top,a=n.right,s=n.bottom,p=this.scrollConfig.feet,l=this.scrollConfig.marginX,c=this.scrollConfig.marginY,u=0;e-l<o?u=-p:e+l>a&&(u=p);var h=0;return t-c<i?h=-p:t+c>s&&(h=p),{scrollX:u,scrollY:h}},e}(),_d=function(){function t(t,n,o,i){var a=this;this.zoom=i,this.scrollRoot=null,this.scrollOnSelectionChanged=!0,this.keyboardHeight=-1,this.keyboardHeightFromSDK=-1,this.nativeToolbarHeightPx=-1,this.titlebarHeightFromSDK=-1,this.coveredPanel={height:-1,withToolbar:!0},this.isEditable=function(){return!0},this.mobileTopMarginExtra=0,this.scrollContainerManager=new xd,this.defaultMarginX=30,this.defaultMarginY=10,this.scrollByIfNeedThrottle=r.throttle((function(e,t,r){a.scrollContainerManager.scrollByIfNeed(e,t,r)||a.scrollByIfNeed(e,t)}),20),this.scrollByIfNeedMobileThrottle=r.throttle((function(e,t,r){a.scrollContainerManager.scrollByIfNeed(e,t,r)||a.scrollByIfNeedMobile(e,t)}),50),this.context=t,this.state=n,this.layoutController=o,this.onKeyBoardHeightNotifyListener=this.onKeyBoardHeightNotify.bind(this),this.context.on(e.RenderNotificationTypes.SELECTION_CHANGE,(function(e){a.onSelectionChanged(e)}),this),this.context.on(e.FocusBlurNotificationType.REQUEST_FOCUS,(function(e){if(null==e?void 0:e.data){var t=e.data,r=t.viewRange,n=t.from;r&&n&&a.checkViewRange(r.end)}})),this.context.on(e.RenderNotificationTypes.UPDATE_KEYBOARD_HEIGHT,(function(e){a.keyboardHeight=e.keyboardHeight,0!==a.keyboardHeight&&a.viewRange&&a.checkViewRange(a.viewRange.end)}),this),this.context.on(e.RenderNotificationTypes.UPDATE_COVERED_PANEL,(function(e){a.coveredPanel=Vu({},e.coverState)}),this)}return t.prototype.attach=function(){document.addEventListener("onNativeKeyboardHeightNotify",this.onKeyBoardHeightNotifyListener)},t.prototype.detach=function(){document.removeEventListener("onNativeKeyboardHeightNotify",this.onKeyBoardHeightNotifyListener)},t.prototype.addScrollContainer=function(e,t){var r=new Td(this.context,this.state,this.zoom,e,t);this.scrollContainerManager.addScrollContainerHandler(r)},t.prototype.setIsEditable=function(e){this.isEditable=e},t.prototype.setScrollRoot=function(e){this.scrollRoot=e},t.prototype.getScrollRoot=function(){return this.scrollRoot},t.prototype.addScrollListener=function(e){this.scrollRoot&&this.scrollRoot.addEventListener("scroll",e)},t.prototype.removeScrollListener=function(e){this.scrollRoot&&this.scrollRoot.removeEventListener("scroll",e)},t.prototype.onKeyBoardHeightNotify=function(e){this.keyboardHeightFromSDK=e.detail.nativeKeyboardHeightPx,this.nativeToolbarHeightPx=e.detail.nativeToolbarHeightPx,this.titlebarHeightFromSDK=e.detail.nativeTitlebarHeightPx},t.prototype.setMobileTopMarginExtra=function(e){this.mobileTopMarginExtra=e},t.prototype.onSelectionChanged=function(t){if((null==t?void 0:t.viewRange)&&this.scrollOnSelectionChanged){if(this.viewRange=t.viewRange,t.option&&t.option.scrollToView===e.ScrollViewType.None)return;if(t.option&&t.option.scrollToView===e.ScrollViewType.Top){if(t.viewRange.start){var r=t.viewRange.start.getDocumentOffset(this.zoom()),n=r.x,o=r.y,i=0;t.option.headerViewHeight&&(i=t.option.headerViewHeight),n*=this.zoom(),o*=this.zoom(),this.scrollToTop(n,o-i)}}else{var a=void 0;(a=!(!t.option||!t.option.backward)&&t.option.backward?t.viewRange.start:t.viewRange.end)&&this.checkViewRange(a)}}},t.prototype.checkViewRange=function(e){var t=e.caretHeight(),n=e.getDocumentOffset(this.zoom()),o=n.x,i=n.y;o*=this.zoom(),i*=this.zoom(),r.PlatformUtil.isMobile()?(r.PlatformUtil.isIOS(),this.scrollToIfNeedMobile(o,i,t)):this.scrollToIfNeed(o,i,t)},t.prototype.scrollByIfNeed=function(e,t){if(this.scrollRoot){var r=this.getScrollRootSize(),n=r.left,o=r.top,i=r.right,a=r.bottom,s=0;e-30<n?s=-60:e+30>i&&(s=60);var p=0;t-30<o?p=-60:t+30>a&&(p=60),0===s&&0===p||this.scrollBy(s,p)}},t.prototype.scrollByIfNeedMobile=function(e,t){if(this.scrollRoot){var r=this.getScrollRootSize(),n=r.left,o=r.top,i=r.right,a=r.bottom,s=0;e-5<n?s=-30:e+5>i&&(s=30);var p=0;t-5-this.getMobileTopMargin()<o?p=-30:t+5+this.getMobileBottomMargin()>a&&(p=30),0===s&&0===p||this.scrollBy(s,p)}},t.prototype.scrollBy=function(e,t){if(this.scrollRoot)if(this.scrollRoot.scrollBy)this.scrollRoot.scrollBy(e,t);else{var r=this.getScrollLeft()+e,n=this.getScrollTop()+t;this.scrollTo(r,n)}},t.prototype.scrollToIfNeed=function(e,t,r){if(this.scrollRoot){var n=this.getScrollRootSize(),o=n.left,i=n.top,a=n.right-o,s=n.bottom-i-r,p=this.defaultMarginX,l=this.defaultMarginY,c=this.scrollRoot.scrollLeft,u=this.scrollRoot.scrollTop,h=c;e<c?h=Math.max(e-p,0):e>c+a&&(h=e-a+p);var f=u;t<u?f=Math.max(t-l,0):t>u+s&&(f=t-s+l),h===c&&f===u||this.scrollTo(h,f)}},t.prototype.scrollToIfNeedMobile=function(e,t,n){if(this.scrollRoot&&(0!==e||0!==t)){var o=window.orientation,i=0===o||180===o,a=window.innerHeight,s=this.getMobileTopMargin(),p=this.getScrollRootSize(),l=p.left,c=p.top,u=p.right,h=p.bottom,f=u-l,d=n;0!==this.mobileTopMarginExtra&&(d=0);var g=h-c-d-s-this.getMobileBottomMargin();/(uiwebview)/i.test(navigator.userAgent)&&g>a&&(g=a-d-s);var y=this.defaultMarginX,m=this.defaultMarginY,b=this.scrollRoot.scrollLeft,P=this.scrollRoot.scrollTop,v=b;e<b?v=Math.max(e-y,0):e>b+f&&(v=e-f+y);var x=P;if(t<P+s?x=Math.max(t-s,0):t>P+s+g&&(x=t-g+m),!i&&r.PlatformUtil.isWXorQQMiniProgram()){x=Math.max(t-5,0)}v===b&&x===P||this.scrollTo(v,x)}},t.prototype.scrollTo=function(e,t){this.scrollRoot&&(this.scrollRoot.scrollTo?this.scrollRoot.scrollTo(e,t):(this.scrollRoot.scrollLeft=e,this.scrollRoot.scrollTop=t))},t.prototype.scrollToTop=function(e,t){if(this.scrollRoot){var n=this.defaultMarginX,o=r.PlatformUtil.isIPad()?90:this.defaultMarginY,i=e>n?e-n:0,a=t>o?t-o:0;this.scrollTo(i,a)}},t.prototype.getScrollRootSize=function(){if(this.scrollRoot){var e=this.scrollRoot.getBoundingClientRect();return{left:e.left,top:e.top,right:e.right,bottom:e.bottom}}return{left:0,top:0,right:window.innerWidth,bottom:window.innerHeight}},t.prototype.getScrollTop=function(){return this.scrollRoot?this.scrollRoot.scrollTop:0},t.prototype.setScrollTop=function(e){this.scrollRoot&&(this.scrollRoot.scrollTop=e)},t.prototype.getScrollLeft=function(){return this.scrollRoot?this.scrollRoot.scrollLeft:0},t.prototype.getOffsetHeight=function(){return this.scrollRoot?this.scrollRoot.offsetHeight:window.innerHeight},t.prototype.getOffsetWidth=function(){return this.scrollRoot?this.scrollRoot.offsetWidth:window.innerWidth},t.prototype.enableScrollOnSelectionChanged=function(){this.scrollOnSelectionChanged=!0},t.prototype.disableScrollOnSelectionChanged=function(){this.scrollOnSelectionChanged=!1},t.prototype.getMobileTopMargin=function(){var e=5+this.mobileTopMarginExtra,t=0;return r.PlatformUtil.isWeWork()?t:(-1===this.keyboardHeight&&0===this.mobileTopMarginExtra&&(t=44),t+e)},t.prototype.getMobileBottomMargin=function(){var e=44;-1!==this.nativeToolbarHeightPx&&(e=this.nativeToolbarHeightPx);var t=0,n=0===window.orientation||180===window.orientation?window.innerHeight<screen.height-180:window.innerHeight<screen.width-180;return-1!==this.coveredPanel.height?(t=this.coveredPanel.height,this.coveredPanel.withToolbar&&(t+=e)):-1!==this.keyboardHeightFromSDK?t=n?0:this.keyboardHeightFromSDK+e:-1!==this.keyboardHeight?t=n?e:this.keyboardHeight+e:(r.PlatformUtil.isIPad()||r.PlatformUtil.supportNativeToolbar()||(t=n?0:window.innerHeight/2-20),t=n||!this.context.isEditable()||this.isViewState()?0:window.innerHeight/2),t},t.prototype.getInSightRange=function(){var t=this.state,n=this.layoutController?this.layoutController.getLayoutBox():null;if(!this.scrollRoot||!t||!n)return{startGCP:0,endGCP:0};var o=Xu([0,0],2),i=o[0],a=o[1],s=this.getScrollTop(),p=this.getScrollTop()+window.innerHeight,l=new r.MeloPoint;if(this.layoutController.env.isPageMode){l.y=r.pxToTwips(s);var c=Xu(Il.getGrandsonByPoint(n,e.BoxKind.LogicPage,l),2),u=c[0],h=(c[1],u?Il.getPrevBox(u):null);i=u&&h?t.getTextStream().getRangeFromIndex(h.firstIndex,h.lastIndex).begin():0,l.y=r.pxToTwips(p);var f=Xu(Il.getGrandsonByPoint(n,e.BoxKind.LogicPage,l),2),d=f[0],g=(f[1],d?Il.getNextBox(d):null);a=d&&g?t.getTextStream().getRangeFromIndex(g.firstIndex,g.lastIndex).begin():t.getTextStream().getLength()}else{s-=1e3,p+=1e3,l.y=r.pxToTwips(s),l.x=n.totalBoxSize.width/2;var y=Xu(Il.getGrandsonByPoint(n,e.BoxKind.Paragraph,l),2);u=y[0],y[1];i=u?t.getTextStream().getRangeFromIndex(u.firstIndex,u.lastIndex).begin():0,l.y=r.pxToTwips(p);var m=Xu(Il.getGrandsonByPoint(n,e.BoxKind.Paragraph,l),2);d=m[0],m[1];a=d?t.getTextStream().getRangeFromIndex(d.firstIndex,d.lastIndex).begin():t.getTextStream().getLength()}return{startGCP:i,endGCP:a}},t.prototype.getInSightStartBox=function(){var t=this.state,n=this.layoutController?this.layoutController.getLayoutBox():null;if(!this.scrollRoot||!t||!n)return{startGCP:0};var o=0,i=this.getScrollTop();i/=this.zoom();var a=new r.MeloPoint;a.y=r.pxToTwips(i),a.x=n.totalBoxSize.width/2;var s,p,l=Xu(Il.getGrandsonByPoint(n,e.BoxKind.Paragraph,a),2),c=l[0],u=l[1],h=-1,f=-1;if(c){var d=0,g=c.children&&c.children[d];if(g){for(var y=g.rect.getBottom();a.y>y&&d<c.children.length;)y=(g=c.children[d]).rect.getBottom(),d+=1;h=r.twipsToPx(u.x),f=r.twipsToPx(u.y-g.rect.y),bs(g.firstChild)&&(p=g.firstChild.text),s=g}else s=c,f=i;o=t.getTextStream().getRangeFromIndex(c.firstIndex,c.lastIndex).begin()}else o=0,f=i;return{startBox:c,startGCP:o,startBoxOffsetX:h,startBoxOffsetY:f,startSubBox:s,startText:p}},t.prototype.getInSightFirstStartBox=function(){var e=this.state,t=this.layoutController?this.layoutController.getLayoutBox():null;if(!this.scrollRoot||!e||!t)return{startGCP:0};var n=0,o=this.getScrollTop();o/=this.zoom();var i=new r.MeloPoint;i.y=r.pxToTwips(o),i.x=t.totalBoxSize.width/2;var a,s=Xu(this.getLeafBoxByPointY(t,i),2),p=s[0],l=s[1],c=-1;return p?(c=r.twipsToPx(l.y),bs(p)&&(a=p.text),n=e.getTextStream().getRangeFromIndex(p.firstIndex,p.lastIndex).begin()):(n=0,c=o),{startBox:p,startGCP:n,startBoxOffsetY:c,startText:a}},t.prototype.getLeafBoxByPointY=function(e,t){for(var r=t,n=e,o=function(e,t){return e.y>=t.y&&e.y<=t.getBottom()},i=0;;){var a=Xu(n.getChildByPoint(r,o),2),s=a[0],p=a[1];if(!s||!p)return i>0?[n,r]:[];if(!is(s))return[s,p];n=s,r=p,i+=1}},t.prototype.isViewState=function(){return document.activeElement===document.body},t}(),Sd=function(){function e(){this.updating=!1,this.watchers=[]}return Object.defineProperty(e.prototype,"isUpdating",{get:function(){return this.updating},enumerable:!0,configurable:!0}),e.prototype.willUpdate=function(){this.updating=!0},e.prototype.afterUpdate=function(){var e,t;this.updating=!1;try{for(var r=qu(this.watchers),n=r.next();!n.done;n=r.next()){n.value.afterUpdate()}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},e.prototype.addWatcher=function(e){this.watchers.push(e),this.updating||e.afterUpdate()},e.prototype.removeWatcher=function(e){this.watchers.slice(this.watchers.indexOf(e))},e}(),Cd=function(){function t(t,r,n){var o=this;this.context=t,this.state=r,this.layoutController=n,this._isFirstRender=!1,this.wrapper=null,this._zoom=1,this.overlays=new If(t,r,n),this.selectionOverlay=new $f(t,r,n),this.containerFocus=new vd(t,r,this.selectionOverlay.switcher),this.scrollHandler=new _d(t,r,n,(function(){return o._zoom})),this.containerRenderManager=new Pd(t),this.decoratorManager=new Sh([e.BoxKind.ContainerPage,e.BoxKind.TextPage,e.BoxKind.Paragraph,e.BoxKind.TextLine,e.BoxKind.TextLineFragment,e.BoxKind.Text]),this.lifeCycle=new Sd,this.overlays.addOverlay(this.selectionOverlay),this.context.on(e.RenderNotificationTypes.FIRST_RENDER,(function(){o.isFirstRender=!0}))}return t.prototype.buildComponent=function(){var e=this,t=new md(this.overlays,this.selectionOverlay,this.containerFocus,this.scrollHandler,this.containerRenderManager,this.decoratorManager,this.lifeCycle,(function(){return e.isEditable}),(function(){return e.isFirstRender}));return this.scrollHandler.setIsEditable((function(){return e.isEditable})),u.default.createElement(yd,{layoutController:this.layoutController,context:this.context,state:this.state,shares:t,scrollHandler:this.scrollHandler,ref:function(t){e.wrapper=t}})},t.prototype.getViewSelection=function(){return this.selectionOverlay.viewSelection},Object.defineProperty(t.prototype,"zoom",{get:function(){return this._zoom},set:function(e){this._zoom=e,this.overlays.zoom(e),this.wrapper&&this.wrapper.zoom(e)},enumerable:!0,configurable:!0}),t.prototype.attach=function(){this.scrollHandler.attach()},t.prototype.detach=function(){this.scrollHandler.detach()},Object.defineProperty(t.prototype,"isEditable",{get:function(){return this.context.isEditable()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isFirstRender",{get:function(){return this._isFirstRender},set:function(e){this._isFirstRender=e},enumerable:!0,configurable:!0}),t.prototype.forceRerender=function(){this.wrapper&&this.wrapper.forceRerender()},t}(),Bd=function(e,t){return(Bd=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)};function Rd(e,t){function r(){this.constructor=e}Bd(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var wd=function(){return(wd=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function Id(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a}function Ed(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}var Ld=function(){this.lastTime=0,this.costTime=new Float32Array(e.EditMetric.COUNT)},Od=function(){function e(){this.checkMeasureNode()}return e.prototype.checkMeasureNode=function(){if(this._innerSpan)return!0;r.Logger.info("init measure nodes");var e=document.getElementById("melo-hidden-iframe"),t=e&&(e.contentDocument||e.contentWindow&&e.contentWindow.document);return t?(t.open(),t.write("<!DOCTYPE html>"),t.write('<html lang="zh_CN"><head></head><body><span style="white-space:nowrap;"><bdo dir="ltr"><span id="inner-span"></span></bdo></span></body></html>'),t.close(),this._innerSpan=t.getElementById("inner-span")):r.Logger.error("measure|iframe document undefined"),!!this._innerSpan||(r.Logger.error("measure|inner span null"),!1)},e.prototype.setBodyStyle=function(e){var t=document.getElementById("melo-hidden-iframe"),r=t&&(t.contentDocument||t.contentWindow&&t.contentWindow.document);return!!r&&(r.body.setAttribute("style",e),!0)},e.prototype.measureSize=function(e,t,r,n){if(!this.checkMeasureNode())return[0,0];this._innerSpan.setAttribute("style",this.realStyle(n)),this._innerSpan.innerText=e;var o=this._innerSpan.getBoundingClientRect();return[o?o.width:0,o?o.height:0]},e.prototype.measureChar=function(e,t,r,n,o){if(!this.checkMeasureNode())return{width:0,height:0,offsetLeft:0};this._innerSpan.setAttribute("style",this.realStyle(r)),this._innerSpan.innerText=e;var i=document.createRange(),a=this._innerSpan.firstChild;i.setStart(a,n),i.setEnd(a,o>a.length?a.length:o);var s=i.getBoundingClientRect(),p=s.left-this._innerSpan.offsetLeft;return{width:s.width,height:s.height,offsetLeft:p}},e.prototype.realStyle=function(e){return e+"background-color:transparent;font-style:normal;font-variant:normal;text-decoration:none;vertical-align:baseline;white-space:pre;"},e}(),Nd=function(e){function t(){var t=e.call(this)||this;return t._ctx=null,t.checkMeasureCanvas(),t}return Rd(t,e),t.prototype.checkMeasureCanvas=function(){if(this._ctx)return!0;r.Logger.info("init measure nodes");var e=document.createElement("canvas");return e.id="melo-measure-canvas",e.width=500,e.height=100,this._ctx=e.getContext("2d"),!!this._ctx||(r.Logger.error("measure|canvas context null"),!1)},t.prototype.measureSize=function(t,r,n,o){return n?e.prototype.measureSize.call(this,t,r,n,o):this.checkMeasureCanvas()?(this._ctx.font=o,[this._ctx.measureText(t).width,0]):[0,0]},t}(Od),kd=function(){function e(e){this._cacheL1={},this._measureImp=e}return e.prototype.setGlobalStyle=function(e){return this._measureImp.setBodyStyle(e)},e.prototype.measure=function(e,t,r,n){void 0===t&&(t="ltr"),void 0===r&&(r=""),void 0===n&&(n=!1),this._cacheL1.hasOwnProperty(r)||(this._cacheL1[r]=new Map);var o=this._cacheL1[r],i=o.get(e);return i||(i=this._measureImp.measureSize(e,t,n,r),o.set(e,i),i)},e.prototype.measureChar=function(e,t,r,n,o){return void 0===t&&(t="ltr"),void 0===r&&(r=""),this._measureImp.measureChar(e,t,r,n,o)},e.prototype.clearCache=function(){this._cacheL1={}},e}(),Md=function(){function t(){this.measureImpl=new kd(this.useCanvas?new Nd:new Od),this.CJKCache={}}return Object.defineProperty(t.prototype,"useCanvas",{get:function(){return void 0===this._useCanvas&&(this._useCanvas=r.PlatformUtil.isAndroid()),this._useCanvas},enumerable:!0,configurable:!0}),t.prototype.computeCSSStyleForTextRunAttr=function(t,n){void 0===n&&(n=!1);var o=r.twipsToPt(t.fontSize),i=t.fontWeight,a=t.fontFamily;if(t.has(e.SpanPropKey.fontFamily)&&a!==ot.fontFamily){var s=a.split(",").filter((function(e){return"sans-serif"!==e}));a=s.join(",")+","+ot.fontFamily}return this.useCanvas&&!n?i+" "+o+"pt "+a:"font-size:"+o+"pt;font-family:"+a+";font-weight:"+i+";letter-spacing:"+r.twipsToPt(t.letterSpacing)+"pt;"},t.prototype.measureAttributedText=function(e,t){var o,i=t.fontSize<180||0!==t.letterSpacing,a=this.computeCSSStyleForTextRunAttr(t,i),s=1===e.length&&"Han"===n.getScript(e.codePointAt(0)||0),p=s?this.CJKCache[a]:void 0;return p?o=p:(o=this.measureImpl.measure(e.toString(),"ltr",a,i),s&&(this.CJKCache[a]=o)),{width:o[0]*r.TwipsPerPx||0,height:this.getTextHeight(t,o[1]*r.TwipsPerPx)}},t.prototype.getTextHeight=function(e,t){return e&&e.fontSize&&!Number.isNaN(e.fontSize)?e.fontSize>=180?1.3*e.fontSize:t:1.3*ot.fontSize},t.prototype.measureChar=function(e,t,r,n){var o=this.computeCSSStyleForTextRunAttr(t,!0);return this.measureImpl.measureChar(e.toString(),"ltr",o,r,n)},t.prototype.setGlobalStyle=function(e){return!!this.measureImpl.setGlobalStyle(e)&&(this.clearCache(),!0)},t.prototype.clearCache=function(){this.CJKCache={},this.measureImpl.clearCache()},t}();var Dd="surface";!function(e,t){void 0===t&&(t={});var r=t.insertAt;if(e&&"undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css","top"===r&&n.firstChild?n.insertBefore(o,n.firstChild):n.appendChild(o),o.styleSheet?o.styleSheet.cssText=e:o.appendChild(document.createTextNode(e))}}(".surface {\n  position: relative;\n  overflow: visible;\n  display: inline-block;\n  transform-origin: 0 0;\n  transform-style: preserve-3d;\n  -webkit-transform-style: preserve-3d;\n  font-family: ''; }\n");var Fd={TOP:r.PlatformUtil.isMobile()?0:12,RIGHT:r.PlatformUtil.isMobile()?0:8,BOTTOM:0,LEFT:r.PlatformUtil.isMobile()?0:8},Ad=function(){function e(e,t,r){this.context=e,this.state=t,this.layoutController=r,this.root=null,this.surfaceDom=null,this.renderer=new Cd(e,t,r)}return e.prototype.buildComponent=function(e){this.root=e;var t={context:this.context,state:this.state,layoutController:this.layoutController,renderer:this.renderer,root:e};return u.default.createElement(Kd,wd({},t))},e.prototype.attach=function(){this.renderer.attach()},e.prototype.detach=function(){this.renderer.detach()},e.prototype.getViewSelection=function(){return this.renderer.getViewSelection()},e.prototype.getScrollHandler=function(){return this.renderer.scrollHandler},e.prototype.setScrollRoot=function(e){this.renderer.scrollHandler.setScrollRoot(e)},e.prototype.getScrollRoot=function(){return this.renderer.scrollHandler.getScrollRoot()},e.prototype.forceRerender=function(){this.renderer.forceRerender()},e.prototype.getDom=function(){return!this.surfaceDom&&this.root&&(this.surfaceDom=this.root.querySelector(".surface")),this.surfaceDom},e.prototype.setPadding=function(e){!this.surfaceDom&&this.root&&(this.surfaceDom=this.root.querySelector(".surface")),this.surfaceDom&&(void 0!==e.top&&(this.surfaceDom.style.paddingTop=e.top+"px"),void 0!==e.right&&(this.surfaceDom.style.paddingRight=e.right+"px"),void 0!==e.bottom&&(this.surfaceDom.style.paddingBottom=e.bottom+"px"),void 0!==e.left&&(this.surfaceDom.style.paddingLeft=e.left+"px")),this.renderer.selectionOverlay.clearCache()},e.prototype.resetPadding=function(){!this.surfaceDom&&this.root&&(this.surfaceDom=this.root.querySelector(".surface")),this.surfaceDom&&(this.surfaceDom.style.paddingTop=Fd.TOP+"px",this.surfaceDom.style.paddingRight=Fd.RIGHT+"px",this.surfaceDom.style.paddingBottom=Fd.BOTTOM+"px",this.surfaceDom.style.paddingLeft=Fd.LEFT+"px"),this.renderer.selectionOverlay.clearCache()},e.prototype.getPadding=function(){if(!this.surfaceDom&&this.root&&(this.surfaceDom=this.root.querySelector(".surface")),this.surfaceDom){var e=0;this.surfaceDom.style.paddingTop&&(e=Number(this.surfaceDom.style.paddingTop.replace("px","")));var t=0;this.surfaceDom.style.paddingRight&&(t=Number(this.surfaceDom.style.paddingRight.replace("px","")));var r=0;this.surfaceDom.style.paddingBottom&&(r=Number(this.surfaceDom.style.paddingBottom.replace("px","")));var n=0;return this.surfaceDom.style.paddingLeft&&(n=Number(this.surfaceDom.style.paddingLeft.replace("px",""))),{top:e,right:t,bottom:r,left:n}}return{top:0,right:0,bottom:0,left:0}},e}(),Kd=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Rd(t,e),t.prototype.onContextMenu=function(e){this.props.layoutController.env.isPresentation||(this.props.context.fire(new yf(e),!1),e.preventDefault(),e.stopPropagation())},t.prototype.render=function(){var e=this,t=this.props.renderer;return u.default.createElement("div",{className:Dd,onContextMenu:function(t){e.onContextMenu(t)},style:{paddingTop:Fd.TOP,paddingRight:Fd.RIGHT,paddingBottom:Fd.BOTTOM,paddingLeft:Fd.LEFT}},t.buildComponent(),u.default.createElement("div",{className:"hidden-editor"}),u.default.createElement("div",{className:"caret"}),u.default.createElement("div",{className:"mobile-caret-drag"}),u.default.createElement("div",{className:"mobile-selection-drag"}),u.default.createElement("div",{className:"hidden-selection"}))},t}(u.default.Component),Gd=function(t){function n(e){var r=t.call(this)||this;return r._docEnv=wd({},qo),r.root=null,r.updateDocEnv(e),r.state=wu.emptyState(r),r.layoutController=new mu(r,r.state.dataEngine),r.clipboardManager=new Uu(r),r._view=new Ad(r,r.state,r.layoutController),r._perfHandler=new Ld,r.injectInnerServices(),wl.getDefaultEngine().setTextRunMeasureImp(new Md),r}return Rd(n,t),n.prototype.injectInnerServices=function(){var e=this.factory;e.set(ja,this),e.set(Ru,this.state),e.set(Cs,this.layoutController),e.set(ju,this.clipboardManager)},n.emptyEditor=function(e){var t=new n(e);return t.emptyContent(),t},n.prototype.emptyContent=function(){var t=Wo.createTempDataEngine(),r=new Vt;r.storyType=e.StoryType.MainTextStory,r.storyId=e.StoryID.MainDocId,t.getRWTextStream().insertStoryBegin(0,r),t.getRWTextStream().insertStoryEnd(0,r,uo.StoryEnd),t.getRWTextStream().insertSection(0,uo.SectionBreak,new Lt,new lt),t.getRWTextStream().insertParagraph(0,uo.ParagraphBreak,new Nt,new gt),this.state.importDocData(t),this.onContentInit()},n.prototype.setContent=function(e){var t=Wo.createTempDataEngine();e.applyOperations(t.getRWTextStream()),this.state.importDocData(t),this.onContentInit()},n.prototype.onContentInit=function(){var e=this,t=hp.getClientSize();t.width>0&&t.height>0?(this.layoutController.reset(),this.fire(new Sa)):window.mqq&&window.mqq.invoke&&window.mqq.invoke("docx","getNativeScreenSize",{},(function(t){(null==t?void 0:t.data)&&(ot.nativeScreenSize={width:t.data.width,height:t.data.height},r.Logger.info("getNativeScreenSize","width: "+ot.nativeScreenSize.width+", height: "+ot.nativeScreenSize.height)),e.layoutController.reset(),e.fire(new Sa)}))},n.prototype.newContentFromEditor=function(e){var t=e.state.dataEngine;this.state.importDocData(t),this.onContentInit()},Object.defineProperty(n.prototype,"surface",{get:function(){if(!this._surface)throw new Error("ISurface not injected yet!");return this._surface},enumerable:!0,configurable:!0}),n.prototype.getContainerManager=function(){return this.state.dataEngine.getContainerManager()},n.prototype.getFieldEngine=function(){return this.state.dataEngine.getFieldEngine()},n.prototype.updateDocEnv=function(e){e&&Object.assign(this._docEnv,e)},Object.defineProperty(n.prototype,"docEnv",{get:function(){return this._docEnv},enumerable:!0,configurable:!0}),n.prototype.setEditable=function(e){this._docEnv.editable=e},n.prototype.isEditable=function(){return this._docEnv.editable},n.prototype.setCopyable=function(e){this._docEnv.copyable=e},n.prototype.isCopyable=function(){return this._docEnv.copyable},Object.defineProperty(n.prototype,"service",{get:function(){if(!this._service)throw new Error("IService not injected yet!");return this._service},enumerable:!0,configurable:!0}),n.prototype.onSelection=function(){if(!this._service)throw new Error("IService not injected yet!");return this._service.getSelection()},n.prototype.onDocument=function(){if(!this._service)throw new Error("IService not injected yet!");return this._service.getDocument()},n.prototype.buildComponent=function(e){return this._view.buildComponent(e)},n.prototype.getRoot=function(){return this.root},Object.defineProperty(n.prototype,"view",{get:function(){return this._view},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scrollHandler",{get:function(){return this._view.getScrollHandler()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"zoom",{get:function(){return this._view.renderer.zoom},set:function(e){this._view.renderer.zoom=e},enumerable:!0,configurable:!0}),n.prototype.isCaret=function(){return this.state.selection.isCollapse()},n.prototype.isCompositing=function(){return this.state.isCompositing()},Object.defineProperty(n.prototype,"selection",{get:function(){return this.state.selection},enumerable:!0,configurable:!0}),n.prototype.setRangeTo=function(e,t){return this.state.setRangeTo(e,t)},n.prototype.getRangeFromIndex=function(e,t){return this.state.getTextStream().getRangeFromIndex(e,t)},Object.defineProperty(n.prototype,"viewSelection",{get:function(){return this._view.getViewSelection()},enumerable:!0,configurable:!0}),n.prototype.getViewRangeFromGcpRange=function(e){var t=this;return Af(this.layoutController,(function(e){return t.layoutController.boxHelper.getGCPPair(e)}),e)},n.prototype.getInSightRange=function(){return this.scrollHandler.getInSightRange()},n.prototype.createRangeManager=function(e){return void 0===e&&(e=!0),this.state.dataEngine.createRangeClass(!1,e)},n.prototype.createGcpManager=function(t,r){return void 0===t&&(t=!0),void 0===r&&(r=e.PosPolicy.Outer),this.state.dataEngine.createGCPClass(!1,t,r)},n.prototype.createSelector=function(){return new jf(new Hf(this.state))},n.prototype.attachEditor=function(e){this.root=e,c.default.render(this._view.buildComponent(e),e),e.editor=this,this._view.attach(),this._surface&&this._surface.attach(),this.clipboardManager.attach()},n.prototype.detach=function(){this.root&&this.root.remove(),this._view.detach(),this._surface&&this._surface.detach(),this.clipboardManager.detach()},Object.defineProperty(n.prototype,"isUpdating",{get:function(){return this._view.renderer.lifeCycle.isUpdating},enumerable:!0,configurable:!0}),n.prototype.setLayoutType=function(e){this._docEnv.layoutType=e,this.layoutController.reset(),this.fire(new Sa)},n.prototype.addContainerRender=function(e,t,r){this._view.renderer.containerRenderManager.addRender(e,t,r)},n.prototype.addLineOverlay=function(e){this._view.renderer.overlays.addOverlay(e)},n.prototype.addDecorator=function(e,t){this._view.renderer.decoratorManager.addDecorator(e,t)},n.prototype.addStyleDecorator=function(e,t){this._view.renderer.decoratorManager.addStyleDecorator(e,t)},n.prototype.addContentDecorator=function(e,t,r){this._view.renderer.decoratorManager.addContentDecorator(e,t,r)},n.prototype.addStyleProperty=function(e){this.state.dataEngine.getStyleSheetEngine().setStylePropertyFromName(e.styleName,e)},n.prototype.addStyleProperties=function(e){var t=this.state.dataEngine.getStyleSheetEngine();e.forEach((function(e){t.setStylePropertyFromName(e.styleName,e)}))},n.prototype.addScrollContainer=function(e,t){this.scrollHandler.addScrollContainer(e,t)},n.prototype.getDocumentBox=function(){return this.layoutController.getLayoutBox()},Object.defineProperty(n.prototype,"pageCount",{get:function(){var e=this.layoutController.getLayoutState();return e.isFinished?e.pageCount:NaN},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"wordCount",{get:function(){var e=this.layoutController.env;return this.layoutController.getLayoutBox().countWord(e)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"statisticInfo",{get:function(){var t=0,r=0,n=0,o="",i=this.getDocumentBox();return i&&(t=i.countNodes(),r=i.countNodes((function(t){return t.kind===e.BoxKind.Container})),n=i.countNodes((function(t){return t.kind===e.BoxKind.Table}),(function(t){return t.kind===e.BoxKind.Paragraph||t.kind===e.BoxKind.Table})),o=navigator.userAgent||""),{dom_num:t,sheet_num:n,pic_num:r,wordNum:this.wordCount,layoutType:this._docEnv.layoutType===e.LayoutType.Scroll?0:1,browserInfo:o}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"perfInfo",{get:function(){var t=this.perfHandler.costTime;return{applyDelta:t[e.EditMetric.ApplyDelta].toFixed(2),collab:t[e.EditMetric.Collab].toFixed(2),layout:t[e.EditMetric.Layout].toFixed(2),reflow:t[e.EditMetric.Reflow].toFixed(2),render:t[e.EditMetric.Render].toFixed(2),overlay:t[e.EditMetric.Overlay].toFixed(2)}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"perfHandler",{get:function(){return this._perfHandler},enumerable:!0,configurable:!0}),n.prototype.applyDelta=function(e){this.state.applyDelta(e)},Id([za,Ed("design:type",Object)],n.prototype,"_service",void 0),Id([Va,Ed("design:type",Object)],n.prototype,"_surface",void 0),n}(ui);return e.AdapterUtil=hp,e.ApplyDeltaCheckNotification=Ca,e.BaseContainerProperty=nr,e.BaseLineOverlay=Zf,e.BasePropIterator=Mn,e.BaseSelector=jf,e.BoxDecorators=Th,e.BoxHelper=lu,e.BoxUtil=ch,e.CaretChangeNotification=lf,e.ClassDescriptor=ri,e.ClearParaOperation=Yi,e.ClearParaProps=dt,e.ClearSectionOperation=Ji,e.ClearSpanOperation=xi,e.ClearSpanProps=St,e.ClearStoryOperation=pa,e.ClipboardManager=Uu,e.ClipboardNotification=Hu,e.CodeblockProperty=Er,e.CollabToServerNotification=ba,e.CommentSpanProperty=vt,e.CommonProperty=Ke,e.ContainerFocus=vd,e.ContainerFocusNotification=cf,e.ContainerManager=Lo,e.ContainerRenderManager=Pd,e.ContentDecorators=xh,e.Context=ui,e.ContextMenuMobileNotification=mf,e.ContextMenuNotification=yf,e.CopyInterface=Lu,e.CoreRange=Su,e.CoreSelection=Cu,e.CoreSelectionChangeNotification=ya,e.CoveredPanelHeightNotification=vf,e.CssStyleMap=nh,e.CssUtil=oh,e.CusorPropChangeNotification=Ta,e.CustomClipboard=Fu,e.CutInterface=Ou,e.CyclicDependencyError=li,e.DATA_VERSION="2.1.0",e.DOC_ID="BB08J2",e.DataCollector=wi,e.DataDeleteContainerNotification=mn,e.DataDeleteNotification=un,e.DataEngine=Wo,e.DataFieldDeleteNotification=Uo,e.DataFieldInsertNotification=jo,e.DataInsertContainerNotification=yn,e.DataInsertNotification=cn,e.DataIterator=An,e.DataModifyContainerNotification=bn,e.DataNotificationCenter=Pn,e.DecoratorManager=Sh,e.DefaultContainerProperty=or,e.DefaultDrawingProperty=cr,e.DefaultPluginProperty=Ur,e.Defaults=ot,e.DeleteContainerNotification=va,e.DeleteOperation=Ei,e.Delta=la,e.DeltaChecker=Bu,e.DeltaOption=Ti,e.DocumentNode=yp,e.DrawingContainerProperty=lr,e.EfficientModelChangeNotification=ga,e.EmbedCommentProperty=Fr,e.EmbedCommentPropertyGetters=Or,e.EmbedContainerNode=rp,e.EmbedNode=tp,e.EmptyNode=ep,e.FTNodeBase=Q,e.FTPolicyBase=$,e.FTTreeIterator=ee,e.FieldCharSpan=Ht,e.FieldCodeNode=ap,e.FieldDeleteNotification=Ho,e.FieldEngine=zo,e.FieldInsertNotification=Go,e.FieldIterator=No,e.FieldPropList=Oo,e.FieldUtil=Xo,e.FieldcodeManager=Fo,e.FieldcodeProcessor=Do,e.FirstRenderNotification=rf,e.FloatTree=re,e.FloatTreeBase=te,e.FocusBlurNotification=ff,e.FullRenderFinishNotification=af,e.FullRenderNotification=of,e.GCPClass=xn,e.GCPClassBase=vn,e.GCPRange=ne,e.GlobalContext=hi,e.GraphemeBreakerTool=Iu,e.GroupNode=Js,e.HeaderFooterDBClickNotification=bf,e.HeaderFooterDecorators=bh,e.HiddenEditorNotification=ws,e.IBaseProperty=fe,e.IClipboardManager=ju,e.IContentModifyOperationBase=bi,e.IContentOperationBase=mi,e.ICopyParserManager=Eu,e.ICustomClipboard=Du,e.IEditor=ja,e.ILayoutController=Cs,e.INVALID_POSITION=Z,e.IOperationBase=yi,e.IPasteProcessorManager=Mu,e.IService=za,e.IState=Ru,e.ISurface=Va,e.ITDIterator=H,e.ITableOperationBase=Zi,e.ImageProperty=vr,e.ImageSizeInitNotification=uf,e.InsertContainerNotification=Pa,e.InsertOperation=Mi,e.InsertParaOperation=Di,e.InsertSectionOperation=Ui,e.InsertStoryBeginOperation=Li,e.InsertStoryEndOperation=Oi,e.InsertTableCellParaOperation=Ki,e.InsertTableCellStartOperation=Gi,e.InsertTableColOperation=na,e.InsertTableEndParaOperation=Ai,e.InsertTableRowOperation=ra,e.InsertTableRowParaOperation=Hi,e.InsertTableRowStartOperation=ji,e.InsertTableStartParaOperation=Fi,e.InstantiationFactory=ci,e.IntervalUtil=B,e.KeyGenerator=sh,e.KeyboardHeightNotification=Pf,e.KeyboardNotification=Is,e.LayoutChangeNotification=gu,e.LayoutController=mu,e.LayoutFinishedNotification=yu,e.LayoutGlobalEnv=du,e.LayoutInputNode=Vs,e.LayoutUtil=Il,e.LeafNode=$s,e.LeafNodeFactory=ip,e.LineFragmentDecorators=Ph,e.LineOverlayStyle=Wf,e.LinePaddingLeftDecorators=dh,e.LinePlaceholderDecorators=_h,e.ListFormat=tt,e.ListInfo=Ro,e.ListManager=Eo,e.ListMarkTextBox=ll,e.ListModelChangeNotification=ma,e.ListNode=Qs,e.ListTextLineBox=Zp,e.ListUtils=Bo,e.MATCH_PARENT=-1,e.MODEL_DID_CHANGE_ACTION="modelDidChangeAction",e.MOUSE_EVENT_TIMES=1e7,e.MRInsertPosType=ie,e.MRNodeBase=oe,e.MRPolicyBase=ae,e.MeloEditor=Gd,e.MergeTableCellOperation=ta,e.MirrorTree=pe,e.MirrorTreeBase=se,e.MobileSelectionDragNotification=Ls,e.MockEditor=Ua,e.ModelChangeNotification=da,e.ModelDirtyRange=fa,e.ModifyContainerNotification=xa,e.ModifyGlobalPropNotification=_a,e.ModifyParaOperation=Wi,e.ModifyParaOperationBase=zi,e.ModifySectionOperation=Xi,e.ModifySectionOperationBase=qi,e.ModifySpanOperation=vi,e.ModifySpanOperationBase=Pi,e.ModifyStoryOperation=sa,e.ModifyStoryOperationBase=aa,e.ModifyTableCellOperation=Qi,e.ModifyTableDimensionOperation=ea,e.ModifyTableParaOperation=Vi,e.MouseNotification=As,e.MouseSelector=Uf,e.NewDocumentNotification=Sa,e.NodeUtil=h,e.NumberingProperty=Zt,e.OperationFactory=ki,e.OperationUtil=Bi,e.OutlineClearSpanProps=Ct,e.Overlays=If,e.PageBreakSpan=Ot,e.PageDecorators=mh,e.PageMouseNotification=Sf,e.PageNumChangedNotification=Ko,e.PageTouchNotification=_f,e.PanelNotification=Ns,e.ParaBreakSpan=Nt,e.ParaChangeNotification=dn,e.ParaProperty=gt,e.ParagraphDecorators=gh,e.ParagraphIterator=po,e.ParagraphNode=lp,e.ParentNode=Xs,e.PasteInterface=Nu,e.PhysicalBorder=Xa,e.PhysicalBoxEdge=Ja,e.PhysicalEdge=qa,e.PlaceholderChar=uo,e.PluginContainerFocusNotification=xf,e.PluginContainerProperty=jr,e.Position=rs,e.RWTableStream=ao,e.RWTextStream=To,e.RangeClass=_n,e.RangeFinder=Hf,e.RemoveTableColOperation=ia,e.RemoveTableRowOperation=oa,e.RenderFinishNotification=tf,e.RenderLayoutChange=nf,e.RenderLineOverlay=Jf,e.Renderer=Cd,e.ReportHelper=g,e.ScrollContainerHandler=Td,e.ScrollContainerManager=xd,e.ScrollHandler=_d,e.ScrollableResizeNotification=df,e.SearchDialogNotification=gf,e.SectBreakSpan=Lt,e.SectChangeNotification=fn,e.SectionIterator=so,e.SectionNode=gp,e.SectionProperty=lt,e.SelTableNotification=Qh,e.SelectionCellOverlayStyle=qf,e.SelectionChangeNotification=sf,e.SelectionEndNotification=pf,e.SelectionOverlay=$f,e.SelectionOverlayStyle=Yf,e.SelectionSwitch=Qf,e.ShowTableIconNotification=$h,e.SpanChangeNotification=gn,e.SpanIterator=lo,e.SpanProperty=Rt,e.SpecialSpanBase=It,e.SplitlineProperty=gr,e.State=wu,e.StoryBreakSpan=Et,e.StoryChangeNotification=hn,e.StoryIterator=Kn,e.StoryProperty=Vt,e.StyleDecorators=vh,e.StyleSheetEngine=So,e.TDPosType=Y,e.TableCellBreakSpan=Dt,e.TableCellCoords=Gn,e.TableCellIterator=oo,e.TableCellNode=cp,e.TableCellPropList=eo,e.TableCellProperty=an,e.TableCellStartSpan=Ft,e.TableDidScrollNotification=ef,e.TableEndBreakSpan=Kt,e.TableIterator=ro,e.TableNode=fp,e.TablePropList=Qn,e.TableProperty=qr,e.TableRowBreakCell=sn,e.TableRowBreakSpan=kt,e.TableRowColChangeNotification=Zh,e.TableRowIterator=no,e.TableRowNode=up,e.TableRowPropList=$n,e.TableRowProperty=$r,e.TableRowStartSpan=Mt,e.TableStartBreakSpan=At,e.TableStream=Xn,e.TabstopTextBox=cl,e.TextBox=nl,e.TextBreakerBox=il,e.TextDecorators=hh,e.TextFieldCharBox=sl,e.TextFrameNode=op,e.TextGroupNode=Zs,e.TextLineBox=Jp,e.TextNode=np,e.TextRunMeasureEngine=wl,e.TextRunMeasureImp=Md,e.TextSeparatorBox=al,e.TextSpan=wt,e.TextStream=pn,e.TextTablePlaceHolderCharBox=pl,e.TextWhitespaceBox=ol,e.TextframeDecorators=fh,e.TextframeProperty=Cr,e.ToolbarNotification=Ds,e.TouchNotification=Hs,e.TouchSelector=zf,e.ViewRange=kf,e.ViewRangePoint=Mf,e.ViewSelection=Lf,e.WRAP_CONTENT=-2,e.ZoomNotification=Tf,e.binarySearchEnd=function e(t,r,n,o,i){if(i[n].begin()>r||i[o].end()<t)return-1;if(o-n>1){var a=Math.floor((n+o)/2),s=i[a];return s.begin()>r?e(t,r,n,a,i):s.end()<r?e(t,r,a,o,i):a}return i[o].begin()<r?o:n},e.binarySearchStart=function e(t,r,n,o,i){if(i[n].begin()>r||i[o].end()<t)return-1;if(o-n>1){var a=Math.floor((n+o)/2),s=i[a];return s.begin()>t?e(t,r,n,a,i):s.end()<t?e(t,r,a,o,i):a}return i[n].end()>t?n:o},e.boxIdToNumber=ah,e.cellRangeEach=Hn,e.cellRangeUnion=Vn,e.clearCookie=function(){var e=document.cookie.match(new RegExp("([^ ;][^;]*)(?=(=[^;]*)(;|$))","gi"));for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(document.cookie=e[t]+"=;expires=Mon, 26 Jul 1997 05:00:00 GMT; path=/; ")},e.concatOrderArray=P,e.coreRangeToViewRange=Af,e.countCols=function(e){return Math.abs(e.to.col-e.from.col)+1},e.countRows=function(e){return Math.abs(e.to.row-e.from.row)+1},e.createDecorator=Ia,e.createDescriptor=function(e,t,r){return void 0===t&&(t=[]),void 0===r&&(r=!0),new ri(e,t,r)},e.createDocumentNode=function(e,t){if(!t||t.length<0)r.Logger.error("createDocumentNode|invalid ranges");else{var n=e.getTextStream().createStoryIterator(t[0]).getContentRange();if(!n.isEmpty()){var o=n.begin(),i=t.map((function(e){return e.begin()-o})),a=new yp(e,n,void 0,i);return a.setLimit(t),a}r.Logger.error("document range is empty!")}},e.createMainDocumentNode=mp,e.createRangeIterator=function(e){var t,r,n,o,i,a,s,p;return D(this,(function(l){switch(l.label){case 0:t=e.from,r=t.row,n=t.col,o=e.to,i=o.row,a=o.col,s=r,l.label=1;case 1:if(!(s<=i))return[3,6];p=n,l.label=2;case 2:return p<=a?[4,{row:s,col:p}]:[3,5];case 3:l.sent(),l.label=4;case 4:return p++,[3,2];case 5:return s++,[3,1];case 6:return[2]}}))},e.createSubDocumentNode=bp,e.createTextBox=ul,e.defaultDocEnv=qo,e.delCookie=function(e,t,r){document.cookie=e+"=; expires=Mon, 26 Jul 1997 05:00:00 GMT; path="+(r||"/")+"; "+(t?"domain="+t+";":"")},e.diffOrderArray=m,e.domRectFromNode=Nf,e.expandRangeData=function(e,t,r){var n=e.from,o=n.row,i=n.col,a=e.to,s=a.row,p=a.col,l=s-o+1,c=p-i+1,u=t.length,h=t[0].length;return u>=l&&h>=c?t:jn(e,(function(e,n){var a=(n-i)%h;return r(t[(e-o)%u][a])}))},e.extractOneParagraphChildNode=pp,e.extractOneSectionChildNode=dp,e.fetchRangeData=jn,e.fetchRangeNear=function(t,r,n,o){switch(r){case e.RangeNearType.Top:if(t.from.row>0)return(i=Un(t)).from.row=t.from.row-1,i.to.row=i.from.row,i;break;case e.RangeNearType.Left:if(t.from.col>0)return(i=Un(t)).from.col=t.from.col-1,i.to.col=i.from.col,i;break;case e.RangeNearType.Right:if(t.to.col<o-1)return(i=Un(t)).from.col=t.to.col+1,i.to.col=i.from.col,i;break;case e.RangeNearType.Bottom:var i;if(t.to.row<n-1)return(i=Un(t)).from.row=t.to.row+1,i.to.row=i.from.row,i}return null},e.fieldContextClone=ko,e.findPointTableCells=Of,e.findRootBox=Df,e.findSelectLineFirstBoxInTextframe=Gf,e.fixToValidCellRange=Jn,e.getCookie=O,e.getDisplayTypeForNodeType=zs,e.getFollowedViewRangePoint=function(e){var t=e.leafBox;if(0===e.charsOffset){var r=void 0;if(gs(t.parentBox)?r=t.prevSibling:t.parentBox&&t.parentBox.prevSibling&&(r=t.parentBox.prevSibling),r&&!os(r)&&(r=r.lastChild),r&&bs(r)){var o=new n.UString(r.text).graphemeCount();return new Mf(r,o,e.gcp)}}return e},e.getGCPRangeFromIndex=ph,e.getRangeRelation=Wn,e.getScrollerHeight=T,e.getScrollerWidth=x,e.getSiblingIterTypeForNodeType=Us,e.getUin=function(){var e=O("uin");return e?parseInt(e.substring(1,e.length),10):null},e.getXsrf=function(){return O("TOK")||""},e.hasLoginCookie=function(){return!!(O("uid")&&O("uid_key")||O("p_luin")&&O("p_lskey")||O("p_uin")&&O("p_skey"))},e.inject=Ra,e.isBackward=Ef,e.isBreakNode=Kf,e.isCellRangeJoin=function(t,r){return Wn(t,r)===e.RangeRelation.Join},e.isContainerBox=Ps,e.isContainerBoxLite=function(t){return t&&t.kind===e.BoxKind.ContainerLite},e.isContainerPageBox=ls,e.isDebugEnviroment=function(){return-1!==document.cookie.indexOf("dev_route_id")},e.isDocumentBox=ss,e.isDocumentBoxLite=function(t){return t&&t.kind===e.BoxKind.DocumentLite},e.isEmbedBox=ns,e.isEmptyBox=function(t){return!!t&&t.kind===e.BoxKind.Empty},e.isFooterStory=He,e.isHeaderStory=Ge,e.isInlineNodeType=Ws,e.isLayoutBox=as,e.isLayoutBoxLite=function(e){return e&&(Ts(e)||_s(e))},e.isLeafBox=os,e.isLeafBoxLite=Ts,e.isLeafNodeType=js,e.isLineBreaker=ho,e.isLogicPageBox=ps,e.isPageBreak=yo,e.isPageFooterBox=us,e.isPageHeaderBox=cs,e.isParagraphBox=ds,e.isParagraphBoxLite=function(t){return t&&t.kind===e.BoxKind.ParagraphLite},e.isParentBox=is,e.isParentBoxLite=_s,e.isRangeContainPoint=Yn,e.isSectionBox=hs,e.isSectionBoxLite=function(t){return t&&t.kind===e.BoxKind.SectionLite},e.isSectionBreak=go,e.isSeparator=fo,e.isSpecialChar=Bt,e.isTab=mo,e.isTableBox=vs,e.isTableCellBox=xs,e.isTableRowBox=function(t){return!!t&&t.kind===e.BoxKind.TableRow},e.isTableSeperateProp=function(e){return e instanceof At||e instanceof Kt||e instanceof Mt||e instanceof kt||e instanceof Ft},e.isTextBox=bs,e.isTextBoxLite=function(t){return t&&t.kind===e.BoxKind.TextLite},e.isTextFrameBox=ms,e.isTextLineBox=gs,e.isTextLineFragmentBox=ys,e.isTextPageBox=fs,e.mockTextMeasureImp=bu,e.number2PosType=q,e.rangeEqual=zn,e.setCookie=function(e,t,r,n,o){var i=new Date;i.setTime(i.getTime()+(o?36e5*o:2592e6)),document.cookie=e+"="+t+"; expires="+i.toUTCString()+"; path="+(n||"/")+"; "+(r?"domain="+r+";":"")},e.similarOrderArray=y,e}({},ReactDOM,meloUtils,Unitool,React);
//# sourceMappingURL=melo-core.js.map
