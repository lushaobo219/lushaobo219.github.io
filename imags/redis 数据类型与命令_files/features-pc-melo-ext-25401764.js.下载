(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{261:function(t,e,n){"use strict";n.r(e),function(t){n.d(e,"Caret",(function(){return le})),n.d(e,"ClipboardTools",(function(){return _})),n.d(e,"Document",(function(){return Yt})),n.d(e,"EditorLoader",(function(){return En})),n.d(e,"Field",(function(){return Ht})),n.d(e,"Fields",(function(){return Gt})),n.d(e,"Font",(function(){return nt})),n.d(e,"HiddenEditor",(function(){return pe})),n.d(e,"IPadExternalKeyboard",(function(){return ke})),n.d(e,"InlineShape",(function(){return dt})),n.d(e,"InlineShapes",(function(){return ft})),n.d(e,"KeyHelper",(function(){return Ke})),n.d(e,"KeyboardManager",(function(){return Ue})),n.d(e,"KeymapManager",(function(){return We})),n.d(e,"MAX_TABLE_COUNT",(function(){return Kt})),n.d(e,"Markdown",(function(){return qt})),n.d(e,"MobileCaretDrag",(function(){return ge})),n.d(e,"MobileSelectionDrag",(function(){return Me})),n.d(e,"MouseManager",(function(){return rn})),n.d(e,"Numbering",(function(){return Qt})),n.d(e,"Paragraph",(function(){return pt})),n.d(e,"ParagraphFormat",(function(){return lt})),n.d(e,"Paragraphs",(function(){return ct})),n.d(e,"Range",(function(){return jt})),n.d(e,"Section",(function(){return ut})),n.d(e,"SectionFormat",(function(){return ht})),n.d(e,"Sections",(function(){return gt})),n.d(e,"Selection",(function(){return Vt})),n.d(e,"Service",(function(){return $t})),n.d(e,"Span",(function(){return it})),n.d(e,"Spans",(function(){return ot})),n.d(e,"Surface",(function(){return an})),n.d(e,"Table",(function(){return Ut})),n.d(e,"TableCell",(function(){return St})),n.d(e,"TableCol",(function(){return bt})),n.d(e,"TableCols",(function(){return _t})),n.d(e,"TableRow",(function(){return vt})),n.d(e,"TableRows",(function(){return mt})),n.d(e,"Tables",(function(){return Wt})),n.d(e,"TextFrame",(function(){return Zt})),n.d(e,"TouchManager",(function(){return on})),n.d(e,"Translate",(function(){return zt})),n.d(e,"genParaProperty",(function(){return N})),n.d(e,"inheritParaStyles",(function(){return D})),n.d(e,"injectPaste",(function(){return V})),n.d(e,"injectService",(function(){return te})),n.d(e,"injectSurface",(function(){return sn})),n.d(e,"pasteParaProcessor",(function(){return B})),n.d(e,"validParaAttris",(function(){return O}));var r,i,o,a=n(0),s=n(2),l=n(10),p=n.n(l),c=n(1),h=n.n(c),u=n(11),g=n.n(u),d=(i=o={exports:{}},window,void(i.exports=function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){n.r(e),n.d(e,"OS_TYPE",(function(){return r})),n.d(e,"getOSType",(function(){return a})),n.d(e,"callNative",(function(){return l})),n.d(e,"freeCallback",(function(){return p})),n.d(e,"registMethod",(function(){return c})),n.d(e,"unregistMethod",(function(){return h})),n.d(e,"version",(function(){return u}));var r,i="__wmJSCallNativeTemp";!function(t){t.MAC="MAC",t.WIN="WIN",t.LINUX="LINUX",t.IOS="IOS",t.ANDROID="ANDROID",t.UNKNOW="UNKNOW"}(r||(r={}));var o={module:"",method:"",param:{},callback:"",callId:""},a=function(){var t=navigator.userAgent,e=navigator.platform,n=r.UNKNOW;return["Macintosh","MacIntel","MacPPC","Mac68K"].includes(e)?n=r.MAC:["iPhone","iPad","iPod"].includes(e)?n=r.IOS:["Win32","Win64","Windows","WinCE"].includes(e)?n=r.WIN:t.includes("Android")?n=r.ANDROID:n!==r.UNKNOW&&e.includes("Linux")&&(n=r.LINUX),n},s=function(){var t,e=window[i];if(e)return e;var n={callbacks:{},registers:(t={},t.BASIC_MODULE={},t),execCallback:function(t){void 0===t&&(t=""),console.log("Recive Callback From Native",t);var e=window[i];if(e){var n={};try{n=JSON.parse(t)}catch(t){console.error(t)}var r=n.callId;r?e.callbacks[r]?e.callbacks[r](n):console.error("Ignore If Callback With The CallId Has Deleted"):console.error("Ignore If Response Has No CallId")}},sendMessage:function(t){void 0===t&&(t=""),console.log("Recive Message From Native",t);var e={module:"BASIC_MODULE",method:""};try{var n=JSON.parse(t);e=Object.assign(e,n)}catch(t){console.error(t)}var r=e.module,o=e.method,a=e.param;if(o){var s=window[i];if(s){s.registers[r]||(s.registers[r]={});var l=s.registers[r];l[o]||(l[o]=[]),l[o].forEach((function(t){if("function"==typeof t)try{t(a)}catch(t){console.error("Register Method "+o+" Execute Failed",t)}}))}}else console.error("method Not Correct")}};return window[i]=n,n},l=function(t,e,n,l){var p=window[i];p||(p=s());var c=p.callbacks,h="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})),u=l;return u="function"!=typeof u?function(){delete c[h]}:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];l.apply(void 0,t),delete c[h]},c[h]=u,function(t,e){switch(void 0===e&&(e=o),console.log(t,JSON.stringify(e)),a()){case r.MAC:case r.IOS:var n=window.webkit&&window.webkit.messageHandlers;(i=n&&n[t])&&i.postMessage?i.postMessage(JSON.stringify(e)):console.warn("Not A WeMeet Webview");break;case r.WIN:var i=window.external&&window.external.nativeCall,s=e.module,l=e.method,p=e.param,c=e.callback,h=e.callId;i?i(t,[s,l,p,c,h],(function(){})):console.warn("Not A WeMeet Webview");break;case r.ANDROID:case r.LINUX:window.JSCallJavaMgr&&window.JSCallJavaMgr[t]?window.JSCallJavaMgr[t](JSON.stringify(e)):console.warn("Not A WeMeet Webview");break;default:console.error("UNKNOW OS"),console.log("UA: "+navigator.userAgent+", Platform: "+navigator.platform)}}("JSCallNative",{callback:"window.__wmJSCallNativeTemp.execCallback",module:t,method:e,param:n,callId:h}),h},p=function(t){var e=window[i];e||(e=s());var n=e.callbacks;t&&n[t]&&delete n[t]},c=function(t,e,n){if(void 0===n&&(n="BASIC_MODULE"),t&&"function"==typeof e){var r=window[i];r||(r=s()),r.registers[n]||(r.registers[n]={});var o=r.registers[n];o[t]||(o[t]=[]),o[t].push(e)}else console.error("methodName And callback Not Correct")},h=function(t,e,n){if(void 0===n&&(n="BASIC_MODULE"),t&&"function"==typeof e){var r=window[i];r||(r=s()),r.registers[n]||(r.registers[n]={});var o=r.registers[n];o[t]||(o[t]=[]);var a=o[t].indexOf(e);a>-1&&o[t].splice(a,1)}else console.error("methodName And callback Not Correct")},u="1.1.5",g={version:u,registMethod:c,unregistMethod:h,callNative:l,freeCallback:p};e.default=g}])),o.exports),f=(r=d)&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r;function y(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}function T(t,e){return function(n,r){e(n,r,t)}}function m(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function S(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}d.WeMeetJSBridge;var v=[a.PlaceholderChar.StoryBegin,a.PlaceholderChar.StoryEnd,a.PlaceholderChar.TableStart,a.PlaceholderChar.TableEnd,a.PlaceholderChar.TableRowStart,a.PlaceholderChar.TableRowBreak,a.PlaceholderChar.TableCellStart,a.PlaceholderChar.TableCellBreak,a.PlaceholderChar.PageBreak],b=new RegExp(v.join("|"),"g"),_=function(){function t(){}return t.getPasteDstType=function(t){return t.tableCellRange()?a.PasteDstType.Table:t.tableCellRangeAll()?a.PasteDstType.Cell:t.storyType()!==a.TDStoryType.MainTextStory?t.storyType()===a.TDStoryType.CodeblockStory?a.PasteDstType.Codeblock:t.storyType()===a.TDStoryType.PrimaryHeaderStory||t.storyType()===a.TDStoryType.PrimaryFooterStory?a.PasteDstType.HeaderFooter:a.PasteDstType.SubStory:a.PasteDstType.Doc},t.getNodeType=function(t){if(t instanceof HTMLElement){if(this.isSingleTable(t))return a.PasteSrcType.Table;if(t.querySelector("table"))return a.PasteSrcType.Mix}return a.PasteSrcType.Text},t.isSingleTable=function(t){for(var e=t;e;){if(null!==e.nextSibling)return!1;if(e instanceof HTMLTableElement)return!0;e=e.childNodes[0]}return!1},t.pastePlainText=function(t,e,n){if(0!==n.length){var r=e.delta();r.msg="pastePlainText";var i=t.getSelection(),o=i.tableCellRange();if(o){var l=i.getTable();if(!l)throw new Error("pastePlainText table is invalid");var p=l.getCell(o.cellRange.from.row,o.cellRange.from.col);if(!p||!p.range)return void s.Logger.error("pastePlainText table is invalid");e.deleteText(new a.GCPRange(p.range.begin()+1,p.range.length()-2),r),r.moveTo(new a.GCPRange(p.range.begin()+1,0))}else e.deleteText(e.selection.validDeleteRange(),r);var c=n.replace(b,"");if(0!==c.length){for(var h=new RegExp(a.PlaceholderChar.ParagraphBreak+"|"+a.PlaceholderChar.ParagraphReturn,"g"),u=c.split(h),g=0;g<u.length-1;g++)r.insertText(r.currentRange().begin(),u[g],new a.TextSpan),r.insertParagraph(r.currentRange().begin(),new a.ParaBreakSpan,new a.ParaProperty);u[u.length-1]&&r.insertText(r.currentRange().begin(),u[u.length-1],new a.TextSpan),e.applyDelta(r)}}},t.getPasteTargetStyle=function(t){var e,n=t.getSelection().range(),r=t.getSelection().getParaRange(n.gcpBegin);return e=r&&r.gcpBegin!==n.gcpBegin?new a.GCPRange(n.gcpBegin-1,0):new a.GCPRange(n.gcpBegin,0),{paraStyle:S(t.getDocument().getParaStyleAtRange(e),1)[0],spanStyle:S(t.getDocument().getTextStyleAtRange(e),1)[0]}},t}(),P=function(){function t(t,e,n,r){this.context=t,this.state=e,this.service=n,this.customClipboard=r}return t.prototype.attach=function(){},t.prototype.detach=function(){},t.prototype.paste=function(){var t=this.customClipboard.getData();_.pastePlainText(this.service,this.state,t),this.context.fire(new a.ClipboardNotification(a.ClipboardNotificationType.ON_PASTE))},y([T(0,a.IEditor),T(1,a.IState),T(2,a.IService),T(3,a.ICustomClipboard),m("design:paramtypes",[Object,a.State,Object,a.CustomClipboard])],t)}(),R=function(){function t(t,e,n,r){this.context=t,this.state=e,this.service=n,this.customClipboard=r}return t.prototype.attach=function(){},t.prototype.detach=function(){},t.prototype.paste=function(){var t=this,e=window.mqq;if(e&&"0"!==e.clientVersion)e.invoke("docx","readSystemClipboard",{},(function(e,n){if(n){n.html;var r=n.plain,i=void 0===r?"":r;_.pastePlainText(t.service,t.state,i)}else{var o=t.customClipboard.getData();_.pastePlainText(t.service,t.state,o)}}));else{var n=this.customClipboard.getData();_.pastePlainText(this.service,this.state,n)}this.context.fire(new a.ClipboardNotification(a.ClipboardNotificationType.ON_PASTE))},y([T(0,a.IEditor),T(1,a.IState),T(2,a.IService),T(3,a.ICustomClipboard),m("design:paramtypes",[Object,a.State,Object,a.CustomClipboard])],t)}(),C=function(){function t(t,e,n,r){this.context=t,this.state=e,this.service=n,this.customClipboard=r}return t.prototype.attach=function(){},t.prototype.detach=function(){},t.prototype.paste=function(){var t=this,e=window.WeDocs;(null==e?void 0:e.getClipboard)&&e.getClipboard((function(e){if(e)_.pastePlainText(t.service,t.state,e);else{var n=t.customClipboard.getData();_.pastePlainText(t.service,t.state,n)}})),this.context.fire(new a.ClipboardNotification(a.ClipboardNotificationType.ON_PASTE))},y([T(0,a.IEditor),T(1,a.IState),T(2,a.IService),T(3,a.ICustomClipboard),m("design:paramtypes",[Object,a.State,Object,a.CustomClipboard])],t)}(),I=["font-size","mso-bidi-font-size","letter-spacing","mso-fareast-font-family","mso-bidi-font-family","mso-hansi-font-family","mso-ascii-font-family","font-family","color","bold","italic","underline","strikethrough","link","background","mso-highlight","background-color","font-style","font-weight","text-decoration","text-decoration-line"],A=[a.PlaceholderChar.StoryBegin,a.PlaceholderChar.StoryEnd,a.PlaceholderChar.TableStart,a.PlaceholderChar.TableEnd,a.PlaceholderChar.TableRowStart,a.PlaceholderChar.TableRowBreak,a.PlaceholderChar.TableCellStart,a.PlaceholderChar.TableCellBreak],w=["font-family","mso-fareast-font-family","mso-bidi-font-family","mso-hansi-font-family","mso-ascii-font-family"],E=new RegExp(A.join("|"),"g"),x=function(t,e,n,r,i,o){if(!a.NodeUtil.isTextNode(t))return!1;if(!function(t,e){return!t.parentNode||"p"===t.parentNode.nodeName.toLowerCase()||"span"===t.parentNode.nodeName.toLowerCase()||!e.isPasteFromMsoTable||"  "!==t.textContent}(t,i))return!1;e=function(t,e){for(var n=0;n<e.length;n++)if(t.has(e[n])&&t.get(e[n])){var r=t.get(e[n]);t.set("font-family",r);break}return t}(e,w);var l=a.NodeUtil.getValue(t);if(l){var p=new a.TextSpan;!function(t,e){e.has("font-size")&&e.get("font-size")&&(t.fontSize=Object(s.ptToTwips)(Object(s.fontSizeToPt)(e.get("font-size")))),e.has("mso-bidi-font-size")&&e.get("mso-bidi-font-size")&&(t.fontSize=Object(s.ptToTwips)(Object(s.fontSizeToPt)(e.get("mso-bidi-font-size")))),e.has("font-family")&&e.get("font-family")&&(t.fontFamily=e.get("font-family")),e.has("color")&&e.get("color")&&(t.textColor=e.get("color")),e.has("italic")&&e.get("italic")&&(t.italic="true"===e.get("italic")),e.has("underline")&&e.get("underline")&&(t.underline="true"===e.get("underline"))}(p,e),e.forEach((function(t,e){if(e&&t)switch(s.StringUtil.trim(e)){case"letter-spacing":p.letterSpacing=Object(s.ptToTwips)(Object(s.dimensionSizeToPt)(t,0));break;case"bold":p.fontWeight="true"===t?a.FontWeightType.bold:a.FontWeightType.normal;break;case"font-weight":p.fontWeight="bold"===t||"700"===t?a.FontWeightType.bold:a.FontWeightType.normal;break;case"strikethrough":p.strike="true"===t;break;case"text-decoration":case"text-decoration-line":!function(t,e){t&&(-1!==t.indexOf("underline")&&(e.underline=!0),-1!==t.indexOf("line-through")&&(e.strike=!0))}(t,p);break;case"link":p.link=t;break;case"background":case"mso-highlight":case"background-color":p.textBackground=t;break;case"font-style":p.italic||(p.italic="italic"===t);break;case"superscript":p.superScript="true"===t;case"subscript":p.subScript="true"===t}})),l=l.replace(E,""),i.isInTable&&(l=l.replace(new RegExp(""+a.PlaceholderChar.PageBreak,"g"),""));for(var c=new RegExp(a.PlaceholderChar.ParagraphBreak+"|"+a.PlaceholderChar.SectionBreak+"|"+a.PlaceholderChar.ParagraphReturn,"g"),h=l.split(c),u=0;u<h.length-1;u++)n.insertText(n.currentRange().end(),h[u],p),n.insertParagraph(n.currentRange().end(),new a.ParaBreakSpan,new a.ParaProperty);h[h.length-1]&&n.insertText(n.currentRange().end(),h[h.length-1],p)}return!0},O=["text-align","line-height","font-family"];function L(t){var e=/.*(solid|dotted|dashed|double|wave).*?(\d*)(\.\d+)?pt/.exec(t),n=new a.SplitlineProperty;if(e){var r={solid:"normal",dashed:"dashed",dotted:"dotted",double:"normal",wave:"shading-v"}[e[1]]||"normal";if("normal"===r&&e[2]){var i=[12,8,3,2,1].filter((function(t){return parseInt(e[2],10)>=Object(s.ptToPx)(t)}))[0];i>1&&(r="normal-bold-"+i)}n.type=r,n.fillColor="#000000"}return n}function D(t,e,n){return n.forEach((function(n){var r=t.get(n),i=e.get(n);!r&&i&&t.set(n,i)})),t}function N(t,e){var n=new a.ParaProperty;if(e){var r=e.match(/pap-line-rule-auto/);if(r&&r.length>0){var i=e.match(/pap-line-(([1-9]\d*\.?\d*)|(0\.\d*[1-9]))/);i&&i.length>=2&&!isNaN(Number(i[1]))&&(n.lineSpacing=Number(i[1]),n.lineSpacingRule=a.LineSpacingType.Multiple)}else{var o=e.match(/pap-line-rule-exact/);if(o&&o.length>0){var l=e.match(/pap-line-(([1-9]\d*\.?\d*)|(0\.\d*[1-9]))pt/);l&&l.length>=2&&!isNaN(Number(l[1]))&&(n.lineSpacing=Object(s.ptToTwips)(Number(l[1])),n.lineSpacingRule=a.LineSpacingType.Exactly)}}!function(t,e){var n=t.match(/pap-spacing-before-(([1-9]\d*\.?\d*)|(0\.\d*[1-9]))pt/);n&&n.length>=2&&!isNaN(Number(n[1]))&&(e.spaceBefore=Object(s.ptToTwips)(Number(n[1])));var r=t.match(/pap-spacing-after-(([1-9]\d*\.?\d*)|(0\.\d*[1-9]))pt/);r&&r.length>=2&&!isNaN(Number(r[1]))&&(e.spaceAfter=Object(s.ptToTwips)(Number(r[1])))}(e,n),function(t,e){var n=t.match(/pap-left-indent-(([1-9]\d*\.?\d*)|(0\.\d*[1-9]))em/);n&&n.length>=2&&!isNaN(Number(n[1]))&&(e.characterUnitLeftIndent=Number(n[1]));var r=t.match(/pap-left-indent-(([1-9]\d*\.?\d*)|(0\.\d*[1-9]))pt/);r&&r.length>=2&&!isNaN(Number(r[1]))&&(e.leftIndent=Object(s.ptToTwips)(Number(r[1])));var i=t.match(/pap-right-indent-(([1-9]\d*\.?\d*)|(0\.\d*[1-9]))em/);i&&i.length>=2&&!isNaN(Number(i[1]))&&(e.characterUnitRightIndent=Number(i[1]));var o=t.match(/pap-right-indent-(([1-9]\d*\.?\d*)|(0\.\d*[1-9]))pt/);o&&o.length>=2&&!isNaN(Number(o[1]))&&(e.rightIndent=Object(s.ptToTwips)(Number(o[1])))}(e,n),function(t,e){var n=t.match(/pap-firstline-indent-(([1-9]\d*\.?\d*)|(0\.\d*[1-9]))em/);n&&n.length>=2&&!isNaN(Number(n[1]))&&(e.characterUnitSpecialIndent=Number(n[1]));var r=t.match(/pap-firstline-indent-(([1-9]\d*\.?\d*)|(0\.\d*[1-9]))pt/);r&&r.length>=2&&!isNaN(Number(r[1]))&&(e.specialIndent=Object(s.ptToTwips)(Number(r[1])))}(e,n);var p=e.match(/pap-hanging-indent-(([1-9]\d*\.?\d*)|(0\.\d*[1-9]))em/);p&&p.length>=2&&!isNaN(Number(p[1]))&&(n.characterUnitSpecialIndent=-1*Number(p[1]));var c=e.match(/pap-hanging-indent-(([1-9]\d*\.?\d*)|(0\.\d*[1-9]))pt/);c&&c.length>=2&&!isNaN(Number(c[1]))&&(n.specialIndent=-1*Object(s.ptToTwips)(Number(c[1])))}return function(t,e){if(t.has("text-align")&&t.get("text-align")){var n=t.get("text-align");"left"===n?e.textAlignment=a.TextAlignmentType.Left:"center"===n?e.textAlignment=a.TextAlignmentType.Center:"right"===n?e.textAlignment=a.TextAlignmentType.Right:"justify"===n&&(e.textAlignment=a.TextAlignmentType.Justify)}}(t,n),function(t,e){if(t.has("mso-line-height-rule")&&"exactly"===t.get("mso-line-height-rule")&&(e.lineSpacingRule=a.LineSpacingType.Exactly),t.has("line-height")&&t.get("line-height"))if(!1===isNaN(Number(t.get("line-height"))))e.lineSpacingRule=a.LineSpacingType.Multiple,e.lineSpacing=Number(t.get("line-height"));else if(t.get("line-height").indexOf("%")>0)e.lineSpacingRule=a.LineSpacingType.Multiple,e.lineSpacing=Number(t.get("line-height").replace("%",""))/100;else if(e.lineSpacingRule===a.LineSpacingType.Exactly)e.lineSpacing=Object(s.ptToTwips)(Object(s.dimensionSizeToPt)(t.get("line-height"),16));else if(s.PlatformUtil.isSafari()){var n=1e4*Number(t.get("line-height").replace("px",""))/16/1e4;n?(e.lineSpacingRule=a.LineSpacingType.Multiple,e.lineSpacing=n):(e.lineSpacingRule=a.LineSpacingType.Multiple,e.lineSpacing=1.3)}else e.lineSpacingRule=a.LineSpacingType.Multiple,e.lineSpacing=1.3}(t,n),function(t,e){t.has("layout-grid-mode")&&"char"===t.get("layout-grid-mode")?e.disableLineHeightGrid=!0:e.disableLineHeightGrid=a.Defaults.paragraph.disableLineHeightGrid,t.has("mso-para-margin-left")&&t.get("mso-para-margin-left")&&t.get("mso-para-margin-left").indexOf("gd")>0&&(e.characterUnitLeftIndent=Number(t.get("mso-para-margin-left").replace("gd",""))),t.has("mso-para-margin-right")&&t.get("mso-para-margin-right")&&t.get("mso-para-margin-right").indexOf("gd")>0&&(e.characterUnitRightIndent=Number(t.get("mso-para-margin-right").replace("gd",""))),t.has("margin-left")&&t.get("margin-left")&&(e.leftIndent=Object(s.ptToTwips)(Object(s.dimensionSizeToPt)(t.get("margin-left"),0))),t.has("margin-right")&&t.get("margin-right")&&(e.rightIndent=Object(s.ptToTwips)(Object(s.dimensionSizeToPt)(t.get("margin-right"),0))),function(t,e){t.has("mso-char-indent-count")&&t.get("mso-char-indent-count")&&(e.characterUnitSpecialIndent=Number(t.get("mso-char-indent-count"))),t.has("text-indent")&&t.get("text-indent")&&(e.specialIndent=Object(s.ptToTwips)(Object(s.dimensionSizeToPt)(t.get("text-indent"),0)))}(t,e)}(t,n),function(t,e){t.has("mso-para-margin-top")&&t.get("mso-para-margin-top")&&(e.spaceBefore=Object(s.ptToTwips)(Object(s.linesToPoints)(Number(t.get("mso-para-margin-top").replace("gd",""))))),t.has("mso-para-margin-bottom")&&t.get("mso-para-margin-bottom")&&(e.spaceAfter=Object(s.ptToTwips)(Object(s.linesToPoints)(Number(t.get("mso-para-margin-bottom").replace("gd",""))))),t.has("margin-top")&&t.get("margin-top")&&(e.spaceBefore=Object(s.ptToTwips)(Object(s.dimensionSizeToPt)(t.get("margin-top"),0))),t.has("margin-bottom")&&t.get("margin-bottom")&&(e.spaceAfter=Object(s.ptToTwips)(Object(s.dimensionSizeToPt)(t.get("margin-bottom"),0)))}(t,n),function(t,e){var n,r,i;if(s.PlatformUtil.isSafari()){if(t.has("margin")&&t.get("margin")){var o=t.get("margin").split(" "),a=S([0,0,0,0],4),l=a[0],p=a[1],c=a[2],h=a[3];2===o.length?(l=(n=S([0,1,0,1],4))[0],p=n[1],c=n[2],h=n[3]):3===o.length?(l=(r=S([0,1,2,1],4))[0],p=r[1],c=r[2],h=r[3]):4===o.length&&(l=(i=S([0,1,2,3],4))[0],p=i[1],c=i[2],h=i[3]),e.spaceBefore=Object(s.ptToTwips)(Object(s.dimensionSizeToPt)(o[l],0)),e.rightIndent=Object(s.ptToTwips)(Object(s.dimensionSizeToPt)(o[p],0)),e.spaceAfter=Object(s.ptToTwips)(Object(s.dimensionSizeToPt)(o[c],0)),e.leftIndent=Object(s.ptToTwips)(Object(s.dimensionSizeToPt)(o[h],0))}t.has("text-indent")&&t.get("text-indent")&&(e.specialIndent=Object(s.ptToTwips)(Object(s.dimensionSizeToPt)(t.get("text-indent"),0)))}}(t,n),n}var B=function(t,e,n,r,i,o){var s=a.NodeUtil.getTagName(t).toLowerCase();if("p"!==s&&"div"!==s)return!1;var l=!0;(null==t?void 0:t.lastChild)&&(l=function(t){return"p"!==t&&"div"!==t&&"ol"!==t&&"ul"!==t&&"table"!==t}(a.NodeUtil.getTagName(t.lastChild).toLowerCase()));var p=a.NodeUtil.getProp(t,"className"),c=D(a.NodeUtil.getStyleMap(t),e,i.validParaAttris),h=N(c,p),u=function(t,e){if(!t)return null;var n=null;if(/MsoNormal/.exec(t)&&e&&e.has("mso-outline-level"))n="heading"+e.get("mso-outline-level");else if(/MsoTitle/.exec(t))n=a.BuiltinStyleName.Title;else if(/MsoSubtitle/.exec(t))n=a.BuiltinStyleName.Subtitle;else if(/MsoHeading7/.exec(t))n=a.BuiltinStyleName.Heading7;else if(/MsoHeading8/.exec(t))n=a.BuiltinStyleName.Heading8;else if(/MsoHeading9/.exec(t))n=a.BuiltinStyleName.Heading9;else{var r=/pap-stylesheet-name-(\w+) /.exec(t);r&&r.length>1&&r[1]&&(n=r[1])}return n}(p,c);u&&(h.styleName=u);var g,d,f=0;return c.has("mso-border-top-alt")&&"div"===s&&(g=L(c.get("mso-border-top-alt")),f+=1,l=!1),c.has("mso-border-bottom-alt")&&"div"===s&&(d=L(c.get("mso-border-bottom-alt")),f+=2,l=!1),1&f&&n.insertSplitline(n.currentRange().end(),g),o(t,e,n,r,i),"melo-hidden-editor"!==a.NodeUtil.getProp(t,"id")&&"inline-block"!==c.get("display")&&"inline"!==c.get("display")&&l&&t instanceof HTMLElement&&t.innerText.replace(""+a.PlaceholderChar.ParagraphBreak,"")&&n.insertParagraph(n.currentRange().end(),new a.ParaBreakSpan,h),2&f&&n.insertSplitline(n.currentRange().end(),d),!0},M=function(t,e,n,r,i,o){if("br"!==a.NodeUtil.getTagName(t).toLowerCase())return!1;o(t,e,n,r,i);var s=N(e);return n.insertParagraph(n.currentRange().end(),new a.ParaBreakSpan,s),!0},F=function(t,e,n,r,i,o){return"span"===a.NodeUtil.getTagName(t).toLowerCase()&&(o(t,e,n,r,i),!0)},k=function(){function t(t,e,n){this.pasteNodeProcessors=[],this.context=t,this.state=e,this.service=n,this.initBasicPasteNodeProcessor()}return t.prototype.addPasteNodeProcessor=function(t,e){void 0===e&&(e=a.PasteNodeProcessorPriority.normal);for(var n=!1,r={processor:t,priority:e},i=0;i<this.pasteNodeProcessors.length;++i)if(this.pasteNodeProcessors[i].priority<e){this.pasteNodeProcessors.splice(i,0,r),n=!0;break}n||this.pasteNodeProcessors.push(r)},t.prototype.initBasicPasteNodeProcessor=function(){this.addPasteNodeProcessor(x),this.addPasteNodeProcessor(F),this.addPasteNodeProcessor(B),this.addPasteNodeProcessor(M)},t.prototype.doPaste=function(t,e){void 0===e&&(e=!1);var n=_.getNodeType(t),r={dstType:_.getPasteDstType(this.service.getSelection()),srcType:n,validTextAttris:I,validParaAttris:O},i=this.state.selection.validDeleteRange(),o=a.DeltaOption.createLocalDeltaOption(i).buildDelta(),l=new Map;if(e){var p=this.state.followSpanProp(o.currentRange().begin());if(p){var c=a.CssUtil.computeTextSpanFullStyles(p).cssProperties;c&&Object.keys(c).forEach((function(t){a.CssUtil.isDefaultCss(t,c[t])||l.set(s.StringUtil.camelToChain(t),c[t])}))}}return this.processPasteNode(t,l,o,this.service,r),o},t.prototype.processPasteNode=function(t,e,n,r,i){if(t){a.NodeUtil.getStyleMap(t).forEach((function(t,n){e.set(n,t)}));for(var o=!1,s=0;s<this.pasteNodeProcessors.length&&!(o=this.pasteNodeProcessors[s].processor(t,e,n,r,i,this.processPasteChildNode.bind(this)));s++);o||function(t,e,n,r,i,o){var s=a.NodeUtil.getTagName(t).toLowerCase();s&&"style"!==s&&"img"!==s&&"table"!==s&&"meta"!==s&&"title"!==s&&o(t,e,n,r,i)}(t,e,n,r,i,this.processPasteChildNode.bind(this))}},t.prototype.processPasteChildNode=function(t,e,n,r,i){for(var o=0;o<a.NodeUtil.getChildNodeNum(t);o++){var s=a.NodeUtil.getChildNode(t,o);if(s){if(a.NodeUtil.isTextNode(s)&&(s.nodeValue=s.nodeValue?s.nodeValue.replace(/\n/g,""):""),"O:P"===s.nodeName)continue;this.processPasteNode(s,new Map(e),n,r,i)}}return!0},t}(),U=function(t,e){var n=e.getSelection().validDeleteRange();if(a.OperationUtil.isStartTable(t.operations)){var r={range:new a.GCPRange(n.end(),1),text:a.PlaceholderChar.ParagraphBreak,spanProperty:new a.ParaBreakSpan,paraProperty:(new a.ParaProperty).genNewParaId()},i=a.OperationFactory.getOp(a.OperationType.InsertParagraph,r);i&&t.insertOperation(i,0)}var o=a.OperationFactory.getOp(a.OperationType.DeleteText,{range:n});return o&&t.insertOperation(o,0),t},K=function(){function t(t,e,n){this.dstProcessors=new Map,this.deltaProcessors=[],this.context=t,this.state=e,this.service=n,this.initBasicProcessor()}return t.prototype.initBasicProcessor=function(){this.addPasteDstProcessor(a.PasteDstType.Doc,U)},t.prototype.addPasteDstProcessor=function(t,e){this.dstProcessors.set(t,e)},t.prototype.addPasteDeltaProcessor=function(t){this.deltaProcessors.push(t)},t.prototype.doProcessPaste=function(t,e){var n=this.doProcessDst(t);if(n){if(n=this.doProcessDelta(n,e))return n.msg="action paste",this.state.applyDelta(n),n;s.Logger.info("doProcessPaste delta is null")}else s.Logger.info("doProcessPaste delta is null")},t.prototype.doProcessDst=function(t){var e=_.getPasteDstType(this.service.getSelection()),n=this.dstProcessors.get(e);return n?n(t,this.service):null},t.prototype.doProcessDelta=function(t,e){for(var n=t,r=0;r<this.deltaProcessors.length;r++)if(!(n=this.deltaProcessors[r](n,this.service,e)))return null;return n},t}(),W=function(){function t(t,e){this.context=t,this.state=e}return t.prototype.doPaste=function(t){var e=this,n=JSON.parse(t);if(n){var r=this.state.selection.validDeleteRange(),i=a.DeltaOption.createLocalDeltaOption(r).buildDelta(),o=!0,s=n.storyAtexts,l=this.state.getRWTextStream().createStoryIterator().getLastStoryEndPos();i.moveTo(new a.GCPRange(l,0)),s.forEach((function(t){o=e.state.context.run("transAtextDataToDelta",i,t.atext)&&o})),i.moveTo(r);var p=n.mainAtext;o=this.state.context.run("transAtextDataToDelta",i,p);var c=!1,h=this.context.docEnv.uniqueId,u=n.srcGlobalPadId;return h&&(c=u!==h),0===i.operations.length?{success:!1,delta:null,isFromOtherPad:c}:{success:!0,delta:i,isFromOtherPad:c}}return{success:!1,delta:null,isFromOtherPad:!1}},t}(),H=function(){function t(t,e,n,r){this.attached=!1,this.context=t,this.state=e,this.service=n,this.customClipboard=r,this.pasteProcessorManager=new k(t,e,n),this.pasteInternal=new W(t,e),this.pasteDataProcessor=new K(t,e,n),this.onPasteByEventListener=this.onPasteByEvent.bind(this)}return t.prototype.attach=function(){if(this.attached)s.Logger.warn("paste has attached");else{var t=this.context.view.getDom();t?(t.addEventListener("paste",this.onPasteByEventListener),this.attached=!0):s.Logger.error("PasteByWeb attach surfaceDom is null")}},t.prototype.detach=function(){var t=this.context.view.getDom();t?t.removeEventListener("paste",this.onPasteByEventListener):s.Logger.error("PasteByWeb detach surfaceDom is null"),this.attached=!1},t.prototype.paste=function(){if(this.context.isEditable()){var t=this.customClipboard.getData();if(t){var e=this.pasteInternal.doPaste(t),n=e.success,r=e.delta,i=e.isFromOtherPad;n&&r&&this.pasteDataProcessor.doProcessPaste(r,{isFromOtherPad:i,isFromInternal:!0})}this.context.fire(new a.ClipboardNotification(a.ClipboardNotificationType.ON_PASTE))}},t.prototype.onPasteByEvent=function(t){if(this.context.isEditable()&&this.context.surface.isFocusing()&&!this.hasBlob(t)){var e,n=!1;if(s.PlatformUtil.isIE()?e=window.clipboardData:t&&(e=t.clipboardData),e){var r,i,o,l,p,c=this.service.getSelection(),h=_.getPasteDstType(c),u=_.getPasteTargetStyle(this.service);s.PlatformUtil.isIE()?o=e.getData("Text"):s.PlatformUtil.isTencentDocsPC()?(o=e.getData("text/plain"),l=external.getClipboardData("text/html")):(o=e.getData("text/plain"),l=e.getData("text/html")),l?n=!1:o&&(n=!0);var g=null;try{if(n)(p=document.createElement("span")).innerText=o;else{var d=(new DOMParser).parseFromString(l,"text/html");p=d.body,g=this.transformHtml2Document(p,d.head)}var f=this.onPasteInternal(p);if(f.success&&f.delta)i={isFromOtherPad:f.isFromOtherPad,isFromInternal:!0},r=this.pasteDataProcessor.doProcessPaste(f.delta,i);else{var y=this.pasteProcessorManager.doPaste(p,n);i={isFromInternal:!1},r=this.pasteDataProcessor.doProcessPaste(y,i)}}catch(t){s.Logger.error("Html parse error: "+t),a.ReportHelper.captureException(a.MonitorName.HTML_PARSE_ERROR,{extra:{error:t}},t)}finally{g&&g.remove()}var T={isPlainText:n,pasteDelta:r,pasteDeltaExtraInfo:i,pasteDstType:h,pasteTargetStyle:u};this.context.fire(new a.ClipboardNotification(a.ClipboardNotificationType.ON_PASTE,T)),t.preventDefault()}}},t.prototype.hasBlob=function(t){var e=this,n=!1,r=_.getPasteDstType(this.service.getSelection());if(null==t?void 0:t.clipboardData){var i=t.clipboardData.items||t.clipboardData.files||[],o=i.length,l=!1;try{o>1&&t.clipboardData.types&&t.clipboardData.types.indexOf("text/rtf")>=0&&(l=!0)}catch(t){s.Logger.error("do paste on ie edge, "+t)}if(o>=1&&i[o-1].type.startsWith("image/")){var p=i[o-1].getAsFile&&i[o-1].getAsFile();(p=p||i[o-1].slice&&i[o-1].slice())&&!l&&(n=!0,this.context.run("insert_image",p,(function(){var t={hasBlob:!0,pasteDstType:r};e.context.fire(new a.ClipboardNotification(a.ClipboardNotificationType.ON_PASTE,t))})))}}return n},t.prototype.transformHtml2Document=function(t,e){var n=document.createElement("iframe");return n.name="pasteTemplate",n.style.position="absolute",n.style.top="99999px",n.style.left="99999px",document.body.appendChild(n),window.frames.pasteTemplate.document.body=t,(null==e?void 0:e.childNodes)&&e.childNodes.length>0&&Array.from(e.childNodes).forEach((function(t){window.frames.pasteTemplate.document.head.appendChild(t)})),n},t.prototype.onPasteInternal=function(t){var e=null,n=null,r=t.getElementsByTagName("melo-data");return(null==r?void 0:r[0])&&(e=a.NodeUtil.getAttr(r[0],"data-src"),n=a.NodeUtil.getAttr(r[0],"data-version")),e&&e.length>0&&n===a.DATA_VERSION?this.pasteInternal.doPaste(e):{success:!1,delta:null,isFromOtherPad:!1}},t.prototype.addPasteNodeProcessor=function(t,e){void 0===e&&(e=a.PasteNodeProcessorPriority.normal),this.pasteProcessorManager.addPasteNodeProcessor(t,e)},t.prototype.addPasteDstProcessor=function(t,e){this.pasteDataProcessor.addPasteDstProcessor(t,e)},t.prototype.addPasteDeltaProcessor=function(t){this.pasteDataProcessor.addPasteDeltaProcessor(t)},y([T(0,a.IEditor),T(1,a.IState),T(2,a.IService),T(3,a.ICustomClipboard),m("design:paramtypes",[Object,a.State,Object,a.CustomClipboard])],t)}(),G=function(){function t(t,e,n,r){this.attached=!1,this.context=t,this.state=e,this.service=n,this.customClipboard=r,this.getCopyDataFromServer(),this.visibilityState=document.visibilityState||"visible",this.onVisibilityChangeListener=this.onVisibilityChange.bind(this)}return t.prototype.attach=function(){this.attached||(document.addEventListener("visibilitychange",this.onVisibilityChangeListener),this.attached=!0)},t.prototype.detach=function(){document.removeEventListener("visibilitychange",this.onVisibilityChangeListener),this.attached=!1},t.prototype.paste=function(){var t=this.customClipboard.getData();_.pastePlainText(this.service,this.state,t),this.context.fire(new a.ClipboardNotification(a.ClipboardNotificationType.ON_PASTE))},t.prototype.onVisibilityChange=function(){var t=this,e=document.visibilityState;"hidden"===this.visibilityState&&"visible"===e&&(window.setTimeout((function(){t.getCopyDataFromServer()}),1500),window.setTimeout((function(){t.getCopyDataFromServer()}),3500)),this.visibilityState=e},t.prototype.getCopyDataFromServer=function(){var t=this;new Promise((function(t,e){p.a.ajax({url:"//docs.qq.com/sdc/datadown",type:"POST",xhrFields:{withCredentials:!0},data:{key:"weixin_copypaste_hack_key",xsrf:Object(a.getXsrf)()},success:function(e){t(e)},error:function(t){e(t)}})})).then((function(e){var n=e.retcode,r=e.result;0===n&&r&&"string"==typeof r.data?t.saveServerData(r.data):t.saveServerData("")})).catch((function(){t.saveServerData("")}))},t.prototype.saveServerData=function(t){var e="",n=/^(wxcp):\d{13}:/;if(t&&n.test(t)){var r=t.match(n),i=null==r?void 0:r[0];e=i&&t.split(i)[1]||""}this.customClipboard.setData(e)},y([T(0,a.IEditor),T(1,a.IState),T(2,a.IService),T(3,a.ICustomClipboard),m("design:paramtypes",[Object,a.State,Object,a.CustomClipboard])],t)}(),j=function(){function t(t,e,n,r){this.context=t,this.state=e,this.service=n,this.customClipboard=r}return t.prototype.attach=function(){},t.prototype.detach=function(){},t.prototype.paste=function(){var t=this;f.callNative("DocsWebViewPlugin","GetClipboard",void 0,(function(e){if(e.code&&1===e.code)s.Logger.log("PasteByWemeet|paste resp succ"),_.pastePlainText(t.service,t.state,e.data);else{s.Logger.log("PasteByWemeet|paste resp fail");var n=t.customClipboard.getData();_.pastePlainText(t.service,t.state,n)}})),this.context.fire(new a.ClipboardNotification(a.ClipboardNotificationType.ON_PASTE))},y([T(0,a.IEditor),T(1,a.IState),T(2,a.IService),T(3,a.ICustomClipboard),m("design:paramtypes",[Object,a.State,Object,a.CustomClipboard])],t)}(),V=function(t){var e,n=t.factory;e=s.PlatformUtil.isMobile()?s.PlatformUtil.isWXMiniProgram()||s.PlatformUtil.isQQMiniProgram()?G:s.PlatformUtil.isWeWork()?C:s.PlatformUtil.isTimQQ()||s.PlatformUtil.isTencentDocsApp()?R:s.PlatformUtil.isWeMeetApp()?j:P:H;var r=n.inject(a.PasteInterface,Object(a.createDescriptor)(e));r&&r.attach(),r instanceof H&&n.inject(a.IPasteProcessorManager,r)},Y=function(t,e){return(Y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function z(t,e){function n(){this.constructor=t}Y(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var J=function(){return(J=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function X(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function Q(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function q(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Z(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function $(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(Z(arguments[e]));return t}var tt=function(){function t(t,e){this._state=t,this._deltaOpt=e}return t.prototype.getRange=function(){return this._deltaOpt?this._deltaOpt.originRange.clone():new a.GCPRange},t.prototype._applyAttribute=function(t,e,n,r){if(void 0===n&&(n=a.TDSetPropMode.Merge),this._state&&this._deltaOpt){var i=r||this._deltaOpt.buildDelta(),o=i.globalOpts.originRange,l=this._state.getTextStream().findStoryInfoFromGcp(o.begin());if(l&&l.storyProp.storyType===a.StoryType.CodeblockStory)return;if(e===a.IterType.Span&&t instanceof a.SpanProperty&&i.globalOpts.updateSelection&&0===i.globalOpts.originRange.length()){if(this._state.isRangeBeginAtParaStart(i.globalOpts.originRange)&&this._state.listMarkerSpanProp)this._state.listMarkerSpanProp.merge(t),this._state.context.fire(new a.ListModelChangeNotification(this._state.listMarkerSpanProp),!1);else if(!r){var p=this._state.getTextStream().createParagraphIterator(i.globalOpts.originRange),c=p.getRange(),h=p.getProperty(!0);if(i.globalOpts.originRange.begin()===c.end()-1&&h&&!h.listId){c.gcpBegin=c.end()-1,c.len=1;var u=this._deltaOpt.buildDelta();u.globalOpts.originRange=c.clone(),u.moveTo(c),this._applyAttribute(t,a.IterType.Span,a.TDSetPropMode.Merge,u),c.len=0,u.moveTo(c),this._state.applyDelta(u)}this._state.cusorSpanProp=t}}else{switch(e){case a.IterType.Span:i.splitValidRange(this._state.getRWTextStream(),(function(e){i.setSpanProperty(e,t,n);var r=t;r.has(a.SpanPropKey.link)&&r.link!==s.LinkType.UserCancel&&i.clearSpanProperty(e,[a.SpanPropKey.textColor])}));break;case a.IterType.Paragraph:i.splitValidRange(this._state.getRWTextStream(),(function(e){i.setParagraphProperty(e,t,n)}));break;case a.IterType.Section:i.setSectionProperty(i.currentRange(),t,n)}r||this._state.applyDelta(i)}}},t.prototype._iterAttributeEx=function(t,e){var n=this,r=a.TDConstants.Undefined;if(!this._state||!this._deltaOpt)return r;if(t===a.IterType.Span&&this._deltaOpt.updateSelection&&0===this._deltaOpt.originRange.length()){if(this._state.isRangeBeginAtParaStart(this._deltaOpt.originRange)&&this._state.listMarkerSpanProp){var i=this._state.currentParaProp(this._deltaOpt.originRange.begin()),o=this._state.listMarkerSpanProp;return i&&o&&(o=this._state.dataEngine.getStyleSheetEngine().mergeStyleSpanProperty(o,i)),e(o)}var s=this._state.currentParaProp(this._deltaOpt.originRange.begin()),l=this._state.followSpanProp(this._deltaOpt.originRange.begin());return s&&l&&(l=this._state.dataEngine.getStyleSheetEngine().mergeStyleSpanProperty(l,s)),e(l)}var p=this._getPropClassType(t),c=this._state.dataEngine.getTextStream(),h=function(i){var o=c.createDataIterator(i),s=n._getProp(o,t);for(s&&s instanceof p&&(r=e(s));o.next(t);)if(!((s=n._getProp(o,t))&&s instanceof p&&r===e(s)))return r=a.TDConstants.Undefined,!1;return!0};return this._deltaOpt.originRange.equal(this._state.selection.gcpRange)?this._state.selection.gcpRanges.forEach(h):a.OperationUtil.splitCellRange(this._state.dataEngine.getRWTextStream(),this._deltaOpt.originRange,h),r},t.prototype._getProp=function(t,e){var n=null;if(!this._state)return n;switch(e){case a.IterType.Span:n=t.getSpanProp();var r=t.getParaProp();r&&n&&n instanceof a.SpanProperty&&(n=this._state.dataEngine.getStyleSheetEngine().mergeStyleSpanProperty(n,r));break;case a.IterType.Paragraph:(n=t.getParaProp())&&n instanceof a.ParaProperty&&(n=this._state.dataEngine.getStyleSheetEngine().mergeStyleParaProperty(n));break;case a.IterType.Section:n=t.getSectProp()}return n},t.prototype._getPropClassType=function(t){var e=a.SpanProperty;switch(t){case a.IterType.Span:e=a.SpanProperty;break;case a.IterType.Paragraph:e=a.ParaProperty;break;case a.IterType.Section:e=a.SectionProperty}return e},t}(),et=function(){function t(){}return t.getSpanIterator=function(t,e){var n=t.context.uuid,r=this.spanIterators.get(n);if(r){var i=e;i||(i=new a.GCPRange(0,t.getRWTextStream().getLength())),r.setLimitRange(i)}else r=t.dataEngine.getTextStream().createSpanIterator(e),this.spanIterators.set(n,r);return r},t.getParagraphIterator=function(t,e){var n=t.context.uuid,r=this.paraIterators.get(n);if(r){var i=e;i||(i=new a.GCPRange(0,t.getRWTextStream().getLength())),r.setLimitRange(i)}else r=t.dataEngine.getTextStream().createParagraphIterator(e),this.paraIterators.set(n,r);return r},t.getSectionIterator=function(t,e){var n=t.context.uuid,r=this.sectionIterators.get(n);if(r){var i=e;i||(i=new a.GCPRange(0,t.getRWTextStream().getLength())),r.setLimitRange(i)}else r=t.dataEngine.getTextStream().createSectionIterator(e),this.sectionIterators.set(n,r);return r},t.spanIterators=new Map,t.paraIterators=new Map,t.sectionIterators=new Map,t}(),nt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return z(e,t),e.createStateFont=function(t,n){return new e(t,n)},e.createEmptyFont=function(){return new e},e.prototype.getAttributes=function(){if(this._state&&this._deltaOpt){if(this._lastRange&&this._attribute&&this._lastRange.equal(this._deltaOpt.originRange))return this._attribute;var t=et.getSpanIterator(this._state,this._deltaOpt.originRange).getProperty(!0);this._lastRange=this._deltaOpt.originRange,this._attribute=t||new a.TextSpan}return this._attribute||(this._attribute=new a.TextSpan),this._attribute},e.prototype.setFont=function(t){this._state?this._applyAttribute(t.getAttributes(),a.IterType.Span):this.getAttributes().merge(t.getAttributes())},e.prototype.setBold=function(t){if(this._state){var e=new a.TextSpan;t===a.TDConstants.Toggle?e.fontWeight=!0!==this.isBold()?a.FontWeightType.bold:a.FontWeightType.normal:e.fontWeight=t?a.FontWeightType.bold:a.FontWeightType.normal,this._applyAttribute(e,a.IterType.Span)}else this.getAttributes().fontWeight=t?a.FontWeightType.bold:a.FontWeightType.normal},e.prototype.isBold=function(){if(this._state){var t=this._iterAttributeEx(a.IterType.Span,(function(t){return t.fontWeight}));return t===a.TDConstants.Undefined?a.TDConstants.Undefined:t===a.FontWeightType.bold}return this.getAttributes().fontWeight===a.FontWeightType.bold},e.prototype.setItalic=function(t){if(this._state){var e=new a.TextSpan;t===a.TDConstants.Toggle?e.italic=!0!==this.isItalic():e.italic=!!t,this._applyAttribute(e,a.IterType.Span)}else this.getAttributes().italic=!!t},e.prototype.isItalic=function(){return this._state?this._iterAttributeEx(a.IterType.Span,(function(t){return t.italic})):!!this.getAttributes().italic},e.prototype.setUnderline=function(t){if(this._state){var e=new a.TextSpan;t===a.TDConstants.Toggle?e.underline=!0!==this.isUnderline():e.underline=!!t,this._applyAttribute(e,a.IterType.Span)}else this.getAttributes().underline=!!t},e.prototype.isUnderline=function(){return this._state?this._iterAttributeEx(a.IterType.Span,(function(t){return t.underline})):!!this.getAttributes().underline},e.prototype.setStrike=function(t){if(this._state){var e=new a.TextSpan;t===a.TDConstants.Toggle?e.strike=!0!==this.isStrike():e.strike=!!t,this._applyAttribute(e,a.IterType.Span)}else this.getAttributes().strike=!!t},e.prototype.isStrike=function(){return this._state?this._iterAttributeEx(a.IterType.Span,(function(t){return t.strike})):!!this.getAttributes().strike},e.prototype.setFontSize=function(t){if(this._state){var e=new a.TextSpan;e.fontSize=t,this._applyAttribute(e,a.IterType.Span)}else this.getAttributes().fontSize=t},e.prototype.getFontSize=function(){return this._state?this._iterAttributeEx(a.IterType.Span,(function(t){return t.fontSize})):this.getAttributes().fontSize},e.prototype.setFontFamily=function(t){if(this._state){var e=new a.TextSpan;e.fontFamily=t,this._applyAttribute(e,a.IterType.Span)}else this.getAttributes().fontFamily=t},e.prototype.getFontFamily=function(){return this._state?this._iterAttributeEx(a.IterType.Span,(function(t){return t.fontFamily})):this.getAttributes().fontFamily},e.prototype.setTextColor=function(t){if(this._state){var e=new a.TextSpan;e.textColor=t,this._applyAttribute(e,a.IterType.Span)}else this.getAttributes().textColor=t},e.prototype.getTextColor=function(){return this._state?this._iterAttributeEx(a.IterType.Span,(function(t){return t.textColor})):this.getAttributes().textColor},e.prototype.setTextBackgroundColor=function(t){if(this._state){var e=new a.TextSpan;e.textBackground=t,this._applyAttribute(e,a.IterType.Span)}else this.getAttributes().textBackground=t},e.prototype.getTextBackgroundColor=function(){return this._state?this._iterAttributeEx(a.IterType.Span,(function(t){return t.textBackground})):this.getAttributes().textColor},e.prototype.setLink=function(t){if(this._state){var e=new a.TextSpan;e.link=t,this._applyAttribute(e,a.IterType.Span)}else this.getAttributes().link=t},e.prototype.getLink=function(){return this._state?this._iterAttributeEx(a.IterType.Span,(function(t){return t.link})):this.getAttributes().link},e.prototype.getComments=function(){if(this._state){var t=this.getRange();if(!t.isEmpty()){var e=et.getSpanIterator(this._state,t),n=e.getProperty(!0);if(n){for(var r=n.getPropBag(!0).get(a.CommentSpanPropKey.comments,"");e.next();)if(!(n=e.getProperty(!0))||n.getPropBag(!0).get(a.CommentSpanPropKey.comments,"")!==r){r=void 0;break}if(void 0!==r)return r.length>0?r.split(a.CommentSpanPropKey.commentsConnection):[]}}return a.TDConstants.Undefined}return this.getAttributes().comments},e.prototype.setComments=function(t){if(this._state){var e=new a.TextSpan;e.comments=t,this._applyAttribute(e,a.IterType.Span)}else this.getAttributes().comments=t},e.prototype.setLetterSpacing=function(t){if(this._state){var e=new a.TextSpan;e.letterSpacing=t,this._applyAttribute(e,a.IterType.Span)}else this.getAttributes().letterSpacing=t},e.prototype.getLetterSpacing=function(){return this._state?this._iterAttributeEx(a.IterType.Span,(function(t){return t.letterSpacing})):this.getAttributes().letterSpacing},e.prototype.setSuperScript=function(t){if(this._state){var e=new a.TextSpan;t===a.TDConstants.Toggle?e.superScript=!0!==this.isSuperScript():e.superScript=!!t,this._applyAttribute(e,a.IterType.Span)}else this.getAttributes().superScript=!!t},e.prototype.isSuperScript=function(){return this._state?this._iterAttributeEx(a.IterType.Span,(function(t){return t.superScript})):!!this.getAttributes().superScript},e.prototype.setSubScript=function(t){if(this._state){var e=new a.TextSpan;t===a.TDConstants.Toggle?e.subScript=!0!==this.isSubScript():e.subScript=!!t,this._applyAttribute(e,a.IterType.Span)}else this.getAttributes().subScript=!!t},e.prototype.isSubScript=function(){return this._state?this._iterAttributeEx(a.IterType.Span,(function(t){return t.subScript})):!!this.getAttributes().subScript},e.prototype.getStyleName=function(){return this._state?this._iterAttributeEx(a.IterType.Span,(function(t){return t.styleName||a.TDConstants.Undefined})):this.getAttributes().styleName},e.prototype._getStyleProp=function(){if(this._state){var t=this.getStyleName();if(t!==a.TDConstants.Undefined){var e=this._state.dataEngine.getStyleSheetEngine().getStylePropertyFromName(t);if(e)return e}}},e.prototype.getStyleShowName=function(){var t=this._getStyleProp();return t?t.styleShowName:a.TDConstants.Undefined},e.prototype.getBuiltinStyle=function(){var t=this._getStyleProp();return t?t.builtinStyleType:a.TDConstants.Undefined},e.prototype.setStyle=function(t){if(!this._state)throw new Error("State is undefined");var e;if((e="string"==typeof t?this._state.dataEngine.getStyleSheetEngine().getStylePropertyFromName(t):this._state.dataEngine.getStyleSheetEngine().getStylePropertyFromType(t))&&e.styleType===a.StyleType.Character){var n=new a.TextSpan;n.styleName=e.styleName,this._applyAttribute(n,a.IterType.Span,a.TDSetPropMode.Cover)}},e}(tt),rt=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r._items=[],r._iterIndex=0,r._initCount=0,r._totalCount=-1,r._iterator=r.createIterator(),r}return z(e,t),e.prototype.createIterator=function(){return Q(this,(function(t){throw new Error("BaseCollection.createIterator must be overrided.")}))},e.prototype.push=function(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return this._totalCount=this._totalCount<0?0:this._totalCount,this._totalCount+=$(e).length,(t=this._items).push.apply(t,$(e))},e.prototype.count=function(){if(this._totalCount>=0)return this._totalCount;for(;!this.goNext(););return this._totalCount},e.prototype.item=function(t){if(!(t<0)){if(this._totalCount>=0)return t<this._items.length?this._items[t]:void 0;do{if(t<this._initCount)break}while(!this.goNext());return this._items[t]}},e.prototype.goNext=function(){var t=this._iterator.next();return t.done?this._totalCount=this._initCount:(this._items[this._initCount]=t.value,this._initCount+=1),t.done},e.prototype.next=function(){var t=this.item(this._iterIndex);return t?(this._iterIndex+=1,{done:!1,value:t}):{done:!0,value:void 0}},e.prototype[Symbol.iterator]=function(){return this._iterIndex=0,this},e}(tt),it=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return z(e,t),e.createStateSpan=function(t,n){return new e(t,n)},e.prototype.getFont=function(){return this._state&&this._deltaOpt?nt.createStateFont(this._state,this._deltaOpt):nt.createEmptyFont()},e.prototype.getNext=function(){if(this._state&&this._deltaOpt){var t=this.getRange(),n=et.getSpanIterator(this._state);if(n.seek(t.begin()),n.next()){var r=a.DeltaOption.createLocalDeltaOption(n.getRange(),this._deltaOpt.updateSelection);return e.createStateSpan(this._state,r)}}},e.prototype.getPrev=function(){if(this._state&&this._deltaOpt){var t=this.getRange(),n=et.getSpanIterator(this._state);if(n.seek(t.begin()),n.prev()){var r=a.DeltaOption.createLocalDeltaOption(n.getRange(),this._deltaOpt.updateSelection);return e.createStateSpan(this._state,r)}}},e.prototype.getType=function(){switch(this.getAttributes().propertyType){case a.PropertyType.StoryBreakSpan:return a.TDSpanType.StoryBreak;case a.PropertyType.SectBreakSpan:return a.TDSpanType.SectBreak;case a.PropertyType.PageBreakSpan:return a.TDSpanType.PageBreak;case a.PropertyType.ParaBreakSpan:return a.TDSpanType.ParaBreak;case a.PropertyType.TableRowBreakSpan:return a.TDSpanType.TableRowBreak;case a.PropertyType.TableCellBreakSpan:return a.TDSpanType.TableCellBreak;case a.PropertyType.TableStartBreakSpan:return a.TDSpanType.TableStartBreak;case a.PropertyType.TableEndBreakSpan:return a.TDSpanType.TableEndBreak;case a.PropertyType.TableCellStartSpan:return a.TDSpanType.TableCellStart;case a.PropertyType.TableRowStartSpan:return a.TDSpanType.TableRowStart;case a.PropertyType.DefaultContainerProperty:return a.TDSpanType.DefaultContainer;case a.PropertyType.DefaultPluginProperty:return a.TDSpanType.DefaultPlugin;case a.PropertyType.DefaultDrawingProperty:return a.TDSpanType.DefaultDrawing;case a.PropertyType.ImageProperty:return a.TDSpanType.Image;case a.PropertyType.SplitlineProperty:return a.TDSpanType.Splitline;case a.PropertyType.TextframeProperty:return a.TDSpanType.Textframe;case a.PropertyType.CodeblockProperty:return a.TDSpanType.Codeblock;case a.PropertyType.EmbedCommentProperty:return a.TDSpanType.EmbedComment;case a.PropertyType.FieldCharSpan:return a.TDSpanType.FieldChar;default:return a.TDSpanType.Text}},e.prototype.isSpecialChar=function(){var t=!1;switch(this.getAttributes().propertyType){case a.PropertyType.StoryBreakSpan:case a.PropertyType.SectBreakSpan:case a.PropertyType.PageBreakSpan:case a.PropertyType.ParaBreakSpan:case a.PropertyType.TableRowBreakSpan:case a.PropertyType.TableCellBreakSpan:case a.PropertyType.TableStartBreakSpan:case a.PropertyType.TableEndBreakSpan:case a.PropertyType.TableCellStartSpan:case a.PropertyType.TableRowStartSpan:case a.PropertyType.DefaultContainerProperty:case a.PropertyType.DefaultPluginProperty:case a.PropertyType.DefaultDrawingProperty:case a.PropertyType.ImageProperty:case a.PropertyType.SplitlineProperty:case a.PropertyType.TextframeProperty:case a.PropertyType.CodeblockProperty:case a.PropertyType.EmbedCommentProperty:case a.PropertyType.FieldCharSpan:t=!0}return t},e}(nt),ot=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return z(e,t),e.createStateSpans=function(t,n){return new e(t,n)},e.prototype.createIterator=function(){var t,e,n;return Q(this,(function(r){switch(r.label){case 0:if(!this._state||!this._deltaOpt)return[3,4];t=this._deltaOpt.originRange,e=et.getSpanIterator(this._state,t),r.label=1;case 1:return n=a.DeltaOption.createLocalDeltaOption(e.getRange(),this._deltaOpt.updateSelection),[4,it.createStateSpan(this._state,n)];case 2:r.sent(),r.label=3;case 3:if(e.next())return[3,1];r.label=4;case 4:return[2]}}))},e}(rt),at=[a.ParaPropKey.listId,a.ParaPropKey.listLevel,a.ParaPropKey.listTemplateId,a.ParaPropKey.taskState],st=a.ClearParaProps.filter((function(t){return!at.includes(t)})),lt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return z(e,t),e.createStateParagraphFormat=function(t,n){return new e(t,n)},e.createEmptyParagraphFormat=function(){return new e},e.prototype.getAttributes=function(){if(this._state&&this._deltaOpt){if(this._lastRange&&this._attribute&&this._lastRange.equal(this._deltaOpt.originRange))return this._attribute;var t=et.getParagraphIterator(this._state,this._deltaOpt.originRange).getProperty(!0);this._attribute=t||new a.ParaProperty}return this._attribute||(this._attribute=new a.ParaProperty),this._attribute},e.prototype.setFormat=function(t){this._state?this._applyAttribute(t.getAttributes(),a.IterType.Paragraph,a.TDSetPropMode.Merge):this.getAttributes().merge(t.getAttributes())},e.prototype.getParaId=function(){if(this._state){var t=this._iterAttributeEx(a.IterType.Paragraph,(function(t){return t.paraId}));return t===a.TDConstants.Undefined?"":t}return this.getAttributes().paraId},e.prototype.setAlignment=function(t){if(this._state){var e=new a.ParaProperty;e.textAlignment=t,this._applyAttribute(e,a.IterType.Paragraph)}else this.getAttributes().textAlignment=t},e.prototype.getAlignment=function(){return this._state?this._iterAttributeEx(a.IterType.Paragraph,(function(t){return t.textAlignment})):this.getAttributes().textAlignment},e.prototype.setOutlineLevel=function(t){if(this._state){var e=new a.ParaProperty;e.outlineLevel=t,this._applyAttribute(e,a.IterType.Paragraph)}else this.getAttributes().outlineLevel=t},e.prototype.getOutlineLevel=function(){return this._state?this._iterAttributeEx(a.IterType.Paragraph,(function(t){return t.outlineLevel})):this.getAttributes().outlineLevel},e.prototype.setLineSpacing=function(t){if(this._state){var e=new a.ParaProperty;e.lineSpacing=t,this._applyAttribute(e,a.IterType.Paragraph)}else this.getAttributes().lineSpacing=t},e.prototype.setLineSpacingRule=function(t){if(this._state){var e=new a.ParaProperty;e.lineSpacingRule=t,this._applyAttribute(e,a.IterType.Paragraph)}else this.getAttributes().lineSpacingRule=t},e.prototype.getLineSpacing=function(){return this._state?this._iterAttributeEx(a.IterType.Paragraph,(function(t){return t.lineSpacing})):this.getAttributes().lineSpacing},e.prototype.getLineSpacingRule=function(){return this._state?this._iterAttributeEx(a.IterType.Paragraph,(function(t){return t.lineSpacingRule})):this.getAttributes().lineSpacingRule},e.prototype.setSpaceBefore=function(t){if(this._state){var e=new a.ParaProperty;e.spaceBefore=t,this._applyAttribute(e,a.IterType.Paragraph)}else this.getAttributes().spaceBefore=t},e.prototype.setLineUnitBefore=function(t){if(this._state){var e=new a.ParaProperty;e.lineUnitBefore=t,this._applyAttribute(e,a.IterType.Paragraph)}else this.getAttributes().lineUnitBefore=t},e.prototype.setSpaceBeforeAuto=function(t){if(this._state){var e=new a.ParaProperty;e.spaceBeforeAuto=t,this._applyAttribute(e,a.IterType.Paragraph)}else this.getAttributes().spaceBeforeAuto=t},e.prototype.getSpaceBefore=function(){return this._state?this._iterAttributeEx(a.IterType.Paragraph,(function(t){return t.spaceBefore})):this.getAttributes().spaceBefore},e.prototype.getLineUnitBefore=function(){return this._state?this._iterAttributeEx(a.IterType.Paragraph,(function(t){return t.lineUnitBefore})):this.getAttributes().lineUnitBefore},e.prototype.getSpaceBeforeAuto=function(){return this._state?this._iterAttributeEx(a.IterType.Paragraph,(function(t){return t.spaceBeforeAuto})):this.getAttributes().spaceBeforeAuto},e.prototype.setSpaceAfter=function(t){if(this._state){var e=new a.ParaProperty;e.spaceAfter=t,this._applyAttribute(e,a.IterType.Paragraph)}else this.getAttributes().spaceAfter=t},e.prototype.setLineUnitAfter=function(t){if(this._state){var e=new a.ParaProperty;e.lineUnitAfter=t,this._applyAttribute(e,a.IterType.Paragraph)}else this.getAttributes().lineUnitAfter=t},e.prototype.setSpaceAfterAuto=function(t){if(this._state){var e=new a.ParaProperty;e.spaceAfterAuto=t,this._applyAttribute(e,a.IterType.Paragraph)}else this.getAttributes().spaceAfterAuto=t},e.prototype.getSpaceAfter=function(){return this._state?this._iterAttributeEx(a.IterType.Paragraph,(function(t){return t.spaceAfter})):this.getAttributes().spaceAfter},e.prototype.getLineUnitAfter=function(){return this._state?this._iterAttributeEx(a.IterType.Paragraph,(function(t){return t.lineUnitAfter})):this.getAttributes().lineUnitAfter},e.prototype.getSpaceAfterAuto=function(){return this._state?this._iterAttributeEx(a.IterType.Paragraph,(function(t){return t.spaceAfterAuto})):this.getAttributes().spaceAfterAuto},e.prototype.setDisableLineHeightGrid=function(t){if(this._state){var e=new a.ParaProperty;e.disableLineHeightGrid=t,this._applyAttribute(e,a.IterType.Paragraph)}else this.getAttributes().disableLineHeightGrid=t},e.prototype.getDisableLineHeightGrid=function(){return this._state?this._iterAttributeEx(a.IterType.Paragraph,(function(t){return t.disableLineHeightGrid})):this.getAttributes().disableLineHeightGrid},e.prototype.setLeftIndent=function(t){if(this._state){var e=new a.ParaProperty;e.leftIndent=t,this._applyAttribute(e,a.IterType.Paragraph,a.TDSetPropMode.Merge)}else this.getAttributes().leftIndent=t},e.prototype.setCharacterUnitLeftIndent=function(t){if(this._state){var e=new a.ParaProperty;e.characterUnitLeftIndent=t,0===t&&(e.leftIndent=0),this._applyAttribute(e,a.IterType.Paragraph,a.TDSetPropMode.Merge)}else this.getAttributes().characterUnitLeftIndent=t,0===t&&0!==this.getAttributes().leftIndent&&(this.getAttributes().leftIndent=0)},e.prototype.getLeftIndent=function(){return this._state?this._iterAttributeEx(a.IterType.Paragraph,(function(t){return t.leftIndent})):this.getAttributes().leftIndent},e.prototype.getCharacterUnitLeftIndent=function(){return this._state?this._iterAttributeEx(a.IterType.Paragraph,(function(t){return t.characterUnitLeftIndent})):this.getAttributes().characterUnitLeftIndent},e.prototype.setRightIndent=function(t){if(this._state){var e=new a.ParaProperty;e.rightIndent=t,this._applyAttribute(e,a.IterType.Paragraph)}else this.getAttributes().rightIndent=t},e.prototype.setCharacterUnitRightIndent=function(t){if(this._state){var e=new a.ParaProperty;e.characterUnitRightIndent=t,0===t&&(e.rightIndent=0),this._applyAttribute(e,a.IterType.Paragraph)}else this.getAttributes().characterUnitRightIndent=t,0===t&&0!==this.getAttributes().rightIndent&&(this.getAttributes().rightIndent=0)},e.prototype.getRightIndent=function(){return this._state?this._iterAttributeEx(a.IterType.Paragraph,(function(t){return t.rightIndent})):this.getAttributes().rightIndent},e.prototype.getCharacterUnitRightIndent=function(){return this._state?this._iterAttributeEx(a.IterType.Paragraph,(function(t){return t.characterUnitRightIndent})):this.getAttributes().characterUnitRightIndent},e.prototype.setSpecialIndent=function(t){if(this._state){var e=new a.ParaProperty;e.specialIndent=t,this._applyAttribute(e,a.IterType.Paragraph)}else this.getAttributes().specialIndent=t},e.prototype.setCharacterUnitSpecialIndent=function(t){if(this._state){var e=new a.ParaProperty;e.characterUnitSpecialIndent=t,0===t&&(e.specialIndent=0),this._applyAttribute(e,a.IterType.Paragraph)}else this.getAttributes().characterUnitSpecialIndent=t,0===t&&0!==this.getAttributes().specialIndent&&(this.getAttributes().specialIndent=0)},e.prototype.getSpecialIndent=function(){return this._state?this._iterAttributeEx(a.IterType.Paragraph,(function(t){return t.specialIndent})):this.getAttributes().specialIndent},e.prototype.getCharacterUnitSpecialIndent=function(){return this._state?this._iterAttributeEx(a.IterType.Paragraph,(function(t){return t.characterUnitSpecialIndent})):this.getAttributes().characterUnitSpecialIndent},e.prototype.getStyleName=function(){return this._state?this._iterAttributeEx(a.IterType.Paragraph,(function(t){return t.styleName||a.TDConstants.Undefined})):this.getAttributes().styleName},e.prototype._getStyleProp=function(){if(this._state){var t=this.getStyleName();if(t!==a.TDConstants.Undefined){var e=this._state.dataEngine.getStyleSheetEngine().getStylePropertyFromName(t);if(e)return e}}},e.prototype.getStyleShowName=function(){var t=this._getStyleProp();return t?t.styleShowName:a.TDConstants.Undefined},e.prototype.getBuiltinStyle=function(){var t=this._getStyleProp();return t?t.builtinStyleType:a.TDConstants.Undefined},e.prototype.setStyle=function(t){if(!this._state||!this._deltaOpt)throw new Error("State is undefined");var e;if((e="string"==typeof t?this._state.dataEngine.getStyleSheetEngine().getStylePropertyFromName(t):this._state.dataEngine.getStyleSheetEngine().getStylePropertyFromType(t))&&e.styleType===a.StyleType.Paragraph){var n=this._deltaOpt.buildDelta();n.splitValidRange(this._state.getRWTextStream(),(function(t){n.clearParaProperty(t,st)}));var r=new a.ParaProperty;r.styleName=e.styleName,e.paraProperty&&(r.textAlignment=e.paraProperty.textAlignment),this._applyAttribute(r,a.IterType.Paragraph,a.TDSetPropMode.Merge,n),this._state.applyDelta(n)}},e.prototype.getListId=function(){return this._state?this._iterAttributeEx(a.IterType.Paragraph,(function(t){return t.listId})):this.getAttributes().listId},e.prototype.getListLevel=function(){return this._state?this._iterAttributeEx(a.IterType.Paragraph,(function(t){return t.listLevel})):this.getAttributes().listLevel},e.prototype.getTaskState=function(){return this._state?this._iterAttributeEx(a.IterType.Paragraph,(function(t){return t.taskState})):this.getAttributes().taskState},e.prototype.setTaskState=function(t){if(this._state){var e=new a.ParaProperty;e.taskState=t,this._applyAttribute(e,a.IterType.Paragraph)}else this.getAttributes().taskState=t},e.prototype.getBorderType=function(){return this._state?this._iterAttributeEx(a.IterType.Paragraph,(function(t){return t.borderType})):this.getAttributes().borderType},e.prototype.setBorderType=function(t){if(this._state){var e=new a.ParaProperty;e.borderType=t,this._applyAttribute(e,a.IterType.Paragraph)}else this.getAttributes().borderType=t},e}(tt),pt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return z(e,t),e.createStateParagraph=function(t,n){return new e(t,n)},e.prototype.getFormat=function(){return this._state&&this._deltaOpt?lt.createStateParagraphFormat(this._state,this._deltaOpt):lt.createEmptyParagraphFormat()},e.prototype.getNext=function(){if(this._state&&this._deltaOpt){var t=this.getRange(),n=et.getParagraphIterator(this._state);if(n.seek(t.begin()),n.next()){var r=a.DeltaOption.createLocalDeltaOption(n.getRange(),this._deltaOpt.updateSelection);return e.createStateParagraph(this._state,r)}}},e.prototype.getPrev=function(){if(this._state&&this._deltaOpt){var t=this.getRange(),n=et.getParagraphIterator(this._state);if(n.seek(t.begin()),n.prev()){var r=a.DeltaOption.createLocalDeltaOption(n.getRange(),this._deltaOpt.updateSelection);return e.createStateParagraph(this._state,r)}}},e}(lt),ct=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return z(e,t),e.createStateParagraphs=function(t,n){return new e(t,n)},e.prototype.createIterator=function(){var t,e,n;return Q(this,(function(r){switch(r.label){case 0:if(!this._state||!this._deltaOpt)return[3,4];t=this._deltaOpt.originRange,e=et.getParagraphIterator(this._state,t),r.label=1;case 1:return n=a.DeltaOption.createLocalDeltaOption(e.getRange(),this._deltaOpt.updateSelection),[4,pt.createStateParagraph(this._state,n)];case 2:r.sent(),r.label=3;case 3:if(e.next())return[3,1];r.label=4;case 4:return[2]}}))},e}(rt),ht=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return z(e,t),e.createStateSectionFormat=function(t,n){return new e(t,n)},e.createEmptySectionFormat=function(){return new e},e.prototype.getAttributes=function(){if(this._state&&this._deltaOpt){if(this._lastRange&&this._attribute&&this._lastRange.equal(this._deltaOpt.originRange))return this._attribute;var t=et.getSectionIterator(this._state,this._deltaOpt.originRange).getProperty(!0);this._attribute=t||new a.SectionProperty}return this._attribute||(this._attribute=new a.SectionProperty),this._attribute},e.prototype.setSectionFormat=function(t){this._state?this._applyAttribute(t.getAttributes(),a.IterType.Section):this.getAttributes().merge(t.getAttributes())},e.prototype.setStoryIdByStoryType=function(t,e,n){if(n)switch(t){case a.StoryType.PrimaryHeaderStory:n.defaultHeaderRefId=e;break;case a.StoryType.PrimaryFooterStory:n.defaultFooterRefId=e;break;case a.StoryType.FirstPageHeaderStory:n.firstHeaderRefId=e;break;case a.StoryType.FirstPageFooterStory:n.firstFooterRefId=e;break;case a.StoryType.EvenPagesHeaderStory:n.evenHeaderRefId=e;break;case a.StoryType.EvenPagesFooterStory:n.evenFooterRefId=e}},e.prototype.getStoryIdByStoryType=function(t,e){var n;if(e)switch(t){case a.StoryType.PrimaryHeaderStory:n=e.defaultHeaderRefId;break;case a.StoryType.PrimaryFooterStory:n=e.defaultFooterRefId;break;case a.StoryType.FirstPageHeaderStory:n=e.firstHeaderRefId;break;case a.StoryType.FirstPageFooterStory:n=e.firstFooterRefId;break;case a.StoryType.EvenPagesHeaderStory:n=e.evenHeaderRefId;break;case a.StoryType.EvenPagesFooterStory:n=e.evenFooterRefId}return n},e.prototype.setHeaderFooterStoryId=function(t,e){if(this._state){var n=new a.SectionProperty;this.setStoryIdByStoryType(t,e,n),this._applyAttribute(n,a.IterType.Section,a.TDSetPropMode.Merge)}},e.prototype.getHeaderFooterStoryId=function(t){var e=this;return this._state?this._iterAttributeEx(a.IterType.Section,(function(n){return e.getStoryIdByStoryType(t,n)||""})):a.TDConstants.Undefined},e.prototype.setPageWidth=function(t){if(this._state){var e=new a.SectionProperty;e.pageWidth=t,this._applyAttribute(e,a.IterType.Section)}else this.getAttributes().pageWidth=t},e.prototype.getPageWidth=function(){return this._state?this._iterAttributeEx(a.IterType.Section,(function(t){return t.pageWidth})):this.getAttributes().pageWidth},e.prototype.setPageHeight=function(t){if(this._state){var e=new a.SectionProperty;e.pageHeight=t,this._applyAttribute(e,a.IterType.Section)}else this.getAttributes().pageHeight=t},e.prototype.getPageHeight=function(){return this._state?this._iterAttributeEx(a.IterType.Section,(function(t){return t.pageHeight})):this.getAttributes().pageHeight},e.prototype.setMarginTop=function(t){if(this._state){var e=new a.SectionProperty;e.marginTop=t,this._applyAttribute(e,a.IterType.Section)}else this.getAttributes().marginTop=t},e.prototype.getMarginTop=function(){return this._state?this._iterAttributeEx(a.IterType.Section,(function(t){return t.marginTop})):this.getAttributes().marginTop},e.prototype.setMarginRight=function(t){if(this._state){var e=new a.SectionProperty;e.marginRight=t,this._applyAttribute(e,a.IterType.Section)}else this.getAttributes().marginRight=t},e.prototype.getMarginRight=function(){return this._state?this._iterAttributeEx(a.IterType.Section,(function(t){return t.marginRight})):this.getAttributes().marginRight},e.prototype.setMarginBottom=function(t){if(this._state){var e=new a.SectionProperty;e.marginBottom=t,this._applyAttribute(e,a.IterType.Section)}else this.getAttributes().marginBottom=t},e.prototype.getMarginBottom=function(){return this._state?this._iterAttributeEx(a.IterType.Section,(function(t){return t.marginBottom})):this.getAttributes().marginBottom},e.prototype.setMarginLeft=function(t){if(this._state){var e=new a.SectionProperty;e.marginLeft=t,this._applyAttribute(e,a.IterType.Section)}else this.getAttributes().marginLeft=t},e.prototype.getMarginLeft=function(){return this._state?this._iterAttributeEx(a.IterType.Section,(function(t){return t.marginLeft})):this.getAttributes().marginLeft},e.prototype.setPageStartAt=function(t){if(this._state&&this._deltaOpt){var e=this._deltaOpt.buildDelta();e.globalOpts.updateSelection=!1;var n=new a.SectionProperty;n.pageStartAt=t,e.setSectionProperty(e.currentRange(),n),this._state.applyDelta(e)}},e.prototype.getPageStartAt=function(){if(this._state&&this._deltaOpt){var t=this._state.getTextStream().createSectionIterator(this._deltaOpt.originRange).getProperty();return t?t.pageStartAt:a.Defaults.section.pageStartAt}return a.Defaults.section.pageStartAt},e}(tt),ut=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return z(e,t),e.createStateSection=function(t,n){return new e(t,n)},e.prototype.getSectionFormat=function(){return this._state&&this._deltaOpt?ht.createStateSectionFormat(this._state,this._deltaOpt):ht.createEmptySectionFormat()},e.prototype.getNext=function(){if(this._state&&this._deltaOpt){var t=this.getRange(),n=et.getSectionIterator(this._state);if(n.seek(t.begin()),n.next()){var r=a.DeltaOption.createLocalDeltaOption(n.getRange(),this._deltaOpt.updateSelection);return e.createStateSection(this._state,r)}}},e.prototype.getPrev=function(){if(this._state&&this._deltaOpt){var t=this.getRange(),n=et.getSectionIterator(this._state);if(n.seek(t.begin()),n.prev()){var r=a.DeltaOption.createLocalDeltaOption(n.getRange(),this._deltaOpt.updateSelection);return e.createStateSection(this._state,r)}}},e}(ht),gt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return z(e,t),e.createStateSections=function(t,n){return new e(t,n)},e.prototype.createIterator=function(){var t,e,n;return Q(this,(function(r){switch(r.label){case 0:if(!this._state||!this._deltaOpt)return[3,4];t=this._deltaOpt.originRange,e=et.getSectionIterator(this._state,t),r.label=1;case 1:return n=a.DeltaOption.createLocalDeltaOption(e.getRange(),this._deltaOpt.updateSelection),[4,ut.createStateSection(this._state,n)];case 2:r.sent(),r.label=3;case 3:if(e.next())return[3,1];r.label=4;case 4:return[2]}}))},e}(rt),dt=function(t){function e(e,n,r){var i=t.call(this,e,n)||this;return i.drawingProp=r,i}return z(e,t),e.createStateInlineShape=function(t,n,r){return new e(t,n,r)},e.prototype.getWidth=function(){return this.drawingProp.width},e.prototype.getHeight=function(){return this.drawingProp.height},e.prototype.setHeight=function(t){var e=new a.ImageProperty;e.height=t,this._applyAttribute(e,a.IterType.Span)},e.prototype.setWidth=function(t){var e=new a.ImageProperty;e.width=t,this._applyAttribute(e,a.IterType.Span)},e.prototype.setCropBottom=function(t){var e=new a.ImageProperty;e.cropBottom=t,this._applyAttribute(e,a.IterType.Span)},e.prototype.setCropTop=function(t){var e=new a.ImageProperty;e.cropTop=t,this._applyAttribute(e,a.IterType.Span)},e.prototype.setCropLeft=function(t){var e=new a.ImageProperty;e.cropLeft=t,this._applyAttribute(e,a.IterType.Span)},e.prototype.setCropRight=function(t){var e=new a.ImageProperty;e.cropRight=t,this._applyAttribute(e,a.IterType.Span)},e.prototype.getAnchorId=function(){return this.drawingProp.anchorId},e.prototype.getImageSrc=function(){return this.drawingProp instanceof a.ImageProperty?this.drawingProp.imgSrc:a.TDConstants.Undefined},e.prototype.setImageProperties=function(t,e){void 0===e&&(e=!0);var n=this._deltaOpt.buildDelta();n.setSpanProperty(n.currentRange(),t),n.setUpdateSelection(!1),n.setNeedCollab(e),this._state.applyDelta(n)},e}(tt),ft=function(t){function e(e,n,r){var i=t.call(this,e,n)||this;return i.drawingType=r,i}return z(e,t),e.createStateInlineShapes=function(t,n,r){return new e(t,n,r)},e.prototype.addImage=function(t,e,n,r){if(!(r.length<=0)){var i=this._coreRange(),o=i.fixToValidReplaceRange(i.gcpRange),s=new a.ImageProperty(this._state.followSpanProp(o.begin()));s.anchorId=t,s.width=e,s.height=n,s.imgSrc=r;var l=this._deltaOpt.buildDelta();l.deleteText(o),l.insertImage(l.currentRange().end(),s),this._state.applyDelta(l)}},e.prototype.insertImageStart=function(t,e,n,r){this._state.insertResourceStart(t,this._deltaOpt,(function(i,o,s){var l=new a.ImageProperty(s);l.anchorId=t,l.width=e,l.height=n,l.placeHolderSrc=r,l.isPlaceHolder=!0,i.insertImage(o,l)}))},e.prototype.insertImageProgress=function(t,e){this._state.insertResourceProgress(t,this._deltaOpt,(function(t,n,r){if(r instanceof a.ImageProperty){var i=new a.ImageProperty;i.progress=e,i.isPlaceHolder=!0,r.merge(i),t.setSpanProperty(new a.GCPRange(n,1),r)}}))},e.prototype.insertImageFinish=function(t,e){this._state.insertResourceFinish(t,this._deltaOpt,(function(t,n,r){if(r instanceof a.ImageProperty){var i=new a.ImageProperty;i.imgSrc=e,i.isPlaceHolder=!1,r.merge(i),t.insertImage(n,r)}}))},e.prototype.insertCopyImageFinish=function(t,e,n,r){var i=this;setTimeout((function(){i._state.insertCopyImageFinish(t,e,n,r)}),200)},e.prototype.replaceImage=function(t,e){var n=t,r=e,i=this._deltaOpt.buildDelta(),o=this._state.getTextStream().createSpanIterator();o.seek(n);var s=o.getProperty();if(s instanceof a.ImageProperty){if(n===r)return;n<r&&(r-=1),i.deleteText(new a.GCPRange(n,1)),i.insertImage(r,s),this._state.applyDelta(i)}},e.prototype.addSplitline=function(t,e,n){void 0===n&&(n={});var r=this._coreRange(),i=r.fixToValidReplaceRange(r.gcpRange),o=new a.SplitlineProperty(this._state.followSpanProp(i.begin()));o.type=t,o.fillColor=e;var s=this._deltaOpt.buildDelta();s.deleteText(i);var l=i.begin();if(n.wrapBefore){var p=this._state.followParaProp(i.end()).paraProp;s.insertParagraph(l,new a.ParaBreakSpan,p),l+=1}if(s.insertSplitline(l,o),l+=1,n.wrapAfter){var c=this._state.followParaProp(i.end());s.insertParagraph(l,c.paraBreakSpan,c.paraProp)}this._state.applyDelta(s)},e.prototype.moveSplitline=function(t,e){var n=t,r=e,i=this._deltaOpt.buildDelta(),o=this._state.getTextStream().createSpanIterator();o.seek(n);var s=o.getProperty(!0);if(s instanceof a.SplitlineProperty){if(n===r)return;n<r&&(r-=1),i.deleteText(new a.GCPRange(n,1)),i.insertSplitline(r,s),this._state.applyDelta(i)}},e.prototype.setSplitlineProperties=function(t){var e=this._deltaOpt.buildDelta();e.setSpanProperty(e.currentRange(),t),this._state.applyDelta(e)},e.prototype._coreRange=function(t){return new a.CoreRange(this._state.dataEngine,t||this._deltaOpt.originRange)},e.prototype.createIterator=function(){var t,e,n,r,i;return Q(this,(function(o){switch(o.label){case 0:if(!this._state||!this._deltaOpt)return[3,4];t=this._state.dataEngine.getTextStream(),e=this._deltaOpt.originRange,n=t.createSpanIterator(e),o.label=1;case 1:return n.hasNext()?(r=a.DeltaOption.createLocalDeltaOption(n.getRange(),this._deltaOpt.updateSelection),i=n.getProperty(!0),n.next(),!(i instanceof a.DrawingContainerProperty)||this.drawingType&&i.drawingType!==this.drawingType?[3,3]:[4,dt.createStateInlineShape(this._state,r,i)]):[3,4];case 2:o.sent(),o.label=3;case 3:return[3,1];case 4:return[2]}}))},e}(rt),yt=function(t){function e(e,n,r){var i=t.call(this,e,n)||this;return i.pluginProp=r,i}return z(e,t),e.prototype.getAttributes=function(){return this.pluginProp},e.createStateInlinePlugin=function(t,n,r){return new e(t,n,r)},e.prototype.setWidth=function(t){var e=new a.DefaultPluginProperty(this.pluginProp);e.width=t,this.setPluginProperties(e)},e.prototype.getWidth=function(){return this.pluginProp.width},e.prototype.setHeight=function(t){var e=new a.DefaultPluginProperty(this.pluginProp);e.height=t,this.setPluginProperties(e)},e.prototype.getHeight=function(){return this.pluginProp.height},e.prototype.setPluginProperties=function(t){var e=this._deltaOpt.buildDelta();e.setSpanProperty(e.currentRange(),t),e.setUpdateSelection(!1),this._state.applyDelta(e)},e}(tt),Tt=function(t){function e(e,n,r){var i=t.call(this,e,n)||this;return i.pluginType=r,i}return z(e,t),e.createStateInlinePlugins=function(t,n,r){return new e(t,n,r)},e.prototype._coreRange=function(t){return new a.CoreRange(this._state.dataEngine,t||this._deltaOpt.originRange)},e.prototype.createIterator=function(){var t,e,n,r,i;return Q(this,(function(o){switch(o.label){case 0:if(!this._state||!this._deltaOpt)return[3,4];t=this._state.dataEngine.getTextStream(),e=this._deltaOpt.originRange,n=t.createSpanIterator(e),o.label=1;case 1:return n.hasNext()?(r=a.DeltaOption.createLocalDeltaOption(n.getRange(),this._deltaOpt.updateSelection),i=n.getProperty(!0),n.next(),!(i instanceof a.PluginContainerProperty)||this.pluginType&&i.pluginType!==this.pluginType?[3,3]:[4,yt.createStateInlinePlugin(this._state,r,i)]):[3,4];case 2:o.sent(),o.label=3;case 3:return[3,1];case 4:return[2]}}))},e.prototype.insertPlugin=function(t,e,n,r,i,o){var s=this._coreRange().fixToValidReplaceRange(this._coreRange().gcpRange),l=new a.DefaultPluginProperty(this._state.followSpanProp(s.begin()));l.anchorId=t,l.pluginType=e,this._setPluginInfo(l,n,r,i,o);var p=this._deltaOpt.buildDelta();p.deleteText(s),p.insertPlugin(p.currentRange().end(),l),this._state.applyDelta(p)},e.prototype.insertPluginStart=function(t,e,n,r,i,o){var s=this;this._state.insertResourceStart(t,this._deltaOpt,(function(l,p,c){var h=new a.DefaultPluginProperty(c);h.anchorId=t,h.pluginType=e,s._setPluginInfo(h,n,r,i,o),h.isPlaceHolder=!0,l.insertPlugin(p,h)}))},e.prototype.insertPluginFinish=function(t,e,n){var r=this;this._state.insertResourceFinish(t,this._deltaOpt,(function(t,i,o){var s=new a.DefaultPluginProperty;r._setPluginInfo(s,void 0,void 0,e,n),s.isPlaceHolder=!1,s.pluginType=o.pluginType,o.merge(s),t.insertPlugin(i,o)}))},e.prototype.insertPluginCancel=function(t){this._state.insertResourceCancel(t)},e.prototype._setPluginInfo=function(t,e,n,r,i){"number"==typeof e?t.width=e:e===a.ContainerOption.FitToParent&&(t.fitToParentWidth=!0),"number"==typeof n&&(t.height=n),void 0!==r&&(t.pluginSrc=r),void 0!==i&&(t.extraData=i)},e}(rt),mt=function(t){function e(e,n,r,i){var o=t.call(this,e,n)||this;return o._tableId=r,o.push.apply(o,$(i)),o}return z(e,t),e.createStateRows=function(t,n,r,i){return new e(t,n,r,i)},e.prototype.addRow=function(t){this.push(t)},e.prototype.leftTopCell=function(){if(this.count()){var t=this.item(0);if(t)return t.getCell(0)}return null},e.prototype.createIterator=function(){return Q(this,(function(t){return[2]}))},e}(rt),St=function(t){function e(e,n,r,i){var o=t.call(this,e,n)||this;return o._rowIndex=-1,o._colIndex=-1,o._rowIndex=r,o._colIndex=i,o}return z(e,t),e.createStateCell=function(t,n,r,i){return new e(t,n,r,i)},Object.defineProperty(e.prototype,"rowIndex",{get:function(){return this._rowIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"range",{get:function(){return this._deltaOpt?this._deltaOpt.originRange:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contentRange",{get:function(){return this._deltaOpt?a.GCPRange.insetBoth(this._deltaOpt.originRange,1,0):null},enumerable:!0,configurable:!0}),e.prototype.getCellInfo=function(){return this.range&&this._state?this._state.getTextStream().tableStream.getTableCellInfoFromGcp(this.range.begin()):null},e.prototype.next=function(t){if(!this.range||!this._state)return null;if(t){var n=this._state.getTextStream().tableStream,r=n.getTableInfoFromGcp(this.range.begin());if(!r)return null;var i=new a.GCPRange(this.range.end(),r.range.end()-this.range.end()),o=n.getValidCellInfoAtIndex(i,0);if(!o)return null;var s=a.DeltaOption.createLocalDeltaOption(o.range);return e.createStateCell(this._state,s)}var l=this._tableCellIter();if(!l)return null;l.seek(this.range.begin()),l.next();var p=a.DeltaOption.createLocalDeltaOption(l.getRange());return e.createStateCell(this._state,p)},e.prototype.prev=function(t){if(!this.range||!this._state)return null;if(t){var n=this._state.getTextStream().tableStream,r=n.getTableInfoFromGcp(this.range.begin());if(!r)return null;var i=new a.GCPRange(r.range.begin(),this.range.begin()+1-r.range.begin()),o=n.getValidCellInfoInverseAtIndex(i,1);if(!o)return null;var s=a.DeltaOption.createLocalDeltaOption(o.range);return e.createStateCell(this._state,s)}var l=this._tableCellIter();if(!l)return null;l.seek(this.range.begin()),l.prev();var p=a.DeltaOption.createLocalDeltaOption(l.getRange());return e.createStateCell(this._state,p)},e.prototype._tableCellIter=function(){if(this._state&&this.range){var t=this._state.getRWTextStream().tableStream,e=t.getTableInfoFromGcp(this.range.begin());return e?t.createTableCellIter(e.range,!0):null}return null},e.prototype.selectContent=function(t,e){return!this._state||!this._deltaOpt||(this._state.setRangeTo(new a.GCPRange(this._deltaOpt.originRange.begin()+1+t,e)),!0)},e.prototype.setCaretStart=function(){return!this._state||!this._deltaOpt||(this._state.setRangeTo(new a.GCPRange(this._deltaOpt.originRange.begin()+1,0)),!0)},e.prototype.setCaretEnd=function(){return!this._state||!this._deltaOpt||(this._state.setRangeTo(new a.GCPRange(this._deltaOpt.originRange.end()-1,0)),!0)},e.prototype.mainCell=function(){if(!this._state||!this.range||void 0===this._rowIndex||void 0===this._colIndex)return null;if(!this.getCellInfo())return null;var t=this._state.getRWTextStream().tableStream,n=t.getTableInfoFromGcp(this.range.begin());if(!n)return null;if(!t.isCellMerged(n.property.tableId,this._rowIndex,this._colIndex))return this;for(var r=t.getMergeCellRanges(n.property.tableId),i=0;i<r.length;i++){var o=r[i];if(this._rowIndex>=o.from.row&&this._rowIndex<=o.to.row&&this._colIndex>=o.from.col&&this._colIndex<=o.to.col){var s=t.getTableCellInfo(n.property.tableId,o.from.row,o.from.col);if(!s)return null;var l=a.DeltaOption.createLocalDeltaOption(s.range);return e.createStateCell(this._state,l,o.from.row,o.from.col)}}return null},e}(tt),vt=function(){function t(t,e,n){this._rowIndex=-1,this._state=t,this._tableProp=e,this._rowIndex=n}return t.createStateRow=function(e,n,r){return new t(e,n,r)},Object.defineProperty(t.prototype,"_tableId",{get:function(){return this._tableProp?this._tableProp.tableId:""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"_subId",{get:function(){return this._tableProp?this._tableProp.subId:""},enumerable:!0,configurable:!0}),t.prototype.getRowInfo=function(){return this._state.getTextStream().tableStream.getTableRowInfo(this._tableId,this._rowIndex)},Object.defineProperty(t.prototype,"rowIndex",{get:function(){return this._rowIndex},enumerable:!0,configurable:!0}),t.prototype.getCell=function(t){var e=this._state.getTextStream().tableStream,n=e.getTableRowInfo(this._tableId,this._rowIndex);if(!n)return null;for(var r=e.createTableCellIter(n.range,!0),i=0;i<t;)i+=1,r.next();var o=a.DeltaOption.createLocalDeltaOption(r.getRange());return St.createStateCell(this._state,o,this._rowIndex,t)},t.prototype.getCells=function(){var t=[],e=this._state.getTextStream().tableStream,n=e.getTableRowInfo(this._tableId,this._rowIndex);if(!n)return null;for(var r=e.createTableCellIter(n.range,!0);!r.getRange().isEmpty();){var i=a.DeltaOption.createLocalDeltaOption(r.getRange()),o=St.createStateCell(this._state,i,this._rowIndex,0);t.push(o),r.next()}return t},t.prototype.setRowHeight=function(t){if(this._state&&this._tableId){var e=new a.Delta(a.DeltaOption.createLocalDeltaOption(a.GCPRange.emptyRange(),!1,!0));e.setRowHeight({tableProp:this._tableProp},this._rowIndex,t),e.moveTo(this._state.selection.gcpRange),this._state.applyDelta(e)}},t}(),bt=function(){function t(t,e,n){this._colIndex=-1,this._state=t,this._tableProp=e,this._colIndex=n}return t.createStateCol=function(e,n,r){return new t(e,n,r)},Object.defineProperty(t.prototype,"colIndex",{get:function(){return this._colIndex},enumerable:!0,configurable:!0}),t.prototype.getCells=function(){return[]},t.prototype.setColWidth=function(t,e,n){var r=this._colIndex,i=this._state,o={tableProp:this._tableProp},l=i.getTextStream().tableStream.getTableInfo(this._tableProp.tableId);if(l){var p=new a.Delta(a.DeltaOption.createLocalDeltaOption(a.GCPRange.emptyRange(),!1,!0));p.setColWidth(o,r,t);var c=this.getSectionMargin(i,l.range),h=c.left,u=c.right;if(e){var g=Object(s.pxToTwips)(1),d=Math.max(g,Math.min(h,h+e));p.setTablePaddingLeft(o,d),p.setTablePaddingLeft(o,d)}if(n){var f=Math.max(0,Math.min(u,u-n));p.setTablePaddingRight(o,f)}p.moveTo(this._state.selection.gcpRange),this._state.applyDelta(p)}},t.prototype.getSectionMargin=function(t,e){var n=t.getTextStream().createSectionIterator(e).getProperty();return n?n.pageMargins:{left:0,right:0}},t}(),_t=function(t){function e(e,n,r,i){var o=t.call(this,e,n)||this;return o._tableId=r,o.push.apply(o,$(i)),o}return z(e,t),e.createStateCols=function(t,n,r,i){return new e(t,n,r,i)},e.prototype.addRow=function(t){this.push(t)},e.prototype.createIterator=function(){return Q(this,(function(t){return[2]}))},e}(rt);function Pt(t,e,n){return Object(a.fetchRangeData)(n,(function(n,r){return t.getTableCellInfo(e,n,r).property.clone()}))}function Rt(t,e){var n=new a.TableCellBreakSpan,r=new a.TableCellProperty;return r.tableDepth=1,t&&(r.merge(t),[a.ParaPropKey.styleName,a.ParaPropKey.outlineLevel,a.ParaPropKey.specialIndent,a.ParaPropKey.leftIndent,a.ParaPropKey.characterUnitLeftIndent,a.ParaPropKey.characterUnitSpecialIndent,a.ParaPropKey.rightIndent,a.ParaPropKey.characterUnitRightIndent].forEach((function(t){r.delete(t)}))),e&&(n.merge(e),n.delete(a.SpanPropKey.link),n.delete(a.CommentSpanPropKey.comments)),{tableCellProp:r,cellBreakSpan:n}}var Ct,It=[a.ParaPropKey.listId,a.ParaPropKey.listTemplateId,a.ParaPropKey.listLevel,a.ParaPropKey.taskState];function At(t){It.forEach((function(e){t.delete(e)}))}function wt(t,e){if(0!==t.length)for(var n=t.length,r=t[0].length,i=0;i<n;i++)for(var o=0;o<r;o++)e(i,o,t[i][o])}function Et(t,e,n,r,i){var o=e.getTableInfo(n);if(o){var s=e.getTableFullInfoFromGcp(o.range.begin());if(s){var l=s.rowCount,p=s.colCount;p-=1;var c=Object(a.fetchRangeNear)(r,a.RangeNearType.Top,l,p);if(c){for(var h=Pt(e,n,c),u=0;u<c.to.col-c.from.col+1;u++)h[0][u].borderBottomColor=i[0][u].borderTopColor;t.setTableCellProperty(o.property,c,h)}if(c=Object(a.fetchRangeNear)(r,a.RangeNearType.Bottom,l,p)){h=Pt(e,n,c);var g=r.to.row-r.from.row;for(u=0;u<c.to.col-c.from.col+1;u++)h[0][u].borderTopColor=i[g][u].borderBottomColor;t.setTableCellProperty(o.property,c,h)}if(c=Object(a.fetchRangeNear)(r,a.RangeNearType.Left,l,p)){for(h=Pt(e,n,c),u=0;u<c.to.row-c.from.row+1;u++)h[u][0].borderRightColor=i[u][0].borderLeftColor;t.setTableCellProperty(o.property,c,h)}if(c=Object(a.fetchRangeNear)(r,a.RangeNearType.Right,l,p)){h=Pt(e,n,c);var d=r.to.col-r.from.col;for(u=0;u<c.to.row-c.from.row+1;u++)h[u][0].borderLeftColor=i[u][d].borderRightColor;t.setTableCellProperty(o.property,c,h)}}}}function xt(t,e,n){return t+","+(e||"")+","+(n||"")}function Ot(t,e,n,r){n.seek(n.getLimitRange().end()-1);do{var i=n.getRange(a.IterType.Span),o=e.readText(i.begin(),i.length()),s=n.getSpanProp();if(s)if(o===a.PlaceholderChar.ParagraphBreak||o===a.PlaceholderChar.ParagraphReturn){if(!(s instanceof a.ParaBreakSpan))throw new Error("ParagraphBreak span property not ParaBreakSpan!");var l=n.getParaProp();l&&t.insertParagraph(r,s,l)}else t.insertSpan(r,o,s)}while(n.prev(a.IterType.Span))}function Lt(t,e,n,r){var i;if(0===r){if(!(o=t.getTableCellInfo(e,n,0)))throw new Error("insertCol failed, cell is nul, id: "+e);i=o.range.begin()}else{var o;if(!(o=t.getTableCellInfo(e,n,r-1)))throw new Error("insertCol failed, cell is nul, id: "+e);i=o.range.end()}return i}!function(t){t.AddTable="AddTable",t.DelTable="DelTable",t.InsertCol="InsertCol",t.DelCol="DelCol",t.InsertRow="InsertRow",t.DelRow="DelRow",t.SetBgColor="SetBgColor",t.SetBorderColor="SetBorderColor",t.MergeCell="MergeCell",t.UnMergeCell="UnMergeCell",t.SplitCell="SplitCell",t.MoveTable="MoveTable",t.SetVertical="SetVertical",t.ClearContent="ClearContent",t.ReloadData="ReloadData"}(Ct||(Ct={}));var Dt=function(t){function e(e,n,r,i){var o=t.call(this,e,n)||this;return o._cellRange=i,o._tableProp=r,o}return z(e,t),e.createStateRange=function(t,n,r,i){return new e(t,n,r,i)},Object.defineProperty(e.prototype,"_tableId",{get:function(){return this._tableProp.tableId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cellRange",{get:function(){return this._cellRange},enumerable:!0,configurable:!0}),e.prototype._getProps=function(t,e){return this._state?Pt(this._state.getTextStream().tableStream,t,e):[[]]},e.prototype._getParaProp=function(t){var e=this._state.getTextStream(),n=e.createDataIterator(t),r=n.getRange(a.IterType.Span),i=e.readText(r.begin(),r.length());if(n.getSpanProp(!0)&&i===a.PlaceholderChar.TableCellBreak){var o=n.getParaProp();return o?new a.ParaProperty(o):null}return null},e.prototype.merge=function(){var t=this,e=this._state.getTextStream(),n=e.tableStream,r=this._deltaOpt.buildDelta(),i=n.getTableCellInfo(this._tableId,this._cellRange.from.row,this._cellRange.from.col);if(!i)throw new Error("table merge main cell info is null!");Object(a.cellRangeEach)(this._cellRange,!1,(function(e,i){var o=n.getTableCellInfo(t._tableId,e,i);if(o&&(o.property.rowSpan>1||o.property.colSpan>1)){var s=o.property,l=s.rowSpan,p=s.colSpan;r.unMergeCell(t._tableProp,{from:new a.TableCellCoords(e,i),to:new a.TableCellCoords(e+l-1,i+p-1)})}return!0}));var o=[];Object(a.cellRangeEach)(this._cellRange,!0,(function(i,s,l){if(!l){var p=n.getTableCellInfo(t._tableId,i,s);if(p&&p.range.length()>2){var c=a.GCPRange.inset(p.range,1);r.deleteText(c),o.push(e.createDataIterator(c))}}return!0}));var s=this._getParaProp(new a.GCPRange(i.range.end()-1,1));if(!s)throw new Error("table merge paraProp is null!");var l=i.range.end()-1;o.forEach((function(t){Ot(r,e,t,l),r.insertParagraph(l,new a.ParaBreakSpan,s)})),r.mergeCell(this._tableProp,this._cellRange);var p=n.getTableCellInfo(this._tableId,this.cellRange.from.row,this.cellRange.from.col);return p&&r.moveTo(new a.GCPRange(p.range.begin()+1,0)),r.msg=xt(Ct.MergeCell,this._tableId,""+JSON.stringify(this.cellRange)),this._state.applyDelta(r),!0},e.prototype.unMerge=function(){var t=this;if(this._state&&this._tableId&&this._deltaOpt){var e=this._cellRange,n=this._deltaOpt.buildDelta(),r=this._state.getTextStream(),i=r.tableStream;n.unMergeCell(this._tableProp,e);var o=e.from,s=o.row,l=o.col,p=i.getTableCellInfo(this._tableId,s,l);if(!p)throw new Error("table merge paraProp is null!");var c=a.GCPRange.inset(p.range,1),h=r.createParagraphIterator(c),u=[];Object(a.cellRangeEach)(e,!1,(function(e,o,a){if(h.getRange().isEmpty())return!1;var s=r.createDataIterator(h.getRange());if(a)u.push((function(){n.deleteText(c),Ot(n,r,s,c.begin())}));else{var l=i.getTableCellInfo(t._tableId,e,o);if(!l)throw new Error("table merge cellInfo is null!"+t._tableId+":"+e+":"+o);u.push((function(){Ot(n,r,s,l.range.begin())}))}return h.next(),!0})),h.getRange().isEmpty()||u.push((function(){var o=new a.GCPRange(h.getRange().begin(),c.end()-h.getRange().begin()),s=r.createDataIterator(o),l=i.getTableCellInfo(t._tableId,e.to.row,e.to.col);l&&Ot(n,r,s,l.range.begin())})),u.reverse().forEach((function(t){t()})),n.msg=xt(Ct.UnMergeCell,this._tableId,JSON.stringify(this.cellRange)),this._state.applyDelta(n)}},e.prototype.setBgColor=function(t){var e=this._deltaOpt.buildDelta(),n=new a.TableCellProperty;n.cellcolor=t,e.setTableCellProperty(this._tableProp,this._cellRange,void 0,n),e.moveTo(this._deltaOpt.originRange),e.msg=xt(Ct.SetBgColor,this._tableId,JSON.stringify(this.cellRange)),this._state.applyDelta(e)},e.prototype.setVerticalAlign=function(t){var e=this._deltaOpt.buildDelta(),n=new a.TableCellProperty;n.vAlign=function(t){var e="middle";switch(t){case a.VerticalAlignmentType.AlignVerticalTop:e="top";break;case a.VerticalAlignmentType.AlignVerticalCenter:e="middle";break;case a.VerticalAlignmentType.AlignVerticalBottom:e="bottom";break;default:e="middle"}return e}(t),e.setTableCellProperty(this._tableProp,this._cellRange,void 0,n),e.moveTo(this._deltaOpt.originRange),e.msg=xt(Ct.SetVertical,this._tableId,JSON.stringify(this.cellRange)),this._state.applyDelta(e)},e.prototype.getVerticalAlign=function(){var t=this,e=this._state.getTextStream().tableStream,n=a.VerticalAlignmentType.AlignVerticalCenter;return Object(a.cellRangeEach)(this._cellRange,!1,(function(r,i,o){var s=e.getTableCellInfo(t._tableId,r,i);if(!s)return!1;var l=function(t){var e=a.VerticalAlignmentType.AlignVerticalCenter;switch(t){case"top":e=a.VerticalAlignmentType.AlignVerticalTop;break;case"middle":e=a.VerticalAlignmentType.AlignVerticalCenter;break;case"bottom":e=a.VerticalAlignmentType.AlignVerticalBottom;break;default:e=a.VerticalAlignmentType.AlignVerticalCenter}return e}(s.property.vAlign);return o&&s?(n=l,!0):!(!s||n!==l)})),n},e.prototype.getBorderType=function(){return function(t){var e=a.BORDER_STYLE.BORDER_ALL,n=t.length,r=n>0?t[0].length:0;if(0===n&&0===r)return e;if(1!==n||1!==r)return function(t){var e=t.length,n=e>0?t[0].length:0;if(0===e&&0===n)return a.BORDER_STYLE.BORDER_ALL;for(var r=!0,i=!0,o=!0,s=!0,l=!0,p=!0,c=0;c<e;c++)for(var h=0;h<n;h++){var u=t[c][h];u.isMerged||("transparent"===u.borderLeftColor&&(0===h?o=!1:i=!1),"transparent"===u.borderTopColor&&(0===c?s=!1:r=!1),"transparent"===u.borderRightColor&&(h===n-1?l=!1:i=!1),"transparent"===u.borderBottomColor&&(c===e-1?p=!1:r=!1))}return function(t,e,n,r,i,o,s,l){var p=a.BORDER_STYLE.BORDER_ALL;return n&&1!==t||(p-=a.BORDER_STYLE.BORDER_INNER_HOR),r&&1!==e||(p-=a.BORDER_STYLE.BORDER_INNER_VER),i||(p-=a.BORDER_STYLE.BORDER_LEFT),o||(p-=a.BORDER_STYLE.BORDER_TOP),s||(p-=a.BORDER_STYLE.BORDER_RIGHT),l||(p-=a.BORDER_STYLE.BORDER_BOTTOM),p}(e,n,r,i,o,s,l,p)}(t);e-=a.BORDER_STYLE.BORDER_INNER_HOR,e-=a.BORDER_STYLE.BORDER_INNER_VER;var i=t[0][0];return"transparent"===i.borderLeftColor&&(e-=a.BORDER_STYLE.BORDER_LEFT),"transparent"===i.borderTopColor&&(e-=a.BORDER_STYLE.BORDER_TOP),"transparent"===i.borderRightColor&&(e-=a.BORDER_STYLE.BORDER_RIGHT),"transparent"===i.borderBottomColor&&(e-=a.BORDER_STYLE.BORDER_BOTTOM),e}(this._getProps(this._tableId,this._cellRange))},e.prototype.setBorderColor=function(t,e){var n=this._deltaOpt.buildDelta(),r=this._state.getTextStream().tableStream,i=this._getProps(this._tableId,this._cellRange);i=function(t,e,n){var r=e||"transparent",i=n.length,o=n[0].length;return t===a.BORDER_STYLE.BORDER_LEFT?wt(n,(function(t,e,n){0===e&&(n.borderLeftColor=r)})):t===a.BORDER_STYLE.BORDER_TOP?wt(n,(function(t,e,n){0===t&&(n.borderTopColor=r)})):t===a.BORDER_STYLE.BORDER_RIGHT?wt(n,(function(t,e,n){e===o-1&&(n.borderRightColor=r)})):t===a.BORDER_STYLE.BORDER_BOTTOM?wt(n,(function(t,e,n){t===i-1&&(n.borderBottomColor=r)})):t===a.BORDER_STYLE.BORDER_OUTER?wt(n,(function(t,e,n){0===t&&(n.borderTopColor=r),t===i-1&&(n.borderBottomColor=r),0===e&&(n.borderLeftColor=r),e===o-1&&(n.borderRightColor=r)})):t===a.BORDER_STYLE.BORDER_INNER_ALL?wt(n,(function(t,e,n){0!==t&&(n.borderTopColor=r),t!==i-1&&(n.borderBottomColor=r),0!==e&&(n.borderLeftColor=r),e!==o-1&&(n.borderRightColor=r)})):t===a.BORDER_STYLE.BORDER_INNER_HOR?wt(n,(function(t,e,n){0!==t&&(n.borderTopColor=r),t!==i-1&&(n.borderBottomColor=r)})):t===a.BORDER_STYLE.BORDER_INNER_VER?wt(n,(function(t,e,n){0!==e&&(n.borderLeftColor=r),e!==o-1&&(n.borderRightColor=r)})):t===a.BORDER_STYLE.BORDER_ALL?wt(n,(function(t,e,n){n.borderLeftColor=r,n.borderTopColor=r,n.borderRightColor=r,n.borderBottomColor=r})):t===a.BORDER_STYLE.BORDER_NONE&&wt(n,(function(t,e,n){n.borderLeftColor="transparent",n.borderTopColor="transparent",n.borderRightColor="transparent",n.borderBottomColor="transparent"})),n}(t,e,i),n.setTableCellProperty(this._tableProp,this._cellRange,i),t!==a.BORDER_STYLE.BORDER_INNER_HOR&&t!==a.BORDER_STYLE.BORDER_INNER_VER&&t!==a.BORDER_STYLE.BORDER_INNER_ALL&&Et(n,r,this._tableId,this._cellRange,i),n.moveTo(this._deltaOpt.originRange),n.msg=xt(Ct.SetBorderColor,this._tableId,JSON.stringify(this.cellRange)),this._state.applyDelta(n)},e.prototype.clearContent=function(){var t=this;if(!this._state||!this._tableId)return!1;var e=this._deltaOpt.buildDelta(),n=this._state.getTextStream().tableStream;return Object(a.cellRangeEach)(this._cellRange,!0,(function(r,i){var o=n.getTableCellInfo(t._tableId,r,i);return o&&o.range.length()>1&&e.deleteText(a.GCPRange.inset(o.range,1)),!0})),e.moveTo(new a.GCPRange(this._deltaOpt.originRange.begin()+1,0)),e.msg=xt(Ct.ClearContent,this._tableId,JSON.stringify(this.cellRange)),this._state.applyDelta(e),!0},e.prototype.getRowCount=function(){if(this._state&&this._tableId&&this._deltaOpt){var t=this._state.getTextStream().tableStream,e=t.getTableInfoFromGcp(this._deltaOpt.originRange.end());if(e)return t.getTableRowCountFromRange(e.range)}return 0},e.prototype.getColCount=function(){if(this._state&&this._tableId&&this._deltaOpt){var t=this._state.getTextStream().tableStream,e=t.getTableRowInfo(this._tableId,0);if(e)return t.getTableCellCountFromRange(e.range)}return 0},e.prototype.getMergeCellRanges=function(){if(this._state&&this._tableId&&this._deltaOpt){var t=this._state.getTextStream().tableStream.getMergeCellRanges(this._tableId);if(t)return t}return null},e}(tt),Nt=function(){function t(t,e,n,r,i,o){this._toRowCount=0,this._toColCount=0,this._row=0,this._col=0,this._reusedCellBreak=new a.TableCellBreakSpan,this._reusedCellStart=new a.TableCellStartSpan,this._reusedCellProp=new a.TableCellProperty,this._reusedRowBreak=new a.TableRowBreakSpan,this._reusedRowStart=new a.TableRowStartSpan,this._reusedRowProp=new a.TableRowProperty,this._delta=a.DeltaOption.createLocalDeltaOption(a.GCPRange.emptyRange(),!0,!0).buildDelta(),this._state=t,this._row=n,this._col=r,this._toRowCount=i,this._toColCount=o,this._tableId=e,this._reusedCellProp.tableDepth=1,this._reusedRowProp.tableDepth=1}return t.prototype.apply=function(){var t=this._state.getTextStream().tableStream,e=t.getTableCellInfo(this._tableId,this._row,this._col);if(!e)return!1;if(!this.canSplit(e,this._toRowCount,this._toColCount))return!1;var n=t.getTableFullInfoFromGcp(e.range.begin());if(!n)return!1;this.unMergeCell(n,e);var r=this.insertCells(t,n,e);return this.modifyTableProp(t,n,e),this._delta.moveTo(new a.GCPRange(e.range.begin()+r+1,0)),this._delta.msg="split table:"+this._tableId+", row:"+this._row+", col:"+this._col+", toRow:"+this._toRowCount+", toCol:"+this._toColCount,this._state.applyDelta(this._delta),!0},t.prototype.unMergeCell=function(t,e){var n=e.property,r=n.rowSpan,i=n.colSpan;if(1!==r||1!==i){var o={from:new a.TableCellCoords(this._row,this._col),to:new a.TableCellCoords(this._row+r-1,this._col+i-1)};this._delta.unMergeCell(t.tableProp,o)}},t.prototype.insertCells=function(t,e,n){var r=n.property.rowSpan;return this.insertCellsForRow(t,e,n,this._row+r,e.rowCount-1),this.insertCellsMiddle(t,e,n),this.insertCellsForRow(t,e,n,0,this._row-1)},t.prototype.fixMergeForColAdd=function(t,e,n,r,i){var o=this,s=n.property.colSpan,l=(this._toColCount-s)/s;t.getMergeCellRanges(this._tableId).forEach((function(t){if((t.from.row!==o._row||t.from.col!==o._col)&&t.from.row>=r&&t.from.row<=i){var n=a.IntervalUtil.intersectionLength({start:t.from.col,end:t.to.col},{start:o._col,end:o._col+s-1})*l,p=Math.max(0,Math.min(t.from.col-o._col,t.to.col-t.from.col+1))*l;n>0&&o._delta.mergeCell(e.tableProp,{from:new a.TableCellCoords(t.from.row,t.from.col+p),to:new a.TableCellCoords(t.to.row,t.to.col+n+p)})}}))},t.prototype.insertCellsForRow=function(t,e,n,r,i){var o=0,l=n.property.colSpan,p=this._toColCount-l;if(p>0){for(var c=p/l,h=i;h>=r;h--)for(var u=this._col+l-1;u>=this._col;u--){var g=t.getTableCellInfo(this._tableId,h,u);if(!g)return s.Logger.error("cellinfo is null."),0;for(var d=0;d<c;d++)this._delta.insertTableCellPara(g.range.end(),this._reusedCellBreak,this._reusedCellProp),this._delta.insertTableCellStart(g.range.end(),this._reusedCellStart),o+=2;1===g.property.colSpan&&1===g.property.rowSpan&&this._delta.mergeCell(e.tableProp,{from:new a.TableCellCoords(h,u),to:new a.TableCellCoords(h,u+c)})}this.fixMergeForColAdd(t,e,n,r,i)}return o},t.prototype.fixMergeForRowAdd=function(t,e,n){var r=this,i=n.property,o=i.rowSpan,s=i.colSpan,l=this._toRowCount-o,p=this._toColCount-s;if(!(l<0)){var c=l/o;t.getMergeCellRanges(this._tableId).forEach((function(t){if(t.from.row!==r._row||t.from.col!==r._col){var n=a.IntervalUtil.intersectionLength({start:t.from.row,end:t.to.row},{start:r._row,end:r._row+o-1})*c;if(n>0){var i=Math.max(0,Math.min(t.from.row-r._row,t.to.row-t.from.row+1))*c;r._delta.mergeCell(e.tableProp,{from:new a.TableCellCoords(t.from.row+i,t.from.col<r._col?t.from.col:t.from.col+p),to:new a.TableCellCoords(t.to.row+n+i,t.to.col<r._col?t.to.col:t.to.col+p)})}}}))}},t.prototype.insertCellsMiddle=function(t,e,n){for(var r=n.property,i=r.rowSpan,o=r.colSpan,s=this._toRowCount-i,l=Math.max(this._toColCount-o,0),p=l+e.colCount,c=s/i,h=this._row+i-1;h>=this._row;h--){var u=t.getTableRowInfo(this._tableId,h);if(!u)return!1;if(s>0)for(var g=new a.TableRowStartSpan,d=0;d<c;d++){this._delta.insertTableRowPara(u.range.end()-1,this._reusedRowBreak,this._reusedRowProp);for(var f=Math.max(o/this._toColCount,1),y=p-1;y>=0;y--)if(f>1&&y>=this._col&&y<=this._col+o-1){var T=this._reusedCellProp.clone();T.colSpan=(y-this._col)%f==0?f:-1,this._delta.insertTableCellPara(u.range.end(),this._reusedCellBreak,T),this._delta.insertTableCellStart(u.range.end(),this._reusedCellStart)}else this._delta.insertTableCellPara(u.range.end(),this._reusedCellBreak,this._reusedCellProp),this._delta.insertTableCellStart(u.range.end(),this._reusedCellStart);this._delta.insertTableRowStart(u.range.end(),g)}if(this.fixHeart(t,e,n,h),s>0)for(y=0;y<p;y++)if(!(y>=this._col&&y<=this._col+Math.max(this._toColCount,o)-1)){var m=t.getTableCellInfo(this._tableId,h,y<this._col?y:y-l);m&&m.property&&1===m.property.rowSpan&&1===m.property.colSpan&&this._delta.mergeCell(e.tableProp,{from:new a.TableCellCoords(h,y),to:new a.TableCellCoords(h+c,y)})}}return this.fixMergeForRowAdd(t,e,n),!0},t.prototype.fixHeart=function(t,e,n,r){var i=n.property,o=i.rowSpan,l=i.colSpan,p=this._toColCount-l;if(p>0){var c=p/l,h=Math.max(1,o/this._toRowCount),u=this._reusedCellProp;h>1&&((r-this._row)%h==0?(u=u.clone()).rowSpan=h:(u=u.clone()).rowSpan=-1);for(var g=this._col+l-1;g>=this._col;g--){var d=t.getTableCellInfo(this._tableId,r,g);if(!d)return s.Logger.error("cellinfo is null."),!1;h>1&&(r-this._row)%h==0&&this._delta.mergeCell(e.tableProp,{from:new a.TableCellCoords(r,g),to:new a.TableCellCoords(r+h-1,g)});for(var f=0;f<c;f++)this._delta.insertTableCellPara(d.range.end(),this._reusedCellBreak,u),this._delta.insertTableCellStart(d.range.end(),this._reusedCellStart)}}else if(p<0){h=Math.max(1,o/this._toRowCount);var y=l/this._toColCount;if((h>1||y>1)&&(r-this._row)%h==0)for(g=this._col;g<=this._col+l-1;g+=y)this._delta.mergeCell(e.tableProp,{from:new a.TableCellCoords(r,g),to:new a.TableCellCoords(r+h-1,g+y-1)})}return!0},t.prototype.modifyTableProp=function(t,e,n){var r=this,i=n.property,o=i.rowSpan,a=i.colSpan,l=this._toRowCount-o,p=this._toColCount-a,c=e.tableProp;if(l>0)for(var h=l/o,u=this._row+o-1;u>=this._row;u--)this._delta.createRow({tableProp:c},u+1,h);if(p>0){for(var g=e.tableProp.colWidths,d=p/a,f=this._col+a-1;f>=this._col;f--){var y=g[f];this._delta.createCol({tableProp:c},f+1,d),g.splice.apply(g,$([f,0],new Array(d).fill(y)))}var T=Ut.getTableContentWidth(this._state,e.tableRange),m=g.reduce((function(t,e){return t+e||0}),0);g.map((function(t){return(t||0)/m*T})).forEach((function(t,e){var n=Math.floor(Object(s.twipsToPx)(t));r._delta.setColWidth({tableProp:c},e,Object(s.pxToTwips)(n))}))}},t.prototype.canSplit=function(t,e,n){var r=t.property.rowSpan>1||t.property.colSpan>1,i=t.property,o=i.rowSpan,a=i.colSpan;return!r||!(1!==e&&e%o!=0&&o%e!=0||1!==n&&n%a!=0&&a%n!=0)},t}(),Bt={description:"CellsRangeFix",check:function(t,e){var n=t.getTableInfo(e);if(!n)return!0;var r=t.createTableCellIter(n.range),i=0;do{var o=r.getRange();if(!(r.getProperty(!0)instanceof a.TableRowBreakCell||i===o.begin()))return!1;i=o.end()}while(r.next());return!0},fixDelta:function(t,e){var n=a.DeltaOption.createLocalDeltaOption(a.GCPRange.emptyRange(),!1,!0).buildDelta(),r=t.getTableInfo(e);if(!r)return null;var i=t.createTableCellIter(r.range),o=0,s=0;do{var l=i.getRange();i.getProperty(!0)instanceof a.TableRowBreakCell||o===l.begin()?o=l.end():l.begin()>o?(n.deleteText(new a.GCPRange(o-s,l.begin()-o)),s+=l.begin()-o,o=l.end()):l.begin()===o-1&&(n.insertTableCellStart(o-s,new a.TableCellStartSpan),s-=1,o=l.end())}while(i.next());return n}},Mt={description:"StructFix",check:function(t,e){var n=t.getTableInfo(e);if(!n)return!0;var r=t.createTableCellIter(n.range,!0),i=t.createTableRowIter(n.range),o=0,a=0;do{o+=1}while(r.next());do{a+=1}while(i.next());return 0===o&&0===a||0!==o&&0!==a&&o%a==0||(s.Logger.error("table check structure failed.cell:"+e+", "+o+", row:"+a),!1)},fixDelta:function(t,e){var n=t.getTableInfo(e);if(!n)return null;var r=t.createTableRowIter(n.range),i=0;do{var o=t.createTableCellIter(r.getRange(),!0),s=0;do{s+=1}while(o.next());i=Math.max(i,s)}while(r.next());var l=new a.TableCellStartSpan,p=new a.TableCellBreakSpan,c=new a.TableCellProperty;c.tableDepth=1;var h=a.DeltaOption.createLocalDeltaOption(a.GCPRange.emptyRange(),!1,!0).buildDelta();r.seek(n.range.begin());var u=0;do{var g=r.getRange();if(g.isEmpty())break;o=t.createTableCellIter(r.getRange(),!0),s=0;do{s+=1}while(o.next());for(var d=s;d<i;d++)h.insertTableCellStart(g.end()-1+u,l),h.insertTableCellPara(g.end()+u,p,c),u+=2}while(r.next());return h}},Ft={description:"TableRangeFix",check:function(t,e){var n={},r=t.createTableIter();do{var i=r.getRange(),o=r.getProperty(!0);if(i.isEmpty()||!o)break;n[o.tableId]=i}while(r.next());return Object.keys(n).every((function(t){return t===e||!n[e].intersect(n[t],!0)}))},fixDelta:function(){return a.DeltaOption.createLocalDeltaOption(a.GCPRange.emptyRange(),!1,!0).buildDelta()}},kt=function(){function t(){}return t.fixTable=function(t,e){var n=t.getTextStream().tableStream;[Mt,Bt,Ft].forEach((function(r){if(!r.check(n,e)){var i=r.fixDelta(n,e);i&&(i.msg="tablefix_"+r.description+"_"+e,t.applyDelta(i))}}))},t.checkTable=function(t,e){var n=t.getTextStream().tableStream;return![Mt,Bt,Ft].some((function(t){return!t.check(n,e)}))},t}(),Ut=function(t){function e(e,n,r){var i=t.call(this,e,n)||this;return i._tableProp=r,i}return z(e,t),e.createStateTable=function(t,n,r){return new e(t,n,r)},Object.defineProperty(e.prototype,"range",{get:function(){return this._deltaOpt?this._deltaOpt.originRange:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_tableId",{get:function(){return this._tableProp.tableId},enumerable:!0,configurable:!0}),e.prototype.getRows=function(t,e){void 0===t&&(t=0),void 0===e&&(e=Number.MAX_SAFE_INTEGER);var n=this.getTableInfo(),r=[];if(n&&t<n.rowCount)for(var i=Math.min(n.rowCount-t,e),o=t;o<t+i;o++)r.push(vt.createStateRow(this._state,this._tableProp,o));return mt.createStateRows(this._state,this._deltaOpt,this._tableId,r)},e.prototype.getRow=function(t){return this._tableId&&this._state?vt.createStateRow(this._state,this._tableProp,t):null},e.prototype.getCol=function(t){return this._tableId&&this._state?bt.createStateCol(this._state,this._tableProp,t):null},e.prototype.getCols=function(t,e){void 0===t&&(t=0),void 0===e&&(e=Number.MAX_SAFE_INTEGER);var n=this.getTableInfo(),r=[];if(n&&t<n.colCount&&this._state)for(var i=Math.min(n.colCount-t,e),o=t;o<t+i;o++)r.push(bt.createStateCol(this._state,this._tableProp,o));return _t.createStateCols(this._state,this._deltaOpt,this._tableId,r)},e.prototype.getCell=function(t,e){var n=this.getRow(t);return n&&n.getCell(e)||null},e.prototype.getTableId=function(){return this._tableId},e.prototype.getTableInfo=function(){if(this._state&&this._deltaOpt){var t=this._state.getTextStream().tableStream.getTableFullInfoFromGcp(this._deltaOpt.originRange.begin());if(t)return t}return null},e.prototype.insertRow=function(t,e,n,r){if(this._state&&this._deltaOpt&&this._tableId){var i=this._tableId,o=this._state.getTextStream(),s=o.tableStream,l=new a.Delta(this._deltaOpt);l.createRow({tableProp:this._tableProp},t,e);var p=function(t,e,n){var r=t.tableStream.getTableRowInfo(e,Math.max(0,n));if(!r)throw new Error("insertCol failed, cell is nul, id: "+e);var i=[],o=[],s=[];if(r){var l=t.tableStream.createTableCellIter(r.range,!0);do{var p=l.getContentRange(),c=t.createDataIterator(p),h=c.getSpanProp(),u=new a.TableCellBreakSpan(h?h.getPropBag():void 0);u.delete(a.SpanPropKey.link),u.delete(a.CommentSpanPropKey.comments),i.push(u);var g=new a.ParaProperty(c.getParaProp()||void 0);g.tableDepth=1,At(g);var d=l.getProperty()||new a.TableCellProperty;d.rowSpan=1,d.colSpan=1,d.tableDepth=1,o.push(g),s.push(d)}while(l.next())}return{cellBreakSpans:i,cellParaProperties:o,cellProps:s}}(o,i,n),c=p.cellBreakSpans,h=p.cellParaProperties,u=p.cellProps,g=s.getTableRowInfo(i,Math.max(0,n));if(!g)throw new Error("insertCol failed, cell is nul, id: "+i);var d=s.getTableCellCountFromRange(g.range),f=0===t?null:s.getTableRowInfo(i,t-1),y=f?f.range.end():this._deltaOpt.originRange.begin(),T=new a.GCPRange(y,1),m=new a.TableRowBreakSpan,S=new a.TableRowStartSpan,v=new a.TableRowProperty,b=new a.TableCellStartSpan;v.tableDepth=1;for(var _=t+e-1;_>=t;_--){l.insertTableRowPara(Math.min(y,this._deltaOpt.originRange.end()-1),m,v);for(var P=d-1;P>=0;P--)l.insertTableCellPara(y,c[P],u[P]),l.setParagraphProperty(T,h[P]),l.insertTableCellStart(y,b);l.insertTableRowStart(y,S)}return function(t,e,n,r,i,o,s){var l=t.getMergeCellRanges(e),p=[];l.forEach((function(t){var e=t.from,n=e.row,o=e.col,l=t.to,c=l.row,h=l.col;if(n<r&&c>=r){var u={from:t.from.clone(),to:t.to.clone()};return u.to.row+=i,void p.push(u)}if(s===a.InsertTableDirection.above&&n===r||s===a.InsertTableDirection.below&&c===r-1)for(var g=0;g<i;g++){var d={from:new a.TableCellCoords(r+g,o),to:new a.TableCellCoords(r+g,h)};p.push(d)}})),p.forEach((function(t){return o.mergeCell(n,t)}))}(s,i,this._tableProp,t,e,l,r),l.moveTo(new a.GCPRange(y+2,0)),l.msg=xt(Ct.InsertRow,i),this._state.applyDelta(l),this.getRows(t,e)}return null},e.prototype.insertCol=function(t,e,n,r){if(this._state&&this._deltaOpt&&this._tableId){var i=this._tableId,o=this._state.getTextStream().tableStream,l=new a.Delta(this._deltaOpt),p=o.getTableInfo(i);if(!p)throw new Error("tableProp not found, id: "+i);for(var c=o.getTableRowCountFromRange(p.range),h=new a.TableCellStartSpan,u=c-1;u>=0;u--){var g=o.getTableCellInfo(this._tableId,u,n);if(!g)throw s.Logger.error("insertCol failed, cell is null"),new Error("insertCol failed, cell is nul, id: "+i);var d=this._state.getTextStream().createDataIterator(a.GCPRange.insetBoth(g.range,1,0)),f=d.getSpanProp(),y=new a.TableCellBreakSpan(f?f.getPropBag():void 0);y.delete(a.SpanPropKey.link),y.delete(a.CommentSpanPropKey.comments);var T=new a.ParaProperty(d.getParaProp()||void 0);At(T),T.tableDepth=1;var m=g.property?g.property.clone():new a.TableCellProperty;m.rowSpan=1,m.colSpan=1,m.tableDepth=1;for(var S=Lt(o,this._tableId,u,t),v=new a.GCPRange(S,1),b=0;b<e;b++)l.insertTableCellPara(S,y,m),l.setParagraphProperty(v,T),l.insertTableCellStart(S,h)}(function(t,e,n,r,i,o,a){a.createCol({tableProp:n},r,o);var l=Ut.getTableContentWidth(t,e),p=n.colWidths,c=p[i];p.splice.apply(p,$([r,0],new Array(o).fill(c)));var h,u=p.reduce((function(t,e){return t+e||0}),0);(h=p,1,Math.max.apply(Math,$(h))-Math.min.apply(Math,$(h))<1?p.map((function(t){return(t||0)/u*l})):p).forEach((function(t,e){var r=Math.floor(Object(s.twipsToPx)(t));a.setColWidth({tableProp:n},e,Object(s.pxToTwips)(r))}))})(this._state,p.range,p.property,t,n,e,l),function(t,e,n,r,i,o,s){var l=t.getMergeCellRanges(e),p=[];l.forEach((function(t){var e=t.from,n=e.row,o=e.col,l=t.to,c=l.row,h=l.col;if(h>=r&&o<r){var u={from:t.from.clone(),to:t.to.clone()};u.to.col+=i,p.push(u)}if(s===a.InsertTableDirection.left&&o===r||s===a.InsertTableDirection.right&&h===r-1)for(var g=0;g<i;g++){var d={from:new a.TableCellCoords(n,r+g),to:new a.TableCellCoords(c,r+g)};p.push(d)}})),p.forEach((function(t){return o.mergeCell(n,t)}))}(o,i,this._tableProp,t,e,l,r);var _=o.getTableCellInfo(i,0,t);return _&&l.moveTo(new a.GCPRange(_.range.begin()+1,0)),l.msg=xt(Ct.InsertCol,i),this._state.applyDelta(l),this.getCols(t,e)}return null},e.getTableContentWidth=function(t,e){var n=t.followSectProp(e.begin());return n.pageWidth-n.marginLeft-n.marginRight-a.Defaults.tableCell.borderLeft.borderWidth},e.prototype.removeRow=function(t,e){if(this._state&&this._deltaOpt&&this._tableId){var n=this.getTableInfo();if(!n)return;var r=this._state.getTextStream().tableStream,i=this._tableId,o=new a.Delta(this._deltaOpt);!function(t,e,n,r,i,o){var s=t.getMergeCellRanges(n),l={start:r,end:r+i-1};s.forEach((function(t){a.IntervalUtil.intersectionLength(l,{start:t.from.row,end:t.to.row})>=1&&o.unMergeCell(e,t)}))}(r,this._tableProp,i,t,e,o);var l={from:new a.TableCellCoords(t,0),to:new a.TableCellCoords(t+e-1,n.colCount-1)},p=r.getTableRowInfo(this._tableId,l.from.row),c=r.getTableRowInfo(this._tableId,l.to.row);if(!p||!c)return void s.Logger.error("removeRow get cell failed");var h=c.range.end()===n.tableRange.end()?-1:0;o.deleteText(new a.GCPRange(p.range.begin()+h,c.range.end()-p.range.begin())),function(t,e,n,r,i,o){var s=t.getMergeCellRanges(n),l={start:r,end:r+i-1};s.forEach((function(t){var n=a.IntervalUtil.intersectionLength(l,{start:t.from.row,end:t.to.row});if(n>=1&&t.from.row<r){var i={from:t.from.clone(),to:t.to.clone()};i.to.row-=n,o.mergeCell(e,i)}}))}(r,this._tableProp,i,t,e,o),o.removeRow({tableProp:this._tableProp},t,e);var u=Math.max(0,t-1),g=this.getCell(u,0);if(g){var d=g.mainCell();d&&d.range&&o.moveTo(new a.GCPRange(d.range.begin()+1,0))}o.msg=xt(Ct.DelRow,i),this._state.applyDelta(o)}},e.prototype.removeCol=function(t,e){var n=this;if(this._state&&this._deltaOpt&&this._tableId){var r=this.getTableInfo();if(!r)return;var i=this._tableId,o=this._state.getTextStream().tableStream,l=new a.Delta(this._deltaOpt);!function(t,e,n,r,i,o){var s=t.getMergeCellRanges(n),l={start:r,end:r+i-1};s.forEach((function(t){a.IntervalUtil.intersectionLength(l,{start:t.from.col,end:t.to.col})>=1&&o.unMergeCell(e,t)}))}(o,this._tableProp,i,t,e,l);var p={from:new a.TableCellCoords(0,t),to:new a.TableCellCoords(r.rowCount-1,t+e-1)};Object(a.cellRangeEach)(p,!0,(function(t,e){var r=o.getTableCellInfo(n._tableId,t,e);return r?l.deleteText(r.range):s.Logger.error("cellinfo is null"),!0})),function(t,e,n,r,i,o){var s=t.getMergeCellRanges(n),l={start:r,end:r+i-1};s.forEach((function(t){var n=a.IntervalUtil.intersectionLength(l,{start:t.from.col,end:t.to.col});if(n>=1&&t.from.col<r){var i={from:t.from.clone(),to:t.to.clone()};i.to.col-=n,o.mergeCell(e,i)}}))}(o,this._tableProp,i,t,e,l),l.removeCol({tableProp:this._tableProp},t,e);var c=Math.max(0,t-1),h=this.getCell(0,c);if(h){var u=h.mainCell();u&&u.range&&l.moveTo(new a.GCPRange(u.range.begin()+1,0))}l.msg=xt(Ct.DelCol,i),this._state.applyDelta(l)}},e.prototype.canMerge=function(t){return!!(this._state&&this._deltaOpt&&this._tableId)&&(1!==Object(a.countRows)(t)||1!==Object(a.countCols)(t))&&this._state.getTextStream().tableStream.getMergeCellRanges(this._tableId).reduce((function(e,n){return e&&!Object(a.isCellRangeJoin)(n,t)}),!0)},e.prototype.isSingleRange=function(t){return!!(this._state&&this._deltaOpt&&this._tableId)&&this._state.getTextStream().tableStream.isSingleRange(this._tableId,t)},e.prototype.selectAll=function(){var t=this.getTableInfo();return!!t&&this.selectRange({from:new a.TableCellCoords(0,0),to:new a.TableCellCoords(t.rowCount-1,t.colCount-1)})},e.prototype.selectRange=function(t){if(!this._state||!this._tableId)return!1;var e=this._state.getTextStream().tableStream,n=e.getTableCellInfo(this._tableId,t.from.row,t.from.col),r=e.getTableCellInfo(this._tableId,t.to.row,t.to.col);return!(!n||!r||(this._state.setRangeTo(new a.GCPRange(n.range.begin(),r.range.end()-n.range.begin()),{scrollToView:a.ScrollViewType.None}),0))},e.prototype.moveTo=function(t){if(!this._state||!this._tableId||!this._deltaOpt)return!1;var e=a.DeltaOption.createLocalDeltaOption(a.GCPRange.emptyRange(),!0,!0).buildDelta(),n=a.GCPRange.inset(this._deltaOpt.originRange,-1),r=this._state.followParaProp(t),i=a.DeltaOption.createLocalDeltaOption(a.GCPRange.emptyRange(),!0,!0).buildDelta();a.DataCollector.collectDataToDelta(this._state.getRWTextStream(),i,n);var o=function(){e.insertParagraph(t,r.paraBreakSpan,r.paraProp),i.operations.forEach((function(n){var r=a.OperationUtil.moveOffset(n,t+1);e.addOperation(r||n)}))};return n.begin()>t?(e.deleteText(n),o(),e.moveTo(new a.GCPRange(t+4,0))):(o(),e.deleteText(n),e.moveTo(new a.GCPRange(t-n.length()+4,0))),e.msg=xt(Ct.MoveTable,this.getTableId()),this._state.applyDelta(e),!0},e.prototype.remove=function(){if(this._state&&this._deltaOpt){var t=this._deltaOpt.buildDelta();t.deleteText(a.GCPRange.inset(this._deltaOpt.originRange,-1)),t.msg=xt(Ct.DelTable,this.getTableId()),this._state.applyDelta(t)}},e.prototype.setCaretNextCell=function(t,e){if(!this._state||!this._tableId||!this._deltaOpt)return!1;if(!this.getTableInfo())return!1;var n=t,r=new a.GCPRange(n,this._deltaOpt.originRange.end()-n),i=this._state.getTextStream().tableStream.getValidCellInfoAtIndex(r,1);return i&&!i.range.isEmpty()?(this._state.setRangeTo(new a.GCPRange(i.range.begin()+1,0)),!0):!!e&&(this._state.setRangeTo(new a.GCPRange(this._deltaOpt.originRange.begin()+2,0)),!0)},e.prototype.setCaretPrevCell=function(t,e){if(!this._state||!this._tableId||!this._deltaOpt)return!1;var n=this._state.getTextStream().tableStream;if(!this.getTableInfo())return!1;var r=t,i=new a.GCPRange(this._deltaOpt.originRange.begin(),r-this._deltaOpt.originRange.begin()),o=n.getValidCellInfoInverseAtIndex(i,1);return o&&!o.range.isEmpty()?(this._state.setRangeTo(new a.GCPRange(o.range.begin()+1,0)),!0):!!e&&(this._state.setRangeTo(new a.GCPRange(this._deltaOpt.originRange.end()-2,0)),!0)},e.prototype.getLastValidCell=function(){var t=this.getTableInfo();if(!t)return null;var e=this.getCell(t.rowCount-1,t.colCount-1);return e?e.mainCell():null},e.prototype.getCellRange=function(t,e){var n=this.getTableId();if(n&&this._state){var r=this._state.getTextStream().tableStream.getTableCellInfo(n,t,e);if(r)return r.range}return null},e.prototype.getTableRangeService=function(t){var e=this.getTableId();if(e&&this._state){var n=this._state.getTextStream().tableStream,r=n.getTableInfo(e),i=n.getTableCellInfo(e,t.from.row,t.from.col),o=n.getTableCellInfo(e,t.to.row,t.to.col);if(i&&o&&r){var s=a.DeltaOption.createLocalDeltaOption(new a.GCPRange(i.range.begin(),o.range.end()-i.range.begin()));return Dt.createStateRange(this._state,s,r.property,t)}}return null},e.prototype.split=function(t,e,n,r){return!!(this._state&&this._tableId&&this._deltaOpt)&&new Nt(this._state,this._tableId,t,e,n,r).apply()},e.prototype.getMergesInfo=function(){return this._state?this._state.getTextStream().tableStream.getMergeCellRanges(this._tableId):[]},e.prototype.getTableContentWidth=function(){return this._state&&this._deltaOpt?e.getTableContentWidth(this._state,this._deltaOpt.originRange):0},e.prototype.setPadding=function(t,e){if(this._state){var n=new a.Delta(a.DeltaOption.createLocalDeltaOption(a.GCPRange.emptyRange(),!1,!0)),r={tableProp:this._tableProp};t&&n.setTablePaddingLeft(r,t),e&&n.setTablePaddingRight(r,e),this._state.applyDelta(n)}},e.prototype.checkData=function(){return!this._state||kt.checkTable(this._state,this._tableId)},e.prototype.fixTable=function(){this._state&&kt.fixTable(this._state,this._tableId)},e}(tt),Kt=999,Wt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return z(e,t),e.createStateTables=function(t,n){return new e(t,n)},e.prototype.getItemForTableId=function(t){var e,n;try{for(var r=q(this),i=r.next();!i.done;i=r.next()){var o=i.value;if(o.getTableId()===t)return o}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}return null},e.prototype.getItemForPos=function(t){var e,n;try{for(var r=q(this),i=r.next();!i.done;i=r.next()){var o=i.value,a=o.range;if(a&&a.begin()<=t&&a.end()>t)return o}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}return null},e.prototype.add=function(t,e,n){if(this._state&&this._deltaOpt){var r=this._state.selection.gcpRange,i=function(t,e,n){var r=t.followSectProp(e.begin()),i=Ut.getTableContentWidth(t,e),o=s.StringUtil.generateRandomId(),l=Math.floor(Object(s.twipsToPx)(i/n)),p=new a.TableProperty;return p.colWidths=Array(n).fill(Object(s.pxToTwips)(l)),p.tableId=o,p.subId=a.DOC_ID,p.paddingLeft=r.marginLeft,p.paddingRight=r.marginRight,p}(this._state,r,n),o=new a.CoreRange(this._state.dataEngine,t),l=o.fixToValidDeleteRange(t),p=this._deltaOpt.buildDelta();p.moveTo(l),p.deleteText(l);var c=this._state.followParaProp(o.gcpRange.begin()),h=(C=this._state,I=o.gcpRange.begin(),{paraProp:C.currentParaProp(I),paraBreakSpan:new a.ParaBreakSpan(C.followSpanProp(I))});p.insertParagraph(p.currentRange().end(),h.paraBreakSpan,h.paraProp);var u=new a.TableRowBreakSpan,g=new a.TableRowStartSpan,d=new a.TableRowProperty;d.tableDepth=1;var f=function(t,e){return function(t,e,n){var r=t.followParaProp(e);return n.forEach((function(t){r.paraProp.delete(t)})),r.paraBreakSpan.delete(a.SpanPropKey.link),r.paraBreakSpan.delete(a.CommentSpanPropKey.comments),r}(t,e,[a.ParaPropKey.styleName,a.ParaPropKey.outlineLevel,a.ParaPropKey.specialIndent,a.ParaPropKey.leftIndent,a.ParaPropKey.characterUnitLeftIndent,a.ParaPropKey.characterUnitSpecialIndent,a.ParaPropKey.rightIndent,a.ParaPropKey.characterUnitRightIndent])}(this._state,o.gcpRange.begin()),y=0===l.length()?Rt(f.paraProp,f.paraBreakSpan):Rt(),T=y.tableCellProp,m=y.cellBreakSpan,S=new a.TableCellStartSpan,v=p.currentRange().end();p.startCreateTable(p.currentRange().end(),i);for(var b=0;b<e;b++){p.insertTableRowStart(p.currentRange().end(),g);for(var _=0;_<n;_++)p.insertTableCellStart(p.currentRange().end(),S),p.insertTableCellPara(p.currentRange().end(),m,T);p.insertTableRowPara(p.currentRange().end(),u,d)}p.endCreateTable(p.currentRange().end(),i),o.isParaEnd(l.end())&&p.setParagraphProperty(new a.GCPRange(p.currentRange().end(),1),c.paraProp,a.TDSetPropMode.Cover),p.moveTo(new a.GCPRange(v+3,0)),p.msg=xt(Ct.AddTable,i.tableId),this._state.applyDelta(p),this._state.cusorSpanProp=null;var P=this._state.getTextStream().tableStream.getTableInfo(i.tableId),R=a.DeltaOption.createLocalDeltaOption(P.range);return Ut.createStateTable(this._state,R,i)}var C,I;return null},e.prototype.createIterator=function(){var t,e,n,r,i,o;return Q(this,(function(s){switch(s.label){case 0:if(!this._state||!this._deltaOpt)return[3,3];t=this._state.dataEngine.getTextStream(),e=this._deltaOpt.originRange,n=t.tableStream.createTableIter(e),s.label=1;case 1:return n.hasNext()?(r=n.getRange(),i=n.getProperty(!0),n.next(),r.isEmpty()||!i?[3,1]:(o=a.DeltaOption.createLocalDeltaOption(r,this._deltaOpt.updateSelection),[4,Ut.createStateTable(this._state,o,i)])):[3,3];case 2:return s.sent(),[3,1];case 3:return[2]}}))},e}(rt),Ht=function(t){function e(e,n,r){var i=t.call(this,e,n)||this;return i._fieldInfo=r,i}return z(e,t),e.createStateField=function(t,n,r){return new e(t,n,r)},e.prototype.getFieldInfo=function(){return this._fieldInfo},e.prototype.getCode=function(){return this._state?this._state.getTextStream().readText(this._fieldInfo.fieldCodeRange.begin(),this._fieldInfo.fieldCodeRange.length()):""},e.prototype.getResult=function(){return this._state?this._state.getTextStream().readText(this._fieldInfo.fieldResultRange.begin(),this._fieldInfo.fieldResultRange.length()):""},e.prototype.getType=function(){var t=this.getCode().trim();if(t.length>0){var e=t.split(" ");if(e.length>0){var n=e[0];for(var r in a.TDFieldType)if(Object.prototype.hasOwnProperty.call(a.TDFieldType,r)&&n===a.TDFieldType[r])return a.TDFieldType[r]}}return a.TDFieldType.fieldEmpty},e.prototype.getNext=function(){if(this._state&&this._deltaOpt){var t=this._state.dataEngine.getFieldEngine();if(t){var n=t.createFieldIter(this._deltaOpt.originRange),r=this.getRange();if(n.seek(r.begin()),n.hasNext()){n.next();var i=t.getFieldInfo(n.getRange().begin());if(i){var o=a.DeltaOption.createLocalDeltaOption(n.getRange(),this._deltaOpt.updateSelection);return e.createStateField(this._state,o,i)}}}}},e.prototype.getPrev=function(){if(this._state&&this._deltaOpt){var t=this._state.dataEngine.getFieldEngine();if(t){var n=t.createFieldIter(this._deltaOpt.originRange),r=this.getRange();if(n.seek(r.begin()),n.hasPrev()){n.prev();var i=t.getFieldInfo(n.getRange().begin());if(i){var o=a.DeltaOption.createLocalDeltaOption(n.getRange(),this._deltaOpt.updateSelection);return e.createStateField(this._state,o,i)}}}}},e}(tt),Gt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return z(e,t),e.createStateFields=function(t,n){return new e(t,n)},e.prototype.add=function(t,e,n,r){var i=e!==a.TDFieldType.fieldEmpty?" "+e+" ":" ";i+=n,r&&(i+=" \\* MERGEFORMAT"),i+=" ",t.insertField(i,"xxx",{})},e.prototype.createIterator=function(){var t,e,n,r;return Q(this,(function(i){switch(i.label){case 0:if(!this._state||!this._deltaOpt)return[3,4];if(!(t=this._state.dataEngine.getFieldEngine()))return[3,4];e=t.createFieldIter(this._deltaOpt.originRange),i.label=1;case 1:return e.hasNext()?(n=t.getFieldInfo(e.getRange().begin()),e.next(),n?((r=this._deltaOpt.copy()).originRange=n.fieldRange.clone(),[4,Ht.createStateField(this._state,r,n)]):[3,3]):[3,4];case 2:i.sent(),i.label=3;case 3:return[3,1];case 4:return[2]}}))},e}(rt),jt=function(){function t(t,e,n,r){this._state=t,this._updateSelection=n,this._coreRange=new a.CoreRange(this._state.dataEngine,e,this._updateSelection,r)}return t.createStateRange=function(e,n,r,i){return void 0===r&&(r=!1),void 0===i&&(i=!0),new t(e,n,r,i)},t.prototype.getFont=function(){return nt.createStateFont(this._state,this._deltaOption())},t.prototype.setFont=function(t){this.getFont().setFont(t)},t.prototype.getSpans=function(){return ot.createStateSpans(this._state,this._deltaOption())},t.prototype.getParagraphFormat=function(){return lt.createStateParagraphFormat(this._state,this._deltaOption())},t.prototype.setParagraphFormat=function(t){this.getParagraphFormat().setFormat(t)},t.prototype.getParagraphs=function(){return ct.createStateParagraphs(this._state,this._deltaOption())},t.prototype.setSectionFormat=function(t){this.getSectionFormat().setSectionFormat(t)},t.prototype.getSectionFormat=function(){return ht.createStateSectionFormat(this._state,this._deltaOption())},t.prototype.getSections=function(){return gt.createStateSections(this._state,this._deltaOption())},t.prototype.getInlineShapes=function(t){return ft.createStateInlineShapes(this._state,this._deltaOption(),t)},t.prototype.getInlinePlugins=function(t){return Tt.createStateInlinePlugins(this._state,this._deltaOption(),t)},t.prototype.getTables=function(){return Wt.createStateTables(this._state,this._deltaOption())},t.prototype.getTableRangeSevice=function(){var t=this._coreRange.tableCellRangeAll,e=t.tableId,n=t.cellRange,r=this._state.getTextStream().tableStream.getTableInfo(e);return Dt.createStateRange(this._state,this._deltaOption(),r.property,n)},t.prototype.getFields=function(){return Gt.createStateFields(this._state,this._deltaOption())},t.prototype.range=function(){return this._coreRange.gcpRange},t.prototype.setRange=function(t,e,n){var r=this._coreRange.setRangeTo(new a.GCPRange(t,e-t),n);return r&&this._updateSelection&&this._state.setRangeTo(this._coreRange.gcpRange,n),r},t.prototype.getStart=function(){return this._coreRange.gcpRange.begin()},t.prototype.setStart=function(t){return this.setRange(t,this._coreRange.gcpRange.end())},t.prototype.getEnd=function(){return this._coreRange.gcpRange.end()},t.prototype.setEnd=function(t){return this.setRange(this._coreRange.gcpRange.begin(),t)},t.prototype.select=function(){this._state.setRangeTo(this._coreRange.gcpRange)},t.prototype.wholeStory=function(){this._state.setRangeTo(this._coreRange.storyValidRange(),{scrollToView:a.ScrollViewType.None})},t.prototype.storyRange=function(){return this._coreRange.storyValidRange()},t.prototype.storyLength=function(){return this._coreRange.storyValidRange().length()},t.prototype.storyType=function(){var t=a.TDStoryType.MainTextStory;switch(this._coreRange.storyInfo.storyProp.storyType){case a.StoryType.MainTextStory:t=a.TDStoryType.MainTextStory;break;case a.StoryType.PrimaryHeaderStory:t=a.TDStoryType.PrimaryHeaderStory;break;case a.StoryType.PrimaryFooterStory:t=a.TDStoryType.PrimaryFooterStory;break;case a.StoryType.TextFrameStory:t=a.TDStoryType.TextFrameStory;break;case a.StoryType.CodeblockStory:t=a.TDStoryType.CodeblockStory}return t},t.prototype.storyId=function(){return this._coreRange.storyInfo.storyProp.storyId},t.prototype.collapse=function(t){void 0===t&&(t=a.TDCollapseDirection.CollapseStart);var e=this._coreRange.gcpRange;switch(t){case a.TDCollapseDirection.CollapseStart:e.len=0;break;case a.TDCollapseDirection.CollapseEnd:e.gcpBegin+=e.length(),e.len=0}this.setRange(e.begin(),e.end())},t.prototype.inRange=function(t){return t.range().contains(this.range())},t.prototype.isEqual=function(e){return e instanceof t&&this===e||e.range().equal(this.range())},t.prototype.getText=function(){return this._state.getTextStream().readText(this.range().begin(),this.range().length())},t.prototype.getPlainText=function(){var t="";if(0===this.range().length())return t;var e=this._state.getTextStream().createSpanIterator(this.range());do{var n=e.getRange(!0);e.getProperty(!0)instanceof a.TextSpan&&(t+=this._state.getTextStream().readText(n.begin(),n.length()))}while(e.next());return t},t.prototype.getTextAndImage=function(){var t=[];if(0===this.range().length())return t;var e=this._state.getTextStream().createSpanIterator(this.range());do{var n=e.getRange(!0),r=e.getProperty(!0);if(r instanceof a.TextSpan&&!(r instanceof a.SpecialSpanBase)){var i=this._state.getTextStream().readText(n.begin(),n.length());t.push({type:"text",value:i})}else r instanceof a.ImageProperty&&t.push({type:"image",value:r.imgSrc})}while(e.next());return t},t.prototype.setText=function(t){var e=this._deltaOption().buildDelta(),n=this._validTypeRange(),r=this._state.getTextStream().createParagraphIterator(n).getRange();(n.equal(r)||n.end()===r.end()&&1===n.length())&&(n.len-=1),this.deleteWithDelta(n,e);var i=this._state.followSpanProp(n.begin());e.insertText(n.begin(),t,i),this._state.applyDelta(e)},t.prototype.insertAfter=function(t){var e=this._coreRange.gcpRange.end();e=this._coreRange.fixToValidRange(new a.GCPRange(e,0)).end();var n=this._deltaOption().buildDelta(),r=this._state.followSpanProp(e);n.insertText(e,t,r),this._state.applyDelta(n)},t.prototype.insertBefore=function(t){var e=this._deltaOption().buildDelta(),n=e.currentRange().begin(),r=this._state.followSpanProp(n);e.insertText(n,t,r),this._state.applyDelta(e)},t.prototype.insertParagraph=function(){var t=this._validTypeRange(),e=t.begin(),n=t.end();this._insertParagraph(e,n,t)},t.prototype.insertParagraphAfter=function(){var t=this._coreRange.gcpRange.end();this._insertParagraph(t,t,a.GCPRange.emptyRange())},t.prototype.insertParagraphBefore=function(){var t=this._coreRange.gcpRange.begin();this._insertParagraph(t,t,a.GCPRange.emptyRange())},t.prototype._insertParagraph=function(t,e,n){var r=this._deltaOption().buildDelta();this.deleteWithDelta(n,r);var i,o=this._state.currentParaProp(t);if(null==o?void 0:o.listId){var s=this._state.getTextStream().createParagraphIterator();s.seek(t);var l=s.getRange(),p=this._state.getTextStream().createSpanIterator();p.seek(l.end()-1),i=new a.ParaBreakSpan(p.getProperty()||new a.TextSpan)}else i=new a.ParaBreakSpan(this._state.followSpanProp(t));var c=this._state.followParaProp(e);r.insertParagraph(t,i,new a.ParaProperty(o));var h=!1;if(this._coreRange.isParaEnd(e))r.setParagraphProperty(new a.GCPRange(t+1,1),c.paraProp,a.TDSetPropMode.Cover),r.moveTo(new a.GCPRange(t+1,0)),h=!0;else if(o.taskState===a.TaskState.Done){var u=new a.ParaProperty(o);u.taskState=a.TaskState.Todo,r.setParagraphProperty(new a.GCPRange(t+1,1),u,a.TDSetPropMode.Cover)}this._state.applyDelta(r),h&&r.globalOpts.updateSelection&&(this._state.cusorSpanProp=c.paraBreakSpan,this._state.cusorSpanProp.delete(a.CommentSpanPropKey.comments),this._state.cusorSpanProp.delete(a.CommentSpanPropKey.quotes),this._state.cusorSpanProp.delete(a.SpanPropKey.delFirst))},t.prototype.insertBreak=function(t){if(t===a.TDBreakType.PageBreak){var e=this._deltaOption().buildDelta(),n=this._validDeleteRange();this.deleteWithDelta(n,e);var r=this._state.followParaProp(n.begin());e.insertParagraph(n.begin(),r.paraBreakSpan,r.paraProp),e.insertText(e.currentRange().end(),a.PlaceholderChar.PageBreak,new a.TextSpan(r.paraBreakSpan)),this._state.applyDelta(e)}},t.prototype.insertImage=function(t,e,n,r){this.getInlineShapes(a.DrawingType.Image).addImage(t,e,n,r)},t.prototype.replaceImage=function(t,e){this.getInlineShapes(a.DrawingType.Image).replaceImage(t,e)},t.prototype.insertSplitline=function(t,e,n){this.getInlineShapes(a.DrawingType.Splitline).addSplitline(t,e,n)},t.prototype.moveSplitline=function(t,e){this.getInlineShapes(a.DrawingType.Splitline).moveSplitline(t,e)},t.prototype.setSplitlineProperties=function(t){this.getInlineShapes(a.DrawingType.Splitline).setSplitlineProperties(t)},t.prototype.clearFormatting=function(){var t=this._coreRange.gcpRange,e=this._state.getTextStream().createParagraphIterator(t).getRange(),n=!1,r=!1;e.contains(t)?t.length()<=0?(r=!0,this._state.cusorSpanProp=null):t.begin()===e.begin()&&t.length()>=e.length()-1?(n=!0,r=!0):n=!0:(n=!0,r=!0);var i=this._deltaOption().buildDelta();if(n&&i.splitValidRange(this._state.getRWTextStream(),(function(t){i.clearSpanProperty(t,a.ClearSpanProps)})),r&&i.splitValidRange(this._state.getRWTextStream(),(function(t){i.clearParaProperty(t,a.ClearParaProps)})),this._coreRange.tableCellRange){var o=this._coreRange.tableCellRange,s=o.tableId,l=o.cellRange,p=this._state.getTextStream().tableStream,c=p.getTableInfo(s);if(!c)return;var h=Object(a.fetchRangeData)(l,(function(t,e){return a.TableCellProperty.default}));i.setTableCellProperty(c.property,l,h,void 0),Et(i,p,s,l,h)}this._state.applyDelta(i),this._state.cusorSpanProp=null},t.prototype.formatBrush=function(t,e){var n=this._deltaOption().buildDelta();t&&n.splitValidRange(this._state.getRWTextStream(),(function(e){n.setParagraphProperty(e,new a.ParaProperty(t),a.TDSetPropMode.Cover)})),e&&n.splitValidRange(this._state.getRWTextStream(),(function(t){n.setSpanProperty(t,new a.TextSpan(e),a.TDSetPropMode.Cover)})),this._state.applyDelta(n)},t.prototype.deleteWithDelta=function(t,e){var n=this._validDeleteRange(t);if(!n.isEmpty()){var r=e||this._deltaOption().buildDelta();this._state.deleteText(n,r),e||this._state.applyDelta(r)}},t.prototype.delete=function(t){this.deleteWithDelta(t)},t.prototype.setLink=function(t,e){var n=this._deltaOption().buildDelta();this.deleteWithDelta(void 0,n);var r=this._state.followSpanProp(this._state.selection.gcpRange.begin());r.link=e,n.insertText(n.currentRange().end(),t,r),this._state.applyDelta(n)},t.prototype.getStyleName=function(){var t=this.getFont().getStyleName();return t===a.TDConstants.Undefined&&(t=this.getParagraphFormat().getStyleName()),t},t.prototype.getStyleShowName=function(){var t=this.getFont().getStyleShowName();return t===a.TDConstants.Undefined&&(t=this.getParagraphFormat().getStyleShowName()),t},t.prototype.getBuiltinStyle=function(){var t=this.getFont().getBuiltinStyle();return t===a.TDConstants.Undefined&&(t=this.getParagraphFormat().getBuiltinStyle()),t},t.prototype.setStyle=function(t){if(!this._state)throw new Error("State is undefined");var e;if(e="string"==typeof t?this._state.dataEngine.getStyleSheetEngine().getStylePropertyFromName(t):this._state.dataEngine.getStyleSheetEngine().getStylePropertyFromType(t))if(e.styleType===a.StyleType.Paragraph){this.getParagraphFormat().setStyle(t);var n=this._coreRange.gcpRange,r=this._state.getTextStream().createParagraphIterator(n),i=r.getRange(),o=i;if(!n.contains(i)){r.seek(n.end()-1);var s=r.getRange();o=i.unionRange(s)}var l=this._deltaOption().buildDelta();l.moveTo(o),l.splitValidRange(this._state.getRWTextStream(),(function(t){l.clearSpanProperty(t,a.OutlineClearSpanProps)})),l.moveTo(this._coreRange.gcpRange),this._state.applyDelta(l)}else e.styleType===a.StyleType.Character&&this.getFont().setStyle(t)},t.prototype.countWord=function(){var t=0,e=this._state.getTextStream(),n=e.createParagraphIterator(this._coreRange.gcpRange);do{var r=n.getRange(!0),i=e.readText(r.begin(),r.length());t+=s.StringUtil.countWordReg(i)}while(n.next());return t},t.prototype.insertFields=function(t){var e=this._deltaOption().buildDelta(),n=this._validDeleteRange();this.deleteWithDelta(n,e);var r=this._state.followSpanProp(n.begin()),i=this._state.followParaProp(n.begin()),o=n.begin();t.forEach((function(t){if(t){t.options&&t.options.extraProps&&r.merge(t.options.extraProps),t.options&&t.options.wrapBefore&&e.insertParagraph(o,i.paraBreakSpan,i.paraProp);var n=new a.FieldCharSpan(r);n.fieldCharType=a.FieldCharType.Begin,e.insertFieldChar(e.currentRange().end(),n),e.insertText(e.currentRange().end(),t.fieldCode,new a.TextSpan(r)),n.fieldCharType=a.FieldCharType.Separate,e.insertFieldChar(e.currentRange().end(),n),e.insertText(e.currentRange().end(),t.fieldResult,new a.TextSpan(r)),n.fieldCharType=a.FieldCharType.End,e.insertFieldChar(e.currentRange().end(),n),t.options&&t.options.wrapAfter&&e.insertParagraph(e.currentRange().end(),i.paraBreakSpan,i.paraProp)}})),this._state.applyDelta(e)},t.prototype.insertField=function(t,e,n,r){void 0===n&&(n={}),void 0===r&&(r="");var i=this._deltaOption().buildDelta(),o=this._validDeleteRange();this.deleteWithDelta(o,i);var s=this._state.followSpanProp(o.begin()),l=this._state.followParaProp(o.begin()),p=o.begin();n.extraProps&&s.merge(n.extraProps),n.wrapBefore&&i.insertParagraph(p,l.paraBreakSpan,l.paraProp);var c=new a.FieldCharSpan(s);c.fieldCharType=a.FieldCharType.Begin,i.insertFieldChar(i.currentRange().end(),c),i.insertText(i.currentRange().end(),t,new a.TextSpan(s)),c.fieldCharType=a.FieldCharType.Separate,i.insertFieldChar(i.currentRange().end(),c),i.insertText(i.currentRange().end(),e,new a.TextSpan(s)),c.fieldCharType=a.FieldCharType.End,i.insertFieldChar(i.currentRange().end(),c),n.wrapAfter&&i.insertParagraph(i.currentRange().end(),l.paraBreakSpan,l.paraProp),r.length>0&&(i.globalOpts.undoOption.undoEventId=r),this._state.applyDelta(i)},t.prototype.updateField=function(t,e,n,r){void 0===r&&(r="");var i=this._deltaOption().buildDelta(),o=this._coreRange.fixToValidDeleteRange(t);this.deleteWithDelta(o,i);var s=this._state.followSpanProp(o.begin()),l=new a.FieldCharSpan(s);l.fieldCharType=a.FieldCharType.Begin,i.insertFieldChar(i.currentRange().end(),l),i.insertText(i.currentRange().end(),e,new a.TextSpan(s)),l.fieldCharType=a.FieldCharType.Separate,i.insertFieldChar(i.currentRange().end(),l),i.insertText(i.currentRange().end(),n,new a.TextSpan(s)),l.fieldCharType=a.FieldCharType.End,i.insertFieldChar(i.currentRange().end(),l),r.length>0&&(i.globalOpts.undoOption.undoEventId=r),this._state.applyDelta(i)},t.prototype.setGCPRange=function(t){return this._coreRange.setRangeTo(t)},t.prototype._deltaOption=function(){return a.DeltaOption.createLocalDeltaOption(this._coreRange.gcpRange,this._updateSelection,void 0)},t.prototype._validDeleteRange=function(t){return this._coreRange.fixToValidDeleteRange(t||this._coreRange.gcpRange)},t.prototype._validTypeRange=function(){return this._coreRange.fixToValidReplaceRange(this._coreRange.gcpRange)},t}(),Vt=function(){function t(t){this._state=t,this._range=null}return t.prototype.getFont=function(){return this._getRange().getFont()},t.prototype.setFont=function(t){this._getRange().setFont(t)},t.prototype.getTextStyle=function(){var t=this,e=this._gcpRange(),n=null;if(0===e.length())if(this._state.isRangeBeginAtParaStart(e)&&this._state.listMarkerSpanProp){var r=this._state.currentParaProp(e.begin());n=this._state.listMarkerSpanProp,r&&n&&(n=this._state.dataEngine.getStyleSheetEngine().mergeStyleSpanProperty(n,r))}else r=this._state.currentParaProp(e.begin()),n=this._state.followSpanProp(e.begin()),r&&n&&(n=this._state.dataEngine.getStyleSheetEngine().mergeStyleSpanProperty(n,r));return n||a.OperationUtil.splitCellRange(this._state.dataEngine.getRWTextStream(),e,(function(e){var r=t._state.getTextStream().createSpanIterator(e);if(!(n=r.getProperty()))return n=new a.TextSpan,!1;for(;r.next();){var i=r.getProperty();i&&n.common(i)}return!0})),n||new a.TextSpan},t.prototype.getParagraphStyle=function(){var t=this,e=null;return a.OperationUtil.splitCellRange(this._state.dataEngine.getRWTextStream(),this._gcpRange(),(function(n){var r=t._state.getTextStream().createParagraphIterator(n),i=r.getProperty();if(!i)return!1;for(e?e.common(i):e=i;r.next();){var o=r.getProperty();o&&e.common(o)}return!0})),e||new a.ParaProperty},t.prototype.getSpans=function(){return this._getRange().getSpans()},t.prototype.getParagraphFormat=function(){return this._getRange().getParagraphFormat()},t.prototype.setParagraphFormat=function(t){this._getRange().setParagraphFormat(t)},t.prototype.getParagraphs=function(){return this._getRange().getParagraphs()},t.prototype.setSectionFormat=function(t){this._getRange().setSectionFormat(t)},t.prototype.getSectionFormat=function(){return this._getRange().getSectionFormat()},t.prototype.getSections=function(){return this._getRange().getSections()},t.prototype.getInlineShapes=function(t){return this._getRange().getInlineShapes(t)},t.prototype.getInlinePlugins=function(t){return this._getRange().getInlinePlugins(t)},t.prototype.getTables=function(){return this._getRange().getTables()},t.prototype.getTable=function(){return this._getRange().getTables().item(0)},t.prototype.getTableRangeSevice=function(){return this._getRange().getTableRangeSevice()},t.prototype.range=function(){return this._getRange().range()},t.prototype.setRange=function(t,e,n){return this._getRange().setRange(t,e,n)},t.prototype.getStart=function(){return this._getRange().getStart()},t.prototype.setStart=function(t){return this._getRange().setStart(t)},t.prototype.getEnd=function(){return this._getRange().getEnd()},t.prototype.setEnd=function(t){return this._getRange().setEnd(t)},t.prototype.wholeStory=function(){this._getRange().wholeStory()},t.prototype.storyRange=function(){return this._getRange().storyRange()},t.prototype.storyLength=function(){return this._getRange().storyLength()},t.prototype.storyType=function(){return this._getRange().storyType()},t.prototype.collapse=function(t){void 0===t&&(t=a.TDCollapseDirection.CollapseStart),this._getRange().collapse(t)},t.prototype.inRange=function(t){return this._getRange().inRange(t)},t.prototype.isEqual=function(t){return this._getRange().isEqual(t)},t.prototype.getText=function(){return this._getRange().getText()},t.prototype.getPlainText=function(){return this._getRange().getPlainText()},t.prototype.getTextAndImage=function(){return this._getRange().getTextAndImage()},t.prototype.setText=function(t){this._getRange().setText(t)},t.prototype.insertAfter=function(t){this._getRange().insertAfter(t)},t.prototype.insertBefore=function(t){this._getRange().insertBefore(t)},t.prototype.insertParagraph=function(){this._getRange().insertParagraph()},t.prototype.insertParagraphAfter=function(){this._getRange().insertParagraphAfter()},t.prototype.insertParagraphBefore=function(){this._getRange().insertParagraphBefore()},t.prototype.insertBreak=function(t){this._getRange().insertBreak(t)},t.prototype.insertImage=function(t,e,n,r){this._getRange().insertImage(t,e,n,r)},t.prototype.replaceImage=function(t,e){this._getRange().replaceImage(t,e)},t.prototype.moveSplitline=function(t,e){this._getRange().moveSplitline(t,e)},t.prototype.insertSplitline=function(t,e,n){this._getRange().insertSplitline(t,e,n)},t.prototype.setSplitlineProperties=function(t){this._getRange().setSplitlineProperties(t)},t.prototype.clearFormatting=function(){this._getRange().clearFormatting()},t.prototype.formatBrush=function(t,e){this._getRange().formatBrush(t,e)},t.prototype.delete=function(t){void 0===t&&(t=null);var e=t||this._gcpRange();if(e.isEmpty()){var n=this.nextTextBreak(e.begin());this._getRange(new a.GCPRange(e.begin(),n-e.begin())).delete()}else this._getRange().delete(e)},t.prototype.setLink=function(t,e){this._getRange().setLink(t,e)},t.prototype.getStyleName=function(){return this._getRange().getStyleName()},t.prototype.getStyleShowName=function(){return this._getRange().getStyleShowName()},t.prototype.getBuiltinStyle=function(){return this._getRange().getBuiltinStyle()},t.prototype.setStyle=function(t){this._getRange().setStyle(t)},t.prototype.typeText=function(t){this._getRange().setText(t)},t.prototype.typeParagraph=function(){this._getRange().insertParagraph()},t.prototype.typeBackspace=function(){var t=this._gcpRange();if(t.isEmpty()){var e=this.prevTextBreak(t.begin());this._getRange(new a.GCPRange(e,t.begin()-e)).delete()}else this._getRange().delete()},t.prototype.countWord=function(){return this._getRange().countWord()},t.prototype.prevTextBreak=function(t){var e=a.GraphemeBreakerTool.previousTextBreak(this._state.getTextStream(),t),n=this._state.dataEngine.getFieldEngine();if(n){var r=n.getFieldRangeByGcp(e);(null==r?void 0:r.fRange)&&(e=r.fRange.begin())}return e},t.prototype.nextTextBreak=function(t){var e=a.GraphemeBreakerTool.nextTextBreak(this._state.getTextStream(),t),n=this._state.dataEngine.getFieldEngine();if(n){var r=n.getFieldRangeByGcp(e);(null==r?void 0:r.fRange)&&e!==r.fRange.begin()&&(e=r.fRange.end())}return e},t.prototype.prevWordBreak=function(t){var e=this._state.getTextStream();if(t<=0||t>e.getLength()-1||this.isSelectionCollapseAtParaStart())return t;var n=this.prevTextBreak(t);if(n-t>1)return n;var r=e.readText(t-1,1).charCodeAt(0);if(!s.StringUtil.isAlphabetOrNumber(r))return n;var i=e.createParagraphIterator();i.seek(t);for(var o=i.getRange(),a=o.begin(),l=t;l>o.begin()+1;l--){var p=e.readText(l-1,1).charCodeAt(0);if(!s.StringUtil.isAlphabetOrNumber(p)){a=l;break}}return a},t.prototype.nextWordBreak=function(t){var e=this._state.getTextStream();if(t<0||t>=e.getLength()-1||this.isSelectionCollapseAtParaEnd())return t;var n=this.nextTextBreak(t);if(n-t>1)return n;var r=e.readText(t,1).charCodeAt(0);if(!s.StringUtil.isAlphabetOrNumber(r))return n;var i=e.createParagraphIterator();i.seek(t);for(var o=i.getRange(),a=o.end()-1,l=t;l<o.end()-1;l++){var p=e.readText(l,1).charCodeAt(0);if(!s.StringUtil.isAlphabetOrNumber(p)){a=l;break}}return a},t.prototype.prevSkipSpace=function(t){var e=this._state.getTextStream();if(t<=0||t>e.getLength()-1)return t;var n=e.readText(t-1,1).charCodeAt(0);if(!s.StringUtil.isSpace(n))return t;var r=e.createParagraphIterator();r.seek(t);for(var i=r.getRange(),o=i.begin(),a=t;a>i.begin()+1;a--)if(n=e.readText(a-1,1).charCodeAt(0),!s.StringUtil.isSpace(n)){o=a;break}return o},t.prototype.nextSkipSpace=function(t){var e=this._state.getTextStream();if(t<0||t>=e.getLength()-1)return t;var n=e.readText(t,1).charCodeAt(0);if(!s.StringUtil.isSpace(n))return t;var r=e.createParagraphIterator();r.seek(t);for(var i=r.getRange(),o=i.end()-1,a=t;a<i.end()-1;a++)if(n=e.readText(a,1).charCodeAt(0),!s.StringUtil.isSpace(n)){o=a;break}return o},t.prototype.selectWord=function(t,e){var n=this._state.getTextStream();if(!(t<0||t>=n.getLength()-1)&&null===this._state.listMarkerSpanProp){var r=n.readText(t,1).charCodeAt(0),i=!1;if(s.StringUtil.isLineFeed(r)&&(i=!0),s.StringUtil.isSpace(r)){var o=this.prevSkipSpace(t),l=this.nextSkipSpace(t);this.setRange(o,l,{scrollToView:a.ScrollViewType.None,forceFocus:!1})}else s.StringUtil.isAlphabetOrNumber(r)||i?(o=this.prevWordBreak(t),l=this.nextWordBreak(t),this.setRange(o,l,{scrollToView:a.ScrollViewType.None,forceFocus:!1})):e?(o=this.prevTextBreak(t),this.setRange(o,t,{scrollToView:a.ScrollViewType.None,forceFocus:!1})):(l=this.nextTextBreak(t),this.setRange(t,l,{scrollToView:a.ScrollViewType.None,forceFocus:!1}))}},t.prototype.getParaRange=function(t){var e=this._state.getTextStream();if(t<0||t>=e.getLength()-1)return null;var n=e.createParagraphIterator();return n.seek(t),n.getRange()},t.prototype.selectParagraph=function(t){var e=this.getParaRange(t);if(e){var n=this._state.getTextStream();if(1===e.len&&s.StringUtil.isLineFeed(n.readText(t,1).charCodeAt(0)))return;this.setRange(e.begin(),e.end(),{scrollToView:a.ScrollViewType.None,forceFocus:!1})}},t.prototype.getSpanPropAtParaStart=function(){var t=this._state.getTextStream(),e=t.createParagraphIterator();e.seek(this._gcpRange().begin());var n=e.getRange(),r=t.createSpanIterator();return r.seek(n.begin()),r.getProperty()},t.prototype.isSelectionBeginAtParaStart=function(){var t=this._state.getTextStream().createParagraphIterator();t.seek(this._gcpRange().begin());var e=t.getRange();return this._gcpRange().begin()===e.begin()},t.prototype.isSelectionBeginAtParaEnd=function(){var t=this._state.getTextStream().createParagraphIterator();t.seek(this._gcpRange().begin());var e=t.getRange();return this._gcpRange().begin()===e.end()-1},t.prototype.isSelectionEndAtParaEnd=function(){var t=this._state.getTextStream().createParagraphIterator();t.seek(this._gcpRange().begin());var e=t.getRange();return this._gcpRange().end()===e.end()},t.prototype.isSelectAllParagraph=function(){return this.isSelectionBeginAtParaStart()&&this.isSelectionEndAtParaEnd()},t.prototype.isSelectionCollapseAtParaStart=function(){return!!this._coreSelection().isCollapse()&&this.isSelectionBeginAtParaStart()},t.prototype.isSelectionAtImage=function(){if(1===this._gcpRange().len){var t=this._state.getTextStream().createSpanIterator();t.seek(this._gcpRange().begin());var e=t.getProperty(!0);if(e&&e instanceof a.ImageProperty)return!0}return!1},t.prototype.isSelectionAtSplitline=function(){if(1===this._gcpRange().len){var t=this._state.getTextStream().createSpanIterator();t.seek(this._gcpRange().begin());var e=t.getProperty(!0);if(e&&e instanceof a.SplitlineProperty)return!0}return!1},t.prototype.isSelectionAtPlugin=function(){if(1===this._gcpRange().len){var t=this._state.getTextStream().createSpanIterator();t.seek(this._gcpRange().begin());var e=t.getProperty(!0);if(e&&e instanceof a.PluginContainerProperty)return!0}return!1},t.prototype.isSelectionAtParaBreak=function(){if(1===this._gcpRange().len){var t=this._state.getTextStream().createSpanIterator();t.seek(this._gcpRange().begin());var e=t.getProperty(!0);if(e&&e instanceof a.ParaBreakSpan)return!0}return!1},t.prototype.isSelectionAtCodeblock=function(){return this.storyType()===a.TDStoryType.CodeblockStory},t.prototype.isSelectionCollapseAtParaEnd=function(){return!!this._coreSelection().isCollapse()&&this.isSelectionBeginAtParaEnd()},t.prototype.isSelectionAtListStart=function(){if(!this._state.dataEngine.getListManager())return!1;var t=this._state.dataEngine.getListManager().getListInfoFromGcpRange(this._gcpRange());return null!==t&&0===t.order&&0===t.listLevel},t.prototype.isSelectionBelongsToSameList=function(){var t=this.getParagraphFormat().getListId();return t!==a.TDConstants.Undefined&&t!==a.Defaults.paragraph.listId},t.prototype.isSelectWholeList=function(t){var e=this,n=this._state.dataEngine.getListManager().getWholeListByListId(t);return 0!==n.length&&n.every((function(t){return e._gcpRange().contains(t.gcp-1)}))},t.prototype.isSelectionAtMention=function(){if(0===this._gcpRange().len){var t=this._state.dataEngine.getFieldEngine();if(t){if(t.getFieldRangeByGcp(this._gcpRange().begin()))return!0;if(this._gcpRange().begin()>0&&t.getFieldRangeByGcp(this._gcpRange().begin()-1))return!0}}return!1},t.prototype.getFirstListInfoInSelection=function(){return this._state.dataEngine.getListManager()?this._state.dataEngine.getListManager().getListInfoFromGcpRange(this._gcpRange()):null},t.prototype.getParaRangeIfCollapsed=function(){if(!this._coreSelection().isCollapse())return null;var t=this._state.getTextStream().createParagraphIterator();t.seek(this._gcpRange().begin());var e=t.getRange();return jt.createStateRange(this._state,e)},t.prototype.tableCellRange=function(){return this._coreSelection().tableCellRange},t.prototype.tableCellRangeAll=function(){return this._coreSelection().tableCellRangeAll},t.prototype.validDeleteRange=function(){return this._coreSelection().validDeleteRange()},t.prototype._getRange=function(t){this._range||(this._range=jt.createStateRange(this._state,this._gcpRange(),!0));var e=t||this._gcpRange();return this._range.setGCPRange(e),this._range},t.prototype._gcpRange=function(){return this._state.selection.gcpRange},t.prototype._coreSelection=function(){return this._state.selection},t.prototype.insertField=function(t,e,n,r){void 0===r&&(r=""),this._getRange().insertField(t,e,n,r)},t.prototype.insertFields=function(t){this._getRange().insertFields(t)},t.prototype.updateField=function(t,e,n,r){void 0===r&&(r=""),this._getRange().updateField(t,e,n,r)},t.prototype.getSelectionContent=function(){return this.getTextAndImage()},t.prototype.insertTextAndSelected=function(t){var e=this.range();if(e&&t&&t.length>0){var n=e.begin();this.setText(t),this._state.setRangeTo(new a.GCPRange(n,t.length))}},t}(),Yt=function(){function t(t){this._state=t,this._textStream=this._state.dataEngine.getTextStream()}return t.prototype._deltaOption=function(){return a.DeltaOption.createLocalDeltaOption(new a.GCPRange(0,this._textStream.getLength()),!1)},t.prototype.getTableGCPRange=function(t){var e=this._textStream.tableStream.getTableInfo(t);return e?e.range:null},t.prototype.getTableCellGCPRange=function(t,e,n){var r=this._textStream.tableStream.getTableCellInfo(t,e,n);return(null==r?void 0:r.range)?r.range:null},t.prototype.getTableFromGcp=function(t){var e=this._textStream.tableStream.fixPlaceholderGCP(t),n=this._textStream.tableStream.getTableInfoFromGcp(e);if(n){var r=a.DeltaOption.createLocalDeltaOption(n.range);return Ut.createStateTable(this._state,r,n.property)}return null},t.prototype.getTable=function(t){var e=this._textStream.tableStream.getTableInfo(t);if(e){var n=a.DeltaOption.createLocalDeltaOption(e.range);return Ut.createStateTable(this._state,n,e.property)}return null},t.prototype.hasTable=function(t){return null!==this._textStream.tableStream.getTableInfo(t)},t.prototype.getTableFullInfoFromGcp=function(t){return this._textStream.tableStream.getTableFullInfoFromGcp(t)},t.prototype.getTableCount=function(){for(var t=this._textStream.tableStream.createTableIter(new a.GCPRange(0,this._textStream.getLength())),e=0;t.hasNext();)e+=1,t.next();return e},t.prototype.getTableRanges=function(){return Object.values(this.getTableRangesMap())},t.prototype.getTableRangesMap=function(){var t={},e=this._textStream.tableStream.createTableIter();do{var n=e.getRange(),r=e.getProperty(!0);if(n.isEmpty()||!r)break;t[r.tableId]=n}while(e.next());return t},t.prototype.getListInfoFromGcpRange=function(t){return this._state.dataEngine.getListManager()?this._state.dataEngine.getListManager().getListInfoFromGcpRange(t):null},t.prototype.getFields=function(){return Gt.createStateFields(this._state,this._deltaOption())},t.prototype.getSpans=function(){return ot.createStateSpans(this._state,this._deltaOption())},t.prototype.getParagraphs=function(){return ct.createStateParagraphs(this._state,this._deltaOption())},t.prototype.setSectionFormat=function(t){this.getSectionFormat().setSectionFormat(t)},t.prototype.getSectionFormat=function(){return ht.createStateSectionFormat(this._state,this._deltaOption())},t.prototype.getSections=function(){return gt.createStateSections(this._state,this._deltaOption())},t.prototype.getTables=function(){return Wt.createStateTables(this._state,this._deltaOption())},t.prototype.getRange=function(t,e,n){return void 0===n&&(n=!0),jt.createStateRange(this._state,new a.GCPRange(t,e-t),!1,n)},t.prototype.select=function(){jt.createStateRange(this._state,this._state.selection.gcpRange).wholeStory()},t.prototype.getInlineShapes=function(t){return ft.createStateInlineShapes(this._state,this._deltaOption(),t)},t.prototype.getInlinePlugins=function(t){return Tt.createStateInlinePlugins(this._state,this._deltaOption(),t)},t.prototype.onCompositionStart=function(t){this._state.compositionStart(t)},t.prototype.onCompositionUpdate=function(t,e){this._state.compositionUpdate(t,e)},t.prototype.onCompositionEnd=function(t,e){this._state.compositionEnd(t,e)},t.prototype.search=function(t){var e=[],n=t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),r=new RegExp(n,"gi"),i=this._textStream.createParagraphIterator(),o=this._state.dataEngine.getFieldEngine();do{for(var s=i.getRange(),l=this._textStream.readText(s.begin(),s.length()),p=r.exec(l);p;){var c=new a.GCPRange(s.begin()+p.index,t.length);(null==o?void 0:o.isRangeInFieldCode(new a.GCPRange(c.begin(),c.length())))||("*"===t?this._textStream.createSpanIterator(c).getProperty(!0)instanceof a.TextSpan&&e.push(c):e.push(c)),p=r.exec(l)}}while(i.next());return e},t.prototype.replaceAll=function(t,e){for(var n=this._state.delta(),r=t.length-1;r>=0;r--){var i=t[r];n.deleteText(i);var o=this._state.followSpanProp(i.begin());n.insertText(i.begin(),e,o)}this._state.applyDelta(n)},t.prototype.countWord=function(){var t=0,e=this._textStream.getMainStoryInfo();if(null===e)return 0;var n=this._textStream.createParagraphIterator(e.range);do{var r=n.getRange(),i=this._textStream.readText(r.begin(),r.length());t+=s.StringUtil.countWordReg(i)}while(n.next());return t-1},t.prototype.docIsEmpty=function(){var t=this._textStream.readText(0,10);return"%0A"===t||"%0A%0F%03%0A"===t||"\n\n"===t||""===t},t.prototype.getFirstParamText=function(){var t="",e=a.GCPRange.emptyRange(),n=this._textStream.getMainStoryInfo();if(n){var r=n.range,i=this._textStream.createParagraphIterator(r),o=/(^\s*)|(\s*$)|\n/g;do{var s=i.getRange(),l="",p=this._textStream.createSpanIterator(s);do{var c=p.getRange(!0),h=this._textStream.readText(c.begin(),c.len),u=p.getProperty(!0);u&&!u.isSpecialChar&&(l+=h=h.replace(o,""))}while(p.next());(l=a.FieldUtil.getFilterFieldCodeText(l))&&l.length>0&&l!==a.PlaceholderChar.SectionBreak&&(t=l,e=s)}while(i.next()&&0===t.length)}return{content:t,range:e}},t.prototype.getFirstParaTextRegardless=function(){var t="",e=a.GCPRange.emptyRange(),n=this._textStream.getMainStoryInfo();if(n){var r=n.range,i=/(^\s*)|(\s*$)|\n/g,o=this._textStream.createDataIterator(r).getRange(a.IterType.Paragraph),s="",l=this._textStream.createDataIterator(o);do{var p=l.getRange(a.IterType.Span,!0),c=this._textStream.readText(p.begin(),p.len),h=l.getSpanProp();h&&!h.isSpecialChar&&(s+=c=c.replace(i,""))}while(l.next(a.IterType.Span));(s=a.FieldUtil.getFilterFieldCodeText(s))&&s!==a.PlaceholderChar.SectionBreak&&(t=s,e=o)}return{content:t,range:e}},t.prototype.getFirstParaRange=function(){var t=this._textStream.getMainStoryInfo();if(t){var e=t.range;return this._textStream.createDataIterator(e).getRange(a.IterType.Paragraph)}return null},t.prototype.isParaHeading=function(t,e){var n;if(n=t instanceof a.ListInfo?void 0!==t.paragraphStyle?t.paragraphStyle:"":t.styleName,e)return n===e;switch(n){case a.BuiltinStyleName.Heading1:case a.BuiltinStyleName.Heading2:case a.BuiltinStyleName.Heading3:case a.BuiltinStyleName.Heading4:case a.BuiltinStyleName.Heading5:case a.BuiltinStyleName.Heading6:case a.BuiltinStyleName.Heading7:case a.BuiltinStyleName.Heading8:case a.BuiltinStyleName.Heading9:case a.BuiltinStyleName.Title:case a.BuiltinStyleName.Subtitle:return!0;default:return!1}},t.prototype.isParaEmpty=function(t){var e=this._state.getTextStream().createDataIterator();e.seek(t);var n=e.getRange(a.IterType.Paragraph);return n.length()>0&&n.begin()===t&&n.end()-1===t},t.prototype.insertStory=function(t,e,n,r){if(this._state){var i=this._state.dataEngine.getTextStream().createStoryIterator(),o=a.DeltaOption.createLocalDeltaOption(a.GCPRange.emptyRange(),!1).buildDelta(),s=new a.StoryProperty;s.storyId=e,s.storyType=t;var l=i.getLastStoryEndPos();o.insertStoryBegin(l,s,a.PlaceholderChar.StoryBegin),o.insertParagraph(o.currentRange().end(),r||new a.ParaBreakSpan,n||new a.ParaProperty),o.insertStoryEnd(o.currentRange().end(),s.clone(),a.PlaceholderChar.StoryEnd),this._state.applyDelta(o)}},t.prototype.getStoryRangeFromGcpRange=function(t){return this._textStream.createStoryIterator(t).getContentRange()},t.prototype.toApplyDelta=function(t){this._state.applyDelta(t)},t.prototype.getParamInfoFromGcpRange=function(t){var e=this._textStream.createParagraphIterator();e.seek(t.begin());var n=e.getRange().begin();e.seek(t.end()-1);var r=e.getRange().end()-n;return{content:this._textStream.readText(n,r),range:new a.GCPRange(n,r)}},t.prototype.findStoryInfoFromId=function(t){return this._textStream.findStoryInfoFromId(t)},t.prototype.findContentFromId=function(t){var e=this._textStream.findStoryInfoFromId(t);return e?this._textStream.readText(e.range.begin(),e.range.length()):""},t.prototype.getCurLastStoryEndPos=function(){return this._state.getRWTextStream().createStoryIterator().getLastStoryEndPos()},t.prototype.getIndentFromGcp=function(t){var e=this.getParamInfoFromGcpRange(new a.GCPRange(t,0)),n=e.content,r=e.range;if(n&&n.length>0){var i=n.match(/^ +/g);if(i&&i.length>0)return new a.GCPRange(r.begin(),i[0].length)}return new a.GCPRange(r.begin(),0)},t.prototype.findStoryRangeFromId=function(t){var e=this._textStream.findStoryInfoFromId(t);return e?e.range:new a.GCPRange(0,0)},t.prototype.getLineNumber=function(t){var e=this._textStream.findStoryInfoFromId(t);if(e){var n=0,r=this._textStream.createParagraphIterator(e.range);do{n+=1}while(r.next());return n}return 0},t.prototype.findStoryInfoFromGcp=function(t){return this._textStream.findStoryInfoFromGcp(t)},t.prototype.removeContainerStories=function(t){var e=this._textStream.createStoryIterator(),n=[];do{var r=e.getRange(),i=e.getProperty(!0);i&&t.has(i.storyId)&&n.push(r)}while(e.next());if(n.length>0){for(var o=this._deltaOption().buildDelta(),a=n.length-1;a>=0;a--){var s=n[a];o.deleteText(s)}this._state.applyDelta(o)}},t.prototype.getGlobalProperty=function(){var t=this.findStoryInfoFromGcp(0);return(null==t?void 0:t.storyProp)?t.storyProp:null},t.prototype.setGlobalProperty=function(t){var e=this.findStoryInfoFromGcp(0);if(null==e?void 0:e.range){var n=a.DeltaOption.createLocalDeltaOption(a.GCPRange.emptyRange(),!1).buildDelta();n.setGlobalProperty(new a.GCPRange(e.range.end(),1),t),this._state.applyDelta(n)}},t.prototype.collectOutlineParagraph=function(t){void 0===t&&(t=100);var e=[],n=this._textStream.getMainStoryInfo();if(null===n)return e;var r=this._state.dataEngine.getListManager(),i=this._textStream.createSpanIterator(),o=this._textStream.createParagraphIterator(n.range);do{var s=o.getProperty(!0);if(s&&(s=this._state.dataEngine.getStyleSheetEngine().mergeStyleParaProperty(s)),s&&s.outlineLevel!==a.OutlineLevel.Normal){var l=o.getRange(),p="";if(null==r?void 0:r.isListParagraph(s)){var c=r.getListInfoFromGcpRange(l);(null==c?void 0:c.isNumbered)&&c.actualText&&(p+=c.actualText+" ")}var h=!0;i.setLimitRange(new a.GCPRange(l.begin(),l.length()));var u=!0;do{var g=i.getProperty(!0),d=i.getRange(!0),f=this._textStream.readText(d.begin(),d.len);if(g instanceof a.FieldCharSpan&&g.fieldCharType===a.FieldCharType.Begin&&(u=!1),g instanceof a.FieldCharSpan&&g.fieldCharType===a.FieldCharType.End&&(u=!0),this.fileterSpecialChar(g))p+=f,h=!1;else if(this.filterDrawingType(g)){var y=this.collectOutlineFromDrawingType(g);p+=y,h=!y}else h&&(l.gcpBegin+=d.length(),l.len-=d.length())}while(i.next()&&(p.length<t||!u));var T={text:p=a.FieldUtil.getFilterFieldCodeText(p),range:l,outlineLevel:s.outlineLevel,styleName:s.styleName,paraId:s.paraId};e.push(T)}}while(o.next());return e},t.prototype.fileterSpecialChar=function(t){return t&&!(t instanceof a.BaseContainerProperty)&&!(t instanceof a.SectBreakSpan)&&!(t instanceof a.PageBreakSpan)},t.prototype.filterDrawingType=function(t){return t&&t instanceof a.BaseContainerProperty&&t instanceof a.DrawingContainerProperty},t.prototype.collectOutlineWithoutTitleSubtitle=function(t){var e;void 0===t&&(t=200);var n=[],r=this._textStream.getMainStoryInfo();if(null===r)return n;var i=this._textStream.createSpanIterator(),o=this._textStream.createParagraphIterator(r.range);do{var s=o.getProperty(!0);if(s&&(s=this._state.dataEngine.getStyleSheetEngine().mergeStyleParaProperty(s)),s&&s.outlineLevel!==a.OutlineLevel.Normal){var l=s instanceof a.ListInfo?s.paragraphStyle:s.styleName;if(l===a.BuiltinStyleName.Title||l===a.BuiltinStyleName.Subtitle)continue;var p=o.getRange(),c="";c+=this.collectList(s,p),i.setLimitRange(new a.GCPRange(p.begin(),p.length()));var h=!0;do{h=(e=this.collectSpanText(i,p)).isFeildCodeComplete,c+=e.newText}while(i.next()&&(c.length<t||!h));var u={text:c=a.FieldUtil.getFilterFieldCodeText(c),range:p,outlineLevel:s.outlineLevel,styleName:s.styleName,paraId:s.paraId};n.push(u)}}while(o.next());return n},t.prototype.collectSpanText=function(t,e){var n=t.getProperty(!0),r=t.getRange(!0),i=this._textStream.readText(r.begin(),r.len),o=!0,s="",l=e,p=this.isFeildCodeComplete(n);if(!n||n instanceof a.BaseContainerProperty||n instanceof a.SectBreakSpan||n instanceof a.PageBreakSpan)if(n&&n instanceof a.DrawingContainerProperty){var c=this.collectOutlineFromDrawingType(n);s+=c,o=!c}else o&&(l.gcpBegin+=r.length(),l.len-=r.length());else s+=i,o=!1;return{isFeildCodeComplete:p,newText:s}},t.prototype.collectList=function(t,e){var n="",r=this._state.dataEngine.getListManager();if(null==r?void 0:r.isListParagraph(t)){var i=r.getListInfoFromGcpRange(e);(null==i?void 0:i.isNumbered)&&i.actualText&&(n+=i.actualText+" ")}return n},t.prototype.collectOutlineFromDrawingType=function(t){var e="",n=t.drawingType;return n===a.DrawingType.Image?e="[图片]":n===a.DrawingType.Splitline?e="[分割线]":n===a.DrawingType.Textframe&&t instanceof a.TextframeProperty&&t.textframeType===a.TextframeType.Codeblock&&(e="[代码块]"),e},t.prototype.isFeildCodeComplete=function(t){return!(t instanceof a.FieldCharSpan&&t.fieldCharType===a.FieldCharType.Begin||(t instanceof a.FieldCharSpan&&(t.fieldCharType,a.FieldCharType.End),0))},t.prototype.getParaCount=function(){var t=0,e=this._textStream.getMainStoryInfo();if(null===e)return t;for(var n=this._textStream.createParagraphIterator(e.range);n.next();)t+=1;return t},t.prototype.isParaCountMoreThan=function(t){var e=0,n=this._textStream.getMainStoryInfo();if(null===n)return!1;for(var r=this._textStream.createParagraphIterator(n.range);r.next();){if(e+1>t)return!0;e+=1}return!1},t.prototype.getOutlineStyleProps=function(t){return"string"==typeof t?this._state.dataEngine.getStyleSheetEngine().getStylePropertyFromName(t):this._state.dataEngine.getStyleSheetEngine().getStylePropertyFromType(t)},t.prototype.getTextFromGcpRange=function(t){return this._textStream.readText(t.begin(),t.length())},t.prototype.getTextStyleAtRange=function(t){var e=this._state.getTextStream().createSpanIterator(t),n=[];do{var r=e.getProperty();r&&n.push(r)}while(e.next());return n},t.prototype.nextTextBreak=function(t){return a.GraphemeBreakerTool.previousTextBreak(this._textStream,t)},t.prototype.previousTextBreak=function(t){return a.GraphemeBreakerTool.previousTextBreak(this._textStream,t)},t.prototype.getParaStyleAtRange=function(t){var e=this._state.getTextStream().createDataIterator(t),n=e.getParaProp();if(!n)return[];for(var r=[n];e.next(a.IterType.Paragraph);){var i=e.getParaProp();i&&r.push(i)}return r},t.prototype.getExceptionRanges=function(){return this._state.getExceptionRanges()},t.prototype.getDocLength=function(){return this._textStream.getLength()},t.prototype.getBoxRanges=function(t){var e=t.indexPairs,n=[];if(!e||0===e.length)return n;var r=this._state.getTextStream();return e.forEach((function(t){var e=r.getGCPFromIndex(t.first),i=r.getGCPFromIndex(t.last)+1;n.push(new a.GCPRange(e,i-e))})),n},Object.defineProperty(t.prototype,"storyId",{get:function(){return this._state.selection.storyInfo.storyProp.storyId},enumerable:!0,configurable:!0}),t}(),zt=function(){function t(t){this._state=t,this._textStream=this._state.dataEngine.getTextStream()}return t.prototype.getCheckText=function(){var t="",e=this._textStream.getMainStoryInfo();if(null===e)return"";var n=this._textStream.createParagraphIterator(e.range);do{var r=n.getRange();if(r.length()>1&&(t+=this._textStream.readText(r.begin(),r.length())),t.length>100){t=t.substring(0,100);break}}while(n.next());return t},t.prototype.insertSection=function(t,e,n){if(e&&n){var r=a.DeltaOption.createServerDeltaOption(new a.GCPRange(t,0)).buildDelta();r.setUpdateSelection(!1),r.insertSection(r.currentRange().end(),e,n),this._state.applyDelta(r)}},t.prototype.insertParagraph=function(t,e){var n=a.DeltaOption.createServerDeltaOption(new a.GCPRange(t,0)).buildDelta();n.setUpdateSelection(!1),this.buildDelta(n,e);var r=n.currentRange().end();return this._state.applyDelta(n),r},t.prototype.replaceDiff=function(t,e){var n=a.DeltaOption.createServerDeltaOption(t).buildDelta();n.setUpdateSelection(!1),n.deleteText(t),this.buildDelta(n,e),this._state.applyDelta(n)},t.prototype.buildDelta=function(t,e){for(var n=0;n<e.length;n++){var r=e[n],i=r.text,o=r.translateText,l=r.span,p=r.paraProp;l&&p&&(l instanceof a.TableCellBreakSpan&&p instanceof a.TableCellProperty?t.insertTableCellPara(t.currentRange().end(),l,p,p.paraId):l instanceof a.TableCellStartSpan?t.insertTableCellStart(t.currentRange().end(),l,p.paraId):l instanceof a.TableRowBreakSpan&&p instanceof a.TableRowProperty?t.insertTableRowPara(t.currentRange().end(),l,p,p.paraId):l instanceof a.TableRowStartSpan?t.insertTableRowStart(t.currentRange().end(),l,p.paraId):l instanceof a.TableStartBreakSpan&&p instanceof a.TableProperty?t.startCreateTable(t.currentRange().end(),p,p.paraId):l instanceof a.TableEndBreakSpan&&p instanceof a.TableProperty?t.endCreateTable(t.currentRange().end(),p,p.paraId):l instanceof a.ParaBreakSpan&&p?t.insertParagraph(t.currentRange().end(),l,p,p.paraId):l&&t.insertSpan(t.currentRange().end(),s.StringUtil.isEmpty(o)?i:o,l))}},t.prototype.isValid=function(t,e,n){if(e.propertyType===a.PropertyType.CodeblockProperty)return{translatable:!1,preservable:!1};if(e.isSpecialChar)return{translatable:!1,preservable:!0};if(0===t.length)return{translatable:!1,preservable:!0};if(t===a.PlaceholderChar.Space||t===a.PlaceholderChar.FullWidthSpace||t===a.PlaceholderChar.ZeroSpace||t===a.PlaceholderChar.NonBreakSpace||t===a.PlaceholderChar.NoWidthOptionalBreak||t===a.PlaceholderChar.NoWidthNoBreak||t===a.PlaceholderChar.Tab)return{translatable:!1,preservable:!0};if(Object(s.isLinkValid)(e.link))return{translatable:!1,preservable:!0};if(e.isStoryPlaceholder)return{translatable:!1,preservable:!0};var r=this._state.dataEngine.getFieldEngine();return e instanceof a.FieldCharSpan||r&&(r.isFieldCodeRange(n)||r.isFieldResultRange(n))?{translatable:!1,preservable:!0}:{translatable:!0,preservable:!0}},t.prototype.getTranslateDeltaData=function(){var t=this._textStream.createStoryIterator().getRange();if(null===t)return null;var e=a.DeltaOption.createLocalDeltaOption(a.GCPRange.emptyRange(),!1,!1).buildDelta();return a.DataCollector.collectDataToDelta(this._state.getRWTextStream(),e,t),e},t}(),Jt=[a.ParaPropKey.characterUnitLeftIndent,a.ParaPropKey.leftIndent,a.ParaPropKey.characterUnitSpecialIndent,a.ParaPropKey.specialIndent],Xt=new a.ParaProperty,Qt=function(){function t(t,e,n){var r=this;this._findListCache=new Map,this._templateLevelCache=new Map,this._onListModelChange=function(t){if(r._listManager){var e=r._listManager.getListInfoFromGcpRange(r._selection.range());if(e){var n=r.deltaOption().buildDelta();r.forEachTemplates((function(i,o){return!(o.listTemplateId!==e.listTemplateId||!r._isSelectAllLevel&&o.listLevel!==e.listLevel||(n.setSpanProperty(i.getRange(),t.listMarkerSpanProperty),r._isSelectAllLevel))})),r._state.applyDelta(n)}}},this._state=t,this._textStream=this._state.dataEngine.getRWTextStream(),this._selection=e,this._document=n,this._listManager=t.dataEngine.getListManager(),this._state.context.on(a.StateNotification.ListModelShouldChange,this._onListModelChange,this),this.ensureListStory()}return Object.defineProperty(t.prototype,"selectionRange",{get:function(){return this._state.selection.gcpRange},enumerable:!0,configurable:!0}),t.prototype.deltaOption=function(t,e){return void 0===e&&(e=!1),a.DeltaOption.createLocalDeltaOption(t||this.selectionRange,e)},t.prototype.isSingleLevelList=function(t){return!!this._listManager&&1===this._listManager.getExistsListLevels(t.listId).length},t.prototype.createFindIterator=function(t,e){var n=this._textStream.createDataIterator(),r=this._textStream.findStoryInfoFromGcp(t.gcpBegin);if(r&&n.setLimitRange(r.range),e===a.ListFindDirection.Prev){n.seek(t.gcpBegin);var i=n.getSpanProp(!0);i&&Object(a.isTableSeperateProp)(i)?n.seek(t.gcpBegin+1):n.seek(t.gcpBegin)}else n.seek(t.end()-(t.len>0?1:0));return n},t.prototype.matchType=function(t,e){return e.listType===t},t.prototype.matchStyle=function(t,e){return e.listFmt===t.listFormat&&e.lvlText===t.listText},t.prototype.matchTemplatesWithStylesetsAt=function(t,e,n){for(var r=0,i=n;i<t.length&&r<e.length;++i){var o=e[r];if(!o||t[i].listFmt!==o.listFormat||t[i].lvlText!==o.listText)return!1;r+=1}return r===e.length},t.prototype.matchFullStyleset=function(t,e){var n=e.listTemplateId,r=this._findListCache.get(n);if(void 0===r){var i=this.getTemplatesById(e.listTemplateId),o=this.matchTemplatesWithStylesetsAt(i,t,0);return this._findListCache.set(n,o),o}return r},t.prototype.matchPartialStyleset=function(t,e){var n="_"+e.listTemplateId,r=this._findListCache.get(n);if(void 0===r){for(var i=this.getTemplatesById(e.listTemplateId),o=0;o<a.Defaults.listLevelLimit-t.length;++o)if(this.matchTemplatesWithStylesetsAt(i,t,o))return this._findListCache.set(n,!0),!0;return this._findListCache.set(n,!1),!1}return r},t.prototype.createTraitPredicate=function(t){var e=[];return void 0!==t.style&&e.push(this.matchStyle.bind(this,t.style)),void 0!==t.fullStyleset?e.push(this.matchFullStyleset.bind(this,t.fullStyleset)):t.partialStyleset&&e.push(this.matchPartialStyleset.bind(this,t.partialStyleset)),void 0!==t.type&&e.push(this.matchType.bind(this,t.type)),function(t){return e.every((function(e){return e(t)}))}},t.prototype.createFindMoveFunction=function(t,e,n){var r=e===a.ListFindDirection.Prev?function(){return t.prev(a.IterType.Paragraph)}:function(){return t.next(a.IterType.Paragraph)};return n?function(){for(;r();)if(n(t.getRange(a.IterType.Paragraph)))return!0;return!1}:r},t.prototype.unidirectionalFindList=function(t,e,n,r,i){if(this._listManager){var o=this.createTraitPredicate(r),a=this.createFindIterator(t,e),s=this.createFindMoveFunction(a,e,i);if(s())do{var l=this._listManager.getListInfoFromGcpRange(a.getRange());if(l&&o(l))return l}while(s()&&n)}return null},t.prototype.findList=function(t,e){this._findListCache.clear();for(var n=Array.isArray(e.crossParagraph)?e.crossParagraph:e.directions.map((function(){return!!e.crossParagraph})),r=0;r<e.directions.length;++r){var i=this.unidirectionalFindList(t,e.directions[r],!!n[r],e.traits,e.paragraphFilter);if(i)return i}return null},t.prototype.applyDelta=function(t,e){t.operations.length>0&&!e&&this._state.applyDelta(t)},t.prototype.needRangeFixAfterListTemplateOps=function(t){var e=this.findListStory();return!(e&&t.end()<e.range.gcpBegin)},t.prototype.getValidListOpRange=function(t){var e=this._textStream.findStoryInfoFromGcp(t.gcpBegin);if(!e||a.ListManager.isListTemplateStory(e.storyProp.storyId))throw Error("invalid gcp range for list operation");return t.end()>e.range.end()?e.range.intersectRange(t):t},t.prototype.createListInRange=function(t,e){var n=this.getValidListOpRange(t),r=this.deltaOption(n).buildDelta();r.globalOpts.undoOption.undoListener=e.notifyUndo;var i=e.styleset;if(i.length>0){var o=this.createTemplatesFromStyleset(i,e.listLevelLimit,n),s=o.paragraphs,l=o.spans;if(s){var p=a.ListUtils.createId(),c=a.ListUtils.isTaskFormat(i[0].listFormat)&&i[0].listText===a.TaskState.Done?a.TaskState.Done:a.TaskState.Todo;this.setListParaPropsInRange(n,p,s[0],e.listLevelRule,c,r);var h=this.needRangeFixAfterListTemplateOps(n);this.insertListTemplates(s,r,l),this.applyDelta(r);var u=h?a.OperationUtil.getFixedGcpRange(r.operations,n):n;return r.operations.length>0?{listId:p,range:u}:void 0}}},t.prototype.createRootTemplateParagraphByIndents=function(t,e){void 0===e&&(e=0);var n=Number.MAX_SAFE_INTEGER;if(t){var r=this._textStream.createParagraphIterator(t);do{var i=r.getProperty(!0);if(i){if(!i.listTemplateId||this.isTaskList(i.listId)){var o=this.combineIndents(i.leftIndentConfig,i.specialIndentConfig,t,{characterUnit:!0});o.characterUnitIndent<n&&(n=o.characterUnitIndent)}}else n=0}while(r.next()&&n>0)}n===Number.MAX_SAFE_INTEGER&&(n=e);var s=new a.NumberingProperty;return s.listTemplateId=a.ListUtils.createId(),s.characterUnitLeftIndent=n,s.characterUnitSpecialIndent=a.Defaults.listDefaultHanging,s},t.prototype.createTemplatesFromStyleset=function(t,e,n){var r=this.createRootTemplateParagraphByIndents(n,t[0].listLeftIndent);r.listLevel=0,r.start=0;var i=Z(t,1)[0];r.listFmt=i.listFormat;var o=[];if(a.ListUtils.isBulletFormat(i.listFormat)||a.ListUtils.isNumberedFormat(i.listFormat)){r.lvlText=i.listText,void 0!==i.listHangingIndent&&(r.characterUnitSpecialIndent=i.listHangingIndent),o.push(r);for(var s=1;s<t.length;++s){var l=new a.NumberingProperty;l.listLevel=s,l.start=0,l.listFmt=t[s].listFormat,l.lvlText=t[s].listText,l.characterUnitSpecialIndent=t[s].listHangingIndent||a.Defaults.listDefaultHanging,t[s].listLeftIndent&&(l.characterUnitLeftIndent=r.characterUnitLeftIndent+(t[s].listLeftIndent-(t[0].listLeftIndent||0))),o.push(l)}}else a.ListUtils.isTaskFormat(i.listFormat)&&(r.listFmt=i.listFormat,o.push(r));return o?(a.ListUtils.completeListTemplateParagraphs(o[0],o,Math.min(e||a.Defaults.listLevelLimit,a.Defaults.maxSupportListLevelLimit)),{paragraphs:o,spans:void 0}):{}},t.prototype.splitValidParaRange=function(t){var e=this,n=[];return a.OperationUtil.splitCellRange(this._state.dataEngine.getRWTextStream(),t,(function(t){var r=e._state.getRWTextStream().createParagraphIterator(t),i=e._state.getRWTextStream().createSpanIterator();do{var o=r.getRange();i.seek(o.end()-1);var s=i.getProperty(!0);s&&!Object(a.isTableSeperateProp)(s)&&n.push(o)}while(r.next());return!0})),n},t.prototype.createListParaProperty=function(t,e,n,r){var i=Xt.clone();return void 0!==e&&(i.listId=e),void 0!==n&&(i.listTemplateId=n),t.type===a.ListLevelRuleType.absolute&&void 0!==t.value&&(i.listLevel=t.value),r&&(i.taskState=r),i},t.prototype.getListLevelLimit=function(t){if(t){var e=this._templateLevelCache.get(t);if(void 0!==e)return e;var n=this.getRawTemplatesById(t),r=n.length>0?this.parseTemplateLeveLimit(n):a.Defaults.listLevelLimit;return this._templateLevelCache.set(t,r),r}return a.Defaults.listLevelLimit},t.prototype.getValidLevel=function(t,e){return Math.max(0,Math.min(t,e-1))},t.prototype.isTaskList=function(t){var e;return(null===(e=this._listManager)||void 0===e?void 0:e.getListTypeByListId(t))===a.ListType.Task},t.prototype.setListParaPropsInRange=function(t,e,n,r,i,o){var s=this,l=o||this.deltaOption(this.selectionRange).buildDelta(),p=n.isTask?{type:a.ListLevelRuleType.absolute,value:0}:J({type:a.ListLevelRuleType.auto},r),c=this.createListParaProperty(p,e,n?n.listTemplateId:void 0,i),h=this._textStream.createParagraphIterator();this.splitValidParaRange(t).forEach((function(t){var e=-1,r=-1;if(p.type===a.ListLevelRuleType.auto){h.seek(t.gcpBegin);var i=h.getProperty(!0);if(i&&(-1===i.listLevel||!i.listId||s.isTaskList(i.listId))){var o=s.combineIndents(i.leftIndentConfig,i.specialIndentConfig,t,{characterUnit:!0}),u=s.getListLevelLimit(n.listTemplateId);r=s.getValidLevel(Math.floor((o.characterUnitIndent-n.characterUnitLeftIndent+1)/2),u)}}else if(p.type===a.ListLevelRuleType.relative&&p.value){h.seek(t.gcpBegin);var g=h.getProperty(!0);g&&(u=s.getListLevelLimit(n.listTemplateId),e=g.listLevel,r=s.getValidLevel(e+p.value,u))}var d=c;r!==e&&((d=c.clone()).listLevel=r),d.equalTo(Xt)||(l.clearParaProperty(t,Jt),l.setParagraphProperty(t,d))})),this.applyDelta(l,o)},t.prototype.replaceListInRange=function(t,e){var n=void 0,r=this.getListTemplateId(e.listId);if(r&&(n=this.getTemplateById(r,0)),n){var i=this.getValidListOpRange(t),o=this.deltaOption().buildDelta();o.globalOpts.undoOption.undoListener=e.notifyUndo,this.setListParaPropsInRange(i,e.listId,n,e.listLevelRule,void 0,o),this.applyDelta(o)}},t.prototype.getListUndoParaRange=function(){return this._listManager?this._selection.getParaRange(this._listManager.lastUpdateGcp-1):null},t.prototype.replaceList=function(t,e,n){var r=void 0;e.listId&&!(r=this.getListTemplateId(e.listId))||this.modifyListParaProps(t,e.listId,r,e.listLevelRule,n)},t.prototype.modifyListParaProps=function(t,e,n,r,i,o){var s=this,l=o||this.deltaOption(this.selectionRange).buildDelta();if(this._listManager){var p=this._listManager.getWholeListByListId(t);if(p.length>0){var c=this.getListLevelLimit(n||p[0].listTemplateId),h=p[0].listTemplateId,u=J({type:a.ListLevelRuleType.auto},r),g=this.createListParaProperty(u,e,n),d=0;p.forEach((function(t){if(!i||i(t)){var e=new a.GCPRange(t.gcp-1,1),n=g;if(u.type===a.ListLevelRuleType.relative&&u.value){var r=s.getValidLevel(t.listLevel+u.value,c);r!==t.listLevel&&((n=g.clone()).listLevel=r)}n.equalTo(Xt)||l.setParagraphProperty(e,n),d+=1}})),this._listManager.getListsByListTemplateId(h).length===d&&this.removeTemplatesById(h,l)}}this.applyDelta(l,o)},t.prototype.modifyListStyleset=function(t,e,n){var r=a.ListUtils.getPeriodListStyleset(e);this.forEachTemplates((function(e,i){if(i.listTemplateId===t){var o=new a.NumberingProperty,s=r[i.listLevel%r.length];o.listFmt=s.listFormat,o.lvlText=s.listText,o.characterUnitSpecialIndent=void 0!==s.listHangingIndent?s.listHangingIndent:a.Defaults.listDefaultHanging,void 0!==s.listLeftIndent&&(o.characterUnitLeftIndent=s.listLeftIndent),n.setParagraphProperty(e.getRange(),o)}return!1})),this._state.applyDelta(n)},t.prototype.modifyList=function(t,e,n){if(e.listLevelRule||e.styleset&&0!==e.styleset.length){var r=this.getListTemplateId(t);if(r){var i=void 0,o=this.deltaOption().buildDelta();if(n&&e.styleset&&e.styleset.length>0){var s=this.getListLevelLimit(r),l=this.createTemplatesFromStyleset(e.styleset,s),p=l.paragraphs,c=l.spans;p&&(i=a.ListUtils.createId(),this.modifyListParaProps(t,i,p[0].listTemplateId,e.listLevelRule,n,o),this.insertListTemplates(p,o,c))}else e.listLevelRule&&this.modifyListParaProps(t,void 0,void 0,e.listLevelRule,n,o),e.styleset&&e.styleset.length>0&&this.modifyListStyleset(r,e.styleset,o);return this.applyDelta(o),i}}},t.prototype.combineIndents=function(t,e,n,r){var i=J({ignoreHangingIndent:!0,characterUnit:!1},r);if(0===e.characterUnitIndent&&0===e.valueIndent)return t;if((e.characterUnitIndent<0||e.valueIndent<0)&&i.ignoreHangingIndent)return t;var o=e.valueIndent;if(0!==e.characterUnitIndent){var s=this._textStream.createSpanIterator(n);s.seek(n.begin());var l=s.getProperty(!0);o=(l?l.fontSize:a.Defaults.fontSize)*e.characterUnitIndent}return i.characterUnit||0!==t.characterUnitIndent||0===t.valueIndent?{characterUnitIndent:t.characterUnitIndent+Math.abs(o/a.Defaults.fontSize),valueIndent:0}:{characterUnitIndent:0,valueIndent:t.valueIndent+Math.abs(o)}},t.prototype.convertListIndentIntoParagraph=function(t,e,n){if(this._listManager){var r=this._listManager.getListInfoFromGcpRange(e);if(r){var i=this.combineIndents(r.leftIndentConfig,r.specialIndentConfig,e,{ignoreHangingIndent:n}),o=t;0!==i.characterUnitIndent&&(o.characterUnitLeftIndent=i.characterUnitIndent),o.leftIndent=i.valueIndent}}},t.prototype.cancelListParagraph=function(t,e,n){var r=e.getRange(),i=new a.ParaProperty;i.listId="",i.listTemplateId="",i.listLevel=-1,this.convertListIndentIntoParagraph(i,r,t),n.setParagraphProperty(r,i)},t.prototype.findListStory=function(){return this._textStream.findStoryInfoFromId(a.StoryID.ListTemplateId)||this._textStream.findStoryInfoFromId(a.StoryID.ListTemplateIdCompt)},t.prototype.ensureListStory=function(){var t=this.findListStory();t&&a.ListManager.isListTemplateStory(t.storyProp.storyId)||this._document.insertStory(a.StoryType.ListTemplateStory,a.StoryID.ListTemplateId,void 0,void 0)},t.prototype.insertListTemplates=function(t,e,n){var r,i=this.findListStory(),o=!(!i||!a.ListManager.isListTemplateStory(i.storyProp.storyId));if(e&&!o){var l=e.operations.find((function(t){return t instanceof a.InsertStoryBeginOperation&&t.param.storyProp.storyId===a.StoryID.ListTemplateId}));if(!l)return void s.Logger.error("Story ListTemplate not existed even in delta");var p=l.param;r=p.range.begin()+l.changeLen}else if(e&&!o)return void s.Logger.error("Story ListTemplate not existed");if(!r&&i&&(r=i.range.gcpBegin),void 0!==r){var c=i&&e?a.OperationUtil.getFixPos(e.operations,r):r;e&&e.operations.forEach((function(e){e.dirtyRange&&e.dirtyRange.end()>r&&a.OperationUtil.moveOffset(e,t.length)})),e.moveTo(new a.GCPRange(c,0)),t.forEach((function(t,r){var i=(null==n?void 0:n[r])?n[r]:new a.ParaBreakSpan;e.insertParagraph(e.currentRange().end(),i,t)}))}else s.Logger.error("Story ListTemplate not existed")},t.prototype.forEachTemplates=function(t){var e=this.findListStory();if(e){var n=this._textStream.createParagraphIterator(e.range);do{var r=n.getProperty(!0);if(r instanceof a.NumberingProperty&&t(n,r))return}while(n.next())}},t.prototype.parseTemplateLeveLimit=function(t){if(t.length>0){var e=0;return t.forEach((function(t){var n=t.listLevel;n>e&&(e=n)})),e+1}return a.Defaults.listLevelLimit},t.prototype.getRawTemplatesById=function(t){var e=[];return this.forEachTemplates((function(n,r){return r.listTemplateId===t&&e.push(r),!1})),e},t.prototype.getTemplateById=function(t,e){var n=void 0;return this.forEachTemplates((function(r,i){return i.listTemplateId===t&&i.listLevel===e&&(n=i,!0)})),n},t.prototype.getTemplatesById=function(t){var e=this.getRawTemplatesById(t);if(e.length>0){if(e[0].isTask)return[e[0]];var n=this.parseTemplateLeveLimit(e);e.length>n&&(e=e.slice(0,n))}return e.sort((function(t,e){return t.listLevel-e.listLevel}))},t.prototype.removeTemplatesById=function(t,e){var n=null;this.forEachTemplates((function(e,r){return r.listTemplateId===t&&(n=n?n.unionRange(e.getRange()):e.getRange()),!1})),n&&e.deleteText(a.OperationUtil.getFixedGcpRange(e.operations,n))},t.prototype.cancelListInRange=function(t,e){var n=this;void 0===e&&(e=!0);var r=this.getValidListOpRange(t),i=this.deltaOption(this.selectionRange,!1).buildDelta(),o=new Map,s=this._state.getRWTextStream().createParagraphIterator(r);do{var l=s.getProperty(!0);if((null==l?void 0:l.listId)&&l.listTemplateId){this.cancelListParagraph(e,s,i);var p=o.get(l.listTemplateId);o.set(l.listTemplateId,void 0===p?1:p+1)}}while(s.next());var c=this.needRangeFixAfterListTemplateOps(r);return o.forEach((function(t,e){n._listManager&&n._listManager.getListsByListTemplateId(e).length===t&&n.removeTemplatesById(e,i)})),this.applyDelta(i),c?a.OperationUtil.getFixedGcpRange(i.operations,r):r},t.prototype.cancelList=function(t,e){var n=this;if(void 0===e&&(e=!0),this._listManager){var r=this.deltaOption(this.selectionRange,!1).buildDelta(),i=this._state.getRWTextStream().createParagraphIterator(),o=this._listManager.getWholeListByListId(t);if(o.length>0){o.forEach((function(t){i.seek(t.gcp-1),n.cancelListParagraph(e,i,r)}));var a=Z(o,1)[0].listTemplateId;this._listManager.getListsByListTemplateId(a).length===o.length&&this.removeTemplatesById(a,r)}this.applyDelta(r)}},t.prototype.addListTemplates=function(t,e,n){if(this._listManager&&t.length>0&&!this._listManager.hasTemplate(t[0].listTemplateId)){this.ensureListStory();var r=e.currentRange();t.sort((function(t,e){return t.listLevel-e.listLevel}));var i=Z(t,1)[0];0===i.listLevel&&(i.isTask?this.insertListTemplates([i],e,n):(a.ListUtils.completeListTemplateParagraphs(i,t),this.insertListTemplates(t,e,n)),this._templateLevelCache.set(i.listTemplateId,t.length),e.moveTo(r))}},t.prototype.getListTemplateId=function(t){if(this._listManager)return this._listManager.getListTemplateId(t)},t.prototype.getListStyleset=function(t){var e=this.getListTemplateId(t);return e?this.getTemplatesById(e).map((function(t){return{listFormat:t.listFmt,listText:t.lvlText,listHangingIndent:t.characterUnitSpecialIndent,listLeftIndent:t.characterUnitLeftIndent}})):[]},t.prototype.setListMarkerSelection=function(t){if(this._isSelectAllLevel=void 0,this._listManager){var e=this._listManager.getListInfoFromGcpRange(this._selection.range());(null==e?void 0:e.listMarkerSpanProp)?(this._state.listMarkerSpanProp=e.listMarkerSpanProp,this._isSelectAllLevel=t):this._state.listMarkerSpanProp=null}},t.prototype.clearListMarkerSelection=function(){this._isSelectAllLevel=void 0,this._state.listMarkerSpanProp=null},t}(),qt=function(){function t(t,e){this._state=t,this._service=e}return t.prototype.replaceWithMarkdownFormat=function(t,e,n,r){var i=this.convertToMarkdown(t,e,n,r);i&&this._state.applyDelta(i)},t.prototype.convertToMarkdown=function(t,e,n,r,i){var o=null;switch(n){case a.MarkdownParserType.Headline:o=this.replaceWithHeadlineFormat(t,e,r,i);break;case a.MarkdownParserType.BulletList:o=this.replaceWithBulletList(t,e,r,i);break;case a.MarkdownParserType.TaskList:o=this.replaceWithTaskList(t,e,r,i);break;case a.MarkdownParserType.Codeblock:o=this.replaceWithCodeblock(t,e,r,i);break;case a.MarkdownParserType.Horizontal:o=this.replaceWithHorizontal(t,e,r,i)}return o&&o.setUpdateSelection(!0),o},t.prototype._deltaOption=function(t,e){return void 0===e&&(e=!1),a.DeltaOption.createLocalDeltaOption(t,e)},t.prototype.replaceWithHeadlineFormat=function(t,e,n,r){var i=r&&r.externalDelta||this._deltaOption(t).buildDelta();i.clearSpanProperty(t,a.OutlineClearSpanProps);var o=new a.ParaProperty;o.styleName=n,i.setParagraphProperty(t,o);var s=new a.GCPRange(t.begin(),e);return i.deleteText(s),i},t.prototype.replaceWithCodeblock=function(t,e,n,r){var i=new a.GCPRange(t.begin(),t.length()+1),o={storyId:s.StringUtil.generateRandomId(),content:"",storyType:a.StoryType.CodeblockStory},l=new a.CodeblockProperty;return l.anchorId=o.storyId,l.language=n.length?n:"plain text",l.theme="normal",this._service.getTextFrame().addTextFrame(o,l,!0,"melo-codeblock-base-char","melo-codeblock-base-para",i),null},t.prototype.replaceWithBulletList=function(t,e,n,r){var i={listFormat:a.ListFormat.Bullet,listText:a.BulletText.Circle};return this.replaceWithList(t,e,i,n,r)},t.prototype.replaceWithTaskList=function(t,e,n,r){var i={listFormat:a.ListFormat.Task,listText:n};return this.replaceWithList(t,e,i,n,r)},t.prototype.replaceWithList=function(t,e,n,r,i){this._service.getNumbering().createListInRange(new a.GCPRange(t.begin(),0),{styleset:[n]});var o=i&&i.externalDelta||this._deltaOption(t).buildDelta();return o.deleteText(new a.GCPRange(t.begin(),e)),o},t.prototype.replaceWithHorizontal=function(t,e,n,r){var i=new a.GCPRange(t.begin(),e),o=this._deltaOption(i,!0);return ft.createStateInlineShapes(this._state,o,a.DrawingType.Splitline).addSplitline(n,"#000000",{wrapAfter:!0}),null},t}(),Zt=function(){function t(t){this._state=t,this._textStream=this._state.dataEngine.getRWTextStream()}return t.prototype._gcpRange=function(){return this._state.selection.gcpRange},t.prototype._deltaOption=function(t,e){return void 0===t&&(t=!0),void 0===e&&(e=!0),a.DeltaOption.createLocalDeltaOption(this._gcpRange(),t,e)},t.prototype._addTextFrameStory=function(t,e,n,r,i){var o=t.currentRange();t.moveTo(new a.GCPRange(e,0));var s=n.storyId,l=n.content&&n.content.length>0?n.content:"\n",p=n.storyType,c=new a.StoryProperty;c.storyId=s,c.storyType=p,t.insertStoryBegin(t.currentRange().end(),c,a.PlaceholderChar.StoryBegin);var h=l[l.length-1]===a.PlaceholderChar.ParagraphBreak,u=l.split("\n"),g=h?u.length-1:u.length,d=new a.TextSpan;r&&r.length>0&&(d.styleName=r);var f=new a.ParaBreakSpan(d),y=new a.ParaProperty;i&&i.length>0&&(y.styleName=i);for(var T=0;T<g;T++){var m=u[T%g];t.insertSpan(t.currentRange().end(),m,d),t.insertParagraph(t.currentRange().end(),f,y)}t.insertStoryEnd(t.currentRange().end(),c.clone(),a.PlaceholderChar.StoryEnd),t.moveTo(o)},t.prototype.addTextFrame=function(t,e,n,r,i,o){void 0===n&&(n=!0);var s=this._deltaOption(n).buildDelta(),l=o||this._gcpRange(),p=this._textStream.createStoryIterator();this._addTextFrameStory(s,p.getLastStoryEndPos(),t,r,i);var c=this._state.followParaProp(s.currentRange().end());this._truncateWithRange(s,l),s.setParagraphProperty(new a.GCPRange(s.currentRange().end(),0),c.paraProp,a.TDSetPropMode.Cover);var h=new a.ParaBreakSpan,u=new a.ParaProperty;if(s.insertDrawing(s.currentRange().end(),e),s.insertParagraph(s.currentRange().end(),h,u),this._state.applyDelta(s),n){var g=this._textStream.findStoryInfoFromId(t.storyId);if(g){var d=new a.GCPRange(g.range.begin(),0);this._state.setRangeTo(d,{forceFocus:!0})}}},t.prototype._truncateWithRange=function(t,e){var n=this._textStream.createParagraphIterator(e).getProperty();n||(n=new a.ParaProperty);var r=this._textStream.createSpanIterator(e).getProperty(!0);r&&r instanceof a.ParaBreakSpan||(r=new a.ParaBreakSpan),t.moveTo(e),t.deleteText(e),t.insertParagraph(t.currentRange().end(),r,n)},t.prototype.addPasteTextFrameStory=function(t,e,n,r){for(var i=t.currentRange().end(),o=this._textStream.createStoryIterator().getLastStoryEndPos(),s=0;s<e.length;s++){var l=e[s],p=a.DeltaOption.createLocalDeltaOption(a.GCPRange.emptyRange()).buildDelta();this._addTextFrameStory(p,o,l,n,r),p.operations.length>0&&p.operations.forEach((function(e,n){t.insertOperation(e.clone(),n,!1)}))}t.moveTo(new a.GCPRange(i,0))},t.prototype.removeTextFrame=function(t){var e=this._state.dataEngine.getContainerManager();if(e){var n=e.getAnchorRange(t);if(n){var r=this._textStream.findStoryInfoFromId(t);if(r){var i=this._deltaOption().buildDelta(),o=this._textStream.createStoryIterator(r.range).getRange();i.deleteText(o),i.deleteText(n),this._state.applyDelta(i)}}}},t.prototype.getTextFramePropFromAnchorId=function(t){var e=this._state.dataEngine.getContainerManager();if(e){var n=e.getAnchorRange(t);if(n)return this._textStream.createSpanIterator(n).getProperty()}return null},t.prototype.setTextFrameParaStyle=function(t,e,n){void 0===n&&(n=!1);var r=this._textStream.findStoryInfoFromId(t);if(r){var i=this._deltaOption(!1,!1).buildDelta(),o=new a.ParaProperty;o.styleName=e,i.setParagraphProperty(r.range,o),n&&i.clearSpanProperty(r.range,[a.SpanPropKey.styleName]),this._state.applyDelta(i)}},t.prototype.setTextFrameSpansStyle=function(t,e,n){var r=this._textStream.findStoryInfoFromId(t);if(r){var i=this._deltaOption(!1,!1).buildDelta();e.forEach((function(t){var e=t.length,o=r.range.begin()+n+t.start,s=new a.GCPRange(o,e),l=new a.TextSpan;l.styleName=t.type,i.setSpanProperty(s,l)})),this._state.applyDelta(i)}},t.prototype.findPrevTextFrame=function(t){if(t.isEmpty()){var e=this._textStream.createStoryIterator(t).getProperty(!0);return e&&e.storyType===a.StoryType.MainTextStory?this._findPrevCharacter(t.begin(),!0):null}return null},t.prototype._findPrevCharacter=function(t,e){void 0===e&&(e=!1);var n=new a.GCPRange(t,0),r=a.GraphemeBreakerTool.previousTextBreak(this._state.getTextStream(),n.begin()),i=this._textStream.createSpanIterator(new a.GCPRange(r,0)).getProperty();if(i){if(i instanceof a.TextframeProperty)return i;if(e&&i instanceof a.ParaBreakSpan)return this._findPrevCharacter(r)}return null},t}(),$t=function(){function t(t){this._state=t}var e;return t.prototype.getSelection=function(){return this._selection||(this._selection=new Vt(this._state)),this._selection},t.prototype.getDocument=function(){return this._document||(this._document=new Yt(this._state)),this._document},t.prototype.getTranslate=function(){return this._translate||(this._translate=new zt(this._state)),this._translate},t.prototype.getTextFrame=function(){return this._textFrame||(this._textFrame=new Zt(this._state)),this._textFrame},t.prototype.getNumbering=function(){return this._numbering||(this._numbering=new Qt(this._state,this.getSelection(),this.getDocument())),this._numbering},t.prototype.getMarkdown=function(){return this._markdown||(this._markdown=new qt(this._state,this)),this._markdown},function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}([(0,e=a.IState,function(t,n){e(t,n,0)}),X("design:paramtypes",[a.State])],t)}(),te=function(t){t.factory.inject(a.IService,Object(a.createDescriptor)($t))},ee=void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},ne=function(t,e){return(ne=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function re(t,e){function n(){this.constructor=t}ne(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function ie(t,e){return function(n,r){e(n,r,t)}}function oe(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function ae(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function se(t,e){void 0===e&&(e={});var n=e.insertAt;if(t&&"undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t))}}se(".melo-caret {\n  will-change: opacity;\n  z-index: 20;\n  pointer-events: none;\n  cursor: text;\n  border-left: 1px solid; }\n  .melo-caret.mobile {\n    border-left: 2px solid;\n    will-change: visibility; }\n\n.melo-caret-blink {\n  animation: fadeoutin-blink 1s infinite linear; }\n  .melo-caret-blink.mobile {\n    animation: fadeoutin-blink-mobile 1s infinite linear; }\n\n@keyframes fadeoutin-blink {\n  from {\n    opacity: 1; }\n  13%, 50% {\n    opacity: 0; }\n  63%, to {\n    opacity: 1; } }\n\n@keyframes fadeoutin-blink-mobile {\n  from {\n    visibility: visible; }\n  13%, 50% {\n    visibility: hidden; }\n  63%, to {\n    visibility: visible; } }\n");var le=function(t){function e(e){var n=t.call(this,e)||this;return n.timeout=0,n.viewRange=null,n.state={posX:0,posY:0,caretHeight:0,isCaret:!0,isBlink:!1,focus:!1,exceeded:!1,caretColor:a.TDConstants.Undefined,caretItalic:a.TDConstants.Undefined,blockCaretShow:!1},n}return re(e,t),e.prototype.componentDidMount=function(){this.props.context.on(a.HiddenEditorNotificationType.ON_POS_UPDATE,this.onPosUpdate,this),this.props.context.on(a.FocusBlurNotificationType.ON_FOCUS,this.onFocus,this),this.props.context.on(a.FocusBlurNotificationType.ON_BLUR,this.onBlur,this),this.props.context.on(a.RenderNotificationTypes.TABLE_DID_SCROLL,this.onTableScroll,this)},e.prototype.componentWillUnmount=function(){this.props.context.removeListener(a.HiddenEditorNotificationType.ON_POS_UPDATE,this),this.props.context.removeListener(a.FocusBlurNotificationType.ON_FOCUS,this),this.props.context.removeListener(a.FocusBlurNotificationType.ON_BLUR,this),this.props.context.removeListener(a.RenderNotificationTypes.TABLE_DID_SCROLL,this)},e.prototype.componentDidUpdate=function(){var t=this;clearTimeout(this.timeout),this.timeout=setTimeout((function(){t.isVisible()&&t.setState({isBlink:!0})}),500)},e.prototype.onPosUpdate=function(t){t&&t.data instanceof a.ViewRange&&(this.viewRange=t.data,this.update(t.data))},e.prototype.update=function(t){if(this.props.context.isEditable()&&t.isCaret()){var e=Object(a.getFollowedViewRangePoint)(t.start),n=e.getDocumentOffset(this.props.zoom()),r=n.x,i=n.y,o=n.docLeft,s=n.docTop,l=n.docRight,p=n.docBottom;if(r<o||r>l||i<s||i>p)this.setState({exceeded:!0,isBlink:!1});else{var c=e.caretHeight(),h=this.props.service.getSelection().getFont().getTextColor(),u=this.props.service.getSelection().getFont().isItalic();this.setState({posX:r,posY:i,caretHeight:c,isCaret:t.isCaret(),isBlink:!1,focus:!0,exceeded:!1,caretColor:h,caretItalic:u})}}else this.setState({isCaret:!1,isBlink:!1})},e.prototype.onFocus=function(){this.props.context.isEditable()&&this.viewRange&&this.viewRange.isCaret()&&this.setState({focus:!0,isBlink:!1})},e.prototype.onBlur=function(){this.setState({focus:!1,isBlink:!1})},e.prototype.getTransform=function(){return this.state.caretItalic?s.PlatformUtil.isIE()||s.PlatformUtil.isWeWorkWin()?"rotate(19deg)":"rotate(13deg)":""},e.prototype.getTransformOrigin=function(){return this.state.caretItalic?"right 80%":"center center"},e.prototype.isVisible=function(){return this.state.isCaret&&this.state.focus&&!this.state.exceeded&&!this.state.blockCaretShow},e.prototype.onTableScroll=function(){var t=this;this.setState({blockCaretShow:!0}),this.onTableScrollTimeout||(this.onTableScrollTimeout=Object(s.debounce)((function(){t.setState({blockCaretShow:!1}),t.viewRange&&t.isVisible()&&(t.viewRange.start.clearCache(),t.viewRange.end.clearCache(),t.update(t.viewRange))}),500)),this.onTableScrollTimeout()},e.prototype.render=function(){var t=["melo-caret"];return s.PlatformUtil.isMobile()&&t.push("mobile"),this.state.isBlink&&!this.state.blockCaretShow&&t.push("melo-caret-blink"),h.a.createElement("div",{className:t.join(" "),style:{position:"absolute",height:this.state.caretHeight,left:this.state.posX,top:this.state.posY,opacity:this.isVisible()?1:0,borderColor:this.state.caretColor&&this.state.caretColor!==a.TDConstants.Undefined?this.state.caretColor:"#1e6fff",transform:this.getTransform(),transformOrigin:this.getTransformOrigin()}})},e}(h.a.Component);se("#melo-hidden-editor {\n  position: absolute;\n  width: 50px;\n  height: 5px;\n  font-size: 1px;\n  z-index: -2;\n  overflow: hidden;\n  opacity: 0;\n  background: transparent;\n  color: transparent;\n  outline: none;\n  caret-color: transparent;\n  transform: scale(0.1, 0.1);\n  white-space: pre-wrap; }\n\n#melo-hidden-editor-mobile {\n  position: absolute;\n  width: 5px;\n  height: 5px;\n  z-index: -2;\n  overflow: hidden;\n  opacity: 0;\n  background: transparent;\n  color: transparent;\n  outline: none;\n  caret-color: transparent;\n  transform: scale(0.1, 0.1); }\n\nbody {\n  -webkit-touch-callout: none; }\n");var pe=function(t){function e(e){var n=t.call(this,e)||this;return n.isFocus=!1,n.inputDomRef=null,n.compositionId="",n.viewRange=null,n.forceFocus=!0,n.spaceReg=new RegExp(a.PlaceholderChar.NonBreakSpace,"g"),n.props.viewRange&&(n.viewRange=n.props.viewRange),n.state={posX:0,posY:0},n}return re(e,t),e.prototype.componentDidMount=function(){var t=this;this.props.context.on(a.MouseNotificationType.MOUSE_EVENT,this.onMouseEvent,this),this.props.context.on(a.RenderNotificationTypes.CARET_CHANGE,this.onSelectionChanged,this),this.props.context.on(a.FocusBlurNotificationType.REQUEST_FOCUS,this.onRequestFocus,this),this.props.context.on(a.FocusBlurNotificationType.REQUEST_BLUR,this.onRequestBlur,this),setTimeout((function(){t.viewRange&&(t.forceFocus=!0,t.update())}))},e.prototype.componentWillUnmount=function(){this.props.context.removeListener(a.MouseNotificationType.MOUSE_EVENT,this),this.props.context.removeListener(a.RenderNotificationTypes.CARET_CHANGE,this),this.props.context.removeListener(a.FocusBlurNotificationType.REQUEST_FOCUS,this),this.props.context.removeListener(a.FocusBlurNotificationType.REQUEST_BLUR,this)},e.prototype.componentDidUpdate=function(){this.setFocusWeb()},e.prototype.onMouseEvent=function(t){!t||t.mouseAction!==a.MouseAction.CLICK&&t.mouseAction!==a.MouseAction.DOUBLE_CLICK&&t.mouseAction!==a.MouseAction.TRIPLE_CLICK&&t.mouseAction!==a.MouseAction.LONG_CLICK||(this.forceFocus=!0,this.update())},e.prototype.onSelectionChanged=function(t){(null==t?void 0:t.viewRange)&&(this.viewRange=t.viewRange,t.option&&void 0!==t.option.forceFocus?this.forceFocus=t.option.forceFocus:this.forceFocus=!0,this.update())},e.prototype.onRequestFocus=function(t){var e;(null===(e=null==t?void 0:t.data)||void 0===e?void 0:e.viewRange)&&(this.viewRange=t.data.viewRange),this.forceFocus=!0,this.update()},e.prototype.onRequestBlur=function(){this.inputDomRef&&this.inputDomRef.blur()},e.prototype.setFocusWeb=function(){var t=this.props.scrollHandler.getScrollLeft(),e=this.props.scrollHandler.getScrollTop();this.inputDomRef&&this.inputDomRef.focus({preventScroll:!0}),this.props.scrollHandler.scrollTo(t,e)},e.prototype.update=function(){if(this.viewRange&&(this.isFocus||this.forceFocus)){var t=this.viewRange.start.getDocumentOffset(this.props.zoom());t.x=t.x<t.docLeft?t.docLeft:t.x,t.x=t.x>t.docRight?t.docRight:t.x,t.y=t.y<t.docTop?t.docTop:t.y,t.y=t.y>t.docBottom?t.docBottom:t.y;var e=this.viewRange.start.caretHeight();this.setState({posX:t.x,posY:t.y+e-5}),this.props.context.fire(new a.HiddenEditorNotification(a.HiddenEditorNotificationType.ON_POS_UPDATE,this.viewRange),!1)}},e.prototype.onCompositionStart=function(){this.props.context.isEditable()&&(this.compositionId="input_"+s.StringUtil.generateRandomId(),this.props.state.compositionStart(this.compositionId,!0),this.props.context.fire(new a.HiddenEditorNotification(a.HiddenEditorNotificationType.ON_COMPOSITION_START,null)))},e.prototype.onCompositionUpdate=function(t){if(this.props.context.isEditable()){var e;e=s.PlatformUtil.isIE()&&this.inputDomRef?this.inputDomRef.textContent:t.nativeEvent.data,this.props.state.compositionUpdate(this.compositionId,e,!0)}},e.prototype.onCompositionEnd=function(t){if(this.props.context.isEditable()){var e;e=s.PlatformUtil.isIE()&&this.inputDomRef?this.inputDomRef.textContent:t.nativeEvent.data,this.props.state.compositionEnd(this.compositionId,e,!0),this.props.context.fire(new a.HiddenEditorNotification(a.HiddenEditorNotificationType.ON_COMPOSITION_END,e))}this.inputDomRef&&(this.inputDomRef.textContent=""),this.compositionId=""},e.prototype.onInput=function(){var t=this;setTimeout((function(){t.compositionId.length<=0&&t.finishInput()}),0)},e.prototype.onKeyUp=function(){var t=this;s.PlatformUtil.isIE()&&setTimeout((function(){t.compositionId.length<=0&&t.finishInput()}),100)},e.prototype.finishInput=function(){if(this.inputDomRef){var t=this.inputDomRef.textContent;this.inputDomRef.textContent="",this.props.context.isEditable()&&t&&(t=t.replace(this.spaceReg,a.PlaceholderChar.Space),this.props.service.getSelection().typeText(t),this.props.context.fire(new a.HiddenEditorNotification(a.HiddenEditorNotificationType.ON_INPUT,t)))}},e.prototype.onClipboardEvent=function(t){t.preventDefault()},e.prototype.onFocus=function(t){t.preventDefault(),this.isFocus=!0,this.props.context.fire(new a.FocusBlurNotification(a.FocusBlurNotificationType.ON_FOCUS))},e.prototype.onBlur=function(t){var e=this;t.preventDefault(),this.isFocus=!1,setTimeout((function(){e.isFocus||e.props.context.fire(new a.FocusBlurNotification(a.FocusBlurNotificationType.ON_BLUR))}),300)},e.prototype.render=function(){var t=this;return h.a.createElement("div",{id:"melo-hidden-editor",contentEditable:s.PlatformUtil.isSafari()?"plaintext-only":"true",ref:function(e){t.inputDomRef=e},onInput:this.onInput.bind(this),onKeyUp:this.onKeyUp.bind(this),onCompositionStart:this.onCompositionStart.bind(this),onCompositionUpdate:this.onCompositionUpdate.bind(this),onCompositionEnd:this.onCompositionEnd.bind(this),onCopy:this.onClipboardEvent.bind(this),onCut:this.onClipboardEvent.bind(this),onPaste:this.onClipboardEvent.bind(this),onFocus:this.onFocus.bind(this),onBlur:this.onBlur.bind(this),spellCheck:!1,tabIndex:-1,style:{left:this.state.posX,top:this.state.posY}})},e}(h.a.Component),ce="melo-mobile-drag-container",he="melo-mobile-selection-caret";se(".melo-caret-drag-trans-anim {\n  visibility: hidden;\n  opacity: 0;\n  transition: visibility 0s 0.3s, opacity 0.3s linear; }\n\n.melo-mobile-drag-container {\n  position: absolute;\n  width: 30px;\n  height: 30px;\n  touch-action: none;\n  z-index: 1000; }\n\n.melo-mobile-caret-container {\n  z-index: 20; }\n\n.melo-mobile-caret-drag {\n  position: absolute;\n  width: 22px;\n  height: 22px;\n  left: 4px;\n  background-size: 22px 22px;\n  background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAMAAADUivDaAAAAulBMVEUAAAAAAAAAAAAAAAAAAAAAAAABAQIAAAAAAAAAAAEAAAAAAAAAAAAAAAABAQEAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAgUAAAAAAAAAAAAAAAAebv0AAAAda/UebPkeb/4da/Uebv0davIYVsccZ+4bZugaYdseb/0bZOMebvoaYdwYVcMdbPUVT7QaX9kcZOYXV8YdavMSQ5YQNXUUSaMURJYYUrYdYdcEDx4IIUIMLl0eb//7OILBAAAAPXRSTlMAAwYJEAwOFSIbGComMBMeNy06PjRHREBdUE1XSvVT4vDr6+XKq4+CYdvXw8O3r6ekm5iTjYOCZlRHRR8W4EPPmwAAAoxJREFUWMPt19l2okAQBuDJiAiI0NDSqMG4xWj2fQ/v/1pTBViHDHShx5Nc+d941Z9VBTTNn0MOOWSvHEH2WlzOXuspOwN/v2UnhNa3SiFlW6FY3263TQj8FErF4AFY/f54eT4en18+voNTQVgB/9/8Ws1Symz1ZWItZDQLprFepN+yWBsmGU0CAsZZWsmZAUiTQYJ3k9bkxiOjUejkNVTr6JDRJKxTTdYNBgmfCx2x+CRDV0SrBYKzSrVZOWC0WliGtgjDc+yZnpjZjmfoygAX2/A69lvK5M3ueNAKlqErouP49xxx7zsdXRn5JKAN65QjTi1oJZ9GfR9YhDvhiImLZVAnlT7gctiWO+aIsWvZeFGwE00fvtXlia7lazrJ+wDCDfhGAtfH66olsI+AH2eAndQRR0R0e3cccdfrEnFUJcyceOWI15wweSKc6oVpuB3xoCcetiPEx1wnzD8ET7QLQr7oiBcpyuPUXlQh1bJeWCop6KJyt1Y/VMlVnXCVqLBPtxZ3g/dEHI2WNTWMolj02Bu8mCeUIVUyfJr/N8mnYaJkP+AeM3rYcaDR6GRwO00p09vBySjCYZYedv2Wg9OIwTgePF9fTMbjycX18+AYhBgnQVsOs/HhNDJjCEgeAIaZgJOgjY/Zfi1sJYxVgggGgUTFIbZh6bdfKiNrBeuQKgIEA0CkJNSAAr0EuFdRYQgZKxVFSRJFSsVS5ALzKqIyNkYASChlDJEyBCDYCLoikCgbBSJEGApRACWBCMbwLReQoJclAMC1/IrAGV6GoILB9RngcQIRZCACSh4fARKIYIwN4thFnBzY7cgHCCgUzwBAI7BHV4PCHV13P0D/yjGe/5j4hU8aXvnJz7t/8b7R8dRLsvkAAAAASUVORK5CYII=); }\n\n.melo-mobile-selection-drag-left {\n  position: absolute;\n  width: 22px;\n  height: 22px;\n  left: 4px;\n  top: 8px;\n  background-size: 22px 22px;\n  background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAMAAADUivDaAAAAulBMVEUAAAAAAAAAAAAAAAAAAAAAAAABAQIAAAAAAAAAAAEAAAAAAAAAAAAAAAABAQEAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAgUAAAAAAAAAAAAAAAAebv0AAAAda/UebPkeb/4da/Uebv0davIYVsccZ+4bZugaYdseb/0bZOMebvoaYdwYVcMdbPUVT7QaX9kcZOYXV8YdavMSQ5YQNXUUSaMURJYYUrYdYdcEDx4IIUIMLl0eb//7OILBAAAAPXRSTlMAAwYJEAwOFSIbGComMBMeNy06PjRHREBdUE1XSvVT4vDr6+XKq4+CYdvXw8O3r6ekm5iTjYOCZlRHRR8W4EPPmwAAAoxJREFUWMPt19l2okAQBuDJiAiI0NDSqMG4xWj2fQ/v/1pTBViHDHShx5Nc+d941Z9VBTTNn0MOOWSvHEH2WlzOXuspOwN/v2UnhNa3SiFlW6FY3263TQj8FErF4AFY/f54eT4en18+voNTQVgB/9/8Ws1Symz1ZWItZDQLprFepN+yWBsmGU0CAsZZWsmZAUiTQYJ3k9bkxiOjUejkNVTr6JDRJKxTTdYNBgmfCx2x+CRDV0SrBYKzSrVZOWC0WliGtgjDc+yZnpjZjmfoygAX2/A69lvK5M3ueNAKlqErouP49xxx7zsdXRn5JKAN65QjTi1oJZ9GfR9YhDvhiImLZVAnlT7gctiWO+aIsWvZeFGwE00fvtXlia7lazrJ+wDCDfhGAtfH66olsI+AH2eAndQRR0R0e3cccdfrEnFUJcyceOWI15wweSKc6oVpuB3xoCcetiPEx1wnzD8ET7QLQr7oiBcpyuPUXlQh1bJeWCop6KJyt1Y/VMlVnXCVqLBPtxZ3g/dEHI2WNTWMolj02Bu8mCeUIVUyfJr/N8mnYaJkP+AeM3rYcaDR6GRwO00p09vBySjCYZYedv2Wg9OIwTgePF9fTMbjycX18+AYhBgnQVsOs/HhNDJjCEgeAIaZgJOgjY/Zfi1sJYxVgggGgUTFIbZh6bdfKiNrBeuQKgIEA0CkJNSAAr0EuFdRYQgZKxVFSRJFSsVS5ALzKqIyNkYASChlDJEyBCDYCLoikCgbBSJEGApRACWBCMbwLReQoJclAMC1/IrAGV6GoILB9RngcQIRZCACSh4fARKIYIwN4thFnBzY7cgHCCgUzwBAI7BHV4PCHV13P0D/yjGe/5j4hU8aXvnJz7t/8b7R8dRLsvkAAAAASUVORK5CYII=); }\n\n.melo-mobile-selection-drag-right {\n  position: absolute;\n  width: 22px;\n  height: 22px;\n  left: 4px;\n  background-size: 22px 22px;\n  background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAMAAADUivDaAAAAulBMVEUAAAAAAAAAAAAAAAAAAAAAAAABAQIAAAAAAAAAAAEAAAAAAAAAAAAAAAABAQEAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAgUAAAAAAAAAAAAAAAAebv0AAAAda/UebPkeb/4da/Uebv0davIYVsccZ+4bZugaYdseb/0bZOMebvoaYdwYVcMdbPUVT7QaX9kcZOYXV8YdavMSQ5YQNXUUSaMURJYYUrYdYdcEDx4IIUIMLl0eb//7OILBAAAAPXRSTlMAAwYJEAwOFSIbGComMBMeNy06PjRHREBdUE1XSvVT4vDr6+XKq4+CYdvXw8O3r6ekm5iTjYOCZlRHRR8W4EPPmwAAAoxJREFUWMPt19l2okAQBuDJiAiI0NDSqMG4xWj2fQ/v/1pTBViHDHShx5Nc+d941Z9VBTTNn0MOOWSvHEH2WlzOXuspOwN/v2UnhNa3SiFlW6FY3263TQj8FErF4AFY/f54eT4en18+voNTQVgB/9/8Ws1Symz1ZWItZDQLprFepN+yWBsmGU0CAsZZWsmZAUiTQYJ3k9bkxiOjUejkNVTr6JDRJKxTTdYNBgmfCx2x+CRDV0SrBYKzSrVZOWC0WliGtgjDc+yZnpjZjmfoygAX2/A69lvK5M3ueNAKlqErouP49xxx7zsdXRn5JKAN65QjTi1oJZ9GfR9YhDvhiImLZVAnlT7gctiWO+aIsWvZeFGwE00fvtXlia7lazrJ+wDCDfhGAtfH66olsI+AH2eAndQRR0R0e3cccdfrEnFUJcyceOWI15wweSKc6oVpuB3xoCcetiPEx1wnzD8ET7QLQr7oiBcpyuPUXlQh1bJeWCop6KJyt1Y/VMlVnXCVqLBPtxZ3g/dEHI2WNTWMolj02Bu8mCeUIVUyfJr/N8mnYaJkP+AeM3rYcaDR6GRwO00p09vBySjCYZYedv2Wg9OIwTgePF9fTMbjycX18+AYhBgnQVsOs/HhNDJjCEgeAIaZgJOgjY/Zfi1sJYxVgggGgUTFIbZh6bdfKiNrBeuQKgIEA0CkJNSAAr0EuFdRYQgZKxVFSRJFSsVS5ALzKqIyNkYASChlDJEyBCDYCLoikCgbBSJEGApRACWBCMbwLReQoJclAMC1/IrAGV6GoILB9RngcQIRZCACSh4fARKIYIwN4thFnBzY7cgHCCgUzwBAI7BHV4PCHV13P0D/yjGe/5j4hU8aXvnJz7t/8b7R8dRLsvkAAAAASUVORK5CYII=); }\n\n.melo-mobile-selection-caret {\n  position: absolute;\n  width: 2px;\n  background: #1e6fff; }\n");var ue,ge=function(t){function e(e){var n=t.call(this,e)||this;return n.isDragTouch=!1,n.onTouchMove=function(t){n.isDragTouch?(t.preventDefault(),n.updateSelection(t),s.PlatformUtil.isIOS()||n.blurOnTimeout()):s.PlatformUtil.isIOS()&&n.dragFlagTimeoutId&&clearTimeout(n.dragFlagTimeoutId)},n.selector=n.props.overlay.touchSelector,n.state={posX:0,posY:0,caretHeight:0,visible:!1,tableScrolling:!1},n}return re(e,t),e.prototype.componentDidMount=function(){s.PlatformUtil.isIOS()?this.props.context.on(a.TouchNotificationType.TOUCH_EVENT,this.onTouch,this):(this.props.context.on(a.FocusBlurNotificationType.REQUEST_FOCUS,this.onRequestFocus,this),this.props.context.on(a.HiddenEditorNotificationType.ON_POS_UPDATE,this.onPosUpdate,this),this.props.context.on(a.FocusBlurNotificationType.ON_BLUR,this.onBlur,this),this.props.context.on(a.RenderNotificationTypes.TABLE_DID_SCROLL,this.onTableScroll,this)),this.props.scrollRoot.addEventListener("touchmove",this.onTouchMove,{passive:!1})},e.prototype.componentWillUnmount=function(){s.PlatformUtil.isIOS()?this.props.context.removeListener(a.TouchNotificationType.TOUCH_EVENT,this):(this.props.context.removeListener(a.FocusBlurNotificationType.REQUEST_FOCUS,this),this.props.context.removeListener(a.HiddenEditorNotificationType.ON_POS_UPDATE,this),this.props.context.removeListener(a.FocusBlurNotificationType.ON_BLUR,this),this.props.context.removeListener(a.RenderNotificationTypes.TABLE_DID_SCROLL,this)),this.props.scrollRoot.removeEventListener("touchmove",this.onTouchMove)},e.prototype.onTouch=function(t){t.event&&("touchstart"===t.event.type?this.onTouchStart(t.event):"touchend"===t.event.type&&this.onTouchEnd(t.event))},e.prototype.onRequestFocus=function(t){(null==t?void 0:t.data)&&t.data.from===a.From.EDITOR&&this.blurOnTimeout()},e.prototype.onPosUpdate=function(t){t&&t.data instanceof a.ViewRange&&(this.viewRange=t.data,this.update(t.data))},e.prototype.update=function(t){if(this.props.context.isEditable()&&t.isCaret()){var e=Object(a.getFollowedViewRangePoint)(t.start),n=e.getDocumentOffset(this.props.zoom()),r=n.x,i=n.y,o=n.docLeft,s=n.docTop,l=n.docRight,p=n.docBottom;if(r<o||r>l||i<s||i>p)this.setState({visible:!1});else{var c=e.caretHeight(),h=t.isCaret()&&c>0;this.setState({posX:r,posY:i,caretHeight:c,visible:h})}}else this.setState({visible:!1})},e.prototype.blurOnTimeout=function(){var t=this;this.caretDragRef&&this.caretDragRef.classList.remove("melo-caret-drag-trans-anim"),this.blurTimeoutId&&clearTimeout(this.blurTimeoutId),this.blurTimeoutId=setTimeout((function(){t.caretDragRef&&(t.caretDragRef.classList.add("melo-caret-drag-trans-anim"),setTimeout((function(){t.setState({visible:!1})}),300))}),2800)},e.prototype.onBlur=function(){this.setState({visible:!1})},e.prototype.onTouchStart=function(t){var e=this;s.PlatformUtil.isIOS()?(this.dragFlagTimeoutId&&clearTimeout(this.dragFlagTimeoutId),this.dragFlagTimeoutId=setTimeout((function(){e.isDragTouch=!0,e.props.scrollHandler.disableScrollOnSelectionChanged()}),500)):(this.isDragTouch=!0,this.blurOnTimeout(),this.props.scrollHandler.disableScrollOnSelectionChanged())},e.prototype.onTouchEnd=function(t){t.preventDefault(),this.props.scrollHandler.enableScrollOnSelectionChanged(),this.selector.finishMoving(),s.PlatformUtil.isIOS()?(this.isDragTouch&&(this.isDragTouch=!1),this.dragFlagTimeoutId&&clearTimeout(this.dragFlagTimeoutId)):(this.isDragTouch=!1,this.blurOnTimeout())},e.prototype.updateSelection=function(t){var e=t.targetTouches[0];e||"touchmove"!==t.type||(e=t.changedTouches[0]);var n=e.clientX,r=s.PlatformUtil.isIOS()?e.clientY:e.clientY-this.state.caretHeight/2,i=this.props.layoutController.getLayoutBox(),o=i.__node__;if(o){var l=o.getBoundingClientRect(),p=new s.MeloPoint({x:Object(s.pxToTwips)(n-l.left),y:Object(s.pxToTwips)(r-l.top)}),c=a.BoxUtil.getLeastGrandsonByPoint(i,p),h=c[0]&&c[0].__node__;h&&(this.selector.moveBoth(n,r,h),this.selector.start&&this.props.scrollHandler.scrollByIfNeedMobileThrottle(e.clientX,e.clientY,this.selector.start))}},e.prototype.onTableScroll=function(){var t=this;this.setState({tableScrolling:!0}),this.onTableScrollTimeout||(this.onTableScrollTimeout=Object(s.debounce)((function(){t.setState({tableScrolling:!1}),t.viewRange&&t.state.visible&&(t.viewRange.start.clearCache(),t.viewRange.end.clearCache(),t.update(t.viewRange))}),500)),this.onTableScrollTimeout()},e.prototype.render=function(){var t=this;return s.PlatformUtil.isIOS()?null:h.a.createElement("div",{className:"melo-mobile-caret-container",ref:function(e){t.caretDragRef=e},style:{position:"absolute",left:this.state.posX,top:this.state.posY,visibility:this.state.visible&&!this.state.tableScrolling?"visible":"hidden"}},h.a.createElement("div",{className:"melo-mobile-caret",style:{position:"absolute",width:"2px",height:this.state.caretHeight+4,background:"#1e6fff"}}),h.a.createElement("div",{className:ce,onTouchStart:function(e){t.onTouchStart(e)},onTouchEnd:function(e){t.onTouchEnd(e)},style:{left:-14,top:this.state.caretHeight-2}},h.a.createElement("div",{className:"melo-mobile-caret-drag"})))},e}(h.a.Component),de=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)},fe="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==ee?ee:"undefined"!=typeof self?self:{},ye="object"==typeof fe&&fe&&fe.Object===Object&&fe,Te="object"==typeof self&&self&&self.Object===Object&&self,me=ye||Te||Function("return this")(),Se=function(){return me.Date.now()},ve=me.Symbol,be=Object.prototype,_e=be.hasOwnProperty,Pe=be.toString,Re=ve?ve.toStringTag:void 0,Ce=Object.prototype.toString,Ie=ve?ve.toStringTag:void 0,Ae=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":Ie&&Ie in Object(t)?function(t){var e=_e.call(t,Re),n=t[Re];try{t[Re]=void 0;var r=!0}catch(t){}var i=Pe.call(t);return r&&(e?t[Re]=n:delete t[Re]),i}(t):function(t){return Ce.call(t)}(t)},we=/^\s+|\s+$/g,Ee=/^[-+]0x[0-9a-f]+$/i,xe=/^0b[01]+$/i,Oe=/^0o[0-7]+$/i,Le=parseInt,De=function(t){if("number"==typeof t)return t;if(function(t){return"symbol"==typeof t||function(t){return null!=t&&"object"==typeof t}(t)&&"[object Symbol]"==Ae(t)}(t))return NaN;if(de(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=de(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(we,"");var n=xe.test(t);return n||Oe.test(t)?Le(t.slice(2),n?2:8):Ee.test(t)?NaN:+t},Ne=Math.max,Be=Math.min,Me=function(t){function e(e){var n=t.call(this,e)||this;return n.viewRange=null,n.optionShow=!0,n.isLeftDragTouch=!1,n.isRightDragTouch=!1,n.startPos=void 0,n.endPos=void 0,n.onTouchMove=function(t){if(n.isLeftDragTouch||n.isRightDragTouch){t.preventDefault();var e=t.targetTouches[0];e||"touchmove"!==t.type||(e=t.changedTouches[0]);var r=e.clientX,i=e.clientY,o=n.props.layoutController.getLayoutBox(),l=o.__node__;if(l){var p=l.getBoundingClientRect();r-=p.left,i-=p.top,n.isLeftDragTouch?(i+=n.state.leftLineHeight/2)>n.state.rightPosY+n.state.rightLineHeight-l.offsetTop&&(i=n.state.rightPosY+n.state.rightLineHeight/2-l.offsetTop):n.isRightDragTouch&&(i-=n.state.rightLineHeight/2)<n.state.leftPosY-l.offsetTop&&(i=n.state.leftPosY+n.state.leftLineHeight/2-l.offsetTop);var c=new s.MeloPoint({x:Object(s.pxToTwips)(r),y:Object(s.pxToTwips)(i)}),h=a.BoxUtil.getLeastGrandsonByPoint(o,c),u=h[0]&&h[0].__node__;if(u&&(n.selector.keepMoving(),n.isLeftDragTouch?n.selector.moveStart(r,i,u):n.isRightDragTouch&&n.selector.moveEnd(r,i,u),n.selector.start&&n.selector.end)){var g;g=Object(a.isBackward)(n.selector.start,n.selector.end)?n.selector.start:n.selector.end,n.props.scrollHandler.scrollByIfNeedMobileThrottle(e.clientX,e.clientY,g)}}}},n.selector=n.props.overlay.touchSelector,n.state={leftPosX:0,leftPosY:0,leftLineHeight:0,rightPosX:0,rightPosY:0,rightLineHeight:0,visible:!1,tableScrolling:!1},n}return re(e,t),e.prototype.componentDidMount=function(){this.props.context.on(a.RenderNotificationTypes.SELECTION_CHANGE,this.onSelectionChanged,this),this.props.context.on(a.FocusBlurNotificationType.ON_BLUR,this.onBlur,this),this.props.context.on(a.RenderNotificationTypes.TABLE_DID_SCROLL,this.onTableScroll,this),this.props.scrollRoot.addEventListener("touchmove",this.onTouchMove,{passive:!1})},e.prototype.componentWillUnmount=function(){this.props.context.removeListener(a.RenderNotificationTypes.SELECTION_CHANGE,this),this.props.context.removeListener(a.FocusBlurNotificationType.ON_BLUR,this),this.props.context.removeListener(a.RenderNotificationTypes.TABLE_DID_SCROLL,this),this.props.scrollRoot.removeEventListener("touchmove",this.onTouchMove)},e.prototype.onSelectionChanged=function(t){(null==t?void 0:t.viewRange)&&(this.viewRange=t.viewRange,t.option&&void 0!==t.option.mobileSelectionDrag?t.option.mobileSelectionDrag===a.MobileSelectionDragType.Hide?this.optionShow=!1:t.option.mobileSelectionDrag===a.MobileSelectionDragType.Show&&(this.optionShow=!0):this.optionShow=!0,this.update())},e.prototype.onBlur=function(){var t;(null===(t=this.viewRange)||void 0===t?void 0:t.isCaret())&&this.setState({leftPosX:0,leftPosY:0,leftLineHeight:0,rightPosX:0,rightPosY:0,rightLineHeight:0,visible:!1})},e.prototype.update=function(){this.viewRange&&!this.viewRange.isCaret()&&this.optionShow?(this.startPos=this.getViewRangePointPos(this.viewRange.start),this.endPos=this.getViewRangePointPos(this.viewRange.end),this.startPos&&this.endPos?this.setState({leftPosX:this.startPos.x,leftPosY:this.startPos.y,leftLineHeight:this.viewRange.start.lineHeight,rightPosX:this.endPos.x,rightPosY:this.endPos.y,rightLineHeight:this.viewRange.end.lineHeight,visible:!0}):this.setState({leftPosX:0,leftPosY:0,leftLineHeight:0,rightPosX:0,rightPosY:0,rightLineHeight:0,visible:!1})):this.setState({leftPosX:0,leftPosY:0,leftLineHeight:0,rightPosX:0,rightPosY:0,rightLineHeight:0,visible:!1})},e.prototype.getViewRangePointPos=function(t){if(t){var e=t.lineBox;if(e){var n=void 0,r=void 0,i=a.LayoutUtil.getOffsetPoint(e,a.BoxKind.Document),o=i.x,l=i.y;n=Object(s.twipsToPx)(o),r=Object(s.twipsToPx)(l);var p=t.linePosOffset(this.props.zoom());p&&(n+=p);var c=this.props.layoutController.getLayoutBox().__node__;c instanceof HTMLElement&&(n+=c.offsetLeft,r+=c.offsetTop);var h=a.NodeUtil.getScrollOffset(e.__node__,c);return{x:n-=h.scrollX,y:r-=h.scrollY}}}},e.prototype.onLeftTouchStart=function(t){this.isLeftDragTouch=!0,this.props.context.fire(new a.MobileSelectionDragNotification(t.nativeEvent)),this.props.scrollHandler.disableScrollOnSelectionChanged()},e.prototype.onLeftTouchEnd=function(t){this.isLeftDragTouch=!1,this.selector.finishMoving(),this.props.context.fire(new a.MobileSelectionDragNotification(t.nativeEvent)),this.props.scrollHandler.enableScrollOnSelectionChanged()},e.prototype.onRightTouchStart=function(t){this.isRightDragTouch=!0,this.props.context.fire(new a.MobileSelectionDragNotification(t.nativeEvent)),this.props.scrollHandler.disableScrollOnSelectionChanged()},e.prototype.onRightTouchEnd=function(t){this.isRightDragTouch=!1,this.selector.finishMoving(),this.props.context.fire(new a.MobileSelectionDragNotification(t.nativeEvent)),this.props.scrollHandler.enableScrollOnSelectionChanged()},e.prototype.onTableScroll=function(){var t=this;this.setState({tableScrolling:!0}),this.onTableScrollTimeout||(this.onTableScrollTimeout=function(t,e,n){var r,i,o,a,s,l,p=0,c=!1,h=!1,u=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function g(e){var n=r,o=i;return r=i=void 0,p=e,a=t.apply(o,n)}function d(t){return p=t,s=setTimeout(y,e),c?g(t):a}function f(t){var n=t-l;return void 0===l||n>=e||n<0||h&&t-p>=o}function y(){var t=Se();if(f(t))return T(t);s=setTimeout(y,function(t){var n=e-(t-l);return h?Be(n,o-(t-p)):n}(t))}function T(t){return s=void 0,u&&r?g(t):(r=i=void 0,a)}function m(){var t=Se(),n=f(t);if(r=arguments,i=this,l=t,n){if(void 0===s)return d(l);if(h)return clearTimeout(s),s=setTimeout(y,e),g(l)}return void 0===s&&(s=setTimeout(y,e)),a}return e=De(e)||0,de(n)&&(c=!!n.leading,o=(h="maxWait"in n)?Ne(De(n.maxWait)||0,e):o,u="trailing"in n?!!n.trailing:u),m.cancel=function(){void 0!==s&&clearTimeout(s),p=0,r=l=i=s=void 0},m.flush=function(){return void 0===s?a:T(Se())},m}((function(){t.setState({tableScrolling:!1}),t.viewRange&&t.state.visible&&(t.viewRange.start.clearCache(),t.viewRange.end.clearCache(),t.update())}),500)),this.onTableScrollTimeout()},e.prototype.render=function(){var t=this;return h.a.createElement("div",{className:"melo-mobile-selection-drag",style:{visibility:this.state.visible&&!this.state.tableScrolling?"visible":"hidden"}},h.a.createElement("div",{className:he,style:{left:this.state.leftPosX,top:this.state.leftPosY-4,height:this.state.leftLineHeight+4}}),h.a.createElement("div",{className:ce,onTouchStart:function(e){t.onLeftTouchStart(e)},onTouchEnd:function(e){t.onLeftTouchEnd(e)},style:{left:this.state.leftPosX-14,top:this.state.leftPosY-28}},h.a.createElement("div",{className:"melo-mobile-selection-drag-left"})),h.a.createElement("div",{className:he,style:{left:this.state.rightPosX,top:this.state.rightPosY,height:this.state.rightLineHeight+4}}),h.a.createElement("div",{className:ce,onTouchStart:function(e){t.onRightTouchStart(e)},onTouchEnd:function(e){t.onRightTouchEnd(e)},style:{left:this.state.rightPosX-14,top:this.state.rightPosY+this.state.rightLineHeight-2}},h.a.createElement("div",{className:"melo-mobile-selection-drag-right"})))},e}(h.a.Component),Fe=function(){function t(){}return t.getShortCutKey=function(t){for(var e=t,n=[],r=a.KeyCode.EMPTY;e>0;)e>=a.KeyAssist.COMMAND?(n.push(a.KeyAssist.COMMAND),e-=a.KeyAssist.COMMAND):e>=a.KeyAssist.WIN?(n.push(a.KeyAssist.WIN),e-=a.KeyAssist.WIN):e>=a.KeyAssist.CTRL_MAC?(n.push(a.KeyAssist.CTRL_MAC),e-=a.KeyAssist.CTRL_MAC):e>=a.KeyAssist.CTRL_WIN?(n.push(a.KeyAssist.CTRL_WIN),e-=a.KeyAssist.CTRL_WIN):e>=a.KeyAssist.ALT?(n.push(a.KeyAssist.ALT),e-=a.KeyAssist.ALT):e>=a.KeyAssist.SHIFT?(n.push(a.KeyAssist.SHIFT),e-=a.KeyAssist.SHIFT):(r=e,e=0);return{input:this.getIPadKeyName(r),modifier:this.getIPadModifierName(n)}},t.getIPadKeyName=function(t){var e=a.IPadKeyCode.EMPTY;return Object.keys(a.KeyCode).some((function(n){return a.KeyCode[n]===t&&void 0!==a.IPadKeyCode[n]&&(e=a.IPadKeyCode[n],!0)})),e},t.getIPadModifierName=function(t){if(2===t.length){if(t.includes(a.KeyAssist.COMMAND)&&t.includes(a.KeyAssist.SHIFT))return a.IPadKeyModifier.COMMAND_SHIFT}else if(1===t.length)switch(t[0]){case a.KeyAssist.COMMAND:return a.IPadKeyModifier.COMMAND;case a.KeyAssist.CTRL_MAC:return a.IPadKeyModifier.CTRL;case a.KeyAssist.ALT:return a.IPadKeyModifier.ALT;case a.KeyAssist.SHIFT:return a.IPadKeyModifier.SHIFT}return a.IPadKeyModifier.NONE},t}(),ke=function(){function t(){var e=this;this.attached=!1,this.ipadKeymap=new Map,this.onIpadExternalKeyboardEvent=function(t){e.listeners.forEach((function(e){return e(t)}))},this.addIPadAppKeyMap=function(t){if(s.PlatformUtil.isTencentDocsIPadApp()&&"mqq"in window){e.attached||(window.mqq.addEventListener("shortcutKeyEvent",e.onIpadExternalKeyboardEvent),e.attached=!0);var n=[];t.forEach((function(t){if(t!==a.KeyCode.EMPTY&&!e.ipadKeymap.has(t)){e.ipadKeymap.set(t,!0);var r=Fe.getShortCutKey(t);r.input&&n.push(r)}})),n.length>0&&window.mqq.invoke("docx","registerShortcutKeyEvent",{shortcutKey:n})}},t.instance=this,this.listeners=[]}return t.getInstance=function(){return t.instance||new t,t.instance},t.prototype.attach=function(){s.PlatformUtil.isTencentDocsIPadApp()&&"mqq"in window&&!this.attached&&(window.mqq.addEventListener("shortcutKeyEvent",this.onIpadExternalKeyboardEvent),this.attached=!0)},t.prototype.detach=function(){s.PlatformUtil.isTencentDocsIPadApp()&&"mqq"in window&&(window.mqq.removeEventListener("shortcutKeyEvent",this.onIpadExternalKeyboardEvent),this.attached=!1)},t.prototype.addEventListener=function(t){this.listeners.push(t)},t.prototype.removeEventListener=function(t){for(var e=0;e<this.listeners.length;e++)t===this.listeners[e]&&(this.listeners.splice(e,1),e-=1)},t}(),Ue=function(){function t(t){var e=this;this.lastInnerHeight=window.innerHeight,this.lastOrientation=Number(window.orientation),this.blurFromStylePanelButton=!1,this.isTouching=!1,this.keyboardResizeViewport=!1,this.isLongClick=!1,this.attached=!1,this.onResize=function(){setTimeout((function(){var t=window.innerHeight,n=Number(window.orientation);(0!==e.lastOrientation&&180!==e.lastOrientation||0!==n&&180!==n)&&(90!==e.lastOrientation&&-90!==e.lastOrientation||90!==n&&-90!==n)||(e.keyboardResizeViewport=!0,e.lastInnerHeight-t>150?e.isLongClick?(e.isLongClick=!1,e.onKeyboardUp(a.KeyboardNotificationFrom.EDITOR)):e.onKeyboardUp(a.KeyboardNotificationFrom.VIEWPORT_RESIZE):t-e.lastInnerHeight>150&&(s.PlatformUtil.isStylePanelClick()?(s.PlatformUtil.setStylePanelClick(!1),e.onKeyboardDown(a.KeyboardNotificationFrom.VIEWPORT_RESIZE)):e.isTouching?s.PlatformUtil.isAndroid()&&(e.isLongClick=!0,e.context.fire(new a.FocusBlurNotification(a.FocusBlurNotificationType.REQUEST_FOCUS,{from:a.From.EDITOR}),!1)):(e.context.fire(new a.PanelNotification(a.PanelNotificationType.MOBILE_PANEL_HIDE),!1),e.context.fire(new a.FocusBlurNotification(a.FocusBlurNotificationType.REQUEST_BLUR),!1),e.context.fire(new a.FocusBlurNotification(a.FocusBlurNotificationType.ON_BLUR))))),e.lastOrientation=n,e.lastInnerHeight=t}),s.PlatformUtil.isIOS()&&s.PlatformUtil.isTencentDocsApp()?350:100)},this.context=t,s.PlatformUtil.isMobile()&&(this.context.on(a.FocusBlurNotificationType.REQUEST_FOCUS,this.onRequestFocus,this),this.context.on(a.FocusBlurNotificationType.REQUEST_BLUR,this.onRequestBlur,this),this.context.on(a.FocusBlurNotificationType.ON_BLUR,this.onBlur,this),this.context.on(a.TouchNotificationType.TOUCH_EVENT,this.onTouchEvent,this))}return t.prototype.attach=function(){this.attached?s.Logger.warn("attach method called but KeyboardManager already attached"):(this.attached=!0,s.PlatformUtil.isMobile()&&window.addEventListener("resize",this.onResize))},t.prototype.detach=function(){s.PlatformUtil.isMobile()&&window.removeEventListener("resize",this.onResize),this.attached=!1},t.prototype.onRequestFocus=function(t){var e;this.timeoutId&&clearTimeout(this.timeoutId),t.data&&(e=t.data.from),(!e||e!==a.From.STYLE_PANEL_BUTTON&&e!==a.From.TABLE_SCROLL&&e!==a.From.LIST_STYLE_BUTTON&&e!==a.From.ALIGN_STYLE_BUTTON)&&(e&&e===a.From.EDITOR?(this.context.fire(new a.PanelNotification(a.PanelNotificationType.MOBILE_PANEL_HIDE),!1),this.onKeyboardUp(a.KeyboardNotificationFrom.EDITOR)):this.onKeyboardUp(a.KeyboardNotificationFrom.OTHER))},t.prototype.onRequestBlur=function(t){var e,n=this;t.data&&(e=t.data.from),e&&e===a.From.STYLE_PANEL_BUTTON&&(this.blurFromStylePanelButton=!0,setTimeout((function(){n.blurFromStylePanelButton=!1}),600))},t.prototype.onBlur=function(t){if(!(null==t?void 0:t.data)||t.data.from!==a.From.MOBILE_HEADER_CONTROL)return this.isTouching&&s.PlatformUtil.isAndroid()&&!this.keyboardResizeViewport?(this.isLongClick=!0,void this.context.fire(new a.FocusBlurNotification(a.FocusBlurNotificationType.REQUEST_FOCUS,{from:a.From.EDITOR}),!1)):void this.onKeyboardDown()},t.prototype.onKeyboardUp=function(t){this.context.fire(new a.KeyboardNotification(a.KeyboardNotificationType.MOBILE_KEYBOARD_SHOW,t))},t.prototype.onKeyboardDown=function(t){this.blurFromStylePanelButton?(this.context.fire(new a.KeyboardNotification(a.KeyboardNotificationType.MOBILE_KEYBOARD_HIDE,a.KeyboardNotificationFrom.STYLE_PANEL_SHOW)),this.blurFromStylePanelButton=!1):this.context.fire(new a.KeyboardNotification(a.KeyboardNotificationType.MOBILE_KEYBOARD_HIDE,t))},t.prototype.onTouchEvent=function(t){t.event&&("touchstart"===t.event.type?this.isTouching=!0:"touchend"===t.event.type&&(this.isTouching=!1))},t}(),Ke=function(){function t(){}return t.isMetaKey=function(t){return-1!==[a.KeyCode.ARROW_DOWN,a.KeyCode.ARROW_UP,a.KeyCode.ARROW_LEFT,a.KeyCode.ARROW_RIGHT,a.KeyCode.HOME,a.KeyCode.END,a.KeyCode.DELETE,a.KeyCode.BACKSPACE,a.KeyCode.F1,a.KeyCode.F2,a.KeyCode.F3,a.KeyCode.F4,a.KeyCode.F5,a.KeyCode.F6,a.KeyCode.F7,a.KeyCode.F8,a.KeyCode.F9,a.KeyCode.F10,a.KeyCode.F11,a.KeyCode.F12,a.KeyCode.TAB,a.KeyCode.PAGE_DOWN,a.KeyCode.PAGE_UP,a.KeyCode.ENTER,a.KeyCode.ESCAPE,a.KeyCode.SHIFT,a.KeyCode.CAPS_LOCK,a.KeyCode.ALT].indexOf(t)},t.isCtrlCmdKey=function(t){if(s.PlatformUtil.isMac()){if(t===a.KeyCode.META_LEFT||t===a.KeyCode.META_RIGHT||t===a.KeyCodeFireFox.META_FIREFOX)return!0}else if(t===a.KeyCode.CTRL)return!0;return!1},t.getKeyCode=function(t){var e=t.keyCode;return s.PlatformUtil.isFireFox()&&(e===a.KeyCodeFireFox.EQUAL?e=a.KeyCode.EQUAL:e===a.KeyCodeFireFox.MINUS&&(e=a.KeyCode.MINUS)),e},t.getMouseCode=function(t){return t.buttons*a.MOUSE_EVENT_TIMES},t.getWheelCode=function(t){var e=0;return t.deltaY>0?e=a.WheelCode.WHEEL_CLOCKWISE:t.deltaY<0&&(e=a.WheelCode.WHEEL_ANTICLOCKWISE),e},t.getIpadKeyCode=function(t){var e=a.KeyCode.EMPTY;if(null==t?void 0:t.input){var n=t.input,r=t.modifier;n===a.IPadKeyCode.ARROW_LEFT?e=a.KeyCode.ARROW_LEFT:n===a.IPadKeyCode.ARROW_RIGHT?e=a.KeyCode.ARROW_RIGHT:n===a.IPadKeyCode.ARROW_UP?e=a.KeyCode.ARROW_UP:n===a.IPadKeyCode.ARROW_DOWN?e=a.KeyCode.ARROW_DOWN:void 0!==r&&(e=this.getIpadCombinationKeyCode(n,r))}return e},t.getIpadCombinationKeyCode=function(t,e){var n=a.KeyCode.EMPTY,r=t.toUpperCase();if(/^[A-Z]$/.test(r))n=a.KeyCode[r];else{if(t!==a.IPadKeyCode.EQUAL)return n;n=a.KeyCode.EQUAL}switch(e){case a.IPadKeyModifier.COMMAND:n=a.KeyAssist.COMMAND+n;break;case a.IPadKeyModifier.COMMAND_SHIFT:n=a.KeyAssist.COMMAND+a.KeyAssist.SHIFT+n}return n},t.getAssistKey=function(t){var e=0;return s.PlatformUtil.isMac()||s.PlatformUtil.isIPad()?(e+=t.altKey?a.KeyAssist.ALT:0,e+=t.shiftKey?a.KeyAssist.SHIFT:0,e+=t.ctrlKey?a.KeyAssist.CTRL_MAC:0,e+=t.metaKey?a.KeyAssist.COMMAND:0):(e+=t.altKey?a.KeyAssist.ALT:0,e+=t.shiftKey?a.KeyAssist.SHIFT:0,e+=t.ctrlKey?a.KeyAssist.CTRL_WIN:0,e+=t.metaKey?a.KeyAssist.WIN:0),e},t}(),We=function(){function t(t,e){var n=this;this.keymap=new Map,this.attached=!1,this.onKeyEvent=function(t){var e=Ke.getKeyCode(t),r=Ke.getAssistKey(t)+e;n.runAction(r,t)},this.onMouseEvent=function(t){var e=Ke.getMouseCode(t),r=Ke.getAssistKey(t)+e;n.runAction(r,t)},this.onWheelEvent=function(t){var e=Ke.getWheelCode(t),r=Ke.getAssistKey(t)+e;n.runAction(r,t)},this.onIpadExternalKeyboardEvent=function(t){if(t){var e=Ke.getIpadKeyCode(t);n.runAction(e,void 0)}},this.editor=t,this.state=e}return t.prototype.attach=function(){if(this.attached)s.Logger.warn("Editor KeymapManager has attached");else{var t=this.editor.surface.getFocusableDom();t?(t.addEventListener("keydown",this.onKeyEvent),t.addEventListener("mousedown",this.onMouseEvent),t.addEventListener("wheel",this.onWheelEvent,{passive:!1})):s.Logger.error("Editor KeymapManager attach focusableDom is null"),s.PlatformUtil.isTencentDocsIPadApp()&&(ke.getInstance().attach(),ke.getInstance().addEventListener(this.onIpadExternalKeyboardEvent)),this.attached=!0}},t.prototype.detach=function(){var t=this.editor.surface.getFocusableDom();t?(t.removeEventListener("keydown",this.onKeyEvent),t.removeEventListener("mousedown",this.onMouseEvent),t.removeEventListener("wheel",this.onWheelEvent)):s.Logger.error("Editor KeymapManager detach surfaceDom is null"),s.PlatformUtil.isTencentDocsIPadApp()&&(ke.getInstance().detach(),ke.getInstance().removeEventListener(this.onIpadExternalKeyboardEvent)),this.attached=!1},t.prototype.addKeymap=function(t){var e=this,n=s.PlatformUtil.isMac()||s.PlatformUtil.isIOS()?"mac":"win",r=[].concat(t.keyBindings[n]);r.forEach((function(n){n!==a.KeyCode.EMPTY&&(e.keymap.has(n)||e.keymap.set(n,t))})),s.PlatformUtil.isTencentDocsIPadApp()&&ke.getInstance().addIPadAppKeyMap(r)},t.prototype.addKeymaps=function(t){var e=this;(function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(ae(arguments[e]));return t})(t).forEach((function(t){e.addKeymap(t)}))},t.prototype.runAction=function(t,e){var n;if((this.editor.surface.isFocusing()||s.PlatformUtil.isTencentDocsIPadApp())&&(n=this.keymap.get(t)),n){var r=n.action,i=n.shouldPreventDefault;(void 0===i||i)&&e&&e.preventDefault(),this.editor.run(r)}},t}(),He=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.selectNode=null,e}return re(e,t),e.prototype.componentDidMount=function(){this.props.context.on(a.RenderNotificationTypes.SELECTION_CHANGE,this.onSelectionChanged,this)},e.prototype.componentWillUnmount=function(){this.props.context.removeListener(a.RenderNotificationTypes.SELECTION_CHANGE,this)},e.prototype.onSelectionChanged=function(t){if(null==t?void 0:t.viewRange){var e=t.viewRange;if(e.start.gcp!==e.end.gcp&&this.selectNode){var n=document.createRange();n.selectNode(this.selectNode);var r=window.getSelection();r&&(r.removeAllRanges(),r.addRange(n))}}},e.prototype.render=function(){var t=this;return h.a.createElement("textarea",{id:"melo-hidden-select",ref:function(e){t.selectNode=e},style:{opacity:0}}," ")},e}(h.a.Component),Ge=function(t){function e(e){var n=t.call(this,e)||this;return n.isFocus=!1,n.inputDomRef=null,n.compositionId="",n.viewRange=null,n.initFocus=!1,n.forceFocus=!0,n.mobilePanelShown=!1,n.spaceReg=new RegExp(a.PlaceholderChar.NonBreakSpace,"g"),n.state={posX:0,posY:0},document.body.style.webkitUserSelect="none",n}return re(e,t),e.prototype.componentDidMount=function(){this.props.context.on(a.RenderNotificationTypes.CARET_CHANGE,this.onSelectionChanged,this),this.props.context.on(a.FocusBlurNotificationType.REQUEST_FOCUS,this.onRequestFocus,this),this.props.context.on(a.FocusBlurNotificationType.REQUEST_BLUR,this.onRequestBlur,this),this.props.context.on(a.PanelNotificationType.MOBILE_PANEL_SHOW,this.onMobilePanelShow,this),this.props.context.on(a.PanelNotificationType.MOBILE_PANEL_HIDE,this.onMobilePanelHide,this)},e.prototype.componentWillUnmount=function(){this.props.context.removeListener(a.RenderNotificationTypes.CARET_CHANGE,this),this.props.context.removeListener(a.FocusBlurNotificationType.REQUEST_FOCUS,this),this.props.context.removeListener(a.FocusBlurNotificationType.REQUEST_BLUR,this),this.props.context.removeListener(a.PanelNotificationType.MOBILE_PANEL_SHOW,this),this.props.context.removeListener(a.PanelNotificationType.MOBILE_PANEL_HIDE,this)},e.prototype.componentDidUpdate=function(){this.setFocusMobile()},e.prototype.onSelectionChanged=function(t){this.props.context.isEditable()&&t&&t.viewRange&&(this.viewRange=t.viewRange,t.option&&void 0!==t.option.forceFocus?this.forceFocus=t.option.forceFocus:this.forceFocus=!0,this.initFocus&&this.update())},e.prototype.onRequestFocus=function(t){if(this.compositionId)this.endComposition();else{if(t.data){var e=t.data,n=e.viewRange,r=e.from;r!==a.From.KEYBOARD_BUTTON&&r!==a.From.EDITOR||(this.mobilePanelShown=!1),n&&(this.viewRange=n)}this.initFocus=!0,this.forceFocus=!0,this.update()}},e.prototype.onRequestBlur=function(){this.inputDomRef&&this.isFocus&&(this.compositionId&&this.endComposition(),this.inputDomRef.blur())},e.prototype.onMobilePanelShow=function(){this.mobilePanelShown=!0},e.prototype.onMobilePanelHide=function(){this.mobilePanelShown=!1},e.prototype.setFocusMobile=function(){var t=this;s.PlatformUtil.isIOS()?(this.inputDomRef&&this.inputDomRef.focus(),setTimeout((function(){t.inputDomRef&&t.inputDomRef.setSelectionRange(0,0)}),100)):setTimeout((function(){t.inputDomRef&&t.inputDomRef.focus()}),100)},e.prototype.update=function(){if(this.props.context.isEditable()&&this.viewRange){if((this.isFocus||this.forceFocus)&&!this.mobilePanelShown){var t=this.viewRange.start.getDocumentOffset(this.props.zoom());t.x=t.x<t.docLeft?t.docLeft:t.x,t.x=t.x>t.docRight?t.docRight:t.x,t.y=t.y<t.docTop?t.docTop:t.y,t.y=t.y>t.docBottom?t.docBottom:t.y;var e=this.viewRange.start.caretHeight();this.setState({posX:t.x,posY:t.y+e-5})}this.props.context.fire(new a.HiddenEditorNotification(a.HiddenEditorNotificationType.ON_POS_UPDATE,this.viewRange),!1)}},e.prototype.onCompositionStart=function(){this.props.context.isEditable()&&(this.compositionId="input_"+s.StringUtil.generateRandomId(),this.props.state.compositionStart(this.compositionId,!0),this.props.context.fire(new a.HiddenEditorNotification(a.HiddenEditorNotificationType.ON_COMPOSITION_START,null)))},e.prototype.onCompositionUpdate=function(t){if(this.props.context.isEditable()){var e=t.nativeEvent.data;this.props.state.compositionUpdate(this.compositionId,e,!0)}},e.prototype.onCompositionEnd=function(t){if(this.props.context.isEditable()){var e=t.nativeEvent.data;this.props.state.compositionEnd(this.compositionId,e,!0),this.props.context.fire(new a.HiddenEditorNotification(a.HiddenEditorNotificationType.ON_COMPOSITION_END,e))}this.inputDomRef&&(this.inputDomRef.value=""),this.compositionId=""},e.prototype.onChange=function(){var t=this;setTimeout((function(){t.compositionId.length<=0&&t.finishInput()}),0)},e.prototype.finishInput=function(){if(this.inputDomRef){var t=this.inputDomRef.value;this.inputDomRef.value="",this.props.context.isEditable()&&t&&(t=t.replace(this.spaceReg,a.PlaceholderChar.Space),this.props.service.getSelection().typeText(t),this.props.context.fire(new a.HiddenEditorNotification(a.HiddenEditorNotificationType.ON_INPUT,t)))}},e.prototype.endComposition=function(){this.props.state.compositionEnd(this.compositionId,this.props.state.getCompositionText(),!0),this.props.context.fire(new a.HiddenEditorNotification(a.HiddenEditorNotificationType.ON_COMPOSITION_END,this.props.state.getCompositionText())),this.inputDomRef&&(this.inputDomRef.value=""),this.compositionId=""},e.prototype.onKeyDown=function(t){t.keyCode===a.KeyCode.ENTER&&this.compositionId&&this.endComposition()},e.prototype.onClipboardEvent=function(t){t.preventDefault()},e.prototype.onFocus=function(t){t.preventDefault(),this.isFocus=!0,this.props.context.fire(new a.FocusBlurNotification(a.FocusBlurNotificationType.ON_FOCUS))},e.prototype.onBlur=function(t){var e=this;t.preventDefault(),this.isFocus=!1,setTimeout((function(){e.isFocus||e.props.context.fire(new a.FocusBlurNotification(a.FocusBlurNotificationType.ON_BLUR))}),300)},e.prototype.render=function(){var t=this;return h.a.createElement("input",{id:"melo-hidden-editor-mobile",ref:function(e){t.inputDomRef=e},onChange:this.onChange.bind(this),onCompositionStart:this.onCompositionStart.bind(this),onCompositionUpdate:this.onCompositionUpdate.bind(this),onCompositionEnd:this.onCompositionEnd.bind(this),onCopy:this.onClipboardEvent.bind(this),onCut:this.onClipboardEvent.bind(this),onPaste:this.onClipboardEvent.bind(this),onFocus:this.onFocus.bind(this),onBlur:this.onBlur.bind(this),onKeyDown:this.onKeyDown.bind(this),spellCheck:!1,tabIndex:-1,style:{left:this.state.posX,top:this.state.posY}})},e}(h.a.Component);!function(t){t[t.START=0]="START",t[t.END=1]="END",t[t.UNDEFINED=2]="UNDEFINED"}(ue||(ue={}));var je,Ve,Ye=function(){function t(t,e,n,r){var i=this;this.range=a.GCPRange.emptyRange(),this.linePos=-1,this.movingPoint=ue.UNDEFINED,this.editor=t,this.state=e,this.layoutController=n,this.selector=r,this.editor.on(a.StateNotification.CoreSelectionChange,(function(t){i.onCoreSelectionChanged(t)}),this)}return t.prototype.onCoreSelectionChanged=function(t){(null==t?void 0:t.range)&&(t.range.equal(this.range)||(this.linePos=-1,0===t.range.length()?this.movingPoint=ue.UNDEFINED:t.option&&t.option.backward&&(this.movingPoint=t.option.backward?ue.START:ue.END)))},t.prototype.moveLeft=function(){var t=this.editor.service.getSelection().range(),e=t.begin();if(t.length()>0)this.editor.service.getSelection().setRange(e,e,{scrollToView:a.ScrollViewType.Near});else{var n=this.editor.service.getSelection().prevTextBreak(e);this.editor.service.getSelection().setRange(n,n,{scrollToView:a.ScrollViewType.Near})}},t.prototype.moveRight=function(){var t=this.editor.service.getSelection().range(),e=t.end();if(t.length()>0)this.editor.service.getSelection().setRange(e,e,{scrollToView:a.ScrollViewType.Near});else{var n=this.editor.service.getSelection().nextTextBreak(e);this.editor.service.getSelection().setRange(n,n,{scrollToView:a.ScrollViewType.Near})}},t.prototype.moveUp=function(){var t=this.editor.viewSelection.getViewRange();if(t){var e=this.getCurrentLineBox(t.start);if(e){this.linePos<0&&(this.linePos=t.start.linePosOffset());var n,r=a.LayoutUtil.getVerticalPrevLineBox(e);null!==(n=r?this.moveToLinePointByPosition(r,this.linePos):this.selector.moveToLinePoint(e,!0))&&(this.range=new a.GCPRange(n,0))}}},t.prototype.moveDown=function(){var t=this.editor.viewSelection.getViewRange();if(t){var e=this.getCurrentLineBox(t.end);if(e){this.linePos<0&&(this.linePos=t.end.linePosOffset());var n,r=a.LayoutUtil.getVerticalNextLineBox(e);null!==(n=r?this.moveToLinePointByPosition(r,this.linePos):this.selector.moveToLinePoint(e,!1))&&(this.range=new a.GCPRange(n,0))}}},t.prototype.selectLeft=function(){this.linePos=-1;var t,e=this.editor.service.getSelection().range();this.movingPoint===ue.END?t=this.editor.service.getSelection().prevTextBreak(e.end()):(this.movingPoint=ue.START,t=this.editor.service.getSelection().prevTextBreak(e.begin())),this.setRangeBackward(e,t)},t.prototype.selectRight=function(){this.linePos=-1;var t,e=this.editor.service.getSelection().range();this.movingPoint===ue.START?t=this.editor.service.getSelection().nextTextBreak(e.begin()):(this.movingPoint=ue.END,t=this.editor.service.getSelection().nextTextBreak(e.end())),this.setRangeForward(e,t)},t.prototype.selectUp=function(){var t=this.editor.viewSelection.getViewRange();if(t){var e;this.movingPoint===ue.END?e=t.end:(this.movingPoint=ue.START,e=t.start);var n=this.getCurrentLineBox(e);if(n){this.linePos<0&&(this.linePos=e.linePosOffset());var r,i=a.LayoutUtil.getPrevBox(n);if(i)if(null!==(r=this.getGcpByLinePos(i,this.linePos))){var o=this.editor.getRangeFromIndex(n.firstIndex,n.lastIndex);if(this.movingPoint===ue.START)e.gcp===o.begin()&&r===o.begin()&&(r=this.getGcpLineStart(i));else{var s=this.editor.getRangeFromIndex(i.firstIndex,i.lastIndex);e.gcp===o.end()&&r===s.begin()&&(r=this.getGcpLineStart(n))}}else r=this.getGcpLineEnd(i),this.movingPoint===ue.START&&null!==r&&r>0&&(r-=1);else r=this.getGcpLineStart(n);null!==r&&this.setRangeBackward(this.editor.service.getSelection().range(),r)}}},t.prototype.selectDown=function(){var t=this.editor.viewSelection.getViewRange();if(t){var e;this.movingPoint===ue.START?e=t.start:(this.movingPoint=ue.END,e=t.end);var n=this.getCurrentLineBox(e);if(n){this.linePos<0&&(this.linePos=e.linePosOffset());var r,i=a.LayoutUtil.getNextBox(n);if(i)if(null!==(r=this.getGcpByLinePos(i,this.linePos))){var o=this.editor.getRangeFromIndex(n.firstIndex,n.lastIndex);if(this.movingPoint===ue.END)e.gcp===o.end()&&r===o.end()&&(r=this.getGcpLineEnd(i));else{var s=this.editor.getRangeFromIndex(i.firstIndex,i.lastIndex);e.gcp===o.begin()&&r===s.end()&&(r=this.getGcpLineEnd(n))}}else r=this.getGcpLineEnd(i);else r=this.getGcpLineEnd(n);null!==r&&this.setRangeForward(this.editor.service.getSelection().range(),r)}}},t.prototype.moveToWordLeft=function(){this.linePos=-1;var t=this.editor.service.getSelection().range().begin();t=this.editor.service.getSelection().prevSkipSpace(t),t=this.editor.service.getSelection().prevWordBreak(t),this.editor.service.getSelection().setRange(t,t,{scrollToView:a.ScrollViewType.Near})},t.prototype.moveToWordRight=function(){this.linePos=-1;var t=this.editor.service.getSelection().range().end();t=this.editor.service.getSelection().nextSkipSpace(t),t=this.editor.service.getSelection().nextWordBreak(t),this.editor.service.getSelection().setRange(t,t,{scrollToView:a.ScrollViewType.Near})},t.prototype.selectToWordLeft=function(){this.linePos=-1;var t,e=this.editor.service.getSelection().range();this.movingPoint===ue.END?t=e.end():(this.movingPoint=ue.START,t=e.begin()),t=this.editor.service.getSelection().prevSkipSpace(t),t=this.editor.service.getSelection().prevWordBreak(t),this.setRangeBackward(e,t)},t.prototype.selectToWordRight=function(){this.linePos=-1;var t,e=this.editor.service.getSelection().range();this.movingPoint===ue.START?t=e.begin():(this.movingPoint=ue.END,t=e.end()),t=this.editor.service.getSelection().nextSkipSpace(t),t=this.editor.service.getSelection().nextWordBreak(t),this.setRangeForward(e,t)},t.prototype.moveToLineStart=function(){this.linePos=-1;var t=this.editor.viewSelection.getViewRange();if(t){var e=this.getCurrentLineBox(t.start);e&&this.selector.moveToLinePoint(e,!0)}},t.prototype.moveToLineEnd=function(){this.linePos=-1;var t=this.editor.viewSelection.getViewRange();if(t){var e=this.getCurrentLineBox(t.end);e&&this.selector.moveToLinePoint(e,!1)}},t.prototype.selectToLineStart=function(){this.linePos=-1;var t=this.editor.viewSelection.getViewRange();if(t){var e;this.movingPoint===ue.END?e=t.end:(this.movingPoint=ue.START,e=t.start);var n=this.getCurrentLineBox(e);if(n){var r=this.getGcpLineStart(n);null!==r&&this.setRangeBackward(this.editor.service.getSelection().range(),r)}}},t.prototype.selectToLineEnd=function(){this.linePos=-1;var t=this.editor.viewSelection.getViewRange();if(t){var e;this.movingPoint===ue.START?e=t.start:(this.movingPoint=ue.END,e=t.end);var n=this.getCurrentLineBox(e);if(n){var r=this.getGcpLineEnd(n);null!==r&&this.setRangeForward(this.editor.service.getSelection().range(),r)}}},t.prototype.selectToParaStart=function(){this.linePos=-1;var t,e=this.editor.service.getSelection().range();this.movingPoint===ue.END?t=e.end()-1:(this.movingPoint=ue.START,t=e.begin());var n=this.editor.service.getSelection().getParaRange(t);n&&this.setRangeBackward(e,n.begin())},t.prototype.selectToParaEnd=function(){this.linePos=-1;var t,e=this.editor.service.getSelection().range();this.movingPoint===ue.START?t=e.begin():(this.movingPoint=ue.END,t=e.end()-1);var n=this.editor.service.getSelection().getParaRange(t);n&&this.setRangeForward(e,n.end())},t.prototype.selectToPrevPage=function(){this.linePos=-1;var t=this.editor.viewSelection.getViewRange();if(t){var e;this.movingPoint===ue.END?e=t.end:(this.movingPoint=ue.START,e=t.start);var n=a.LayoutUtil.getOffsetPoint(e.lineBox,a.BoxKind.Document),r=this.layoutController.getLayoutBox(),i=this.editor.scrollHandler.getScrollRootSize(),o=i.bottom-i.top;n.y=n.y-Object(s.pxToTwips)(o)-e.caretHeight();var l=this.editor.service.getSelection().storyRange().begin(),p=ae(a.LayoutUtil.getGrandsonByPoint(r,a.BoxKind.TextLine,n),2),c=p[0];p[1],c&&(l=this.state.getTextStream().getRangeFromIndex(c.firstIndex,c.lastIndex).begin()),this.setRangeBackward(this.editor.service.getSelection().range(),l)}},t.prototype.selectToNextPage=function(){this.linePos=-1;var t=this.editor.viewSelection.getViewRange();if(t){var e;this.movingPoint===ue.START?e=t.start:(this.movingPoint=ue.END,e=t.end);var n=a.LayoutUtil.getOffsetPoint(e.lineBox,a.BoxKind.Document),r=this.layoutController.getLayoutBox(),i=this.editor.scrollHandler.getScrollRootSize(),o=i.bottom-i.top;n.y=n.y+Object(s.pxToTwips)(o)+e.caretHeight();var l=this.editor.service.getSelection().storyRange().end(),p=ae(a.LayoutUtil.getGrandsonByPoint(r,a.BoxKind.TextLine,n),2),c=p[0];p[1],c&&(l=this.state.getTextStream().getRangeFromIndex(c.firstIndex,c.lastIndex).end()),this.setRangeForward(this.editor.service.getSelection().range(),l)}},t.prototype.moveToStoryStart=function(){this.linePos=-1;var t=this.editor.service.getSelection().storyRange();this.editor.service.getSelection().setRange(t.begin(),t.begin(),{scrollToView:a.ScrollViewType.Near})},t.prototype.moveToStoryEnd=function(){this.linePos=-1;var t=this.editor.service.getSelection().storyRange();this.editor.service.getSelection().setRange(t.end(),t.end(),{scrollToView:a.ScrollViewType.Near})},t.prototype.selectToStoryStart=function(){this.linePos=-1,this.movingPoint=ue.START;var t=this.editor.service.getSelection().range(),e=this.editor.service.getSelection().storyRange();this.setRangeBackward(t,e.begin())},t.prototype.selectToStoryEnd=function(){this.linePos=-1,this.movingPoint=ue.END;var t=this.editor.service.getSelection().range(),e=this.editor.service.getSelection().storyRange();this.setRangeForward(t,e.end())},t.prototype.selectAll=function(){this.editor.service.getSelection().wholeStory()},t.prototype.selectWord=function(t){this.editor.service.getSelection().selectWord(t)},t.prototype.selectParagraph=function(t){this.editor.service.getSelection().selectParagraph(t)},t.prototype.getCurrentLineBox=function(t){for(var e=t.leafBox.parentBox;e&&!Object(a.isTextLineBox)(e);)e=e.parentBox;return Object(a.isTextLineBox)(e)?e:null},t.prototype.getGcpByLinePos=function(t,e){var n=new s.MeloPoint;n.x=Object(s.pxToTwips)(e);var r=ae(a.LayoutUtil.getGrandsonByPoint(t,a.BoxKind.Text,n),2),i=r[0],o=r[1];if(i&&o){var l=a.LayoutUtil.getOffsetByPosition(i,Object(s.twipsToPx)(o.x)).offsetUString,p=this.editor.getRangeFromIndex(i.firstIndex,i.lastIndex).begin()+l;if(Object(a.isTextLineFragmentBox)(i.parentBox)){var c=i.firstIndex,h=i.lastIndex-p>p-c,u=this.editor.getRangeFromIndex(i.parentBox.firstIndex,i.parentBox.lastIndex);return h?u.begin():u.end()}return p}return null},t.prototype.getGcpLineStart=function(t){var e=t.firstChild;return e&&Object(a.isTextBox)(e)?this.editor.getRangeFromIndex(e.firstIndex,e.lastIndex).begin():null},t.prototype.getGcpLineEnd=function(t){var e=t.lastChild;return e&&Object(a.isTextBox)(e)?this.editor.getRangeFromIndex(e.firstIndex,e.lastIndex).end():null},t.prototype.moveToLinePointByPosition=function(t,e){var n=this.getGcpByLinePos(t,e);return null!==n?n!==this.editor.getRangeFromIndex(t.firstIndex,t.lastIndex).end()?this.editor.service.getSelection().setRange(n,n,{scrollToView:a.ScrollViewType.Near}):n=this.selector.moveToLinePoint(t,!1):n=this.selector.moveToLinePoint(t,0===e),n},t.prototype.setRangeBackward=function(t,e){var n=!0;this.movingPoint===ue.END?e>t.begin()?(this.range=new a.GCPRange(t.begin(),e-t.begin()),n=!1):(this.range=new a.GCPRange(e,t.begin()-e),this.movingPoint=ue.START):this.range=new a.GCPRange(e,t.end()-e),this.editor.service.getSelection().setRange(this.range.begin(),this.range.end(),{scrollToView:a.ScrollViewType.Near,backward:n})},t.prototype.setRangeForward=function(t,e){var n=!1;this.movingPoint===ue.START?e<t.end()?(this.range=new a.GCPRange(e,t.end()-e),n=!0):(this.range=new a.GCPRange(t.end(),e-t.end()),this.movingPoint=ue.END):this.range=new a.GCPRange(t.begin(),e-t.begin()),this.editor.service.getSelection().setRange(this.range.begin(),this.range.end(),{scrollToView:a.ScrollViewType.Near,backward:n})},t}();!function(t){t.BACKSPACE="backspace",t.DELETE="delete",t.TAB="tab",t.ENTER="enter",t.BACKSPACE_WORD="backspace_word",t.DELETE_WORD="delete_word",t.BACKSPACE_LINE="backspace_line",t.UNDO="undo",t.REDO="redo"}(je||(je={}));var ze,Je,Xe=((Ve={})[je.BACKSPACE]=function(t,e){if(t&&t instanceof a.MeloEditor&&t.isEditable()){if(t.isCompositing())return;t.service.getSelection().typeBackspace()}},Ve[je.DELETE]=function(t,e){if(t&&t instanceof a.MeloEditor&&t.isEditable()){if(t.isCompositing())return;t.service.getSelection().delete()}},Ve[je.ENTER]=function(t,e){if(t&&t instanceof a.MeloEditor&&t.isEditable()){if(t.isCompositing())return;t.service.getSelection().typeParagraph()}},Ve[je.TAB]=function(t,e){if(t&&t instanceof a.MeloEditor&&t.isEditable()){if(t.isCompositing())return;t.service.getSelection().typeText("\t")}},Ve[je.BACKSPACE_WORD]=function(t,e){if(t&&t instanceof a.MeloEditor&&t.isEditable()){var n=t.service.getSelection().range();if(n.isEmpty()){var r=t.service.getSelection().prevSkipSpace(n.begin());r=t.service.getSelection().prevWordBreak(r),t.service.getSelection().delete(new a.GCPRange(r,n.begin()-r))}else t.service.getSelection().typeBackspace()}},Ve[je.DELETE_WORD]=function(t,e){if(t&&t instanceof a.MeloEditor&&t.isEditable()){var n=t.service.getSelection().range();if(n.isEmpty()){var r=t.service.getSelection().nextSkipSpace(n.begin());r=t.service.getSelection().nextWordBreak(r),t.service.getSelection().delete(new a.GCPRange(n.begin(),r-n.begin()))}else t.service.getSelection().delete()}},Ve[je.BACKSPACE_LINE]=function(t,e){if(t&&t instanceof a.MeloEditor&&t.isEditable()){var n=t.service.getSelection().range();if(n.isEmpty()){var r=t.viewSelection.getViewRange();if(!r)return;for(var i=r.start.leafBox.parentBox;i&&!Object(a.isTextLineBox)(i);)i=i.parentBox;if(!i||!Object(a.isTextLineBox)(i))return;var o=t.getRangeFromIndex(i.firstIndex,i.lastIndex).begin();t.service.getSelection().delete(new a.GCPRange(o,n.begin()-o))}else t.service.getSelection().typeBackspace()}},Ve),Qe=[{keyBindings:{win:a.KeyCode.BACKSPACE,mac:a.KeyCode.BACKSPACE},action:je.BACKSPACE},{keyBindings:{win:a.KeyAssist.SHIFT+a.KeyCode.BACKSPACE,mac:a.KeyAssist.SHIFT+a.KeyCode.BACKSPACE},action:je.BACKSPACE},{keyBindings:{win:a.KeyCode.DELETE,mac:a.KeyCode.DELETE},action:je.DELETE},{keyBindings:{win:a.KeyCode.TAB,mac:a.KeyCode.TAB},action:je.TAB},{keyBindings:{win:a.KeyCode.ENTER,mac:a.KeyCode.ENTER},action:je.ENTER},{keyBindings:{win:a.KeyAssist.SHIFT+a.KeyCode.ENTER,mac:a.KeyAssist.SHIFT+a.KeyCode.ENTER},action:je.ENTER},{keyBindings:{win:a.KeyAssist.ALT+a.KeyCode.BACKSPACE,mac:a.KeyAssist.ALT+a.KeyCode.BACKSPACE},action:je.BACKSPACE_WORD},{keyBindings:{win:a.KeyAssist.ALT+a.KeyCode.DELETE,mac:a.KeyAssist.ALT+a.KeyCode.DELETE},action:je.DELETE_WORD},{keyBindings:{win:a.KeyAssist.CTRL_WIN+a.KeyCode.BACKSPACE,mac:a.KeyAssist.COMMAND+a.KeyCode.BACKSPACE},action:je.BACKSPACE_LINE},{keyBindings:{win:a.KeyAssist.CTRL_WIN+a.KeyCode.Z,mac:a.KeyAssist.COMMAND+a.KeyCode.Z},action:je.UNDO},{keyBindings:{win:a.KeyAssist.CTRL_WIN+a.KeyCode.Y,mac:a.KeyAssist.COMMAND+a.KeyCode.Y},action:je.REDO}];!function(t){t.ARROW_LEFT="moveLeft",t.ARROW_UP="moveUp",t.ARROW_RIGHT="moveRight",t.ARROW_DOWN="moveDown",t.SELECT_LEFT="selectLeft",t.SELECT_RIGHT="selectRight",t.SELECT_UP="selectUp",t.SELECT_DOWN="selectDown",t.MOVE_TO_WORD_LEFT="moveToWordLeft",t.MOVE_TO_WORD_RIGHT="moveToWordRight",t.SELECT_TO_WORD_LEFT="selectToWordLeft",t.SELECT_TO_WORD_RIGHT="selectToWordRight",t.MOVE_TO_LINE_START="moveToLineStart",t.MOVE_TO_LINE_END="moveToLineEnd",t.SELECT_TO_LINE_START="selectToLineStart",t.SELECT_TO_LINE_END="selectToLineEnd",t.SELECT_TO_PARA_START="selectToParaStart",t.SELECT_TO_PARA_END="selectToParaEnd",t.SELECT_TO_PREV_PAGE="selectToPrevPage",t.SELECT_TO_NEXT_PAGE="selectToNextPage",t.MOVE_TO_STORY_START="moveToStoryStart",t.MOVE_TO_STORY_END="moveToStoryEnd",t.SELECT_TO_STORY_START="selectToStoryStart",t.SELECT_TO_STORY_END="selectToStoryEnd",t.SELECT_WORD="selectWord",t.SELECT_PARA="selectParagraph",t.SELECT_ALL="selectAll"}(ze||(ze={}));var qe,Ze,$e=((Je={})[ze.ARROW_LEFT]=function(t,e){t&&t instanceof a.MeloEditor&&t.surface.selectionHandler.moveLeft()},Je[ze.ARROW_RIGHT]=function(t,e){t&&t instanceof a.MeloEditor&&t.surface.selectionHandler.moveRight()},Je[ze.ARROW_UP]=function(t,e){t&&t instanceof a.MeloEditor&&t.surface.selectionHandler.moveUp()},Je[ze.ARROW_DOWN]=function(t,e){t&&t instanceof a.MeloEditor&&t.surface.selectionHandler.moveDown()},Je[ze.SELECT_LEFT]=function(t,e){t&&t instanceof a.MeloEditor&&t.surface.selectionHandler.selectLeft()},Je[ze.SELECT_RIGHT]=function(t,e){t&&t instanceof a.MeloEditor&&t.surface.selectionHandler.selectRight()},Je[ze.SELECT_UP]=function(t,e){t&&t instanceof a.MeloEditor&&t.surface.selectionHandler.selectUp()},Je[ze.SELECT_DOWN]=function(t,e){t&&t instanceof a.MeloEditor&&t.surface.selectionHandler.selectDown()},Je[ze.MOVE_TO_WORD_LEFT]=function(t,e){t&&t instanceof a.MeloEditor&&t.surface.selectionHandler.moveToWordLeft()},Je[ze.MOVE_TO_WORD_RIGHT]=function(t,e){t&&t instanceof a.MeloEditor&&t.surface.selectionHandler.moveToWordRight()},Je[ze.SELECT_TO_WORD_LEFT]=function(t,e){t&&t instanceof a.MeloEditor&&t.surface.selectionHandler.selectToWordLeft()},Je[ze.SELECT_TO_WORD_RIGHT]=function(t,e){t&&t instanceof a.MeloEditor&&t.surface.selectionHandler.selectToWordRight()},Je[ze.MOVE_TO_LINE_START]=function(t,e){t&&t instanceof a.MeloEditor&&t.surface.selectionHandler.moveToLineStart()},Je[ze.MOVE_TO_LINE_END]=function(t,e){t&&t instanceof a.MeloEditor&&t.surface.selectionHandler.moveToLineEnd()},Je[ze.SELECT_TO_LINE_START]=function(t,e){t&&t instanceof a.MeloEditor&&t.surface.selectionHandler.selectToLineStart()},Je[ze.SELECT_TO_LINE_END]=function(t,e){t&&t instanceof a.MeloEditor&&t.surface.selectionHandler.selectToLineEnd()},Je[ze.SELECT_TO_PARA_START]=function(t,e){t&&t instanceof a.MeloEditor&&t.surface.selectionHandler.selectToParaStart()},Je[ze.SELECT_TO_PARA_END]=function(t,e){t&&t instanceof a.MeloEditor&&t.surface.selectionHandler.selectToParaEnd()},Je[ze.SELECT_TO_PREV_PAGE]=function(t,e){t&&t instanceof a.MeloEditor&&t.surface.selectionHandler.selectToPrevPage()},Je[ze.SELECT_TO_NEXT_PAGE]=function(t,e){t&&t instanceof a.MeloEditor&&t.surface.selectionHandler.selectToNextPage()},Je[ze.MOVE_TO_STORY_START]=function(t,e){t&&t instanceof a.MeloEditor&&t.surface.selectionHandler.moveToStoryStart()},Je[ze.MOVE_TO_STORY_END]=function(t,e){t&&t instanceof a.MeloEditor&&t.surface.selectionHandler.moveToStoryEnd()},Je[ze.SELECT_TO_STORY_START]=function(t,e){t&&t instanceof a.MeloEditor&&t.surface.selectionHandler.selectToStoryStart()},Je[ze.SELECT_TO_STORY_END]=function(t,e){t&&t instanceof a.MeloEditor&&t.surface.selectionHandler.selectToStoryEnd()},Je[ze.SELECT_WORD]=function(t,e,n){t&&t instanceof a.MeloEditor&&t.surface.selectionHandler.selectWord(n)},Je[ze.SELECT_PARA]=function(t,e,n){t&&t instanceof a.MeloEditor&&t.surface.selectionHandler.selectParagraph(n)},Je[ze.SELECT_ALL]=function(t,e){t&&t instanceof a.MeloEditor&&t.surface.selectionHandler.selectAll()},Je),tn=[{keyBindings:{win:a.KeyCode.ARROW_LEFT,mac:a.KeyCode.ARROW_LEFT},action:ze.ARROW_LEFT},{keyBindings:{win:a.KeyCode.ARROW_UP,mac:a.KeyCode.ARROW_UP},action:ze.ARROW_UP},{keyBindings:{win:a.KeyCode.ARROW_RIGHT,mac:a.KeyCode.ARROW_RIGHT},action:ze.ARROW_RIGHT},{keyBindings:{win:a.KeyCode.ARROW_DOWN,mac:a.KeyCode.ARROW_DOWN},action:ze.ARROW_DOWN},{keyBindings:{win:a.KeyAssist.SHIFT+a.KeyCode.ARROW_LEFT,mac:a.KeyAssist.SHIFT+a.KeyCode.ARROW_LEFT},action:ze.SELECT_LEFT},{keyBindings:{win:a.KeyAssist.SHIFT+a.KeyCode.ARROW_RIGHT,mac:a.KeyAssist.SHIFT+a.KeyCode.ARROW_RIGHT},action:ze.SELECT_RIGHT},{keyBindings:{win:a.KeyAssist.SHIFT+a.KeyCode.ARROW_UP,mac:a.KeyAssist.SHIFT+a.KeyCode.ARROW_UP},action:ze.SELECT_UP},{keyBindings:{win:a.KeyAssist.SHIFT+a.KeyCode.ARROW_DOWN,mac:a.KeyAssist.SHIFT+a.KeyCode.ARROW_DOWN},action:ze.SELECT_DOWN},{keyBindings:{win:a.KeyAssist.CTRL_WIN+a.KeyCode.ARROW_LEFT,mac:a.KeyAssist.ALT+a.KeyCode.ARROW_LEFT},action:ze.MOVE_TO_WORD_LEFT},{keyBindings:{win:a.KeyAssist.CTRL_WIN+a.KeyCode.ARROW_RIGHT,mac:a.KeyAssist.ALT+a.KeyCode.ARROW_RIGHT},action:ze.MOVE_TO_WORD_RIGHT},{keyBindings:{win:a.KeyAssist.CTRL_WIN+a.KeyAssist.SHIFT+a.KeyCode.ARROW_LEFT,mac:a.KeyAssist.ALT+a.KeyAssist.SHIFT+a.KeyCode.ARROW_LEFT},action:ze.SELECT_TO_WORD_LEFT},{keyBindings:{win:a.KeyAssist.CTRL_WIN+a.KeyAssist.SHIFT+a.KeyCode.ARROW_RIGHT,mac:a.KeyAssist.ALT+a.KeyAssist.SHIFT+a.KeyCode.ARROW_RIGHT},action:ze.SELECT_TO_WORD_RIGHT},{keyBindings:{win:a.KeyCode.HOME,mac:[a.KeyCode.HOME,a.KeyAssist.COMMAND+a.KeyCode.ARROW_LEFT]},action:ze.MOVE_TO_LINE_START},{keyBindings:{win:a.KeyCode.END,mac:[a.KeyCode.END,a.KeyAssist.COMMAND+a.KeyCode.ARROW_RIGHT]},action:ze.MOVE_TO_LINE_END},{keyBindings:{win:a.KeyAssist.SHIFT+a.KeyCode.HOME,mac:[a.KeyAssist.SHIFT+a.KeyCode.HOME,a.KeyAssist.COMMAND+a.KeyAssist.SHIFT+a.KeyCode.ARROW_LEFT]},action:ze.SELECT_TO_LINE_START},{keyBindings:{win:a.KeyAssist.SHIFT+a.KeyCode.END,mac:[a.KeyAssist.SHIFT+a.KeyCode.END,a.KeyAssist.COMMAND+a.KeyAssist.SHIFT+a.KeyCode.ARROW_RIGHT]},action:ze.SELECT_TO_LINE_END},{keyBindings:{win:a.KeyAssist.CTRL_WIN+a.KeyAssist.SHIFT+a.KeyCode.ARROW_UP,mac:a.KeyAssist.COMMAND+a.KeyAssist.SHIFT+a.KeyCode.ARROW_UP},action:ze.SELECT_TO_PARA_START},{keyBindings:{win:a.KeyAssist.CTRL_WIN+a.KeyAssist.SHIFT+a.KeyCode.ARROW_DOWN,mac:a.KeyAssist.COMMAND+a.KeyAssist.SHIFT+a.KeyCode.ARROW_DOWN},action:ze.SELECT_TO_PARA_END},{keyBindings:{win:a.KeyAssist.SHIFT+a.KeyCode.PAGE_UP,mac:a.KeyAssist.SHIFT+a.KeyCode.PAGE_UP},action:ze.SELECT_TO_PREV_PAGE},{keyBindings:{win:a.KeyAssist.SHIFT+a.KeyCode.PAGE_DOWN,mac:a.KeyAssist.SHIFT+a.KeyCode.PAGE_DOWN},action:ze.SELECT_TO_NEXT_PAGE},{keyBindings:{win:a.KeyAssist.CTRL_WIN+a.KeyCode.HOME,mac:[a.KeyAssist.COMMAND+a.KeyCode.HOME,a.KeyAssist.COMMAND+a.KeyCode.ARROW_UP]},action:ze.MOVE_TO_STORY_START},{keyBindings:{win:a.KeyAssist.CTRL_WIN+a.KeyCode.END,mac:[a.KeyAssist.COMMAND+a.KeyCode.END,a.KeyAssist.COMMAND+a.KeyCode.ARROW_DOWN]},action:ze.MOVE_TO_STORY_END},{keyBindings:{win:a.KeyAssist.CTRL_WIN+a.KeyAssist.SHIFT+a.KeyCode.HOME,mac:a.KeyAssist.COMMAND+a.KeyAssist.SHIFT+a.KeyCode.HOME},action:ze.SELECT_TO_STORY_START},{keyBindings:{win:a.KeyAssist.CTRL_WIN+a.KeyAssist.SHIFT+a.KeyCode.END,mac:a.KeyAssist.COMMAND+a.KeyAssist.SHIFT+a.KeyCode.END},action:ze.SELECT_TO_STORY_END},{keyBindings:{win:a.KeyAssist.CTRL_WIN+a.KeyCode.A,mac:a.KeyAssist.COMMAND+a.KeyCode.A},action:ze.SELECT_ALL}];!function(t){t.COPY="clipboard_copy",t.CUT="clipboard_cut",t.PASTE="clipboard_paste"}(qe||(qe={}));var en=((Ze={})[qe.COPY]=function(t,e){t&&t instanceof a.MeloEditor&&t.isCopyable()&&t.clipboardManager.copy()},Ze[qe.CUT]=function(t,e){t&&t instanceof a.MeloEditor&&t.isEditable()&&t.clipboardManager.cut()},Ze[qe.PASTE]=function(t,e){t&&t instanceof a.MeloEditor&&t.isEditable()&&t.clipboardManager.paste()},Ze),nn=[{keyBindings:{win:a.KeyAssist.CTRL_WIN+a.KeyCode.C,mac:a.KeyAssist.COMMAND+a.KeyCode.C},action:qe.COPY},{keyBindings:{win:a.KeyAssist.CTRL_WIN+a.KeyCode.X,mac:a.KeyAssist.COMMAND+a.KeyCode.X},action:qe.CUT},{keyBindings:{win:a.KeyAssist.CTRL_WIN+a.KeyCode.V,mac:a.KeyAssist.COMMAND+a.KeyCode.V},action:qe.PASTE}],rn=function(){function t(t,e,n,r){this.mouseDownTime=0,this.mouseDownPos=[0,0],this.mouseUpTime=0,this.mouseUpPos=[0,0],this.mouseType=a.MouseType.NONE,this.mouseAction=a.MouseAction.NONE,this.viewRange=void 0,this.contextMenuShowTimeout=0,this.editor=t,this.state=e,this.mouseSelector=n.mouseSelector,this.scrollHandler=r,this.onMouseMoveListener=this.onMouseMove.bind(this),this.onMouseUpListener=this.onMouseUp.bind(this)}return t.prototype.attach=function(){var t=this;document.addEventListener("mousemove",this.onMouseMoveListener),document.addEventListener("mouseup",this.onMouseUpListener),this.editor.on(a.RenderNotificationTypes.PAGE_MOUSE_EVENT,(function(e){e.event&&("mousedown"===e.event.type?t.onMouseDown(e.event.nativeEvent):"contextmenu"===e.event.type&&t.onContextMenu(e.event.nativeEvent))}))},t.prototype.detach=function(){document.removeEventListener("mousemove",this.onMouseMoveListener),document.removeEventListener("mouseup",this.onMouseUpListener),this.editor.removeListener(a.RenderNotificationTypes.PAGE_MOUSE_EVENT,this)},t.prototype.onMouseDown=function(t){if(s.PlatformUtil.isTencentDocsIPadApp()&&t.cancelable&&t.preventDefault(),0===t.button&&(!s.PlatformUtil.isMobile()||s.PlatformUtil.isTencentDocsIPadApp())&&(this.editor.fire(new a.MouseNotification(t,a.MouseAction.NONE)),this.scrollHandler.disableScrollOnSelectionChanged(),this.mouseType=a.MouseType.DOWN,this.mouseDownTime=Date.now(),this.mouseDownPos=[t.clientX,t.clientY],this.clickInterval(this.mouseUpTime,this.mouseDownTime)&&this.equalPos(this.mouseUpPos,this.mouseDownPos)&&this.mouseAction!==a.MouseAction.DRAG&&this.mouseAction!==a.MouseAction.LONG_CLICK||(this.mouseAction=a.MouseAction.NONE),this.mouseAction===a.MouseAction.NONE)){this.mouseSelector.onMouseEvent(t,a.MouseType.DOWN);var e=this.mouseSelector.getSelection();e&&(this.callMobileContextMenuIfNeed(e.viewRange),this.viewRange=e.viewRange)}},t.prototype.onMouseMove=function(t){if(!s.PlatformUtil.isMobile()||s.PlatformUtil.isTencentDocsIPadApp()){if(this.mouseType===a.MouseType.DOWN){var e=[t.clientX,t.clientY];this.equalPos(this.mouseDownPos,e)||(this.mouseType=a.MouseType.MOVE)}if(this.mouseType===a.MouseType.MOVE){if(this.mouseSelector.onMouseEvent(t,a.MouseType.MOVE),this.mouseSelector.start&&this.mouseSelector.end){var n;n=Object(a.isBackward)(this.mouseSelector.start,this.mouseSelector.end)?this.mouseSelector.start:this.mouseSelector.end,this.scrollHandler.scrollByIfNeedThrottle(t.clientX,t.clientY,n)}this.onDrag(t)}}},t.prototype.onMouseUp=function(t){0!==t.button||s.PlatformUtil.isMobile()&&!s.PlatformUtil.isTencentDocsIPadApp()||this.mouseType!==a.MouseType.UP&&(this.editor.fire(new a.MouseNotification(t,a.MouseAction.NONE)),this.scrollHandler.enableScrollOnSelectionChanged(),this.mouseType=a.MouseType.UP,this.mouseUpTime=Date.now(),this.mouseUpPos=[t.clientX,t.clientY],this.mouseSelector.onMouseEvent(t,a.MouseType.UP),this.equalPos(this.mouseDownPos,this.mouseUpPos)?this.clickInterval(this.mouseDownTime,this.mouseUpTime)?this.mouseAction===a.MouseAction.NONE||this.mouseAction===a.MouseAction.LONG_CLICK?this.onClick(t):this.mouseAction===a.MouseAction.CLICK||this.mouseAction===a.MouseAction.TRIPLE_CLICK?this.onDoubleClick(t):this.mouseAction===a.MouseAction.DOUBLE_CLICK&&this.onTripleClick(t):this.onLongClick(t):this.mouseAction=a.MouseAction.NONE)},t.prototype.onContextMenu=function(t){this.mouseSelector.onMouseEvent(t,a.MouseType.CONTEXTMENU);var e=this.mouseSelector.getSelection();s.PlatformUtil.isTencentDocsIPadApp()&&(null==e?void 0:e.viewRange)&&this.callMobileContextMenu(e.viewRange)},t.prototype.onDrag=function(t){this.mouseAction=a.MouseAction.DRAG,this.editor.fire(new a.MouseNotification(t,a.MouseAction.DRAG))},t.prototype.onClick=function(t){this.mouseAction=a.MouseAction.CLICK,this.editor.fire(new a.MouseNotification(t,a.MouseAction.CLICK)),s.PlatformUtil.isTencentDocsIPadApp()&&this.editor.fire(new a.FocusBlurNotification(a.FocusBlurNotificationType.REQUEST_FOCUS,{viewRange:this.viewRange,from:a.From.EDITOR}),!1)},t.prototype.onDoubleClick=function(t){if(clearTimeout(this.contextMenuShowTimeout),this.mouseAction=a.MouseAction.DOUBLE_CLICK,this.editor.fire(new a.MouseNotification(t,a.MouseAction.DOUBLE_CLICK)),this.viewRange&&!this.state.waitingForReflow){var e=this.viewRange.start.documentBox;e&&!e.isDirty()&&this.editor.run("selectWord",this.viewRange.start.gcp)}},t.prototype.onTripleClick=function(t){if(this.mouseAction=a.MouseAction.TRIPLE_CLICK,this.editor.fire(new a.MouseNotification(t,a.MouseAction.TRIPLE_CLICK)),this.viewRange&&!this.state.waitingForReflow){var e=this.viewRange.start.documentBox;e&&!e.isDirty()&&this.editor.run("selectParagraph",this.viewRange.start.gcp)}},t.prototype.onLongClick=function(t){this.mouseAction=a.MouseAction.LONG_CLICK,this.editor.fire(new a.MouseNotification(t,a.MouseAction.LONG_CLICK))},t.prototype.clickInterval=function(t,e){return e-t<500},t.prototype.equalPos=function(t,e){return Math.abs(t[0]-e[0])<10&&Math.abs(t[1]-e[1])<10},t.prototype.callMobileContextMenuIfNeed=function(t){var e=this;s.PlatformUtil.isTencentDocsIPadApp()&&t&&t.equals(this.viewRange)&&(this.contextMenuShowTimeout=setTimeout((function(){e.editor.isEditable()&&e.callMobileContextMenu(t)}),400))},t.prototype.callMobileContextMenu=function(t){this.editor.fire(new a.ContextMenuMobileNotification(t))},t}(),on=function(){function t(t,e){this.touchStartTime=0,this.touchStartPos=[0,0],this.touchEndTime=0,this.touchEndPos=[0,0],this.focusingTouch=!1,this.touchAction=a.TouchAction.NONE,this.viewRange=void 0,this.contextMenuShowTimeout=0,this.longTouchStartTimeout=0,this.LONG_TOUCH_TIME=300,this.isEditable=function(){return!0},this.editor=t,this.touchSelector=e.touchSelector}return t.prototype.attach=function(){var t=this;this.editor.on(a.RenderNotificationTypes.PAGE_TOUCH_EVENT,(function(e){e.event&&("touchstart"===e.event.type?t.onTouchStart(e.event):"touchmove"===e.event.type?t.onTouchMove(e.event):"touchend"===e.event.type&&t.onTouchEnd(e.event))}))},t.prototype.detach=function(){this.editor.removeListener(a.RenderNotificationTypes.PAGE_TOUCH_EVENT,this)},t.prototype.onTouchStart=function(t){var e=this;if(t.stopPropagation(),!this.shouldIgnore(t.target)&&!(t.touches.length>1)&&t.changedTouches&&0!==t.changedTouches.length){this.editor.fire(new a.TouchNotification(t.nativeEvent,a.TouchAction.NONE)),this.touchStartTime=Date.now();var n=t.changedTouches[0];this.touchStartPos=[n.clientX,n.clientY],this.touchInterval(this.touchEndTime,this.touchStartTime)&&this.equalPos(this.touchEndPos,this.touchStartPos)&&this.touchAction!==a.TouchAction.LONG_TOUCH||(this.touchAction=a.TouchAction.NONE),t.persist(),this.longTouchStartTimeout=setTimeout((function(){e.onLongTouch(t)}),this.LONG_TOUCH_TIME)}},t.prototype.onTouchMove=function(t){t.stopPropagation(),t.touches[0].touchType&&"stylus"===t.touches[0].touchType||(clearTimeout(this.longTouchStartTimeout),this.touchStartTime=0,this.touchStartPos=[0,0],this.touchEndTime=0,this.touchEndPos=[0,0]),this.editor.fire(new a.TouchNotification(t.nativeEvent,a.TouchAction.NONE))},t.prototype.onTouchEnd=function(t){if(t.cancelable&&t.preventDefault(),t.changedTouches&&0!==t.changedTouches.length){t.stopPropagation(),this.editor.fire(new a.TouchNotification(t.nativeEvent,a.TouchAction.NONE)),this.touchEndTime=Date.now();var e=t.changedTouches[0];this.touchEndPos=[e.clientX,e.clientY],this.equalPos(this.touchStartPos,this.touchEndPos)?(clearTimeout(this.longTouchStartTimeout),this.touchInterval(this.touchStartTime,this.touchEndTime)?this.touchAction===a.TouchAction.NONE||this.touchAction===a.TouchAction.LONG_TOUCH?(this.focusingTouch=this.editor.surface.isFocusing(),this.onTouch(t)):this.touchAction===a.TouchAction.TOUCH?this.onDoubleTouch(t):this.touchAction===a.TouchAction.DOUBLE_TOUCH&&this.onTripleTouch(t):this.onLongTouch(t)):this.touchAction=a.TouchAction.NONE}},t.prototype.onTouch=function(t){var e=this;this.touchAction=a.TouchAction.TOUCH,this.touchSelector.onTouchEvent(t.nativeEvent);var n=this.touchSelector.getSelection();(null==n?void 0:n.viewRange)&&(n.viewRange.equals(this.viewRange)&&(this.contextMenuShowTimeout=setTimeout((function(){e.isEditable()&&e.callContextMenu(n.viewRange)}),400)),this.viewRange=n.viewRange),this.requestFocus(),this.editor.fire(new a.TouchNotification(t.nativeEvent,a.TouchAction.TOUCH))},t.prototype.onDoubleTouch=function(t){clearTimeout(this.contextMenuShowTimeout),this.touchAction=a.TouchAction.DOUBLE_TOUCH,this.touchSelector.onTouchEvent(t.nativeEvent);var e=this.touchSelector.getSelection();(null==e?void 0:e.viewRange)&&(this.isTextArea(e)||this.focusingTouch)&&(this.viewRange=e.viewRange,this.editor.run("selectWord",e.viewRange.start.gcp)),this.requestFocus(),this.editor.fire(new a.TouchNotification(t.nativeEvent,a.TouchAction.DOUBLE_TOUCH))},t.prototype.onTripleTouch=function(t){this.touchAction=a.TouchAction.TRIPLE_TOUCH,this.touchSelector.onTouchEvent(t.nativeEvent);var e=this.touchSelector.getSelection();(null==e?void 0:e.viewRange)&&(this.isTextArea(e)||this.focusingTouch)&&(this.viewRange=e.viewRange,this.editor.run("selectParagraph",e.viewRange.start.gcp))},t.prototype.onLongTouch=function(t){if("touchstart"===t.type){this.touchSelector.onTouchEvent(t.nativeEvent);var e=this.touchSelector.getSelection();(null==e?void 0:e.viewRange)&&(this.viewRange=e.viewRange,this.editor.run("selectWord",e.viewRange.start.gcp))}else"touchend"===t.type&&(this.touchAction=a.TouchAction.LONG_TOUCH,this.editor.fire(new a.TouchNotification(t.nativeEvent,a.TouchAction.LONG_TOUCH)))},t.prototype.touchInterval=function(t,e){return e-t<this.LONG_TOUCH_TIME},t.prototype.setIsEditable=function(t){this.isEditable=t},t.prototype.isTextArea=function(t){return 0!==t.viewRange.start.posOffset()&&0!==t.viewRange.end.posOffset()},t.prototype.equalPos=function(t,e){return Math.abs(t[0]-e[0])<20&&Math.abs(t[1]-e[1])<30},t.prototype.callContextMenu=function(t){this.editor.fire(new a.ContextMenuMobileNotification(t))},t.prototype.requestFocus=function(){this.editor.fire(new a.FocusBlurNotification(a.FocusBlurNotificationType.REQUEST_FOCUS,{viewRange:this.viewRange,from:a.From.EDITOR}),!1)},t.prototype.shouldIgnore=function(t){if(t instanceof Element)for(var e=t;e&&!(e instanceof HTMLDivElement&&"melo-line"===e.className);){if(e.__vm__&&Object(a.isContainerBox)(e.__vm__)){var n=e.__vm__;if(n.property instanceof a.PluginContainerProperty&&(n.property.pluginType===a.PluginType.Audio||n.property.pluginType===a.PluginType.Location||n.property instanceof a.SplitlineProperty))return!0}e=e.parentElement}return!1},t}(),an=function(){function t(t,e,n){this.context=t,this.state=e,this.layoutController=n,this.attached=!1,this._selectionHandler=new Ye(t,this.state,n,t.view.renderer.selectionOverlay.currentSelector),this._keymapManager=new We(t,this.state),this._keyboardManager=new Ue(t),this._mouseManager=new rn(t,e,t.view.renderer.selectionOverlay,this.context.view.renderer.scrollHandler),this._touchManager=new on(t,t.view.renderer.selectionOverlay),this.initBasicEdit()}return Object.defineProperty(t.prototype,"keymapManager",{get:function(){return this._keymapManager},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selectionHandler",{get:function(){return this._selectionHandler},enumerable:!0,configurable:!0}),t.prototype.attach=function(){this.attached?s.Logger.warn("Surface has attached"):(this._mouseManager.attach(),this._touchManager.attach(),this._keymapManager.attach(),this._keyboardManager.attach(),this.attachEditingComponent(),this.attached=!0)},t.prototype.detach=function(){this._mouseManager.detach(),this._touchManager.detach(),this._keymapManager.detach(),this._keyboardManager.detach(),this.detachEditingComponent(),this.attached=!1},t.prototype.getFocusableDom=function(){return this.context.view.getDom()},t.prototype.isFocusing=function(){return(this.hiddenEditor instanceof pe||this.hiddenEditor instanceof Ge)&&this.hiddenEditor.isFocus},t.prototype.initBasicEdit=function(){var t=this;this.context.registerPlugin(Xe),Qe.forEach((function(e){t._keymapManager.addKeymap(e)})),this.context.registerPlugin($e),tn.forEach((function(e){t._keymapManager.addKeymap(e)})),this.context.registerPlugin(en),nn.forEach((function(e){((s.PlatformUtil.isIE()||s.PlatformUtil.isWeWorkMacOrWin())&&e.action!==qe.PASTE||s.PlatformUtil.isIPad())&&t._keymapManager.addKeymap(e)}))},t.prototype.attachEditingComponent=function(){var t=this,e=this.context.view.getDom();if(e){var n=e.querySelector(".hidden-editor");if(n)if(s.PlatformUtil.isMobile())g.a.render(h.a.createElement(Ge,{context:this.context,state:this.state,service:this.context.service,scrollHandler:this.context.view.renderer.scrollHandler,zoom:function(){return t.context.view.renderer.zoom},ref:function(e){t.hiddenEditor=e}}),n);else{var r=this.context.view.renderer.getViewSelection().gcpRange,i=Object(a.coreRangeToViewRange)(this.layoutController,(function(e){return t.layoutController.boxHelper.getGCPPair(e)}),r);g.a.render(h.a.createElement(pe,{context:this.context,state:this.state,service:this.context.service,scrollHandler:this.context.view.renderer.scrollHandler,viewRange:i,zoom:function(){return t.context.view.renderer.zoom},ref:function(e){t.hiddenEditor=e}}),n)}var o=e.querySelector(".caret");if(o&&g.a.render(h.a.createElement(le,{context:this.context,service:this.context.service,zoom:function(){return t.context.view.renderer.zoom}}),o),s.PlatformUtil.isMobile()){var l=e.querySelector(".mobile-caret-drag");l&&g.a.render(h.a.createElement(ge,{context:this.context,service:this.context.service,layoutController:this.layoutController,overlay:this.context.view.renderer.selectionOverlay,scrollHandler:this.context.view.renderer.scrollHandler,scrollRoot:this.context.getRoot(),zoom:function(){return t.context.view.renderer.zoom}}),l)}if(s.PlatformUtil.isMobile()){var p=e.querySelector(".mobile-selection-drag");p&&g.a.render(h.a.createElement(Me,{context:this.context,service:this.context.service,layoutController:this.layoutController,overlay:this.context.view.renderer.selectionOverlay,scrollHandler:this.context.view.renderer.scrollHandler,scrollRoot:this.context.getRoot(),zoom:function(){return t.context.view.renderer.zoom}}),p)}if(s.PlatformUtil.isWeWorkMacOrWin()){var c=e.querySelector(".hidden-selection");c&&g.a.render(h.a.createElement(He,{context:this.context}),c)}}else s.Logger.error("attachEditingComponent surface null")},t.prototype.detachEditingComponent=function(){var t=this.context.view.getDom();if(t){var e=t.querySelector(".hidden-editor");e&&e.remove();var n=t.querySelector(".caret");n&&n.remove();var r=t.querySelector(".mobile-caret-drag");r&&r.remove();var i=t.querySelector(".mobile-selection-drag");i&&i.remove();var o=t.querySelector(".hidden-selection");o&&o.remove()}else s.Logger.error("detachEditingComponent surface null")},function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}([ie(0,a.IEditor),ie(1,a.IState),ie(2,a.ILayoutController),oe("design:paramtypes",[a.MeloEditor,a.State,a.LayoutController])],t)}(),sn=function(t){var e=t.factory.inject(a.ISurface,Object(a.createDescriptor)(an));e&&e.attach()};function ln(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}function pn(t,e){return function(n,r){e(n,r,t)}}function cn(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function hn(t){var e=t.getSelection(),n=e.tableCellRange();if(n){var r=e.getTable();if(!r)return!1;var i=r.getTableInfo();if(!i)return!1;i.rowCount===n.cellRange.to.row-n.cellRange.from.row+1&&i.colCount===n.cellRange.to.col-n.cellRange.from.col+1?r.remove():t.getSelection().getTableRangeSevice().clearContent()}else t.getSelection().delete();return!0}var un=function(){function t(t,e){this.context=t,this.service=e}return t.prototype.attach=function(){},t.prototype.detach=function(){},t.prototype.cut=function(){this.copyInterface?(this.copyInterface.copy(),hn(this.service),this.context.fire(new a.ClipboardNotification(a.ClipboardNotificationType.ON_CUT))):s.Logger.warn("clipboard|cut without copyInterface")},ln([a.CopyInterface,cn("design:type",Object)],t.prototype,"copyInterface",void 0),ln([pn(0,a.IEditor),pn(1,a.IService),cn("design:paramtypes",[Object,Object])],t)}(),gn=function(){function t(t,e){this.attached=!1,this.context=t,this.service=e,this.onCutByEventListener=this.onCutByEvent.bind(this)}return t.prototype.attach=function(){if(this.attached)s.Logger.warn("cut has attached");else{var t=this.context.view.getDom();t?(t.addEventListener("cut",this.onCutByEventListener),this.attached=!0):s.Logger.error("CutByWeb attach surfaceDom is null")}},t.prototype.detach=function(){var t=this.context.view.getDom();t?t.removeEventListener("cut",this.onCutByEventListener):s.Logger.error("CutByWeb detach surfaceDom is null"),this.attached=!1},t.prototype.cut=function(){this.context.isEditable()&&(this.copyInterface?(this.copyInterface.copy(),hn(this.service),this.context.fire(new a.ClipboardNotification(a.ClipboardNotificationType.ON_CUT))):s.Logger.warn("clipboard|cut without copyInterface"))},t.prototype.onCutByEvent=function(t){this.context.isEditable()&&this.context.surface.isFocusing()&&(this.copyInterface&&this.copyInterface.onCopyByEvent(t),hn(this.service),this.context.fire(new a.ClipboardNotification(a.ClipboardNotificationType.ON_CUT)))},ln([a.CopyInterface,cn("design:type",Object)],t.prototype,"copyInterface",void 0),ln([pn(0,a.IEditor),pn(1,a.IService),cn("design:paramtypes",[Object,Object])],t)}(),dn=function(t){var e;e=s.PlatformUtil.isMobile()?un:gn;var n=t.factory.inject(a.CutInterface,Object(a.createDescriptor)(e));n&&n.attach()};function fn(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}function yn(t,e){return function(n,r){e(n,r,t)}}function Tn(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}var mn=function(){function t(t,e){this.context=t,this.state=e}return t.prototype.doCopy=function(t){for(var e=a.DeltaOption.createLocalDeltaOption(a.GCPRange.emptyRange()).buildDelta(),n=t||this.state.selection.gcpRange,r=a.DataCollector.collectDataForCopy(this.state.getRWTextStream(),e,n),i=this.state.context.run("transDeltaToAtextData",e,0),o=[],s=0;s<r.length;s++){var l=r[s],p=l.storyId,c=this.state.context.run("transDeltaToAtextData",l.delta,0);o.push({storyId:p,atext:c})}var h="",u=this.context.docEnv.uniqueId;return u&&(h=u),JSON.stringify({mainAtext:i,storyAtexts:o,srcGlobalPadId:h})},t}(),Sn=function(t,e){for(var n="<div class='document'>",r="",i=t.getBeginChild();i;){for(var o=i.getBeginChild(!0);o;){var a=e.parse(o);n+=a.html,r+=a.plain,o=o.getNextSibling(!0)}i=i.getNextSibling()}return{html:n+="</div>",plain:r}},vn=function(){function t(){this.map=new Map,this.map.set(a.ContainerType.Drawing,new Map),this.map.set(a.ContainerType.Plugin,new Map)}return t.prototype.addParser=function(t,e,n){var r=this.map.get(t);r&&r.set(e,n)},t.prototype.getParser=function(t,e){var n=this.map.get(t);return n?n.get(e):null},t.prototype.parse=function(t,e){var n=t.getProperty();if(n){var r=this.getDetailType(n);if(r){var i=this.getParser(n.containerType,r);if(i)return i(t,e)}}return{html:"",plain:""}},t.prototype.getDetailType=function(t){return t instanceof a.DrawingContainerProperty?t.drawingType:t instanceof a.PluginContainerProperty?t.pluginType:void 0},t.prototype.getModelParser=function(){var t=this;return function(e,n){return t.parse(e,n)}},t}(),bn=function(t,e){for(var n=function(t){var e='<p class="paragraph">',n="</p>",r=t.getProperty(),i=a.OutlineLevel.Normal,o=a.BuiltinStyleName.None;if(r){var l=function(t){var e=[],n=[];if(t){if(t.textAlignment===a.TextAlignmentType.Left?(e.push("text-align:left"),n.push("text-align-type-left")):t.textAlignment===a.TextAlignmentType.Center?(e.push("text-align:center"),n.push("text-align-type-center")):t.textAlignment===a.TextAlignmentType.Right?(e.push("text-align:right"),n.push("text-align-type-right")):t.textAlignment===a.TextAlignmentType.Justify&&(e.push("text-align:justify"),n.push("text-align-type-justify")),t.lineSpacingRule===a.LineSpacingType.Multiple){var r=t.lineSpacing;e.push("line-height:"+100*r+"%"),n.push("pap-line-"+r),n.push("pap-line-rule-auto")}else if(t.lineSpacingRule===a.LineSpacingType.Exactly){var i=Object(s.twipsToPx)(t.lineSpacing),o=Object(s.twipsToPt)(t.lineSpacing);e.push("line-height:"+i+"px"),n.push("pap-line-"+o+"pt"),n.push("pap-line-rule-exact")}if(void 0!==t.spaceBefore){var l=Object(s.twipsToPx)(t.spaceBefore),p=Object(s.twipsToPt)(t.spaceBefore);e.push("margin-top:"+l+"px"),n.push("pap-spacing-before-"+p+"pt")}if(void 0!==t.spaceAfter){var c=Object(s.twipsToPx)(t.spaceAfter),h=Object(s.twipsToPt)(t.spaceAfter);e.push("margin-bottom:"+c+"px"),n.push("pap-spacing-after-"+h+"pt")}if(t.characterUnitLeftIndent){var u=t.characterUnitLeftIndent;e.push("margin-left:"+u+"em"),n.push("pap-left-indent-"+u+"em")}else if(t.leftIndent){var g=Object(s.twipsToPx)(t.leftIndent),d=Object(s.twipsToPt)(t.leftIndent);e.push("margin-left:"+g+"px"),n.push("pap-left-indent-"+d+"pt")}if(t.characterUnitRightIndent){var f=t.characterUnitRightIndent;e.push("margin-right:"+f+"em"),n.push("pap-right-indent-"+f+"em")}else if(t.rightIndent){var y=Object(s.twipsToPx)(t.rightIndent),T=Object(s.twipsToPt)(t.rightIndent);e.push("margin-right:"+y+"px"),n.push("pap-right-indent-"+T+"pt")}if(t.characterUnitSpecialIndent){var m=t.characterUnitSpecialIndent;e.push("text-indent:"+m+"em"),m>0?n.push("pap-firstline-indent-"+m+"em"):m<0&&n.push("pap-hanging-indent-"+Math.abs(m)+"em")}else if(t.specialIndent){var S=Object(s.twipsToPx)(t.specialIndent),v=Object(s.twipsToPt)(t.specialIndent);e.push("text-indent:"+S+"px"),v>0?n.push("pap-firstline-indent-"+v+"pt"):v<0&&n.push("pap-hanging-indent-"+Math.abs(v)+"pt")}}return{styles:""+e.join(";"),classes:""+n.join(" ")}}(r);e='<p class="paragraph '+l.classes+'" style="'+l.styles+'">',i=r.outlineLevel,o=r.styleName,i>a.OutlineLevel.Normal&&(o===a.BuiltinStyleName.Title||o===a.BuiltinStyleName.Subtitle?(e='<p style="text-align:center;">',n="</p>"):i>a.OutlineLevel.Level6?(e="<p>",n="</p>"):(e="<h"+i+">",n="</h"+i+">"))}return{htmlPrefix:e,htmlSuffix:n}}(t),r=n.htmlPrefix,i="",o=t.getBeginChild();o;){if(o instanceof a.GroupNode)for(var l=o.getBeginChild();l;){var p;r+=(p=e.parse(l)).html,i+=p.plain,l=l.getNextSibling()}else r+=(p=e.parse(o)).html,i+=p.plain;o=o.getNextSibling()}return{html:r+=n.htmlSuffix,plain:i}},_n=new RegExp(a.PlaceholderChar.ParagraphBreak+"|"+a.PlaceholderChar.ParagraphReturn+"|"+a.PlaceholderChar.TableStart+"|"+a.PlaceholderChar.TableEnd+"|"+a.PlaceholderChar.TableCellBreak+"|"+a.PlaceholderChar.TableCellStart+"|"+a.PlaceholderChar.TableRowBreak+"|"+a.PlaceholderChar.TableRowStart,"g"),Pn=new RegExp(a.PlaceholderChar.TableStart+"|"+a.PlaceholderChar.TableEnd+"|"+a.PlaceholderChar.TableCellBreak+"|"+a.PlaceholderChar.TableCellStart+"|"+a.PlaceholderChar.TableRowBreak+"|"+a.PlaceholderChar.TableRowStart,"g"),Rn=function(t){var e,n=t.getLimitContent(),r=t.getProperty(),i="";r&&(i=(i+=a.CssUtil.computeTextSpanFullStyles(r).cssText).replace(/"/g,""),r.link&&Object(s.isLinkValid)(r.link)&&(e=r.link));var o="";return e&&(o+='<a href="'+e+'">'),o+='<span style="'+i+'">'+Object(s.escapeHTML)(n?n.replace(_n,""):n)+"</span>",e&&(o+="</a>"),{html:o,plain:n=n.replace(Pn,"")}},Cn=function(){function t(t,e){this.map=new Map,this.context=t,this.state=e,this.containerMgr=new vn,this.initBasicModelParser(),this.addModelParser(a.LayoutInputNodeType.EmbedContainer,this.containerMgr.getModelParser())}return t.prototype.initBasicModelParser=function(){this.addModelParser(a.LayoutInputNodeType.Document,Sn),this.addModelParser(a.LayoutInputNodeType.Paragraph,bn),this.addModelParser(a.LayoutInputNodeType.Text,Rn)},t.prototype.addModelParser=function(t,e){this.map.set(t,e)},t.prototype.getModelParser=function(t){return this.map.get(t)},t.prototype.addContainerParser=function(t,e,n){this.containerMgr.addParser(t,e,n)},t.prototype.parse=function(t){var e=this.getModelParser(t.getType());return e?e(t,this):(s.Logger.error("cannot find parser for type="+t.getType()),{html:"",plain:""})},t.prototype.doCopy=function(t){var e=t?[t]:this.state.selection.gcpRanges,n=this.state.dataEngine,r=Object(a.createDocumentNode)(n,e),i="",o="";if(r){var s=this.parse(r);i+=s.html,o+=s.plain}return{html:i,plain:o}},t}(),In=function(){function t(t,e,n){this.copyFromMenuClick=!1,this.attached=!1,this.context=t,this.customClipboard=n,this.copyParserManager=new Cn(t,e),this.copyInternal=new mn(t,e),this.onCopyByEventListener=this.onCopyByEvent.bind(this),this.onCopyByMenuListener=this.onCopyByMenu.bind(this)}return t.prototype.attach=function(){if(this.attached)s.Logger.warn("copy has attached");else{var t=this.context.view.getDom();t?(t.addEventListener("copy",this.onCopyByEventListener),document.addEventListener("copy",this.onCopyByMenuListener),this.attached=!0):s.Logger.error("CopyByWeb attach surfaceDom is null")}},t.prototype.detach=function(){var t=this.context.view.getDom();t?t.removeEventListener("copy",this.onCopyByEventListener):s.Logger.error("CopyByWeb detach surfaceDom is null"),document.removeEventListener("copy",this.onCopyByMenuListener),this.attached=!1},t.prototype.copy=function(t){if(this.context.isCopyable())if(this.copyFromMenuClick=!0,this.range=t,s.PlatformUtil.isSafari()||s.PlatformUtil.isIE()||s.PlatformUtil.isWeWorkMacOrWin()){var e=document.createElement("textarea");e.style.opacity="0",e.contentEditable="true",document.body.appendChild(e),e.value=" ";var n=document.createRange();n.selectNode(e);var r=window.getSelection();r&&(r.removeAllRanges(),r.addRange(n)),document.execCommand("copy"),setTimeout((function(){document.body.removeChild(e)}),500)}else document.execCommand("copy")},t.prototype.onCopyByMenu=function(t){this.copyFromMenuClick&&(this.onCopyByEvent(t),this.copyFromMenuClick=!1,this.range=void 0)},t.prototype.onCopyByEvent=function(t){var e;if(this.context.isCopyable()&&(e=s.PlatformUtil.isIE()?window.clipboardData:t.clipboardData)){var n=document.createElement("div"),r=document.createElement("meta");r.setAttribute("charset","utf-8"),n.appendChild(r);var i=this.copyInternal.doCopy(this.range);this.customClipboard.setData(i);var o=document.createElement("melo-data");o.setAttribute("data-src",i),o.setAttribute("data-version",a.DATA_VERSION),n.appendChild(o);var l=this.copyParserManager.doCopy(this.range),p=l.html,c=l.plain,h=document.createElement("div");h.innerHTML=p,n.appendChild(h),s.PlatformUtil.isIE()?e.setData("Text",c):(e.setData("text/html",n.innerHTML),e.setData("text/plain",c)),this.context.fire(new a.ClipboardNotification(a.ClipboardNotificationType.ON_COPY)),t.preventDefault()}},t.prototype.addCopyModelParser=function(t,e){this.copyParserManager.addModelParser(t,e)},t.prototype.addCopyContainerParser=function(t,e,n){this.copyParserManager.addContainerParser(t,e,n)},fn([yn(0,a.IEditor),yn(1,a.IState),yn(2,a.ICustomClipboard),Tn("design:paramtypes",[Object,a.State,a.CustomClipboard])],t)}(),An=function(){function t(t,e,n){this.context=t,this.customClipboard=n,this.copyParserManager=new Cn(t,e)}return t.prototype.attach=function(){},t.prototype.detach=function(){},t.prototype.copy=function(t){var e=this.copyParserManager.doCopy(t).plain;this.customClipboard.setData(e),this.customClipboard.writeToSysytemClipboard(),this.context.fire(new a.ClipboardNotification(a.ClipboardNotificationType.ON_COPY))},t.prototype.onCopyByEvent=function(t){},t.prototype.addCopyModelParser=function(t,e){this.copyParserManager.addModelParser(t,e)},t.prototype.addCopyContainerParser=function(t,e,n){this.copyParserManager.addContainerParser(t,e,n)},fn([yn(0,a.IEditor),yn(1,a.IState),yn(2,a.ICustomClipboard),Tn("design:paramtypes",[Object,a.State,a.CustomClipboard])],t)}(),wn=function(t){var e,n=t.factory;e=s.PlatformUtil.isMobile()?An:In;var r=n.inject(a.CopyInterface,Object(a.createDescriptor)(e));r&&r.attach(),(r instanceof In||r instanceof An)&&n.inject(a.ICopyParserManager,r)},En=function(){function t(){}return t.load=function(t){this.addons.forEach((function(e){return e(t)}))},t.loadService=function(t){te(t)},t.loadSurface=function(t){sn(t)},t.loadClipboard=function(t){wn(t),dn(t),V(t)},t.addons=[te,sn,wn,dn,V],t}()}.call(this,n(73))}}]);