(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{264:function(t,e,n){t.exports={"audio-record-outer-ring-show-animation-path":"audio-record-outer-ring-show-animation-path--2roVj","audio-record-outer-ring-hide-animation-path":"audio-record-outer-ring-hide-animation-path--3kryx","audio-play-btn-before-animation-path":"audio-play-btn-before-animation-path--15wsI","audio-play-btn-self-animation-path":"audio-play-btn-self-animation-path--3GVVW"}},272:function(t,e,n){},273:function(t,e,n){t.exports={"link-tips":"link-tips--2-Uhc","link-tips-link":"link-tips-link--3bWKy","link-tips-delete":"link-tips-delete--3XI5Z","link-tips-modify":"link-tips-modify--3P-AQ","link-dialog":"link-dialog--3AY1B","link-dialog-arrow":"link-dialog-arrow--1MOfl","link-dialog-triangle-outer":"link-dialog-triangle-outer--1Cnb8","link-dialog-triangle-inner":"link-dialog-triangle-inner--2OaI9","link-dialog-content":"link-dialog-content--3T-PB","link-dialog-input-container":"link-dialog-input-container--2pR4I","line-margin":"line-margin--3x8yY","link-dialog-input-label":"link-dialog-input-label--23tml","link-dialog-input":"link-dialog-input--1erQG","link-error":"link-error--260nZ","link-dialog-bottom-btn":"link-dialog-bottom-btn--3NeYq","link-dialog-mobile-mask":"link-dialog-mobile-mask--OXnLz","link-dialog-mobile-container":"link-dialog-mobile-container--1KQ4K","link-dialog-mobile-title-text":"link-dialog-mobile-title-text--xUo1r","link-dialog-mobile-title-close":"link-dialog-mobile-title-close--1QzE-","link-dialog-mobile-title-border":"link-dialog-mobile-title-border--15RLv","link-dialog-mobile-input-container":"link-dialog-mobile-input-container--2FFxL","link-dialog-doclink-tip-container":"link-dialog-doclink-tip-container--1htPZ","link-dialog-doclink-tip-container-mobile":"link-dialog-doclink-tip-container-mobile--3IuEC","link-dialog-doclink-name":"link-dialog-doclink-name--3Nm7H","link-dialog-doclink-name-mobile":"link-dialog-doclink-name-mobile--16pQc","link-dialog-doclink-replace":"link-dialog-doclink-replace--1HRUf","link-dialog-doclink-replace-mobile":"link-dialog-doclink-replace-mobile--jCAd3","link-dialog-mobile-input-label":"link-dialog-mobile-input-label--2OFq0","link-dialog-mobile-input":"link-dialog-mobile-input--1sO15","link-dialog-mobile-error-tips":"link-dialog-mobile-error-tips--i-FSu","link-dialog-mobile-bottom-btn":"link-dialog-mobile-bottom-btn--38Waz"}},287:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var i=n(2);function o(t,e){e.createdDate=+new Date;var n,o="docs_actions",r=(n=o,i.LocalStorageUtil.getItem(n));r=r&&JSON.parse(r)||[];var a={};r.forEach((function(t,e){var n=t.data;a[n.localPadId+"$"+n.domainId]={index:e,type:t.type,value:n}}));var s,c,l=a[e.localPadId+"$"+e.domainId];if(l){for(var u in e)u&&(l.value[u]=e[u]);r[l.index]={type:"ADD"===l.type&&"MODIFY"===t?"ADD":t,data:l.value}}else r.push({type:t,data:e});s=o,c=JSON.stringify(r),i.LocalStorageUtil.setItem(s,c)}},290:function(t,e,n){},323:function(t,e,n){},324:function(t,e,n){t.exports={"insert-record":"insert-record--2COj4"}},328:function(t){t.exports=JSON.parse('{"v":"5.1.20","fr":25,"ip":0,"op":49,"w":56,"h":56,"nm":"录音中","ddd":0,"assets":[],"layers":[{"ddd":0,"ind":1,"ty":4,"nm":"内圆","sr":1,"ks":{"o":{"a":1,"k":[{"i":{"x":[0.263],"y":[3.349]},"o":{"x":[0.333],"y":[0]},"n":["0p263_3p349_0p333_0"],"t":0,"s":[100],"e":[100]},{"i":{"x":[0.102],"y":[0.977]},"o":{"x":[0.73],"y":[-0.001]},"n":["0p102_0p977_0p73_-0p001"],"t":7,"s":[100],"e":[10]},{"i":{"x":[0.385],"y":[1.031]},"o":{"x":[0.532],"y":[0.002]},"n":["0p385_1p031_0p532_0p002"],"t":12,"s":[10],"e":[100]},{"i":{"x":[0.667],"y":[1]},"o":{"x":[0.41],"y":[0.369]},"n":["0p667_1_0p41_0p369"],"t":22,"s":[100],"e":[100]},{"t":48}],"ix":11},"r":{"a":0,"k":0,"ix":10},"p":{"a":0,"k":[301.009,469.503,0],"ix":2},"a":{"a":0,"k":[0,0,0],"ix":1},"s":{"a":0,"k":[100,100,100],"ix":6}},"ao":0,"shapes":[{"ty":"gr","it":[{"d":1,"ty":"el","s":{"a":0,"k":[23.373,23.373],"ix":2},"p":{"a":0,"k":[0,0],"ix":3},"nm":"椭圆路径 1","mn":"ADBE Vector Shape - Ellipse","hd":false},{"ty":"st","c":{"a":0,"k":[0.003921568859,0.533333361149,0.984313726425,1],"ix":3},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":0,"ix":5},"lc":1,"lj":1,"ml":4,"nm":"描边 1","mn":"ADBE Vector Graphic - Stroke","hd":false},{"ty":"fl","c":{"a":0,"k":[0.003921568859,0.533333361149,0.984313726425,1],"ix":4},"o":{"a":0,"k":100,"ix":5},"r":1,"nm":"填充 1","mn":"ADBE Vector Graphic - Fill","hd":false},{"ty":"tr","p":{"a":0,"k":[-273.063,-441.438],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[99.443,99.443],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"变换"}],"nm":"椭圆 1","np":3,"cix":2,"ix":1,"mn":"ADBE Vector Group","hd":false}],"ip":0,"op":56,"st":0,"bm":0},{"ddd":0,"ind":2,"ty":4,"nm":"外圆","sr":1,"ks":{"o":{"a":1,"k":[{"i":{"x":[0.667],"y":[1]},"o":{"x":[0.167],"y":[0.167]},"n":["0p667_1_0p167_0p167"],"t":2,"s":[0],"e":[90]},{"i":{"x":[0.246],"y":[1.146]},"o":{"x":[0.398],"y":[0.026]},"n":["0p246_1p146_0p398_0p026"],"t":3,"s":[90],"e":[20]},{"i":{"x":[0.833],"y":[1]},"o":{"x":[0.167],"y":[0]},"n":["0p833_1_0p167_0"],"t":39,"s":[20],"e":[0]},{"t":48}],"ix":11},"r":{"a":0,"k":0,"ix":10},"p":{"a":0,"k":[28.116,28.122,0],"ix":2},"a":{"a":0,"k":[-272.875,-441.375,0],"ix":1},"s":{"a":1,"k":[{"i":{"x":[0.667,0.667,0.667],"y":[1,1,1]},"o":{"x":[0.167,0.167,0.167],"y":[0,0,0]},"n":["0p667_1_0p167_0","0p667_1_0p167_0","0p667_1_0p167_0"],"t":0,"s":[90,90,100],"e":[90,90,100]},{"i":{"x":[0.466,0.466,0.667],"y":[1.014,1.014,1]},"o":{"x":[0.665,0.665,0.333],"y":[0.126,0.126,0]},"n":["0p466_1p014_0p665_0p126","0p466_1p014_0p665_0p126","0p667_1_0p333_0"],"t":3,"s":[90,90,100],"e":[236,236,100]},{"t":48}],"ix":6}},"ao":0,"shapes":[{"ty":"gr","it":[{"d":1,"ty":"el","s":{"a":0,"k":[23.373,23.373],"ix":2},"p":{"a":0,"k":[0,0],"ix":3},"nm":"椭圆路径 1","mn":"ADBE Vector Shape - Ellipse","hd":false},{"ty":"st","c":{"a":0,"k":[0.003921568859,0.533333361149,0.984313726425,1],"ix":3},"o":{"a":0,"k":100,"ix":4},"w":{"a":1,"k":[{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0.167],"y":[0.167]},"n":["0p833_0p833_0p167_0p167"],"t":10,"s":[2],"e":[1]},{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0.167],"y":[0.167]},"n":["0p833_0p833_0p167_0p167"],"t":43,"s":[1],"e":[0]},{"t":48}],"ix":5},"lc":1,"lj":1,"ml":4,"nm":"描边 1","mn":"ADBE Vector Graphic - Stroke","hd":false},{"ty":"fl","c":{"a":0,"k":[0.003921568859,0.533333361149,0.984313726425,1],"ix":4},"o":{"a":0,"k":0,"ix":5},"r":1,"nm":"填充 1","mn":"ADBE Vector Graphic - Fill","hd":false},{"ty":"tr","p":{"a":0,"k":[-273.063,-441.438],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[99.443,99.443],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"变换"}],"nm":"椭圆 1","np":3,"cix":2,"ix":1,"mn":"ADBE Vector Group","hd":false}],"ip":0,"op":56,"st":0,"bm":0}],"markers":[]}')},330:function(t,e,n){t.exports={"toc-button":"toc-button--2KoYK"}},332:function(t,e,n){"use strict";n.d(e,"b",(function(){return h})),n.d(e,"a",(function(){return f}));var i,o=n(1),r=n.n(o),a=n(0),s=n(334),c=n(333),l=n.n(c),u=(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),p=function(){return(p=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},d=function(t){function e(e){var n=t.call(this,e)||this;return n.state={type:e.type,value:e.value},n}return u(e,t),e.prototype.componentDidMount=function(){var t=this;this.props.context.on(s.b.PageShadeChanged,(function(e){e.shadeType===t.state.type&&e.shadeValue===t.state.value||t.setState({type:e.shadeType,value:e.shadeValue})}),this)},e.prototype.componentWillUnmount=function(){this.props.context.removeListener(s.b.PageShadeChanged,this)},e.prototype.render=function(){var t={},e=l.a["shading-bg"]+" shading-bg";return this.state.type===a.ShadingType.ShadingNone?(t.backgroundImage="",t.backgroundColor="#FFFFFF"):this.state.type===a.ShadingType.ShadingColor?(t.backgroundImage="",t.backgroundColor=this.state.value):this.state.type===a.ShadingType.ShadingTexture&&(t.backgroundColor="#FFFFFF",e+=" "+this.state.value),r.a.createElement("div",{className:e,style:p({},t)})},e}(r.a.Component);function h(t){var e=t.service.getDocument().getGlobalProperty();return e?{type:e.shadingType,value:e.shadingValue}:{type:a.ShadingType.ShadingNone,value:""}}function f(t){return function(){var e=h(t);return[r.a.createElement(d,{key:"pageshade",context:t,type:e.type,value:e.value}),{order:a.PageOrderType.Back}]}}},333:function(t,e,n){t.exports={"shading-bg":"shading-bg--34YoV"}},334:function(t,e,n){"use strict";n.d(e,"b",(function(){return o})),n.d(e,"a",(function(){return s}));var i,o,r=n(2),a=(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});!function(t){t.PageShadeChanged="PageShadeChanged"}(o||(o={}));var s=function(t){function e(e,n){var i=t.call(this,o.PageShadeChanged)||this;return i.shadeType=e,i.shadeValue=n,i}return a(e,t),e}(r.Notification)},487:function(t,e,n){"use strict";n.d(e,"a",(function(){return At}));var i,o,r,a,s=n(1),c=n.n(s),l=n(11),u=n.n(l),p=n(0),d=(n(264),n(473)),h=n(255),f=function(){function t(){}return t.serializeAudioData=function(t){return JSON.stringify(t)},t.deserializeAudioData=function(t){return JSON.parse(t)},t.formatTime=function(t){var e={hour:0,minute:0,second:0};t&&(e.hour=t>=3600?Math.floor(t/3600):0,e.minute=t>=3600?Math.floor(t%3600):Math.floor(t/60),e.second=Math.floor(t%60));var n=function(t,e){void 0===e&&(e=2);for(var n="",i=1,o=t;i<e;)i+=1,0===(o=Math.floor(o/10))&&(n+="0");return n+t};return e.hour>0?n(e.hour)+":"+n(e.minute)+":"+n(e.second):n(e.minute)+":"+n(e.second)},t.formatTimeByMillisecond=function(e){return t.formatTime(e/1e3)},t}();!function(t){t.None="none",t.Record="record",t.Play="play"}(i||(i={})),function(t){t[t.None=0]="None",t[t.Pending=1]="Pending",t[t.Runing=2]="Runing",t[t.Stopping=3]="Stopping",t[t.Stopped=4]="Stopped"}(o||(o={})),function(t){t[t.None=0]="None",t[t.Uploading=1]="Uploading",t[t.Finish=2]="Finish",t[t.Abort=3]="Abort"}(r||(r={})),function(t){t[t.Complete=0]="Complete",t[t.Simple=1]="Simple",t[t.MoreSimple=2]="MoreSimple",t[t.ExtremeSimple=3]="ExtremeSimple",t[t.None=4]="None"}(a||(a={}));var g="";function y(t){g=g+"|"+t,console.log(t)}var m,v,b=n(471);!function(t){t.Common="record_common_errors",t.PermissionDenied="record_permission_denied",t.DevicesNotFound="record_devices_not_found",t.NotSupport="record_not_support",t.EncoderUnload="encoder_load_failed",t.Upload="record_upload_error"}(m||(m={})),function(t){t.Common="play_common_errors",t.SourceUrl="play_source_url_error",t.Network="play_network_error",t.SourceNotSupport="play_source_not_support"}(v||(v={}));var k,w=function(){function t(t,e,n){this.message=t,this.literal=n||"audio_common_error",this.show=e||!1}return t.error=function(e){var n=e||"audio_unknown_error",i=t.errors.get(n);return new t(i.message,i.show||!1,n)},t.errors=new Map([[m.Common,{message:"录音失败，请稍后重试",show:!0}],[m.PermissionDenied,{message:"录音权限已禁用",show:!0}],[m.DevicesNotFound,{message:"未找到录音设备",show:!0}],[m.NotSupport,{message:"当前浏览器不支持录音功能",show:!0}],[m.EncoderUnload,{message:"编码器加载失败，请检查网络",show:!0}],[m.Upload,{message:"录音上传失败, 请检查网络",show:!1}],[v.Common,{message:"播放失败，请稍后重试",show:!1}],[v.Network,{message:"播放失败，请检查网络",show:!0}],[v.SourceNotSupport,{message:"该资源不支持播放",show:!0}],[v.SourceUrl,{message:"获取音频链接失败",show:!0}],["audio_unknown_error",{message:"未知错误",show:!1}]]),t}(),S=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function a(t){try{c(i.next(t))}catch(t){r(t)}}function s(t){try{c(i.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((i=i.apply(t,e||[])).next())}))},T=function(t,e){var n,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(t){r=[6,t],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}},_=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,o,r=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(t){o={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a},x=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(_(arguments[e]));return t},E=function(){function t(){var t=this;if(this.worker=null,this.audioBuffer=[],this.mp3Blob=null,this.mp3BlobHandler=null,window.lamejs){var e=new Blob([this.workerScript],{type:"text/javascript"});this.worker=new Worker(URL.createObjectURL(e)),this.worker.onmessage=function(e){t.worker.terminate(),t.mp3BlobHandler?t.mp3BlobHandler(e.data):t.mp3Blob=e.data},this.worker.onerror=function(e){console.log(e),t.worker.terminate()}}else console.error("lamejs is not loaded")}return Object.defineProperty(t.prototype,"workerScript",{get:function(){return window.lamejs.toString()+';\n        lamejs();\n        const audioBuffer = [];\n        console.log(lamejs);\n        const mp3Encoder = new lamejs.Mp3Encoder(1, 44100, 64);\n        onmessage = function(e) {\n            if (e.data.sample) {\n                const sample = e.data.sample;\n                const sampleBlockSize = 1152;\n                let remain = sample.length;\n                for (let i = 0; remain >= 0; i += sampleBlockSize) {\n                    const chunk = sample.subarray(i, i + sampleBlockSize);\n                    const mp3Buffer = mp3Encoder.encodeBuffer(chunk);\n                    audioBuffer.push(new Int8Array(mp3Buffer));\n                    remain -= sampleBlockSize;\n                }\n            } else {\n                audioBuffer.push(mp3Encoder.flush());\n                postMessage(new Blob(audioBuffer, { type: "audio/mp3" }));\n            }\n        };'},enumerable:!0,configurable:!0}),t.prototype.encodeFloat32=function(t){this.encodeInt16(function(t){for(var e=new Int16Array(t.length),n=0;n<t.length;++n){var i=Math.max(-1,Math.min(1,t[n]));e[n]=i<0?32768*i:32767*i}return e}(t))},t.prototype.encodeInt16=function(t){this.worker&&this.worker.postMessage({sample:t})},t.prototype.finishEncode=function(){this.worker.postMessage({})},t.prototype.blob=function(){return S(this,void 0,void 0,(function(){var t=this;return T(this,(function(e){return[2,new Promise((function(e,n){t.mp3Blob?e(t.mp3Blob):t.mp3BlobHandler=function(t){e(t)}}))]}))}))},t.encodeWAV=function(t,e,n){void 0===n&&(n=1);var i,o,r=new ArrayBuffer(44+2*t.length),a=new DataView(r);return a.setString&&(i=a.setString),a.setSample&&(o=a.setSample),a.setString=function(t,e){for(var n=0;n<e.length;n++)a.setUint8(t+n,e.charCodeAt(n))},a.setSample=function(t,e,n){void 0===n&&(n=16);var i=t;if(16===n)for(var o=0;o<e.length;++o){var r=Math.max(-1,Math.min(1,e[o]));a.setInt16(i,r<0?32768*r:32767*r,!0),i+=2}else for(o=0;o<e.length;++o)a.setInt8(i,Math.round(255/(65535/(e[o]+32768)))),i+=1},a.setString(0,"RIFF"),a.setUint32(4,36+2*t.length,!0),a.setString(8,"WAVE"),a.setString(12,"fmt "),a.setUint32(16,16,!0),a.setUint16(20,1,!0),a.setUint16(22,n,!0),a.setUint32(24,e,!0),a.setUint32(28,4*e,!0),a.setUint16(32,2*n,!0),a.setUint16(34,16,!0),a.setString(a,36,"data"),a.setUint32(40,2*t.length,!0),delete a.setString,i&&(a.setString=i),o&&(a.setSample=o),a},t}(),L=function(){function t(){this.audioContext=null,this.source=null,this.processor=null,this.analyser=null,this.activeStream=null,this.encoder=null,this.recordChannelLength=0,this._isRecording=!1,this.streamConstraints={audio:!0},this.process=this.process.bind(this)}return Object.defineProperty(t.prototype,"isRecording",{get:function(){return this._isRecording},enumerable:!0,configurable:!0}),t.prototype.getUserMedia=function(t){return S(this,void 0,void 0,(function(){var e;return T(this,(function(n){return navigator.mediaDevices?[2,navigator.mediaDevices.getUserMedia(t)]:(e=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia)?[2,new Promise((function(n,i){e.call(navigator,t,n,i)}))]:[2,Promise.reject(new Error("getUserMedia is not implemented"))]}))}))},t.prototype.preloadEncoder=function(){if(!window.lamejs){var t=document.createElement("script");t.src="/static/dev/doc_static/js/lame.min.js",document.head.appendChild(t)}},t.prototype.loadEncoder=function(){return S(this,void 0,void 0,(function(){return T(this,(function(t){return[2,new Promise((function(t,e){if(window.lamejs)t();else{var n=document.createElement("script");n.src="/static/dev/doc_static/js/lame.min.js",n.onload=function(){t()},n.onerror=function(){e(new Error("load lamejs failed"))},document.head.appendChild(n)}}))]}))}))},t.prototype.startRecord=function(t,e){var n=this;console.log("start record"),this.subject=e,this.loadEncoder().then((function(){n.audioContext=new(window.AudioContext||window.webkitAudioContext),n.audioContext?n.getUserMedia(n.streamConstraints).then((function(t){n.activeStream=t,n.audioContext?(n.encoder=new E,n.source=n.audioContext.createMediaStreamSource(t),n.processor=n.source.context.createScriptProcessor(4096,1,1)||n.source.context.createJavaScriptNode(4096,1,1),n.analyser=n.source.context.createAnalyser(),n.processor.addEventListener("audioprocess",n.process),n.analyser.fftSize=256,n._isRecording=!0,n.source.connect(n.processor),n.processor.connect(n.source.context.destination),n.source.connect(n.analyser)):n.error(new w("no context"))})).catch((function(t){var e;switch(console.error("navigator media device get user media failed "+t),t.name){case"NotAllowedError":case"PermissionDeniedError":e=m.PermissionDenied;break;case"NotFoundError":case"DevicesNotFoundError":e=m.DevicesNotFound;break;case"NotSupportedError":e=m.NotSupport;break;default:e=m.Common}n.error(w.error(e))})):n.error(new w("no context"))})).catch((function(t){n.error(w.error(m.EncoderUnload))}))},t.prototype.stopRecord=function(){return S(this,void 0,void 0,(function(){var t;return T(this,(function(e){switch(e.label){case 0:return this._isRecording=!1,this.subject=null,this.recordChannelLength=0,this.source&&(this.source.disconnect(),this.source=null),this.processor&&(this.processor.disconnect(),this.processor.removeEventListener("audioprocess",this.process),this.processor.onaudioprocess=null,this.processor=null),this.analyser&&(this.analyser.disconnect(),this.analyser=null),this.activeStream&&(this.activeStream.getAudioTracks().forEach((function(t){return t.stop()})),this.activeStream=null),this.audioContext&&(this.audioContext.close(),this.audioContext=null),t=null,this.encoder?(this.encoder.finishEncode(),[4,this.encoder.blob()]):[3,2];case 1:return t=e.sent(),console.log(t),this.encoder=null,[3,3];case 2:console.warn("no blob generated"),e.label=3;case 3:return[2,t||Promise.reject()]}}))}))},t.prototype.process=function(t){if(this.isRecording)if(this.audioContext){var e=t.inputBuffer.getChannelData(0);this.encoder.encodeFloat32(e),this.recordChannelLength+=e.length;var n=this.audioContext.sampleRate,i=Math.round(this.recordChannelLength/n*1e3);if(this.analyser){var o=new Float32Array(this.analyser.fftSize);this.analyser.getFloatTimeDomainData(o);var r=new Uint8Array(this.analyser.frequencyBinCount);this.analyser.getByteFrequencyData(r);var a=Math.max.apply(Math,x(o)),s=Math.max.apply(Math,x(r));console.log("volume f: "+s+", t: "+a),this.deliver(i,s/255)}else this.deliver(i)}else this.error(new w("no context"))},t.prototype.deliver=function(t,e){if(this.subject){var n=this.subject.getValue().id;this.subject.next({id:n,duration:t,volume:e})}},t.prototype.error=function(t){if(this.subject){var e=this.subject.getValue().id;this.subject.next({id:e,error:t})}},t}(),P=function(){function t(t){void 0===t&&(t=!0),this._isRecording=!1,this.encoder=null,this.recordChannelLength=0,this.interrupted=null,this.mp3Blob=null,this.mp3BlobHandler=null,this.nativeEncode=t,t||this.preloadEncoder()}return Object.defineProperty(t.prototype,"isRecording",{get:function(){return this._isRecording},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"core",{get:function(){return this._core||(this._core={start:function(t,e){window.mqq.invoke("docx","startRecord",{encode:t?"native":"web",limit:600},e)},stop:function(){window.mqq.invoke("docx","stopRecord")}}),this._core},enumerable:!0,configurable:!0}),t.prototype.preloadEncoder=function(){if(!window.lamejs){var t=document.createElement("script");t.src="/static/dev/doc_static/js/lame.min.js",document.head.appendChild(t)}},t.prototype.prepare=function(){this.core.stop()},t.prototype.loadEncoder=function(){return S(this,void 0,void 0,(function(){var t=this;return T(this,(function(e){return[2,new Promise((function(e,n){if(t.nativeEncode||window.lamejs)e();else{var i=document.createElement("script");i.src="/static/dev/doc_static/js/lame.min.js",i.onload=function(){e()},i.onerror=function(){n(new Error("load lamejs failed"))},document.head.appendChild(i)}}))]}))}))},t.prototype.startRecord=function(t,e,n){return S(this,void 0,void 0,(function(){var t=this;return T(this,(function(i){return console.log("start record"),this.subject=e,this.interrupted=n,this.loadEncoder().then((function(){t.nativeEncode||(t.encoder=new E),t.core.start(t.nativeEncode,(function(e){if(e.status)if("start"===e.status)t._isRecording=!0;else if(("stop"===e.status||"encoding"===e.status)&&t.interrupted)return e.mp3data&&t.cacheMp3data(e.mp3data),t.interrupted(),void(t.interrupted=null);e.mp3data&&t.cacheMp3data(e.mp3data),e.pcmdata&&t.process(e.pcmdata),e.duration&&t.deliver(e.duration),e.error&&t.error(t.nativeToAudioError(e.error))}))})).catch((function(e){t.error(w.error(m.EncoderUnload))})),[2]}))}))},t.prototype.stopRecord=function(){return S(this,void 0,void 0,(function(){var t;return T(this,(function(e){switch(e.label){case 0:return this.core.stop(),this._isRecording=!1,this.interrupted=null,this.subject=null,this.recordChannelLength=0,t=null,this.nativeEncode?[4,this.getNativeMp3Blob()]:[3,2];case 1:return t=e.sent(),console.log(t),this.mp3Blob=null,this.mp3BlobHandler=null,[3,5];case 2:return this.encoder?(this.encoder.finishEncode(),[4,this.encoder.blob()]):[3,4];case 3:return t=e.sent(),console.log(t),this.encoder=null,[3,5];case 4:console.warn("no blob generated"),e.label=5;case 5:return[2,t||Promise.reject()]}}))}))},t.prototype.process=function(t){if(this._isRecording&&!this.nativeEncode){for(var e=new Uint8Array(t.length/2),n=0;n<t.length;n+=2)e[n/2]=parseInt(t.substring(n,n+2),16);var i=e.buffer,o=new Int16Array(i,0,Math.floor(i.byteLength/2));this.encoder.encodeInt16(o),this.recordChannelLength+=o.length;var r=Math.round(this.recordChannelLength/44100*1e3);this.deliver(r,1)}},t.prototype.cacheMp3data=function(t){for(var e=new Uint8Array(t.length/2),n=0;n<t.length;n+=2)e[n/2]=parseInt(t.substring(n,n+2),16);var i=new Blob([e.buffer],{type:"audio/mp3"});this.mp3BlobHandler?this.mp3BlobHandler(i):this.mp3Blob=i},t.prototype.getNativeMp3Blob=function(){return S(this,void 0,void 0,(function(){var t=this;return T(this,(function(e){return[2,new Promise((function(e,n){t.mp3Blob?e(t.mp3Blob):t.mp3BlobHandler=function(t){e(t)}}))]}))}))},t.prototype.deliver=function(t,e){if(this.subject){var n=this.subject.getValue().id;this.subject.next({id:n,duration:t,volume:e})}},t.prototype.nativeToAudioError=function(t){switch(t){case 700001:return w.error(m.PermissionDenied);case 700004:return null;case 700003:case 700002:default:return w.error(m.Common)}},t.prototype.error=function(t){if(this.subject&&t){var e=this.subject.getValue().id;this.subject.next({id:e,error:t})}},t}(),I=function(){function t(){this._isRecording=!1}return Object.defineProperty(t.prototype,"isRecording",{get:function(){return this._isRecording},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"core",{get:function(){return window.wx},enumerable:!0,configurable:!0}),t.prototype.startRecord=function(){console.log("start wechat record"),this.core.checkJsApi({jsApiList:["startRecord"],success:function(t){console.log(t)},fail:function(t){console.log(t)}}),this._isRecording=!0,this.core.startRecord()},t.prototype.stopRecord=function(){console.log("stop wechat record"),this._isRecording=!1,this.core.stopRecord({success:function(t){console.log(t)}})},t}(),O=n(2),R=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function a(t){try{c(i.next(t))}catch(t){r(t)}}function s(t){try{c(i.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((i=i.apply(t,e||[])).next())}))},C=function(t,e){var n,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(t){r=[6,t],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}},D=function(){function t(){this._recorder=this.initAudioRecorder()}return Object.defineProperty(t.prototype,"recorder",{get:function(){return this._recorder},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this._state||(this._state=new b.a(this.emptyState)),this._state},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"emptyState",{get:function(){return{id:""}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isRecording",{get:function(){return this._recorder.isRecording},enumerable:!0,configurable:!0}),t.getInstance=function(){return t.instance||(t.instance=new t),t.instance},t.prototype.preInitialize=function(){this._recorder.prepare&&this._recorder.prepare()},t.prototype.initAudioRecorder=function(){return O.PlatformUtil.isWXMiniProgram(),this.initCommonAudioRecorder()},t.prototype.initCommonAudioRecorder=function(){return new L},t.prototype.initWechatMiniProgramRecorder=function(){return new I},t.prototype.initIOSAudioRecorder=function(){return new P},t.prototype.start=function(t,e,n){var i=this;this._recordingId=t,this.recorder.startRecord(t,this.state,n),this.subscription=this.state.subscribe((function(n){if(e){var r={id:t,perform:n.error?o.Stopped:o.Runing,error:n.error};n.duration&&(r.duration=n.duration),n.error&&i.clear(),"function"==typeof e?e(r):e.update&&e.update.apply(e,r)}}))},t.prototype.stop=function(){return R(this,void 0,void 0,(function(){var t;return C(this,(function(e){switch(e.label){case 0:return[4,this.recorder.stopRecord()];case 1:return t=e.sent(),this.clear(),t?this._recordingId?[2,t]:(console.warn("no recording id"),[2,Promise.reject()]):(console.warn("no blob data from recorder"),[2,Promise.reject()])}}))}))},t.prototype.clear=function(){this.subscription&&(this.subscription.unsubscribe(),this.subscription=null),this.state.next(this.emptyState)},t}(),N=n(10),j=n.n(N),M=n(325),B=n.n(M),F=n(12),A=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function a(t){try{c(i.next(t))}catch(t){r(t)}}function s(t){try{c(i.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((i=i.apply(t,e||[])).next())}))},U=function(t,e){var n,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(t){r=[6,t],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}};!function(t){t[t.Upload=247190]="Upload",t[t.Download=247191]="Download",t[t.Delete=247192]="Delete"}(k||(k={}));var H,V,K=function(){function t(){this.requests=new Map}return t.getInstance=function(){return t.instance||(t.instance=new t),t.instance},Object.defineProperty(t.prototype,"test",{get:function(){return!1},enumerable:!0,configurable:!0}),t.prototype.requestUrl=function(t){return this.test?"https://upload.docs.qq.com/upload_test?cmd="+t:"https://upload.docs.qq.com/attachment_handler?cmd="+t},Object.defineProperty(t.prototype,"uploadRequestUrl",{get:function(){return this.requestUrl(k.Upload)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"downloadRequestUrl",{get:function(){return this.requestUrl(k.Download)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"docId",{get:function(){return Object(F.c)().globalPadId||""},enumerable:!0,configurable:!0}),t.prototype.upload=function(t,e,n){return A(this,void 0,void 0,(function(){var i=this;return U(this,(function(o){return[2,new Promise((function(o,r){i.requests.has(t)?r(new Error("audio id "+t+" is uploading")):i.md5(e).then((function(a){var s="doc_file_"+t.toLowerCase()+".mp3",c=new FormData,l={file_name:s,file_size:e.size,file_md5:a,doc_id:i.docId};c.append("json",JSON.stringify(l)),c.append("data",e);var u={xhr:function(){var e=new XMLHttpRequest;return e.withCredentials=!0,e.upload.onload=function(e){console.log("audio id "+t+" upload loaded")},e.upload.onprogress=function(e){if(e.lengthComputable){var n=e.loaded/e.total*100;console.log("audio id "+t+" uploaded "+n+"%")}},e},url:i.uploadRequestUrl,data:c,processData:!1,contentType:!1,type:"POST",dataType:"json",headers:{"X-Xsrf-Protection":Object(p.getXsrf)()},success:function(e,s,c){if(void 0!==e.ret&&0===e.ret){var l={fileId:e.file_id,fileType:e.file_type,fileSize:e.file_size,md5:a,duration:n};o(l),i.requests.delete(t)}else e.rsp_header&&e.rsp_header.retmsg?console.warn("upload error: "+e.rsp_header.retmsg):console.warn("upload error: "+e+", "+e.ret),i.error(t,(function(){r(new Error(e.ret))}))},error:function(e,n,o){console.log("error:"+o),i.error(t,(function(){r(o)}))}},d=j.a.ajax(u);i.requests.set(t,{xhr:d,settings:u,retries:3,timeout:1e3}),console.log(i.requests.get(t))})).catch((function(t){console.log("cannot calc md5"),r(t)}))}))]}))}))},t.prototype.md5=function(t){return A(this,void 0,void 0,(function(){return U(this,(function(e){return[2,new Promise((function(e,n){var i=new FileReader;i.readAsBinaryString(t),i.onload=function(t){if(FileReader.DONE===i.readyState&&i.result){var n=new B.a;n.appendBinary(i.result),e(n.end())}},i.onerror=function(t){n(t)}}))]}))}))},t.prototype.cancel=function(t){if(this.requests.has(t)){var e=this.requests.get(t);e&&(e.xhr.abort(),e.timer&&clearTimeout(e.timer)),this.requests.delete(t)}else console.warn("audio id "+t+" is not uploading")},t.prototype.playUrl=function(t,e){return void 0===e&&(e=!0),A(this,void 0,void 0,(function(){var n=this;return U(this,(function(i){return[2,new Promise((function(i,o){if(e)j.a.ajax({type:"post",url:n.downloadRequestUrl,data:"doc_id="+n.docId+"&file_id="+t.fileId,contentType:"application/x-www-form-urlencode",dataType:"json",xhrFields:{withCredentials:!0},headers:{"X-Xsrf-Protection":Object(p.getXsrf)()},success:function(t,e,n){console.log(t.ret,t.msg,t.download_url),void 0!==t.ret&&0===t.ret?t.https_download_url&&t.https_download_url.length>0?i(t.https_download_url):i(t.download_url):o("upload error: "+t.error)},error:function(t,e,n){console.warn("error:"+n),o(n)}});else{var r=n.downloadRequestUrl+"&doc_id="+n.docId+"&file_id="+t.fileId;j.a.ajax({url:r,type:"get",dataType:"json",xhrFields:{withCredentials:!0},headers:{"X-Xsrf-Protection":Object(p.getXsrf)()},success:function(t,e,n){void 0!==t.ret&&0===t.ret?i(t.download_url):o("upload error: "+t.error)},error:function(t,e,n){console.warn("error:"+n),o(n)}})}}))]}))}))},t.prototype.error=function(t,e){var n=this.requests.get(t);n&&n.retries?(n.timer=setTimeout((function(){var t=j.a.ajax(n.settings);n.xhr=t}),n.timeout||0),n.retries-=1,n.timeout&&(n.timeout*=3)):(this.requests.delete(t),e())},t}(),W=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function a(t){try{c(i.next(t))}catch(t){r(t)}}function s(t){try{c(i.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((i=i.apply(t,e||[])).next())}))},G=function(t,e){var n,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(t){r=[6,t],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}},z=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},X=function(){function t(t){this.lazySeekTime=null,this.leastSeekTime=0,this.stateUpdated=null,this.playGuard=null,this.validUpdateTime=null,this._playerId=t,this.core=new Audio,this._playState=new b.a(this.initPlayState()),this.bind(),this._invoked="invoked"}return t.prototype.init=function(){this.addCoreListeners(),window.player=this},t.prototype.uninit=function(){this.removeCoreListeners()},t.prototype.bind=function(){this.loaded=this.loaded.bind(this),this.onPlay=this.onPlay.bind(this),this.onPause=this.onPause.bind(this),this.seeked=this.seeked.bind(this),this.timeUpdate=this.timeUpdate.bind(this),this.playEnd=this.playEnd.bind(this),this.onError=this.onError.bind(this)},Object.defineProperty(t.prototype,"playerId",{get:function(){return this._playerId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"playState",{get:function(){return this._playState},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paused",{get:function(){return!this.core||this.core.paused},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"coreCurrentTime",{get:function(){return this.core?1e3*this.core.currentTime:0},set:function(t){this.core.currentTime=t/1e3},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"coreDuration",{get:function(){return this.core?1e3*this.core.duration:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"invoked",{get:function(){return this._invoked},enumerable:!0,configurable:!0}),t.prototype.addCoreListeners=function(){this.core.addEventListener("canplay",this.loaded),this.core.addEventListener("play",this.onPlay),this.core.addEventListener("pause",this.onPause),this.core.addEventListener("seeked",this.seeked),this.core.addEventListener("timeupdate",this.timeUpdate),this.core.addEventListener("ended",this.playEnd),this.core.addEventListener("error",this.onError)},t.prototype.removeCoreListeners=function(){this.core.removeEventListener("canplay",this.loaded),this.core.removeEventListener("play",this.onPlay),this.core.removeEventListener("pause",this.onPause),this.core.removeEventListener("seeked",this.seeked),this.core.removeEventListener("timeupdate",this.timeUpdate),this.core.removeEventListener("ended",this.playEnd),this.core.removeEventListener("error",this.onError)},t.prototype.initPlayState=function(){return{time:0,duration:0}},t.prototype.invoke=function(){"none"===this._invoked&&(this._invoked="invoking",this.core.play().catch(),this.core.pause())},t.prototype.play=function(t){var e=this;"invoking"===this._invoked&&(this._invoked="invoked"),this.core.paused||this.core.src===t||this.core.pause(),this.core.src!==t&&(this.core.src=t,this.core.preload="auto",this.core.load());var n=this.playState.getValue(),i=n.time;i>=(isNaN(this.coreDuration)?n.duration:this.coreDuration)&&(i=0),this.leastSeekTime=0,i!==this.coreCurrentTime&&this.seek(i),this.core.play().catch((function(t){console.error(t),e.error(w.error(v.Common)),y("cple")})),y("cpl"),this.hireGuard()},t.prototype.pause=function(){return W(this,void 0,void 0,(function(){var t=this;return G(this,(function(e){return this.core.paused?(console.warn("palyer is already paused"),[2,Promise.resolve()]):(y("cpa"),this.core.pause(),this.fireGuard(),[2,new Promise((function(e,n){t.stateUpdated=function(){e(),t.stateUpdated=null}}))])}))}))},t.prototype.time=function(){return this.coreCurrentTime},t.prototype.duration=function(){return this.coreDuration},t.prototype.seek=function(t){y("s:"+Math.floor(10*t)),this.coreCurrentTime=t,this.leastSeekTime=t},t.prototype.lazySeek=function(t){this.lazySeekTime=t},t.prototype.update=function(t){var e,n,i=this._playState.getValue();try{for(var o=z(Object.keys(t)),r=o.next();!r.done;r=o.next()){var a=r.value;i[a]=t[a]}}catch(t){e={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}this._playState.next(i)},t.prototype.error=function(t){this.update({finish:!0,error:t})},t.prototype.hireGuard=function(){var t=this;this.validUpdateTime=(new Date).getTime(),this.playGuard||(this.playGuard=setInterval((function(){t.validUpdateTime&&(new Date).getTime()-t.validUpdateTime>1e3&&!1===t.core.paused&&t.core.readyState>=2&&(console.log("[!!!!!] FORCE EVOKE"),t.core.pause(),t.core.play(),t.validUpdateTime=(new Date).getTime())}),1e3))},t.prototype.fireGuard=function(){this.playGuard&&(clearInterval(this.playGuard),this.playGuard=null)},t.prototype.onError=function(){if(y("oe"),"invoked"===this._invoked){if(this.core.error){var t=void 0;switch(this.core.error.code){case MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED:t=v.SourceNotSupport;break;case MediaError.MEDIA_ERR_NETWORK:t=v.Network;break;case MediaError.MEDIA_ERR_DECODE:default:t=v.Common}y("e:"+this.core.error.code),this.error(w.error(t))}this.fireGuard(),this.stateUpdated&&this.stateUpdated()}},t.prototype.loaded=function(){y("ld"),this._invoked},t.prototype.onPlay=function(){"invoked"===this._invoked&&(console.log("onPlay",this.time()),this.update({time:this.time(),finish:!1}),y("opl"))},t.prototype.onPause=function(){"invoked"===this._invoked&&(console.log("onPause",this.time()),this.update({time:this.time(),finish:!0}),this.stateUpdated&&this.stateUpdated(),y("opa:"+Math.floor(10*this.time())))},t.prototype.seeked=function(){console.log("seeked"),this.timeUpdate()},t.prototype.timeUpdate=function(){this.core.seeking||(this.validUpdateTime=(new Date).getTime(),console.log("timeUpdate",this.coreCurrentTime),this.leastSeekTime>this.coreCurrentTime||this.update({time:this.coreCurrentTime}))},t.prototype.playEnd=function(){console.log("playEnd",this.coreCurrentTime),this.fireGuard(),this.update({time:0,finish:!0})},t}(),q=function(){function t(){this.activePlayer=null,this.cores=new Map}return t.prototype.playState=function(t){var e=t||this.activePlayer&&this.activePlayer.playerId;return e&&this.cores.has(e)?this.cores.get(e).playState:(console.warn("player id "+e+" is not a valid id"),null)},t.prototype.invoke=function(t){var e=t||this.activePlayer&&this.activePlayer.playerId;e&&this.cores.has(e)?this.cores.get(e).invoke():console.warn("player id "+e+" is not a valid id")},t.prototype.play=function(t,e){var n=e||this.activePlayer&&this.activePlayer.playerId;n&&this.cores.has(n)?(this.activePlayer||(this.activePlayer=this.cores.get(n)),this.activePlayer.playerId===n||(this.activePlayer.pause(),this.activePlayer=this.cores.get(n)),this.activePlayer.play(t)):console.warn("player id "+n+" is not a valid id")},t.prototype.pause=function(t){return W(this,void 0,void 0,(function(){var e;return G(this,(function(n){switch(n.label){case 0:return(e=t||this.activePlayer&&this.activePlayer.playerId)&&this.cores.has(e)?!this.activePlayer||this.activePlayer.playerId!==e||this.activePlayer.paused?(console.warn("no player is playing"),[2]):[4,this.activePlayer.pause()]:(console.warn("player id "+e+" is not a valid id"),[2]);case 1:return n.sent(),[2]}}))}))},t.prototype.seek=function(t,e){var n=e||this.activePlayer&&this.activePlayer.playerId;n&&this.cores.has(n)?this.activePlayer?this.activePlayer.seek(t):console.warn("no active player"):console.warn("player id "+n+" is not a valid id")},t.prototype.addCorePlayer=function(t){if(this.cores.has(t))console.warn("the audio player with id "+t+" exists");else{var e=new X(t);e.init(),this.cores.set(t,e),this.activePlayer||(this.activePlayer=this.cores.get(t))}},t.prototype.removeCorePlayer=function(t){if(this.cores.has(t)){var e=this.cores.get(t);e&&e.uninit(),this.cores.delete(t),this.activePlayer&&this.activePlayer.playerId===t&&(this.activePlayer=null)}else console.warn("the audio player with id "+t+" doesn't exists")},t}(),Y=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function a(t){try{c(i.next(t))}catch(t){r(t)}}function s(t){try{c(i.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((i=i.apply(t,e||[])).next())}))},$=function(t,e){var n,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(t){r=[6,t],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}},J=function(){function t(){this.subscription=null,this.fixedPlayerId="AudioPlayer",this._player=new q,this._player.addCorePlayer(this.fixedPlayerId)}return t.getInstance=function(){return t.instance||(t.instance=new t),t.instance},Object.defineProperty(t.prototype,"state",{get:function(){return this._player.playState()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"player",{get:function(){return this._player},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"emptyState",{get:function(){return{time:0,duration:0}},enumerable:!0,configurable:!0}),t.prototype.invoke=function(){this.player.invoke()},t.prototype.play=function(t,e,n,i){var r=this;this.state&&(this.unsubscribePlayState(),i&&this.state.next(i),this.subscription=this.state.subscribe((function(e){if(n){var i={id:t,playedTime:e.time,error:e.error};void 0!==e.loading&&e.loading&&(i.perform=o.Pending),void 0!==e.finish&&(i.perform=e.finish?o.Stopped:o.Runing),e.error&&r.clear(),"function"==typeof n?n(i):n.update&&n.update.apply(n,i)}}))),this.player.play(e)},t.prototype.pause=function(){return Y(this,void 0,void 0,(function(){return $(this,(function(t){switch(t.label){case 0:return[4,this.player.pause()];case 1:return t.sent(),this.unsubscribePlayState(),[2]}}))}))},t.prototype.seek=function(t){this.player.seek(t)},t.prototype.unsubscribePlayState=function(){this.subscription&&(this.subscription.unsubscribe(),this.subscription=null)},t.prototype.clear=function(){this.unsubscribePlayState(),this.state&&this.state.next(this.emptyState)},t}(),Q=n(472),Z=n(142),tt=n(51),et=n(30),nt=n.n(et),it=n(5),ot=function(t,e,n,i){var o,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(r<3?o(a):r>3?o(e,n,a):o(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},rt=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},at=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function a(t){try{c(i.next(t))}catch(t){r(t)}}function s(t){try{c(i.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((i=i.apply(t,e||[])).next())}))},st=function(t,e){var n,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(t){r=[6,t],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}},ct=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},lt=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,o,r=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(t){o={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a},ut=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(lt(arguments[e]));return t},pt=function(){function t(){var t=this;this.floatBarRegisterKey="AudioFloatBarRegisterKey",this.onlineCallback=function(){t.retry()},this.beforeunload=function(e){if(t.recording)return e.returnValue="正在录音中，确定离开?",t.recording&&t.stopRecord(),"正在录音中，确定离开？"},this.unload=function(){t.recording&&t.stopRecord()},this._store=new Map,this._activeId="",this.subscribeVoiceInput(),this.online(),this.ondead()}return t.getInstance=function(){return t.instance||(t.instance=new t),t.instance},t.destroy=function(){t.instance&&(window.removeEventListener("online",t.instance.onlineHandler),window.removeEventListener("beforeunload",t.instance.beforeunloadHandler),window.removeEventListener("unload",t.instance.unloadHandler),t.instance=null)},Object.defineProperty(t.prototype,"recordLimitMilliDuration",{get:function(){return 6e5},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activeState",{get:function(){return this.state(this._activeId)||this.emptyState()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"floatBar",{get:function(){return this.store.has(this.floatBarRegisterKey)||this.store.register(this.floatBarRegisterKey,!1),this.store.get(this.floatBarRegisterKey)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"volume",{get:function(){return D.getInstance().state.asObservable().pipe(Object(Q.a)((function(t){return void 0!==t.volume})),Object(Z.a)((function(t){return t.volume})))},enumerable:!0,configurable:!0}),t.prototype.emptyState=function(t){return{id:t||"",type:i.None,perform:o.None,upload:r.None}},t.prototype.has=function(t){return this._store.has(t)},t.prototype.register=function(t,e){var n=e;n||(n=this.emptyState(t)),this._store.has(t)||this._store.set(t,new b.a(n))},t.prototype.unregister=function(t){this._store.has(t)&&(this.abort(t),this._store.delete(t))},t.prototype.state=function(t){return this._store.has(t)?this._store.get(t).getValue():this.emptyState(t)},t.prototype.observable=function(t){return this.subject(t).asObservable()},t.prototype.set=function(t){this.active(t.id),this.next(t)},t.prototype.active=function(t){this._activeId=t},t.prototype.update=function(t){var e,n,i=t.id||this.activeState.id,o=this.state(i),r=!1;try{for(var a=ct(Object.keys(t)),s=a.next();!s.done;s=a.next()){var c=s.value;o[c]!==t[c]&&(o[c]=t[c],r=!0)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}r&&this.next(o)},t.prototype.silentSubject=function(){return new b.a(this.emptyState())},t.prototype.subject=function(t){return this._store.has(t)||console.warn("the audio id "+t+" has not registered"),this._store.get(t)||this.silentSubject()},t.prototype.next=function(t){this._store.has(t.id)?(this._store.get(t.id).next(t),t.error&&this.error(t)):console.warn("the state for audio id "+t.id+" is not registered yet")},t.prototype.error=function(t){t.error?(console.warn("error for audio id "+t.id+": "+t.error.literal),t.error.show&&(this.toast(t.error.message,!0),t.error.show=!1)):console.warn("the state for audio id "+t.id+" has no error")},t.prototype.preInitialize=function(){D.getInstance().preInitialize()},Object.defineProperty(t.prototype,"recording",{get:function(){return this.activeState&&this.activeState.type===i.Record&&(this.activeState.perform===o.Runing||this.activeState.perform===o.Pending)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"playing",{get:function(){return this.activeState&&this.activeState.type===i.Play&&(this.activeState.perform===o.Runing||this.activeState.perform===o.Pending)},enumerable:!0,configurable:!0}),t.prototype.subscribeVoiceInput=function(){var t=this;this.store.has("globalVoiceInputingKey")&&this.store.get("globalVoiceInputingKey").subscribe((function(e){e&&t.playing&&t.pause()}))},Object.defineProperty(t.prototype,"audioInputtingOccupied",{get:function(){return this.store.getValue("globalVoiceInputingKey")||!1},enumerable:!0,configurable:!0}),t.prototype.startRecord=function(t){var e=this;if(this.recording)return console.warn("audio manager is recording"),void this.toast("正在录音中");this.playing&&(this.toast("暂停当前播放"),this.pause());var n=t||this.activeState.id;n!==this.activeState.id||this.activeState.type===i.None?(this.set({id:n,type:i.Record,perform:o.Pending,upload:r.None}),D.getInstance().start(n,(function(t){e.update(t),void 0!==t.duration&&t.duration>e.recordLimitMilliDuration&&e.stopRecord(t.id)}),(function(){e.stopRecord(n)}))):console.warn("audio id "+n+" is already recording or finish record")},t.prototype.stopRecord=function(t){return at(this,void 0,void 0,(function(){var e,n,i,r=this;return st(this,(function(a){switch(a.label){case 0:return(e=t||this.activeState.id)!==this.activeState.id?(console.warn("the audio id wanna stop"+t+" is not recording"),[2]):this.recording?(this.update({id:e,perform:o.Stopping}),[4,D.getInstance().stop()]):(console.warn("audio manager is not recording"),[2]);case 1:return n=a.sent(),i=URL.createObjectURL(n),this.update({id:e,perform:o.Stopped,localSource:i,localBlob:n}),console.log(n,i),n&&this.duration(i).then((function(t){r.update({duration:t})})).catch((function(t){console.warn("fatch duration failed")})).finally((function(){r.upload(e)})),[2]}}))}))},t.prototype.upload=function(t,e){var n=this;void 0===e&&(e=!0);var i=t||this.activeState.id,o=this.state(i);o.upload===r.None||o.upload===r.Abort?o.localBlob?(console.log("start upload"),K.getInstance().upload(i,o.localBlob,o.duration||0).then((function(t){console.log("audio id "+i+" file upload success, fileid: "+t.fileId+"!"),n.update({source:o.localSource,file:t,upload:r.Finish})})).catch((function(t){n.update({upload:r.Abort,error:w.error(m.Upload)}),e&&n.toast("录音上传失败，稍后自动重试")})),this.update({id:i,upload:r.Uploading})):console.warn("cannot find local blob for audio id "+i):console.warn("the audio id "+i+" is already uploading or uploaded")},t.prototype.cancelUpload=function(t){var e=t||this.activeState.id;this.state(e).upload===r.Uploading?(K.getInstance().cancel(e),this.update({id:e,upload:r.None})):console.warn("the audio id "+e+" is not uploading or has alreay uploaded")},t.prototype.online=function(){var t=this;setInterval((function(){t.retry()}),3e5),this.onlineHandler=this.onlineCallback.bind(this),window.addEventListener("online",this.onlineHandler)},t.prototype.ondead=function(){this.beforeunloadHandler=this.beforeunload.bind(this),this.unloadHandler=this.unload.bind(this),window.addEventListener("beforeunload",this.beforeunloadHandler),window.addEventListener("unload",this.unloadHandler)},t.prototype.retry=function(){var t=this;ut(this._store.values()).filter((function(t){return t.getValue().upload===r.Abort})).map((function(e){t.upload(e.getValue().id,!1)}))},t.prototype.play=function(t){return at(this,void 0,void 0,(function(){var e,n=this;return st(this,(function(r){switch(r.label){case 0:return e=t||this.activeState.id,this.recording?(console.warn("the audio system is occupied by recorder"),this.toast("正在录音，暂时无法播放"),[2]):this.audioInputtingOccupied?(console.warn("the audio system is occupied by voiceinputting"),this.toast("正在语音输入，暂时无法播放"),[2]):this.playing?e===this.activeState.id?[3,2]:[4,this.pause()]:[3,3];case 1:return r.sent(),[3,3];case 2:return console.warn("the audio id "+e+" is playing"),[2];case 3:return this.update({id:e,type:i.Play,perform:o.Pending,error:null}),this.active(e),J.getInstance().invoke(),this.source(e).then((function(t){var i=n.state(e);J.getInstance().play(e,t,n.update.bind(n),{time:i.playedTime||0,duration:i.duration||0})})).catch((function(t){console.warn("the audio to play has no source "+t),n.update({id:e,perform:o.Stopped,error:w.error(v.SourceUrl)})})),[2]}}))}))},t.prototype.pause=function(t){return at(this,void 0,void 0,(function(){var e;return st(this,(function(n){switch(n.label){case 0:return e=t||this.activeState.id,this.state(e).type!==i.Play?(console.warn("the audio is not prepare for pause (not in play type)"),[2]):this.state(e).perform===o.Stopped?(console.warn("the audio system is not playing"),[2]):[4,J.getInstance().pause()];case 1:return n.sent(),this.update({id:e,perform:o.Stopped}),[2]}}))}))},t.prototype.abort=function(t){var e=t||this.activeState.id;e===this.activeState.id&&(this.playing&&J.getInstance().pause(),this.recording&&D.getInstance().stop()),this.state(e).upload===r.Uploading&&K.getInstance().cancel(e)},t.prototype.source=function(t){return at(this,void 0,void 0,(function(){var e=this;return st(this,(function(n){return[2,new Promise((function(n,i){var o=e.state(t),r=o.localSource||o.source;r?n(r):o.file?K.getInstance().playUrl(o.file).then((function(i){e.update({id:t,source:i}),n(i)})).catch((function(t){i(t)})):i(new Error("no file info for audio id "+t))}))]}))}))},t.prototype.seek=function(t,e){var n=e||this.activeState.id;this.state(n).type===i.Play?(this.update({id:n,playedTime:t}),n===this.activeState.id&&J.getInstance().seek(t)):console.warn("the audio is not prepare for seek (not in play type)")},t.prototype.duration=function(t){return at(this,void 0,void 0,(function(){return st(this,(function(e){return[2,new Promise((function(e,n){var i=new Audio(t);i.addEventListener("loadedmetadata",(function(t){e(1e3*i.duration)})),i.addEventListener("error",(function(t){n(t.error)})),setTimeout((function(){n(new Error("audio for check duration no response"))}),1e3)}))]}))}))},t.prototype.toast=function(t,e){void 0===e&&(e=!1),nt.a.show({message:t,duration:2e3,autoClose:!0})},ot([Object(it.l)(),rt("design:type",it.x)],t.prototype,"store",void 0),t}(),dt=n(289),ht=n.n(dt),ft=n(328),gt=(H=function(t,e){return(H=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}H(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),yt=function(t){function e(e){var n=t.call(this,e)||this;return n.subscriptions=[],n.outer=null,n.inner=null,n.ref=null,n.touchStartClients=null,n.shouldStop=!1,n.showAnim=!0,n.animationOpts=null,n.state={duration:0,encoding:!1},n.editorScroll=n.editorScroll.bind(n),n.onTouchStart=n.onTouchStart.bind(n),n.onTouchEnd=n.onTouchEnd.bind(n),n.onTouchMove=n.onTouchMove.bind(n),n.animationOpts={loop:!0,autoplay:!0,prerender:!0,animationData:ft},n}return gt(e,t),Object.defineProperty(e.prototype,"boxWidth",{get:function(){return Object(O.twipsToPx)(this.props.container.rect.width)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"simplifiedLevel",{get:function(){return this.boxWidth>180?a.Complete:this.boxWidth>117?a.Simple:this.boxWidth>48?a.MoreSimple:a.ExtremeSimple},enumerable:!0,configurable:!0}),e.prototype.componentDidMount=function(){var t=this;this.subscribeRecordState(),this.props.context instanceof p.MeloEditor&&(this.props.context.on(p.ToolbarNotificationType.MOBILE_TOOLBAR_HIDE,(function(){t.stopRecord()}),this),this.props.context.on(p.KeyboardNotificationType.MOBILE_KEYBOARD_REFRESH_POSITION,(function(){t.editorScroll()}),this),this.props.context.scrollHandler.addScrollListener(this.editorScroll)),this.ref&&(this.ref.addEventListener("touchstart",this.onTouchStart),this.ref.addEventListener("touchmove",this.onTouchMove),this.ref.addEventListener("touchend",this.onTouchEnd))},e.prototype.componentDidUpdate=function(){var t=this;this.showAnim&&(this.showAnim=!1,this.outer&&(this.outer.classList.add("audio-record-status-icon-outer-show"),setTimeout((function(){t.outer&&t.outer.classList.remove("audio-record-status-icon-outer-show")}),500)))},e.prototype.componentWillUnmount=function(){this.unsubscribeRecordState(),this.props.context instanceof p.MeloEditor&&(this.props.context.removeListener(p.ToolbarNotificationType.MOBILE_TOOLBAR_HIDE,this),this.props.context.removeListener(p.KeyboardNotificationType.MOBILE_KEYBOARD_REFRESH_POSITION,this),this.props.context.scrollHandler.removeScrollListener(this.editorScroll)),this.ref&&(this.ref.removeEventListener("touchstart",this.onTouchStart),this.ref.removeEventListener("touchmove",this.onTouchMove),this.ref.removeEventListener("touchend",this.onTouchEnd)),pt.getInstance().floatBar.getValue()&&pt.getInstance().floatBar.next(!1)},e.prototype.onTouchStart=function(t){t.targetTouches.length>0&&(this.touchStartClients={x:t.targetTouches[0].clientX,y:t.targetTouches[0].clientY}),this.shouldStop=!0},e.prototype.onTouchMove=function(t){if(this.touchStartClients){var e=t.targetTouches[0],n=e.clientX-this.touchStartClients.x,i=e.clientY-this.touchStartClients.y;n*n+i*i>20&&(this.shouldStop=!1)}},e.prototype.onTouchEnd=function(t){this.state.encoding||(this.shouldStop&&this.stopRecord(),this.shouldStop=!1,this.touchStartClients=null)},e.prototype.subscribeRecordState=function(){var t=this;this.subscriptions.push(pt.getInstance().observable(this.props.id).pipe(Object(h.a)(50)).subscribe((function(e){t.setRecordState(e)})),pt.getInstance().volume.pipe(Object(h.a)(20)).subscribe((function(e){t.updateRecordVolume(e)})))},e.prototype.unsubscribeRecordState=function(){this.subscriptions.forEach((function(t){t.unsubscribe()})),this.subscriptions.length=0},e.prototype.stopRecord=function(){pt.getInstance().stopRecord(),this.setState({encoding:!0})},e.prototype.editorScroll=function(){if(this.props.context instanceof p.MeloEditor){var t=this.props.context.getRoot(),e=document.getElementById("padbody"),n=t.scrollTop+e.scrollTop,i=Object(O.twipsToPx)(p.LayoutUtil.getOffsetPoint(this.props.container,p.BoxKind.Document).y),o=i+Object(O.twipsToPx)(this.props.container.rect.height),r=this.context.store.getValue(it.d.MobileToolbarPosition),a=0,s=0;if(this.props.context instanceof p.MeloEditor)a=this.props.context.scrollHandler.getMobileTopMargin(),(this.context.store.getValue("showMobileToolbar")||this.context.store.getValue("showVoiceInputPanel"))&&(s=this.props.context.scrollHandler.getMobileBottomMargin());else if(r.top&&r.bottom){var c=document.getElementById("MobileToolbarWrapper");"auto"===r.bottom?a=Math.max(c?c.clientHeight+c.offsetTop:0,0):"auto"===r.top&&(s=Math.max(c?window.innerHeight-c.offsetTop:0,0))}var l=!1;(n+a>o||i-n>window.innerHeight-s)&&(l=!0),pt.getInstance().floatBar.getValue()!==l&&pt.getInstance().floatBar.next(l)}},e.prototype.setRecordState=function(t){t.type!==i.Record&&console.warn("audio id "+t.id+" is not in recording state"),t.perform===o.Stopped?this.outer&&this.outer.classList.add("audio-record-status-icon-outer-hide"):t.perform===o.Stopping&&this.setState({encoding:!0}),console.log("last duration: "+this.state.duration+", current duration: "+t.duration),t.duration!==this.state.duration&&this.setState({duration:t.duration||0})},e.prototype.updateRecordVolume=function(t){if(console.log("update volume: "+t),this.outer){var e=this.outer.offsetWidth,n=this.inner?this.inner.offsetWidth:0,i=n/e+(e-n)/e*t;this.outer.style.transform="scale("+i+")",this.outer.style.opacity=""+(1-.8*t)}},e.prototype.recordBtnStyle=function(){return this.simplifiedLevel<a.ExtremeSimple?this.simplifiedLevel<a.MoreSimple?{}:{left:.5*this.boxWidth-25}:{display:"none"}},e.prototype.recordHint=function(){return this.state.encoding?"编码中...":this.simplifiedLevel>=a.Simple?"正在录音":"正在录音，点击停止。"},e.prototype.render=function(){var t=this;return console.log("record panel id "+this.props.id),c.a.createElement("div",{ref:function(e){t.ref=e},className:"audio-record-panel-wrapper"},c.a.createElement("div",{className:"audio-record-status-icon",style:this.recordBtnStyle()},c.a.createElement("div",{className:"audio-record-status-icon-outer"},this.state.encoding?c.a.createElement("div",{className:"audio-record-status-icon-inner"}):c.a.createElement(ht.a,{options:this.animationOpts,key:this.props.id}))),this.simplifiedLevel<a.MoreSimple&&c.a.createElement("ul",{className:"audio-record-duration-mono-label"},f.formatTimeByMillisecond(this.state.duration).split("").map((function(t,e){return c.a.createElement("div",{key:e,className:"audio-record-duration-mono-label-unit",style:{width:":"===t?"3.75px":"7.5px"}},t)}))),this.simplifiedLevel<a.MoreSimple&&c.a.createElement("div",{className:"audio-record-hint"},this.recordHint()))},e.contextType=it.h,e}(c.a.Component),mt=n(460),vt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),bt=function(t){function e(e){var n=t.call(this,e)||this;return n._knobTouchClientX=-1,n._progressBar=null,n._knob=null,n._inKnobSliding=!1,n._touchStartTimestamp=null,n._touchendExcuter=null,n.state={progress:e.progress,total:e.total},n._progressSubject=new mt.a,n.onPlayKnobMouseMove=n.onPlayKnobMouseMove.bind(n),n.onPlayKnobMouseUp=n.onPlayKnobMouseUp.bind(n),n.onProgressBarTouchStart=n.onProgressBarTouchStart.bind(n),n.onProgressBarTouchMove=n.onProgressBarTouchMove.bind(n),n.onProgressBarTouchEnd=n.onProgressBarTouchEnd.bind(n),n.onPlayKnobTouchMove=n.onPlayKnobTouchMove.bind(n),n.onPlayKnobTouchStart=n.onPlayKnobTouchStart.bind(n),n.onPlayKnobTouchEnd=n.onPlayKnobTouchEnd.bind(n),n}return vt(e,t),Object.defineProperty(e.prototype,"barWidth",{get:function(){return this.props.width-86},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"progress",{get:function(){return this._progressSubject},enumerable:!0,configurable:!0}),e.prototype.componentDidMount=function(){this._progressBar&&(this._progressBar.addEventListener("touchstart",this.onProgressBarTouchStart),this._progressBar.addEventListener("touchmove",this.onProgressBarTouchMove),this._progressBar.addEventListener("touchend",this.onProgressBarTouchEnd)),this._knob&&(this._knob.addEventListener("touchstart",this.onPlayKnobTouchStart),this._knob.addEventListener("touchmove",this.onPlayKnobTouchMove),this._knob.addEventListener("touchend",this.onPlayKnobTouchEnd))},e.prototype.componentWillUnmount=function(){this._progressBar&&(this._progressBar.removeEventListener("touchstart",this.onProgressBarTouchStart),this._progressBar.removeEventListener("touchmove",this.onProgressBarTouchMove),this._progressBar.removeEventListener("touchend",this.onProgressBarTouchEnd)),this._knob&&(this._knob.removeEventListener("touchstart",this.onPlayKnobTouchStart),this._knob.removeEventListener("touchmove",this.onPlayKnobTouchMove),this._knob.removeEventListener("touchend",this.onPlayKnobTouchEnd))},e.prototype.componentWillReceiveProps=function(t){this.propsIdentity(this.props,t)||this._inKnobSliding||this.setState({progress:t.progress,total:t.total})},e.prototype.propsIdentity=function(t,e){return t.progress===e.progress&&t.total===e.total},e.prototype.onProgressBarTouchStart=function(t){var e=this;this._touchendExcuter=function(){for(var n=t.targetTouches[0].clientX,i=0,o=e._progressBar;o;)i+=o.offsetLeft+o.clientLeft-o.scrollLeft,o=o.offsetParent;e.progressTo(e.progressFromOffset(n-i))},this._touchStartTimestamp=(new Date).getTime()},e.prototype.onProgressBarTouchMove=function(t){this._touchendExcuter&&(this._touchendExcuter=null)},e.prototype.onProgressBarTouchEnd=function(t){(!this._touchStartTimestamp||(new Date).getTime()-this._touchStartTimestamp<500)&&this._touchendExcuter&&this._touchendExcuter(),this._touchStartTimestamp=null,this._touchendExcuter=null},e.prototype.onProgressBarMouseDown=function(t){0===t.button&&(t.stopPropagation(),t.preventDefault(),this.progressTo(this.progressFromOffset(t.nativeEvent.offsetX)))},e.prototype.onPlayKnobTouchStart=function(t){t.stopPropagation(),t.preventDefault(),this._knobTouchClientX=t.targetTouches[0].clientX,this._inKnobSliding=!0},e.prototype.onPlayKnobTouchEnd=function(t){t.stopPropagation(),this._knobTouchClientX=-1,this._inKnobSliding=!1},e.prototype.onPlayKnobTouchMove=function(t){if(t.preventDefault(),t.stopPropagation(),-1!==this._knobTouchClientX){var e=t.targetTouches[0].clientX-this._knobTouchClientX;this._knobTouchClientX=t.targetTouches[0].clientX;var n=this.context.store.getValue("zoomLevel");null!==n&&0!==n||(n=1);var i=this.offsetFromProgress(this.state.progress)+e/n;this.progressTo(this.progressFromOffset(i))}},e.prototype.onPlayKnobMouseDown=function(t){0===t.button&&(t.stopPropagation(),this._knobTouchClientX=t.screenX,this._inKnobSliding=!0,document.addEventListener("mousemove",this.onPlayKnobMouseMove),document.addEventListener("mouseup",this.onPlayKnobMouseUp))},e.prototype.onPlayKnobMouseUp=function(t){0===t.button&&(t.stopPropagation(),this._knobTouchClientX=-1,this._inKnobSliding=!1,document.removeEventListener("mousemove",this.onPlayKnobMouseMove),document.removeEventListener("mouseup",this.onPlayKnobMouseUp))},e.prototype.onPlayKnobMouseMove=function(t){if(0===t.button&&(t.stopPropagation(),-1!==this._knobTouchClientX&&this._inKnobSliding)){var e=t.screenX-this._knobTouchClientX;this._knobTouchClientX=t.screenX;var n=this.offsetFromProgress(this.state.progress)+e;this.progressTo(this.progressFromOffset(n))}},e.prototype.progressFromOffset=function(t){var e=t/this.barWidth*this.state.total;return e=Math.max(e,0),e=Math.min(e,this.state.total)},e.prototype.offsetFromProgress=function(t){return 0===this.state.total?0:Math.min(t,this.state.total)/this.state.total*this.barWidth},e.prototype.progressTo=function(t){this.setState({progress:t}),this._progressSubject.next(t)},e.prototype.fixKnobOffset=function(t){var e=t-15;return Math.max(-8,Math.min(this.barWidth-15-7,e))},e.prototype.render=function(){var t=this,e=this.offsetFromProgress(this.state.progress);return c.a.createElement("div",{ref:function(e){t._progressBar=e},className:"audio-play-progress-bar",onMouseDown:this.onProgressBarMouseDown.bind(this),style:{width:this.barWidth}},c.a.createElement("div",{ref:function(e){t._knob=e},className:"audio-play-progress-knob-box",onMouseDown:this.onPlayKnobMouseDown.bind(this),style:{left:this.fixKnobOffset(e)+"px"}},c.a.createElement("div",{className:"audio-play-progress-knob-icon"})),c.a.createElement("div",{className:"audio-play-progress-track audio-play-progress-track-fill",style:{width:e+"px"}}),c.a.createElement("div",{className:"audio-play-progress-track audio-play-progress-track-empty"}))},e.contextType=it.h,e}(c.a.Component),kt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),wt=function(t){function e(e){var n=t.call(this,e)||this;return n._playBtn=null,n._progressBar=null,n._subscriptions=[],n._touchStartTimestamp=null,n._touchStartClients=null,n.state={playing:!1,playedTime:n.props.playedTime,duration:n.props.duration},n.onPlayButtonTouchEnd=n.onPlayButtonTouchEnd.bind(n),n.onPlayButtonTouchMove=n.onPlayButtonTouchMove.bind(n),n.onPlayButtonTouchStart=n.onPlayButtonTouchStart.bind(n),n.onPlayButtonMouseUp=n.onPlayButtonMouseUp.bind(n),n.onPlayButtonMouseDown=n.onPlayButtonMouseDown.bind(n),n}return kt(e,t),Object.defineProperty(e.prototype,"simplifiedLevel",{get:function(){return this.props.width>147?a.Complete:this.props.width>115?a.Simple:this.props.width>48?a.MoreSimple:a.ExtremeSimple},enumerable:!0,configurable:!0}),e.prototype.componentDidMount=function(){pt.getInstance().update({id:this.props.id,type:i.Play}),this.subscribePlayState(),this._playBtn&&(this._playBtn.addEventListener("touchstart",this.onPlayButtonTouchStart),this._playBtn.addEventListener("touchmove",this.onPlayButtonTouchMove),this._playBtn.addEventListener("touchend",this.onPlayButtonTouchEnd),this._playBtn.addEventListener("mousedown",this.onPlayButtonMouseDown),this._playBtn.addEventListener("mouseup",this.onPlayButtonMouseUp))},e.prototype.componentWillUnmount=function(){this.unsubscribePlayState(),this._playBtn&&(this._playBtn.removeEventListener("touchstart",this.onPlayButtonTouchStart),this._playBtn.removeEventListener("touchmove",this.onPlayButtonTouchMove),this._playBtn.removeEventListener("touchend",this.onPlayButtonTouchEnd),this._playBtn.removeEventListener("mousedown",this.onPlayButtonMouseDown),this._playBtn.removeEventListener("mouseup",this.onPlayButtonMouseUp))},e.prototype.subscribePlayState=function(){var t=this;this._subscriptions.push(pt.getInstance().observable(this.props.id).subscribe((function(e){t.setPlayState(e)})),this._progressBar.progress.asObservable().pipe(Object(h.a)(50)).subscribe((function(e){pt.getInstance().seek(e,t.props.id)})))},e.prototype.unsubscribePlayState=function(){this._subscriptions.forEach((function(t){t.unsubscribe()})),this._subscriptions.length=0},e.prototype.onPlayButtonTouchStart=function(t){this._touchStartTimestamp=(new Date).getTime(),t.targetTouches.length>0&&(this._touchStartClients={x:t.targetTouches[0].clientX,y:t.targetTouches[0].clientY})},e.prototype.onPlayButtonTouchMove=function(t){if(this._touchStartClients){var e=t.targetTouches[0],n=e.clientX-this._touchStartClients.x,i=e.clientY-this._touchStartClients.y;n*n+i*i>20&&(this._touchStartTimestamp=0)}},e.prototype.onPlayButtonTouchEnd=function(t){if(null===this._touchStartTimestamp||(new Date).getTime()-this._touchStartTimestamp<500){var e=pt.getInstance().state(this.props.id);e.perform===o.Runing||e.perform===o.Pending?pt.getInstance().pause(this.props.id):pt.getInstance().play(this.props.id)}console.log("play button touch end"),this._touchStartClients=null,this._touchStartTimestamp=null},e.prototype.onPlayButtonMouseDown=function(t){0===t.button&&t.stopPropagation()},e.prototype.onPlayButtonMouseUp=function(t){if(0===t.button){t.stopPropagation();var e=pt.getInstance().state(this.props.id);e.perform===o.Runing||e.perform===o.Pending?pt.getInstance().pause(this.props.id):pt.getInstance().play(this.props.id)}},e.prototype.setPlayState=function(t){t.type===i.Play?this.setState({playing:t.perform===o.Pending||t.perform===o.Runing,playedTime:t.playedTime||0,duration:t.duration||0}):console.warn("audio id "+t.id+" is not in playing state")},e.prototype.playBtnClasses=function(){return{common:"audio-play-pcbtn",playing:"audio-play-pcbtn-playing",pausing:"audio-play-pcbtn-pausing"}},e.prototype.playBtnStyle=function(){return this.simplifiedLevel<a.ExtremeSimple?this.simplifiedLevel<a.MoreSimple?{}:{left:.5*this.props.width-25}:{display:"none"}},e.prototype.render=function(){var t=this;console.log("play panel id "+this.props.id+", playing: "+this.state.playing+", time: "+this.state.playedTime+", duration: "+this.state.duration);var e=this.playBtnClasses();return c.a.createElement("div",{className:"audio-play-panel-wrapper"},c.a.createElement("div",{ref:function(e){t._playBtn=e},className:[e.common,this.state.playing?e.playing:e.pausing].join(" "),style:this.playBtnStyle()}),c.a.createElement("div",{style:this.simplifiedLevel<a.MoreSimple?{}:{display:"none"}},c.a.createElement(bt,{ref:function(e){t._progressBar=e},progress:this.state.playedTime,total:this.state.duration,width:this.props.width})),this.simplifiedLevel<a.MoreSimple&&c.a.createElement("ul",{className:"audio-play-mono-label audio-play-mono-label-time"},f.formatTimeByMillisecond(this.state.playedTime).split("").map((function(t,e){return c.a.createElement("div",{key:e,className:"audio-play-mono-label-unit",style:{width:":"===t?"3.5px":"7px"}},t)}))),this.simplifiedLevel<a.Simple&&c.a.createElement("ul",{className:"audio-play-mono-label audio-play-mono-label-duration"},f.formatTimeByMillisecond(this.state.duration).split("").map((function(t,e){return c.a.createElement("div",{key:e,className:"audio-play-mono-label-unit",style:{width:":"===t?"3.5px":"7px"}},t)}))))},e}(c.a.Component),St=n(230),Tt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();!function(t){t[t.Record=0]="Record",t[t.Play=1]="Play"}(V||(V={}));var _t=function(t){function e(e){var n=t.call(this,e)||this;n.subscriptions=[],n.touchStartClients=null,n.touchFocusTimer=null,n.touchIntent=null,n.registerBoxAudioStateIfNotExists();var i=n.isRecording()?V.Record:V.Play;return n.state={type:i,focus:!1},n.onTouchStart=n.onTouchStart.bind(n),n.onTouchMove=n.onTouchMove.bind(n),n.onTouchEnd=n.onTouchEnd.bind(n),n}return Tt(e,t),Object.defineProperty(e,"boxWidth",{get:function(){return window.innerWidth-40},enumerable:!0,configurable:!0}),e.prototype.componentDidMount=function(){t.prototype.componentDidMount.call(this),this.subscribeAudioVariety(),this.root&&(this.root.addEventListener("touchstart",this.onTouchStart,{passive:!1}),this.root.addEventListener("touchend",this.onTouchEnd,{passive:!1}),this.root.addEventListener("touchmove",this.onTouchMove,{passive:!1}))},e.prototype.componentDidUpdate=function(){t.prototype.componentDidUpdate.call(this)},e.prototype.componentWillUnmount=function(){this.unsubscribeAudioVariety(),this.root&&(this.root.removeEventListener("touchstart",this.onTouchStart),this.root.removeEventListener("touchend",this.onTouchEnd),this.root.removeEventListener("touchmove",this.onTouchMove))},Object.defineProperty(e.prototype,"boxWidth",{get:function(){return Object(O.twipsToPx)(this.props.layoutBox.rect.width)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boxHeight",{get:function(){return e.boxHeight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boxProps",{get:function(){return this.props.layoutBox.property},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"anchorId",{get:function(){return this.boxProps.anchorId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"source",{get:function(){if(this.boxProps.pluginSrc.length>0)return this.boxProps.pluginSrc;var t=pt.getInstance().state(this.boxProps.anchorId);return t.localSource||t.source||""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"file",{get:function(){return this.boxProps.extraData?f.deserializeAudioData(this.boxProps.extraData):null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"audioState",{get:function(){return pt.getInstance().state(this.anchorId)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){return this.file?this.file.duration:this.audioState.duration||0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"playedTime",{get:function(){return this.audioState.playedTime||0},enumerable:!0,configurable:!0}),e.prototype.registerBoxAudioStateIfNotExists=function(){!pt.getInstance().has(this.anchorId)&&this.file&&pt.getInstance().register(this.anchorId,{id:this.anchorId,type:i.Play,upload:r.Finish,perform:o.None,duration:this.file.duration,file:this.file})},e.prototype.subscribeAudioVariety=function(){var t=this;this.subscriptions.push(pt.getInstance().observable(this.boxProps.anchorId).pipe(Object(d.a)(10)).subscribe((function(e){t.setAudioState(e)})))},e.prototype.unsubscribeAudioVariety=function(){this.subscriptions.forEach((function(t){t.unsubscribe()})),this.subscriptions.length=0},e.prototype.onMouseDown=function(t){this.setState({focus:!0})},e.prototype.onMouseUp=function(t){this.setState({focus:!1}),this.state.type===V.Play&&(this.props.context.fire(new p.PluginContainerFocusNotification),this.props.containerFocus.onFocus(this.props.layoutBox,!1))},e.prototype.onMouseClick=function(t){},e.prototype.onTouchStart=function(t){t.targetTouches.length>0&&(this.touchStartClients={x:t.targetTouches[0].clientX,y:t.targetTouches[0].clientY}),this.state.type===V.Play?this.createTouchFocusTimer(t):this.setState({focus:!0})},e.prototype.onTouchMove=function(t){if(this.touchStartClients){var e=t.targetTouches[0],n=e.clientX-this.touchStartClients.x,i=e.clientY-this.touchStartClients.y;n*n+i*i>20&&(this.state.type===V.Play?this.clearTouchFocusTimerAndStatus():this.setState({focus:!1}),this.touchIntent="scroll")}},e.prototype.onTouchEnd=function(t){t.cancelable&&t.preventDefault(),t.stopPropagation(),"longpress"===this.touchIntent&&(this.props.context.fire(new p.PluginContainerFocusNotification),this.props.containerFocus.onFocus(this.props.layoutBox,!1)),this.state.type===V.Play?this.clearTouchFocusTimerAndStatus():this.setState({focus:!1}),this.touchIntent=null,this.touchStartClients=null},e.prototype.createTouchFocusTimer=function(t){var e=this;this.touchIntent=null,this.touchFocusTimer=setTimeout((function(){e.setState({focus:!0}),e.state.type===V.Play&&(e.touchIntent="longpress")}),500)},e.prototype.clearTouchFocusTimerAndStatus=function(){this.touchFocusTimer&&(clearTimeout(this.touchFocusTimer),this.state.focus&&this.setState({focus:!1}),this.touchFocusTimer=null)},e.prototype.isRecording=function(t){var e=t||this.audioState;return e.type===i.Record&&e.perform!==o.Stopped},e.prototype.setAudioState=function(t){var e=this.isRecording(t)?V.Record:V.Play;e!==this.state.type&&this.setState({type:e})},e.prototype.render=function(){return console.log("audio box render state:"+this.state.type),c.a.createElement("div",{ref:this.setRootRef,className:"audio-box-wrapper",style:{width:this.boxWidth+"px",height:this.boxHeight+"px"},onMouseDown:this.onMouseDown.bind(this),onMouseUp:this.onMouseUp.bind(this)},this.state.type===V.Record?c.a.createElement(yt,{id:this.anchorId,container:this.props.layoutBox,context:this.props.context}):c.a.createElement(wt,{id:this.anchorId,source:this.source,width:this.boxWidth,duration:this.duration,playedTime:this.playedTime}),this.state.focus&&c.a.createElement("div",{className:"audio-box-focus"}))},e.boxHeight=62,e}(St.a),xt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Et=function(t){function e(e){var n=t.call(this,e)||this;return n.ref=null,n.mask=null,n.state={duration:(e.recordId?pt.getInstance().state(e.recordId).duration:pt.getInstance().activeState.duration)||0},n}return xt(e,t),e.prototype.componentDidMount=function(){var t=this;this.ref&&(this.ref.ontouchstart=function(e){e.stopPropagation(),e.preventDefault(),t.mask&&(t.mask.style.visibility="visible")},this.ref.ontouchend=function(e){e.stopPropagation(),e.preventDefault(),t.mask&&(t.mask.style.visibility="hidden"),t.touched(e)}),this.subscribeRecordState()},e.prototype.componentWillReceiveProps=function(t){this.propsIdentity(this.props,t)||(this.unsubscribeRecordState(),this.subscribeRecordState())},e.prototype.propsIdentity=function(t,e){return t.recordId===e.recordId},e.prototype.subscribeRecordState=function(){var t=this,e=this.props.recordId||pt.getInstance().activeState.id;this.subscription=pt.getInstance().observable(e).subscribe((function(e){e.duration&&e.duration!==t.state.duration&&t.setState({duration:e.duration})}))},e.prototype.unsubscribeRecordState=function(){this.subscription&&this.subscription.unsubscribe()},e.prototype.touched=function(t){pt.getInstance().stopRecord(this.props.recordId)},e.prototype.top=function(){var t=this.context.store.getValue(it.d.MobileToolbarPosition),e=0;if(t.top&&t.bottom){var n=document.getElementById("MobileToolbarWrapper");"auto"===t.bottom&&(e=Math.max(n?n.clientHeight+n.offsetTop:0,0))}return e},e.prototype.render=function(){var t=this;return c.a.createElement("div",{ref:function(e){t.ref=e},className:"audio-float-bar-wrapper",style:{top:this.top()}},c.a.createElement("div",{ref:function(e){t.mask=e},className:"audio-float-bar-wrapper-mask"}),c.a.createElement("div",{className:"audio-float-bar-status-icon"}),c.a.createElement("div",{className:"audio-float-bar-mono-label"},"正在录音，点击停止。"))},e.contextType=it.h,e}(c.a.Component),Lt=function(t,e){return t.forEachOp((function(t){if(t instanceof p.InsertOperation){var e=t.param.spanProperty;e instanceof p.PluginContainerProperty&&e.pluginType===p.PluginType.Audio&&(e.anchorId=O.StringUtil.generateRandomId())}})),t},Pt=n(86),It=n(18),Ot=n(324),Rt=n.n(Ot);var Ct=function(t,e,n,i){var o,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(r<3?o(a):r>3?o(e,n,a):o(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},Dt=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Nt=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,o,r=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(t){o={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a},jt=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(Nt(arguments[e]));return t},Mt={toolbar:[{name:"insert-audiorecord",type:"icon",hasArrow:!1,icon:c.a.createElement("svg",{id:"insertaudiorecordingsvg",viewBox:"0 0 22 22"},c.a.createElement("path",{fill:"#5c5c5c",d:"M3.9,6H16.53l0.68,0.68,1.73,1.74V17l-15,0V6m-1-1V18l17,0V8l-3-3H2.9Z"}),c.a.createElement("polygon",{fill:"#5c5c5c",points:"10.5 12.85 9.09 10.4 7.01 14 16 14 12.93 8.55 10.5 12.85"})),tooltip:"插入录音",respectOffline:!0,onClick:function(t,e){e.insertAudioRecord(t.editor)}}],mobileToolbar:[{name:"insert-audiorecord",iconClass:Rt.a["insert-record"],value:"录音",respectOffline:!0,type:"square",onClick:function(t,e){e.insertAudioRecord(t.editor)},shouldDisabled:function(t){return!0},shouldHide:function(){return!1}}]},Bt=Mt.mobileToolbar,Ft=Mt.toolbar,At=function(){function t(){this.floatBarId="mobile-audio-float-bar",this.pluginInsertingIds=new Map}return t.prototype.$onInit=function(t){this.preInitialize(),this.registerAudioPluginRender(t),this.registerAudioCopyPasteProcessor(t),this.registerAudioFloatBarState(),p.GlobalContext.on(Pt.f.SWITCH_TO_BACKGROUND,(function(){pt.getInstance().pause(),pt.getInstance().stopRecord()}),this)},t.prototype.$beforeDestroy=function(t){pt.destroy(),t.removeListener(p.StateNotification.DeleteContainer,this),t.removeListener(p.StateNotification.InsertContainer,this),p.GlobalContext.removeListener(Pt.f.SWITCH_TO_BACKGROUND,this),this.pluginInsertingIds.clear()},t.prototype.preInitialize=function(){pt.getInstance().preInitialize()},t.prototype.registerAudioPluginRender=function(t){var e=this;t.addContainerRender(p.ContainerType.Plugin,p.PluginType.Audio,(function(t,e,n){return c.a.createElement(_t,{key:t.property.anchorId,layoutBox:t,containerFocus:e,context:n})})),t.on(p.StateNotification.DeleteContainer,(function(t){t&&t.anchorInfos&&jt(t.anchorInfos).filter((function(t){var e=Nt(t,1)[0];return pt.getInstance().has(e)})).forEach((function(t){var n=Nt(t,2),i=n[0],o=!1;n[1]?e.pluginInsertingIds.has(i)&&("finish"!==e.pluginInsertingIds.get(i)?o=!0:(e.pluginInsertingIds.set(i,"freezing"),setTimeout((function(){e.pluginInsertingIds.has(i)&&(pt.getInstance().unregister(i),e.pluginInsertingIds.delete(i))}),20))):o=!0,o&&(pt.getInstance().unregister(i),e.pluginInsertingIds.has(i)&&e.pluginInsertingIds.delete(i))}))}),this),t.on(p.StateNotification.InsertContainer,(function(t){t&&t.anchorInfos&&e.pluginInsertingIds.size>0&&jt(t.anchorInfos).filter((function(t){var n=Nt(t,1)[0];return e.pluginInsertingIds.has(n)})).forEach((function(t){var n=Nt(t,2),i=n[0];n[1]?pt.getInstance().has(i)||pt.getInstance().register(i):"freezing"===e.pluginInsertingIds.get(i)&&e.pluginInsertingIds.delete(i)}))}),this)},t.prototype.registerAudioCopyPasteProcessor=function(t){t.clipboardManager.addPasteDeltaProcessor(Lt)},t.prototype.registerAudioFloatBarState=function(){var t=this;pt.getInstance().floatBar.subscribe((function(e){e&&pt.getInstance().recording?t.showFloatBar():t.hideFloatBar()}))},t.prototype.registerAudioPuliginState=function(t,e){var n=this;t&&(pt.getInstance().register(t),pt.getInstance().observable(t).subscribe((function(t){(n.pluginInsertingIds.has(t.id)||"pending"===n.pluginInsertingIds.get(t.id))&&(t.perform===o.Stopped&&n.hideFloatBar(),t.error&&t.upload!==r.Abort?n.deleteAudioPlugin(t.id,e):t.upload===r.Finish&&n.insertAudioPluginFinish(t.id,e))})))},t.prototype.generateAnchorId=function(t){var e=O.StringUtil.generateRandomId();return this.registerAudioPuliginState(e,t),this.pluginInsertingIds.set(e,"pending"),e},t.prototype.insertAudioRecord=function(t){if(pt.getInstance().recording)tt.Snackbar.show({message:"正在录音中",duration:2e3,autoClose:!0});else{var e=this.generateAnchorId(t);this.insertAudioPluginStart(e,t),pt.getInstance().startRecord(e)}},t.prototype.insertAudioPluginStart=function(t,e){var n=e.service.getSelection(),i=n.getStart();n.insertParagraph(),n.setRange(i,i),n.getInlinePlugins().insertPluginStart(t,p.PluginType.Audio,p.ContainerOption.FitToParent,Object(O.pxToTwips)(_t.boxHeight)),setTimeout((function(){n.setRange(i+2,i+2,{forceFocus:!0})}))},t.prototype.insertAudioPluginFinish=function(t,e){if(this.pluginInsertingIds.has(t)&&"pending"===this.pluginInsertingIds.get(t)){this.pluginInsertingIds.set(t,"finish");var n=pt.getInstance().state(t);n.source?n.file?(e.onSelection().getInlinePlugins().insertPluginFinish(t,n.source,f.serializeAudioData(n.file)),this.hideFloatBar()):console.warn("no file info for anchorId "+t):console.warn("no source for anchorId "+t)}},t.prototype.deleteAudioPlugin=function(t,e){e.onSelection().getInlinePlugins().insertPluginCancel(t),this.pluginInsertingIds.delete(t),pt.getInstance().unregister(t)},t.prototype.showFloatBar=function(t){var e=document.getElementById("header");if(e){var n=document.createElement("div");n.id=this.floatBarId,e.appendChild(n),u.a.render(c.a.createElement(Et,{recordId:t}),n)}},t.prototype.hideFloatBar=function(){var t=document.getElementById("header"),e=document.getElementById(this.floatBarId);t&&e&&(u.a.unmountComponentAtNode(e),t.removeChild(e))},t=Ct([Object(it.i)({name:It.a.Audio,scope:0,for:["melo"],toolbarItems:Ft,mobileToolbarItems:Bt}),Dt("design:paramtypes",[])],t)}()},488:function(t,e,n){"use strict";n.d(e,"a",(function(){return K}));var i,o,r=n(1),a=n.n(r),s=n(273),c=n.n(s),l=n(2),u=n(36),p=n.n(u),d=(n(274),i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),h=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function a(t){try{c(i.next(t))}catch(t){r(t)}}function s(t){try{c(i.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((i=i.apply(t,e||[])).next())}))},f=function(t,e){var n,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(t){r=[6,t],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}},g=function(t){function e(e){var n=t.call(this,e)||this;return n.textInput=null,n.linkInput=null,n.state={posX:0,posY:0,visible:!1,text:"",link:"",showError:!1,textEditable:!0,isModify:!1},n}return d(e,t),e.prototype.fetchDocLink=function(){return h(this,void 0,void 0,(function(){var t,e;return f(this,(function(n){switch(n.label){case 0:if(!this.props.docLinkHandler)return[3,4];if(this.state.docLink&&(!this.state.docLink||this.state.docLink.fileUrl===this.state.link))return[3,4];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.props.docLinkHandler.docManager.requestDocInfo(this.state.link)];case 2:return t=n.sent(),this.state.text!==t.fileName&&this.setState({docLink:t}),[3,4];case 3:return e=n.sent(),l.Logger.error(e),[3,4];case 4:return[2]}}))}))},e.prototype.modifyLink=function(){if(this.textInput&&this.linkInput){var t=this.linkInput.value.trim(),e=Object(l.isMailTo)(t);if(e||(e=Object(l.isLink)(t),t=Object(l.appendHttp)(t),e||(e=Object(l.isLinkAfterAppenHttp)(t))),!e)return void this.setState({showError:!0,docLink:void 0});var n=null;this.state.textEditable&&""===(n=this.textInput.value)&&(n=t),this.props.handler.modifyLink(n,t,this.state.isModify,this.state.docLink)}this.setState({posX:0,posY:0,visible:!1,link:"",showError:!1})},e.prototype.onTextChange=function(t){this.state.textEditable&&this.setState({text:t.target.value})},e.prototype.onLinkChange=function(t){this.setState({link:t.target.value,showError:!1,docLink:void 0})},e.prototype.onKeyDown=function(t){13===t.keyCode&&this.modifyLink()},e.prototype.setLinkText=function(){this.state.textEditable&&this.state.docLink&&this.state.docLink.fileName&&this.setState({text:this.state.docLink.fileName})},e.prototype.componentDidUpdate=function(t,e){var n;this.linkInput&&!e.visible&&this.state.visible&&(this.linkInput.selectionStart=this.linkInput.value.length,this.linkInput.selectionEnd=this.linkInput.value.length,this.linkInput.focus(),this.state.docLink&&this.setState({docLink:void 0})),(null===(n=this.props.docLinkHandler)||void 0===n?void 0:n.isDocLink(this.state.link))&&this.fetchDocLink()},e.prototype.render=function(){var t=this;return a.a.createElement("div",{className:c.a["link-dialog"],onKeyDown:this.onKeyDown.bind(this),style:{left:this.state.posX-24,top:this.state.posY+16,display:this.state.visible?"block":"none"}},a.a.createElement("div",{className:c.a["link-dialog-arrow"]},a.a.createElement("div",{className:c.a["link-dialog-triangle-outer"]}),a.a.createElement("div",{className:c.a["link-dialog-triangle-inner"]})),a.a.createElement("div",{className:c.a["link-dialog-content"]},a.a.createElement("div",{className:c.a["link-dialog-input-container"]},a.a.createElement("label",{className:c.a["link-dialog-input-label"]},"文本"),a.a.createElement("div",null,a.a.createElement("input",{type:"text",className:c.a["link-dialog-input"]+" link-dialog-input-text",ref:function(e){t.textInput=e},placeholder:"",value:this.state.textEditable?this.state.text:"选择范围横跨多个段落，因此无法编辑",onChange:this.onTextChange.bind(this),disabled:!this.state.textEditable,style:this.state.textEditable?{}:{color:"#777",backgroundColor:"#f5f5f5",border:"1px solid #ebebeb"}}),this.state.textEditable&&this.state.docLink&&this.state.docLink.fileName&&this.state.docLink.fileName!==this.state.text?a.a.createElement("div",{className:c.a["link-dialog-doclink-tip-container"]},a.a.createElement("div",{className:c.a["link-dialog-doclink-name"]},"文档名为 ","《"+this.state.docLink.fileName+"》"),a.a.createElement("div",{className:c.a["link-dialog-doclink-replace"],onClick:this.setLinkText.bind(this)},"替换文本")):null)),a.a.createElement("div",{className:c.a["link-dialog-input-container"]+" "+(this.state.textEditable&&this.state.docLink&&this.state.docLink.fileName?"":c.a["line-margin"])},a.a.createElement("label",{className:c.a["link-dialog-input-label"]},"链接"),a.a.createElement("input",{type:"text",className:c.a["link-dialog-input"]+" link-dialog-input-link",ref:function(e){t.linkInput=e},placeholder:"请输入网页链接地址",value:this.state.link,onChange:this.onLinkChange.bind(this),style:this.state.showError?{border:"1px solid #de5a3d"}:{}})),a.a.createElement("div",null,a.a.createElement("div",{className:c.a["link-error"],style:{visibility:this.state.showError?"visible":"hidden"}},"链接看上去不太对。是不是输错了？"),a.a.createElement(p.a,{type:"primary",className:c.a["link-dialog-bottom-btn"],onClick:this.modifyLink.bind(this)},"应用"))))},e}(a.a.Component),y=n(52),m=n(0),v=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),b=function(t){function e(e){var n=t.call(this,e)||this;return n.state={posX:0,posY:0,visible:!1,link:""},n}return v(e,t),e.prototype.openLink=function(){this.setState({posX:0,posY:0,visible:!1,link:""}),this.props.handler.openLink()},e.prototype.cancelLink=function(){this.setState({posX:0,posY:0,visible:!1,link:""}),this.props.handler.cancelLink(),this.props.editor.fire(new m.FocusBlurNotification(m.FocusBlurNotificationType.REQUEST_FOCUS),!1)},e.prototype.modifyLink=function(){this.setState({posX:0,posY:0,visible:!1,link:""}),this.props.handler.showLinkDialog(!0)},e.prototype.render=function(){var t=y.a.getInstance().isEditable;return a.a.createElement("div",{className:c.a["link-tips"]+" link-tips",style:{left:this.state.posX,top:this.state.posY,visibility:this.state.visible?"visible":"hidden"}},a.a.createElement("div",{className:c.a["link-tips-link"],onClick:this.openLink.bind(this)},this.state.link),t?a.a.createElement("div",{className:c.a["link-tips-delete"],onClick:this.cancelLink.bind(this)},"取消链接"):null,t?a.a.createElement("div",{className:c.a["link-tips-modify"],onClick:this.modifyLink.bind(this)},"修改"):null)},e}(a.a.Component),k=n(5),w=n(331),S=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),T=function(t,e,n,i){var o,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(r<3?o(a):r>3?o(e,n,a):o(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},_=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},x=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function a(t){try{c(i.next(t))}catch(t){r(t)}}function s(t){try{c(i.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((i=i.apply(t,e||[])).next())}))},E=function(t,e){var n,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(t){r=[6,t],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}},L=(function(t){function e(e){var n=t.call(this,e)||this;return n.textInputFocus=!1,n.linkInputFocus=!1,n.state={visible:!1,text:"",link:"",showError:!1,textEditable:!0,isModify:!1,btnVisible:!0},n}S(e,t),e.prototype.componentDidMount=function(){},e.prototype.componentWillUnmount=function(){0},e.prototype.fetchDocLink=function(t){return x(this,void 0,void 0,(function(){var t,e;return E(this,(function(n){switch(n.label){case 0:if(!this.props.docLinkHandler)return[3,4];if(this.state.docLink&&(!this.state.docLink||this.state.docLink.fileUrl===this.state.link))return[3,4];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.props.docLinkHandler.docManager.requestDocInfo(this.state.link)];case 2:return t=n.sent(),this.state.text!==t.fileName&&this.setState({docLink:t}),[3,4];case 3:return e=n.sent(),l.Logger.error(e),[3,4];case 4:return[2]}}))}))},e.prototype.componentDidUpdate=function(t,e){var n,i=this;this.linkInput&&!e.visible&&this.state.visible&&(this.linkInput.selectionStart=this.linkInput.value.length,this.linkInput.selectionEnd=this.linkInput.value.length,setTimeout((function(){i.linkInput.focus()}),100),this.state.docLink&&this.setState({docLink:void 0})),(null===(n=this.props.docLinkHandler)||void 0===n?void 0:n.isDocLink(this.state.link))&&this.fetchDocLink(e)},e.prototype.modifyLink=function(){if(this.textInput&&this.linkInput){var t=this.linkInput.value.trim(),e=Object(l.isMailTo)(t);if(e||(e=Object(l.isLink)(t),t=Object(l.appendHttp)(t),e||(e=Object(l.isLinkAfterAppenHttp)(t))),!e)return void this.setState({showError:!0});var n="";this.state.textEditable&&""===(n=this.textInput.value)&&(n=t),this.props.handler.modifyLink(n,t,this.state.isModify,this.state.docLink)}this.props.handler.hideLinkDialog()},e.prototype.onTextChange=function(t){this.state.textEditable&&this.setState({text:t.target.value})},e.prototype.onLinkChange=function(t){this.setState({link:t.target.value,showError:!1})},e.prototype.onIOSKeyboardShow=function(){var t=this.stateManager.get("keyboardHeight").getValue();this.setState({btnVisible:!0}),document.getElementsByClassName("link-dialog-panel")[0].style.bottom=t+"px"},e.prototype.onIOSKeyboardHide=function(){this.setState({btnVisible:!0}),document.getElementsByClassName("link-dialog-panel")[0].style.bottom="0px"},e.prototype.onAndroidKeyboardShow=function(t){this.setState({btnVisible:!1})},e.prototype.onAndroidKeyboardHide=function(t){this.setState({btnVisible:!0})},e.prototype.setLinkText=function(){this.state.textEditable&&this.state.docLink&&this.state.docLink.fileName&&this.setState({text:this.state.docLink.fileName}),m.ReportHelper.tdwReport({opername:"link",module:"link_set",action:"link_tdocname_set",file_type:"1"})},e.prototype.render=function(){var t=this;return a.a.createElement(w.PullPanel,{visible:this.state.visible,destroyOnClose:!0,title:"修改链接",cancelText:"取消",onCancel:this.props.handler.hideLinkDialog.bind(this.props.handler),onOk:this.modifyLink.bind(this),containerStyle:{zIndex:1e4},className:"link-dialog-panel"},a.a.createElement("div",{className:c.a["link-dialog-mobile-container"],ref:function(e){t.container=e}},a.a.createElement("div",{className:c.a["link-dialog-mobile-input-container"]},a.a.createElement("label",{className:c.a["link-dialog-mobile-input-label"]},"文本"),a.a.createElement("input",{type:"text",className:c.a["link-dialog-mobile-input"]+" link-dialog-mobile-input-text",ref:function(e){t.textInput=e},placeholder:"",value:this.state.textEditable?this.state.text:"选择范围横跨多个段落，因此无法编辑",onChange:this.onTextChange.bind(this),disabled:!this.state.textEditable,style:this.state.textEditable?{}:{color:"#777"}})),this.state.textEditable&&this.state.docLink&&this.state.docLink.fileName&&this.state.docLink.fileName!==this.state.text?a.a.createElement("div",{className:c.a["link-dialog-doclink-tip-container-mobile"]},a.a.createElement("div",{className:c.a["link-dialog-doclink-name-mobile"]},"文档名为 ","《"+this.state.docLink.fileName+"》"),a.a.createElement("div",{className:c.a["link-dialog-doclink-replace-mobile"],onClick:this.setLinkText.bind(this)},"替换文本")):null,a.a.createElement("div",{className:c.a["link-dialog-mobile-input-container"]+" "+c.a["line-margin-mobile"],style:this.state.showError?{border:"1px solid #de5a3d"}:{}},a.a.createElement("label",{className:c.a["link-dialog-mobile-input-label"]},"链接"),a.a.createElement("input",{type:"text",className:c.a["link-dialog-mobile-input"]+" link-dialog-mobile-input-link",ref:function(e){t.linkInput=e},placeholder:"请输入网页链接地址",value:this.state.link,onChange:this.onLinkChange.bind(this)})),a.a.createElement("div",{className:c.a["link-dialog-mobile-error-tips"],style:{display:this.state.showError?"block":"none"}},"链接看上去不太对。是不是输错了？")))},T([Object(k.l)(),_("design:type",k.x)],e.prototype,"stateManager",void 0)}(a.a.Component),n(18)),P=n(51),I=n.n(P),O=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,o,r=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(t){o={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a},R=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(O(arguments[e]));return t};!function(t){t[t.Undefined=0]="Undefined",t[t.Subset=1]="Subset",t[t.Superset=2]="Superset",t[t.RightBounded=3]="RightBounded",t[t.StartIntersect=4]="StartIntersect",t[t.EndIntersect=5]="EndIntersect",t[t.BothIntersect=6]="BothIntersect"}(o||(o={}));var C,D=function(){function t(t,e){this.service=t,this.featureService=e}return t.prototype.linkReg=function(t){var e=!1,n=t.match(Object(l.autoMailToRegExp)());return n?e=!0:n=t.match(Object(l.autoUrlRegExp)()),n?{link:n[1],isMail:e}:{link:"",isMail:e}},t.getLastIndexCompareTo=function(t,e){for(var n=-1,i=t.length-1;i>=0;i--)if(e(t.charCodeAt(i),i)){n=i;break}return n},t.prototype.getUrlInsepectBeginPos=function(e,n,i){var o,r=this,a=0,s="",c=-1,l=0;return R(this.service.getDocument().getRange(e,n-i-1).getSpans()).forEach((function(u){return o=u.getRange(),s=r.service.getDocument().getRange(o.begin(),o.end()).getText(),u.isSpecialChar()?(a=l+s.length,void(l+=s.length)):-1!==(c=t.getLastIndexCompareTo(s,(function(t,o){return t>128||t===m.PlaceholderCharCode.Tab||t===m.PlaceholderCharCode.Space&&o+l+e<n-i-1})))?(a=l+c,void(l+=s.length)):void(l+=s.length)})),a},t.prototype.getRegText=function(t,e){var n=t,i="",o=this.service.getDocument().getRange(t,t).getParagraphs().item(0);if(!o)return{regTextBegin:n,regText:i};n=t-o.getRange().begin()>=256?t-256:o.getRange().begin(),i=this.service.getDocument().getRange(n,t).getText();var r=this.getUrlInsepectBeginPos(n,t,e);return{regTextBegin:n+=r,regText:i=i.substring(r,i.length)}},t.prototype.getLinkFromSpan=function(t){if(!t)return"";var e=t.getFont().getLink();return e&&e!==l.LinkType.UserCancel&&e!==m.TDConstants.Undefined?e:""},t.prototype.findLinkRangeBegin=function(t,e){var n=e;if(!t||t===l.LinkType.UserCancel)return n;for(var i=this.service.getDocument().getRange(e,e).getSpans().item(0);i&&i.getFont().getLink()===t;)n=i.getRange().begin(),i=i.getPrev();return n},t.prototype.findLinkRangeEnd=function(t,e){var n=e;if(!t||t===l.LinkType.UserCancel)return n;for(var i=this.service.getDocument().getRange(e,e).getSpans().item(0);i&&i.getFont().getLink()===t;)n=i.getRange().end(),i=i.getNext();return n},t.prototype.findLinkRangeFull=function(t,e){var n=this.findLinkRangeBegin(t,e.begin()),i=this.findLinkRangeEnd(t,e.end());return new m.GCPRange(n,i-n)},t.prototype.detectLinkOnTyping=function(t,e){var n=this.service.getSelection().range(),i=this.getRegText(n.end(),e),o=i.regTextBegin,r=i.regText,a=this.linkReg(r),s=a.link,c=a.isMail;if(!s)return!1;for(var u=o+r.indexOf(s),p=u+s.length,d=!1,h=this.service.getDocument().getRange(u,p).getSpans(),f=0;f<h.count();f++){var g=h.item(f);if(g){var y=g.getFont().getLink();if(y){if(!t){d=!0;break}if(y!==l.LinkType.UserCancel){d=!0;break}}}}if(d)return!1;var v=this.featureService.get(L.a.FieldcodeDocLink);if(v&&v.replaceWithDocLink(s,void 0,new m.GCPRange(u,p-u)))return!1;return c||(s=Object(l.appendHttp)(s)),this.setLink(s,new m.GCPRange(u,p-u)),m.ReportHelper.tdwReport({opername:"doc_word_editor",module:"link",action:"auto_insert"}),p===n.begin()},t.prototype.syncLinkOnTyping=function(){var t=this.service.getSelection().range(),e=this.service.getDocument().getRange(t.begin(),t.end()).getSpans().item(0);if(e){var n=this.getLinkFromSpan(e);if(n){var i=this.findLinkRangeFull(n,e.getRange()),o=this.service.getDocument().getTextFromGcpRange(i);o+=" ";var r=this.linkReg(o),a=r.link,s=r.isMail;a&&(s||(a=Object(l.appendHttp)(a)),this.setLink(a,i))}}},t.prototype.typeBackspaceLink=function(t){var e=this.service.getSelection().range();if(!e.isEmpty())return!1;var n=e.begin()-(t?2:1);if(n<0)return!1;var i=this.service.getDocument().getRange(n,n).getSpans().item(0);if(!i)return!1;var o=this.getLinkFromSpan(i);if(!o)return!1;var r=this.findLinkRangeFull(o,i.getRange());return e.begin()-(t?1:0)===r.end()&&(this.setLink(l.LinkType.UserCancel,r),m.ReportHelper.tdwReport({opername:"doc_word_editor",module:"link",action:"auto_insert_unset"}),!0)},t.prototype.isRangeValidToInsertLink=function(t){if(!t&&(this.service.getSelection().isSelectionAtMention()||this.service.getSelection().isSelectionAtCodeblock()))return{valid:!1,editable:!1};var e=t||this.service.getSelection().range();if(0===e.length())return{valid:!0,editable:!0};for(var n=!1,i=this.service.getDocument().getRange(e.begin(),e.end()).getSpans(),o=0;o<i.count();o++){var r=i.item(o);if(r){var a=r.getType();if(a===m.TDSpanType.ParaBreak)n=!0;else if(a!=m.TDSpanType.Text)return{valid:!1,editable:!1}}}return{valid:!0,editable:!n}},t.prototype.setLink=function(t,e){var n=e||this.service.getSelection().range();if(0!==n.length()){var i=this.service.getDocument().getStoryRangeFromGcpRange(n),o=n.end()===i.end()-1?n.end()-1:n.end();this.service.getDocument().getRange(n.begin(),o).getFont().setLink(t)}},t.prototype.getLink=function(t,e){var n="",i=e||this.service.getSelection().range();if(i.isEmpty()){var o=i.begin(),r=this.service.getDocument().getRange(o,o).getSpans().item(0);if(!(n=this.getLinkFromSpan(r))&&t){var a=this.service.getDocument().getRange(o,o).getParagraphs().item(0);a&&o>a.getRange().begin()&&(o-=1,r=this.service.getDocument().getRange(o,o).getSpans().item(0),n=this.getLinkFromSpan(r))}return n}for(var s=this.service.getDocument().getRange(i.begin(),i.end()).getSpans(),c=0;c<s.count();c++)if(n=this.getLinkFromSpan(s.item(c)))return n;return""},t.prototype.getLinkInfo=function(t){var e="",n="",i=o.Undefined,r=this.service.getSelection().range();if(r.isEmpty()){var a=r.begin(),s=this.service.getDocument().getRange(a,a).getSpans().item(0);if(!(n=this.getLinkFromSpan(s))&&t){var c=this.service.getDocument().getRange(a,a).getParagraphs().item(0);c&&a>c.getRange().begin()&&(a-=1,s=this.service.getDocument().getRange(a,a).getSpans().item(0),n=this.getLinkFromSpan(s))}if(n){var l=this.findLinkRangeFull(n,new m.GCPRange(a,0));e=this.service.getDocument().getTextFromGcpRange(l),i=a===r.begin()-1?o.RightBounded:o.Superset}return{text:e,link:n,linkRangeType:i}}var u=r.begin(),p=r.end(),d=this.service.getDocument().getRange(u,p).getSpans(),h=this.getLinkFromSpan(d.item(0));h&&(i=o.StartIntersect,u=this.findLinkRangeBegin(h,u));var f=this.getLinkFromSpan(d.item(d.count()-1));f&&(i=i===o.StartIntersect?o.BothIntersect:o.EndIntersect,p=this.findLinkRangeEnd(f,p));for(var g=0;g<d.count();g++)if(n=this.getLinkFromSpan(d.item(g))){i===o.Undefined&&(i=o.Subset);break}return{text:e=this.service.getDocument().getTextFromGcpRange(new m.GCPRange(u,p-u)),link:n,linkRangeType:i}},t}();!function(t){t.BACKSPACE="backspace",t.DELETE="delete",t.TAB="tab",t.ENTER="enter",t.INSERT_LINK="insert_link"}(C||(C={}));var N=[{keyBindings:{win:m.KeyAssist.CTRL_WIN+m.KeyCode.K,mac:m.KeyAssist.COMMAND+m.KeyCode.K},action:C.INSERT_LINK}],j=[],M=function(t,e,n,i){var o,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(r<3?o(a):r>3?o(e,n,a):o(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},B=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},F={menu:[{name:"insert-link",content:"链接",shortcut:{win:"Ctrl+K",mac:"⌘+K"},icon:a.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"},a.a.createElement("g",{fill:"none",fillRule:"evenodd"},a.a.createElement("path",{fill:"#444D5B",fillRule:"nonzero",d:"M11.638 6.349c1.799-1.799 4.715-1.799 6.513 0 1.799 1.798 1.799 4.714 0 6.513l-1.809 1.809c-.286.205-.686.183-.94-.072-.256-.256-.278-.655-.068-.936l1.804-1.814c1.239-1.24 1.239-3.248 0-4.487-1.196-1.196-3.11-1.237-4.356-.124l-.13.124-1.81 1.81c-.286.204-.685.182-.94-.073-.256-.255-.278-.655-.068-.936l-.005-.005 1.81-1.81zm-3.98 3.98c.28-.28.733-.28 1.013 0 .252.252.277.644.076.924l-.076.09-1.809 1.808c-1.239 1.24-1.239 3.248 0 4.487 1.196 1.196 3.11 1.237 4.356.124l.13-.124 1.81-1.81c.28-.279.733-.279 1.013 0 .252.253.277.645.076.925l-.076.089-1.81 1.81c-1.798 1.798-4.714 1.798-6.512 0-1.799-1.8-1.799-4.715 0-6.514l1.809-1.809zm6.278-.778c.25-.25.655-.25.904 0l.109.109c.25.25.25.654 0 .904l-4.885 4.885c-.25.25-.655.25-.904 0l-.109-.109c-.25-.25-.25-.654 0-.904l4.885-4.885z"}))),shouldDisabled:function(t,e){return!e.getService().isRangeValidToInsertLink().valid||!t.permission.isEditable},onClick:function(t,e){e.showLinkDialog(!1)},preventFocus:!0}],contextMenu:[{name:"insert_link",content:"插入链接",shortcut:{win:"Ctrl+K",mac:"⌘+K"},shouldDisabled:function(t,e){return!e.getService().isRangeValidToInsertLink().valid||!t.permission.isEditable},shouldHide:function(t){return t.isPublish},onClick:function(t,e){e.showLinkDialog(!1)}},{name:"modify_link",content:"修改链接",shouldDisabled:function(t){return!t.permission.isEditable},shouldHide:function(t,e){return t.isPublish||""===e.getLink()},onClick:function(t,e){e.showLinkDialog(!0)}},{name:"open_link",content:"打开链接",shouldHide:function(t,e){return t.isPublish||""===e.getLink()},onClick:function(t,e){e.openLink()}}],contextMenuMobile:[{name:"insert_link",content:"插入链接",shouldHide:function(t,e){return""!==e.getLink()||!e.getService().isRangeValidToInsertLink().valid||!t.permission.isEditable},onClick:function(t,e){e.showLinkDialog(!1)}},{name:"open_link",content:"打开链接",shouldHide:function(t,e){return!t.editor.isCaret()||""===e.getLink()},onClick:function(t,e){e.openLink()}},{name:"copy_link",content:"复制链接",shouldHide:function(t,e){return!t.editor.isCaret()||""===e.getLink()},onClick:function(t,e){e.copyLink()}},{name:"modify_link",content:"修改链接",shouldHide:function(t,e){return!t.editor.isCaret()||""===e.getLink()||!t.permission.isEditable},onClick:function(t,e){e.showLinkDialog(!0)}},{name:"cancel_link",content:"取消链接",shouldHide:function(t,e){return!t.editor.isCaret()||""===e.getLink()||!t.permission.isEditable},onClick:function(t,e){e.cancelLink()}}],toolbar:[{name:"insert-link",type:"icon",hasArrow:!1,icon:a.a.createElement("svg",{id:"insertlinksvg",viewBox:"0 0 22 22"},a.a.createElement("path",{d:"M12.32,9.81a2.75,2.75,0,0,0-.63-0.47A2.79,2.79,0,0,0,10.28,9a2.83,2.83,0,0,0-2,.84L4.88,13.15A2.89,2.89,0,1,0,9,17.24l2.44-2.44H11.25a3.93,3.93,0,0,1-1.17-.18L8.22,16.49a1.84,1.84,0,0,1-2.59-2.6L7.49,12,9,10.55a1.83,1.83,0,0,1,1.3-.53,1.5,1.5,0,0,1,.61.12,1.73,1.73,0,0,1,.68.42,1.75,1.75,0,0,1,.43.68l0.79-.79A2.46,2.46,0,0,0,12.32,9.81Z"}),a.a.createElement("path",{d:"M16.65,5.49a2.91,2.91,0,0,0-4.09,0L10.12,7.92h0.16a3.86,3.86,0,0,1,1.16.18L13.3,6.23a1.84,1.84,0,0,1,2.6,2.6l-3.35,3.34a1.83,1.83,0,0,1-1.3.53,1.71,1.71,0,0,1-.62-0.11A1.88,1.88,0,0,1,10,12.17a1.65,1.65,0,0,1-.42-0.69l-0.8.8a2.78,2.78,0,0,0,.48.64,2.48,2.48,0,0,0,.63.47,2.89,2.89,0,0,0,3.45-.47l3.35-3.34A2.88,2.88,0,0,0,16.65,5.49Z"})),preventFocus:!0,tooltip:"插入链接",shortcut:{win:"Ctrl+K",mac:"⌘+K"},shouldDisabled:function(t,e){return!t.permission.isEditable||!e.getService().isRangeValidToInsertLink().valid},onClick:function(t,e){e.showLinkDialog(!1)}}]},A=F.menu,U=F.contextMenu,H=F.contextMenuMobile,V=F.toolbar,K=function(){function t(t,e,n,i,r){var a=this;this.contextService=e,this.widgetService=n,this.store=i,this.featureService=r,this.editor=null,this.viewRange=null,this.linkTips=null,this.linkDialog=null,this.mouseHolded=!1,this.contextMenuClicked=!1,this.firstInit=!0,this.linkTipsDisabled=!1,this.text="",this.textEditable=!1,this.link="",this.linkRangeType=o.Undefined,this.paraAutoLinkPos=-1,this.onWindowResize=function(){a.hideLinkTips(),a.hideLinkDialog()},t.listen("$toggleLinkTips",(function(t){void 0===t&&(t=!1),t?a.enableLinkTips():a.disableLinkTips()}))}return t.prototype.$onInit=function(t){var e,n,i,o,r=this;this.editor=t,this.linkService=new D(this.editor.service,this.featureService),this.viewRange=this.editor?this.editor.viewSelection.getViewRange():null,this.editor.on(m.RenderNotificationTypes.SELECTION_CHANGE,(function(t){r.onSelectionChanged(t)}),this),this.editor.on(m.HiddenEditorNotificationType.ON_INPUT,(function(t){r.onInput(t)}),this),this.editor.on(m.HiddenEditorNotificationType.ON_COMPOSITION_END,(function(t){r.onCompositionEnd(t)}),this),this.editor.on(m.MouseNotificationType.MOUSE_EVENT,(function(t){r.onMouseEvent(t)}),this),this.editor.on(m.RenderNotificationTypes.CONTEXT_MENU_EVENT,(function(){r.onContextMenu()}),this),window.addEventListener("resize",this.onWindowResize),this.editor.registerPlugin((e=this,n=this.contextService.context.permission,(i={})[C.BACKSPACE]=function(t,i){if(t&&t instanceof m.MeloEditor&&n.isEditable){var o=e.getParaAutoLinkPos()>=0;if(e.getService().typeBackspaceLink(o))return void e.hideLinkTips()}i(),t&&t instanceof m.MeloEditor&&e.getService().getLink(!1)&&e.getService().syncLinkOnTyping()},i[C.DELETE]=function(t,n){n(),t&&t instanceof m.MeloEditor&&e.getService().getLink(!1)&&e.getService().syncLinkOnTyping()},i[C.ENTER]=function(t,i){if(t&&t instanceof m.MeloEditor&&n.isEditable&&e.getService().detectLinkOnTyping(!0,0)){var o=t.service.getSelection().range().end()+1;e.setParaAutoLinkPos(o)}i()},i[C.TAB]=function(t,i){t&&t instanceof m.MeloEditor&&n.isEditable&&e.getService().detectLinkOnTyping(!1,1),i()},i[C.INSERT_LINK]=function(t,i){t&&t instanceof m.MeloEditor&&n.isEditable&&e.getService().isRangeValidToInsertLink().valid&&e.showLinkDialog(!1)},i)),this.editor.surface.keymapManager.addKeymaps(N),this.editor.clipboardManager.addPasteNodeProcessor((o=this.featureService,function(t,e,n,i,r,a){if("a"!==m.NodeUtil.getTagName(t).toLowerCase())return!1;var s=m.NodeUtil.getAttr(t,"href");if(s){var c=Object(l.isMailTo)(s);c||(c=Object(l.isLink)(s))||(s=Object(l.appendHttp)(s),c=Object(l.isLinkAfterAppenHttp)(s)),c&&e.set("link",s)}var u=o.get(L.a.FieldcodeDocLink),p=!1;if(u&&s){var d=t.textContent||void 0;s===t.textContent&&(d=void 0),p=u.addDocLinkInDelta(n,s,d)}return p||a(t,e,n,i,r),!0}));var a=this.featureService.get(L.a.MobileHeader);a&&a.registerExternalPanel("showLinkMobilePanel"),this.keyBoardHeight$=this.store.get("keyboardHeight"),this.keyBoardHeight$&&this.keyBoardHeight$.subscribe((function(t){r.linkDialog&&r.linkDialog,0}))},t.prototype.$beforeDestroy=function(){this.editor&&(this.editor.removeListener(m.RenderNotificationTypes.SELECTION_CHANGE,this),this.editor.removeListener(m.HiddenEditorNotificationType.ON_INPUT,this),this.editor.removeListener(m.HiddenEditorNotificationType.ON_COMPOSITION_END,this),this.editor.removeListener(m.MouseNotificationType.MOUSE_EVENT,this),this.editor.removeListener(m.RenderNotificationTypes.CONTEXT_MENU_EVENT,this),window.removeEventListener("resize",this.onWindowResize)),this.removeTipsDom(),this.removeDialogDom(),this.editor=null},t.prototype.getService=function(){return this.linkService},t.prototype.renderTipsDom=function(){var t=this;this.editor&&this.widgetService.embed({name:"link-tips-container",component:a.a.createElement(b,{ref:function(e){t.linkTips=e},editor:this.editor,handler:this})})},t.prototype.removeTipsDom=function(){this.widgetService.remove("link-tips-container","embed"),this.linkTips=null},t.prototype.renderDialogDom=function(){var t=this;if(this.editor){var e=this.featureService.get(L.a.FieldcodeDocLink);this.widgetService.embed({name:"link-dialog-container",component:a.a.createElement(g,{ref:function(e){t.linkDialog=e},handler:this,docLinkHandler:e||void 0})})}},t.prototype.removeDialogDom=function(){this.widgetService.remove("link-dialog-container","embed"),this.linkDialog=null},t.prototype.onMouseEvent=function(t){t&&t.event instanceof MouseEvent&&("mousedown"===t.event.type?(this.mouseHolded=!0,this.hideLinkTips(),this.hideLinkDialog()):"mouseup"===t.event.type&&this.mouseHolded&&(this.mouseHolded=!1,this.viewRange&&this.viewRange.isCaret()&&this.findLink()?l.PlatformUtil.isMac()?t.event.metaKey?this.openLink():this.showLinkTips():t.event.ctrlKey?this.openLink():this.showLinkTips():this.hideLinkTips()))},t.prototype.onTouchEvent=function(){this.hideLinkDialog()},t.prototype.onContextMenu=function(){this.hideLinkTips(),this.hideLinkDialog(),this.contextMenuClicked=!0,this.findLink()},t.prototype.onSelectionChanged=function(t){var e=this;t&&t.viewRange&&(this.viewRange=t.viewRange,!this.viewRange.isCaret()||this.mouseHolded||this.firstInit||this.contextMenuClicked||this.linkTipsDisabled||this.linkDialog&&this.linkDialog.state.visible?this.hideLinkTips():this.findLink()?this.showLinkTips():this.hideLinkTips(),this.firstInit&&setTimeout((function(){e.firstInit=!1}),500),this.contextMenuClicked=!1,this.viewRange.isCaret()&&this.paraAutoLinkPos===this.viewRange.start.gcp&&this.paraAutoLinkPos===this.viewRange.end.gcp||(this.paraAutoLinkPos=-1))},t.prototype.onInput=function(t){if(t&&t.data&&this.editor)if(this.linkService.getLink(!1))this.linkService.syncLinkOnTyping();else{var e=t.data;e&&(1===e.length?(32===e.charCodeAt(0)||e.charCodeAt(0)>=128)&&this.linkService.detectLinkOnTyping(!1,1):this.linkService.detectLinkOnTyping(!1,1))}},t.prototype.onCompositionEnd=function(t){t&&t.data&&this.editor&&(this.linkService.getLink(!1)?this.linkService.syncLinkOnTyping():this.linkService.detectLinkOnTyping(!1,t.data.length))},t.prototype.findLink=function(){if(this.viewRange&&this.editor){var t=0===this.viewRange.start.charsOffset,e=this.linkService.getLink(t);if(e)return this.setLinkData("",!1,e,o.Undefined),!0}return this.setLinkData("",!1,"",o.Undefined),!1},t.prototype.findLinkInfo=function(){var t=this.featureService.get(L.a.FieldcodeDocLink);if(t){var e=t.getSelectionDocLink();if(e)return void this.setLinkData(e.docLink.fileName||"",!0,e.docLink.fileUrl,o.Undefined)}if(this.editor&&this.viewRange){var n=0===this.viewRange.start.charsOffset,i=this.linkService.getLinkInfo(n),r=this.linkService.isRangeValidToInsertLink().editable;this.setLinkData(i.text,r,i.link,i.linkRangeType)}},t.prototype.disableLinkTips=function(){this.hideLinkTips(),this.linkTipsDisabled=!0},t.prototype.enableLinkTips=function(){this.linkTipsDisabled=!1},t.prototype.showLinkTips=function(){if(this.editor&&this.viewRange&&this.link){this.linkTips||this.renderTipsDom();var t=this.viewRange.start.getDocumentOffset(this.editor.zoom),e=t.x,n=t.y;n+=this.viewRange.start.caretHeight(),this.linkTips.setState({posX:e,posY:n,visible:!0,link:this.link})}},t.prototype.hideLinkTips=function(){this.linkTips&&this.linkTips.state.visible&&this.linkTips.setState({posX:0,posY:0,visible:!1,link:""})},t.prototype.showLinkDialog=function(t){var e=this;if(!this.linkDialog)return this.renderDialogDom(),void setTimeout((function(){e.showLinkDialog(t)}));if(this.hideLinkTips(),this.viewRange&&this.linkDialog&&this.editor){this.findLinkInfo();var n=this.viewRange.start.getDocumentOffset(this.editor.zoom),i=n.x,o=n.y;o+=this.viewRange.start.caretHeight(),this.linkDialog.setState({posX:i,posY:o,visible:!0,text:this.getText(),link:this.getLink(),showError:!1,textEditable:this.textEditable,isModify:t})}},t.prototype.hideLinkDialog=function(){this.linkDialog&&this.linkDialog.setState({visible:!1,text:"",link:"",showError:!1},(function(){}))},t.prototype.openLink=function(){var t=this.getLink();t&&this.contextService.context.clientVars&&(Object(l.openLinkWithCheck)(t,this.contextService.context.clientVars.globalPadId,this.contextService.context.clientVars.creatorId),m.ReportHelper.tdwReport({opername:"doc_word_editor",module:"link",action:"click",obj3:t}))},t.prototype.cancelLink=function(){if(this.contextService.context.permission.isEditable){var t=this.featureService.get(L.a.FieldcodeDocLink);if(t){var e=t.getSelectionDocLink();if(e)return void t.docLinkService.deleteDocLink(e.range)}if(this.viewRange&&this.editor){this.findLinkInfo();var n=this.getLinkRange();n&&this.linkService.setLink(l.LinkType.UserCancel,n)}m.ReportHelper.tdwReport({opername:"doc_word_editor",module:"link",action:"unset"})}},t.prototype.modifyLink=function(t,e,n,i){if(this.contextService.context.permission.isEditable){if(this.editor&&e){var o=this.featureService.get(L.a.FieldcodeDocLink),r=o?o.getSelectionDocLink():null,a=this.getLinkRange();if(a=!r||a&&0!==a.len?a:r.range){var s=this.editor.service.getDocument().getRange(a.begin(),a.end());if(o){if(o.replaceWithDocLink(e,t||void 0,a,!1,i))return;r&&o.docLinkService.deleteDocLink(r.range)}if(t&&t!==this.text){var c=a.begin()+t.length;s.setLink(t,e),this.editor.service.getSelection().setRange(c,c,{forceFocus:!0})}else{var l=this.editor.service.getSelection().range();c=l.begin()+l.length();this.linkService.setLink(e,s.range()),this.editor.service.getSelection().setRange(c,c,{forceFocus:!0})}}}n?m.ReportHelper.tdwReport({opername:"doc_word_editor",module:"link",action:"edit"}):m.ReportHelper.tdwReport({opername:"doc_word_editor",module:"link",action:"insert",obj3:t?"withtext":"withouttext"})}},t.prototype.copyLink=function(){this.editor&&this.getLink()&&(this.editor.clipboardManager.writeToClipboard(this.getLink()),I.a.show({message:"已复制",duration:2e3,autoClose:!0}))},t.prototype.getLinkRange=function(){if(this.editor){var t=this.editor.service.getSelection().range();if(this.linkRangeType===o.Subset)return t;if(this.linkRangeType===o.Superset)return this.linkService.findLinkRangeFull(this.link,t);if(this.linkRangeType===o.RightBounded){var e=new m.GCPRange(t.begin()-1,0);return this.linkService.findLinkRangeFull(this.link,e)}if(this.linkRangeType===o.StartIntersect){var n=this.linkService.getLink(!1,new m.GCPRange(t.begin(),0)),i=this.linkService.findLinkRangeBegin(n,t.begin());return new m.GCPRange(i,t.end()-i)}if(this.linkRangeType===o.EndIntersect){n=this.linkService.getLink(!1,new m.GCPRange(t.end(),0));var r=this.linkService.findLinkRangeEnd(n,t.end());return new m.GCPRange(t.begin(),r-t.begin())}if(this.linkRangeType===o.BothIntersect){var a=this.linkService.getLink(!1,new m.GCPRange(t.begin(),0)),s=(i=this.linkService.findLinkRangeBegin(a,t.begin()),this.linkService.getLink(!1,new m.GCPRange(t.end(),0)));r=this.linkService.findLinkRangeEnd(s,t.end());return new m.GCPRange(i,r-i)}return t}return null},t.prototype.setLinkData=function(t,e,n,i){this.text=t,this.textEditable=e,this.link=n,this.linkRangeType=i},t.prototype.getLink=function(){var t=this.featureService.get(L.a.FieldcodeDocLink);if(t){var e=t.getSelectionDocLink();return e?e.docLink.fileUrl:this.link}return this.link},t.prototype.filterLinkText=function(t){return t.replace(new RegExp(m.PlaceholderChar.FloatingAnchor,"g"),"")},t.prototype.getText=function(){var t=this.featureService.get(L.a.FieldcodeDocLink);if(t){var e=t.getSelectionDocLink();if(e&&e.docLink)return e.docLink.fileName?e.docLink.fileName:e.docLink.fileUrl}return this.filterLinkText(this.text)},t.prototype.setParaAutoLinkPos=function(t){this.paraAutoLinkPos=t},t.prototype.getParaAutoLinkPos=function(){return this.paraAutoLinkPos},t=M([Object(k.i)({menuItems:A,contextMenuItems:U,contextMenuMobileItems:H,toolbarItems:V,keymap:j,name:L.a.Link,scope:0,for:["melo"]}),B("design:paramtypes",[k.B,k.f,k.A,k.x,k.k])],t)}()},489:function(t,e,n){"use strict";n.d(e,"a",(function(){return W}));var i,o=n(0),r=n(1),a=n.n(r),s=n(12),c=n(2),l=(n(290),n(35)),u=n.n(l),p=(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),d=function(){return(d=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},h=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,o,r=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(t){o={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a},f=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(h(arguments[e]));return t},g=[20,32,44,56,68,80],y=function(t){function e(e){var n=t.call(this,e)||this;return n.onClickContent=function(t){var e=t.target.parentNode.id;n.setState({selectId:e});var i=n.state.outlineList.filter((function(t){return t.paraId===e}));i.length>0&&n._editor&&n._editor.service.getSelection().setRange(i[0].range.begin(),i[0].range.begin(),{backward:!1,scrollToView:o.ScrollViewType.Top}),o.ReportHelper.tdwReport({opername:"doc_word_editor",module:"contents",action:"clk_title"})},n.onMouseEnterContent=function(t,e){if(!c.PlatformUtil.isSafari()||c.PlatformUtil.isChrome()){var i=t.target;if(i.offsetWidth<i.scrollWidth){var o={isVisible:!1,text:e,offsetX:i.offsetWidth+i.offsetLeft-16,offsetY:i.offsetTop+i.offsetHeight/2-75};n.setState({tooltip:o},(function(){n.setState({tooltip:d(d({},o),{isVisible:!0})})}))}}},n.onMouseLeaveContent=function(){n.state.tooltip.isVisible&&n.setState({tooltip:d(d({},n.state.tooltip),{isVisible:!1})})},n.expandSpanOnclick=function(t){var e=t.target.parentNode.id,i=n.state.collapsedId||[],o=i.indexOf(e);-1===o?i.push(e):i.splice(o,1),n.setState({collapsedId:f(i)})},n.onMouseEnter=function(){n.setState({shouldShowExpand:!0})},n.onMouseMove=function(){n.state.shouldShowExpand||n.setState({shouldShowExpand:!0})},n.onMouseLeave=function(){n.setState({shouldShowExpand:!1})},n.state={outlineList:[],selectId:e.selectId||"",collapsedId:[],shouldShowExpand:!1,tooltip:{isVisible:!1}},n._editor=e.editor,n._containerRef=a.a.createRef(),n._containerWidth=0,n}return p(e,t),e.prototype.checkContentIsNull=function(t){return 0===t.replace(/(^\s+)|(\s+$)/g,"").length},e.prototype.isParentCollapsed=function(t){var e=this.state,n=e.outlineList,i=e.collapsedId;if(t>0&&t<n.length&&i.length>0){var r=n[t].outlineLevel;if(r===o.OutlineLevel.Level1)return!1;for(var a=t;a>=0;a--){var s=n[a];if(r>s.outlineLevel){if(-1!==i.indexOf(s.paraId))return!0;r=s.outlineLevel}}}return!1},e.prototype.getAllOutlintLevel=function(){var t=[];return this.state.outlineList.forEach((function(e){var n=e.styleName;t.includes(e.outlineLevel)||n===o.BuiltinStyleName.Title||n===o.BuiltinStyleName.Subtitle||t.push(e.outlineLevel)})),t.sort().reduce((function(t,e,n){return t[e]=n,t}),{})},e.prototype.renderOutlineHeader=function(){return a.a.createElement("div",{className:"outline-header"},a.a.createElement("div",{className:"outline-title"},"目录"),a.a.createElement("div",{className:"outline-close-button",onClick:this.props.onClickCloseBtn}))},e.prototype.shouldShowExpandDiv=function(t,e,n){var i=t.styleName,r=null;e<n.length-1&&(r=n[e+1]);var a=i===o.BuiltinStyleName.Title||i===o.BuiltinStyleName.Subtitle;return r&&r.outlineLevel>t.outlineLevel&&!a},e.prototype.matchClassNameForOutlineItem=function(t){var e=t.styleName,n=t.outlineLevel;return e===o.BuiltinStyleName.Title&&n===o.OutlineLevel.Level1?"headline-title":e===o.BuiltinStyleName.Subtitle&&n===o.OutlineLevel.Level2?"headline-subtitle":n===o.OutlineLevel.Level1?"headline-headingone":n===o.OutlineLevel.Level2?"headline-headingtwo":n===o.OutlineLevel.Level3?"headline-headingthree":"headline-headingother"},e.prototype.shouldOutlineRenderEmpty=function(t){return!t.length||1===t.length&&this.checkContentIsNull(t[0].text)},e.prototype.renderOutlineContent=function(){var t=this,e=this.state,n=e.outlineList,i=e.selectId,r=e.collapsedId,s=e.shouldShowExpand,c=this.getAllOutlintLevel();return this.shouldOutlineRenderEmpty(n)?a.a.createElement("div",{className:"headline-content-tips"},a.a.createElement("div",null,a.a.createElement("div",null,"对文档内容应用“标题”样式"),a.a.createElement("div",null,"即可生成“目录”"))):a.a.createElement("div",{className:"headline-container",onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onMouseMove:this.onMouseMove,ref:this._containerRef},a.a.createElement("div",{className:"headline-content"},a.a.createElement(u.a,{title:this.state.tooltip.text,visible:this.state.tooltip.isVisible,placement:"right",containerOffsetX:this.state.tooltip.offsetX,containerOffsetY:this.state.tooltip.offsetY,overlayStyle:{maxWidth:"200px"},style:{maxHeight:"0"}}),n.map((function(e,l){var u=e.styleName,p=e.outlineLevel,d=e.paraId,h=e.text;if(t.isParentCollapsed(l))return null;var f=s&&t.shouldShowExpandDiv(e,l,n),y={display:"inline-block"},m={display:"inline-block"};if(f){var v=0;-1!==r.indexOf(d)&&(v=-90),y.transform="rotate("+v+"deg)"}var b=t.matchClassNameForOutlineItem(e),k=u!==o.BuiltinStyleName.Title&&u!==o.BuiltinStyleName.Subtitle?g[c[p]]:g[0];return f?(y.marginLeft=k-20+"px",y.opacity="1",m.width="calc(100% - "+k+"px)",m.marginLeft="-20px"):s?(y.display="none",m.marginLeft=k-20+"px",m.width="calc(100% - "+(k-20)+"px)"):(y.marginLeft=k-20+"px",y.opacity="0",m.width="calc(100% - "+k+"px)",m.marginLeft="-20px"),t.checkContentIsNull(h)&&(h="标题内容为空",m.color="rgba(0,0,0,0.2)"),e.paraId===i&&(m.color="#1e6fff"),a.a.createElement("div",{className:"headline",key:d,id:d,onMouseEnter:function(e){return t.onMouseEnterContent(e,h)},onMouseLeave:t.onMouseLeaveContent},a.a.createElement("div",{className:"headline-triangle",style:y,onClick:t.expandSpanOnclick}),a.a.createElement("div",{className:b,style:m,onClick:t.onClickContent},h))}))))},e.prototype.render=function(){return a.a.createElement("div",{className:"outline-container"},this.renderOutlineHeader(),this.renderOutlineContent())},e}(a.a.Component),m=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),v=function(t){function e(e){var n=t.call(this,e)||this;return n.onClick=function(){n.props.handler.onOutlineCubeClick(),n.setState({visibility:!1})},n.state={visibility:e.visibility},n}return m(e,t),e.prototype.render=function(){return a.a.createElement("div",{key:"headline-wrapper-show",className:"headline-wrapper-show",onClick:this.onClick,style:this.state.visibility?{opacity:1,left:"0"}:{opacity:0,left:"-12px"}},"目录")},e}(a.a.Component),b=n(5),k=function(t,e,n,i){var o,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(r<3?o(a):r>3?o(e,n,a):o(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},w=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},S=function(){function t(t){var e=this;this._isShow=!1,this._panel=null,this._cacheList=[],this._cube=null,this._isRightDrawerOpen=!1,this._needShowOutlineAgain=!1,this._hasFirstRenderFinish=!1,this.showOutlineIfNeed=function(t,n){if(!(t.length<=0))if(0===n.length){var i=t[0].paraId;e.checkAndShow(t,i)}else if(1===n.length&&e._isNewDefaultStyleVersion){if(n[0].styleName===o.BuiltinStyleName.Title){i=t.length>1?t[1].paraId:t[0].paraId;e.checkAndShow(t,i)}}},this.handleRenderFinish=function(){e._hasFirstRenderFinish=!0,e._cacheList=e._editor.onDocument().collectOutlineParagraph();var t=e.getLastShowStatus();e._cacheList.length>0&&(null===t||"1"===t)?null===t?e.checkAndShow(e._cacheList):"1"===t&&e.show():e.showOutlineCueIfNeed()},this._editor=t,this._isNewDefaultStyleVersion=o.Defaults.curDocDataVersion>=o.Defaults.newDefaultStyleVersion,this._preloadOutlineCube=document.getElementById("pc-preload-outline-cube"),this._editor.on(o.StateNotification.EfficientModelChange,(function(t){if(t.changeData.dirtyRangeMap.has(o.StoryID.MainDocId)){var n=e._editor.onDocument().collectOutlineParagraph();e._isShow&&e._panel?0===n.length?(e.hide(),e.showOutlineCueIfNeed()):e._panel.setState({outlineList:n}):n.length>0&&e.showOutlineIfNeed(n,e._cacheList),e._cacheList=n}}),this),this._editor.on(o.RenderNotificationTypes.RENDER_FINISH,this.handleRenderFinish,this),this._hasFirstRenderFinish||this.handleRenderFinish(),this.initEventsListener()}return t.prototype.destroy=function(){this._editor.removeListener(o.StateNotification.EfficientModelChange,this),this._editor.removeListener(o.RenderNotificationTypes.RENDER_FINISH,this),this._editor.removeListener(o.RenderNotificationTypes.SELECTION_END,this),this._widgetService.remove("outline_cube","float")},t.prototype.calcLeftDrawerStyles=function(){return{minWidth:"316px",maxWidth:"316px",paddingTop:"13px"}},t.prototype.initEventsListener=function(){var t=this;this._store.get("leftDrawerOpened").subscribe((function(e){var n=t._store.getValue("leftDrawerInfo");n&&"toc"===n.name&&(e?t._isShow=!0:t.showOutlineCueIfNeed(),o.ReportHelper.tdwReport({opername:"doc_word_editor",module:"contents",action:e?"open":"close"}))})),this._store.get("rightDrawerOpened").subscribe((function(e){var n=t._store.getValue("rightDrawerInfo");n&&"edit-history"===n.name&&(e?(t._isRightDrawerOpen=!0,t._isShow?(t.hide(),t._needShowOutlineAgain=!0):t._cube&&t._cube.setState({visibility:!1})):(t._isRightDrawerOpen=!1,t._needShowOutlineAgain?(t._needShowOutlineAgain=!1,t.show()):t.showOutlineCueIfNeed()))})),this._editor.on(o.RenderNotificationTypes.SELECTION_END,(function(e){t.onCoreSelectionChanged(e)}),this)},t.prototype.onCoreSelectionChanged=function(t){if(t&&this._isShow&&this._panel){var e=this._editor.service.getSelection().range(),n=this._cacheList.filter((function(t){return e.intersect(t.range)})),i="";n.length>0&&(i=n[0].paraId),this._panel.setState({selectId:i})}},t.prototype.getLastShowStatus=function(){return c.LocalStorageUtil.isLocalStorageSupported()?c.LocalStorageUtil.getItem(this.getheadlineKey()):"0"},t.prototype.getheadlineKey=function(){var t=Object(s.c)();return"headline_tree_show_status"+t.globalPadId+"_"+t.userDomain},t.prototype.onOutlineCubeClick=function(){this.show()},t.prototype.showOutlineCueIfNeed=function(){this.showOutlineCube()},t.prototype.showOutlineCube=function(){var t=this;this.removePreloadOutlineCube(),this._cube?this._cube.setState({visibility:!0}):this._widgetService.float({name:"outline_cube",component:a.a.createElement(v,{handler:this,visibility:!0,ref:function(e){return t._cube=e}})})},t.prototype.onMenuClick=function(){this._isShow?this.hide():this.show()},t.prototype.removePreloadOutlineCube=function(){this._preloadOutlineCube&&this._preloadOutlineCube.parentNode&&(this._preloadOutlineCube.parentNode.removeChild(this._preloadOutlineCube),this._preloadOutlineCube=null)},t.prototype.checkAndShow=function(t,e){this._isNewDefaultStyleVersion&&1===t.length&&t[0].styleName===o.BuiltinStyleName.Title?this.showOutlineCueIfNeed():this.show(e)},t.prototype.show=function(t){var e=this;this.removePreloadOutlineCube();this._drawerService.showLeftDrawer({name:"toc",animation:"fadeIn",type:"transparent",titleStyle:{},content:a.a.createElement(y,{editor:this._editor,selectId:t||"",ref:function(t){return e._panel=t},onClickCloseBtn:this.onMenuClick.bind(this)}),onClose:function(){e.clearState()},onOpen:function(){e._panel&&(e._cacheList=e._editor.onDocument().collectOutlineParagraph(),e._panel.setState({outlineList:e._cacheList})),e._cube&&e._cube.setState({visibility:!1})},style:this.calcLeftDrawerStyles()}),this._isShow=!0,c.LocalStorageUtil.setItem(this.getheadlineKey(),"1")},t.prototype.hide=function(){this._drawerService.setLeftDrawerMode("float"),this._drawerService.closeLeftDrawer(!0),this.clearState()},t.prototype.isOutlineShow=function(){return this._isShow},t.prototype.clearState=function(){this._isShow=!1,c.LocalStorageUtil.setItem(this.getheadlineKey(),"0")},k([Object(b.l)(),w("design:type",b.x)],t.prototype,"_store",void 0),k([Object(b.l)(),w("design:type",b.g)],t.prototype,"_drawerService",void 0),k([Object(b.l)(),w("design:type",b.A)],t.prototype,"_widgetService",void 0),t}(),T=function(t,e,n,i,r,a){var s=o.NodeUtil.getTagName(t).toLowerCase();if("h1"!==s&&"h2"!==s&&"h3"!==s&&"h4"!==s&&"h5"!==s&&"h6"!==s&&"h7"!==s&&"h8"!==s&&"h9"!==s)return!1;if(r.dstType===o.PasteDstType.Table||r.dstType===o.PasteDstType.Cell||r.dstType===o.PasteDstType.Codeblock)return!1;if(r.isPasteFromMsoTable)return!1;a(t,e,n,i,r);var c=function(t){var e=o.BuiltinStyleType.None;"h1"===t?e=o.BuiltinStyleType.Heading1:"h2"===t?e=o.BuiltinStyleType.Heading2:"h3"===t?e=o.BuiltinStyleType.Heading3:"h4"===t?e=o.BuiltinStyleType.Heading4:"h5"===t?e=o.BuiltinStyleType.Heading5:"h6"===t?e=o.BuiltinStyleType.Heading6:"h7"===t?e=o.BuiltinStyleType.Heading7:"h8"===t?e=o.BuiltinStyleType.Heading8:"h9"===t&&(e=o.BuiltinStyleType.Heading9);return e}(s),l=i.getDocument().getOutlineStyleProps(c);if(l&&l.styleType===o.StyleType.Paragraph){var u=new o.ParaProperty;u.styleName=l.styleName,n.insertParagraph(n.currentRange().end(),new o.ParaBreakSpan,u)}return!0};var _=n(330),x=n.n(_),E=n(74),L=n.n(E),P=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),I=function(t,e,n,i){var o,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(r<3?o(a):r>3?o(e,n,a):o(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},O=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},R=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return P(e,t),e.prototype.render=function(){var t=this,e=this._store.getValue("leftDrawerInfo"),n=[L.a["statusbar-simple-button"]];return this.props.leftDrawerOpened&&e&&"toc"===e.name&&n.push("active"),a.a.createElement("div",{className:n.join(" ")},a.a.createElement(u.a,{placement:"top",title:"目录"},a.a.createElement("div",{className:x.a["toc-button"]+" "+L.a["small-button"],onClick:function(){var e=t.props.handler;e&&e.outlineCtrl.onMenuClick()}})))},I([Object(b.l)(),O("design:type",b.x)],e.prototype,"_store",void 0),e}(a.a.Component),C=Object(b.D)(["leftDrawerOpened"])(R),D=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,o,r=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(t){o={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a},N=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(D(arguments[e]));return t},j=[{name:"normal",text:"正文",style:{fontFamily:o.Defaults.fontFamily,fontSize:14}},{name:"title",text:"标题",style:{fontFamily:o.Defaults.fontFamily,fontSize:"22pt",fontWeight:700}},{name:"subtitle",text:"副标题",style:{fontFamily:o.Defaults.fontFamily,fontSize:"16pt",fontWeight:700,color:"#848484"}},{name:"heading1",text:"标题 1",style:{fontFamily:o.Defaults.fontFamily,fontSize:"22pt",fontWeight:700}},{name:"heading2",text:"标题 2",style:{fontFamily:o.Defaults.fontFamily,fontSize:"18pt",fontWeight:700}},{name:"heading3",text:"标题 3",style:{fontFamily:o.Defaults.fontFamily,fontSize:"16pt",fontWeight:700}},{name:"heading4",text:"标题 4",style:{fontFamily:o.Defaults.fontFamily,fontSize:"15pt",fontWeight:700}},{name:"heading5",text:"标题 5",style:{fontFamily:o.Defaults.fontFamily,fontSize:"14pt",fontWeight:700}},{name:"heading6",text:"标题 6",style:{fontFamily:o.Defaults.fontFamily,fontSize:"12pt",fontWeight:700}}],M=[{name:"normal",text:"正文",style:{fontFamily:o.Defaults.fontFamily,fontSize:"11pt",color:"#5C5C5C"}},{name:"title",text:"标题",style:{fontFamily:o.Defaults.fontFamily,fontSize:"22pt",fontWeight:700,color:"#333333"}},{name:"subtitle",text:"副标题",style:{fontFamily:o.Defaults.fontFamily,fontSize:"20pt",fontWeight:700,color:"#5C5C5C"}},{name:"heading1",text:"标题 1",style:{fontFamily:o.Defaults.fontFamily,fontSize:"18pt",fontWeight:700,color:"#333333"}},{name:"heading2",text:"标题 2",style:{fontFamily:o.Defaults.fontFamily,fontSize:"16pt",fontWeight:700,color:"#333333"}},{name:"heading3",text:"标题 3",style:{fontFamily:o.Defaults.fontFamily,fontSize:"14pt",fontWeight:700,color:"#333333"}},{name:"heading4",text:"标题 4",style:{fontFamily:o.Defaults.fontFamily,fontSize:"12pt",fontWeight:700,color:"#333333"}},{name:"heading5",text:"标题 5",style:{fontFamily:o.Defaults.fontFamily,fontSize:"11pt",fontWeight:700,color:"#333333"}}],B=o.Defaults.curDocDataVersion>=o.Defaults.newDefaultStyleVersion?M:j;var F=n(18),A=function(t,e,n,i){var o,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(r<3?o(a):r>3?o(e,n,a):o(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},U=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},H={menu:N([{name:"view-toc",content:"显示目录",onClick:function(t,e){e.outlineCtrl.onMenuClick()},shouldCheck:function(t,e){return e.isOutlineShow()}},{name:"heading",content:"标题样式",shouldDisabled:function(t){return!!t.editor.onSelection().tableCellRangeAll()||!(!t.permission||t.permission.isEditable)}}],Object.keys(B).map((function(t){var e=B[t],n=e.name,i=e.text,o=e.style;return{name:n,content:a.a.createElement("span",{style:o},i),style:{height:"auto",paddingTop:6,paddingBottom:6},onClick:function(t,e){e.setHeadingStyle(n)},shouldCheck:function(t,e){return e.getHeadingStyle()===n}}}))),statusBar:[{name:"toc",content:a.a.createElement(C,null)}]},V=H.menu,K=H.statusBar,W=function(){function t(t){this.store=t,this.translateOpened$=null}return t.prototype.$onInit=function(t){this.editor=t,this.outlineCtrl=new S(t),this.editor.clipboardManager.addPasteNodeProcessor(T),this.editor.on(o.RenderNotificationTypes.SCROLLABLE_RESIZE,this.handleScrollableResize.bind(this),this)},t.prototype.$beforeDestroy=function(){var t,e;null===(t=this.outlineCtrl)||void 0===t||t.destroy(),null===(e=this.translateOpened$)||void 0===e||e.unsubscribe(),this.editor.removeListener(o.RenderNotificationTypes.SCROLLABLE_RESIZE,this)},t.prototype.isOutlineShow=function(){return this.outlineCtrl.isOutlineShow()},t.prototype.handleScrollableResize=function(){var t,e=this;this.translateOpened$||(this.translateOpened$=this.store.get("translateOpened"),null===(t=this.translateOpened$)||void 0===t||t.subscribe((function(t){t&&e.outlineCtrl.hide()})))},t.prototype.setHeadingStyle=function(t){this.editor.service.getSelection().setStyle(t),o.ReportHelper.tdwReport({opername:"doc_word_editor",module:"contents",action:"style_apply",obj3:t})},t.prototype.getHeadingStyle=function(){var t=this.editor.service.getSelection().getStyleName();return t===o.TDConstants.Undefined&&(t=""),t},t=A([Object(b.i)({menuItems:V,statusbarItems:K,name:F.a.Outline,scope:0,for:["melo"]}),U("design:paramtypes",[b.x])],t)}()},491:function(t,e,n){"use strict";n.d(e,"a",(function(){return E}));var i,o,r=n(10),a=n.n(r),s=n(0),c=n(1),l=n.n(c),u=n(2),p=(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});!function(t){t.WatermarkChanged="WatermarkChanged"}(o||(o={}));var d=function(t){function e(){return t.call(this,o.WatermarkChanged)||this}return p(e,t),e}(u.Notification),h=n(270),f=n(12),g=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),y=function(t){function e(e){var n=t.call(this,e)||this;if(n.PagesDocs={width:793,height:793},n.WatermarkUsersDocs={isAuthor:Object(f.c)().isCreator,userName:Object(f.c)().userName,userDomain:Object(f.c)().userDomain},n.optionDocs={type:"text",wmText:"",fontFamily:"微软雅黑",fontColor:"#000000",fontSize:20,marginType:0,selfHide:0,visitShow:0,show:0},n.watermarkClientVars=Object(f.c)().watermark,n.watermarkClientVars){var i=JSON.parse(n.watermarkClientVars);if(0===i.show||1===i.show||(i.show=1),Object.prototype.hasOwnProperty.call(i,"s")){var o=i.s;Object.prototype.hasOwnProperty.call(o,"private")||(i.s={private:0})}else i.s={private:0};Object.prototype.hasOwnProperty.call(i,"marginType")&&"number"==typeof i.marginType||(i.marginType=0),Object.prototype.hasOwnProperty.call(i,"text")&&"string"==typeof i.text||(i.text=""),Object.prototype.hasOwnProperty.call(i,"selfHide")&&"number"==typeof i.selfHide||(i.selfHide=0),window.clientVars.watermark=JSON.stringify(i)}return n.watermarkSVG=h.GenerateSVG.watermarkGetSVG(window.clientVars.watermark,n.PagesDocs,n.WatermarkUsersDocs,n.optionDocs),n.state={base64Data:n.watermarkSVG.base64Data,base64NickData:n.watermarkSVG.base64NickData,canvasHeight:n.watermarkSVG.canvasHeight,lineHeight:n.watermarkSVG.lineHeight},n}return g(e,t),e.prototype.componentDidMount=function(){var t=this;this.props.context.on(o.WatermarkChanged,(function(){t.watermarkSVG=h.GenerateSVG.watermarkGetSVG(window.clientVars.watermark,t.PagesDocs,t.WatermarkUsersDocs,t.optionDocs),t.setState({base64Data:t.watermarkSVG.base64Data,base64NickData:t.watermarkSVG.base64NickData,canvasHeight:t.watermarkSVG.canvasHeight,lineHeight:t.watermarkSVG.lineHeight})}),this)},e.prototype.componentWillUnmount=function(){this.props.context.removeListener(o.WatermarkChanged,this)},e.prototype.render=function(){return l.a.createElement(h.WatermarkGenerate,{key:"tdocs-watermark-generate",base64Data:this.state.base64Data,base64NickData:this.state.base64NickData,canvasHeight:this.state.canvasHeight,lineHeight:this.state.lineHeight})},e}(l.a.Component),m=n(245),v=n(5);var b=n(18),k=n(109),w=(n(323),function(){return(w=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)}),S=function(){function t(t){this._handler=t}return t.prototype.shows=function(t){var e=Object(f.c)().watermark,n=Object(f.c)().globalPadId;h.WatermarkDialogManager.showDialog(t,e,n)},t.prototype.setCurrentOption=function(t){t&&(Object(f.c)().watermark=JSON.stringify(t),this._handler.editor.fire(new d))},t.prototype.parseOption=function(t){var e=t||{};if("string"==typeof e)try{e=JSON.parse(e)}catch(t){e={}}else"object"!=typeof e&&(e={});return w({},e)},t}(),T=function(t,e,n,i){var o,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(r<3?o(a):r>3?o(e,n,a):o(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},_=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},x=[{name:"watermark",content:"设置水印",shouldDisabled:function(t){return!(!t.permission||t.permission.canWatermark)},onClick:function(t,e){e.showWatermarkDialog()}}],E=function(){function t(t){this._scriptLoader=t}return t.prototype.$onInit=function(t){var e=this;this.editor=t,this.dialog=new S(this),t.addDecorator(s.DecoratorTypes.Page,(function(t){return[l.a.createElement(y,{key:"watermark",context:e.editor,width:Object(u.twipsToPx)(t.rect.width)}),{order:s.PageOrderType.Front}]})),t.on(m.b.ON_MARK_MESSAGE,(function(t){e.dialog.setCurrentOption(e.dialog.parseOption(t.msg.watermark))}),this),this._scriptLoader.getScriptLoader().listen("SHOW_WATERMARK_FROM_ADVPER",(function(t){u.Logger.log("listenWatermarkFromAdvPer invokeFrom "+t.detail.invokeFrom),"Share"===t.detail.invokeFrom?(a()("#shareContainer").hide(),e.dialog.shows({invokeFrom:"Share",onClose:function(){a()("#shareContainer").show()}})):"Cooperation"===t.detail.invokeFrom&&(a()(".cooperationv2-dialog-mask").parent().hide(),e.dialog.shows({invokeFrom:"Cooperation",onClose:function(){a()(".cooperationv2-dialog-mask").parent().show()}}))}))},t.prototype.$beforeDestroy=function(t){t.removeListener(m.b.ON_MARK_MESSAGE,this),this.editor=void 0},t.prototype.showWatermarkDialog=function(){var t=Object(f.c)().watermark,e=Object(f.c)().globalPadId;h.WatermarkDialogManager.showDialog({invokeFrom:"TitleBar"},t,e)},t=T([Object(v.i)({name:b.a.Watermark,menuItems:x,scope:0,for:["melo"]}),_("design:paramtypes",[k.a])],t)}()},492:function(t,e,n){"use strict";n.d(e,"a",(function(){return k}));var i,o=n(5),r=n(0),a=n(18),s=n(1),c=n.n(s),l=n(2),u=(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),p=function(t){function e(e,n){var i=t.call(this,r.RenderNotificationTypes.LOCATION_CLICK)||this;return i.currentSplitline=e,i.poiInfos=n,i}return u(e,t),e}(l.Notification),d=n(230),h=(n(272),function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}()),f=function(t){function e(e){var n=t.call(this,e)||this;return n.touchFocusTimer=null,n.touchIntent=null,n.longPressInterval=500,n.moveMinDistSquare=20,n.touchStartClients=null,n.clickHandler=function(t){t.preventDefault(),t.stopPropagation(),n.notifyClick()},n.onTouchStart=n.onTouchStart.bind(n),n.onTouchMove=n.onTouchMove.bind(n),n.onTouchEnd=n.onTouchEnd.bind(n),n}return h(e,t),e.prototype.componentDidMount=function(){t.prototype.componentDidMount.call(this),this.root&&(this.props.layoutBox.__node__=this.root,this.root.addEventListener("touchstart",this.onTouchStart,{passive:!1}),this.root.addEventListener("touchend",this.onTouchEnd,{passive:!1}),this.root.addEventListener("touchmove",this.onTouchMove,{passive:!1}))},e.prototype.componentWillUnmount=function(){this.root&&(this.root.removeEventListener("touchstart",this.onTouchStart),this.root.removeEventListener("touchend",this.onTouchEnd),this.root.removeEventListener("touchmove",this.onTouchMove))},e.prototype.createTouchFocusTimer=function(t){var e=this;this.touchIntent=null,this.touchFocusTimer=setTimeout((function(){e.touchIntent="longpress"}),this.longPressInterval)},e.prototype.clearTouchFocusTimerAndStatus=function(){this.touchFocusTimer&&(clearTimeout(this.touchFocusTimer),this.touchFocusTimer=null)},e.prototype.onTouchStart=function(t){document.documentElement.style.webkitUserSelect="none",document.documentElement.style.webkitTouchCallout="none",t.targetTouches.length>0&&(this.touchStartClients={x:t.targetTouches[0].clientX,y:t.targetTouches[0].clientY}),this.createTouchFocusTimer(t)},e.prototype.onTouchMove=function(t){if(this.touchStartClients){var e=t.targetTouches[0],n=e.clientX-this.touchStartClients.x,i=e.clientY-this.touchStartClients.y;n*n+i*i>this.moveMinDistSquare&&(this.clearTouchFocusTimerAndStatus(),this.touchIntent="scroll")}},e.prototype.onTouchEnd=function(t){if("longpress"===this.touchIntent)t.preventDefault(),t.stopPropagation(),this.props.context.fire(new r.PluginContainerFocusNotification),this.props.containerFocus.onFocus(this.props.layoutBox,!1),this.context.store.getValue("showMobileToolbar")||this.context.store.getValue("showVoiceInputPanel")||this.props.context.fire(new r.FocusBlurNotification(r.FocusBlurNotificationType.REQUEST_FOCUS,{from:r.From.CONTAINER}),!1);else if("scroll"!==this.touchIntent)return void 0;this.clearTouchFocusTimerAndStatus(),this.touchIntent=null,this.touchStartClients=null},e.prototype.onMouseDown=function(t){},e.prototype.onMouseUp=function(t){0===t.button&&(this.props.context.fire(new r.PluginContainerFocusNotification),this.props.containerFocus.onFocus(this.props.layoutBox,!1))},e.prototype.notifyClick=function(){var t=this.props.layoutBox.property.extraData.split(",");this.props.context.fire(new p(this.props.layoutBox,t))},e.prototype.render=function(){var t=this,e=this.props.layoutBox.property.extraData.split(",");return c.a.createElement("div",{ref:function(e){t.root=e},className:"location-box",onClick:this.clickHandler,onMouseDown:this.onMouseDown.bind(this),onMouseUp:this.onMouseUp.bind(this)},c.a.createElement("div",{className:"location-icon"},"  "),c.a.createElement("div",{className:"location-info"},c.a.createElement("h1",null," ",e[0]," "),c.a.createElement("h2",null," ",e[1]," ")),c.a.createElement("hr",{style:{height:"0",clear:"both"}}))},e.contextType=o.h,e}(d.a),g=function(t,e,n){return c.a.createElement(f,{layoutBox:t,key:t.property.anchorId,containerFocus:e,context:n})},y=n(332),m=n(232),v=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),b=function(t,e,n,i){var o,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(r<3?o(a):r>3?o(e,n,a):o(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},k=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return v(e,t),e.prototype.initContainerRender=function(e){t.prototype.initContainerRender.call(this,e),e.addContainerRender(r.ContainerType.Plugin,r.PluginType.Location,g)},e.prototype.initDecoratorRender=function(e){t.prototype.initDecoratorRender.call(this,e),e.addDecorator(r.DecoratorTypes.Page,Object(y.a)(e))},e=b([Object(o.i)({name:a.a.TdocsTdocsDeferredRender,scope:0,for:["melo"]})],e)}(m.a)},494:function(t,e,n){"use strict";n.d(e,"a",(function(){return P}));var i=n(0),o=n(12),r=n(68),a=(n(51),n(30)),s=n.n(a),c=n(5),l=n(2),u=n(287),p=(n(10),n(52)),d=n(109),h=function(t,e,n,i){var o,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(r<3?o(a):r>3?o(e,n,a):o(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},f=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};function g(t){var e=t.title,n=t.desc,o=t.share_url,r=t.image_url;window.wx&&(window.wx.onMenuShareAppMessage({title:e,desc:n,link:o,imgUrl:r,type:"",dataUrl:"",success:function(){i.ReportHelper.tdwReport({opername:"doc_share",module:"wecha_h5",action:"wechat_suc"})},cancel:function(){},trigger:function(){i.ReportHelper.tdwReport({opername:"doc_share",module:"wecha_h5",action:"share_wechat"})}}),window.wx.onMenuShareTimeline({title:e,link:o,imgUrl:r,success:function(){i.ReportHelper.tdwReport({opername:"doc_share",module:"wecha_h5",action:"moment_suc"})},cancel:function(){},trigger:function(){i.ReportHelper.tdwReport({opername:"doc_share",module:"wecha_h5",action:"share_moment"})}}),window.wx.onMenuShareQQ({title:e,desc:n,link:o,imgUrl:r,success:function(){},cancel:function(){}}))}var y=new(function(){function t(){}return t.prototype.init=function(){this.slr=this.scriptLoaderService.getScriptLoader()},t.prototype.setShareInfo=function(t,e){var n=this;!function(t){var e={};e.share_url=t.shortLink||window.location.href.split("#")[0],e.title=t.padTitle,e.source_name="腾讯文档",e.desc="腾讯文档-在线文档",e.isCreator=t.isCreator,e.image_url="https://docs.idqqimg.com/tim/docs/docs-design-resources/mobile/png@2x/file_doc_transparent_150@2x-7a01cd22be.png",e.miniprogram_image_url="https://pub.idqqimg.com/pc/misc/files/20180410/1fce078ca2434b18bfec613961d526ff.png",e.type="docx",e.desc="腾讯文档-在线文档",n.shareImageData&&(e.miniprogram_image_url=n.shareImageData),e.singleLineTitle=e.title?e.title:"",e.rightFlag=t.rightFlag,e.policy=t.policy,e.editable=p.a.getInstance().isEditable,e.isNewCreate=t.newPad;var i=Object(l.getUrlParameter)("group_code");i&&(e.groupCode=i);var o=t.globalPadId;if(o){var r=o.indexOf("$");e.domainId=o.slice(0,r),e.localPadId=o.slice(r+1,o.length)}e.contentEdited=window.isContentEditedToNativeSend||!1,function(t){var e=window.navigator.userAgent,n=window.location.href.indexOf("__wxjs_environment=miniprogram")>-1,i=!(!e.match(/MicroMessenger/i)||n),o=l.PlatformUtil.isWeWork()&&!1;if(i&&!o&&null!=t)if(document.getElementById("jweixinScript"))t();else{var r=document.createElement("script");r.id="jweixinScript";var a=l.PlatformUtil.isQQMiniProgram();r.src=a?"https://qzonestyle.gtimg.cn/qzone/qzact/act/external/qqjssdk/qqjssdk-1.0.0.js":"https://res.wx.qq.com/open/js/jweixin-1.3.2.js",r.onload=t,a&&(r.crossOrigin="anonymous"),null!==document.head&&document.head.appendChild(r)}}((function(){g(e),setTimeout((function(){g(e)}),2e3)}));if(l.PlatformUtil.isTimQQ()){var a=window.mqq;e.showShareBtn=!0,a.invoke("data","setShareInfo",e,(function(){}))}n.shareInfo=e}(e)},h([Object(c.l)(),f("design:type",c.x)],t.prototype,"store",void 0),h([Object(c.l)(),f("design:type",d.a)],t.prototype,"scriptLoaderService",void 0),t}()),m=function(t,e,n,i){var o,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(r<3?o(a):r>3?o(e,n,a):o(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},v=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},b=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function a(t){try{c(i.next(t))}catch(t){r(t)}}function s(t){try{c(i.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((i=i.apply(t,e||[])).next())}))},k=function(t,e){var n,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(t){r=[6,t],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}},w=function(){function t(){var t=this;this.autoNamedId=0,this.autoUpdateTitle=function(){if(1!==Object(o.c)().isUserChangeTitle){var e=t.readTitleFromStorage();if(!e||e.isAuto){var n=e?e.title:t.getDefaultTitle(),a=t.contextService.context.editor;if(a instanceof i.MeloEditor){var s=(i.Defaults.curDocDataVersion>=i.Defaults.newDefaultStyleVersion?a.service.getDocument().getFirstParaTextRegardless():a.service.getDocument().getFirstParamText()).content.replace(/(:|：|\*|\\|\/|<|>|"|\?|\|)/gi,"");s.length>r.a.MAX_TITLE_LENGTH&&(s=s.substr(0,r.a.MAX_TITLE_LENGTH)),0===s.length&&(s=t.getDefaultTitle()),Object(o.c)().padTitle!==s&&t.setTitle(s,!0,(function(e){if(e&&0===e.retcode);else if(12e3===e.retcode)l.Logger.error("TitleService.setTitle Set title failed: "+e),t.restoreOriginalTitle(n);else{}}))}}}};var e=this.store.get(c.d.IsOnline);e.getValue()&&this.checkAndUploadTitle(),e.subscribe((function(e){e&&t.checkAndUploadTitle()}))}return t.prototype.checkAndUploadTitle=function(){var t=this.readTitleFromStorage();if(t){if(t.isAuto&&1===Object(o.c)().isUserChangeTitle)return void this.persistTitleToStorage("",t.isAuto);this.setTitle(t.title,t.isAuto,(function(t){t&&t.retcode}))}},t.getInstance=function(){return t.instance||(t.instance=new t),t.instance},t.prototype.setTitleForDoc=function(t,e){var n=t;0===n.length&&(n=this.getDefaultTitle()),Object(o.c)().padTitle!==n?this.setTitle(n,!1,(function(t){t&&0===t.retcode&&e&&e(t)})):this.setTitleToStore(n)},t.prototype.getDataHelper=function(){return window.App&&window.App.GlobalConfig.IsSupportStore?window.offlineDataHelperInstance:null},t.prototype._offlineSyncTitle=function(t){return b(this,void 0,void 0,(function(){var e,n;return k(this,(function(i){switch(i.label){case 0:return t&&(e=this.getDataHelper())?(n=Object(o.c)(),[4,e.handleOfflineTitleChange(t,n)]):[2];case 1:return i.sent(),[2]}}))}))},t.prototype.updateLocalClientVarsTitle=function(t,e){return b(this,void 0,void 0,(function(){var n,i;return k(this,(function(r){switch(r.label){case 0:return(n=this.getDataHelper())?(i=Object(o.c)(),e||(i.isUserChangeTitle=1),i.padTitle=t,[4,n.updateClientVars(i)]):[2];case 1:return r.sent(),[2]}}))}))},t.prototype.setTitle=function(t,e,n){var a=this;this.persistTitleToStorage(t,e);var c=Object(o.c)();this.autoNamedId&&clearTimeout(this.autoNamedId);var p=this.getTitleFromStore();if(this.setTitleToStore(t),this._offlineSyncTitle(t),c.padStatus===o.a.NORMAL){Object(u.a)("MODIFY",{domainId:c.domainId,localPadId:c.localPadId,title:t,actiontoserver:1});var d=e?200:0;this.autoNamedId=setTimeout((function(){l.Logger.info("TitleService.setTitle Set title to: "+t+", isAuto: "+e),r.a.setTitle(t,e,c,(function(r){if(r&&0===r.retcode){var d="modify";""===p&&(d=e?"automatic_fill":"fill"),i.ReportHelper.tdwReport({opername:"doc_word_editor",module:"doc_title",action:d,obj2:c.padTitle,obj3:l.PlatformUtil.getBrowser(),ver5:1===Object(o.c)().collab_client_vars.dirty?"limited":"normal"});try{a.updateLocalClientVarsTitle(t,e),Object(u.a)("MODIFY",{domainId:c.domainId,localPadId:c.padId,title:t,actiontoserver:0,title_sort_priority:r.doc_info.title_sort_priority,title_sort_value:r.doc_info.title_sort_value});var h=l.LocalStorageUtil.getItem("tdsourcetag");i.ReportHelper.tdwReport({opername:"doc_core",module:"edit",action:"modify_title",source3:h||"",obj3:l.PlatformUtil.getBrowser(),ver5:1===c.collab_client_vars.dirty?"limited":"normal"}),a.persistTitleToStorage("",e)}catch(t){l.Logger.error("TitleService failed: "+t)}}else{if(10020===r.retcode&&e)a.persistTitleToStorage("",e);else if(12e3===r.retcode){s.a.show({message:"标题不合规，请重新命名。",duration:2e3,autoClose:!0})}l.Logger.error("TitleService.setTitle Set title failed: "+r),a.restoreOriginalTitle(p)}n&&n(r)}))}),d)}else l.Logger.info("Cant set title for doc that not yet created.")},t.prototype.getDefaultTitle=function(){return"无标题文档"},t.prototype.persistTitleToStorage=function(t,e){var n=Object(o.c)();if(l.Logger.info("Set title to: "+t+", isAuto: "+e+", docId: "+n.padId),t){var i={title:t,isAuto:e};l.LocalStorageUtil.setItem("offline_title_"+n.padId,JSON.stringify(i))}else l.LocalStorageUtil.removeItem("offline_title_"+n.padId)},t.prototype.readTitleFromStorage=function(){var t=Object(o.c)(),e=l.LocalStorageUtil.getItem("offline_title_"+t.padId);return e?JSON.parse(e):null},t.prototype.setTitleToStore=function(t){this.store.update("docTitle",t)},t.prototype.getTitleFromStore=function(){var t=this.store.getValue("docTitle");return t||""},t.prototype.setTitleToNativeTitlebar=function(t){try{if(l.Logger.info("Set title to native: "+t),document.title=t,l.PlatformUtil.isWXMiniProgram()&&window.wx&&window.wx.miniProgram)return void window.wx.miniProgram.postMessage({data:{title:t}});0;var e=Object(o.c)();e.padTitle=t,y.setShareInfo({},e)}catch(t){l.Logger.log("failed set title to mobile titlebar")}},t.prototype.restoreOriginalTitle=function(t){Object(o.c)().padTitle=t,this.setTitleToStore(t),this.setTitleToNativeTitlebar(t),this.persistTitleToStorage(t,!0)},t.prototype.updateDocInitTitle=function(){var t=Object(o.c)().padTitle,e=this.readTitleFromStorage();l.Logger.info("Get title: "+t+", local title: "+(e?e.title:"")),this.setTitleToStore(t);var n=this.store.get("docTitle");this.pcNativeSubscription=n.subscribe((function(t){document.title=t||"无标题文档"}))},t.prototype.destroy=function(){this.autoNamedId&&clearTimeout(this.autoNamedId),this.pcNativeSubscription&&this.pcNativeSubscription.unsubscribe()},m([Object(c.l)(),v("design:type",c.x)],t.prototype,"store",void 0),m([Object(c.l)(),v("design:type",c.f)],t.prototype,"contextService",void 0),m([Object(c.l)(),v("design:type",c.B)],t.prototype,"workbench",void 0),t}(),S=n(162),T=n(256),_=n(245),x=n(18),E=function(t,e,n,i){var o,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(a=(r<3?o(a):r>3?o(e,n,a):o(e,n))||a);return r>3&&a&&Object.defineProperty(e,n,a),a},L=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},P=function(){function t(t,e,n,o){var a=this;this.store=t,this.autoNamedId=0,this.userEdit=!1,this.transferringDocstatus=!1,this.saveToList=function(t,e){var n=a.context.clientVars;a.userEdit&&12===n.docStatus&&"success"===t&&"UserChangeset"===e&&(a.transferringDocstatus||(a.transferringDocstatus=!0,r.a.docHumtrans(n).then((function(){a.transferringDocstatus=!1}))))},this.updateTitle=function(t){a.autoNamedId&&clearTimeout(a.autoNamedId),a.autoNamedId=setTimeout((function(){t.isCompositing()||t.isUpdating?a.updateTitle(t):a.autoUpdateTitle()}),500)},this.userEditDoc=function(){if(a.userEdit){var t=a.context.editor;t instanceof i.MeloEditor&&t.removeCallBack(i.StateNotification.EfficientModelChange,a.userEditDoc)}else a.userEdit=!0},this.setTitle=function(t){w.getInstance().setTitleForDoc(t,(function(e){e&&0===e.retcode&&a.store.get(c.d.ModelState).next(t)}))},this.autoUpdateTitle=function(){w.getInstance().autoUpdateTitle()},this.updateInitDocTitle=function(){w.getInstance().updateDocInitTitle()},this.isLocalReq=function(t){return null!==r.a.getTitleModifyReqFromStore(t)},this.updateTitleReversion=function(t){r.a.updateTitleReversion(t)},this.getCurTitleReversion=function(){return r.a.getTitleReversionFromStore()},this.setTitleToNativeTitlebar=function(t){w.getInstance().setTitleToNativeTitlebar(t)},n.context.permission.canEditTitle&&e.setTitleEditable(!0),this.context=n.context,o.listen("setTitle",this.setTitle)}return t.prototype.$onInit=function(t){var e,n=this;w.getInstance().updateDocInitTitle(),t.on(i.StateNotification.CollabToServer,(function(){return n.updateTitle(t)}),this),t.on(i.StateNotification.EfficientModelChange,this.userEditDoc),t.on(_.b.ON_TITLE_CHANGE,(function(t){var e=t.newTitle;n.context.clientVars.padTitle=e;var i=t.clientCookie,o=0;if(i&&"string"==typeof i){var r={};try{r=JSON.parse(i)}catch(t){return}var a=r.isAuto,s=r.randomId;if(o=r.reversion,a){if(n.isLocalReq(s))return;if(o<n.getCurTitleReversion())return}}n.store.update("docTitle",e),n.updateTitleReversion(o)}),this),i.GlobalContext.registerPlugin(((e={})[S.b.SetData2StoreCallback]=function(t,e,i,o){n.saveToList(i,o),e()},e))},t.prototype.$beforeDestroy=function(t){w.getInstance().destroy(),t.removeListener(i.StateNotification.CollabToServer,this),t.removeCallBack(i.StateNotification.EfficientModelChange,this.userEditDoc),t.removeListener(_.b.ON_TITLE_CHANGE,this),this.autoNamedId=0,this.userEdit=!1},t=E([Object(c.i)({name:x.a.Title,scope:0,for:["melo"]}),L("design:paramtypes",[c.x,T.a,c.f,c.B])],t)}()}}]);
//# sourceMappingURL=features-pc-publish-readonly-pc-f128412c.js.map